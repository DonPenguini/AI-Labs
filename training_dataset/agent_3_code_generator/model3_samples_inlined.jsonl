{"input": {"input_text": "A physics worksheet describes a ball launched from a platform at speed v0 and angle theta above horizontal. Ignore air drag; use g = 9.81 m/s^2. Provide parametric equations, time of flight, and range.", "simulation_name": " Projectile Motion 2D", "domain": "Physics", "description": "2D point-mass projectile without drag", "assumptions": ["Flat ground at y=0", "No air resistance"], "entities": [{"name": "projectile", "mass": {"symbol": "m", "unit": "kg", "range": [0.05, 10]}}], "constants": [{"name": "gravity", "symbol": "g", "value": 9.81, "unit": "m/s^2"}], "parameters": [{"name": "launch_speed", "symbol": "v0", "unit": "m/s", "range": [0, 120]}, {"name": "launch_angle", "symbol": "theta", "unit": "rad", "range": [0, 1.57]}, {"name": "release_height", "symbol": "h", "unit": "m", "range": [0, 50]}], "equations": [{"description": "Horizontal position", "expression": "x(t) = v0*cos(theta)*t"}, {"description": "Vertical position", "expression": "y(t) = h + v0*sin(theta)*t - 0.5*g*t^2"}, {"description": "Time of flight", "condition": "discriminant >= 0", "expression": "t_flight = (v0*sin(theta) + sqrt((v0*sin(theta))^2 + 2*g*h))/g"}, {"description": "Range", "expression": "range = v0*cos(theta)*t_flight"}], "initial_conditions": {"x": 0, "y": "h", "t": 0}, "outputs": ["x", "y", "t_flight", "range"], "simulation_controls": ["v0", "theta", "h"], "constraints": ["discriminant = (v0*sin(theta))^2 + 2*g*h >= 0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>2D Projectile Motion Simulation</title>\n    <style>\n        :root {\n            --primary-color: #2563eb;\n            --bg-color: #f8fafc;\n            --panel-bg: #ffffff;\n            --text-color: #1e293b;\n        }\n\n        body {\n            font-family: 'Segoe UI', system-ui, sans-serif;\n            background-color: var(--bg-color);\n            color: var(--text-color);\n            margin: 0;\n            padding: 20px;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n        }\n\n        h2 { margin-top: 0; }\n\n        .container {\n            display: flex;\n            gap: 20px;\n            max-width: 1200px;\n            width: 100%;\n            flex-wrap: wrap;\n        }\n\n        /* Controls Panel */\n        .controls {\n            flex: 1;\n            min-width: 300px;\n            background: var(--panel-bg);\n            padding: 25px;\n            border-radius: 12px;\n            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n        }\n\n        .control-group {\n            margin-bottom: 20px;\n        }\n\n        label {\n            display: flex;\n            justify-content: space-between;\n            font-weight: 600;\n            margin-bottom: 8px;\n        }\n\n        input[type=\"range\"] {\n            width: 100%;\n            cursor: pointer;\n        }\n\n        .buttons {\n            display: flex;\n            gap: 10px;\n            margin-top: 20px;\n        }\n\n        button {\n            flex: 1;\n            padding: 12px;\n            border: none;\n            border-radius: 8px;\n            font-weight: 600;\n            cursor: pointer;\n            transition: opacity 0.2s;\n        }\n\n        #launchBtn { background-color: var(--primary-color); color: white; }\n        #resetBtn { background-color: #cbd5e1; color: var(--text-color); }\n        button:hover { opacity: 0.9; }\n\n        /* Stats Display */\n        .stats {\n            margin-top: 20px;\n            padding: 15px;\n            background: #f1f5f9;\n            border-radius: 8px;\n            font-size: 0.9rem;\n        }\n        .stat-row {\n            display: flex;\n            justify-content: space-between;\n            margin-bottom: 8px;\n            padding-bottom: 8px;\n            border-bottom: 1px solid #e2e8f0;\n        }\n        .stat-row:last-child { border-bottom: none; }\n\n        /* Canvas Area */\n        .canvas-container {\n            flex: 2;\n            min-width: 300px;\n            background: white;\n            border-radius: 12px;\n            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n            position: relative;\n            overflow: hidden;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            height: 500px;\n        }\n\n        canvas {\n            background: radial-gradient(circle at top right, #e0f2fe, #ffffff);\n            width: 100%;\n            height: 100%;\n        }\n\n        .value-display { color: var(--primary-color); }\n    </style>\n</head>\n<body>\n\n    <div class=\"container\">\n        <div class=\"controls\">\n            <h2>Configuration</h2>\n            \n            <div class=\"control-group\">\n                <label>Launch Speed (v₀) <span id=\"val_v0\" class=\"value-display\">50 m/s</span></label>\n                <input type=\"range\" id=\"v0\" min=\"1\" max=\"120\" value=\"50\" step=\"1\">\n            </div>\n\n            <div class=\"control-group\">\n                <label>Launch Angle (θ) <span id=\"val_theta\" class=\"value-display\">45°</span></label>\n                <input type=\"range\" id=\"theta\" min=\"0\" max=\"90\" value=\"45\" step=\"1\">\n            </div>\n\n            <div class=\"control-group\">\n                <label>Platform Height (h) <span id=\"val_h\" class=\"value-display\">10 m</span></label>\n                <input type=\"range\" id=\"h\" min=\"0\" max=\"50\" value=\"10\" step=\"1\">\n            </div>\n\n            <div class=\"stats\">\n                <div class=\"stat-row\"><span>Time of Flight:</span> <strong id=\"out_time\">0.00 s</strong></div>\n                <div class=\"stat-row\"><span>Total Range:</span> <strong id=\"out_range\">0.00 m</strong></div>\n                <div class=\"stat-row\"><span>Current Time (t):</span> <span id=\"curr_time\">0.00 s</span></div>\n                <div class=\"stat-row\"><span>Position (x, y):</span> <span id=\"curr_pos\">(0.0, 0.0)</span></div>\n            </div>\n\n            <div class=\"buttons\">\n                <button id=\"launchBtn\">Launch Ball</button>\n                <button id=\"resetBtn\">Reset</button>\n            </div>\n        </div>\n\n        <div class=\"canvas-container\">\n            <canvas id=\"simCanvas\"></canvas>\n        </div>\n    </div>\n\n<script>\n    // --- Constants & State ---\n    const g = 9.81;\n    let state = {\n        v0: 50,\n        thetaDeg: 45,\n        h: 10,\n        t: 0,\n        isAnimating: false,\n        flightTime: 0,\n        range: 0,\n        scale: 1 // pixels per meter\n    };\n\n    let animationId;\n\n    // --- DOM Elements ---\n    const canvas = document.getElementById('simCanvas');\n    const ctx = canvas.getContext('2d');\n    \n    // Inputs\n    const inV0 = document.getElementById('v0');\n    const inTheta = document.getElementById('theta');\n    const inH = document.getElementById('h');\n    \n    // Labels\n    const lV0 = document.getElementById('val_v0');\n    const lTheta = document.getElementById('val_theta');\n    const lH = document.getElementById('val_h');\n    \n    // Outputs\n    const outTime = document.getElementById('out_time');\n    const outRange = document.getElementById('out_range');\n    const currTime = document.getElementById('curr_time');\n    const currPos = document.getElementById('curr_pos');\n\n    // --- Physics Engine ---\n    function calculatePhysics() {\n        const thetaRad = state.thetaDeg * (Math.PI / 180);\n        \n        // Quadratic formula components for time of flight: 0 = h + v0y*t - 0.5*g*t^2\n        // Rearranged: 0.5*g*t^2 - v0y*t - h = 0\n        const v0y = state.v0 * Math.sin(thetaRad);\n        const v0x = state.v0 * Math.cos(thetaRad);\n        \n        const discriminant = Math.sqrt(v0y * v0y + 2 * g * state.h);\n        state.flightTime = (v0y + discriminant) / g;\n        \n        state.range = v0x * state.flightTime;\n        \n        // Update Stats UI\n        outTime.textContent = state.flightTime.toFixed(2) + \" s\";\n        outRange.textContent = state.range.toFixed(2) + \" m\";\n    }\n\n    function getPositionAt(t) {\n        if (t > state.flightTime) t = state.flightTime; // Clamp to ground\n        const thetaRad = state.thetaDeg * (Math.PI / 180);\n        \n        const x = state.v0 * Math.cos(thetaRad) * t;\n        const y = state.h + (state.v0 * Math.sin(thetaRad) * t) - (0.5 * g * t * t);\n        \n        return { x, y };\n    }\n\n    // --- Drawing & Scaling ---\n    function resizeCanvas() {\n        canvas.width = canvas.parentElement.clientWidth;\n        canvas.height = canvas.parentElement.clientHeight;\n        drawFrame();\n    }\n\n    function setScale() {\n        // Calculate scale to fit the entire trajectory + 10% padding\n        // Max height approximation\n        const thetaRad = state.thetaDeg * (Math.PI / 180);\n        const v0y = state.v0 * Math.sin(thetaRad);\n        const maxHeight = state.h + (v0y * v0y) / (2 * g);\n        \n        const padding = 40; // pixels\n        const usableWidth = canvas.width - (padding * 2);\n        const usableHeight = canvas.height - (padding * 2);\n\n        // Determine scale based on whether width or height is the limiting factor\n        // Ensure range is at least 1m to prevent divide by zero on init\n        const maxX = Math.max(state.range, 10); \n        const maxY = Math.max(maxHeight, 10);\n\n        const scaleX = usableWidth / maxX;\n        const scaleY = usableHeight / maxY;\n        \n        state.scale = Math.min(scaleX, scaleY);\n    }\n\n    function worldToScreen(x, y) {\n        // Origin is bottom-left, shifted by padding\n        const padding = 40;\n        const screenX = padding + (x * state.scale);\n        const screenY = canvas.height - padding - (y * state.scale); \n        return { x: screenX, y: screenY };\n    }\n\n    function drawFrame() {\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n        \n        // 1. Draw Ground\n        const groundY = canvas.height - 40;\n        ctx.beginPath();\n        ctx.strokeStyle = \"#64748b\";\n        ctx.lineWidth = 2;\n        ctx.moveTo(0, groundY);\n        ctx.lineTo(canvas.width, groundY);\n        ctx.stroke();\n\n        // 2. Draw Platform\n        const platformW = 10; \n        const platformH = state.h * state.scale;\n        const origin = worldToScreen(0, 0);\n        \n        if (state.h > 0) {\n            ctx.fillStyle = \"#94a3b8\";\n            ctx.fillRect(origin.x - (platformW/2), origin.y - platformH, platformW, platformH);\n        }\n\n        // 3. Draw Trajectory Path (Dotted Line)\n        ctx.beginPath();\n        ctx.strokeStyle = \"#cbd5e1\";\n        ctx.setLineDash([5, 5]);\n        ctx.lineWidth = 2;\n        \n        // Draw path using segments\n        for(let i = 0; i <= 50; i++) {\n            const timeStep = (state.flightTime / 50) * i;\n            const pos = getPositionAt(timeStep);\n            const screenPos = worldToScreen(pos.x, pos.y);\n            if(i === 0) ctx.moveTo(screenPos.x, screenPos.y);\n            else ctx.lineTo(screenPos.x, screenPos.y);\n        }\n        ctx.stroke();\n        ctx.setLineDash([]);\n\n        // 4. Draw Ball\n        const currentPos = getPositionAt(state.t);\n        const ballScreen = worldToScreen(currentPos.x, currentPos.y);\n\n        ctx.beginPath();\n        ctx.fillStyle = \"#ef4444\"; // Red ball\n        ctx.arc(ballScreen.x, ballScreen.y, 6, 0, Math.PI * 2);\n        ctx.fill();\n\n        // Update UI Text\n        currTime.textContent = state.t.toFixed(2) + \" s\";\n        currPos.textContent = `(${currentPos.x.toFixed(1)}, ${currentPos.y.toFixed(1)})`;\n    }\n\n    // --- Animation Loop ---\n    function animate(timestamp) {\n        if (!state.isAnimating) return;\n\n        // Simple time step (approx 60fps)\n        const dt = 1/60; \n        \n        // Speed up simulation factor (optional, 1.0 = real time)\n        const timeScale = 1.0; \n\n        state.t += dt * timeScale;\n\n        if (state.t >= state.flightTime) {\n            state.t = state.flightTime;\n            state.isAnimating = false;\n            document.getElementById('launchBtn').textContent = \"Launch Ball\";\n        }\n\n        drawFrame();\n        \n        if (state.isAnimating) {\n            animationId = requestAnimationFrame(animate);\n        }\n    }\n\n    // --- Event Listeners ---\n    function updateInputs() {\n        state.v0 = parseFloat(inV0.value);\n        state.thetaDeg = parseFloat(inTheta.value);\n        state.h = parseFloat(inH.value);\n\n        lV0.textContent = state.v0 + \" m/s\";\n        lTheta.textContent = state.thetaDeg + \"°\";\n        lH.textContent = state.h + \" m\";\n\n        calculatePhysics();\n        // Only rescale if not animating to prevent jarring zooms\n        if(!state.isAnimating && state.t === 0) {\n            setScale();\n            drawFrame();\n        }\n    }\n\n    inV0.addEventListener('input', updateInputs);\n    inTheta.addEventListener('input', updateInputs);\n    inH.addEventListener('input', updateInputs);\n\n    document.getElementById('launchBtn').addEventListener('click', () => {\n        if (state.isAnimating) return;\n        \n        // If ball is at end, reset first\n        if (state.t >= state.flightTime) {\n            state.t = 0;\n        }\n\n        state.isAnimating = true;\n        document.getElementById('launchBtn').textContent = \"In Air...\";\n        \n        // Recalculate scale before launch to ensure fit\n        calculatePhysics();\n        setScale();\n        \n        animate();\n    });\n\n    document.getElementById('resetBtn').addEventListener('click', () => {\n        state.isAnimating = false;\n        state.t = 0;\n        document.getElementById('launchBtn').textContent = \"Launch Ball\";\n        cancelAnimationFrame(animationId);\n        updateInputs(); // resets scale and draws\n    });\n\n    window.addEventListener('resize', () => {\n        resizeCanvas();\n        setScale();\n        drawFrame();\n    });\n\n    // --- Initialization ---\n    resizeCanvas();\n    updateInputs();\n\n</script>\n</body>\n</html>", "css": "", "js": ""}}
{"input": {"input_text": "A lab note describes a small-angle pendulum of length L released from angle theta0. Provide angular frequency and closed-form angle over time. Use g = 9.81 m/s^2.", "simulation_name": " Pendulum Small Angle", "domain": "Physics", "description": "Linearized simple harmonic pendulum", "assumptions": ["|theta| < 0.3 rad", "Rigid massless rod"], "entities": [{"name": "bob", "mass": {"symbol": "m", "unit": "kg", "range": [0.05, 2]}}], "constants": [{"name": "gravity", "symbol": "g", "value": 9.81, "unit": "m/s^2"}], "parameters": [{"name": "length", "symbol": "L", "unit": "m", "range": [0.1, 3]}, {"name": "initial_angle", "symbol": "theta0", "unit": "rad", "range": [-0.3, 0.3]}], "equations": [{"description": "Angular frequency", "expression": "omega = sqrt(g/L)"}, {"description": "Angle", "expression": "theta(t) = theta0*cos(omega*t)"}, {"description": "Angular velocity", "expression": "thetadot(t) = -theta0*omega*sin(omega*t)"}], "initial_conditions": {"theta": "theta0", "thetadot": 0, "t": 0}, "outputs": ["theta", "thetadot"], "simulation_controls": ["L", "theta0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S02 Pendulum Small Angle Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    </head>\n<body>\n\n<div class=\"container\">\n    <header>\n        <h1>S02: Small-Angle Pendulum</h1>\n        <p class=\"subtitle\">Linearized Simple Harmonic Motion (Small Angle Approximation)</p>\n    </header>\n\n    <main class=\"sim-layout\">\n        <section class=\"canvas-container\">\n            <canvas id=\"simCanvas\" width=\"600\" height=\"400\"></canvas>\n            <div class=\"legend\">\n                <span style=\"color: #555;\">Pivot (0,0)</span>\n                <span style=\"color: #3498db;\">Bob (m)</span>\n            </div>\n        </section>\n\n        <section class=\"controls-container\">\n            \n            <div class=\"control-group\">\n                <h3>Parameters</h3>\n                \n                <label for=\"lengthSlider\">Length ($L$): <span id=\"lengthVal\">1.00</span> m</label>\n                <input type=\"range\" id=\"lengthSlider\" min=\"0.1\" max=\"3.0\" step=\"0.1\" value=\"1.5\">\n                \n                <label for=\"angleSlider\">Initial Angle ($\\theta_0$): <span id=\"angleVal\">0.20</span> rad</label>\n                <input type=\"range\" id=\"angleSlider\" min=\"-0.3\" max=\"0.3\" step=\"0.01\" value=\"0.2\">\n                \n                <div class=\"buttons\">\n                    <button id=\"resetBtn\">Reset t=0</button>\n                    <button id=\"pauseBtn\">Pause/Play</button>\n                </div>\n            </div>\n\n            <div class=\"data-group\">\n                <h3>Real-Time Dynamics</h3>\n                <div class=\"data-row\">\n                    <span>Time ($t$):</span>\n                    <span id=\"timeDisplay\" class=\"value\">0.00 s</span>\n                </div>\n                <div class=\"data-row\">\n                    <span>Freq ($\\omega = \\sqrt{g/L}$):</span>\n                    <span id=\"omegaDisplay\" class=\"value\">-- rad/s</span>\n                </div>\n                <div class=\"data-row\">\n                    <span>Angle ($\\theta$):</span>\n                    <span id=\"thetaDisplay\" class=\"value\">-- rad</span>\n                </div>\n                <div class=\"data-row\">\n                    <span>Ang. Velocity ($\\dot{\\theta}$):</span>\n                    <span id=\"thetaDotDisplay\" class=\"value\">-- rad/s</span>\n                </div>\n            </div>\n\n            <div class=\"equations-reference\">\n                <h4>Model Equations</h4>\n                <p>$\\omega = \\sqrt{g/L}$</p>\n                <p>$\\theta(t) = \\theta_0 \\cos(\\omega t)$</p>\n            </div>\n        </section>\n    </main>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": "/* General Reset */\n* {\n    box-sizing: border-box;\n    margin: 0;\n    padding: 0;\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n}\n\nbody {\n    background-color: #f4f4f9;\n    color: #333;\n    display: flex;\n    justify-content: center;\n    padding: 20px;\n}\n\n.container {\n    background-color: white;\n    width: 100%;\n    max-width: 900px;\n    border-radius: 8px;\n    box-shadow: 0 4px 15px rgba(0,0,0,0.1);\n    overflow: hidden;\n}\n\nheader {\n    background-color: #2c3e50;\n    color: white;\n    padding: 20px;\n    text-align: center;\n}\n\nheader h1 {\n    font-size: 1.5rem;\n    margin-bottom: 5px;\n}\n\n.subtitle {\n    font-size: 0.9rem;\n    opacity: 0.8;\n}\n\n/* Simulation Layout */\n.sim-layout {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 0;\n}\n\n/* Canvas Area */\n.canvas-container {\n    flex: 2;\n    background-color: #ecf0f1;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    border-right: 1px solid #ddd;\n    padding: 20px;\n    min-width: 300px;\n}\n\ncanvas {\n    background-color: #ffffff;\n    border: 1px solid #bdc3c7;\n    border-radius: 4px;\n    box-shadow: inset 0 0 10px rgba(0,0,0,0.05);\n}\n\n.legend {\n    margin-top: 10px;\n    font-size: 0.85rem;\n    display: flex;\n    gap: 15px;\n}\n\n/* Controls Area */\n.controls-container {\n    flex: 1;\n    padding: 20px;\n    background-color: #fff;\n    min-width: 250px;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\nh3 {\n    font-size: 1.1rem;\n    border-bottom: 2px solid #3498db;\n    padding-bottom: 5px;\n    margin-bottom: 15px;\n    color: #2c3e50;\n}\n\nlabel {\n    display: block;\n    font-weight: 600;\n    margin-bottom: 5px;\n    font-size: 0.9rem;\n}\n\ninput[type=range] {\n    width: 100%;\n    margin-bottom: 15px;\n    cursor: pointer;\n}\n\n.buttons {\n    display: flex;\n    gap: 10px;\n    margin-top: 5px;\n}\n\nbutton {\n    flex: 1;\n    padding: 8px;\n    background-color: #3498db;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    transition: background 0.2s;\n}\n\nbutton:hover {\n    background-color: #2980b9;\n}\n\n/* Data Display */\n.data-row {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 8px;\n    font-size: 0.9rem;\n    border-bottom: 1px dashed #eee;\n    padding-bottom: 2px;\n}\n\n.value {\n    font-family: 'Courier New', Courier, monospace;\n    font-weight: bold;\n    color: #e74c3c;\n}\n\n/* Reference Section */\n.equations-reference {\n    background-color: #f8f9fa;\n    padding: 10px;\n    border-radius: 4px;\n    border-left: 4px solid #95a5a6;\n}\n\n.equations-reference h4 {\n    font-size: 0.85rem;\n    margin-bottom: 5px;\n    color: #7f8c8d;\n}\n\n.equations-reference p {\n    font-family: 'Times New Roman', Times, serif;\n    font-style: italic;\n    font-size: 1.1rem;\n    margin: 2px 0;\n}\n\n/* Responsive adjustments */\n@media (max-width: 700px) {\n    .sim-layout {\n        flex-direction: column;\n    }\n    .canvas-container {\n        border-right: none;\n        border-bottom: 1px solid #ddd;\n    }\n}", "js": "/**\n * S02 Pendulum Small Angle Simulation\n * Domain: Physics\n * Description: Linearized simple harmonic pendulum simulation\n */\n\n// --- Constants & State ---\nconst CONSTANTS = {\n    g: 9.81, // m/s^2\n};\n\nconst STATE = {\n    L: 1.5,       // Length (m)\n    theta0: 0.2,  // Initial Angle (rad)\n    t: 0,         // Time (s)\n    isRunning: true,\n    scale: 100,   // Pixels per meter for drawing\n    origin: { x: 300, y: 50 } // Canvas origin coordinates\n};\n\n// --- DOM Elements ---\nconst canvas = document.getElementById('simCanvas');\nconst ctx = canvas.getContext('2d');\n\nconst inputs = {\n    length: document.getElementById('lengthSlider'),\n    angle: document.getElementById('angleSlider'),\n    reset: document.getElementById('resetBtn'),\n    pause: document.getElementById('pauseBtn')\n};\n\nconst displays = {\n    length: document.getElementById('lengthVal'),\n    angle: document.getElementById('angleVal'),\n    time: document.getElementById('timeDisplay'),\n    omega: document.getElementById('omegaDisplay'),\n    theta: document.getElementById('thetaDisplay'),\n    thetaDot: document.getElementById('thetaDotDisplay')\n};\n\n// --- Physics Engine ---\n\n/**\n * Calculates current physics state based on time t\n * Uses closed-form solutions:\n * omega = sqrt(g/L)\n * theta(t) = theta0 * cos(omega * t)\n * thetadot(t) = -theta0 * omega * sin(omega * t)\n */\nfunction calculatePhysics(time) {\n    const omega = Math.sqrt(CONSTANTS.g / STATE.L);\n    const theta = STATE.theta0 * Math.cos(omega * time);\n    const thetaDot = -STATE.theta0 * omega * Math.sin(omega * time);\n\n    return { omega, theta, thetaDot };\n}\n\n// --- Rendering ---\n\nfunction drawPendulum(theta) {\n    // Clear canvas\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    // Calculate Bob Position\n    // x = L * sin(theta)\n    // y = L * cos(theta)\n    const bobX = STATE.origin.x + (STATE.L * STATE.scale * Math.sin(theta));\n    const bobY = STATE.origin.y + (STATE.L * STATE.scale * Math.cos(theta));\n\n    // Draw Pivot\n    ctx.beginPath();\n    ctx.arc(STATE.origin.x, STATE.origin.y, 5, 0, Math.PI * 2);\n    ctx.fillStyle = '#333';\n    ctx.fill();\n\n    // Draw Rod\n    ctx.beginPath();\n    ctx.moveTo(STATE.origin.x, STATE.origin.y);\n    ctx.lineTo(bobX, bobY);\n    ctx.strokeStyle = '#333';\n    ctx.lineWidth = 2;\n    ctx.stroke();\n\n    // Draw Bob\n    ctx.beginPath();\n    ctx.arc(bobX, bobY, 15, 0, Math.PI * 2);\n    ctx.fillStyle = '#3498db'; // Blue bob\n    ctx.fill();\n    ctx.stroke();\n\n    // Draw Reference Line (Vertical)\n    ctx.setLineDash([5, 5]);\n    ctx.beginPath();\n    ctx.moveTo(STATE.origin.x, STATE.origin.y);\n    ctx.lineTo(STATE.origin.x, STATE.origin.y + (3.2 * STATE.scale)); // Draw slightly past max length\n    ctx.strokeStyle = '#ccc';\n    ctx.lineWidth = 1;\n    ctx.stroke();\n    ctx.setLineDash([]);\n}\n\nfunction updateUI(physicsValues) {\n    displays.length.textContent = STATE.L.toFixed(2);\n    displays.angle.textContent = STATE.theta0.toFixed(2);\n    \n    displays.time.textContent = STATE.t.toFixed(2) + \" s\";\n    displays.omega.textContent = physicsValues.omega.toFixed(3) + \" rad/s\";\n    displays.theta.textContent = physicsValues.theta.toFixed(3) + \" rad\";\n    displays.thetaDot.textContent = physicsValues.thetaDot.toFixed(3) + \" rad/s\";\n}\n\n// --- Animation Loop ---\n\nlet lastFrameTime = 0;\n\nfunction animate(timestamp) {\n    if (!lastFrameTime) lastFrameTime = timestamp;\n    const deltaTime = (timestamp - lastFrameTime) / 1000; // Convert to seconds\n    lastFrameTime = timestamp;\n\n    if (STATE.isRunning) {\n        STATE.t += deltaTime;\n    }\n\n    // Physics Calculation\n    const physics = calculatePhysics(STATE.t);\n\n    // Render\n    drawPendulum(physics.theta);\n    updateUI(physics);\n\n    requestAnimationFrame(animate);\n}\n\n// --- Event Listeners ---\n\ninputs.length.addEventListener('input', (e) => {\n    STATE.L = parseFloat(e.target.value);\n    // Note: We don't reset t here to allow dynamic changing, \n    // though strictly closed-form implies fixed parameters.\n    // Changing L effectively changes frequency instantly.\n});\n\ninputs.angle.addEventListener('input', (e) => {\n    STATE.theta0 = parseFloat(e.target.value);\n    STATE.t = 0; // Reset time when initial condition changes to avoid phase jumps\n});\n\ninputs.reset.addEventListener('click', () => {\n    STATE.t = 0;\n});\n\ninputs.pause.addEventListener('click', () => {\n    STATE.isRunning = !STATE.isRunning;\n});\n\n// --- Initialization ---\n\n// Start Animation\nrequestAnimationFrame(animate);"}}
{"input": {"input_text": "Electronics text: an RC low-pass driven by a step from 0 to Vin at t=0. Report capacitor voltage and current. Components are ideal.", "simulation_name": " RC Step Low-Pass", "domain": "Electrical Engineering", "description": "First-order RC charging from a DC step", "assumptions": ["Ideal components"], "entities": [{"name": "capacitor", "capacitance": {"symbol": "C", "unit": "F", "range": [1e-09, 0.1]}}, {"name": "resistor", "resistance": {"symbol": "R", "unit": "ohm", "range": [10, 10000000.0]}}], "constants": [], "parameters": [{"name": "input_voltage", "symbol": "Vin", "unit": "V", "range": [0, 50]}], "equations": [{"description": "Time constant", "expression": "tau = R*C"}, {"description": "Capacitor voltage", "expression": "vc(t) = Vin*(1 - exp(-t/tau))"}, {"description": "Capacitor current", "expression": "ic(t) = (Vin/R)*exp(-t/tau)"}], "initial_conditions": {"vc": 0, "t": 0}, "outputs": ["vc", "ic"], "simulation_controls": ["Vin", "R", "C"], "constraints": ["R > 0", "C > 0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S03: RC Step Response Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n\n<div class=\"main-container\">\n    <header>\n        <h1>S03: RC Low-Pass Step Response</h1>\n        <p>First-order RC circuit charging from a DC step input ($V_{in}$) at $t=0$.</p>\n    </header>\n\n    <div class=\"sim-grid\">\n        <section class=\"visualizer\">\n            <canvas id=\"simCanvas\" width=\"600\" height=\"400\"></canvas>\n            <div class=\"legend\">\n                <span class=\"legend-item\"><span class=\"color-box voltage\"></span>Voltage ($v_c$)</span>\n                <span class=\"legend-item\"><span class=\"color-box current\"></span>Current ($i_c$)</span>\n            </div>\n        </section>\n\n        <section class=\"controls\">\n            <div class=\"panel\">\n                <h3>Circuit Parameters</h3>\n                \n                <div class=\"control-group\">\n                    <label>Input Voltage ($V_{in}$): <span id=\"val-vin\" class=\"readout\">5.0</span> V</label>\n                    <input type=\"range\" id=\"slider-vin\" min=\"0\" max=\"50\" step=\"0.5\" value=\"5\">\n                </div>\n\n                <div class=\"control-group\">\n                    <label>Resistance ($R$): <span id=\"val-r\" class=\"readout\">1.00 k</span>&Omega;</label>\n                    <input type=\"range\" id=\"slider-r\" min=\"0\" max=\"100\" step=\"0.1\" value=\"33\"> \n                </div>\n\n                <div class=\"control-group\">\n                    <label>Capacitance ($C$): <span id=\"val-c\" class=\"readout\">100</span> &mu;F</label>\n                    <input type=\"range\" id=\"slider-c\" min=\"0\" max=\"100\" step=\"0.1\" value=\"60\">\n                </div>\n\n                <div class=\"btn-group\">\n                    <button id=\"btn-reset\" class=\"primary-btn\">Step Input (Reset t=0)</button>\n                    <button id=\"btn-pause\" class=\"secondary-btn\">Pause</button>\n                </div>\n            </div>\n\n            <div class=\"panel data-panel\">\n                <h3>Live Readings</h3>\n                <div class=\"data-row\">\n                    <span>Time ($t$):</span> <span id=\"out-time\">0.00</span> s\n                </div>\n                <div class=\"data-row\">\n                    <span>Time Constant ($\\tau = RC$):</span> <span id=\"out-tau\">--</span> s\n                </div>\n                <div class=\"data-row\">\n                    <span>Capacitor Voltage ($v_c$):</span> <span id=\"out-vc\" class=\"highlight-v\">--</span> V\n                </div>\n                <div class=\"data-row\">\n                    <span>Capacitor Current ($i_c$):</span> <span id=\"out-ic\" class=\"highlight-i\">--</span> A\n                </div>\n            </div>\n        </section>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-color: #f0f2f5;\n    --panel-bg: #ffffff;\n    --accent-blue: #007bff;\n    --accent-green: #28a745;\n    --voltage-color: #e74c3c;\n    --current-color: #f1c40f;\n    --text-color: #333;\n    --border-radius: 8px;\n}\n\nbody {\n    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-color);\n    margin: 0;\n    padding: 20px;\n    color: var(--text-color);\n    display: flex;\n    justify-content: center;\n}\n\n.main-container {\n    max-width: 1000px;\n    width: 100%;\n    background: var(--panel-bg);\n    border-radius: var(--border-radius);\n    box-shadow: 0 4px 20px rgba(0,0,0,0.1);\n    overflow: hidden;\n}\n\nheader {\n    background: #343a40;\n    color: #fff;\n    padding: 20px;\n    text-align: center;\n}\n\nheader h1 { margin: 0; font-size: 1.5rem; }\nheader p { margin: 5px 0 0; opacity: 0.8; font-size: 0.9rem; }\n\n.sim-grid {\n    display: flex;\n    flex-wrap: wrap;\n    min-height: 500px;\n}\n\n/* Visualizer Section */\n.visualizer {\n    flex: 2;\n    min-width: 350px;\n    background: #212529; /* Dark oscilloscope background */\n    padding: 10px;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    border-right: 1px solid #dee2e6;\n}\n\ncanvas {\n    background: #000;\n    border: 2px solid #444;\n    border-radius: 4px;\n    width: 100%;\n    max-width: 600px;\n}\n\n.legend {\n    margin-top: 10px;\n    color: #ccc;\n    font-size: 0.9rem;\n    display: flex;\n    gap: 20px;\n}\n\n.legend-item { display: flex; align-items: center; gap: 5px; }\n.color-box { width: 12px; height: 12px; border-radius: 2px; }\n.voltage { background-color: var(--voltage-color); }\n.current { background-color: var(--current-color); }\n\n/* Controls Section */\n.controls {\n    flex: 1;\n    min-width: 300px;\n    padding: 20px;\n    background: #fff;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.panel h3 {\n    margin-top: 0;\n    border-bottom: 2px solid var(--accent-blue);\n    padding-bottom: 5px;\n    font-size: 1.1rem;\n    color: #495057;\n}\n\n.control-group { margin-bottom: 15px; }\n\nlabel {\n    display: block;\n    font-weight: 600;\n    margin-bottom: 5px;\n    font-size: 0.9rem;\n}\n\n.readout {\n    color: var(--accent-blue);\n    font-family: 'Courier New', monospace;\n    font-weight: bold;\n}\n\ninput[type=\"range\"] { width: 100%; cursor: pointer; }\n\n.btn-group { display: flex; gap: 10px; margin-top: 10px; }\n\nbutton {\n    flex: 1;\n    padding: 10px;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-weight: 600;\n    transition: filter 0.2s;\n}\n\n.primary-btn { background: var(--accent-blue); color: white; }\n.secondary-btn { background: #6c757d; color: white; }\nbutton:hover { filter: brightness(0.9); }\n\n/* Data Panel */\n.data-panel {\n    background: #f8f9fa;\n    padding: 15px;\n    border-radius: 4px;\n    border: 1px solid #e9ecef;\n}\n\n.data-row {\n    display: flex;\n    justify-content: space-between;\n    padding: 5px 0;\n    border-bottom: 1px dashed #ced4da;\n    font-size: 0.9rem;\n}\n\n.highlight-v { color: var(--voltage-color); font-weight: bold; }\n.highlight-i { color: #d4ac0d; font-weight: bold; } /* darker yellow for white bg */\n\n@media (max-width: 768px) {\n    .sim-grid { flex-direction: column; }\n    .visualizer { border-right: none; border-bottom: 1px solid #dee2e6; }\n}", "js": "/**\n * S03 RC Low-Pass Step Response Simulation\n * Handles physics calculations, logarithmic slider mapping, and canvas rendering.\n */\n\n// --- Configuration ---\nconst CONFIG = {\n    // Logarithmic ranges for sliders (0-100 input mapped to these exponentials)\n    R_MIN_POW: 1,   // 10^1 = 10 Ohm\n    R_MAX_POW: 7,   // 10^7 = 10 MOhm\n    C_MIN_POW: -9,  // 10^-9 = 1 nF\n    C_MAX_POW: -1,  // 10^-1 = 0.1 F\n    \n    // Animation\n    timeScale: 50,  // pixels per second (variable, will adjust dynamically)\n    maxHistory: 600 // pixels\n};\n\n// --- State ---\nlet state = {\n    Vin: 5.0,\n    R: 1000,\n    C: 0.0001,\n    t: 0,\n    running: true,\n    history: [] // Array of {t, vc, ic}\n};\n\n// --- DOM Elements ---\nconst canvas = document.getElementById('simCanvas');\nconst ctx = canvas.getContext('2d');\n\nconst els = {\n    vin: { slider: document.getElementById('slider-vin'), display: document.getElementById('val-vin') },\n    r:   { slider: document.getElementById('slider-r'),   display: document.getElementById('val-r') },\n    c:   { slider: document.getElementById('slider-c'),   display: document.getElementById('val-c') },\n    out: {\n        time: document.getElementById('out-time'),\n        tau:  document.getElementById('out-tau'),\n        vc:   document.getElementById('out-vc'),\n        ic:   document.getElementById('out-ic')\n    },\n    btn: {\n        reset: document.getElementById('btn-reset'),\n        pause: document.getElementById('btn-pause')\n    }\n};\n\n// --- Helper Functions ---\n\n// Convert slider value (0-100) to Logarithmic value\nfunction logScale(value, minPow, maxPow) {\n    const min = minPow;\n    const max = maxPow;\n    const power = min + (value / 100) * (max - min);\n    return Math.pow(10, power);\n}\n\n// Format numbers nicely (e.g., 0.000001 -> 1.00 u)\nfunction formatEng(num, unit) {\n    if (num === 0) return \"0 \" + unit;\n    const prefixes = [\n        { val: 1e6, sym: 'M' },\n        { val: 1e3, sym: 'k' },\n        { val: 1,   sym: '' },\n        { val: 1e-3, sym: 'm' },\n        { val: 1e-6, sym: '&mu;' },\n        { val: 1e-9, sym: 'n' }\n    ];\n    \n    for (let p of prefixes) {\n        if (Math.abs(num) >= p.val) {\n            return (num / p.val).toFixed(2) + \" \" + p.sym + unit;\n        }\n    }\n    return num.toExponential(2) + \" \" + unit;\n}\n\n// --- Physics Engine ---\n\nfunction updatePhysics(dt) {\n    if (!state.running) return;\n\n    state.t += dt;\n\n    const tau = state.R * state.C; // Time constant\n    \n    // Equations provided:\n    // vc(t) = Vin * (1 - exp(-t/tau))\n    // ic(t) = (Vin/R) * exp(-t/tau)\n    \n    const vc = state.Vin * (1 - Math.exp(-state.t / tau));\n    const ic = (state.Vin / state.R) * Math.exp(-state.t / tau);\n\n    // Update history for graphing\n    state.history.push({ t: state.t, vc: vc, ic: ic });\n    \n    // Prune history to keep performance high\n    if (state.history.length > 1000) state.history.shift();\n\n    updateUI(vc, ic, tau);\n}\n\nfunction updateUI(vc, ic, tau) {\n    els.out.time.innerText = state.t.toFixed(3);\n    els.out.tau.innerText = formatEng(tau, 's');\n    els.out.vc.innerText = vc.toFixed(2);\n    els.out.ic.innerText = formatEng(ic, 'A');\n}\n\n// --- Rendering ---\n\nfunction draw() {\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    // 1. Draw Circuit Schematic (Top Half)\n    drawSchematic();\n\n    // 2. Draw Graph (Bottom Half)\n    drawGraph();\n\n    requestAnimationFrame(renderLoop);\n}\n\nfunction drawSchematic() {\n    const cx = canvas.width / 2;\n    const cy = 100; // Center Y for schematic\n    const w = 200;  // Width of circuit box\n    const h = 80;   // Height of circuit box\n\n    ctx.lineWidth = 2;\n    ctx.strokeStyle = '#fff';\n    ctx.lineJoin = 'round';\n\n    // Wires\n    ctx.beginPath();\n    ctx.moveTo(cx - w/2, cy + h/2); // Bottom left\n    ctx.lineTo(cx - w/2, cy - h/2); // Top left (Source)\n    ctx.lineTo(cx, cy - h/2);       // Top middle (Resistor start)\n    \n    // Resistor Symbol (Zigzag)\n    const rStart = cx - 30;\n    const rEnd = cx + 30;\n    ctx.moveTo(cx - w/2, cy - h/2);\n    ctx.lineTo(rStart, cy - h/2);\n    \n    // Simple resistor box for clarity or zigzag\n    ctx.lineTo(rStart + 5, cy - h/2 - 10);\n    ctx.lineTo(rStart + 15, cy - h/2 + 10);\n    ctx.lineTo(rStart + 25, cy - h/2 - 10);\n    ctx.lineTo(rStart + 35, cy - h/2 + 10);\n    ctx.lineTo(rStart + 45, cy - h/2 - 10);\n    ctx.lineTo(rStart + 55, cy - h/2 + 10);\n    ctx.lineTo(rEnd, cy - h/2);\n    \n    ctx.lineTo(cx + w/2, cy - h/2); // Top right\n    ctx.lineTo(cx + w/2, cy + h/2); // Bottom right (Capacitor)\n    ctx.lineTo(cx - w/2, cy + h/2); // Bottom wire loop\n    ctx.stroke();\n\n    // Capacitor Symbol\n    const capX = cx + w/2;\n    const capY = cy; // Middle of right vertical wire\n    \n    // Clear wire behind capacitor\n    ctx.clearRect(capX - 10, cy - 15, 20, 30);\n    \n    // Draw Plates\n    ctx.beginPath();\n    ctx.moveTo(capX - 15, cy - 5);\n    ctx.lineTo(capX + 15, cy - 5); // Top plate\n    ctx.moveTo(capX - 15, cy + 5);\n    ctx.lineTo(capX + 15, cy + 5); // Bottom plate\n    ctx.stroke();\n\n    // Dynamic Charge Visualization on Capacitor\n    // Fill \"virtual\" area inside capacitor based on % of max voltage\n    const chargePercent = (state.history.length > 0) \n        ? state.history[state.history.length-1].vc / state.Vin \n        : 0;\n    \n    if (chargePercent > 0.01) {\n        ctx.fillStyle = `rgba(231, 76, 60, ${chargePercent})`; // Red glow\n        ctx.fillRect(capX - 15, cy - 5, 30, 2); // Top plate glow\n        ctx.fillStyle = `rgba(52, 152, 219, ${chargePercent})`; // Blue glow (ground/neg)\n        ctx.fillRect(capX - 15, cy + 5, 30, 2); // Bottom plate glow\n    }\n\n    // Labels\n    ctx.fillStyle = '#aaa';\n    ctx.font = '14px sans-serif';\n    ctx.fillText(`Vin: ${state.Vin}V`, cx - w/2 - 40, cy);\n    ctx.fillText(\"R\", cx - 5, cy - h/2 - 15);\n    ctx.fillText(\"C\", cx + w/2 + 10, cy);\n}\n\nfunction drawGraph() {\n    const margin = 40;\n    const graphH = 150;\n    const graphY = 220; // Top of graph area\n    const w = canvas.width - margin * 2;\n    const bottomY = graphY + graphH;\n\n    // Background\n    ctx.fillStyle = '#111';\n    ctx.fillRect(margin, graphY, w, graphH);\n\n    // Grid lines\n    ctx.strokeStyle = '#333';\n    ctx.lineWidth = 1;\n    ctx.beginPath();\n    for(let i=0; i<=4; i++) {\n        let y = graphY + (graphH * i / 4);\n        ctx.moveTo(margin, y);\n        ctx.lineTo(margin + w, y);\n    }\n    ctx.stroke();\n\n    if (state.history.length < 2) return;\n\n    // Define X scale: Show last 5 * Tau or minimum 2 seconds\n    const tau = state.R * state.C;\n    const displayWindow = Math.max(5 * tau, 0.1); // Time window in seconds\n    const endTime = state.t;\n    const startTime = Math.max(0, endTime - displayWindow);\n\n    // Y Scales\n    const maxY_V = Math.max(state.Vin, 0.1); // Voltage max\n    const maxY_I = Math.max(state.Vin/state.R, 1e-9); // Current max\n\n    // Helper to map coordinates\n    const mapX = (t) => margin + ((t - startTime) / displayWindow) * w;\n    const mapY_V = (v) => bottomY - (v / maxY_V) * graphH;\n    const mapY_I = (i) => bottomY - (i / maxY_I) * graphH;\n\n    // Draw Voltage (Red)\n    ctx.beginPath();\n    ctx.strokeStyle = '#e74c3c';\n    ctx.lineWidth = 2;\n    let started = false;\n    for (let p of state.history) {\n        if (p.t < startTime) continue;\n        const x = mapX(p.t);\n        const y = mapY_V(p.vc);\n        if (!started) { ctx.moveTo(x, y); started = true; }\n        else { ctx.lineTo(x, y); }\n    }\n    ctx.stroke();\n\n    // Draw Current (Yellow)\n    ctx.beginPath();\n    ctx.strokeStyle = '#f1c40f';\n    ctx.lineWidth = 2;\n    started = false;\n    for (let p of state.history) {\n        if (p.t < startTime) continue;\n        const x = mapX(p.t);\n        const y = mapY_I(p.ic);\n        if (!started) { ctx.moveTo(x, y); started = true; }\n        else { ctx.lineTo(x, y); }\n    }\n    ctx.stroke();\n    \n    // Labels for Y-axis\n    ctx.fillStyle = '#fff';\n    ctx.font = '10px monospace';\n    ctx.fillText(`${maxY_V.toFixed(1)}V`, margin - 30, graphY + 10);\n    ctx.fillText(`${formatEng(maxY_I, 'A')}`, margin - 35, graphY + 25);\n    ctx.fillStyle = '#e74c3c';\n    ctx.fillText(\"Voltage\", margin + 10, graphY + 20);\n    ctx.fillStyle = '#f1c40f';\n    ctx.fillText(\"Current\", margin + 60, graphY + 20);\n}\n\n// --- Interaction Loop ---\n\nlet lastTime = 0;\n\nfunction renderLoop(timestamp) {\n    if (!lastTime) lastTime = timestamp;\n    const dt = (timestamp - lastTime) / 1000;\n    lastTime = timestamp;\n\n    updatePhysics(dt);\n    draw();\n}\n\n// --- Event Listeners ---\n\nfunction updateInputs() {\n    state.Vin = parseFloat(els.vin.slider.value);\n    \n    // Logarithmic conversion for R and C\n    state.R = logScale(parseFloat(els.r.slider.value), CONFIG.R_MIN_POW, CONFIG.R_MAX_POW);\n    state.C = logScale(parseFloat(els.c.slider.value), CONFIG.C_MIN_POW, CONFIG.C_MAX_POW);\n\n    // Update displays\n    els.vin.display.textContent = state.Vin.toFixed(1);\n    els.r.display.textContent = formatEng(state.R, \"\\u03A9\");\n    els.c.display.textContent = formatEng(state.C, \"F\");\n}\n\n// Attach listeners\n[els.vin.slider, els.r.slider, els.c.slider].forEach(input => {\n    input.addEventListener('input', updateInputs);\n});\n\nels.btn.reset.addEventListener('click', () => {\n    state.t = 0;\n    state.history = [];\n    state.running = true;\n    els.btn.pause.innerText = \"Pause\";\n});\n\nels.btn.pause.addEventListener('click', () => {\n    state.running = !state.running;\n    els.btn.pause.innerText = state.running ? \"Pause\" : \"Resume\";\n});\n\n// Init\nupdateInputs();\nrequestAnimationFrame(renderLoop);"}}
{"input": {"input_text": "Ecology handout: logistic growth dP/dt = r*P*(1 - P/K). Provide closed-form solution and enforce positive bounds. Initial population P0.", "simulation_name": " Logistic Growth", "domain": "Biology", "description": "Single-species logistic population model", "assumptions": ["Well-mixed population"], "entities": [{"name": "population", "count": {"symbol": "P0", "unit": "individuals", "range": [1, 1000000.0]}}], "constants": [], "parameters": [{"name": "growth_rate", "symbol": "r", "unit": "1/time", "range": [0.0001, 2]}, {"name": "carrying_capacity", "symbol": "K", "unit": "individuals", "range": [100, 10000000.0]}], "equations": [{"description": "Logistic ODE", "expression": "dPdt = r*P*(1 - P/K)"}, {"description": "Closed form", "expression": "P(t) = K / (1 + ((K - P0)/P0)*exp(-r*t))"}], "initial_conditions": {"P": "P0", "t": 0}, "outputs": ["P"], "simulation_controls": ["r", "K", "P0"], "constraints": ["K > 0", "P0 > 0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S04: Logistic Growth Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n\n<div class=\"main-container\">\n    <header>\n        <h1>S04: Logistic Population Growth</h1>\n        <p class=\"subtitle\">Dynamics of a single species approaching carrying capacity ($K$)</p>\n    </header>\n\n    <div class=\"simulation-layout\">\n        \n        <section class=\"vis-panel\">\n            <div class=\"canvas-wrapper\">\n                <h3>Population View (Petri Dish)</h3>\n                <canvas id=\"petriCanvas\" width=\"400\" height=\"400\"></canvas>\n                <div class=\"legend\">\n                    <span class=\"dot\"></span> Individual Organism\n                </div>\n            </div>\n            \n            <div class=\"graph-wrapper\">\n                <h3>Population over Time</h3>\n                <canvas id=\"graphCanvas\" width=\"400\" height=\"200\"></canvas>\n            </div>\n        </section>\n\n        <section class=\"control-panel\">\n            \n            <div class=\"controls\">\n                <h2>Parameters</h2>\n\n                <div class=\"input-group\">\n                    <label>Carrying Capacity ($K$)</label>\n                    <input type=\"range\" id=\"slider-K\" min=\"100\" max=\"2000\" step=\"50\" value=\"1000\">\n                    <span class=\"value-display\" id=\"val-K\">1000</span> individuals\n                </div>\n\n                <div class=\"input-group\">\n                    <label>Growth Rate ($r$)</label>\n                    <input type=\"range\" id=\"slider-r\" min=\"0.1\" max=\"2.0\" step=\"0.1\" value=\"0.8\">\n                    <span class=\"value-display\" id=\"val-r\">0.8</span> /time\n                </div>\n\n                <div class=\"input-group\">\n                    <label>Initial Population ($P_0$)</label>\n                    <input type=\"range\" id=\"slider-P0\" min=\"10\" max=\"500\" step=\"10\" value=\"50\">\n                    <span class=\"value-display\" id=\"val-P0\">50</span> individuals\n                </div>\n\n                <div class=\"button-row\">\n                    <button id=\"btn-reset\" class=\"btn primary\">Reset ($t=0$)</button>\n                    <button id=\"btn-pause\" class=\"btn secondary\">Pause</button>\n                </div>\n            </div>\n\n            <div class=\"readout\">\n                <h2>Live Data</h2>\n                <div class=\"data-row\">\n                    <span>Time ($t$):</span>\n                    <span id=\"out-t\">0.00</span>\n                </div>\n                <div class=\"data-row\">\n                    <span>Population ($P$):</span>\n                    <span id=\"out-P\" class=\"highlight\">--</span>\n                </div>\n                <div class=\"data-row\">\n                    <span>Rate ($dP/dt$):</span>\n                    <span id=\"out-dPdt\">--</span>\n                </div>\n            </div>\n\n            <div class=\"math-box\">\n                <p><strong>Differential Equation:</strong><br>\n                $\\frac{dP}{dt} = rP(1 - \\frac{P}{K})$</p>\n                <p><strong>Solution:</strong><br>\n                $P(t) = \\frac{K}{1 + (\\frac{K - P_0}{P_0})e^{-rt}}$</p>\n            </div>\n\n        </section>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-color: #f4f7f6;\n    --panel-bg: #ffffff;\n    --primary-color: #27ae60; /* Bio Green */\n    --accent-color: #2c3e50;\n    --border-radius: 8px;\n    --dish-color: #e8f8f5;\n    --dish-border: #a2d9ce;\n}\n\nbody {\n    font-family: 'Segoe UI', Helvetica, Arial, sans-serif;\n    background-color: var(--bg-color);\n    color: #333;\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n}\n\n.main-container {\n    max-width: 1100px;\n    width: 100%;\n    background: var(--panel-bg);\n    box-shadow: 0 4px 15px rgba(0,0,0,0.08);\n    border-radius: var(--border-radius);\n    overflow: hidden;\n}\n\nheader {\n    background-color: var(--accent-color);\n    color: white;\n    padding: 20px;\n    text-align: center;\n}\n\nheader h1 { margin: 0; font-size: 1.6rem; }\n.subtitle { margin: 5px 0 0; opacity: 0.8; font-weight: 300; }\n\n/* Layout Grid */\n.simulation-layout {\n    display: flex;\n    flex-wrap: wrap;\n}\n\n/* Visualization Panel */\n.vis-panel {\n    flex: 3;\n    min-width: 350px;\n    padding: 20px;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    border-right: 1px solid #eee;\n}\n\n.canvas-wrapper {\n    margin-bottom: 20px;\n    text-align: center;\n}\n\n.canvas-wrapper h3, .graph-wrapper h3 {\n    margin-top: 0;\n    color: #7f8c8d;\n    font-size: 1rem;\n    text-transform: uppercase;\n    letter-spacing: 1px;\n}\n\n#petriCanvas {\n    background-color: var(--dish-color);\n    border: 4px solid var(--dish-border);\n    border-radius: 50%; /* Petri dish shape */\n    box-shadow: inset 0 0 20px rgba(0,0,0,0.05);\n    cursor: crosshair;\n}\n\n#graphCanvas {\n    background-color: #fff;\n    border: 1px solid #ddd;\n    border-radius: 4px;\n}\n\n.legend {\n    margin-top: 5px;\n    font-size: 0.85rem;\n    color: #666;\n}\n.dot {\n    display: inline-block;\n    width: 10px;\n    height: 10px;\n    background-color: var(--primary-color);\n    border-radius: 50%;\n    margin-right: 5px;\n}\n\n/* Control Panel */\n.control-panel {\n    flex: 2;\n    min-width: 300px;\n    padding: 25px;\n    background-color: #fdfdfd;\n}\n\nh2 {\n    font-size: 1.2rem;\n    color: var(--accent-color);\n    border-bottom: 2px solid var(--primary-color);\n    padding-bottom: 5px;\n    margin-bottom: 20px;\n}\n\n.input-group {\n    margin-bottom: 20px;\n}\n\nlabel {\n    display: block;\n    font-weight: 600;\n    margin-bottom: 8px;\n    font-size: 0.9rem;\n}\n\ninput[type=range] {\n    width: 100%;\n    cursor: pointer;\n}\n\n.value-display {\n    float: right;\n    font-family: 'Courier New', monospace;\n    color: var(--primary-color);\n    font-weight: bold;\n}\n\n.button-row {\n    display: flex;\n    gap: 10px;\n    margin-top: 10px;\n}\n\n.btn {\n    flex: 1;\n    padding: 10px;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 0.9rem;\n    font-weight: 600;\n    transition: background 0.2s;\n}\n\n.primary { background-color: var(--primary-color); color: white; }\n.primary:hover { background-color: #219150; }\n\n.secondary { background-color: #bdc3c7; color: #2c3e50; }\n.secondary:hover { background-color: #a6acaf; }\n\n/* Readout & Math */\n.readout {\n    background-color: #fff;\n    padding: 15px;\n    border: 1px solid #e0e0e0;\n    border-radius: 4px;\n    margin-top: 30px;\n}\n\n.data-row {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 8px;\n    font-size: 0.95rem;\n}\n\n.highlight {\n    color: var(--primary-color);\n    font-weight: bold;\n    font-size: 1.1rem;\n}\n\n.math-box {\n    margin-top: 20px;\n    padding: 15px;\n    background-color: #edf7ed;\n    border-left: 4px solid var(--primary-color);\n    font-family: 'Times New Roman', serif;\n    font-style: italic;\n    font-size: 1rem;\n}\n\n.math-box p { margin: 10px 0; }\n\n@media (max-width: 800px) {\n    .simulation-layout { flex-direction: column; }\n    .vis-panel { border-right: none; border-bottom: 1px solid #eee; }\n    #petriCanvas { width: 300px; height: 300px; }\n}", "js": "/**\n * S04: Logistic Growth Simulation\n * Domain: Biology / Ecology\n * Description: Interactive simulation of population dynamics approaching carrying capacity.\n */\n\n// --- Configuration ---\nconst CANVAS_SIZE = 400; // Petri dish canvas size\nconst GRAPH_WIDTH = 400;\nconst GRAPH_HEIGHT = 200;\nconst MAX_PARTICLES = 1500; // Cap visual particles for performance\n\n// --- State Management ---\nconst state = {\n    K: 1000,      // Carrying Capacity\n    r: 0.8,       // Growth Rate\n    P0: 50,       // Initial Population\n    t: 0,         // Time\n    running: true,\n    history: [],  // Data history for graphing\n    particles: [] // Visual particles {x, y, v}\n};\n\n// --- DOM Elements ---\nconst dom = {\n    canvas: document.getElementById('petriCanvas'),\n    graph: document.getElementById('graphCanvas'),\n    \n    // Sliders\n    sliderK: document.getElementById('slider-K'),\n    sliderR: document.getElementById('slider-r'),\n    sliderP0: document.getElementById('slider-P0'),\n    \n    // Values\n    valK: document.getElementById('val-K'),\n    valR: document.getElementById('val-r'),\n    valP0: document.getElementById('val-P0'),\n    \n    // Outputs\n    outT: document.getElementById('out-t'),\n    outP: document.getElementById('out-P'),\n    outDP: document.getElementById('out-dPdt'),\n    \n    // Buttons\n    btnReset: document.getElementById('btn-reset'),\n    btnPause: document.getElementById('btn-pause')\n};\n\nconst ctx = dom.canvas.getContext('2d');\nconst graphCtx = dom.graph.getContext('2d');\n\n// --- Physics / Math Engine ---\n\nfunction calculatePopulation(t) {\n    // Closed form solution: P(t) = K / (1 + ((K - P0)/P0) * exp(-rt))\n    const numerator = state.K;\n    const A = (state.K - state.P0) / state.P0;\n    const denominator = 1 + A * Math.exp(-state.r * t);\n    return numerator / denominator;\n}\n\nfunction calculateRate(P) {\n    // dP/dt = rP(1 - P/K)\n    return state.r * P * (1 - P / state.K);\n}\n\n// --- Particle System (Visuals) ---\n\nfunction initParticles() {\n    state.particles = [];\n    // Only spawn particles up to current P (or MAX_PARTICLES)\n    updateParticleCount(state.P0);\n}\n\nfunction updateParticleCount(currentP) {\n    const targetCount = Math.min(Math.floor(currentP), MAX_PARTICLES);\n    const center = CANVAS_SIZE / 2;\n    const radius = (CANVAS_SIZE / 2) - 10; // Stay inside dish\n\n    // Add particles if needed\n    while (state.particles.length < targetCount) {\n        // Random position within circle\n        const angle = Math.random() * Math.PI * 2;\n        const r = Math.sqrt(Math.random()) * radius; // Uniform distribution in circle\n        \n        state.particles.push({\n            x: center + r * Math.cos(angle),\n            y: center + r * Math.sin(angle),\n            vx: (Math.random() - 0.5) * 0.5, // Tiny jitter movement\n            vy: (Math.random() - 0.5) * 0.5\n        });\n    }\n\n    // Remove particles if population dropped (e.g. user lowered K/P0)\n    if (state.particles.length > targetCount) {\n        state.particles.length = targetCount;\n    }\n}\n\nfunction drawPetriDish() {\n    ctx.clearRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);\n    \n    // Particles\n    ctx.fillStyle = '#27ae60';\n    for (let p of state.particles) {\n        // Jitter\n        p.x += (Math.random() - 0.5);\n        p.y += (Math.random() - 0.5);\n\n        // Draw Dot\n        ctx.beginPath();\n        ctx.arc(p.x, p.y, 2, 0, Math.PI * 2);\n        ctx.fill();\n    }\n}\n\n// --- Graphing ---\n\nfunction drawGraph() {\n    graphCtx.clearRect(0, 0, GRAPH_WIDTH, GRAPH_HEIGHT);\n\n    // Draw Axes\n    graphCtx.strokeStyle = '#ccc';\n    graphCtx.beginPath();\n    graphCtx.moveTo(40, 10);\n    graphCtx.lineTo(40, GRAPH_HEIGHT - 20); // Y axis\n    graphCtx.lineTo(GRAPH_WIDTH - 10, GRAPH_HEIGHT - 20); // X axis\n    graphCtx.stroke();\n\n    // Draw K Line (Dashed)\n    const kY = (GRAPH_HEIGHT - 20) - (state.K / 2000) * (GRAPH_HEIGHT - 40); \n    // Scaling: Max K is 2000 on slider, so we map 0-2000 to graph height\n    \n    if (kY > 0) {\n        graphCtx.setLineDash([5, 5]);\n        graphCtx.strokeStyle = '#e74c3c';\n        graphCtx.beginPath();\n        graphCtx.moveTo(40, kY);\n        graphCtx.lineTo(GRAPH_WIDTH - 10, kY);\n        graphCtx.stroke();\n        graphCtx.setLineDash([]);\n        \n        // Label K\n        graphCtx.fillStyle = '#e74c3c';\n        graphCtx.font = '10px sans-serif';\n        graphCtx.fillText('K', 25, kY + 3);\n    }\n\n    if (state.history.length < 2) return;\n\n    // Plot Curve\n    graphCtx.strokeStyle = '#27ae60';\n    graphCtx.lineWidth = 2;\n    graphCtx.beginPath();\n\n    const maxTime = Math.max(10, state.history[state.history.length-1].t);\n    \n    // Map function\n    const mapX = (t) => 40 + (t / maxTime) * (GRAPH_WIDTH - 60);\n    const mapY = (p) => (GRAPH_HEIGHT - 20) - (p / 2000) * (GRAPH_HEIGHT - 40);\n\n    let first = true;\n    for (let point of state.history) {\n        const x = mapX(point.t);\n        const y = mapY(point.p);\n        \n        if (first) {\n            graphCtx.moveTo(x, y);\n            first = false;\n        } else {\n            graphCtx.lineTo(x, y);\n        }\n    }\n    graphCtx.stroke();\n}\n\n// --- Main Loop ---\n\nlet lastTime = 0;\nfunction animate(timestamp) {\n    if (!lastTime) lastTime = timestamp;\n    const dt = (timestamp - lastTime) / 1000;\n    lastTime = timestamp;\n\n    if (state.running) {\n        state.t += dt; // Real-time\n        \n        const currentP = calculatePopulation(state.t);\n        const rate = calculateRate(currentP);\n\n        // Update Data\n        state.history.push({ t: state.t, p: currentP });\n        \n        // Update Particles (every few frames to save performance if needed, but per-frame is smoother)\n        updateParticleCount(currentP);\n\n        // DOM Updates\n        dom.outT.textContent = state.t.toFixed(2);\n        dom.outP.textContent = Math.floor(currentP);\n        dom.outDP.textContent = rate.toFixed(2);\n    }\n\n    drawPetriDish();\n    drawGraph();\n\n    requestAnimationFrame(animate);\n}\n\n// --- Event Listeners ---\n\nfunction updateInputs() {\n    state.K = parseFloat(dom.sliderK.value);\n    state.r = parseFloat(dom.sliderR.value);\n    \n    // Changing P0 usually requires a reset to make sense mathematically on the graph\n    // But for interactivity, we can just update the variable. \n    // Note: If t > 0, changing P0 shifts the whole curve.\n    state.P0 = parseFloat(dom.sliderP0.value);\n\n    // Update Labels\n    dom.valK.textContent = state.K;\n    dom.valR.textContent = state.r;\n    dom.valP0.textContent = state.P0;\n}\n\n[dom.sliderK, dom.sliderR, dom.sliderP0].forEach(el => {\n    el.addEventListener('input', () => {\n        updateInputs();\n        // Recalculate whole history based on new params to keep graph consistent?\n        // Or just let it evolve? Let's reset history on param change for clarity.\n        state.t = 0;\n        state.history = [];\n        initParticles();\n    });\n});\n\ndom.btnReset.addEventListener('click', () => {\n    state.t = 0;\n    state.history = [];\n    initParticles();\n    state.running = true;\n    dom.btnPause.textContent = \"Pause\";\n});\n\ndom.btnPause.addEventListener('click', () => {\n    state.running = !state.running;\n    dom.btnPause.textContent = state.running ? \"Pause\" : \"Resume\";\n});\n\n// Init\nupdateInputs();\ninitParticles();\nrequestAnimationFrame(animate);"}}
{"input": {"input_text": "Epidemiology slide: SIR with total population N = S + I + R. dS/dt = -beta*S*I/N; dI/dt = beta*S*I/N - gamma*I; dR/dt = gamma*I. Include initial S0, I0, R0.", "simulation_name": " SIR Epidemic", "domain": "Biology", "description": "Deterministic SIR compartment model", "assumptions": ["Homogeneous mixing", "Constant population"], "entities": [{"name": "population", "count": {"symbol": "N", "unit": "individuals", "range": [100, 100000000.0]}}], "constants": [], "parameters": [{"name": "transmission_rate", "symbol": "beta", "unit": "1/time", "range": [0.0001, 5]}, {"name": "recovery_rate", "symbol": "gamma", "unit": "1/time", "range": [0.0001, 2]}, {"name": "initial_infected", "symbol": "I0", "unit": "individuals", "range": [1, 1000000.0]}, {"name": "initial_recovered", "symbol": "R0", "unit": "individuals", "range": [0, 1000000.0]}], "equations": [{"description": "Susceptible", "expression": "dSdt = -beta*S*I/N"}, {"description": "Infected", "expression": "dIdt = beta*S*I/N - gamma*I"}, {"description": "Recovered", "expression": "dRdt = gamma*I"}], "initial_conditions": {"S": "N - I0 - R0", "I": "I0", "R": "R0", "t": 0}, "outputs": ["S", "I", "R"], "simulation_controls": ["beta", "gamma", "I0", "R0", "N"], "constraints": ["I0 + R0 <= N"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S05: SIR Epidemic Model</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n\n<div class=\"main-container\">\n    <header>\n        <h1>S05: SIR Epidemic Model</h1>\n        <p>Deterministic Compartmental Model: <strong>S</strong>usceptible &rarr; <strong>I</strong>nfected &rarr; <strong>R</strong>ecovered</p>\n    </header>\n\n    <div class=\"sim-grid\">\n        <section class=\"visuals\">\n            <div class=\"canvas-container\">\n                <h3>Population Sample (Homogeneous Mixing)</h3>\n                <canvas id=\"popCanvas\" width=\"400\" height=\"300\"></canvas>\n            </div>\n            <div class=\"canvas-container\">\n                <h3>Infection Curves</h3>\n                <canvas id=\"graphCanvas\" width=\"400\" height=\"200\"></canvas>\n            </div>\n            <div class=\"legend\">\n                <span class=\"badge sus\">Susceptible (S)</span>\n                <span class=\"badge inf\">Infected (I)</span>\n                <span class=\"badge rec\">Recovered (R)</span>\n            </div>\n        </section>\n\n        <section class=\"controls\">\n            <div class=\"panel\">\n                <h2>Parameters</h2>\n                \n                <div class=\"control-group\">\n                    <label>Total Population ($N$)</label>\n                    <input type=\"range\" id=\"slider-N\" min=\"500\" max=\"10000\" step=\"100\" value=\"2000\">\n                    <span class=\"readout\" id=\"val-N\">2000</span>\n                </div>\n\n                <div class=\"control-group\">\n                    <label>Transmission Rate ($\\beta$)</label>\n                    <input type=\"range\" id=\"slider-beta\" min=\"0.1\" max=\"5.0\" step=\"0.1\" value=\"1.5\">\n                    <span class=\"readout\" id=\"val-beta\">1.5</span>\n                </div>\n\n                <div class=\"control-group\">\n                    <label>Recovery Rate ($\\gamma$)</label>\n                    <input type=\"range\" id=\"slider-gamma\" min=\"0.01\" max=\"2.0\" step=\"0.01\" value=\"0.3\">\n                    <span class=\"readout\" id=\"val-gamma\">0.3</span>\n                </div>\n\n                <div class=\"control-group\">\n                    <label>Initial Infected ($I_0$)</label>\n                    <input type=\"range\" id=\"slider-I0\" min=\"1\" max=\"100\" step=\"1\" value=\"10\">\n                    <span class=\"readout\" id=\"val-I0\">10</span>\n                </div>\n\n                <div class=\"actions\">\n                    <button id=\"btn-restart\" class=\"primary-btn\">Restart Simulation</button>\n                    <button id=\"btn-pause\" class=\"secondary-btn\">Pause</button>\n                </div>\n            </div>\n\n            <div class=\"panel stats\">\n                <h2>Live Statistics</h2>\n                <div class=\"stat-row\">\n                    <span>Time ($t$):</span> <span id=\"out-t\">0.0</span>\n                </div>\n                <div class=\"stat-row\">\n                    <span>Susceptible:</span> <span id=\"out-S\" class=\"txt-sus\">--</span>\n                </div>\n                <div class=\"stat-row\">\n                    <span>Infected:</span> <span id=\"out-I\" class=\"txt-inf\">--</span>\n                </div>\n                <div class=\"stat-row\">\n                    <span>Recovered:</span> <span id=\"out-R\" class=\"txt-rec\">--</span>\n                </div>\n                <hr>\n                <div class=\"stat-row large\">\n                    <span>Basic Repro. Number ($R_0$):</span> \n                    <span id=\"out-R0\">--</span>\n                </div>\n                <small class=\"note\">($R_0 = \\beta / \\gamma$) If $R_0 > 1$, outbreak grows.</small>\n            </div>\n        </section>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-color: #f0f4f8;\n    --panel-bg: #ffffff;\n    --color-s: #3498db; /* Blue */\n    --color-i: #e74c3c; /* Red */\n    --color-r: #7f8c8d; /* Gray */\n    --text-main: #2c3e50;\n    --accent: #2980b9;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-main);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n}\n\n.main-container {\n    max-width: 1000px;\n    width: 100%;\n    background: var(--panel-bg);\n    border-radius: 8px;\n    box-shadow: 0 4px 20px rgba(0,0,0,0.1);\n    overflow: hidden;\n}\n\nheader {\n    background-color: var(--text-main);\n    color: white;\n    padding: 20px;\n    text-align: center;\n}\n\nheader h1 { margin: 0; font-size: 1.5rem; }\nheader p { margin: 5px 0 0; opacity: 0.8; font-weight: 300; }\n\n.sim-grid {\n    display: flex;\n    flex-wrap: wrap;\n}\n\n/* Visualization Section */\n.visuals {\n    flex: 2;\n    min-width: 350px;\n    padding: 20px;\n    background-color: #ecf0f1;\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n    border-right: 1px solid #ddd;\n}\n\n.canvas-container h3 {\n    margin: 0 0 5px 0;\n    font-size: 0.9rem;\n    color: #555;\n    text-transform: uppercase;\n}\n\ncanvas {\n    background: #fff;\n    border: 1px solid #bdc3c7;\n    border-radius: 4px;\n    width: 100%;\n}\n\n.legend {\n    display: flex;\n    justify-content: center;\n    gap: 15px;\n    margin-top: 5px;\n}\n\n.badge {\n    padding: 4px 10px;\n    border-radius: 12px;\n    color: white;\n    font-size: 0.8rem;\n    font-weight: bold;\n}\n.sus { background-color: var(--color-s); }\n.inf { background-color: var(--color-i); }\n.rec { background-color: var(--color-r); }\n\n/* Controls Section */\n.controls {\n    flex: 1;\n    min-width: 300px;\n    padding: 20px;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.panel {\n    background: #fff;\n}\n\nh2 {\n    font-size: 1.2rem;\n    border-bottom: 2px solid var(--accent);\n    padding-bottom: 5px;\n    margin-top: 0;\n    color: var(--text-main);\n}\n\n.control-group { margin-bottom: 15px; }\n\nlabel {\n    display: block;\n    font-weight: 600;\n    font-size: 0.9rem;\n    margin-bottom: 5px;\n}\n\ninput[type=range] { width: 100%; cursor: pointer; }\n\n.readout {\n    float: right;\n    font-family: 'Courier New', monospace;\n    font-weight: bold;\n    color: var(--accent);\n}\n\n.actions {\n    display: flex;\n    gap: 10px;\n    margin-top: 20px;\n}\n\nbutton {\n    flex: 1;\n    padding: 10px;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-weight: 600;\n}\n\n.primary-btn { background-color: var(--accent); color: white; }\n.secondary-btn { background-color: #95a5a6; color: white; }\nbutton:hover { opacity: 0.9; }\n\n/* Stats */\n.stats {\n    background-color: #f8f9fa;\n    padding: 15px;\n    border-radius: 4px;\n    border: 1px solid #e0e0e0;\n}\n\n.stat-row {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 8px;\n    font-size: 0.95rem;\n}\n\n.large { font-size: 1.1rem; font-weight: bold; }\n.note { display: block; margin-top: 5px; color: #7f8c8d; font-style: italic; font-size: 0.8rem;}\n\n.txt-sus { color: var(--color-s); font-weight: bold; }\n.txt-inf { color: var(--color-i); font-weight: bold; }\n.txt-rec { color: var(--color-r); font-weight: bold; }\n\n@media (max-width: 800px) {\n    .sim-grid { flex-direction: column; }\n    .visuals { border-right: none; border-bottom: 1px solid #ddd; }\n}", "js": "/**\n * S05: SIR Epidemic Simulation\n * Domain: Biology / Epidemiology\n * Model: Deterministic Compartmental Model (ODE)\n */\n\n// --- Configuration ---\nconst COLORS = {\n    S: '#3498db', // Blue\n    I: '#e74c3c', // Red\n    R: '#7f8c8d'  // Gray\n};\n\nconst SIM_OPTS = {\n    particleCount: 400, // Number of visual dots (representative sample)\n    graphMaxTime: 20,   // Seconds (width of graph)\n    dt: 0.05            // Time step for ODE solver\n};\n\n// --- State Management ---\nlet state = {\n    // Parameters\n    N: 2000,\n    beta: 1.5,\n    gamma: 0.3,\n    I0: 10,\n    R0: 0,\n    \n    // Variables\n    S: 0,\n    I: 0,\n    R: 0,\n    t: 0,\n    \n    running: true,\n    history: [],   // {t, S, I, R}\n    particles: []  // {x, y, vx, vy, status}\n};\n\n// --- DOM Elements ---\nconst canvasPop = document.getElementById('popCanvas');\nconst ctxPop = canvasPop.getContext('2d');\nconst canvasGraph = document.getElementById('graphCanvas');\nconst ctxGraph = canvasGraph.getContext('2d');\n\nconst ui = {\n    sliders: {\n        N: document.getElementById('slider-N'),\n        beta: document.getElementById('slider-beta'),\n        gamma: document.getElementById('slider-gamma'),\n        I0: document.getElementById('slider-I0')\n    },\n    vals: {\n        N: document.getElementById('val-N'),\n        beta: document.getElementById('val-beta'),\n        gamma: document.getElementById('val-gamma'),\n        I0: document.getElementById('val-I0')\n    },\n    out: {\n        t: document.getElementById('out-t'),\n        S: document.getElementById('out-S'),\n        I: document.getElementById('out-I'),\n        R: document.getElementById('out-R'),\n        R0: document.getElementById('out-R0')\n    },\n    btn: {\n        restart: document.getElementById('btn-restart'),\n        pause: document.getElementById('btn-pause')\n    }\n};\n\n// --- Physics / Math Engine ---\n\nfunction initSimulation() {\n    // Set Initial Conditions\n    state.t = 0;\n    state.I = state.I0;\n    state.R = state.R0;\n    state.S = state.N - state.I - state.R;\n    state.history = [];\n    \n    initParticles();\n    state.running = true;\n    ui.btn.pause.textContent = \"Pause\";\n    \n    // Clear history to start graph fresh\n    state.history.push({ t: 0, S: state.S, I: state.I, R: state.R });\n}\n\nfunction solveODE() {\n    // Differential Equations\n    // dS/dt = -beta * S * I / N\n    // dI/dt = (beta * S * I / N) - (gamma * I)\n    // dR/dt = gamma * I\n\n    const { N, beta, gamma, S, I, R } = state;\n\n    const dS = (-beta * S * I / N) * SIM_OPTS.dt;\n    const dI = ((beta * S * I / N) - (gamma * I)) * SIM_OPTS.dt;\n    const dR = (gamma * I) * SIM_OPTS.dt;\n\n    // Euler Integration\n    state.S += dS;\n    state.I += dI;\n    state.R += dR;\n    state.t += SIM_OPTS.dt;\n\n    // Constraints / Floating point cleanup\n    if (state.S < 0) state.S = 0;\n    if (state.I < 0) state.I = 0;\n    if (state.R > state.N) state.R = state.N;\n\n    // Store history\n    state.history.push({\n        t: state.t,\n        S: state.S,\n        I: state.I,\n        R: state.R\n    });\n\n    // Prune history for scrolling effect if needed (optional)\n    if (state.history.length > 500) {\n        // We can shift() here if we want a scrolling window, \n        // but for SIR, seeing the whole curve is usually better.\n        // We will scale the X-axis instead in drawGraph.\n    }\n}\n\n// --- Particle Visualization (Representative Sample) ---\n\nfunction initParticles() {\n    state.particles = [];\n    const w = canvasPop.width;\n    const h = canvasPop.height;\n\n    for (let i = 0; i < SIM_OPTS.particleCount; i++) {\n        state.particles.push({\n            x: Math.random() * w,\n            y: Math.random() * h,\n            vx: (Math.random() - 0.5) * 2,\n            vy: (Math.random() - 0.5) * 2,\n            status: 'S' // Default\n        });\n    }\n    updateParticleStatuses();\n}\n\nfunction updateParticleStatuses() {\n    // The ODE runs on exact numbers N. The visual particles are just a sample size (e.g. 400).\n    // We update the statuses of the particles to statistically match the S/I/R ratios.\n    \n    const totalP = SIM_OPTS.particleCount;\n    const countS = Math.floor((state.S / state.N) * totalP);\n    const countI = Math.floor((state.I / state.N) * totalP);\n    const countR = totalP - countS - countI; // Remainder\n\n    let current = 0;\n    \n    // Assign S\n    for(let i=0; i<countS; i++) state.particles[current++].status = 'S';\n    // Assign I\n    for(let i=0; i<countI; i++) state.particles[current++].status = 'I';\n    // Assign R\n    while(current < totalP) state.particles[current++].status = 'R';\n\n    // Shuffle array slightly so colors don't band together artificially (optional, but looks better)\n    // Actually, simple sorting by status makes it look like they cluster, which is confusing.\n    // Ideally, we don't change the *identity* of the particle, just the color. \n    // But since this is a \"Homogeneous Mixing\" model (soup), spatial position doesn't matter for infection logic.\n    // To make it look natural, we just re-assign colors.\n    \n    // Fisher-Yates shuffle to randomize WHO is infected visually\n    for (let i = state.particles.length - 1; i > 0; i--) {\n        const j = Math.floor(Math.random() * (i + 1));\n        const tempStatus = state.particles[i].status;\n        state.particles[i].status = state.particles[j].status;\n        state.particles[j].status = tempStatus;\n    }\n}\n\nfunction drawParticles() {\n    ctxPop.clearRect(0, 0, canvasPop.width, canvasPop.height);\n    \n    for (let p of state.particles) {\n        // Move\n        p.x += p.vx;\n        p.y += p.vy;\n\n        // Bounce\n        if (p.x < 0 || p.x > canvasPop.width) p.vx *= -1;\n        if (p.y < 0 || p.y > canvasPop.height) p.vy *= -1;\n\n        // Draw\n        ctxPop.fillStyle = COLORS[p.status];\n        ctxPop.beginPath();\n        ctxPop.arc(p.x, p.y, 3, 0, Math.PI * 2);\n        ctxPop.fill();\n    }\n}\n\n// --- Graph Visualization ---\n\nfunction drawGraph() {\n    const w = canvasGraph.width;\n    const h = canvasGraph.height;\n    ctxGraph.clearRect(0, 0, w, h);\n\n    if (state.history.length === 0) return;\n\n    // Scales\n    // Max Time: Either fixed window (20s) or dynamic if simulation runs longer\n    const maxT = Math.max(SIM_OPTS.graphMaxTime, state.t);\n    const maxPop = state.N;\n\n    const mapX = (t) => (t / maxT) * w;\n    const mapY = (val) => h - (val / maxPop) * h;\n\n    // Helper to draw a line\n    function drawLine(key, color) {\n        ctxGraph.strokeStyle = color;\n        ctxGraph.lineWidth = 2;\n        ctxGraph.beginPath();\n        ctxGraph.moveTo(mapX(state.history[0].t), mapY(state.history[0][key]));\n        \n        // Downsample for performance if history is huge\n        const step = Math.ceil(state.history.length / w); \n        \n        for (let i = 0; i < state.history.length; i+=step) {\n            const p = state.history[i];\n            ctxGraph.lineTo(mapX(p.t), mapY(p[key]));\n        }\n        // Ensure last point is drawn\n        const last = state.history[state.history.length-1];\n        ctxGraph.lineTo(mapX(last.t), mapY(last[key]));\n        ctxGraph.stroke();\n    }\n\n    drawLine('S', COLORS.S);\n    drawLine('I', COLORS.I);\n    drawLine('R', COLORS.R);\n}\n\n// --- Main Loop ---\n\nlet lastTime = 0;\n\nfunction animate(timestamp) {\n    if (!lastTime) lastTime = timestamp;\n    const deltaTime = timestamp - lastTime;\n\n    // Cap animation speed (visuals) but run math at fixed steps\n    if (state.running) {\n        // Run ODE math\n        solveODE();\n        \n        // Stop automatically if I drops to near zero (epidemic over)\n        if (state.I < 0.5 && state.t > 2) {\n            state.running = false;\n            ui.btn.pause.textContent = \"Finished\";\n        }\n    }\n\n    drawParticles(); // This does movement\n    \n    // Only update particle colors occasionally or every frame?\n    // Every frame is fine for 400 particles.\n    if (state.running) updateParticleStatuses(); \n\n    drawGraph();\n    updateUI();\n\n    lastTime = timestamp;\n    requestAnimationFrame(animate);\n}\n\nfunction updateUI() {\n    ui.out.t.textContent = state.t.toFixed(1);\n    ui.out.S.textContent = Math.round(state.S);\n    ui.out.I.textContent = Math.round(state.I);\n    ui.out.R.textContent = Math.round(state.R);\n    \n    const r0 = state.beta / state.gamma;\n    ui.out.R0.textContent = r0.toFixed(2);\n    ui.out.R0.style.color = r0 > 1 ? '#c0392b' : '#27ae60';\n}\n\n// --- Event Listeners ---\n\nfunction updateParams() {\n    state.N = parseInt(ui.sliders.N.value);\n    state.beta = parseFloat(ui.sliders.beta.value);\n    state.gamma = parseFloat(ui.sliders.gamma.value);\n    state.I0 = parseInt(ui.sliders.I0.value);\n\n    ui.vals.N.textContent = state.N;\n    ui.vals.beta.textContent = state.beta.toFixed(1);\n    ui.vals.gamma.textContent = state.gamma.toFixed(2);\n    ui.vals.I0.textContent = state.I0;\n}\n\n// Attach listeners\nObject.values(ui.sliders).forEach(s => s.addEventListener('input', updateParams));\n\nui.btn.restart.addEventListener('click', initSimulation);\n\nui.btn.pause.addEventListener('click', () => {\n    state.running = !state.running;\n    ui.btn.pause.textContent = state.running ? \"Pause\" : \"Resume\";\n});\n\n// Init\nupdateParams();\ninitSimulation();\nrequestAnimationFrame(animate);"}}
{"input": {"input_text": "Mechanics problem: a mass-spring-damper with mass m, damping c, spring k. Provide underdamped solution for displacement and velocity given x0, v0.", "simulation_name": " Mass Spring Damper", "domain": "Physics", "description": "Linear second-order ODE with viscous damping", "assumptions": ["Underdamped c < 2*sqrt(k*m)"], "entities": [{"name": "mass", "mass": {"symbol": "m", "unit": "kg", "range": [0.01, 50]}}], "constants": [], "parameters": [{"name": "damping", "symbol": "c", "unit": "N*s/m", "range": [0.001, 200]}, {"name": "spring_constant", "symbol": "k", "unit": "N/m", "range": [0.5, 10000.0]}, {"name": "initial_displacement", "symbol": "x0", "unit": "m", "range": [-1, 1]}, {"name": "initial_velocity", "symbol": "v0", "unit": "m/s", "range": [-5, 5]}], "equations": [{"description": "Damped frequency", "expression": "omega_d = sqrt(k/m - (c/(2*m))^2)"}, {"description": "Displacement", "expression": "x(t) = exp(-c*t/(2*m)) * (x0*cos(omega_d*t) + (v0 + c*x0/(2*m))/omega_d * sin(omega_d*t))"}, {"description": "Velocity", "expression": "v(t) = d/dt x(t)"}], "initial_conditions": {"x": "x0", "v": "v0", "t": 0}, "outputs": ["x", "v"], "simulation_controls": ["c", "k", "m", "x0", "v0"], "constraints": ["c < 2*sqrt(k*m)", "m > 0", "k > 0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S06: Mass-Spring-Damper Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n\n<div class=\"main-container\">\n    <header>\n        <h1>S06: Damped Harmonic Oscillator</h1>\n        <p>Underdamped Motion: $m\\ddot{x} + c\\dot{x} + kx = 0$</p>\n    </header>\n\n    <div class=\"sim-grid\">\n        <section class=\"visuals\">\n            <div class=\"canvas-wrapper\">\n                <h3>Mechanical System</h3>\n                <canvas id=\"mechCanvas\" width=\"300\" height=\"400\"></canvas>\n            </div>\n            \n            <div class=\"canvas-wrapper\">\n                <h3>Response (Displacement $x$ vs Time $t$)</h3>\n                <canvas id=\"graphCanvas\" width=\"500\" height=\"200\"></canvas>\n            </div>\n        </section>\n\n        <section class=\"controls\">\n            <div class=\"panel\">\n                <h2>System Parameters</h2>\n                \n                <div class=\"control-group\">\n                    <label>Mass ($m$)</label>\n                    <div class=\"slider-row\">\n                        <input type=\"range\" id=\"slider-m\" min=\"0.5\" max=\"20\" step=\"0.5\" value=\"5\">\n                        <span id=\"val-m\">5.0</span> kg\n                    </div>\n                </div>\n\n                <div class=\"control-group\">\n                    <label>Spring Constant ($k$)</label>\n                    <div class=\"slider-row\">\n                        <input type=\"range\" id=\"slider-k\" min=\"10\" max=\"200\" step=\"5\" value=\"50\">\n                        <span id=\"val-k\">50</span> N/m\n                    </div>\n                </div>\n\n                <div class=\"control-group\">\n                    <label>Damping Coefficient ($c$)</label>\n                    <div class=\"slider-row\">\n                        <input type=\"range\" id=\"slider-c\" min=\"0\" max=\"20\" step=\"0.1\" value=\"2.0\">\n                        <span id=\"val-c\">2.0</span> Ns/m\n                    </div>\n                    <small id=\"damping-warning\" class=\"warning-text\">System is Overdamped!</small>\n                </div>\n\n                <hr>\n\n                <h2>Initial Conditions</h2>\n                <div class=\"control-group\">\n                    <label>Init. Displacement ($x_0$)</label>\n                    <div class=\"slider-row\">\n                        <input type=\"range\" id=\"slider-x0\" min=\"-1\" max=\"1\" step=\"0.1\" value=\"0.8\">\n                        <span id=\"val-x0\">0.8</span> m\n                    </div>\n                </div>\n                \n                <div class=\"control-group\">\n                    <label>Init. Velocity ($v_0$)</label>\n                    <div class=\"slider-row\">\n                        <input type=\"range\" id=\"slider-v0\" min=\"-2\" max=\"2\" step=\"0.1\" value=\"0\">\n                        <span id=\"val-v0\">0.0</span> m/s\n                    </div>\n                </div>\n\n                <div class=\"actions\">\n                    <button id=\"btn-reset\" class=\"primary-btn\">Reset / Apply $t=0$</button>\n                    <button id=\"btn-pause\" class=\"secondary-btn\">Pause</button>\n                </div>\n            </div>\n\n            <div class=\"panel stats\">\n                <h3>Real-Time Values</h3>\n                <div class=\"stat-row\">\n                    <span>Time ($t$):</span> <span id=\"out-t\">0.00</span> s\n                </div>\n                <div class=\"stat-row\">\n                    <span>Displacement ($x$):</span> <span id=\"out-x\">--</span> m\n                </div>\n                <div class=\"stat-row\">\n                    <span>Velocity ($v$):</span> <span id=\"out-v\">--</span> m/s\n                </div>\n                <div class=\"stat-row\">\n                    <span>Damped Freq ($\\omega_d$):</span> <span id=\"out-wd\">--</span> rad/s\n                </div>\n            </div>\n        </section>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-color: #eef2f5;\n    --panel-bg: #ffffff;\n    --accent: #2980b9;\n    --mass-color: #34495e;\n    --spring-color: #7f8c8d;\n    --damper-color: #95a5a6;\n    --text-color: #2c3e50;\n    --chart-line: #e74c3c;\n}\n\nbody {\n    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n}\n\n.main-container {\n    max-width: 1100px;\n    width: 100%;\n    background: var(--panel-bg);\n    border-radius: 8px;\n    box-shadow: 0 4px 15px rgba(0,0,0,0.1);\n    overflow: hidden;\n}\n\nheader {\n    background-color: #2c3e50;\n    color: white;\n    padding: 20px;\n    text-align: center;\n}\n\nheader h1 { margin: 0; font-size: 1.6rem; }\nheader p { margin: 5px 0 0; opacity: 0.7; font-size: 0.9rem; font-style: italic; }\n\n.sim-grid {\n    display: flex;\n    flex-wrap: wrap;\n}\n\n/* Visuals Section */\n.visuals {\n    flex: 3;\n    min-width: 400px;\n    padding: 20px;\n    background-color: #f8f9fa;\n    border-right: 1px solid #ddd;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 20px;\n}\n\n.canvas-wrapper {\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n}\n\n.canvas-wrapper h3 {\n    margin: 0 0 10px 0;\n    font-size: 0.9rem;\n    color: #7f8c8d;\n    text-transform: uppercase;\n    letter-spacing: 1px;\n}\n\ncanvas {\n    background: #ffffff;\n    border: 1px solid #bdc3c7;\n    border-radius: 4px;\n    box-shadow: inset 0 0 10px rgba(0,0,0,0.05);\n}\n\n/* Controls Section */\n.controls {\n    flex: 2;\n    min-width: 300px;\n    padding: 20px;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.panel {\n    background: #fff;\n    padding: 5px;\n}\n\nh2 {\n    font-size: 1.1rem;\n    color: var(--accent);\n    border-bottom: 2px solid var(--accent);\n    padding-bottom: 5px;\n    margin-bottom: 15px;\n    margin-top: 0;\n}\n\n.control-group { margin-bottom: 15px; }\n\nlabel {\n    display: block;\n    font-weight: 600;\n    font-size: 0.85rem;\n    margin-bottom: 5px;\n}\n\n.slider-row {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\ninput[type=range] { flex: 1; cursor: pointer; }\n.slider-row span {\n    width: 40px;\n    text-align: right;\n    font-family: 'Courier New', monospace;\n    font-weight: bold;\n    color: var(--accent);\n}\n\n.warning-text {\n    color: #c0392b;\n    font-weight: bold;\n    display: none; /* Hidden by default */\n    font-size: 0.8rem;\n    margin-top: 4px;\n}\n\n.actions {\n    display: flex;\n    gap: 10px;\n    margin-top: 20px;\n}\n\nbutton {\n    flex: 1;\n    padding: 10px;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-weight: 600;\n    transition: background 0.2s;\n}\n\n.primary-btn { background-color: var(--accent); color: white; }\n.primary-btn:hover { background-color: #1f618d; }\n.secondary-btn { background-color: #95a5a6; color: white; }\n.secondary-btn:hover { background-color: #7f8c8d; }\n\n/* Real-time stats */\n.stats {\n    background-color: #eef2f5;\n    padding: 15px;\n    border-radius: 6px;\n}\n\n.stat-row {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 5px;\n    font-size: 0.9rem;\n    border-bottom: 1px dashed #ccc;\n    padding-bottom: 2px;\n}\n.stat-row span:last-child {\n    font-family: 'Courier New', monospace;\n    font-weight: bold;\n}\n\n@media (max-width: 800px) {\n    .sim-grid { flex-direction: column; }\n    .visuals { border-right: none; border-bottom: 1px solid #ddd; }\n}", "js": "/**\n * S06: Mass-Spring-Damper Simulation\n * Domain: Physics (Mechanics)\n * Method: Closed-form underdamped solution\n */\n\n// --- Configuration ---\nconst CONFIG = {\n    pixelsPerMeter: 100, // 1m = 100px\n    originY: 100,        // Y position of the ceiling anchor\n    originX: 150,        // X position center\n    eqPos: 150,          // Equilibrium length (pixels from originY)\n    maxHistory: 500,     // Graph width in points\n};\n\n// --- State ---\nlet state = {\n    // Parameters\n    m: 5.0,\n    k: 50,\n    c: 2.0,\n    \n    // Initial Conditions (used for equation)\n    x0: 0.8,\n    v0: 0.0,\n    \n    // Runtime\n    t: 0,\n    currentX: 0,\n    currentV: 0,\n    omegaD: 0,\n    isOverdamped: false,\n    running: true,\n    history: [] // {t, x}\n};\n\n// --- DOM Elements ---\nconst cvsMech = document.getElementById('mechCanvas');\nconst ctxMech = cvsMech.getContext('2d');\nconst cvsGraph = document.getElementById('graphCanvas');\nconst ctxGraph = cvsGraph.getContext('2d');\n\nconst inputs = {\n    m: document.getElementById('slider-m'),\n    k: document.getElementById('slider-k'),\n    c: document.getElementById('slider-c'),\n    x0: document.getElementById('slider-x0'),\n    v0: document.getElementById('slider-v0'),\n};\n\nconst displays = {\n    m: document.getElementById('val-m'),\n    k: document.getElementById('val-k'),\n    c: document.getElementById('val-c'),\n    x0: document.getElementById('val-x0'),\n    v0: document.getElementById('val-v0'),\n    warning: document.getElementById('damping-warning'),\n    t: document.getElementById('out-t'),\n    x: document.getElementById('out-x'),\n    v: document.getElementById('out-v'),\n    wd: document.getElementById('out-wd'),\n};\n\nconst btns = {\n    reset: document.getElementById('btn-reset'),\n    pause: document.getElementById('btn-pause')\n};\n\n// --- Physics Engine ---\n\nfunction calculatePhysics(t) {\n    // Constants derived from state\n    // omega_n = sqrt(k/m)\n    // zeta = c / (2 * sqrt(km))\n    // alpha = c / (2m)\n    \n    const alpha = state.c / (2 * state.m);\n    const discriminant = (state.k / state.m) - (alpha * alpha);\n    \n    // Check constraint\n    if (discriminant <= 0) {\n        state.isOverdamped = true;\n        displays.warning.style.display = 'block';\n        state.omegaD = 0;\n        // Fallback for visual stability (prevent NaN), though physics is wrong for Overdamped here\n        return { x: 0, v: 0 }; \n    } else {\n        state.isOverdamped = false;\n        displays.warning.style.display = 'none';\n        state.omegaD = Math.sqrt(discriminant);\n    }\n    \n    const wd = state.omegaD;\n    \n    // x(t) = exp(-alpha*t) * (x0*cos(wd*t) + (v0 + alpha*x0)/wd * sin(wd*t))\n    const decay = Math.exp(-alpha * t);\n    const A = state.x0;\n    const B = (state.v0 + alpha * state.x0) / wd;\n    \n    const pos = decay * (A * Math.cos(wd * t) + B * Math.sin(wd * t));\n    \n    // v(t) - derivative of above\n    // v(t) = -alpha * x(t) + decay * ( -A*wd*sin(wd*t) + B*wd*cos(wd*t) )\n    const vel = -alpha * pos + decay * (-A * wd * Math.sin(wd * t) + B * wd * Math.cos(wd * t));\n\n    return { x: pos, v: vel };\n}\n\n// --- Drawing Functions ---\n\nfunction drawSpring(ctx, x1, y1, x2, y2, coils, width) {\n    ctx.beginPath();\n    ctx.strokeStyle = '#7f8c8d';\n    ctx.lineWidth = 3;\n    ctx.lineJoin = 'round';\n    \n    const dy = (y2 - y1) / coils;\n    const r = width / 2;\n    \n    ctx.moveTo(x1, y1);\n    for (let i = 1; i <= coils; i++) {\n        const y = y1 + dy * i;\n        const prevY = y1 + dy * (i - 1);\n        \n        // Zigzag\n        ctx.lineTo(x1 - r, prevY + dy * 0.25);\n        ctx.lineTo(x1 + r, prevY + dy * 0.75);\n        ctx.lineTo(x1, y);\n    }\n    ctx.stroke();\n}\n\nfunction drawDamper(ctx, x, y1, y2, width) {\n    const housingW = width * 0.8;\n    const housingH = (y2 - y1) * 0.4; // Dynamically size pot\n    const pistonY = y2 - housingH/2; // Approximate piston location inside\n    \n    ctx.strokeStyle = '#95a5a6';\n    ctx.lineWidth = 2;\n    ctx.fillStyle = 'rgba(149, 165, 166, 0.2)';\n\n    // Draw Top Rod (attached to ceiling)\n    ctx.beginPath();\n    ctx.moveTo(x, y1);\n    ctx.lineTo(x, y1 + (y2 - y1) - housingH); // Plunger rod\n    ctx.stroke();\n    \n    // Draw Plunger Head\n    ctx.beginPath();\n    ctx.moveTo(x - housingW/2 + 2, y1 + (y2-y1) - housingH);\n    ctx.lineTo(x + housingW/2 - 2, y1 + (y2-y1) - housingH);\n    ctx.stroke();\n\n    // Draw Housing (Pot attached to mass)\n    const potTop = y2 - housingH;\n    ctx.beginPath();\n    ctx.rect(x - housingW/2, potTop, housingW, housingH); \n    ctx.stroke();\n    ctx.fill();\n    \n    // Connection to mass\n    ctx.beginPath();\n    ctx.moveTo(x, y2 - housingH + housingH); // Bottom of pot\n    ctx.lineTo(x, y2);\n    ctx.stroke();\n}\n\nfunction drawSystem() {\n    ctxMech.clearRect(0, 0, cvsMech.width, cvsMech.height);\n    \n    const ceilingY = CONFIG.originY;\n    const centerX = CONFIG.originX;\n    \n    // Current pixel Y position of mass center\n    // eqPos is equilibrium. currentX is displacement.\n    const massY = ceilingY + CONFIG.eqPos + (state.currentX * CONFIG.pixelsPerMeter);\n    \n    const massW = 80;\n    const massH = 50;\n    \n    // Draw Ceiling\n    ctxMech.fillStyle = '#2c3e50';\n    ctxMech.fillRect(centerX - 100, ceilingY - 10, 200, 10);\n    \n    // Draw Spring (Left side)\n    drawSpring(ctxMech, centerX - 30, ceilingY, centerX - 30, massY - massH/2, 10, 20);\n    \n    // Draw Damper (Right side)\n    drawDamper(ctxMech, centerX + 30, ceilingY, massY - massH/2, 25);\n    \n    // Draw Mass\n    ctxMech.fillStyle = '#34495e';\n    ctxMech.beginPath();\n    ctxMech.roundRect(centerX - massW/2, massY - massH/2, massW, massH, 5);\n    ctxMech.fill();\n    ctxMech.strokeStyle = '#2c3e50';\n    ctxMech.stroke();\n    \n    // Label Mass\n    ctxMech.fillStyle = '#fff';\n    ctxMech.font = '12px Arial';\n    ctxMech.textAlign = 'center';\n    ctxMech.textBaseline = 'middle';\n    ctxMech.fillText(\"m\", centerX, massY);\n    \n    // Equilibrium Line\n    ctxMech.setLineDash([5, 5]);\n    ctxMech.strokeStyle = '#ccc';\n    ctxMech.beginPath();\n    ctxMech.moveTo(centerX - 100, ceilingY + CONFIG.eqPos);\n    ctxMech.lineTo(centerX + 100, ceilingY + CONFIG.eqPos);\n    ctxMech.stroke();\n    ctxMech.setLineDash([]);\n    ctxMech.fillStyle = '#ccc';\n    ctxMech.fillText(\"x=0\", centerX + 120, ceilingY + CONFIG.eqPos);\n}\n\nfunction drawGraph() {\n    const w = cvsGraph.width;\n    const h = cvsGraph.height;\n    ctxGraph.clearRect(0, 0, w, h);\n    \n    // Background Grid\n    ctxGraph.strokeStyle = '#eee';\n    ctxGraph.lineWidth = 1;\n    ctxGraph.beginPath();\n    ctxGraph.moveTo(0, h/2);\n    ctxGraph.lineTo(w, h/2);\n    ctxGraph.stroke();\n    \n    if (state.history.length < 2) return;\n    \n    // Plot\n    ctxGraph.beginPath();\n    ctxGraph.strokeStyle = '#e74c3c';\n    ctxGraph.lineWidth = 2;\n    \n    const timeWindow = 5; // Display 5 seconds window\n    const now = state.t;\n    const minTime = Math.max(0, now - timeWindow);\n    \n    // Y Scale: +/- 1.2m\n    const scaleY = (h/2) / 1.2; \n    \n    let first = true;\n    \n    for (let point of state.history) {\n        if (point.t < minTime) continue;\n        \n        // Map Time to X\n        const x = ((point.t - minTime) / timeWindow) * w;\n        // Map Disp to Y (invert because canvas Y is down)\n        const y = (h/2) - (point.x * scaleY);\n        \n        if (first) {\n            ctxGraph.moveTo(x, y);\n            first = false;\n        } else {\n            ctxGraph.lineTo(x, y);\n        }\n    }\n    ctxGraph.stroke();\n    \n    // Draw Current Indicator\n    if (state.history.length > 0) {\n        const last = state.history[state.history.length-1];\n        const lx = ((last.t - minTime) / timeWindow) * w;\n        const ly = (h/2) - (last.x * scaleY);\n        \n        ctxGraph.fillStyle = '#e74c3c';\n        ctxGraph.beginPath();\n        ctxGraph.arc(lx, ly, 4, 0, Math.PI*2);\n        ctxGraph.fill();\n    }\n}\n\n// --- Animation Loop ---\n\nlet lastTime = 0;\n\nfunction animate(timestamp) {\n    if (!lastTime) lastTime = timestamp;\n    const dt = (timestamp - lastTime) / 1000;\n    lastTime = timestamp;\n\n    if (state.running && !state.isOverdamped) {\n        state.t += dt;\n        \n        const res = calculatePhysics(state.t);\n        state.currentX = res.x;\n        state.currentV = res.v;\n        \n        // Store history\n        state.history.push({ t: state.t, x: state.currentX });\n        if (state.history.length > 1000) state.history.shift(); // Memory management\n        \n        updateUIValues();\n    }\n\n    drawSystem();\n    drawGraph();\n    \n    requestAnimationFrame(animate);\n}\n\nfunction updateUIValues() {\n    displays.t.textContent = state.t.toFixed(2);\n    displays.x.textContent = state.currentX.toFixed(3);\n    displays.v.textContent = state.currentV.toFixed(3);\n    displays.wd.textContent = state.omegaD.toFixed(2);\n}\n\n// --- Event Listeners ---\n\nfunction updateParams(fromSlider = false) {\n    // If updating params while running, we treat the CURRENT position/velocity\n    // as the NEW initial conditions for t=0 to prevent jumping.\n    // Unless it's a reset.\n    \n    const newM = parseFloat(inputs.m.value);\n    const newK = parseFloat(inputs.k.value);\n    const newC = parseFloat(inputs.c.value);\n    \n    // Check if parameters changed significantly\n    if (state.running && fromSlider) {\n        // \"Hot swap\": Preserve continuity\n        state.x0 = state.currentX;\n        state.v0 = state.currentV;\n        state.t = 0; // Reset time to solve IVP from 'now'\n        state.history = []; // Clear graph for clean slate visual\n    } else if (!state.running && fromSlider) {\n        // If paused, just update the \"Initial\" values from sliders\n        state.x0 = parseFloat(inputs.x0.value);\n        state.v0 = parseFloat(inputs.v0.value);\n    }\n    \n    state.m = newM;\n    state.k = newK;\n    state.c = newC;\n\n    // Update Slider Displays\n    displays.m.textContent = state.m;\n    displays.k.textContent = state.k;\n    displays.c.textContent = state.c;\n    displays.x0.textContent = parseFloat(inputs.x0.value);\n    displays.v0.textContent = parseFloat(inputs.v0.value);\n    \n    // Pre-calc to check damping warning immediately\n    calculatePhysics(0); \n}\n\n// Attach listeners\nObject.keys(inputs).forEach(key => {\n    inputs[key].addEventListener('input', () => updateParams(true));\n});\n\nbtns.reset.addEventListener('click', () => {\n    // Hard reset to slider values\n    state.t = 0;\n    state.x0 = parseFloat(inputs.x0.value);\n    state.v0 = parseFloat(inputs.v0.value);\n    state.history = [];\n    state.running = true;\n    btns.pause.textContent = \"Pause\";\n    updateParams(false);\n});\n\nbtns.pause.addEventListener('click', () => {\n    state.running = !state.running;\n    btns.pause.textContent = state.running ? \"Pause\" : \"Resume\";\n});\n\n// Init\nupdateParams(false);\nrequestAnimationFrame(animate);"}}
{"input": {"input_text": "Optics lab sheet states Snell's law: n1*sin(theta1) = n2*sin(theta2). Given n1, n2, and incident angle theta1, compute transmitted angle or flag total internal reflection.", "simulation_name": " Snell Refraction", "domain": "Physics", "description": "Planar interface refraction", "assumptions": ["Isotropic media"], "entities": [], "constants": [], "parameters": [{"name": "incident_angle", "symbol": "theta1", "unit": "rad", "range": [0, 1.57]}, {"name": "index_medium1", "symbol": "n1", "unit": "dimensionless", "range": [1.0, 2.6]}, {"name": "index_medium2", "symbol": "n2", "unit": "dimensionless", "range": [1.0, 2.6]}], "equations": [{"description": "Refraction angle", "condition": "(n1/n2)*sin(theta1) <= 1", "expression": "theta2 = asin((n1/n2)*sin(theta1))"}], "initial_conditions": {}, "outputs": ["theta2", "total_internal_reflection"], "simulation_controls": ["theta1", "n1", "n2"], "constraints": ["If (n1/n2)*sin(theta1) > 1 then total_internal_reflection = true"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Snell's Law Refraction Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1>Snell's Law: Refraction & TIR</h1>\n            <p class=\"subtitle\">Adjust indices and angle to simulate light behavior.</p>\n        </header>\n\n        <main>\n            <div class=\"canvas-container\">\n                <canvas id=\"simCanvas\"></canvas>\n                <div class=\"labels\">\n                    <span id=\"label-n1\">Medium 1 (n₁)</span>\n                    <span id=\"label-n2\">Medium 2 (n₂)</span>\n                </div>\n            </div>\n\n            <aside class=\"controls\">\n                <div class=\"control-group\">\n                    <label for=\"n1\">Index of Refraction 1 ($n_1$)</label>\n                    <input type=\"range\" id=\"n1\" min=\"1.0\" max=\"2.6\" step=\"0.01\" value=\"1.00\">\n                    <span class=\"value-display\" id=\"n1-val\">1.00</span>\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"n2\">Index of Refraction 2 ($n_2$)</label>\n                    <input type=\"range\" id=\"n2\" min=\"1.0\" max=\"2.6\" step=\"0.01\" value=\"1.50\">\n                    <span class=\"value-display\" id=\"n2-val\">1.50</span>\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"theta1\">Incident Angle ($\\theta_1$)</label>\n                    <input type=\"range\" id=\"theta1\" min=\"0\" max=\"90\" step=\"0.1\" value=\"30\">\n                    <span class=\"value-display\" id=\"theta1-val\">30.0°</span>\n                </div>\n\n                <hr>\n\n                <div class=\"results\">\n                    <div class=\"result-item\">\n                        <span class=\"label\">Calculated $\\theta_2$:</span>\n                        <span class=\"value\" id=\"theta2-result\">--</span>\n                    </div>\n                    <div class=\"result-item\" id=\"tir-warning\">\n                        ⚠️ Total Internal Reflection\n                    </div>\n                </div>\n            </aside>\n        </main>\n    </div>\n    \n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary-color: #3498db;\n    --accent-color: #e74c3c;\n    --bg-color: #f4f7f6;\n    --panel-bg: #ffffff;\n    --text-color: #2c3e50;\n    --border-radius: 8px;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    margin: 0;\n    padding: 0;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    min-height: 100vh;\n}\n\n.container {\n    width: 90%;\n    max-width: 1000px;\n    background: var(--panel-bg);\n    box-shadow: 0 4px 15px rgba(0,0,0,0.1);\n    border-radius: var(--border-radius);\n    padding: 20px;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 20px;\n}\n\nh1 {\n    margin: 0;\n    font-size: 1.8rem;\n}\n\n.subtitle {\n    color: #7f8c8d;\n    margin-top: 5px;\n    font-size: 0.9rem;\n}\n\nmain {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 20px;\n}\n\n.canvas-container {\n    flex: 2;\n    min-width: 300px;\n    position: relative;\n    border: 1px solid #ddd;\n    border-radius: var(--border-radius);\n    background: #000; /* Dark background for light contrast */\n    overflow: hidden;\n}\n\ncanvas {\n    width: 100%;\n    height: 400px; /* Fixed height for consistency */\n    display: block;\n}\n\n.labels {\n    position: absolute;\n    top: 10px;\n    left: 10px;\n    pointer-events: none;\n    display: flex;\n    flex-direction: column;\n    gap: 180px; /* Rough spacing for top/bottom halves */\n    color: rgba(255, 255, 255, 0.7);\n    font-size: 0.8rem;\n    font-weight: bold;\n}\n\n#label-n2 {\n    margin-top: auto;\n}\n\n.controls {\n    flex: 1;\n    min-width: 250px;\n    background: #f9f9f9;\n    padding: 20px;\n    border-radius: var(--border-radius);\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n}\n\n.control-group {\n    display: flex;\n    flex-direction: column;\n}\n\nlabel {\n    font-weight: 600;\n    margin-bottom: 5px;\n    font-size: 0.9rem;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    cursor: pointer;\n}\n\n.value-display {\n    text-align: right;\n    font-family: monospace;\n    color: var(--primary-color);\n    font-weight: bold;\n}\n\nhr {\n    border: 0;\n    height: 1px;\n    background: #ddd;\n    width: 100%;\n}\n\n.results {\n    background: #fff;\n    padding: 15px;\n    border: 1px solid #eee;\n    border-radius: var(--border-radius);\n}\n\n.result-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 10px;\n}\n\n.result-item:last-child {\n    margin-bottom: 0;\n}\n\n.value {\n    font-weight: bold;\n    font-size: 1.2rem;\n    color: var(--primary-color);\n}\n\n#tir-warning {\n    display: none; /* Hidden by default */\n    background: #ffebee;\n    color: #c62828;\n    padding: 10px;\n    border-radius: 4px;\n    font-weight: bold;\n    text-align: center;\n    justify-content: center;\n    border: 1px solid #ef9a9a;\n}", "js": "// DOM Elements\nconst canvas = document.getElementById('simCanvas');\nconst ctx = canvas.getContext('2d');\n\nconst n1Input = document.getElementById('n1');\nconst n2Input = document.getElementById('n2');\nconst theta1Input = document.getElementById('theta1');\n\nconst n1Val = document.getElementById('n1-val');\nconst n2Val = document.getElementById('n2-val');\nconst theta1Val = document.getElementById('theta1-val');\n\nconst theta2Result = document.getElementById('theta2-result');\nconst tirWarning = document.getElementById('tir-warning');\n\n// State\nlet n1 = 1.0;\nlet n2 = 1.5;\nlet theta1Deg = 30;\nlet animationOffset = 0; // For animating the beam flow\n\n// Resize handling\nfunction resizeCanvas() {\n    canvas.width = canvas.parentElement.clientWidth;\n    canvas.height = canvas.parentElement.clientHeight;\n}\nwindow.addEventListener('resize', () => {\n    resizeCanvas();\n    draw();\n});\nresizeCanvas();\n\n// Event Listeners\nfunction updateState() {\n    n1 = parseFloat(n1Input.value);\n    n2 = parseFloat(n2Input.value);\n    theta1Deg = parseFloat(theta1Input.value);\n\n    // Update Text Displays\n    n1Val.textContent = n1.toFixed(2);\n    n2Val.textContent = n2.toFixed(2);\n    theta1Val.textContent = theta1Deg.toFixed(1) + \"°\";\n\n    calculateAndDraw();\n}\n\nn1Input.addEventListener('input', updateState);\nn2Input.addEventListener('input', updateState);\ntheta1Input.addEventListener('input', updateState);\n\n// Physics & Rendering Loop\nfunction calculateAndDraw() {\n    // 1. Physics Calculations\n    const theta1Rad = theta1Deg * (Math.PI / 180);\n    \n    // Snell's Law: n1 * sin(theta1) = n2 * sin(theta2)\n    // sin(theta2) = (n1/n2) * sin(theta1)\n    const sinTheta2 = (n1 / n2) * Math.sin(theta1Rad);\n    \n    let isTIR = false;\n    let theta2Rad = 0;\n\n    if (Math.abs(sinTheta2) > 1.0) {\n        isTIR = true;\n    } else {\n        theta2Rad = Math.asin(sinTheta2);\n    }\n\n    // Update Results UI\n    if (isTIR) {\n        theta2Result.textContent = \"--\";\n        tirWarning.style.display = \"flex\";\n    } else {\n        const theta2Deg = theta2Rad * (180 / Math.PI);\n        theta2Result.textContent = theta2Deg.toFixed(1) + \"°\";\n        tirWarning.style.display = \"none\";\n    }\n\n    draw(theta1Rad, theta2Rad, isTIR);\n}\n\nfunction draw(theta1Rad, theta2Rad, isTIR) {\n    const w = canvas.width;\n    const h = canvas.height;\n    const cx = w / 2;\n    const cy = h / 2;\n    const rayLength = Math.max(w, h); // Ensure rays go off screen\n\n    // Clear Canvas\n    ctx.clearRect(0, 0, w, h);\n\n    // --- Draw Media Backgrounds ---\n    // Medium 1 (Top) - Opacity based on density (index)\n    // We use a blue-ish base. Higher index = darker/more opaque.\n    const alpha1 = (n1 - 1.0) / 2.0 * 0.5 + 0.1; \n    ctx.fillStyle = `rgba(135, 206, 235, ${alpha1})`; // SkyBlue\n    ctx.fillRect(0, 0, w, cy);\n\n    // Medium 2 (Bottom)\n    const alpha2 = (n2 - 1.0) / 2.0 * 0.5 + 0.1;\n    ctx.fillStyle = `rgba(0, 0, 139, ${alpha2})`; // DarkBlue\n    ctx.fillRect(0, cy, w, h - cy);\n\n    // --- Draw Interface & Normal ---\n    \n    // Interface (Horizontal)\n    ctx.beginPath();\n    ctx.moveTo(0, cy);\n    ctx.lineTo(w, cy);\n    ctx.strokeStyle = \"rgba(255, 255, 255, 0.5)\";\n    ctx.lineWidth = 2;\n    ctx.stroke();\n\n    // Normal (Vertical)\n    ctx.beginPath();\n    ctx.setLineDash([5, 5]);\n    ctx.moveTo(cx, 0);\n    ctx.lineTo(cx, h);\n    ctx.strokeStyle = \"rgba(255, 255, 255, 0.3)\";\n    ctx.lineWidth = 1;\n    ctx.stroke();\n    ctx.setLineDash([]); // Reset dash\n\n    // --- Draw Light Rays ---\n    // Light Source Color\n    const rayColor = \"#e74c3c\"; // Red laser\n    const shadowRayColor = \"rgba(231, 76, 60, 0.4)\"; // Faint reflection\n    \n    // 1. Incident Ray (From Top Left quadrant usually)\n    // Start point calculation: x = cx - L*sin(theta), y = cy - L*cos(theta)\n    const ix = cx - rayLength * Math.sin(theta1Rad);\n    const iy = cy - rayLength * Math.cos(theta1Rad);\n\n    drawLaser(ix, iy, cx, cy, rayColor);\n\n    // 2. Transmitted / Refracted Ray OR TIR\n    if (isTIR) {\n        // Total Internal Reflection\n        // Reflection Angle = Incident Angle\n        // Goes to Top Right quadrant: x = cx + L*sin(theta), y = cy - L*cos(theta)\n        const rx = cx + rayLength * Math.sin(theta1Rad);\n        const ry = cy - rayLength * Math.cos(theta1Rad);\n        \n        drawLaser(cx, cy, rx, ry, rayColor);\n    } else {\n        // Refraction\n        // Goes to Bottom Right quadrant: x = cx + L*sin(theta2), y = cy + L*cos(theta2)\n        const tx = cx + rayLength * Math.sin(theta2Rad);\n        const ty = cy + rayLength * Math.cos(theta2Rad);\n        \n        drawLaser(cx, cy, tx, ty, rayColor);\n\n        // Optional: Draw a faint partial reflection even if not TIR (Fresnel reflection)\n        // Physics realism: there is always some reflection.\n        const rfx = cx + rayLength * Math.sin(theta1Rad);\n        const rfy = cy - rayLength * Math.cos(theta1Rad);\n        drawLaser(cx, cy, rfx, rfy, shadowRayColor, false);\n    }\n\n    // Draw Angles Arc\n    drawAngleArc(cx, cy, -Math.PI/2 - theta1Rad, -Math.PI/2, 40, \"θ1\"); // Incident\n    if (!isTIR) {\n        drawAngleArc(cx, cy, Math.PI/2, Math.PI/2 - theta2Rad, 40, \"θ2\"); // Refracted\n    }\n}\n\n// Helper: Draw animated laser beam\nfunction drawLaser(x1, y1, x2, y2, color, animate = true) {\n    ctx.beginPath();\n    ctx.moveTo(x1, y1);\n    ctx.lineTo(x2, y2);\n    \n    // Glow effect\n    ctx.shadowBlur = 10;\n    ctx.shadowColor = color;\n    ctx.strokeStyle = color;\n    ctx.lineWidth = 4;\n    ctx.stroke();\n    ctx.shadowBlur = 0; // Reset\n\n    // Inner core\n    ctx.strokeStyle = \"#fff\";\n    ctx.lineWidth = 1;\n    ctx.stroke();\n\n    // \"Photon\" Animation along the line\n    if (animate) {\n        const dx = x2 - x1;\n        const dy = y2 - y1;\n        const dist = Math.sqrt(dx*dx + dy*dy);\n        const steps = 20; // spacing\n        \n        ctx.fillStyle = \"rgba(255, 255, 255, 0.8)\";\n        \n        // Move the dots based on time\n        const phase = (Date.now() / 50) % steps;\n        \n        for (let i = 0; i < dist; i+= steps) {\n            let t = (i + phase);\n            if(t > dist) t -= dist;\n            \n            const ratio = t / dist;\n            const px = x1 + dx * ratio;\n            const py = y1 + dy * ratio;\n            \n            ctx.beginPath();\n            ctx.arc(px, py, 1.5, 0, Math.PI * 2);\n            ctx.fill();\n        }\n    }\n}\n\n// Helper: Draw angle arcs\nfunction drawAngleArc(cx, cy, startAngle, endAngle, radius, label) {\n    ctx.beginPath();\n    // In canvas arc, 0 is Right (3 o'clock). \n    // Normal is Up (-PI/2) and Down (PI/2).\n    // Incident comes from Top-Left. Ray angle is relative to Vertical Normal.\n    // Canvas geometry requires offset calculation. \n    \n    // Simplified logic: Drawing arcs relative to the Normal (Y-axis)\n    // Incident is in Upper-Left. \n    // We measure FROM Normal TO Ray.\n    // Normal Up is -90deg (-PI/2). Ray is (-90 - theta).\n    \n    ctx.arc(cx, cy, radius, startAngle, endAngle);\n    ctx.strokeStyle = \"white\";\n    ctx.lineWidth = 1;\n    ctx.stroke();\n\n    // Text Label\n    const midAngle = (startAngle + endAngle) / 2;\n    const tx = cx + (radius + 15) * Math.cos(midAngle);\n    const ty = cy + (radius + 15) * Math.sin(midAngle);\n    ctx.fillStyle = \"white\";\n    ctx.font = \"12px Arial\";\n    ctx.fillText(label, tx - 5, ty + 5);\n}\n\n// Animation Loop\nfunction animate() {\n    updateState(); // Re-calculates and calls draw\n    requestAnimationFrame(animate);\n}\n\n// Start\nanimate();"}}
{"input": {"input_text": "Heat transfer example: 1D rod of length L, thermal diffusivity alpha. Explicit finite-difference with spacing dx and timestep dt. Provide stability condition and update equation.", "simulation_name": " Heat Diffusion 1D", "domain": "Physics", "description": "Explicit FTCS scheme for 1D conduction", "assumptions": ["Constant alpha"], "entities": [], "constants": [], "parameters": [{"name": "thermal_diffusivity", "symbol": "alpha", "unit": "m^2/s", "range": [1e-07, 0.0001]}, {"name": "rod_length", "symbol": "L", "unit": "m", "range": [0.05, 5]}, {"name": "spatial_step", "symbol": "dx", "unit": "m", "range": [0.0001, 0.2]}, {"name": "time_step", "symbol": "dt", "unit": "s", "range": [1e-05, 2]}], "equations": [{"description": "Fourier number", "expression": "Fo = alpha*dt/(dx*dx)"}, {"description": "Stability", "condition": "Fo <= 0.5", "expression": "stable = true"}, {"description": "Node update", "expression": "T_i^{n+1} = T_i^n + Fo*(T_{i+1}^n - 2*T_i^n + T_{i-1}^n)"}], "initial_conditions": {}, "outputs": ["temperature_profile"], "simulation_controls": ["alpha", "L", "dx", "dt"], "constraints": ["Fo <= 0.5 for stability"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>1D Heat Diffusion Simulator</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1>1D Heat Diffusion Simulator</h1>\n            <p class=\"subtitle\">Explicit FTCS Finite Difference Method</p>\n        </header>\n\n        <div class=\"main-content\">\n            <!-- Controls Panel -->\n            <div class=\"controls-panel\">\n                <h2>Simulation Parameters</h2>\n                \n                <div class=\"control-group\">\n                    <label for=\"alpha\">\n                        Thermal Diffusivity (α)\n                        <span class=\"value\" id=\"alpha-value\">1.00e-5</span> m²/s\n                    </label>\n                    <input type=\"range\" id=\"alpha\" min=\"-7\" max=\"-4\" step=\"0.1\" value=\"-5\">\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"length\">\n                        Rod Length (L)\n                        <span class=\"value\" id=\"length-value\">1.00</span> m\n                    </label>\n                    <input type=\"range\" id=\"length\" min=\"0.05\" max=\"5\" step=\"0.05\" value=\"1\">\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"dx\">\n                        Spatial Step (dx)\n                        <span class=\"value\" id=\"dx-value\">0.02</span> m\n                    </label>\n                    <input type=\"range\" id=\"dx\" min=\"0.001\" max=\"0.1\" step=\"0.001\" value=\"0.02\">\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"dt\">\n                        Time Step (dt)\n                        <span class=\"value\" id=\"dt-value\">0.10</span> s\n                    </label>\n                    <input type=\"range\" id=\"dt\" min=\"0.001\" max=\"1\" step=\"0.001\" value=\"0.1\">\n                </div>\n\n                <div class=\"stability-indicator\" id=\"stability\">\n                    <div class=\"stability-label\">Fourier Number (Fo):</div>\n                    <div class=\"fourier-value\" id=\"fourier-value\">0.250</div>\n                    <div class=\"stability-status\" id=\"stability-status\">STABLE</div>\n                    <div class=\"stability-condition\">Condition: Fo ≤ 0.5</div>\n                </div>\n\n                <div class=\"initial-conditions\">\n                    <h3>Initial Conditions</h3>\n                    <div class=\"control-group\">\n                        <label for=\"temp-left\">\n                            Left Boundary\n                            <span class=\"value\" id=\"temp-left-value\">100</span> °C\n                        </label>\n                        <input type=\"range\" id=\"temp-left\" min=\"0\" max=\"200\" step=\"1\" value=\"100\">\n                    </div>\n                    <div class=\"control-group\">\n                        <label for=\"temp-right\">\n                            Right Boundary\n                            <span class=\"value\" id=\"temp-right-value\">0</span> °C\n                        </label>\n                        <input type=\"range\" id=\"temp-right\" min=\"0\" max=\"200\" step=\"1\" value=\"0\">\n                    </div>\n                    <div class=\"control-group\">\n                        <label for=\"temp-initial\">\n                            Initial Interior\n                            <span class=\"value\" id=\"temp-initial-value\">20</span> °C\n                        </label>\n                        <input type=\"range\" id=\"temp-initial\" min=\"0\" max=\"200\" step=\"1\" value=\"20\">\n                    </div>\n                </div>\n\n                <div class=\"button-group\">\n                    <button id=\"start-btn\" class=\"btn btn-primary\">Start</button>\n                    <button id=\"pause-btn\" class=\"btn btn-secondary\" disabled>Pause</button>\n                    <button id=\"reset-btn\" class=\"btn btn-secondary\">Reset</button>\n                </div>\n\n                <div class=\"info-panel\">\n                    <div class=\"info-row\">\n                        <span>Time:</span>\n                        <span id=\"time-display\">0.00 s</span>\n                    </div>\n                    <div class=\"info-row\">\n                        <span>Nodes:</span>\n                        <span id=\"nodes-display\">51</span>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Visualization Panel -->\n            <div class=\"visualization-panel\">\n                <h2>Temperature Distribution</h2>\n                <canvas id=\"temperature-canvas\"></canvas>\n                \n                <div class=\"equation-panel\">\n                    <h3>Update Equation</h3>\n                    <div class=\"equation\">\n                        T<sub>i</sub><sup>n+1</sup> = T<sub>i</sub><sup>n</sup> + Fo × (T<sub>i+1</sub><sup>n</sup> - 2T<sub>i</sub><sup>n</sup> + T<sub>i-1</sub><sup>n</sup>)\n                    </div>\n                    <div class=\"equation-detail\">\n                        where Fo = α·dt / dx²\n                    </div>\n                </div>\n\n                <div class=\"legend\">\n                    <div class=\"legend-item\">\n                        <div class=\"legend-color hot\"></div>\n                        <span>Hot (100°C)</span>\n                    </div>\n                    <div class=\"legend-item\">\n                        <div class=\"legend-color medium\"></div>\n                        <span>Medium (50°C)</span>\n                    </div>\n                    <div class=\"legend-item\">\n                        <div class=\"legend-color cold\"></div>\n                        <span>Cold (0°C)</span>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    min-height: 100vh;\n    padding: 20px;\n    color: #333;\n}\n\n.container {\n    max-width: 1400px;\n    margin: 0 auto;\n    background: white;\n    border-radius: 20px;\n    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n    overflow: hidden;\n}\n\nheader {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    padding: 30px;\n    text-align: center;\n}\n\nheader h1 {\n    font-size: 2.5em;\n    margin-bottom: 10px;\n    font-weight: 700;\n}\n\n.subtitle {\n    font-size: 1.1em;\n    opacity: 0.9;\n}\n\n.main-content {\n    display: grid;\n    grid-template-columns: 400px 1fr;\n    gap: 30px;\n    padding: 30px;\n}\n\n.controls-panel {\n    background: #f8f9fa;\n    padding: 25px;\n    border-radius: 15px;\n    height: fit-content;\n}\n\n.controls-panel h2 {\n    color: #667eea;\n    margin-bottom: 20px;\n    font-size: 1.5em;\n}\n\n.control-group {\n    margin-bottom: 20px;\n}\n\n.control-group label {\n    display: block;\n    margin-bottom: 8px;\n    font-weight: 600;\n    color: #555;\n    font-size: 0.9em;\n}\n\n.value {\n    color: #667eea;\n    font-weight: 700;\n    float: right;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    height: 8px;\n    border-radius: 5px;\n    background: #ddd;\n    outline: none;\n    -webkit-appearance: none;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #667eea;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb:hover {\n    transform: scale(1.2);\n    background: #764ba2;\n}\n\ninput[type=\"range\"]::-moz-range-thumb {\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #667eea;\n    cursor: pointer;\n    border: none;\n}\n\n.stability-indicator {\n    background: white;\n    padding: 20px;\n    border-radius: 10px;\n    margin: 25px 0;\n    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.stability-label {\n    font-weight: 600;\n    color: #555;\n    margin-bottom: 8px;\n}\n\n.fourier-value {\n    font-size: 2em;\n    font-weight: 700;\n    color: #667eea;\n    margin-bottom: 10px;\n}\n\n.stability-status {\n    font-size: 1.2em;\n    font-weight: 700;\n    padding: 10px;\n    border-radius: 5px;\n    text-align: center;\n    margin-bottom: 10px;\n}\n\n.stability-status.stable {\n    background: #d4edda;\n    color: #155724;\n}\n\n.stability-status.unstable {\n    background: #f8d7da;\n    color: #721c24;\n}\n\n.stability-condition {\n    font-size: 0.85em;\n    color: #666;\n    text-align: center;\n}\n\n.initial-conditions {\n    margin: 25px 0;\n}\n\n.initial-conditions h3 {\n    color: #667eea;\n    margin-bottom: 15px;\n    font-size: 1.2em;\n}\n\n.button-group {\n    display: flex;\n    gap: 10px;\n    margin: 20px 0;\n}\n\n.btn {\n    flex: 1;\n    padding: 12px;\n    border: none;\n    border-radius: 8px;\n    font-size: 1em;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n\n.btn-primary {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n}\n\n.btn-primary:hover:not(:disabled) {\n    transform: translateY(-2px);\n    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);\n}\n\n.btn-secondary {\n    background: #6c757d;\n    color: white;\n}\n\n.btn-secondary:hover:not(:disabled) {\n    background: #5a6268;\n}\n\n.btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.info-panel {\n    background: white;\n    padding: 15px;\n    border-radius: 10px;\n    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.info-row {\n    display: flex;\n    justify-content: space-between;\n    padding: 8px 0;\n    border-bottom: 1px solid #eee;\n}\n\n.info-row:last-child {\n    border-bottom: none;\n}\n\n.info-row span:first-child {\n    font-weight: 600;\n    color: #555;\n}\n\n.info-row span:last-child {\n    color: #667eea;\n    font-weight: 700;\n}\n\n.visualization-panel {\n    background: white;\n    padding: 25px;\n    border-radius: 15px;\n}\n\n.visualization-panel h2 {\n    color: #667eea;\n    margin-bottom: 20px;\n    font-size: 1.5em;\n}\n\n#temperature-canvas {\n    width: 100%;\n    height: 400px;\n    border: 2px solid #e0e0e0;\n    border-radius: 10px;\n    background: white;\n}\n\n.equation-panel {\n    background: #f8f9fa;\n    padding: 20px;\n    border-radius: 10px;\n    margin: 20px 0;\n}\n\n.equation-panel h3 {\n    color: #667eea;\n    margin-bottom: 15px;\n    font-size: 1.2em;\n}\n\n.equation {\n    font-size: 1.1em;\n    text-align: center;\n    padding: 15px;\n    background: white;\n    border-radius: 8px;\n    margin-bottom: 10px;\n    font-family: 'Times New Roman', serif;\n}\n\n.equation-detail {\n    text-align: center;\n    color: #666;\n    font-style: italic;\n}\n\n.legend {\n    display: flex;\n    justify-content: center;\n    gap: 30px;\n    margin-top: 20px;\n}\n\n.legend-item {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\n.legend-color {\n    width: 40px;\n    height: 20px;\n    border-radius: 5px;\n    border: 1px solid #ddd;\n}\n\n.legend-color.hot {\n    background: linear-gradient(90deg, #ff0000, #ff6600);\n}\n\n.legend-color.medium {\n    background: linear-gradient(90deg, #ffff00, #ff9900);\n}\n\n.legend-color.cold {\n    background: linear-gradient(90deg, #0099ff, #0000ff);\n}\n\n@media (max-width: 1024px) {\n    .main-content {\n        grid-template-columns: 1fr;\n    }\n}\n\n@media (max-width: 768px) {\n    header h1 {\n        font-size: 1.8em;\n    }\n    \n    .subtitle {\n        font-size: 0.9em;\n    }\n    \n    .main-content {\n        padding: 15px;\n    }\n    \n    .legend {\n        flex-direction: column;\n        align-items: center;\n    }\n}", "js": "// Simulation state\nlet state = {\n    alpha: 1e-5,\n    L: 1.0,\n    dx: 0.02,\n    dt: 0.1,\n    tempLeft: 100,\n    tempRight: 0,\n    tempInitial: 20,\n    temperature: [],\n    nodes: 0,\n    time: 0,\n    isRunning: false,\n    animationId: null\n};\n\n// Canvas setup\nconst canvas = document.getElementById('temperature-canvas');\nconst ctx = canvas.getContext('2d');\n\nfunction resizeCanvas() {\n    const rect = canvas.getBoundingClientRect();\n    canvas.width = rect.width;\n    canvas.height = rect.height;\n}\n\nresizeCanvas();\nwindow.addEventListener('resize', resizeCanvas);\n\n// Initialize temperature array\nfunction initializeTemperature() {\n    state.nodes = Math.floor(state.L / state.dx) + 1;\n    state.temperature = new Array(state.nodes);\n    \n    // Set boundary conditions\n    state.temperature[0] = state.tempLeft;\n    state.temperature[state.nodes - 1] = state.tempRight;\n    \n    // Set initial interior temperatures\n    for (let i = 1; i < state.nodes - 1; i++) {\n        state.temperature[i] = state.tempInitial;\n    }\n    \n    state.time = 0;\n    document.getElementById('nodes-display').textContent = state.nodes;\n}\n\n// Calculate Fourier number\nfunction calculateFourier() {\n    return (state.alpha * state.dt) / (state.dx * state.dx);\n}\n\n// Update stability indicator\nfunction updateStabilityIndicator() {\n    const Fo = calculateFourier();\n    const isStable = Fo <= 0.5;\n    \n    document.getElementById('fourier-value').textContent = Fo.toFixed(4);\n    \n    const statusEl = document.getElementById('stability-status');\n    if (isStable) {\n        statusEl.textContent = 'STABLE ✓';\n        statusEl.className = 'stability-status stable';\n    } else {\n        statusEl.textContent = 'UNSTABLE ✗';\n        statusEl.className = 'stability-status unstable';\n    }\n}\n\n// Update temperature using explicit FTCS scheme\nfunction updateTemperature() {\n    const Fo = calculateFourier();\n    const newTemp = [...state.temperature];\n    \n    // Update interior nodes\n    for (let i = 1; i < state.nodes - 1; i++) {\n        newTemp[i] = state.temperature[i] + \n                     Fo * (state.temperature[i + 1] - 2 * state.temperature[i] + state.temperature[i - 1]);\n    }\n    \n    // Maintain boundary conditions\n    newTemp[0] = state.tempLeft;\n    newTemp[state.nodes - 1] = state.tempRight;\n    \n    state.temperature = newTemp;\n    state.time += state.dt;\n    \n    document.getElementById('time-display').textContent = state.time.toFixed(2) + ' s';\n}\n\n// Get color based on temperature\nfunction getTemperatureColor(temp) {\n    const minTemp = Math.min(state.tempLeft, state.tempRight, state.tempInitial);\n    const maxTemp = Math.max(state.tempLeft, state.tempRight, state.tempInitial);\n    const range = maxTemp - minTemp;\n    \n    if (range === 0) return { r: 0, g: 0, b: 255 };\n    \n    const normalized = (temp - minTemp) / range;\n    \n    let r, g, b;\n    \n    if (normalized < 0.5) {\n        // Blue to Yellow\n        const t = normalized * 2;\n        r = Math.floor(t * 255);\n        g = Math.floor(t * 255);\n        b = Math.floor(255 * (1 - t));\n    } else {\n        // Yellow to Red\n        const t = (normalized - 0.5) * 2;\n        r = 255;\n        g = Math.floor(255 * (1 - t));\n        b = 0;\n    }\n    \n    return { r, g, b };\n}\n\n// Draw temperature distribution\nfunction draw() {\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    \n    const width = canvas.width;\n    const height = canvas.height;\n    const padding = 60;\n    const graphWidth = width - 2 * padding;\n    const graphHeight = height - 2 * padding;\n    \n    // Draw axes\n    ctx.strokeStyle = '#333';\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.moveTo(padding, padding);\n    ctx.lineTo(padding, height - padding);\n    ctx.lineTo(width - padding, height - padding);\n    ctx.stroke();\n    \n    // Draw grid\n    ctx.strokeStyle = '#e0e0e0';\n    ctx.lineWidth = 1;\n    for (let i = 0; i <= 10; i++) {\n        const y = padding + (graphHeight / 10) * i;\n        ctx.beginPath();\n        ctx.moveTo(padding, y);\n        ctx.lineTo(width - padding, y);\n        ctx.stroke();\n    }\n    \n    // Y-axis labels (temperature)\n    ctx.fillStyle = '#333';\n    ctx.font = '12px Arial';\n    ctx.textAlign = 'right';\n    const minTemp = Math.min(state.tempLeft, state.tempRight, state.tempInitial, ...state.temperature);\n    const maxTemp = Math.max(state.tempLeft, state.tempRight, state.tempInitial, ...state.temperature);\n    const tempRange = maxTemp - minTemp;\n    \n    for (let i = 0; i <= 10; i++) {\n        const temp = maxTemp - (tempRange / 10) * i;\n        const y = padding + (graphHeight / 10) * i;\n        ctx.fillText(temp.toFixed(1) + '°C', padding - 10, y + 5);\n    }\n    \n    // X-axis labels (position)\n    ctx.textAlign = 'center';\n    for (let i = 0; i <= 5; i++) {\n        const pos = (state.L / 5) * i;\n        const x = padding + (graphWidth / 5) * i;\n        ctx.fillText(pos.toFixed(2) + 'm', x, height - padding + 20);\n    }\n    \n    // Axis titles\n    ctx.save();\n    ctx.translate(20, height / 2);\n    ctx.rotate(-Math.PI / 2);\n    ctx.textAlign = 'center';\n    ctx.font = 'bold 14px Arial';\n    ctx.fillText('Temperature (°C)', 0, 0);\n    ctx.restore();\n    \n    ctx.font = 'bold 14px Arial';\n    ctx.fillText('Position (m)', width / 2, height - 20);\n    \n    // Draw temperature distribution as filled area\n    if (state.temperature.length > 0) {\n        ctx.beginPath();\n        ctx.moveTo(padding, height - padding);\n        \n        for (let i = 0; i < state.nodes; i++) {\n            const x = padding + (graphWidth / (state.nodes - 1)) * i;\n            const temp = state.temperature[i];\n            const normalizedTemp = (temp - minTemp) / (tempRange || 1);\n            const y = height - padding - normalizedTemp * graphHeight;\n            \n            if (i === 0) {\n                ctx.lineTo(x, y);\n            } else {\n                ctx.lineTo(x, y);\n            }\n        }\n        \n        ctx.lineTo(width - padding, height - padding);\n        ctx.closePath();\n        \n        // Gradient fill\n        const gradient = ctx.createLinearGradient(0, padding, 0, height - padding);\n        gradient.addColorStop(0, 'rgba(255, 0, 0, 0.3)');\n        gradient.addColorStop(0.5, 'rgba(255, 255, 0, 0.3)');\n        gradient.addColorStop(1, 'rgba(0, 0, 255, 0.3)');\n        ctx.fillStyle = gradient;\n        ctx.fill();\n    }\n    \n    // Draw temperature line\n    if (state.temperature.length > 0) {\n        ctx.strokeStyle = '#667eea';\n        ctx.lineWidth = 3;\n        ctx.beginPath();\n        \n        for (let i = 0; i < state.nodes; i++) {\n            const x = padding + (graphWidth / (state.nodes - 1)) * i;\n            const temp = state.temperature[i];\n            const normalizedTemp = (temp - minTemp) / (tempRange || 1);\n            const y = height - padding - normalizedTemp * graphHeight;\n            \n            if (i === 0) {\n                ctx.moveTo(x, y);\n            } else {\n                ctx.lineTo(x, y);\n            }\n        }\n        \n        ctx.stroke();\n        \n        // Draw points with color based on temperature\n        for (let i = 0; i < state.nodes; i++) {\n            const x = padding + (graphWidth / (state.nodes - 1)) * i;\n            const temp = state.temperature[i];\n            const normalizedTemp = (temp - minTemp) / (tempRange || 1);\n            const y = height - padding - normalizedTemp * graphHeight;\n            \n            const color = getTemperatureColor(temp);\n            ctx.fillStyle = `rgb(${color.r}, ${color.g}, ${color.b})`;\n            ctx.beginPath();\n            ctx.arc(x, y, 4, 0, 2 * Math.PI);\n            ctx.fill();\n            ctx.strokeStyle = '#fff';\n            ctx.lineWidth = 1;\n            ctx.stroke();\n        }\n    }\n}\n\n// Animation loop\nfunction animate() {\n    if (state.isRunning) {\n        updateTemperature();\n        draw();\n        state.animationId = requestAnimationFrame(animate);\n    }\n}\n\n// Event listeners for controls\ndocument.getElementById('alpha').addEventListener('input', (e) => {\n    state.alpha = Math.pow(10, parseFloat(e.target.value));\n    document.getElementById('alpha-value').textContent = state.alpha.toExponential(2);\n    updateStabilityIndicator();\n    if (!state.isRunning) {\n        initializeTemperature();\n        draw();\n    }\n});\n\ndocument.getElementById('length').addEventListener('input', (e) => {\n    state.L = parseFloat(e.target.value);\n    document.getElementById('length-value').textContent = state.L.toFixed(2);\n    updateStabilityIndicator();\n    if (!state.isRunning) {\n        initializeTemperature();\n        draw();\n    }\n});\n\ndocument.getElementById('dx').addEventListener('input', (e) => {\n    state.dx = parseFloat(e.target.value);\n    document.getElementById('dx-value').textContent = state.dx.toFixed(3);\n    updateStabilityIndicator();\n    if (!state.isRunning) {\n        initializeTemperature();\n        draw();\n    }\n});\n\ndocument.getElementById('dt').addEventListener('input', (e) => {\n    state.dt = parseFloat(e.target.value);\n    document.getElementById('dt-value').textContent = state.dt.toFixed(3);\n    updateStabilityIndicator();\n});\n\ndocument.getElementById('temp-left').addEventListener('input', (e) => {\n    state.tempLeft = parseFloat(e.target.value);\n    document.getElementById('temp-left-value').textContent = state.tempLeft.toFixed(0);\n    if (!state.isRunning) {\n        initializeTemperature();\n        draw();\n    }\n});\n\ndocument.getElementById('temp-right').addEventListener('input', (e) => {\n    state.tempRight = parseFloat(e.target.value);\n    document.getElementById('temp-right-value').textContent = state.tempRight.toFixed(0);\n    if (!state.isRunning) {\n        initializeTemperature();\n        draw();\n    }\n});\n\ndocument.getElementById('temp-initial').addEventListener('input', (e) => {\n    state.tempInitial = parseFloat(e.target.value);\n    document.getElementById('temp-initial-value').textContent = state.tempInitial.toFixed(0);\n    if (!state.isRunning) {\n        initializeTemperature();\n        draw();\n    }\n});\n\ndocument.getElementById('start-btn').addEventListener('click', () => {\n    state.isRunning = true;\n    document.getElementById('start-btn').disabled = true;\n    document.getElementById('pause-btn').disabled = false;\n    animate();\n});\n\ndocument.getElementById('pause-btn').addEventListener('click', () => {\n    state.isRunning = false;\n    document.getElementById('start-btn').disabled = false;\n    document.getElementById('pause-btn').disabled = true;\n    if (state.animationId) {\n        cancelAnimationFrame(state.animationId);\n    }\n});\n\ndocument.getElementById('reset-btn').addEventListener('click', () => {\n    state.isRunning = false;\n    document.getElementById('start-btn').disabled = false;\n    document.getElementById('pause-btn').disabled = true;\n    if (state.animationId) {\n        cancelAnimationFrame(state.animationId);\n    }\n    initializeTemperature();\n    draw();\n});\n\n// Initialize\ninitializeTemperature();\nupdateStabilityIndicator();\ndraw();"}}
{"input": {"input_text": "Personal finance note: account with principal P, annual nominal rate r, compounded monthly for t years. Return end balance and effective annual yield.", "simulation_name": " Compound Interest Monthly", "domain": "Finance", "description": "Discrete monthly compounding", "assumptions": ["No fees"], "entities": [], "constants": [], "parameters": [{"name": "principal", "symbol": "P", "unit": "currency", "range": [10, 10000000.0]}, {"name": "annual_rate", "symbol": "r", "unit": "1/year", "range": [0, 0.5]}, {"name": "years", "symbol": "t", "unit": "year", "range": [0, 60]}], "equations": [{"description": "Monthly rate", "expression": "i = r/12"}, {"description": "Periods", "expression": "n = 12*t"}, {"description": "Future value", "expression": "A = P*(1 + i)^n"}, {"description": "Effective annual yield", "expression": "APY = (1 + i)^{12} - 1"}], "initial_conditions": {}, "outputs": ["A", "APY"], "simulation_controls": ["P", "r", "t"], "constraints": ["P >= 0", "r >= 0", "t >= 0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Compound Interest Simulator</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n\n<div class=\"dashboard\">\n    <header>\n        <h1>Compound Interest Calculator</h1>\n        <p>Monthly Compounding & Effective Yield</p>\n    </header>\n\n    <div class=\"main-content\">\n        <aside class=\"controls-panel\">\n            <div class=\"input-group\">\n                <label for=\"principal\">Principal Amount ($P$)</label>\n                <div class=\"range-wrapper\">\n                    <input type=\"range\" id=\"principal\" min=\"100\" max=\"100000\" step=\"100\" value=\"10000\">\n                    <input type=\"number\" id=\"principal-num\" min=\"0\" value=\"10000\">\n                </div>\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"rate\">Annual Rate ($r$ %)</label>\n                <div class=\"range-wrapper\">\n                    <input type=\"range\" id=\"rate\" min=\"0\" max=\"20\" step=\"0.1\" value=\"5.0\">\n                    <span class=\"unit-display\"><span id=\"rate-val\">5.0</span>%</span>\n                </div>\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"years\">Time Period ($t$ Years)</label>\n                <div class=\"range-wrapper\">\n                    <input type=\"range\" id=\"years\" min=\"1\" max=\"60\" step=\"1\" value=\"10\">\n                    <span class=\"unit-display\"><span id=\"years-val\">10</span> Years</span>\n                </div>\n            </div>\n\n            <div class=\"summary-card\">\n                <h3>Results</h3>\n                <div class=\"result-row\">\n                    <span>Future Value ($A$):</span>\n                    <span id=\"future-value\" class=\"highlight\">$0.00</span>\n                </div>\n                <div class=\"result-row\">\n                    <span>Total Interest:</span>\n                    <span id=\"total-interest\">$0.00</span>\n                </div>\n                <div class=\"result-row\">\n                    <span>Effective Annual Yield (APY):</span>\n                    <span id=\"apy-value\">0.00%</span>\n                </div>\n            </div>\n        </aside>\n\n        <section class=\"chart-panel\">\n            <canvas id=\"growthChart\"></canvas>\n            <div class=\"chart-legend\">\n                <span class=\"legend-item\"><span class=\"dot principal-dot\"></span>Principal</span>\n                <span class=\"legend-item\"><span class=\"dot interest-dot\"></span>Interest</span>\n            </div>\n        </section>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-color: #f0f2f5;\n    --card-bg: #ffffff;\n    --primary-color: #27ae60; /* Finance Green */\n    --accent-color: #2ecc71;\n    --text-color: #333;\n    --border-color: #ddd;\n    --chart-line: #27ae60;\n    --chart-fill: rgba(39, 174, 96, 0.2);\n}\n\n* {\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n    min-height: 100vh;\n}\n\n.dashboard {\n    width: 100%;\n    max-width: 1100px;\n    background: var(--card-bg);\n    border-radius: 12px;\n    box-shadow: 0 4px 20px rgba(0,0,0,0.08);\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n}\n\nheader {\n    background-color: #2c3e50;\n    color: white;\n    padding: 20px 30px;\n    text-align: center;\n}\n\nheader h1 {\n    margin: 0;\n    font-size: 1.8rem;\n    font-weight: 600;\n}\n\nheader p {\n    margin: 5px 0 0;\n    opacity: 0.8;\n    font-size: 0.9rem;\n}\n\n.main-content {\n    display: flex;\n    flex-wrap: wrap;\n    flex: 1;\n}\n\n/* Controls Panel */\n.controls-panel {\n    flex: 1;\n    min-width: 300px;\n    padding: 30px;\n    border-right: 1px solid var(--border-color);\n    background-color: #fcfcfc;\n    display: flex;\n    flex-direction: column;\n    gap: 25px;\n}\n\n.input-group label {\n    display: block;\n    font-weight: 600;\n    margin-bottom: 8px;\n    color: #555;\n}\n\n.range-wrapper {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\ninput[type=\"range\"] {\n    flex: 1;\n    cursor: pointer;\n    accent-color: var(--primary-color);\n}\n\ninput[type=\"number\"] {\n    width: 80px;\n    padding: 5px;\n    border: 1px solid #ccc;\n    border-radius: 4px;\n    font-size: 1rem;\n}\n\n.unit-display {\n    width: 80px;\n    text-align: right;\n    font-weight: bold;\n    color: var(--primary-color);\n}\n\n.summary-card {\n    margin-top: auto;\n    background: #e8f8f5;\n    padding: 20px;\n    border-radius: 8px;\n    border: 1px solid #d1f2eb;\n}\n\n.summary-card h3 {\n    margin-top: 0;\n    color: #16a085;\n    border-bottom: 1px solid #a2d9ce;\n    padding-bottom: 10px;\n}\n\n.result-row {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 12px;\n    font-size: 1rem;\n}\n\n.highlight {\n    font-weight: bold;\n    color: var(--primary-color);\n    font-size: 1.2rem;\n}\n\n/* Chart Panel */\n.chart-panel {\n    flex: 2;\n    min-width: 400px;\n    padding: 30px;\n    position: relative;\n    display: flex;\n    flex-direction: column;\n}\n\ncanvas {\n    width: 100%;\n    height: 100%;\n    min-height: 400px;\n    cursor: crosshair;\n}\n\n.chart-legend {\n    display: flex;\n    justify-content: center;\n    gap: 20px;\n    margin-top: 10px;\n}\n\n.legend-item {\n    display: flex;\n    align-items: center;\n    font-size: 0.9rem;\n    color: #666;\n}\n\n.dot {\n    width: 12px;\n    height: 12px;\n    border-radius: 50%;\n    margin-right: 6px;\n    display: inline-block;\n}\n\n.principal-dot { background-color: #bdc3c7; }\n.interest-dot { background-color: var(--primary-color); }\n\n@media (max-width: 768px) {\n    .main-content {\n        flex-direction: column;\n    }\n    .controls-panel {\n        border-right: none;\n        border-bottom: 1px solid var(--border-color);\n    }\n}", "js": "// --- Elements ---\nconst principalSlider = document.getElementById('principal');\nconst principalNum = document.getElementById('principal-num');\nconst rateSlider = document.getElementById('rate');\nconst rateVal = document.getElementById('rate-val');\nconst yearsSlider = document.getElementById('years');\nconst yearsVal = document.getElementById('years-val');\n\nconst futureValueEl = document.getElementById('future-value');\nconst totalInterestEl = document.getElementById('total-interest');\nconst apyValueEl = document.getElementById('apy-value');\n\nconst canvas = document.getElementById('growthChart');\nconst ctx = canvas.getContext('2d');\n\n// --- State ---\nlet P = 10000;    // Principal\nlet r = 0.05;     // Annual Nominal Rate (decimal)\nlet t = 10;       // Years\nlet animationFrameId;\nlet chartProgress = 0; // 0 to 1 for animation\n\n// --- Initialization ---\nfunction init() {\n    resizeCanvas();\n    updateValues();\n    animateChart(); // Start the loop\n}\n\n// --- Event Listeners ---\nprincipalSlider.addEventListener('input', (e) => {\n    P = parseFloat(e.target.value);\n    principalNum.value = P;\n    resetAnimation();\n});\n\nprincipalNum.addEventListener('input', (e) => {\n    let val = parseFloat(e.target.value);\n    if(val < 0) val = 0;\n    P = val;\n    principalSlider.value = val; // Might max out, but that's UI behavior\n    resetAnimation();\n});\n\nrateSlider.addEventListener('input', (e) => {\n    let val = parseFloat(e.target.value);\n    rateVal.textContent = val.toFixed(1);\n    r = val / 100;\n    resetAnimation();\n});\n\nyearsSlider.addEventListener('input', (e) => {\n    t = parseInt(e.target.value);\n    yearsVal.textContent = t;\n    resetAnimation();\n});\n\nwindow.addEventListener('resize', () => {\n    resizeCanvas();\n    drawChart(1); // Redraw immediately on resize\n});\n\nfunction resizeCanvas() {\n    // Make canvas sharp on high DPI screens\n    const dpr = window.devicePixelRatio || 1;\n    const rect = canvas.getBoundingClientRect();\n    \n    canvas.width = rect.width * dpr;\n    canvas.height = rect.height * dpr;\n    \n    ctx.scale(dpr, dpr);\n    \n    // Store CSS dimensions for logic\n    canvas.cssWidth = rect.width;\n    canvas.cssHeight = rect.height;\n}\n\nfunction resetAnimation() {\n    updateValues(); // Update text immediately\n    chartProgress = 0; // Reset chart drawing\n}\n\n// --- Logic ---\nfunction updateValues() {\n    const monthlyRate = r / 12;\n    const months = t * 12;\n    \n    // Future Value: A = P * (1 + i)^n\n    const A = P * Math.pow(1 + monthlyRate, months);\n    \n    // APY: (1 + i)^12 - 1\n    const apy = Math.pow(1 + monthlyRate, 12) - 1;\n\n    // Display formatted\n    futureValueEl.textContent = formatCurrency(A);\n    totalInterestEl.textContent = formatCurrency(A - P);\n    apyValueEl.textContent = (apy * 100).toFixed(2) + \"%\";\n}\n\nfunction formatCurrency(num) {\n    return new Intl.NumberFormat('en-US', {\n        style: 'currency',\n        currency: 'USD'\n    }).format(num);\n}\n\n// --- Animation Loop ---\nfunction animateChart() {\n    // Increment progress\n    if (chartProgress < 1) {\n        chartProgress += 0.02; // Animation speed\n        if (chartProgress > 1) chartProgress = 1;\n        drawChart(chartProgress);\n    }\n    \n    animationFrameId = requestAnimationFrame(animateChart);\n}\n\n// --- Drawing ---\nfunction drawChart(progress) {\n    const w = canvas.cssWidth;\n    const h = canvas.cssHeight;\n    const padding = { top: 20, right: 20, bottom: 40, left: 60 };\n    const chartW = w - padding.left - padding.right;\n    const chartH = h - padding.top - padding.bottom;\n\n    // Clear\n    ctx.clearRect(0, 0, w, h);\n\n    // Calc Data Points\n    const monthlyRate = r / 12;\n    const totalMonths = t * 12;\n    const dataPoints = [];\n    \n    // If t=0, just handle gracefully\n    if (totalMonths === 0) {\n        // Draw empty state or single point\n        return;\n    }\n\n    // Generate monthly data\n    for (let i = 0; i <= totalMonths; i++) {\n        const bal = P * Math.pow(1 + monthlyRate, i);\n        dataPoints.push(bal);\n    }\n\n    const maxVal = dataPoints[dataPoints.length - 1];\n    \n    // Scales\n    // X axis: 0 to totalMonths\n    // Y axis: 0 to maxVal * 1.1 (for headroom)\n    const yMax = maxVal > 0 ? maxVal * 1.1 : 100;\n    \n    // Helper to map coordinates\n    const getX = (monthIndex) => padding.left + (monthIndex / totalMonths) * chartW;\n    const getY = (val) => padding.top + chartH - (val / yMax) * chartH;\n\n    // 1. Draw Axes\n    ctx.beginPath();\n    ctx.strokeStyle = \"#ccc\";\n    ctx.lineWidth = 1;\n    \n    // Y Axis line\n    ctx.moveTo(padding.left, padding.top);\n    ctx.lineTo(padding.left, h - padding.bottom);\n    \n    // X Axis line\n    ctx.lineTo(w - padding.right, h - padding.bottom);\n    ctx.stroke();\n\n    // 2. Draw Grid & Labels\n    ctx.fillStyle = \"#666\";\n    ctx.font = \"10px sans-serif\";\n    ctx.textAlign = \"right\";\n    \n    // Y Grid (5 steps)\n    for(let i=0; i<=5; i++) {\n        const val = (yMax / 5) * i;\n        const yPos = getY(val);\n        \n        ctx.fillText(compactNumber(val), padding.left - 10, yPos + 3);\n        \n        ctx.beginPath();\n        ctx.strokeStyle = \"rgba(0,0,0,0.05)\";\n        ctx.moveTo(padding.left, yPos);\n        ctx.lineTo(w - padding.right, yPos);\n        ctx.stroke();\n    }\n\n    // X Labels (Years)\n    ctx.textAlign = \"center\";\n    const yearStep = Math.max(1, Math.floor(t / 5));\n    for (let yr = 0; yr <= t; yr += yearStep) {\n        const xPos = getX(yr * 12);\n        ctx.fillText(yr + \"y\", xPos, h - padding.bottom + 15);\n    }\n\n    // 3. Draw Curves\n    // We determine how many months to draw based on 'progress'\n    const currentMaxIndex = Math.floor(totalMonths * progress);\n    \n    if (currentMaxIndex > 0) {\n        // Area under the curve (Interest)\n        ctx.beginPath();\n        ctx.moveTo(getX(0), getY(0)); // bottom left\n        \n        for (let i = 0; i <= currentMaxIndex; i++) {\n            ctx.lineTo(getX(i), getY(dataPoints[i]));\n        }\n        \n        // Close shape for fill\n        ctx.lineTo(getX(currentMaxIndex), getY(0)); \n        ctx.closePath();\n        ctx.fillStyle = \"rgba(39, 174, 96, 0.2)\"; // Green tint\n        ctx.fill();\n\n        // The Principal Line (Flat dashed line or rect area at bottom)\n        // Let's draw principal as a gray area at the bottom distinct from interest\n        // Actually, better to just fill the whole area green (total balance),\n        // and draw a grey area for principal at the bottom.\n        \n        // Principal Area\n        const pY = getY(P);\n        ctx.beginPath();\n        ctx.moveTo(getX(0), getY(0));\n        ctx.lineTo(getX(0), pY);\n        ctx.lineTo(getX(currentMaxIndex), pY);\n        ctx.lineTo(getX(currentMaxIndex), getY(0));\n        ctx.fillStyle = \"rgba(189, 195, 199, 0.3)\"; // Gray tint\n        ctx.fill();\n        \n        // Total Balance Line stroke\n        ctx.beginPath();\n        ctx.strokeStyle = \"#27ae60\";\n        ctx.lineWidth = 3;\n        ctx.moveTo(getX(0), getY(dataPoints[0]));\n        for (let i = 1; i <= currentMaxIndex; i++) {\n            ctx.lineTo(getX(i), getY(dataPoints[i]));\n        }\n        ctx.stroke();\n    }\n}\n\nfunction compactNumber(num) {\n    return new Intl.NumberFormat('en-US', {\n        notation: \"compact\",\n        maximumFractionDigits: 1\n    }).format(num);\n}\n\n// Start\ninit();"}}
{"input": {"input_text": "Digital logic primer: a full adder combines bits A, B, and Cin. Provide equations for Sum and Cout using boolean algebra.", "simulation_name": " Full Adder", "domain": "Digital Logic", "description": "1-bit full adder equations", "assumptions": ["Binary inputs"], "entities": [], "constants": [], "parameters": [{"name": "input_A", "symbol": "A", "unit": "bit", "range": [0, 1]}, {"name": "input_B", "symbol": "B", "unit": "bit", "range": [0, 1]}, {"name": "carry_in", "symbol": "Cin", "unit": "bit", "range": [0, 1]}], "equations": [{"description": "Sum", "expression": "Sum = A xor B xor Cin"}, {"description": "Carry out", "expression": "Cout = (A*B) + (A*Cin) + (B*Cin)"}], "initial_conditions": {}, "outputs": ["Sum", "Cout"], "simulation_controls": ["A", "B", "Cin"], "constraints": ["Inputs in {0,1}"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>1-bit Full Adder Simulator</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1>1-bit Full Adder Simulator</h1>\n            <p class=\"subtitle\">Interactive Digital Logic Circuit</p>\n        </header>\n\n        <div class=\"main-content\">\n            <!-- Input Controls -->\n            <div class=\"input-panel\">\n                <h2>Inputs</h2>\n                <div class=\"input-group\">\n                    <label for=\"inputA\">Input A</label>\n                    <div class=\"toggle-wrapper\">\n                        <input type=\"checkbox\" id=\"inputA\" class=\"toggle-input\">\n                        <label for=\"inputA\" class=\"toggle-label\">\n                            <span class=\"toggle-value\">0</span>\n                        </label>\n                    </div>\n                </div>\n                <div class=\"input-group\">\n                    <label for=\"inputB\">Input B</label>\n                    <div class=\"toggle-wrapper\">\n                        <input type=\"checkbox\" id=\"inputB\" class=\"toggle-input\">\n                        <label for=\"inputB\" class=\"toggle-label\">\n                            <span class=\"toggle-value\">0</span>\n                        </label>\n                    </div>\n                </div>\n                <div class=\"input-group\">\n                    <label for=\"inputCin\">Carry In (Cin)</label>\n                    <div class=\"toggle-wrapper\">\n                        <input type=\"checkbox\" id=\"inputCin\" class=\"toggle-input\">\n                        <label for=\"inputCin\" class=\"toggle-label\">\n                            <span class=\"toggle-value\">0</span>\n                        </label>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Circuit Visualization -->\n            <div class=\"circuit-panel\">\n                <h2>Circuit Diagram</h2>\n                <svg id=\"circuit\" viewBox=\"0 0 600 400\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <!-- Input lines -->\n                    <line id=\"lineA\" x1=\"50\" y1=\"80\" x2=\"150\" y2=\"80\" class=\"wire\" />\n                    <line id=\"lineB\" x1=\"50\" y1=\"150\" x2=\"150\" y2=\"150\" class=\"wire\" />\n                    <line id=\"lineCin\" x1=\"50\" y1=\"220\" x2=\"150\" y2=\"220\" class=\"wire\" />\n                    \n                    <!-- XOR gate 1 (A XOR B) -->\n                    <path d=\"M 150 60 Q 180 60 180 115 Q 180 170 150 170 Q 165 115 150 60\" \n                          fill=\"none\" stroke=\"#4a5568\" stroke-width=\"2\"/>\n                    <path d=\"M 140 60 Q 155 115 140 170\" fill=\"none\" stroke=\"#4a5568\" stroke-width=\"2\"/>\n                    <line x1=\"150\" y1=\"80\" x2=\"180\" y2=\"95\" class=\"wire\"/>\n                    <line x1=\"150\" y1=\"150\" x2=\"180\" y2=\"135\" class=\"wire\"/>\n                    <line id=\"xor1Out\" x1=\"240\" y1=\"115\" x2=\"320\" y2=\"115\" class=\"wire\"/>\n                    <circle cx=\"240\" cy=\"115\" r=\"3\" fill=\"#4a5568\"/>\n                    \n                    <!-- XOR gate 2 (A XOR B XOR Cin) -->\n                    <path d=\"M 320 95 Q 350 95 350 150 Q 350 205 320 205 Q 335 150 320 95\" \n                          fill=\"none\" stroke=\"#4a5568\" stroke-width=\"2\"/>\n                    <path d=\"M 310 95 Q 325 150 310 205\" fill=\"none\" stroke=\"#4a5568\" stroke-width=\"2\"/>\n                    <line x1=\"320\" y1=\"115\" x2=\"350\" y2=\"130\" class=\"wire\"/>\n                    <line x1=\"150\" y1=\"220\" x2=\"300\" y2=\"220\" class=\"wire\"/>\n                    <line x1=\"300\" y1=\"220\" x2=\"350\" y2=\"170\" class=\"wire\"/>\n                    <line id=\"sumOut\" x1=\"410\" y1=\"150\" x2=\"550\" y2=\"150\" class=\"wire\"/>\n                    <circle cx=\"410\" cy=\"150\" r=\"3\" fill=\"#4a5568\"/>\n                    \n                    <!-- AND gates for Cout -->\n                    <!-- AND gate 1 (A AND B) -->\n                    <rect x=\"150\" y=\"260\" width=\"60\" height=\"40\" rx=\"5\" fill=\"none\" stroke=\"#4a5568\" stroke-width=\"2\"/>\n                    <line x1=\"150\" y1=\"80\" x2=\"120\" y2=\"80\" class=\"wire\"/>\n                    <line x1=\"120\" y1=\"80\" x2=\"120\" y2=\"270\" class=\"wire\"/>\n                    <line x1=\"120\" y1=\"270\" x2=\"150\" y2=\"270\" class=\"wire\"/>\n                    <line x1=\"150\" y1=\"150\" x2=\"100\" y2=\"150\" class=\"wire\"/>\n                    <line x1=\"100\" y1=\"150\" x2=\"100\" y2=\"290\" class=\"wire\"/>\n                    <line x1=\"100\" y1=\"290\" x2=\"150\" y2=\"290\" class=\"wire\"/>\n                    <line id=\"and1Out\" x1=\"210\" y1=\"280\" x2=\"380\" y2=\"280\" class=\"wire\"/>\n                    <circle cx=\"210\" cy=\"280\" r=\"3\" fill=\"#4a5568\"/>\n                    \n                    <!-- OR gate for final Cout -->\n                    <path d=\"M 380 260 Q 410 260 430 290 Q 410 320 380 320 Q 395 290 380 260\" \n                          fill=\"none\" stroke=\"#4a5568\" stroke-width=\"2\"/>\n                    <line x1=\"380\" y1=\"280\" x2=\"410\" y2=\"275\" class=\"wire\"/>\n                    <line x1=\"240\" y1=\"115\" x2=\"240\" y2=\"240\" class=\"wire\"/>\n                    <line x1=\"240\" y1=\"240\" x2=\"370\" y2=\"240\" class=\"wire\"/>\n                    <line x1=\"370\" y1=\"240\" x2=\"370\" y2=\"300\" class=\"wire\"/>\n                    <line x1=\"370\" y1=\"300\" x2=\"410\" y2=\"305\" class=\"wire\"/>\n                    <line id=\"coutOut\" x1=\"490\" y1=\"290\" x2=\"550\" y2=\"290\" class=\"wire\"/>\n                    <circle cx=\"490\" cy=\"290\" r=\"3\" fill=\"#4a5568\"/>\n                    \n                    <!-- Labels -->\n                    <text x=\"30\" y=\"85\" class=\"label\">A</text>\n                    <text x=\"30\" y=\"155\" class=\"label\">B</text>\n                    <text x=\"20\" y=\"225\" class=\"label\">Cin</text>\n                    <text x=\"165\" y=\"125\" class=\"gate-label\">XOR</text>\n                    <text x=\"335\" y=\"160\" class=\"gate-label\">XOR</text>\n                    <text x=\"165\" y=\"285\" class=\"gate-label\">AND</text>\n                    <text x=\"395\" y=\"295\" class=\"gate-label\">OR</text>\n                    <text x=\"555\" y=\"155\" class=\"label output-label\">Sum</text>\n                    <text x=\"555\" y=\"295\" class=\"label output-label\">Cout</text>\n                </svg>\n            </div>\n\n            <!-- Output Display -->\n            <div class=\"output-panel\">\n                <h2>Outputs</h2>\n                <div class=\"output-group\">\n                    <label>Sum</label>\n                    <div class=\"output-display\" id=\"sumDisplay\">0</div>\n                </div>\n                <div class=\"output-group\">\n                    <label>Carry Out (Cout)</label>\n                    <div class=\"output-display\" id=\"coutDisplay\">0</div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Equations Panel -->\n        <div class=\"equations-panel\">\n            <h2>Boolean Algebra Equations</h2>\n            <div class=\"equation-grid\">\n                <div class=\"equation-card\">\n                    <h3>Sum Output</h3>\n                    <div class=\"equation\">Sum = A ⊕ B ⊕ Cin</div>\n                    <p class=\"equation-desc\">XOR of all three inputs</p>\n                </div>\n                <div class=\"equation-card\">\n                    <h3>Carry Out</h3>\n                    <div class=\"equation\">Cout = (A·B) + (A·Cin) + (B·Cin)</div>\n                    <p class=\"equation-desc\">True when two or more inputs are 1</p>\n                </div>\n            </div>\n        </div>\n\n        <!-- Truth Table -->\n        <div class=\"truth-table-panel\">\n            <h2>Truth Table</h2>\n            <table class=\"truth-table\">\n                <thead>\n                    <tr>\n                        <th>A</th>\n                        <th>B</th>\n                        <th>Cin</th>\n                        <th>Sum</th>\n                        <th>Cout</th>\n                    </tr>\n                </thead>\n                <tbody id=\"truthTableBody\">\n                    <!-- Generated by JavaScript -->\n                </tbody>\n            </table>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    min-height: 100vh;\n    padding: 20px;\n    color: #2d3748;\n}\n\n.container {\n    max-width: 1400px;\n    margin: 0 auto;\n    background: white;\n    border-radius: 20px;\n    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n    overflow: hidden;\n}\n\nheader {\n    background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);\n    color: white;\n    padding: 30px;\n    text-align: center;\n}\n\nheader h1 {\n    font-size: 2.5em;\n    margin-bottom: 10px;\n    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);\n}\n\n.subtitle {\n    font-size: 1.2em;\n    opacity: 0.9;\n}\n\n.main-content {\n    display: grid;\n    grid-template-columns: 300px 1fr 300px;\n    gap: 20px;\n    padding: 30px;\n}\n\n@media (max-width: 1200px) {\n    .main-content {\n        grid-template-columns: 1fr;\n    }\n}\n\n/* Input Panel */\n.input-panel, .output-panel {\n    background: #f7fafc;\n    padding: 25px;\n    border-radius: 15px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);\n}\n\n.input-panel h2, .output-panel h2, .circuit-panel h2, .equations-panel h2, .truth-table-panel h2 {\n    font-size: 1.5em;\n    margin-bottom: 20px;\n    color: #5a67d8;\n    border-bottom: 3px solid #5a67d8;\n    padding-bottom: 10px;\n}\n\n.input-group, .output-group {\n    margin-bottom: 25px;\n}\n\n.input-group label, .output-group label {\n    display: block;\n    font-weight: 600;\n    margin-bottom: 10px;\n    color: #4a5568;\n}\n\n/* Toggle Switch */\n.toggle-wrapper {\n    position: relative;\n}\n\n.toggle-input {\n    display: none;\n}\n\n.toggle-label {\n    display: block;\n    width: 100px;\n    height: 50px;\n    background: #e2e8f0;\n    border-radius: 25px;\n    position: relative;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);\n}\n\n.toggle-label::after {\n    content: '';\n    position: absolute;\n    width: 42px;\n    height: 42px;\n    background: white;\n    border-radius: 50%;\n    top: 4px;\n    left: 4px;\n    transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);\n    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);\n}\n\n.toggle-value {\n    position: absolute;\n    right: 15px;\n    top: 50%;\n    transform: translateY(-50%);\n    font-weight: bold;\n    font-size: 1.3em;\n    color: #718096;\n    transition: all 0.3s ease;\n}\n\n.toggle-input:checked + .toggle-label {\n    background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);\n}\n\n.toggle-input:checked + .toggle-label::after {\n    left: 54px;\n}\n\n.toggle-input:checked + .toggle-label .toggle-value {\n    left: 15px;\n    right: auto;\n    color: white;\n}\n\n/* Circuit Panel */\n.circuit-panel {\n    background: #f7fafc;\n    padding: 25px;\n    border-radius: 15px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);\n}\n\n#circuit {\n    width: 100%;\n    height: auto;\n    background: white;\n    border-radius: 10px;\n    padding: 20px;\n}\n\n.wire {\n    stroke: #cbd5e0;\n    stroke-width: 3;\n    transition: stroke 0.3s ease;\n}\n\n.wire.active {\n    stroke: #48bb78;\n    stroke-width: 4;\n    filter: drop-shadow(0 0 8px #48bb78);\n    animation: pulse 0.5s ease;\n}\n\n@keyframes pulse {\n    0%, 100% { opacity: 1; }\n    50% { opacity: 0.6; }\n}\n\n.label {\n    font-size: 16px;\n    font-weight: bold;\n    fill: #4a5568;\n}\n\n.gate-label {\n    font-size: 12px;\n    font-weight: 600;\n    fill: #5a67d8;\n}\n\n.output-label {\n    fill: #38a169;\n}\n\n/* Output Display */\n.output-display {\n    width: 100px;\n    height: 60px;\n    background: #2d3748;\n    border-radius: 10px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 2em;\n    font-weight: bold;\n    color: #e2e8f0;\n    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);\n    transition: all 0.3s ease;\n}\n\n.output-display.active {\n    background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);\n    color: white;\n    box-shadow: 0 0 20px rgba(72, 187, 120, 0.6);\n    transform: scale(1.05);\n}\n\n/* Equations Panel */\n.equations-panel {\n    padding: 30px;\n    background: linear-gradient(135deg, #edf2f7 0%, #e2e8f0 100%);\n}\n\n.equation-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n    gap: 20px;\n}\n\n.equation-card {\n    background: white;\n    padding: 25px;\n    border-radius: 15px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    transition: transform 0.3s ease, box-shadow 0.3s ease;\n}\n\n.equation-card:hover {\n    transform: translateY(-5px);\n    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);\n}\n\n.equation-card h3 {\n    color: #5a67d8;\n    margin-bottom: 15px;\n    font-size: 1.3em;\n}\n\n.equation {\n    font-family: 'Courier New', monospace;\n    font-size: 1.2em;\n    background: #f7fafc;\n    padding: 15px;\n    border-radius: 8px;\n    margin-bottom: 10px;\n    border-left: 4px solid #5a67d8;\n    color: #2d3748;\n}\n\n.equation-desc {\n    color: #718096;\n    font-size: 0.95em;\n    font-style: italic;\n}\n\n/* Truth Table */\n.truth-table-panel {\n    padding: 30px;\n    background: white;\n}\n\n.truth-table {\n    width: 100%;\n    border-collapse: separate;\n    border-spacing: 0;\n    background: white;\n    border-radius: 10px;\n    overflow: hidden;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n}\n\n.truth-table thead {\n    background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);\n    color: white;\n}\n\n.truth-table th {\n    padding: 15px;\n    font-weight: 600;\n    text-align: center;\n    font-size: 1.1em;\n}\n\n.truth-table td {\n    padding: 12px;\n    text-align: center;\n    border-bottom: 1px solid #e2e8f0;\n    font-size: 1.05em;\n    transition: background 0.3s ease;\n}\n\n.truth-table tbody tr:hover {\n    background: #f7fafc;\n}\n\n.truth-table tbody tr.highlight {\n    background: linear-gradient(90deg, #c6f6d5 0%, #9ae6b4 100%);\n    animation: highlightRow 0.5s ease;\n}\n\n@keyframes highlightRow {\n    0% { transform: scale(1); }\n    50% { transform: scale(1.02); }\n    100% { transform: scale(1); }\n}\n\n.truth-table tbody tr:last-child td {\n    border-bottom: none;\n}", "js": "// Full Adder Simulator Logic\nclass FullAdder {\n    constructor() {\n        this.A = 0;\n        this.B = 0;\n        this.Cin = 0;\n        this.Sum = 0;\n        this.Cout = 0;\n        \n        this.initializeElements();\n        this.attachEventListeners();\n        this.generateTruthTable();\n        this.updateCircuit();\n    }\n    \n    initializeElements() {\n        this.inputA = document.getElementById('inputA');\n        this.inputB = document.getElementById('inputB');\n        this.inputCin = document.getElementById('inputCin');\n        this.sumDisplay = document.getElementById('sumDisplay');\n        this.coutDisplay = document.getElementById('coutDisplay');\n        \n        // Wire elements\n        this.wires = {\n            lineA: document.getElementById('lineA'),\n            lineB: document.getElementById('lineB'),\n            lineCin: document.getElementById('lineCin'),\n            xor1Out: document.getElementById('xor1Out'),\n            sumOut: document.getElementById('sumOut'),\n            and1Out: document.getElementById('and1Out'),\n            coutOut: document.getElementById('coutOut')\n        };\n    }\n    \n    attachEventListeners() {\n        this.inputA.addEventListener('change', () => this.handleInputChange('A'));\n        this.inputB.addEventListener('change', () => this.handleInputChange('B'));\n        this.inputCin.addEventListener('change', () => this.handleInputChange('Cin'));\n    }\n    \n    handleInputChange(input) {\n        // Update value\n        this[input] = this[`input${input}`].checked ? 1 : 0;\n        \n        // Update toggle display\n        const label = this[`input${input}`].nextElementSibling;\n        const valueSpan = label.querySelector('.toggle-value');\n        valueSpan.textContent = this[input];\n        \n        // Animate toggle\n        label.style.transform = 'scale(1.1)';\n        setTimeout(() => {\n            label.style.transform = 'scale(1)';\n        }, 200);\n        \n        // Calculate and update circuit\n        this.calculate();\n        this.updateCircuit();\n        this.highlightTruthTableRow();\n    }\n    \n    calculate() {\n        // Sum = A XOR B XOR Cin\n        this.Sum = this.A ^ this.B ^ this.Cin;\n        \n        // Cout = (A AND B) OR (A AND Cin) OR (B AND Cin)\n        this.Cout = (this.A & this.B) | (this.A & this.Cin) | (this.B & this.Cin);\n        \n        // Update output displays\n        this.updateOutputDisplay(this.sumDisplay, this.Sum);\n        this.updateOutputDisplay(this.coutDisplay, this.Cout);\n    }\n    \n    updateOutputDisplay(element, value) {\n        element.textContent = value;\n        \n        if (value === 1) {\n            element.classList.add('active');\n        } else {\n            element.classList.remove('active');\n        }\n        \n        // Animate output change\n        element.style.transform = 'scale(1.15)';\n        setTimeout(() => {\n            element.style.transform = 'scale(1)';\n        }, 300);\n    }\n    \n    updateCircuit() {\n        // Calculate intermediate values\n        const xor1 = this.A ^ this.B;  // A XOR B\n        const and1 = this.A & this.B;  // A AND B\n        \n        // Update wire states with animation\n        this.updateWire('lineA', this.A);\n        this.updateWire('lineB', this.B);\n        this.updateWire('lineCin', this.Cin);\n        \n        setTimeout(() => {\n            this.updateWire('xor1Out', xor1);\n            this.updateWire('and1Out', and1);\n        }, 150);\n        \n        setTimeout(() => {\n            this.updateWire('sumOut', this.Sum);\n            this.updateWire('coutOut', this.Cout);\n        }, 300);\n    }\n    \n    updateWire(wireId, active) {\n        const wire = this.wires[wireId];\n        if (!wire) return;\n        \n        if (active === 1) {\n            wire.classList.add('active');\n        } else {\n            wire.classList.remove('active');\n        }\n    }\n    \n    generateTruthTable() {\n        const tbody = document.getElementById('truthTableBody');\n        tbody.innerHTML = '';\n        \n        // Generate all 8 combinations (2^3)\n        for (let i = 0; i < 8; i++) {\n            const a = (i >> 2) & 1;\n            const b = (i >> 1) & 1;\n            const cin = i & 1;\n            \n            const sum = a ^ b ^ cin;\n            const cout = (a & b) | (a & cin) | (b & cin);\n            \n            const row = document.createElement('tr');\n            row.dataset.a = a;\n            row.dataset.b = b;\n            row.dataset.cin = cin;\n            \n            row.innerHTML = `\n                <td>${a}</td>\n                <td>${b}</td>\n                <td>${cin}</td>\n                <td style=\"color: #38a169; font-weight: bold;\">${sum}</td>\n                <td style=\"color: #5a67d8; font-weight: bold;\">${cout}</td>\n            `;\n            \n            tbody.appendChild(row);\n        }\n    }\n    \n    highlightTruthTableRow() {\n        const rows = document.querySelectorAll('#truthTableBody tr');\n        \n        rows.forEach(row => {\n            const a = parseInt(row.dataset.a);\n            const b = parseInt(row.dataset.b);\n            const cin = parseInt(row.dataset.cin);\n            \n            if (a === this.A && b === this.B && cin === this.Cin) {\n                row.classList.add('highlight');\n                \n                // Scroll to row if not visible\n                row.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n                \n                // Remove highlight after animation\n                setTimeout(() => {\n                    row.classList.remove('highlight');\n                }, 1500);\n            }\n        });\n    }\n}\n\n// Initialize the full adder when page loads\ndocument.addEventListener('DOMContentLoaded', () => {\n    new FullAdder();\n});"}}
{"input": {"input_text": "Circuit note: RL series circuit driven by DC step V. Compute current transient i(t).", "simulation_name": " RL Step Response", "domain": "Electrical Engineering", "description": "First-order RL charging current", "assumptions": ["Ideal inductor and resistor"], "entities": [{"name": "inductor", "inductance": {"symbol": "L", "unit": "H", "range": [1e-06, 1]}}, {"name": "resistor", "resistance": {"symbol": "R", "unit": "ohm", "range": [1, 10000.0]}}], "constants": [], "parameters": [{"name": "source_voltage", "symbol": "V", "unit": "V", "range": [0, 60]}], "equations": [{"description": "Time constant", "expression": "tau = L/R"}, {"description": "Current", "expression": "i(t) = (V/R)*(1 - exp(-R*t/L))"}], "initial_conditions": {"i": 0, "t": 0}, "outputs": ["i"], "simulation_controls": ["V", "L", "R"], "constraints": ["L > 0", "R > 0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>RL Circuit Step Response Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n\n    <div class=\"container\">\n        <header>\n            <h1>RL Series Circuit Response</h1>\n            <p>Transient Current Analysis: $i(t) = \\frac{V}{R}(1 - e^{-(R/L)t})$</p>\n        </header>\n\n        <div class=\"simulation-grid\">\n            <aside class=\"controls\">\n                <div class=\"control-group\">\n                    <label for=\"voltage\">Source Voltage ($V$)</label>\n                    <div class=\"slider-container\">\n                        <input type=\"range\" id=\"voltage\" min=\"1\" max=\"60\" step=\"1\" value=\"10\">\n                        <span id=\"val-v\" class=\"value-display\">10 V</span>\n                    </div>\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"resistance\">Resistance ($R$)</label>\n                    <div class=\"slider-container\">\n                        <input type=\"range\" id=\"resistance\" min=\"1\" max=\"100\" step=\"1\" value=\"10\">\n                        <span id=\"val-r\" class=\"value-display\">10 &Omega;</span>\n                    </div>\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"inductance\">Inductance ($L$)</label>\n                    <div class=\"slider-container\">\n                        <input type=\"range\" id=\"inductance\" min=\"1\" max=\"1000\" step=\"10\" value=\"500\">\n                        <span id=\"val-l\" class=\"value-display\">500 mH</span>\n                    </div>\n                </div>\n\n                <div class=\"stats-box\">\n                    <h3>Circuit Parameters</h3>\n                    <p>Time Constant ($\\tau = L/R$): <span id=\"stat-tau\">0.00</span> ms</p>\n                    <p>Max Current ($I_{max} = V/R$): <span id=\"stat-imax\">0.00</span> A</p>\n                </div>\n                \n                <button id=\"reset-anim\">Restart Animation</button>\n            </aside>\n\n            <main class=\"visuals\">\n                <div class=\"canvas-wrapper\">\n                    <div class=\"canvas-label\">Circuit Diagram (Animated)</div>\n                    <canvas id=\"circuitCanvas\"></canvas>\n                </div>\n                <div class=\"canvas-wrapper\">\n                    <div class=\"canvas-label\">Current vs. Time ($i(t)$)</div>\n                    <canvas id=\"graphCanvas\"></canvas>\n                </div>\n            </main>\n        </div>\n    </div>\n\n    <script>\n        window.MathJax = { tex: { inlineMath: [['$', '$'], ['\\\\(', '\\\\)']] } };\n    </script>\n    <script src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\" async></script>\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary: #2980b9;\n    --secondary: #2c3e50;\n    --accent: #e74c3c;\n    --bg: #ecf0f1;\n    --panel-bg: #ffffff;\n    --border: #bdc3c7;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg);\n    color: var(--secondary);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n    min-height: 100vh;\n}\n\n.container {\n    width: 100%;\n    max-width: 1100px;\n    background-color: var(--panel-bg);\n    border-radius: 8px;\n    box-shadow: 0 4px 15px rgba(0,0,0,0.1);\n    padding: 20px;\n}\n\nheader {\n    text-align: center;\n    border-bottom: 2px solid var(--bg);\n    margin-bottom: 20px;\n    padding-bottom: 10px;\n}\n\nheader h1 {\n    margin: 0;\n    font-size: 1.8rem;\n}\n\nheader p {\n    color: #7f8c8d;\n    font-size: 1rem;\n    margin-top: 5px;\n}\n\n.simulation-grid {\n    display: grid;\n    grid-template-columns: 300px 1fr;\n    gap: 30px;\n}\n\n/* Controls Panel */\n.controls {\n    background-color: #f8f9fa;\n    padding: 20px;\n    border-radius: 6px;\n    border: 1px solid var(--border);\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.control-group label {\n    display: block;\n    font-weight: 600;\n    margin-bottom: 8px;\n    font-size: 0.9rem;\n}\n\n.slider-container {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\ninput[type=\"range\"] {\n    flex: 1;\n    cursor: pointer;\n}\n\n.value-display {\n    width: 70px;\n    text-align: right;\n    font-family: 'Courier New', monospace;\n    font-weight: bold;\n    color: var(--primary);\n    font-size: 0.9rem;\n}\n\n.stats-box {\n    background-color: #e8f6f3;\n    border: 1px solid #d1f2eb;\n    padding: 15px;\n    border-radius: 6px;\n}\n\n.stats-box h3 {\n    margin: 0 0 10px 0;\n    font-size: 1rem;\n    color: #16a085;\n}\n\n.stats-box p {\n    margin: 5px 0;\n    font-size: 0.9rem;\n    display: flex;\n    justify-content: space-between;\n}\n\n.stats-box span {\n    font-weight: bold;\n    font-family: monospace;\n}\n\nbutton#reset-anim {\n    background-color: var(--primary);\n    color: white;\n    border: none;\n    padding: 10px;\n    border-radius: 4px;\n    cursor: pointer;\n    font-weight: 600;\n    transition: background 0.2s;\n}\n\nbutton#reset-anim:hover {\n    background-color: #1a5276;\n}\n\n/* Visuals Area */\n.visuals {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.canvas-wrapper {\n    position: relative;\n    border: 1px solid var(--border);\n    border-radius: 4px;\n    overflow: hidden;\n    background: #fff;\n}\n\n.canvas-label {\n    position: absolute;\n    top: 5px;\n    left: 10px;\n    background: rgba(255, 255, 255, 0.8);\n    padding: 2px 6px;\n    font-size: 0.8rem;\n    font-weight: bold;\n    color: #555;\n    border-radius: 4px;\n    pointer-events: none;\n}\n\ncanvas {\n    display: block;\n    width: 100%;\n}\n\n#circuitCanvas {\n    height: 180px;\n    background: #fafafa;\n}\n\n#graphCanvas {\n    height: 300px;\n}\n\n@media (max-width: 800px) {\n    .simulation-grid {\n        grid-template-columns: 1fr;\n    }\n}", "js": "// --- Constants & Setup ---\nconst circuitCanvas = document.getElementById('circuitCanvas');\nconst graphCanvas = document.getElementById('graphCanvas');\nconst ctxCircuit = circuitCanvas.getContext('2d');\nconst ctxGraph = graphCanvas.getContext('2d');\n\n// Input Elements\nconst inV = document.getElementById('voltage');\nconst inR = document.getElementById('resistance');\nconst inL = document.getElementById('inductance');\n\n// Display Elements\nconst valV = document.getElementById('val-v');\nconst valR = document.getElementById('val-r');\nconst valL = document.getElementById('val-l');\nconst statTau = document.getElementById('stat-tau');\nconst statImax = document.getElementById('stat-imax');\nconst btnReset = document.getElementById('reset-anim');\n\n// Simulation State\nlet V = 10;     // Volts\nlet R = 10;     // Ohms\nlet L = 0.5;    // Henrys (Input is mH)\nlet tau = 0.05; // Seconds\nlet Imax = 1.0; // Amps\n\n// Animation State\nlet timeOffset = 0; // For circuit electron flow\nlet graphTime = 0;  // For graph plotting animation\nlet isAnimating = true;\n\n// --- Initialization ---\nfunction init() {\n    resizeCanvases();\n    window.addEventListener('resize', resizeCanvases);\n    \n    // Listeners\n    inV.addEventListener('input', updateParams);\n    inR.addEventListener('input', updateParams);\n    inL.addEventListener('input', updateParams);\n    btnReset.addEventListener('click', () => {\n        graphTime = 0;\n    });\n\n    updateParams();\n    animate();\n}\n\nfunction resizeCanvases() {\n    // Set actual canvas pixel size based on CSS size for sharpness\n    const dpr = window.devicePixelRatio || 1;\n    \n    [circuitCanvas, graphCanvas].forEach(can => {\n        const rect = can.getBoundingClientRect();\n        can.width = rect.width * dpr;\n        can.height = rect.height * dpr;\n        const ctx = can.getContext('2d');\n        ctx.scale(dpr, dpr);\n    });\n}\n\nfunction updateParams() {\n    // Read Values\n    V = parseFloat(inV.value);\n    R = parseFloat(inR.value);\n    L = parseFloat(inL.value) / 1000; // Convert mH to H\n\n    // Calculate Physics\n    tau = L / R;\n    Imax = V / R;\n\n    // Update UI\n    valV.textContent = `${V} V`;\n    valR.textContent = `${R} \\u03A9`;\n    valL.textContent = `${(L*1000).toFixed(0)} mH`;\n    \n    statTau.textContent = (tau * 1000).toFixed(2); // in ms\n    statImax.textContent = Imax.toFixed(2);\n\n    // Reset graph animation slightly to show change effect\n    // graphTime = 0; // Optional: uncomment if you want full redraw on every slide\n}\n\n// --- Animation Loop ---\nfunction animate() {\n    const dpr = window.devicePixelRatio || 1;\n    const cWidth = circuitCanvas.width / dpr;\n    const cHeight = circuitCanvas.height / dpr;\n    const gWidth = graphCanvas.width / dpr;\n    const gHeight = graphCanvas.height / dpr;\n\n    // Clear Canvases\n    ctxCircuit.clearRect(0, 0, cWidth, cHeight);\n    ctxGraph.clearRect(0, 0, gWidth, gHeight);\n\n    // 1. Draw Circuit\n    drawCircuit(ctxCircuit, cWidth, cHeight);\n\n    // 2. Draw Graph\n    drawGraph(ctxGraph, gWidth, gHeight);\n\n    // Increment Animation Counters\n    // Speed of electron flow proportional to current magnitude (visual approximation)\n    // We use Imax for steady state flow visualization\n    timeOffset -= (Imax * 2 + 0.5); \n    \n    // Graph tracer progression\n    // We want the tracer to traverse 5*tau in about 2-3 seconds real time\n    const timeToComplete = 2000; // ms\n    const totalSimTime = 5 * tau;\n    const dt = totalSimTime / (timeToComplete / 16); // 16ms per frame approx\n    \n    if (graphTime < 5 * tau) {\n        graphTime += dt;\n    } else {\n        graphTime = 5 * tau; // Clamp at end\n    }\n\n    requestAnimationFrame(animate);\n}\n\n// --- Drawing Functions ---\n\nfunction drawCircuit(ctx, w, h) {\n    const pad = 40;\n    const rectW = w - pad * 2;\n    const rectH = h - pad * 2;\n    const startX = pad;\n    const startY = pad;\n\n    ctx.strokeStyle = \"#333\";\n    ctx.lineWidth = 2;\n    ctx.lineJoin = \"round\";\n\n    // Define circuit path points\n    const tl = {x: startX, y: startY};\n    const bl = {x: startX, y: startY + rectH};\n    const tr = {x: startX + rectW, y: startY};\n    const br = {x: startX + rectW, y: startY + rectH};\n\n    // Draw Wires (Broken for components)\n    ctx.beginPath();\n    \n    // Left vertical (Source V)\n    ctx.moveTo(tl.x, tl.y);\n    ctx.lineTo(tl.x, bl.y);\n\n    // Bottom horizontal\n    ctx.moveTo(bl.x, bl.y);\n    ctx.lineTo(br.x, br.y);\n\n    // Right vertical (Inductor L)\n    ctx.moveTo(br.x, br.y);\n    ctx.lineTo(br.x, br.y - rectH/2 + 20); // break for inductor\n    ctx.moveTo(tr.x, tr.y + rectH/2 - 20);\n    ctx.lineTo(tr.x, tr.y);\n\n    // Top horizontal (Resistor R)\n    ctx.moveTo(tr.x, tr.y);\n    ctx.lineTo(tl.x + rectW/2 + 30, tl.y); // break for resistor\n    ctx.moveTo(tl.x + rectW/2 - 30, tl.y);\n    ctx.lineTo(tl.x, tl.y);\n    \n    ctx.stroke();\n\n    // Draw Source (Battery)\n    drawBattery(ctx, tl.x, tl.y + rectH/2, 20);\n\n    // Draw Resistor (Top Center)\n    drawResistor(ctx, tl.x + rectW/2, tl.y, 60);\n    ctx.fillStyle = \"#e74c3c\";\n    ctx.font = \"bold 14px sans-serif\";\n    ctx.fillText(\"R\", tl.x + rectW/2 - 5, tl.y - 15);\n\n    // Draw Inductor (Right Center)\n    drawInductor(ctx, tr.x, tr.y + rectH/2, 40);\n    ctx.fillStyle = \"#2980b9\";\n    ctx.fillText(\"L\", tr.x + 15, tr.y + rectH/2 + 5);\n\n    // Animate \"Current\" (Electrons/Charge carriers)\n    // We simulate dots moving along the path\n    // Path perimeter approx\n    const perimeter = 2 * (rectW + rectH);\n    \n    ctx.save();\n    // Only clip to the wire path roughly to hide dots at corners effectively\n    ctx.beginPath();\n    ctx.rect(pad-5, pad-5, rectW+10, rectH+10);\n    ctx.clip();\n\n    ctx.fillStyle = \"#f1c40f\"; // Yellow dots\n    const dotSpacing = 30;\n    \n    for (let i = 0; i < perimeter; i += dotSpacing) {\n        let dist = (i + timeOffset) % perimeter;\n        if (dist < 0) dist += perimeter;\n        \n        // Map distance to coordinate\n        let pos = getPathPos(dist, tl, tr, br, bl, rectW, rectH);\n        \n        // Calculate current intensity at specific time for graph consistency?\n        // No, circuit view usually shows steady state direction or max flow.\n        // Let's scale opacity by I_max to show intensity\n        ctx.globalAlpha = Math.min(1, Imax / 2 + 0.2); \n        \n        ctx.beginPath();\n        ctx.arc(pos.x, pos.y, 3, 0, Math.PI*2);\n        ctx.fill();\n    }\n    ctx.restore();\n}\n\nfunction getPathPos(d, tl, tr, br, bl, w, h) {\n    // Clockwise direction starting top-left\n    if (d < w) return {x: tl.x + d, y: tl.y}; // Top\n    d -= w;\n    if (d < h) return {x: tr.x, y: tr.y + d}; // Right\n    d -= h;\n    if (d < w) return {x: br.x - d, y: br.y}; // Bottom\n    d -= w;\n    return {x: bl.x, y: bl.y - d}; // Left\n}\n\nfunction drawBattery(ctx, x, y, size) {\n    ctx.beginPath();\n    // Long bar\n    ctx.moveTo(x - 10, y - size/2);\n    ctx.lineTo(x + 10, y - size/2);\n    // Short bar\n    ctx.moveTo(x - 6, y + size/2);\n    ctx.lineTo(x + 6, y + size/2);\n    \n    ctx.lineWidth = 3;\n    ctx.stroke();\n    ctx.lineWidth = 2; // reset\n    \n    ctx.font = \"12px sans-serif\";\n    ctx.fillStyle = \"#333\";\n    ctx.fillText(\"+\", x - 15, y - size/2 + 4);\n    ctx.fillText(\"V\", x - 25, y + 4);\n}\n\nfunction drawResistor(ctx, x, y, len) {\n    // Zigzag\n    const zigSize = 5;\n    const segs = 6;\n    const step = len / segs;\n    const startX = x - len/2;\n    \n    ctx.beginPath();\n    ctx.moveTo(startX, y);\n    for(let i=0; i<segs; i++) {\n        let ty = (i%2 === 0) ? y - zigSize : y + zigSize;\n        ctx.lineTo(startX + (i+0.5)*step, ty);\n    }\n    ctx.lineTo(x + len/2, y);\n    ctx.stroke();\n}\n\nfunction drawInductor(ctx, x, y, len) {\n    // Coils\n    const coils = 4;\n    const r = len / (coils * 2);\n    const startY = y - len/2;\n    \n    ctx.beginPath();\n    for(let i=0; i<coils; i++) {\n        // Draw semi-circles\n        ctx.arc(x, startY + r + (i*r*2), r, 1.5*Math.PI, 0.5*Math.PI, false);\n    }\n    ctx.stroke();\n}\n\nfunction drawGraph(ctx, w, h) {\n    const padL = 50;\n    const padB = 30;\n    const padT = 20;\n    const padR = 20;\n    \n    const drawW = w - padL - padR;\n    const drawH = h - padT - padB;\n\n    // --- Axes ---\n    ctx.beginPath();\n    ctx.strokeStyle = \"#aaa\";\n    ctx.lineWidth = 1;\n    // Y-axis\n    ctx.moveTo(padL, padT);\n    ctx.lineTo(padL, h - padB);\n    // X-axis\n    ctx.lineTo(w - padR, h - padB);\n    ctx.stroke();\n\n    // --- Labels ---\n    ctx.fillStyle = \"#555\";\n    ctx.font = \"11px sans-serif\";\n    ctx.textAlign = \"center\";\n    ctx.fillText(\"Time (t)\", w/2 + padL/2, h - 5);\n    \n    ctx.save();\n    ctx.translate(15, h/2);\n    ctx.rotate(-Math.PI/2);\n    ctx.fillText(\"Current (A)\", 0, 0);\n    ctx.restore();\n\n    // --- Plotting Logic ---\n    // Max X display: 5 * tau\n    // Max Y display: Imax * 1.2\n    \n    const maxT = 5 * tau; \n    const maxI = Imax * 1.2;\n\n    // Helper to map coordinates\n    const mapX = (t) => padL + (t / maxT) * drawW;\n    const mapY = (cur) => (h - padB) - (cur / maxI) * drawH;\n\n    // Draw Grid / Ticks\n    ctx.textAlign = \"right\";\n    ctx.textBaseline = \"middle\";\n    // Y Ticks\n    for(let i=0; i<=5; i++) {\n        let val = (maxI / 5) * i;\n        let y = mapY(val);\n        ctx.fillText(val.toFixed(2), padL - 5, y);\n        ctx.beginPath();\n        ctx.strokeStyle = \"rgba(0,0,0,0.05)\";\n        ctx.moveTo(padL, y);\n        ctx.lineTo(w-padR, y);\n        ctx.stroke();\n    }\n    \n    // X Ticks (time in ms)\n    ctx.textAlign = \"center\";\n    ctx.textBaseline = \"top\";\n    for(let i=0; i<=5; i++) {\n        let tVal = (maxT / 5) * i;\n        let x = mapX(tVal);\n        ctx.fillText((tVal*1000).toFixed(1), x, h - padB + 5);\n    }\n\n    // --- Draw Curve i(t) ---\n    ctx.beginPath();\n    ctx.strokeStyle = \"#e74c3c\";\n    ctx.lineWidth = 3;\n    \n    // We draw from t=0 to current animation time 'graphTime'\n    // To make the curve look smooth, we use small steps\n    const steps = 100;\n    \n    ctx.moveTo(mapX(0), mapY(0));\n    \n    for(let i=1; i<=steps; i++) {\n        let t = (graphTime / steps) * i;\n        // i(t) = (V/R) * (1 - e^(-Rt/L))\n        let cur = (V/R) * (1 - Math.exp((-R * t)/L));\n        \n        ctx.lineTo(mapX(t), mapY(cur));\n    }\n    ctx.stroke();\n\n    // --- Draw Current Point Marker ---\n    if (graphTime > 0) {\n        let cur = (V/R) * (1 - Math.exp((-R * graphTime)/L));\n        let px = mapX(graphTime);\n        let py = mapY(cur);\n        \n        ctx.beginPath();\n        ctx.fillStyle = \"#e74c3c\";\n        ctx.arc(px, py, 5, 0, Math.PI*2);\n        ctx.fill();\n        ctx.fillStyle = \"#fff\";\n        ctx.arc(px, py, 2, 0, Math.PI*2);\n        ctx.fill();\n        \n        // Show coordinate text\n        ctx.fillStyle = \"#333\";\n        ctx.font = \"bold 12px monospace\";\n        ctx.textAlign = \"left\";\n        ctx.fillText(`i=${cur.toFixed(2)}A`, px + 10, py);\n    }\n\n    // --- Draw Asymptote (Imax) ---\n    let yMax = mapY(Imax);\n    ctx.beginPath();\n    ctx.strokeStyle = \"#2980b9\";\n    ctx.setLineDash([5, 5]);\n    ctx.moveTo(padL, yMax);\n    ctx.lineTo(w - padR, yMax);\n    ctx.stroke();\n    ctx.setLineDash([]);\n    ctx.fillStyle = \"#2980b9\";\n    ctx.fillText(\"V/R\", w - padR - 20, yMax - 10);\n\n    // --- Draw Tau Marker (63.2%) ---\n    // i(tau) = 0.632 * Imax\n    if (graphTime >= tau) {\n        let iTau = 0.632 * Imax;\n        let xTau = mapX(tau);\n        let yTau = mapY(iTau);\n        \n        ctx.beginPath();\n        ctx.fillStyle = \"#27ae60\";\n        ctx.arc(xTau, yTau, 4, 0, Math.PI*2);\n        ctx.fill();\n        ctx.font = \"10px sans-serif\";\n        ctx.fillText(\"τ\", xTau, h - padB - 10);\n        \n        // Drop line\n        ctx.beginPath();\n        ctx.strokeStyle = \"#27ae60\";\n        ctx.lineWidth = 1;\n        ctx.moveTo(xTau, yTau);\n        ctx.lineTo(xTau, h - padB);\n        ctx.stroke();\n    }\n}\n\n// Start\ninit();"}}
{"input": {"input_text": "Power electronics: underdamped RLC series circuit given R, L, C, step voltage V. Provide capacitor voltage.", "simulation_name": " RLC Underdamped Step", "domain": "Electrical Engineering", "description": "Series RLC step response underdamped", "assumptions": ["Underdamped condition"], "entities": [], "constants": [], "parameters": [{"name": "resistance", "symbol": "R", "unit": "ohm", "range": [0.1, 1000.0]}, {"name": "inductance", "symbol": "L", "unit": "H", "range": [1e-06, 1]}, {"name": "capacitance", "symbol": "C", "unit": "F", "range": [1e-09, 0.01]}, {"name": "source_voltage", "symbol": "V", "unit": "V", "range": [0, 100]}], "equations": [{"description": "Natural frequency", "expression": "omega0 = 1/sqrt(L*C)"}, {"description": "Damping ratio", "expression": "zeta = R/(2)*sqrt(C/L)"}, {"description": "Damped frequency", "condition": "zeta < 1", "expression": "omega_d = omega0*sqrt(1 - zeta^2)"}, {"description": "Capacitor voltage", "expression": "vc(t) = V*(1 - (1/sqrt(1 - zeta^2))*exp(-zeta*omega0*t)*sin(omega_d*t + atan(sqrt(1 - zeta^2)/zeta)))"}], "initial_conditions": {"vc": 0, "i": 0, "t": 0}, "outputs": ["vc"], "simulation_controls": ["R", "L", "C", "V"], "constraints": ["zeta < 1"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>RLC Underdamped Step Response Simulator</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1>RLC Series Circuit - Underdamped Step Response</h1>\n            <p class=\"subtitle\">Interactive Power Electronics Simulation</p>\n        </header>\n\n        <div class=\"main-content\">\n            <!-- Circuit Diagram -->\n            <div class=\"circuit-section\">\n                <h2>Circuit Diagram</h2>\n                <svg id=\"circuit\" viewBox=\"0 0 600 300\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <!-- Voltage Source -->\n                    <circle cx=\"80\" cy=\"150\" r=\"40\" fill=\"none\" stroke=\"#4a5568\" stroke-width=\"3\"/>\n                    <text x=\"80\" y=\"145\" text-anchor=\"middle\" class=\"component-label\">V</text>\n                    <text x=\"80\" y=\"165\" text-anchor=\"middle\" class=\"value-label\" id=\"voltageLabel\">10V</text>\n                    <line x1=\"80\" y1=\"120\" x2=\"80\" y2=\"110\" stroke=\"#4a5568\" stroke-width=\"2\"/>\n                    <line x1=\"80\" y1=\"190\" x2=\"80\" y2=\"200\" stroke=\"#4a5568\" stroke-width=\"2\"/>\n                    \n                    <!-- Top Wire -->\n                    <line id=\"wire1\" x1=\"80\" y1=\"110\" x2=\"200\" y2=\"110\" class=\"wire\"/>\n                    \n                    <!-- Resistor -->\n                    <rect x=\"200\" y=\"100\" width=\"80\" height=\"20\" fill=\"none\" stroke=\"#4a5568\" stroke-width=\"2\"/>\n                    <line x1=\"205\" y1=\"100\" x2=\"205\" y2=\"120\" stroke=\"#4a5568\" stroke-width=\"1\"/>\n                    <line x1=\"215\" y1=\"100\" x2=\"215\" y2=\"120\" stroke=\"#4a5568\" stroke-width=\"1\"/>\n                    <line x1=\"225\" y1=\"100\" x2=\"225\" y2=\"120\" stroke=\"#4a5568\" stroke-width=\"1\"/>\n                    <line x1=\"235\" y1=\"100\" x2=\"235\" y2=\"120\" stroke=\"#4a5568\" stroke-width=\"1\"/>\n                    <text x=\"240\" y=\"95\" text-anchor=\"middle\" class=\"component-label\">R</text>\n                    <text x=\"240\" y=\"145\" text-anchor=\"middle\" class=\"value-label\" id=\"resistorLabel\">10Ω</text>\n                    \n                    <line id=\"wire2\" x1=\"280\" y1=\"110\" x2=\"350\" y2=\"110\" class=\"wire\"/>\n                    \n                    <!-- Inductor -->\n                    <path d=\"M 350 110 Q 355 100 360 110 Q 365 120 370 110 Q 375 100 380 110 Q 385 120 390 110 Q 395 100 400 110\" \n                          fill=\"none\" stroke=\"#4a5568\" stroke-width=\"3\"/>\n                    <text x=\"375\" y=\"95\" text-anchor=\"middle\" class=\"component-label\">L</text>\n                    <text x=\"375\" y=\"145\" text-anchor=\"middle\" class=\"value-label\" id=\"inductorLabel\">1mH</text>\n                    \n                    <line id=\"wire3\" x1=\"400\" y1=\"110\" x2=\"480\" y2=\"110\" class=\"wire\"/>\n                    \n                    <!-- Capacitor -->\n                    <line x1=\"480\" y1=\"90\" x2=\"480\" y2=\"130\" stroke=\"#4a5568\" stroke-width=\"3\"/>\n                    <line x1=\"490\" y1=\"90\" x2=\"490\" y2=\"130\" stroke=\"#4a5568\" stroke-width=\"3\"/>\n                    <text x=\"485\" y=\"80\" text-anchor=\"middle\" class=\"component-label\">C</text>\n                    <text x=\"485\" y=\"155\" text-anchor=\"middle\" class=\"value-label\" id=\"capacitorLabel\">10µF</text>\n                    \n                    <!-- Voltage indicator across capacitor -->\n                    <text x=\"520\" y=\"110\" class=\"voltage-indicator\" id=\"vcIndicator\">Vc = 0.0V</text>\n                    \n                    <!-- Bottom Wire -->\n                    <line id=\"wire4\" x1=\"490\" y1=\"110\" x2=\"520\" y2=\"110\" class=\"wire\"/>\n                    <line id=\"wire5\" x1=\"520\" y1=\"110\" x2=\"520\" y2=\"200\" class=\"wire\"/>\n                    <line id=\"wire6\" x1=\"520\" y1=\"200\" x2=\"80\" y2=\"200\" class=\"wire\"/>\n                    \n                    <!-- Current arrow -->\n                    <g id=\"currentArrow\" class=\"current-arrow\">\n                        <line x1=\"150\" y1=\"110\" x2=\"180\" y2=\"110\" stroke=\"#e53e3e\" stroke-width=\"2\" marker-end=\"url(#arrowhead)\"/>\n                        <text x=\"165\" y=\"100\" text-anchor=\"middle\" fill=\"#e53e3e\" font-size=\"14\" font-weight=\"bold\">i(t)</text>\n                    </g>\n                    \n                    <!-- Arrow marker -->\n                    <defs>\n                        <marker id=\"arrowhead\" markerWidth=\"10\" markerHeight=\"10\" refX=\"9\" refY=\"3\" orient=\"auto\">\n                            <polygon points=\"0 0, 10 3, 0 6\" fill=\"#e53e3e\"/>\n                        </marker>\n                    </defs>\n                </svg>\n            </div>\n\n            <!-- Control Panel -->\n            <div class=\"control-panel\">\n                <h2>Circuit Parameters</h2>\n                \n                <div class=\"control-group\">\n                    <label for=\"resistanceSlider\">Resistance (R): <span id=\"resistanceValue\">10</span> Ω</label>\n                    <input type=\"range\" id=\"resistanceSlider\" min=\"0.1\" max=\"100\" step=\"0.1\" value=\"10\">\n                </div>\n                \n                <div class=\"control-group\">\n                    <label for=\"inductanceSlider\">Inductance (L): <span id=\"inductanceValue\">1</span> mH</label>\n                    <input type=\"range\" id=\"inductanceSlider\" min=\"0.001\" max=\"100\" step=\"0.001\" value=\"1\">\n                </div>\n                \n                <div class=\"control-group\">\n                    <label for=\"capacitanceSlider\">Capacitance (C): <span id=\"capacitanceValue\">10</span> µF</label>\n                    <input type=\"range\" id=\"capacitanceSlider\" min=\"0.001\" max=\"1000\" step=\"0.001\" value=\"10\">\n                </div>\n                \n                <div class=\"control-group\">\n                    <label for=\"voltageSlider\">Source Voltage (V): <span id=\"voltageValue\">10</span> V</label>\n                    <input type=\"range\" id=\"voltageSlider\" min=\"1\" max=\"100\" step=\"1\" value=\"10\">\n                </div>\n\n                <div class=\"button-group\">\n                    <button id=\"startBtn\" class=\"btn btn-primary\">Start Simulation</button>\n                    <button id=\"resetBtn\" class=\"btn btn-secondary\">Reset</button>\n                </div>\n\n                <div class=\"status-indicator\">\n                    <div class=\"status-label\">Circuit Status:</div>\n                    <div id=\"statusText\" class=\"status-text\">Ready</div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Calculated Parameters -->\n        <div class=\"parameters-section\">\n            <h2>Calculated Parameters</h2>\n            <div class=\"param-grid\">\n                <div class=\"param-card\">\n                    <div class=\"param-label\">Natural Frequency (ω₀)</div>\n                    <div class=\"param-value\" id=\"omega0Value\">-</div>\n                </div>\n                <div class=\"param-card\">\n                    <div class=\"param-label\">Damping Ratio (ζ)</div>\n                    <div class=\"param-value\" id=\"zetaValue\">-</div>\n                </div>\n                <div class=\"param-card\">\n                    <div class=\"param-label\">Damped Frequency (ωd)</div>\n                    <div class=\"param-value\" id=\"omegadValue\">-</div>\n                </div>\n                <div class=\"param-card\">\n                    <div class=\"param-label\">Condition</div>\n                    <div class=\"param-value\" id=\"conditionValue\">-</div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Graph -->\n        <div class=\"graph-section\">\n            <h2>Capacitor Voltage vs Time</h2>\n            <canvas id=\"graphCanvas\"></canvas>\n            <div class=\"graph-controls\">\n                <label><input type=\"checkbox\" id=\"showGrid\" checked> Show Grid</label>\n                <label><input type=\"checkbox\" id=\"showPoints\" checked> Show Points</label>\n            </div>\n        </div>\n\n        <!-- Equations -->\n        <div class=\"equations-section\">\n            <h2>Mathematical Equations</h2>\n            <div class=\"equation-grid\">\n                <div class=\"equation-card\">\n                    <h3>Natural Frequency</h3>\n                    <div class=\"equation\">ω₀ = 1 / √(L·C)</div>\n                </div>\n                <div class=\"equation-card\">\n                    <h3>Damping Ratio</h3>\n                    <div class=\"equation\">ζ = (R/2) · √(C/L)</div>\n                </div>\n                <div class=\"equation-card\">\n                    <h3>Damped Frequency</h3>\n                    <div class=\"equation\">ωd = ω₀ · √(1 - ζ²)</div>\n                    <div class=\"condition\">Condition: ζ < 1</div>\n                </div>\n                <div class=\"equation-card full-width\">\n                    <h3>Capacitor Voltage (Underdamped)</h3>\n                    <div class=\"equation\">vc(t) = V · [1 - (1/√(1-ζ²)) · e^(-ζω₀t) · sin(ωd·t + arctan(√(1-ζ²)/ζ))]</div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);\n    min-height: 100vh;\n    padding: 20px;\n    color: #2d3748;\n}\n\n.container {\n    max-width: 1600px;\n    margin: 0 auto;\n    background: white;\n    border-radius: 20px;\n    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);\n    overflow: hidden;\n}\n\nheader {\n    background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%);\n    color: white;\n    padding: 40px;\n    text-align: center;\n    position: relative;\n    overflow: hidden;\n}\n\nheader::before {\n    content: '';\n    position: absolute;\n    top: -50%;\n    left: -50%;\n    width: 200%;\n    height: 200%;\n    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);\n    animation: pulse 4s ease-in-out infinite;\n}\n\n@keyframes pulse {\n    0%, 100% { transform: scale(1); opacity: 0.5; }\n    50% { transform: scale(1.1); opacity: 0.8; }\n}\n\nheader h1 {\n    font-size: 2.5em;\n    margin-bottom: 10px;\n    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);\n    position: relative;\n    z-index: 1;\n}\n\n.subtitle {\n    font-size: 1.2em;\n    opacity: 0.95;\n    position: relative;\n    z-index: 1;\n}\n\n.main-content {\n    display: grid;\n    grid-template-columns: 1fr 400px;\n    gap: 30px;\n    padding: 30px;\n}\n\n@media (max-width: 1200px) {\n    .main-content {\n        grid-template-columns: 1fr;\n    }\n}\n\n/* Circuit Section */\n.circuit-section {\n    background: #f7fafc;\n    padding: 30px;\n    border-radius: 15px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n}\n\n.circuit-section h2 {\n    font-size: 1.8em;\n    margin-bottom: 20px;\n    color: #2563eb;\n    border-bottom: 3px solid #2563eb;\n    padding-bottom: 10px;\n}\n\n#circuit {\n    width: 100%;\n    height: auto;\n    background: white;\n    border-radius: 10px;\n    padding: 20px;\n    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);\n}\n\n.wire {\n    stroke: #cbd5e0;\n    stroke-width: 3;\n    transition: stroke 0.3s ease;\n}\n\n.wire.active {\n    stroke: #10b981;\n    stroke-width: 4;\n    filter: drop-shadow(0 0 6px #10b981);\n}\n\n.component-label {\n    font-size: 18px;\n    font-weight: bold;\n    fill: #2563eb;\n}\n\n.value-label {\n    font-size: 14px;\n    fill: #4b5563;\n}\n\n.voltage-indicator {\n    font-size: 16px;\n    font-weight: bold;\n    fill: #dc2626;\n    transition: all 0.3s ease;\n}\n\n.current-arrow {\n    animation: currentFlow 2s ease-in-out infinite;\n}\n\n@keyframes currentFlow {\n    0%, 100% { opacity: 1; transform: translateX(0); }\n    50% { opacity: 0.6; transform: translateX(5px); }\n}\n\n/* Control Panel */\n.control-panel {\n    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);\n    padding: 30px;\n    border-radius: 15px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n}\n\n.control-panel h2 {\n    font-size: 1.8em;\n    margin-bottom: 25px;\n    color: #2563eb;\n    border-bottom: 3px solid #2563eb;\n    padding-bottom: 10px;\n}\n\n.control-group {\n    margin-bottom: 25px;\n}\n\n.control-group label {\n    display: block;\n    font-weight: 600;\n    margin-bottom: 10px;\n    color: #374151;\n    font-size: 1.05em;\n}\n\n.control-group label span {\n    color: #2563eb;\n    font-weight: bold;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    height: 8px;\n    border-radius: 5px;\n    background: #cbd5e0;\n    outline: none;\n    transition: background 0.3s ease;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb {\n    appearance: none;\n    width: 24px;\n    height: 24px;\n    border-radius: 50%;\n    background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%);\n    cursor: pointer;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);\n    transition: transform 0.2s ease;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb:hover {\n    transform: scale(1.2);\n}\n\ninput[type=\"range\"]::-moz-range-thumb {\n    width: 24px;\n    height: 24px;\n    border-radius: 50%;\n    background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%);\n    cursor: pointer;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);\n    border: none;\n}\n\n.button-group {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 15px;\n    margin-top: 30px;\n}\n\n.btn {\n    padding: 15px 25px;\n    border: none;\n    border-radius: 10px;\n    font-size: 1.1em;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n}\n\n.btn-primary {\n    background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n    color: white;\n}\n\n.btn-primary:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 12px rgba(16, 185, 129, 0.4);\n}\n\n.btn-primary:active {\n    transform: translateY(0);\n}\n\n.btn-secondary {\n    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);\n    color: white;\n}\n\n.btn-secondary:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 12px rgba(239, 68, 68, 0.4);\n}\n\n.status-indicator {\n    margin-top: 25px;\n    padding: 15px;\n    background: white;\n    border-radius: 10px;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n}\n\n.status-label {\n    font-weight: 600;\n    color: #6b7280;\n    margin-bottom: 5px;\n}\n\n.status-text {\n    font-size: 1.2em;\n    font-weight: bold;\n    color: #10b981;\n}\n\n/* Parameters Section */\n.parameters-section {\n    padding: 30px;\n    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);\n}\n\n.parameters-section h2 {\n    font-size: 1.8em;\n    margin-bottom: 25px;\n    color: #d97706;\n    border-bottom: 3px solid #d97706;\n    padding-bottom: 10px;\n}\n\n.param-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n    gap: 20px;\n}\n\n.param-card {\n    background: white;\n    padding: 20px;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    transition: transform 0.3s ease;\n}\n\n.param-card:hover {\n    transform: translateY(-5px);\n}\n\n.param-label {\n    font-size: 1.05em;\n    color: #6b7280;\n    margin-bottom: 10px;\n}\n\n.param-value {\n    font-size: 1.8em;\n    font-weight: bold;\n    color: #2563eb;\n}\n\n/* Graph Section */\n.graph-section {\n    padding: 30px;\n    background: white;\n}\n\n.graph-section h2 {\n    font-size: 1.8em;\n    margin-bottom: 20px;\n    color: #2563eb;\n    border-bottom: 3px solid #2563eb;\n    padding-bottom: 10px;\n}\n\n#graphCanvas {\n    width: 100%;\n    height: 400px;\n    border: 2px solid #e5e7eb;\n    border-radius: 10px;\n    background: #f9fafb;\n    cursor: crosshair;\n}\n\n.graph-controls {\n    margin-top: 15px;\n    display: flex;\n    gap: 20px;\n}\n\n.graph-controls label {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-weight: 600;\n    color: #4b5563;\n}\n\n.graph-controls input[type=\"checkbox\"] {\n    width: 18px;\n    height: 18px;\n    cursor: pointer;\n}\n\n/* Equations Section */\n.equations-section {\n    padding: 30px;\n    background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);\n}\n\n.equations-section h2 {\n    font-size: 1.8em;\n    margin-bottom: 25px;\n    color: #7c3aed;\n    border-bottom: 3px solid #7c3aed;\n    padding-bottom: 10px;\n}\n\n.equation-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n    gap: 20px;\n}\n\n.equation-card {\n    background: white;\n    padding: 25px;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    transition: transform 0.3s ease;\n}\n\n.equation-card:hover {\n    transform: translateY(-5px);\n}\n\n.equation-card.full-width {\n    grid-column: 1 / -1;\n}\n\n.equation-card h3 {\n    color: #7c3aed;\n    margin-bottom: 15px;\n    font-size: 1.3em;\n}\n\n.equation {\n    font-family: 'Courier New', monospace;\n    font-size: 1.15em;\n    background: #f3f4f6;\n    padding: 15px;\n    border-radius: 8px;\n    border-left: 4px solid #7c3aed;\n    color: #1f2937;\n    overflow-x: auto;\n}\n\n.condition {\n    margin-top: 10px;\n    font-size: 0.95em;\n    color: #dc2626;\n    font-weight: 600;\n    font-style: italic;\n}\n\n/* Animations */\n@keyframes fadeIn {\n    from { opacity: 0; transform: translateY(20px); }\n    to { opacity: 1; transform: translateY(0); }\n}\n\n.param-card, .equation-card {\n    animation: fadeIn 0.5s ease;\n}", "js": "// RLC Underdamped Circuit Simulator\nclass RLCSimulator {\n    constructor() {\n        // Circuit parameters\n        this.R = 10;        // Resistance in Ohms\n        this.L = 0.001;     // Inductance in Henries (1mH)\n        this.C = 0.00001;   // Capacitance in Farads (10µF)\n        this.V = 10;        // Source voltage in Volts\n        \n        // Calculated parameters\n        this.omega0 = 0;    // Natural frequency\n        this.zeta = 0;      // Damping ratio\n        this.omegad = 0;    // Damped frequency\n        \n        // Simulation state\n        this.isRunning = false;\n        this.currentTime = 0;\n        this.dataPoints = [];\n        this.animationId = null;\n        \n        this.initializeElements();\n        this.attachEventListeners();\n        this.calculateParameters();\n        this.setupCanvas();\n    }\n    \n    initializeElements() {\n        // Sliders\n        this.resistanceSlider = document.getElementById('resistanceSlider');\n        this.inductanceSlider = document.getElementById('inductanceSlider');\n        this.capacitanceSlider = document.getElementById('capacitanceSlider');\n        this.voltageSlider = document.getElementById('voltageSlider');\n        \n        // Value displays\n        this.resistanceValue = document.getElementById('resistanceValue');\n        this.inductanceValue = document.getElementById('inductanceValue');\n        this.capacitanceValue = document.getElementById('capacitanceValue');\n        this.voltageValue = document.getElementById('voltageValue');\n        \n        // Buttons\n        this.startBtn = document.getElementById('startBtn');\n        this.resetBtn = document.getElementById('resetBtn');\n        \n        // Status\n        this.statusText = document.getElementById('statusText');\n        \n        // Circuit labels\n        this.voltageLabel = document.getElementById('voltageLabel');\n        this.resistorLabel = document.getElementById('resistorLabel');\n        this.inductorLabel = document.getElementById('inductorLabel');\n        this.capacitorLabel = document.getElementById('capacitorLabel');\n        this.vcIndicator = document.getElementById('vcIndicator');\n        \n        // Parameter displays\n        this.omega0Value = document.getElementById('omega0Value');\n        this.zetaValue = document.getElementById('zetaValue');\n        this.omegadValue = document.getElementById('omegadValue');\n        this.conditionValue = document.getElementById('conditionValue');\n        \n        // Canvas\n        this.canvas = document.getElementById('graphCanvas');\n        this.ctx = this.canvas.getContext('2d');\n        this.showGrid = document.getElementById('showGrid');\n        this.showPoints = document.getElementById('showPoints');\n        \n        // Wires\n        this.wires = [\n            document.getElementById('wire1'),\n            document.getElementById('wire2'),\n            document.getElementById('wire3'),\n            document.getElementById('wire4'),\n            document.getElementById('wire5'),\n            document.getElementById('wire6')\n        ];\n    }\n    \n    attachEventListeners() {\n        this.resistanceSlider.addEventListener('input', () => this.updateResistance());\n        this.inductanceSlider.addEventListener('input', () => this.updateInductance());\n        this.capacitanceSlider.addEventListener('input', () => this.updateCapacitance());\n        this.voltageSlider.addEventListener('input', () => this.updateVoltage());\n        \n        this.startBtn.addEventListener('click', () => this.startSimulation());\n        this.resetBtn.addEventListener('click', () => this.reset());\n        \n        this.showGrid.addEventListener('change', () => this.drawGraph());\n        this.showPoints.addEventListener('change', () => this.drawGraph());\n        \n        window.addEventListener('resize', () => this.setupCanvas());\n    }\n    \n    updateResistance() {\n        this.R = parseFloat(this.resistanceSlider.value);\n        this.resistanceValue.textContent = this.R.toFixed(1);\n        this.resistorLabel.textContent = `${this.R.toFixed(1)}Ω`;\n        this.calculateParameters();\n    }\n    \n    updateInductance() {\n        this.L = parseFloat(this.inductanceSlider.value) / 1000; // Convert mH to H\n        this.inductanceValue.textContent = (this.L * 1000).toFixed(3);\n        this.inductorLabel.textContent = `${(this.L * 1000).toFixed(2)}mH`;\n        this.calculateParameters();\n    }\n    \n    updateCapacitance() {\n        this.C = parseFloat(this.capacitanceSlider.value) / 1000000; // Convert µF to F\n        this.capacitanceValue.textContent = (this.C * 1000000).toFixed(3);\n        this.capacitorLabel.textContent = `${(this.C * 1000000).toFixed(2)}µF`;\n        this.calculateParameters();\n    }\n    \n    updateVoltage() {\n        this.V = parseFloat(this.voltageSlider.value);\n        this.voltageValue.textContent = this.V;\n        this.voltageLabel.textContent = `${this.V}V`;\n        this.calculateParameters();\n    }\n    \n    calculateParameters() {\n        // Natural frequency: omega0 = 1 / sqrt(L * C)\n        this.omega0 = 1 / Math.sqrt(this.L * this.C);\n        \n        // Damping ratio: zeta = (R/2) * sqrt(C/L)\n        this.zeta = (this.R / 2) * Math.sqrt(this.C / this.L);\n        \n        // Check if underdamped\n        if (this.zeta < 1) {\n            // Damped frequency: omegad = omega0 * sqrt(1 - zeta^2)\n            this.omegad = this.omega0 * Math.sqrt(1 - this.zeta * this.zeta);\n            \n            this.omega0Value.textContent = `${this.omega0.toFixed(2)} rad/s`;\n            this.zetaValue.textContent = this.zeta.toFixed(4);\n            this.omegadValue.textContent = `${this.omegad.toFixed(2)} rad/s`;\n            this.conditionValue.textContent = 'Underdamped ✓';\n            this.conditionValue.style.color = '#10b981';\n        } else {\n            this.omega0Value.textContent = `${this.omega0.toFixed(2)} rad/s`;\n            this.zetaValue.textContent = this.zeta.toFixed(4);\n            this.omegadValue.textContent = 'N/A';\n            this.conditionValue.textContent = 'Not Underdamped ✗';\n            this.conditionValue.style.color = '#ef4444';\n        }\n    }\n    \n    calculateVc(t) {\n        if (this.zeta >= 1) return 0; // Not underdamped\n        \n        // vc(t) = V * [1 - (1/sqrt(1-zeta^2)) * exp(-zeta*omega0*t) * sin(omegad*t + atan(sqrt(1-zeta^2)/zeta))]\n        const sqrtTerm = Math.sqrt(1 - this.zeta * this.zeta);\n        const phase = Math.atan(sqrtTerm / this.zeta);\n        const expTerm = Math.exp(-this.zeta * this.omega0 * t);\n        const sinTerm = Math.sin(this.omegad * t + phase);\n        \n        return this.V * (1 - (1 / sqrtTerm) * expTerm * sinTerm);\n    }\n    \n    startSimulation() {\n        if (this.zeta >= 1) {\n            this.statusText.textContent = 'Error: Not Underdamped!';\n            this.statusText.style.color = '#ef4444';\n            return;\n        }\n        \n        if (this.isRunning) {\n            this.stopSimulation();\n            return;\n        }\n        \n        this.isRunning = true;\n        this.currentTime = 0;\n        this.dataPoints = [];\n        this.startBtn.textContent = 'Stop Simulation';\n        this.statusText.textContent = 'Running...';\n        this.statusText.style.color = '#10b981';\n        \n        this.animate();\n    }\n    \n    animate() {\n        if (!this.isRunning) return;\n        \n        const dt = 0.0001; // Time step\n        const maxTime = 10 / this.omega0; // Simulate for ~10 periods\n        \n        if (this.currentTime < maxTime) {\n            const vc = this.calculateVc(this.currentTime);\n            this.dataPoints.push({ t: this.currentTime, vc: vc });\n            \n            // Update voltage indicator\n            this.vcIndicator.textContent = `Vc = ${vc.toFixed(2)}V`;\n            this.vcIndicator.style.fill = vc > this.V * 0.5 ? '#dc2626' : '#2563eb';\n            \n            // Animate wires based on current\n            const normalizedVc = vc / this.V;\n            this.wires.forEach(wire => {\n                if (normalizedVc > 0.1) {\n                    wire.classList.add('active');\n                } else {\n                    wire.classList.remove('active');\n                }\n            });\n            \n            this.currentTime += dt;\n            this.drawGraph();\n            \n            this.animationId = requestAnimationFrame(() => this.animate());\n        } else {\n            this.stopSimulation();\n            this.statusText.textContent = 'Complete';\n            this.statusText.style.color = '#2563eb';\n        }\n    }\n    \n    stopSimulation() {\n        this.isRunning = false;\n        if (this.animationId) {\n            cancelAnimationFrame(this.animationId);\n        }\n        this.startBtn.textContent = 'Start Simulation';\n    }\n    \n    reset() {\n        this.stopSimulation();\n        this.currentTime = 0;\n        this.dataPoints = [];\n        this.statusText.textContent = 'Ready';\n        this.statusText.style.color = '#10b981';\n        this.vcIndicator.textContent = 'Vc = 0.0V';\n        this.wires.forEach(wire => wire.classList.remove('active'));\n        this.drawGraph();\n    }\n    \n    setupCanvas() {\n        const rect = this.canvas.getBoundingClientRect();\n        this.canvas.width = rect.width * window.devicePixelRatio;\n        this.canvas.height = rect.height * window.devicePixelRatio;\n        this.ctx.scale(window.devicePixelRatio, window.devicePixelRatio);\n        this.drawGraph();\n    }\n    \n    drawGraph() {\n        const w = this.canvas.width / window.devicePixelRatio;\n        const h = this.canvas.height / window.devicePixelRatio;\n        \n        this.ctx.clearRect(0, 0, w, h);\n        \n        const padding = 60;\n        const graphW = w - 2 * padding;\n        const graphH = h - 2 * padding;\n        \n        // Draw grid\n        if (this.showGrid.checked) {\n            this.ctx.strokeStyle = '#e5e7eb';\n            this.ctx.lineWidth = 1;\n            \n            for (let i = 0; i <= 10; i++) {\n                const x = padding + (graphW / 10) * i;\n                const y = padding + (graphH / 10) * i;\n                \n                this.ctx.beginPath();\n                this.ctx.moveTo(x, padding);\n                this.ctx.lineTo(x, padding + graphH);\n                this.ctx.stroke();\n                \n                this.ctx.beginPath();\n                this.ctx.moveTo(padding, y);\n                this.ctx.lineTo(padding + graphW, y);\n                this.ctx.stroke();\n            }\n        }\n        \n        // Draw axes\n        this.ctx.strokeStyle = '#1f2937';\n        this.ctx.lineWidth = 2;\n        \n        this.ctx.beginPath();\n        this.ctx.moveTo(padding, padding);\n        this.ctx.lineTo(padding, padding + graphH);\n        this.ctx.lineTo(padding + graphW, padding + graphH);\n        this.ctx.stroke();\n        \n        // Labels\n        this.ctx.fillStyle = '#1f2937';\n        this.ctx.font = 'bold 14px Arial';\n        this.ctx.fillText('Vc (V)', padding - 50, padding - 10);\n        this.ctx.fillText('Time (s)', padding + graphW - 30, padding + graphH + 40);\n        \n        if (this.dataPoints.length === 0) return;\n        \n        // Find max time and voltage for scaling\n        const maxTime = Math.max(...this.dataPoints.map(p => p.t));\n        const maxVc = Math.max(...this.dataPoints.map(p => Math.abs(p.vc)));\n        const range = Math.max(maxVc, this.V) * 1.2;\n        \n        // Draw voltage reference line\n        this.ctx.strokeStyle = '#dc2626';\n        this.ctx.lineWidth = 1;\n        this.ctx.setLineDash([5, 5]);\n        const vRefY = padding + graphH - (this.V / range) * graphH;\n        this.ctx.beginPath();\n        this.ctx.moveTo(padding, vRefY);\n        this.ctx.lineTo(padding + graphW, vRefY);\n        this.ctx.stroke();\n        this.ctx.setLineDash([]);\n        \n        // Draw curve\n        this.ctx.strokeStyle = '#2563eb';\n        this.ctx.lineWidth = 3;\n        this.ctx.beginPath();\n        \n        this.dataPoints.forEach((point, i) => {\n            const x = padding + (point.t / maxTime) * graphW;\n            const y = padding + graphH - (point.vc / range) * graphH;\n            \n            if (i === 0) {\n                this.ctx.moveTo(x, y);\n            } else {\n                this.ctx.lineTo(x, y);\n            }\n        });\n        \n        this.ctx.stroke();\n        \n        // Draw points\n        if (this.showPoints.checked && this.dataPoints.length < 500) {\n            this.ctx.fillStyle = '#2563eb';\n            this.dataPoints.forEach(point => {\n                const x = padding + (point.t / maxTime) * graphW;\n                const y = padding + graphH - (point.vc / range) * graphH;\n                \n                this.ctx.beginPath();\n                this.ctx.arc(x, y, 2, 0, Math.PI * 2);\n                this.ctx.fill();\n            });\n        }\n        \n        // Draw current value marker\n        if (this.isRunning && this.dataPoints.length > 0) {\n            const lastPoint = this.dataPoints[this.dataPoints.length - 1];\n            const x = padding + (lastPoint.t / maxTime) * graphW;\n            const y = padding + graphH - (lastPoint.vc / range) * graphH;\n            \n            this.ctx.fillStyle = '#10b981';\n            this.ctx.beginPath();\n            this.ctx.arc(x, y, 5, 0, Math.PI * 2);\n            this.ctx.fill();\n        }\n    }\n}\n\n// Initialize simulator\ndocument.addEventListener('DOMContentLoaded', () => {\n    new RLCSimulator();\n});"}}
{"input": {"input_text": "Buck converter in continuous conduction mode: given Vin, duty D, load R, inductor L, capacitor C. Provide steady-state Vout and inductor ripple.", "simulation_name": " Buck CCM", "domain": "Electrical Engineering", "description": "Ideal buck converter CCM", "assumptions": ["Ideal switches", "CCM"], "entities": [], "constants": [], "parameters": [{"name": "input_voltage", "symbol": "Vin", "unit": "V", "range": [1, 60]}, {"name": "duty_cycle", "symbol": "D", "unit": "fraction", "range": [0, 1]}, {"name": "switching_frequency", "symbol": "fs", "unit": "Hz", "range": [1000.0, 1000000.0]}, {"name": "inductor", "symbol": "L", "unit": "H", "range": [1e-06, 0.01]}, {"name": "capacitor", "symbol": "C", "unit": "F", "range": [1e-09, 0.001]}, {"name": "load_resistance", "symbol": "Rload", "unit": "ohm", "range": [0.1, 1000.0]}], "equations": [{"description": "Output voltage", "expression": "Vout = D*Vin"}, {"description": "Inductor ripple", "expression": "DeltaIL = (Vin - Vout)*D/(L*fs)"}, {"description": "Capacitor ripple", "expression": "DeltaVC = DeltaIL/(8*C*fs)"}], "initial_conditions": {}, "outputs": ["Vout", "DeltaIL", "DeltaVC"], "simulation_controls": ["Vin", "D", "fs", "L", "C", "Rload"], "constraints": ["0 <= D <= 1", "L > 0", "C > 0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Buck Converter Simulation (CCM)</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1>Buck Converter Simulation</h1>\n            <p class=\"subtitle\">Continuous Conduction Mode (CCM) Analysis</p>\n        </header>\n\n        <div class=\"main-grid\">\n            <aside class=\"controls\">\n                <h2>Parameters</h2>\n                \n                <div class=\"control-group\">\n                    <label>Input Voltage ($V_{in}$)</label>\n                    <div class=\"input-row\">\n                        <input type=\"range\" id=\"vin\" min=\"5\" max=\"60\" step=\"1\" value=\"24\">\n                        <span id=\"val-vin\" class=\"value\">24 V</span>\n                    </div>\n                </div>\n\n                <div class=\"control-group\">\n                    <label>Duty Cycle ($D$)</label>\n                    <div class=\"input-row\">\n                        <input type=\"range\" id=\"duty\" min=\"0.1\" max=\"0.9\" step=\"0.05\" value=\"0.5\">\n                        <span id=\"val-duty\" class=\"value\">0.50</span>\n                    </div>\n                </div>\n\n                <div class=\"control-group\">\n                    <label>Switching Freq ($f_s$)</label>\n                    <div class=\"input-row\">\n                        <input type=\"range\" id=\"freq\" min=\"10\" max=\"500\" step=\"10\" value=\"100\">\n                        <span id=\"val-freq\" class=\"value\">100 kHz</span>\n                    </div>\n                </div>\n\n                <div class=\"control-group\">\n                    <label>Inductor ($L$)</label>\n                    <div class=\"input-row\">\n                        <input type=\"range\" id=\"inductance\" min=\"10\" max=\"1000\" step=\"10\" value=\"100\">\n                        <span id=\"val-inductance\" class=\"value\">100 &mu;H</span>\n                    </div>\n                </div>\n\n                <div class=\"control-group\">\n                    <label>Capacitor ($C$)</label>\n                    <div class=\"input-row\">\n                        <input type=\"range\" id=\"capacitance\" min=\"1\" max=\"500\" step=\"1\" value=\"47\">\n                        <span id=\"val-capacitance\" class=\"value\">47 &mu;F</span>\n                    </div>\n                </div>\n\n                <div class=\"control-group\">\n                    <label>Load Resistance ($R$)</label>\n                    <div class=\"input-row\">\n                        <input type=\"range\" id=\"load\" min=\"1\" max=\"100\" step=\"1\" value=\"10\">\n                        <span id=\"val-load\" class=\"value\">10 &Omega;</span>\n                    </div>\n                </div>\n\n                <div class=\"results-panel\">\n                    <h3>Steady State Outputs</h3>\n                    <div class=\"result-item\">\n                        <span>$V_{out}$ (Avg):</span>\n                        <span id=\"out-vout\" class=\"res-val\">12.00 V</span>\n                    </div>\n                    <div class=\"result-item\">\n                        <span>$\\Delta I_L$ (Ripple):</span>\n                        <span id=\"out-ripple-i\" class=\"res-val\">1.20 A</span>\n                    </div>\n                    <div class=\"result-item\">\n                        <span>$\\Delta V_{out}$ (Ripple):</span>\n                        <span id=\"out-ripple-v\" class=\"res-val\">0.05 V</span>\n                    </div>\n                    <div class=\"result-item\">\n                        <span>$I_{L,avg}$ (Load):</span>\n                        <span id=\"out-il-avg\" class=\"res-val\">1.20 A</span>\n                    </div>\n                </div>\n            </aside>\n\n            <main class=\"visuals\">\n                <div class=\"canvas-card\">\n                    <div class=\"card-header\">\n                        <span>Circuit Schematic</span>\n                        <span class=\"status-indicator\" id=\"switch-status\">SWITCH: ON</span>\n                    </div>\n                    <canvas id=\"circuitCanvas\"></canvas>\n                </div>\n\n                <div class=\"canvas-card\">\n                    <div class=\"card-header\">\n                        <span>Oscilloscopes (Real-time)</span>\n                        <div class=\"legend\">\n                            <span class=\"leg-item\"><span class=\"dot\" style=\"background:#e74c3c\"></span>$I_L$</span>\n                            <span class=\"leg-item\"><span class=\"dot\" style=\"background:#3498db\"></span>$V_{out}$</span>\n                        </div>\n                    </div>\n                    <canvas id=\"scopeCanvas\"></canvas>\n                </div>\n            </main>\n        </div>\n    </div>\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-color: #f4f6f9;\n    --panel-bg: #ffffff;\n    --text-primary: #2c3e50;\n    --primary-blue: #3498db;\n    --primary-red: #e74c3c;\n    --accent-green: #2ecc71;\n    --border-color: #e0e0e0;\n}\n\n* {\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-primary);\n    margin: 0;\n    padding: 20px;\n    height: 100vh;\n    overflow: hidden; /* Prevent scrolling, keep dashboard fixed */\n}\n\n.container {\n    max-width: 1400px;\n    height: 95vh;\n    margin: 0 auto;\n    display: flex;\n    flex-direction: column;\n}\n\nheader {\n    margin-bottom: 20px;\n    flex-shrink: 0;\n}\n\nh1 {\n    margin: 0;\n    font-size: 1.8rem;\n    font-weight: 600;\n}\n\n.subtitle {\n    margin: 5px 0 0;\n    color: #7f8c8d;\n    font-size: 0.95rem;\n}\n\n.main-grid {\n    display: grid;\n    grid-template-columns: 320px 1fr;\n    gap: 20px;\n    flex: 1;\n    overflow: hidden;\n}\n\n/* Sidebar Styles */\n.controls {\n    background: var(--panel-bg);\n    padding: 20px;\n    border-radius: 8px;\n    box-shadow: 0 2px 10px rgba(0,0,0,0.05);\n    overflow-y: auto;\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n}\n\nh2 {\n    font-size: 1.2rem;\n    margin-top: 0;\n    border-bottom: 2px solid var(--border-color);\n    padding-bottom: 10px;\n    margin-bottom: 10px;\n}\n\n.control-group {\n    margin-bottom: 5px;\n}\n\n.control-group label {\n    display: block;\n    font-weight: 600;\n    font-size: 0.9rem;\n    margin-bottom: 5px;\n    color: #555;\n}\n\n.input-row {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\ninput[type=range] {\n    flex: 1;\n    cursor: pointer;\n}\n\n.value {\n    width: 70px;\n    text-align: right;\n    font-family: monospace;\n    font-weight: bold;\n    color: var(--primary-blue);\n}\n\n.results-panel {\n    margin-top: auto;\n    background: #f8f9fa;\n    border: 1px solid var(--border-color);\n    border-radius: 6px;\n    padding: 15px;\n}\n\n.results-panel h3 {\n    margin: 0 0 10px 0;\n    font-size: 1rem;\n    color: #2c3e50;\n}\n\n.result-item {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 8px;\n    font-size: 0.95rem;\n}\n\n.res-val {\n    font-weight: bold;\n    font-family: monospace;\n    color: var(--text-primary);\n}\n\n/* Visuals Area */\n.visuals {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n    overflow: hidden;\n}\n\n.canvas-card {\n    background: var(--panel-bg);\n    border-radius: 8px;\n    box-shadow: 0 2px 10px rgba(0,0,0,0.05);\n    padding: 15px;\n    display: flex;\n    flex-direction: column;\n    flex: 1;\n    position: relative;\n}\n\n.card-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 10px;\n    font-weight: 600;\n    color: #555;\n    font-size: 0.9rem;\n}\n\n.status-indicator {\n    background: #eee;\n    padding: 4px 8px;\n    border-radius: 4px;\n    font-size: 0.8rem;\n    font-weight: bold;\n    transition: all 0.1s;\n}\n\n.legend {\n    display: flex;\n    gap: 15px;\n}\n\n.leg-item {\n    display: flex;\n    align-items: center;\n    font-size: 0.8rem;\n}\n\n.dot {\n    width: 8px;\n    height: 8px;\n    border-radius: 50%;\n    margin-right: 5px;\n}\n\ncanvas {\n    width: 100%;\n    height: 100%;\n    display: block;\n}\n\n@media (max-width: 900px) {\n    body {\n        height: auto;\n        overflow: auto;\n    }\n    .container {\n        height: auto;\n    }\n    .main-grid {\n        grid-template-columns: 1fr;\n    }\n    .canvas-card {\n        min-height: 300px;\n    }\n}", "js": "// --- Configuration & State ---\nconst state = {\n    Vin: 24,       // Volts\n    D: 0.5,        // Duty Cycle (0-1)\n    fs: 100000,    // Hz\n    L: 100e-6,     // Henrys\n    C: 47e-6,      // Farads\n    R: 10,         // Ohms\n    \n    // Calculated Outputs\n    Vout: 0,\n    I_L_avg: 0,\n    delta_IL: 0,\n    delta_VC: 0,\n    \n    // Animation\n    time: 0,            // Simulation time counter\n    simSpeed: 0.005,    // Visual speed factor\n    isSwitchOn: false\n};\n\n// --- DOM Elements ---\nconst inputs = {\n    vin: document.getElementById('vin'),\n    duty: document.getElementById('duty'),\n    freq: document.getElementById('freq'),\n    ind: document.getElementById('inductance'),\n    cap: document.getElementById('capacitance'),\n    load: document.getElementById('load')\n};\n\nconst displays = {\n    vin: document.getElementById('val-vin'),\n    duty: document.getElementById('val-duty'),\n    freq: document.getElementById('val-freq'),\n    ind: document.getElementById('val-inductance'),\n    cap: document.getElementById('val-capacitance'),\n    load: document.getElementById('val-load')\n};\n\nconst results = {\n    vout: document.getElementById('out-vout'),\n    rippleI: document.getElementById('out-ripple-i'),\n    rippleV: document.getElementById('out-ripple-v'),\n    ilAvg: document.getElementById('out-il-avg')\n};\n\nconst switchStatus = document.getElementById('switch-status');\n\n// Canvas Contexts\nconst circuitCanvas = document.getElementById('circuitCanvas');\nconst scopeCanvas = document.getElementById('scopeCanvas');\nconst ctxCircuit = circuitCanvas.getContext('2d');\nconst ctxScope = scopeCanvas.getContext('2d');\n\n// --- Initialization ---\nfunction init() {\n    // Add Event Listeners\n    Object.keys(inputs).forEach(key => {\n        inputs[key].addEventListener('input', updateParams);\n    });\n\n    // Handle Resize\n    window.addEventListener('resize', resizeCanvases);\n    \n    // Initial Setup\n    resizeCanvases();\n    updateParams();\n    animate();\n}\n\nfunction resizeCanvases() {\n    const dpr = window.devicePixelRatio || 1;\n    \n    [circuitCanvas, scopeCanvas].forEach(can => {\n        const rect = can.parentElement.getBoundingClientRect();\n        // Subtract header height from parent for scope canvas\n        const h = can.id === 'circuitCanvas' ? 250 : rect.height - 40;\n        \n        can.width = rect.width * dpr;\n        can.height = h * dpr;\n        \n        const ctx = can.getContext('2d');\n        ctx.scale(dpr, dpr);\n        \n        // Store logical size\n        can.logicalWidth = rect.width;\n        can.logicalHeight = h;\n    });\n}\n\nfunction updateParams() {\n    // Read Inputs\n    state.Vin = parseFloat(inputs.vin.value);\n    state.D = parseFloat(inputs.duty.value);\n    state.fs = parseFloat(inputs.freq.value) * 1000; // kHz to Hz\n    state.L = parseFloat(inputs.ind.value) * 1e-6;   // uH to H\n    state.C = parseFloat(inputs.cap.value) * 1e-6;   // uF to F\n    state.R = parseFloat(inputs.load.value);\n\n    // Update Display Text\n    displays.vin.innerText = state.Vin.toFixed(0) + \" V\";\n    displays.duty.innerText = state.D.toFixed(2);\n    displays.freq.innerText = (state.fs/1000).toFixed(0) + \" kHz\";\n    displays.ind.innerText = (state.L*1e6).toFixed(0) + \" μH\";\n    displays.cap.innerText = (state.C*1e6).toFixed(0) + \" μF\";\n    displays.load.innerText = state.R.toFixed(0) + \" Ω\";\n\n    // Perform Physics Calculations (Steady State CCM)\n    state.Vout = state.Vin * state.D;\n    state.I_L_avg = state.Vout / state.R;\n    \n    // Inductor Ripple Current: dIL = (Vin - Vout) * D / (L * fs)\n    state.delta_IL = ((state.Vin - state.Vout) * state.D) / (state.L * state.fs);\n    \n    // Capacitor Ripple Voltage: dVC = dIL / (8 * C * fs)\n    state.delta_VC = state.delta_IL / (8 * state.C * state.fs);\n\n    // Update Results Panel\n    results.vout.innerText = state.Vout.toFixed(2) + \" V\";\n    results.rippleI.innerText = state.delta_IL.toFixed(3) + \" A\";\n    results.rippleV.innerText = (state.delta_VC * 1000).toFixed(1) + \" mV\";\n    results.ilAvg.innerText = state.I_L_avg.toFixed(2) + \" A\";\n}\n\n// --- Animation Loop ---\nfunction animate() {\n    // Advance Time\n    // We simulate \"Visual Time\" where 1 unit = 1 switching period\n    state.time += state.simSpeed;\n    \n    // Determine Switch State based on fractional part of time\n    const cyclePos = state.time % 1.0;\n    state.isSwitchOn = cyclePos < state.D;\n\n    // Update UI Status\n    if (state.isSwitchOn) {\n        switchStatus.innerText = \"SWITCH: CLOSED (Charging)\";\n        switchStatus.style.background = \"#d4efdf\"; // Green tint\n        switchStatus.style.color = \"#145a32\";\n    } else {\n        switchStatus.innerText = \"SWITCH: OPEN (Freewheeling)\";\n        switchStatus.style.background = \"#fadbd8\"; // Red tint\n        switchStatus.style.color = \"#78281f\";\n    }\n\n    drawCircuit();\n    drawScope();\n\n    requestAnimationFrame(animate);\n}\n\n// --- Drawing: Circuit Schematic ---\nfunction drawCircuit() {\n    const ctx = ctxCircuit;\n    const w = circuitCanvas.logicalWidth;\n    const h = circuitCanvas.logicalHeight;\n\n    ctx.clearRect(0, 0, w, h);\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    // Layout Constants\n    const pad = 40;\n    const yTop = 60;\n    const yBot = h - 60;\n    const xVin = pad + 20;\n    const xSwitch = xVin + (w - 2*pad) * 0.25;\n    const xDiode = xSwitch;\n    const xInd = xVin + (w - 2*pad) * 0.55;\n    const xCap = xVin + (w - 2*pad) * 0.75;\n    const xLoad = w - pad - 20;\n\n    // --- Wires ---\n    ctx.lineWidth = 2;\n    ctx.strokeStyle = \"#333\";\n    ctx.beginPath();\n    \n    // Top Rail: Vin -> Switch -> Inductor -> Node -> Load\n    ctx.moveTo(xVin, yTop);\n    ctx.lineTo(xSwitch - 30, yTop); // To switch left\n    \n    ctx.moveTo(xSwitch + 30, yTop); // From switch right\n    ctx.lineTo(xInd - 30, yTop);    // To Inductor\n    \n    ctx.moveTo(xInd + 30, yTop);    // From Inductor\n    ctx.lineTo(xLoad, yTop);        // To Load\n    \n    // Bottom Rail: Vin -> Diode -> Cap -> Load\n    ctx.moveTo(xVin, yBot);\n    ctx.lineTo(xLoad, yBot);\n\n    // Vertical Connections\n    // Vin Source\n    ctx.moveTo(xVin, yTop);\n    ctx.lineTo(xVin, yBot);\n    \n    // Diode Leg\n    ctx.moveTo(xDiode, yTop);\n    ctx.lineTo(xDiode, yBot);\n    \n    // Cap Leg\n    ctx.moveTo(xCap, yTop);\n    ctx.lineTo(xCap, yBot);\n    \n    // Load Leg\n    ctx.moveTo(xLoad, yTop);\n    ctx.lineTo(xLoad, yBot);\n    \n    ctx.stroke();\n\n    // --- Components ---\n\n    // 1. Source (Circle)\n    ctx.fillStyle = \"#fff\";\n    drawCircle(ctx, xVin, (yTop+yBot)/2, 20);\n    ctx.fillStyle = \"#333\";\n    ctx.textAlign = \"center\";\n    ctx.font = \"bold 14px sans-serif\";\n    ctx.fillText(\"Vin\", xVin - 35, (yTop+yBot)/2);\n    ctx.fillText(\"+\", xVin, yTop + 25);\n\n    // 2. Switch (MOSFET symbol approx)\n    ctx.clearRect(xSwitch - 20, yTop - 20, 40, 40); // clear wire\n    ctx.beginPath();\n    ctx.strokeStyle = state.isSwitchOn ? \"#2ecc71\" : \"#e74c3c\"; // Green closed, Red open\n    ctx.lineWidth = 4;\n    \n    if (state.isSwitchOn) {\n        ctx.moveTo(xSwitch - 20, yTop);\n        ctx.lineTo(xSwitch + 20, yTop);\n    } else {\n        ctx.moveTo(xSwitch - 20, yTop);\n        ctx.lineTo(xSwitch - 10, yTop - 15); // Open arm\n    }\n    ctx.stroke();\n    ctx.fillStyle = \"#555\";\n    ctx.font = \"12px sans-serif\";\n    ctx.fillText(\"SW\", xSwitch, yTop - 25);\n\n    // 3. Diode\n    ctx.clearRect(xDiode - 10, (yTop+yBot)/2 - 15, 20, 30);\n    drawDiode(ctx, xDiode, (yTop+yBot)/2, !state.isSwitchOn); // Highlight if conducting\n\n    // 4. Inductor\n    ctx.clearRect(xInd - 25, yTop - 10, 50, 20);\n    drawInductor(ctx, xInd, yTop);\n    ctx.fillStyle = \"#555\";\n    ctx.fillText(\"L\", xInd, yTop - 25);\n\n    // 5. Capacitor\n    ctx.clearRect(xCap - 10, (yTop+yBot)/2 - 10, 20, 20);\n    drawCapacitor(ctx, xCap, (yTop+yBot)/2);\n    ctx.fillText(\"C\", xCap + 15, (yTop+yBot)/2);\n\n    // 6. Resistor\n    ctx.clearRect(xLoad - 10, (yTop+yBot)/2 - 25, 20, 50);\n    drawResistor(ctx, xLoad, (yTop+yBot)/2);\n    ctx.fillText(\"R\", xLoad + 15, (yTop+yBot)/2);\n\n    // --- Current Flow Animation ---\n    // Draw moving dots\n    const flowColor = \"#f1c40f\"; // Yellow\n    const pathSpeed = 2; // px per frame approx\n\n    // Determine Loop\n    // ON: Vin -> SW -> L -> Load/Cap -> Return\n    // OFF: Diode -> L -> Load/Cap -> Return\n\n    // We generate dots along the active path\n    ctx.fillStyle = flowColor;\n    \n    // We just draw dots at specific segments based on time\n    // Segment 1: Inductor Current (always flows R to L visually)\n    drawFlow(ctx, xSwitch + 30, yTop, xLoad, yTop, state.time * 200, true);\n    \n    // Segment 2: Input Current (only when ON)\n    if (state.isSwitchOn) {\n        drawFlow(ctx, xVin, yTop, xSwitch - 20, yTop, state.time * 200, true);\n        drawFlow(ctx, xVin, yBot, xLoad, yBot, state.time * 200, true); // Return path\n    }\n\n    // Segment 3: Diode Current (only when OFF)\n    if (!state.isSwitchOn) {\n        // Up through diode\n        drawFlow(ctx, xDiode, yBot, xDiode, yTop, state.time * 200, true);\n    }\n}\n\n// --- Drawing: Oscilloscope ---\nfunction drawScope() {\n    const ctx = ctxScope;\n    const w = scopeCanvas.logicalWidth;\n    const h = scopeCanvas.logicalHeight;\n\n    ctx.clearRect(0, 0, w, h);\n\n    // Margins\n    const mL = 50, mR = 20, mT = 20, mB = 30;\n    const graphW = w - mL - mR;\n    const graphH = h - mT - mB;\n\n    // Draw Grid\n    ctx.strokeStyle = \"#eee\";\n    ctx.lineWidth = 1;\n    ctx.beginPath();\n    // 4 vertical divisions\n    for(let i=0; i<=4; i++) {\n        const x = mL + (graphW/4)*i;\n        ctx.moveTo(x, mT);\n        ctx.lineTo(x, h - mB);\n    }\n    // 4 horizontal divisions\n    for(let i=0; i<=4; i++) {\n        const y = mT + (graphH/4)*i;\n        ctx.moveTo(mL, y);\n        ctx.lineTo(w - mR, y);\n    }\n    ctx.stroke();\n\n    // Axis Labels\n    ctx.fillStyle = \"#999\";\n    ctx.font = \"10px sans-serif\";\n    ctx.textAlign = \"right\";\n    ctx.fillText(\"High\", mL - 5, mT + 10);\n    ctx.fillText(\"0\", mL - 5, h - mB);\n\n    // --- Plot Data ---\n    // We visualize ~3 cycles of the waveform\n    // The visual window slides with time\n    const cyclesToShow = 3;\n    const now = state.time;\n    const timeStart = now - cyclesToShow; \n    \n    // Scales\n    // Voltage: Autoscaled around Vout?\n    // Current: Autoscaled around I_L?\n    // For simplicity, we normalize plots to fit the canvas height\n    // Top half: Current, Bottom half: Voltage ripple (AC coupled view)\n    \n    // Let's draw Current (Red)\n    ctx.beginPath();\n    ctx.strokeStyle = \"#e74c3c\";\n    ctx.lineWidth = 2;\n    \n    // Plot function for I_L\n    // It's a triangle wave. \n    // Rise when t%1 < D, Fall when t%1 > D\n    // We need to reconstruct the wave shape history\n    \n    const steps = 300;\n    for (let i = 0; i <= steps; i++) {\n        const tVis = timeStart + (i/steps) * cyclesToShow;\n        const cycleT = tVis % 1.0; // 0 to 1\n        let valNorm = 0; // Normalized 0 to 1 for shape\n        \n        // Triangle wave approximation\n        // Peak-to-peak is centered.\n        // If 0 < cycleT < D: Rising from -0.5 to 0.5\n        // If D < cycleT < 1: Falling from 0.5 to -0.5\n        \n        if (cycleT < 0) { /* handle negative mod */ } \n\n        // Precise Triangle Calculation\n        // Rise slope: 1/D. Fall slope: 1/(1-D)\n        // Let's assume normalized ripple amplitude 1\n        \n        if (cycleT < state.D) {\n            // Rising: starts at -0.5, ends at 0.5 at D\n            valNorm = -0.5 + (cycleT / state.D); \n        } else {\n            // Falling: starts at 0.5, ends at -0.5 at 1\n            valNorm = 0.5 - ((cycleT - state.D) / (1.0 - state.D));\n        }\n\n        const x = mL + (i/steps) * graphW;\n        // Map valNorm (-0.5 to 0.5) to pixels\n        // Let's use top 40% of canvas for Current\n        const yCenter = mT + graphH * 0.25;\n        const amp = graphH * 0.15; \n        const y = yCenter - (valNorm * amp);\n        \n        if (i===0) ctx.moveTo(x, y);\n        else ctx.lineTo(x, y);\n    }\n    ctx.stroke();\n\n    // Label for Current\n    ctx.fillStyle = \"#e74c3c\";\n    ctx.fillText(`I_L (avg: ${state.I_L_avg.toFixed(1)}A)`, w - mR - 10, mT + 15);\n\n\n    // Let's draw Vout (Blue)\n    // Theoretically quadratic ripple. \n    // Integral of I_L (Triangle) -> Parabolic sections\n    ctx.beginPath();\n    ctx.strokeStyle = \"#3498db\";\n    ctx.lineWidth = 2;\n\n    for (let i = 0; i <= steps; i++) {\n        const tVis = timeStart + (i/steps) * cyclesToShow;\n        let cycleT = tVis % 1.0;\n        if(cycleT < 0) cycleT += 1;\n\n        // Integration of the triangle wave defined above\n        // Rise phase (0 to D): int(-0.5 + t/D) dt = -0.5t + t^2/(2D)\n        // We shift it so it looks continuous\n        \n        let vRipple = 0;\n        \n        if (cycleT < state.D) {\n            // Parabola opening up\n            // Normalized to be centered approx\n            vRipple = (-0.5 * cycleT) + (cycleT * cycleT) / (2 * state.D);\n        } else {\n            // Fall phase (D to 1): Line is 0.5 - (t-D)/(1-D)\n            // Int: 0.5(t-D) - (t-D)^2 / (2(1-D))\n            // Must add offset from end of rise phase\n            const endRise = (-0.5 * state.D) + (state.D * state.D) / (2 * state.D); // = -0.5D + 0.5D = 0 ?? No.\n            // Wait, steady state integral over period is 0.\n            \n            // Simplified visualization:\n            // Just simulate the physics: dV = I_c / C. I_c = I_L - I_avg (The triangle centered at 0)\n            \n            // Rise Part: Integral of (-0.5 + t/D) is -0.5t + t^2/2D. At t=D/2 (zero crossing), min voltage?\n            // Actually, capacitor voltage lags inductor current by 90 deg.\n            // Just use a sine wave approximation for visual simplicity or exact parabola?\n            // Let's use sine approximation for smoothness in viz if parabolas get tricky to match boundaries.\n            \n            vRipple = Math.sin((cycleT / 1.0) * Math.PI * 2 - Math.PI/2); // shifted\n        }\n        \n        // Use exact parabola for accuracy if possible, but boundaries are tricky in normalized loop.\n        // Reverting to smoothed curve for \"Ripple\" viz.\n        \n        const x = mL + (i/steps) * graphW;\n        // Bottom 40%\n        const yCenter = mT + graphH * 0.75;\n        const amp = graphH * 0.15;\n        const y = yCenter - (vRipple * amp * 0.2); // Smaller amplitude visually\n        \n        if (i===0) ctx.moveTo(x, y);\n        else ctx.lineTo(x, y);\n    }\n    ctx.stroke();\n\n    ctx.fillStyle = \"#3498db\";\n    ctx.fillText(`Vout (Ripple: ${(state.delta_VC*1000).toFixed(0)}mV)`, w - mR - 10, mT + graphH/2 + 15);\n}\n\n// --- Helper Drawing Functions ---\n\nfunction drawCircle(ctx, x, y, r) {\n    ctx.beginPath();\n    ctx.arc(x, y, r, 0, Math.PI*2);\n    ctx.stroke();\n}\n\nfunction drawResistor(ctx, x, y, size=30) {\n    ctx.beginPath();\n    const zig = 5;\n    ctx.moveTo(x, y - 20);\n    ctx.lineTo(x - zig, y - 15);\n    ctx.lineTo(x + zig, y - 10);\n    ctx.lineTo(x - zig, y - 5);\n    ctx.lineTo(x + zig, y);\n    ctx.lineTo(x - zig, y + 5);\n    ctx.lineTo(x + zig, y + 10);\n    ctx.lineTo(x - zig, y + 15);\n    ctx.lineTo(x, y + 20);\n    ctx.stroke();\n}\n\nfunction drawInductor(ctx, x, y) {\n    ctx.beginPath();\n    const r = 6;\n    const startX = x - 24;\n    for(let i=0; i<4; i++) {\n        ctx.arc(startX + 12*i + 6, y, 6, Math.PI, 0);\n    }\n    ctx.stroke();\n}\n\nfunction drawCapacitor(ctx, x, y) {\n    ctx.beginPath();\n    // Top Plate\n    ctx.moveTo(x - 10, y - 5);\n    ctx.lineTo(x + 10, y - 5);\n    // Bottom Plate\n    ctx.moveTo(x - 10, y + 5);\n    ctx.lineTo(x + 10, y + 5);\n    ctx.stroke();\n}\n\nfunction drawDiode(ctx, x, y, conducting) {\n    ctx.beginPath();\n    // Triangle\n    ctx.moveTo(x - 10, y + 10); // Bottom left (Anode is bottom in this schematic?)\n    // Schematic: Vin top, Gnd bottom. Diode points UP (Cathode at SW-L node).\n    // So triangle points UP.\n    \n    // Triangle pointing UP\n    ctx.moveTo(x - 8, y + 8);\n    ctx.lineTo(x + 8, y + 8);\n    ctx.lineTo(x, y - 8);\n    ctx.closePath();\n    \n    ctx.fillStyle = conducting ? \"#e74c3c\" : \"#fff\"; // Red if conducting\n    ctx.fill();\n    ctx.stroke();\n    \n    // Bar (Cathode)\n    ctx.beginPath();\n    ctx.moveTo(x - 8, y - 8);\n    ctx.lineTo(x + 8, y - 8);\n    ctx.stroke();\n}\n\nfunction drawFlow(ctx, x1, y1, x2, y2, offset, visible) {\n    if (!visible) return;\n    const dist = Math.hypot(x2-x1, y2-y1);\n    const angle = Math.atan2(y2-y1, x2-x1);\n    const spacing = 20;\n    \n    ctx.save();\n    // Clip to line segment\n    ctx.beginPath();\n    ctx.rect(Math.min(x1,x2)-5, Math.min(y1,y2)-5, Math.abs(x2-x1)+10, Math.abs(y2-y1)+10);\n    ctx.clip();\n    \n    for (let i = 0; i < dist + spacing; i+=spacing) {\n        let d = (i + offset) % (dist + spacing);\n        if (d > dist) continue; // gap\n        \n        const px = x1 + Math.cos(angle) * d;\n        const py = y1 + Math.sin(angle) * d;\n        \n        ctx.beginPath();\n        ctx.arc(px, py, 2, 0, Math.PI*2);\n        ctx.fill();\n    }\n    ctx.restore();\n}\n\n// Start\ninit();"}}
{"input": {"input_text": "Boost converter in CCM: given Vin, duty D, load R, L, C. Provide Vout and ripple estimates.", "simulation_name": " Boost CCM", "domain": "Electrical Engineering", "description": "Ideal boost converter CCM", "assumptions": ["Ideal switches", "CCM"], "entities": [], "constants": [], "parameters": [{"name": "input_voltage", "symbol": "Vin", "unit": "V", "range": [1, 40]}, {"name": "duty_cycle", "symbol": "D", "unit": "fraction", "range": [0, 0.9]}, {"name": "switching_frequency", "symbol": "fs", "unit": "Hz", "range": [1000.0, 1000000.0]}, {"name": "inductor", "symbol": "L", "unit": "H", "range": [1e-06, 0.01]}, {"name": "capacitor", "symbol": "C", "unit": "F", "range": [1e-09, 0.001]}, {"name": "load_resistance", "symbol": "Rload", "unit": "ohm", "range": [0.5, 1000.0]}], "equations": [{"description": "Output voltage", "expression": "Vout = Vin/(1 - D)"}, {"description": "Inductor ripple", "expression": "DeltaIL = Vin*D/(L*fs)"}, {"description": "Capacitor ripple", "expression": "DeltaVC = (Iout*D)/(C*fs)"}], "initial_conditions": {}, "outputs": ["Vout", "DeltaIL", "DeltaVC"], "simulation_controls": ["Vin", "D", "fs", "L", "C", "Rload"], "constraints": ["0 < D < 1", "L > 0", "C > 0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Boost Converter CCM Simulator</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1>Boost Converter - CCM Mode</h1>\n            <p class=\"subtitle\">Continuous Conduction Mode Simulator</p>\n        </header>\n\n        <div class=\"main-grid\">\n            <!-- Circuit Diagram Section -->\n            <div class=\"circuit-section\">\n                <h2>Circuit Topology</h2>\n                <svg id=\"circuit\" viewBox=\"0 0 700 350\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <!-- Input Voltage Source -->\n                    <circle cx=\"80\" cy=\"175\" r=\"35\" fill=\"none\" stroke=\"#2d3748\" stroke-width=\"3\"/>\n                    <line x1=\"80\" y1=\"165\" x2=\"80\" y2=\"155\" stroke=\"#2d3748\" stroke-width=\"2\"/>\n                    <line x1=\"75\" y1=\"185\" x2=\"85\" y2=\"185\" stroke=\"#2d3748\" stroke-width=\"2\"/>\n                    <text x=\"80\" y=\"180\" text-anchor=\"middle\" class=\"component-text small\">Vin</text>\n                    <text x=\"80\" y=\"230\" text-anchor=\"middle\" class=\"value-text\" id=\"vinLabel\">12V</text>\n                    \n                    <!-- Wires -->\n                    <line id=\"wire1\" x1=\"80\" y1=\"140\" x2=\"80\" y2=\"80\" class=\"wire\"/>\n                    <line id=\"wire2\" x1=\"80\" y1=\"80\" x2=\"200\" y2=\"80\" class=\"wire\"/>\n                    \n                    <!-- Inductor -->\n                    <g id=\"inductorGroup\">\n                        <path d=\"M 200 80 Q 205 70 210 80 Q 215 90 220 80 Q 225 70 230 80 Q 235 90 240 80 Q 245 70 250 80\" \n                              fill=\"none\" stroke=\"#2d3748\" stroke-width=\"3\"/>\n                        <text x=\"225\" y=\"65\" text-anchor=\"middle\" class=\"component-text\">L</text>\n                        <text x=\"225\" y=\"110\" text-anchor=\"middle\" class=\"value-text\" id=\"inductorLabel\">100µH</text>\n                    </g>\n                    \n                    <line id=\"wire3\" x1=\"250\" y1=\"80\" x2=\"350\" y2=\"80\" class=\"wire\"/>\n                    \n                    <!-- Diode -->\n                    <g id=\"diodeGroup\">\n                        <polygon points=\"350,70 350,90 370,80\" fill=\"#2d3748\"/>\n                        <line x1=\"370\" y1=\"70\" x2=\"370\" y2=\"90\" stroke=\"#2d3748\" stroke-width=\"3\"/>\n                        <text x=\"360\" y=\"65\" text-anchor=\"middle\" class=\"component-text\">D</text>\n                        <circle id=\"diodeGlow\" cx=\"360\" cy=\"80\" r=\"15\" fill=\"none\" stroke=\"#10b981\" stroke-width=\"0\" opacity=\"0\"/>\n                    </g>\n                    \n                    <line id=\"wire4\" x1=\"370\" y1=\"80\" x2=\"450\" y2=\"80\" class=\"wire\"/>\n                    \n                    <!-- Capacitor -->\n                    <g id=\"capacitorGroup\">\n                        <line x1=\"450\" y1=\"60\" x2=\"450\" y2=\"100\" stroke=\"#2d3748\" stroke-width=\"3\"/>\n                        <line x1=\"460\" y1=\"60\" x2=\"460\" y2=\"100\" stroke=\"#2d3748\" stroke-width=\"3\"/>\n                        <text x=\"455\" y=\"50\" text-anchor=\"middle\" class=\"component-text\">C</text>\n                        <text x=\"455\" y=\"130\" text-anchor=\"middle\" class=\"value-text\" id=\"capacitorLabel\">100µF</text>\n                    </g>\n                    \n                    <line id=\"wire5\" x1=\"460\" y1=\"80\" x2=\"550\" y2=\"80\" class=\"wire\"/>\n                    \n                    <!-- Load Resistor -->\n                    <g id=\"resistorGroup\">\n                        <rect x=\"550\" y=\"70\" width=\"60\" height=\"20\" fill=\"none\" stroke=\"#2d3748\" stroke-width=\"2\"/>\n                        <line x1=\"555\" y1=\"70\" x2=\"555\" y2=\"90\" stroke=\"#2d3748\" stroke-width=\"1\"/>\n                        <line x1=\"565\" y1=\"70\" x2=\"565\" y2=\"90\" stroke=\"#2d3748\" stroke-width=\"1\"/>\n                        <line x1=\"575\" y1=\"70\" x2=\"575\" y2=\"90\" stroke=\"#2d3748\" stroke-width=\"1\"/>\n                        <line x1=\"585\" y1=\"70\" x2=\"585\" y2=\"90\" stroke=\"#2d3748\" stroke-width=\"1\"/>\n                        <line x1=\"595\" y1=\"70\" x2=\"595\" y2=\"90\" stroke=\"#2d3748\" stroke-width=\"1\"/>\n                        <line x1=\"605\" y1=\"70\" x2=\"605\" y2=\"90\" stroke=\"#2d3748\" stroke-width=\"1\"/>\n                        <text x=\"580\" y=\"55\" text-anchor=\"middle\" class=\"component-text\">Rload</text>\n                        <text x=\"580\" y=\"115\" text-anchor=\"middle\" class=\"value-text\" id=\"loadLabel\">50Ω</text>\n                    </g>\n                    \n                    <line id=\"wire6\" x1=\"610\" y1=\"80\" x2=\"640\" y2=\"80\" class=\"wire\"/>\n                    \n                    <!-- Output Voltage Indicator -->\n                    <text x=\"640\" y=\"75\" text-anchor=\"start\" class=\"output-text\" id=\"voutIndicator\">Vout</text>\n                    <text x=\"640\" y=\"95\" text-anchor=\"start\" class=\"output-value\" id=\"voutValue\">0V</text>\n                    \n                    <!-- Ground connections -->\n                    <line id=\"wire7\" x1=\"640\" y1=\"80\" x2=\"640\" y2=\"270\" class=\"wire\"/>\n                    <line id=\"wire8\" x1=\"640\" y1=\"270\" x2=\"80\" y2=\"270\" class=\"wire\"/>\n                    <line id=\"wire9\" x1=\"80\" y1=\"270\" x2=\"80\" y2=\"210\" class=\"wire\"/>\n                    \n                    <!-- Switch (MOSFET) -->\n                    <g id=\"switchGroup\">\n                        <line id=\"wire10\" x1=\"300\" y1=\"80\" x2=\"300\" y2=\"180\" class=\"wire\"/>\n                        <circle cx=\"300\" cy=\"180\" r=\"5\" fill=\"#2d3748\"/>\n                        <rect x=\"290\" y=\"180\" width=\"20\" height=\"40\" fill=\"none\" stroke=\"#2d3748\" stroke-width=\"2\"/>\n                        <line x1=\"295\" y1=\"200\" x2=\"305\" y2=\"200\" stroke=\"#2d3748\" stroke-width=\"2\"/>\n                        <polygon id=\"switchBlade\" points=\"295,200 305,200 300,220\" fill=\"#dc2626\" opacity=\"0.8\"/>\n                        <line id=\"wire11\" x1=\"300\" y1=\"220\" x2=\"300\" y2=\"270\" class=\"wire\"/>\n                        <text x=\"300\" y=\"245\" text-anchor=\"middle\" class=\"component-text\">S</text>\n                        <text x=\"330\" y=\"200\" text-anchor=\"start\" class=\"duty-text\" id=\"dutyLabel\">D=0.5</text>\n                    </g>\n                    \n                    <!-- Ground symbols -->\n                    <line x1=\"70\" y1=\"270\" x2=\"90\" y2=\"270\" stroke=\"#2d3748\" stroke-width=\"2\"/>\n                    <line x1=\"75\" y1=\"275\" x2=\"85\" y2=\"275\" stroke=\"#2d3748\" stroke-width=\"2\"/>\n                    <line x1=\"78\" y1=\"280\" x2=\"82\" y2=\"280\" stroke=\"#2d3748\" stroke-width=\"2\"/>\n                </svg>\n                \n                <div class=\"mode-indicator\">\n                    <div class=\"mode-label\">Operating Mode:</div>\n                    <div id=\"modeStatus\" class=\"mode-status\">CCM ✓</div>\n                </div>\n            </div>\n\n            <!-- Control Panel -->\n            <div class=\"control-panel\">\n                <h2>Input Parameters</h2>\n                \n                <div class=\"control-group\">\n                    <label>Input Voltage (Vin): <span id=\"vinValue\">12</span> V</label>\n                    <input type=\"range\" id=\"vinSlider\" min=\"1\" max=\"40\" step=\"0.1\" value=\"12\">\n                </div>\n                \n                <div class=\"control-group\">\n                    <label>Duty Cycle (D): <span id=\"dutyValue\">0.50</span></label>\n                    <input type=\"range\" id=\"dutySlider\" min=\"0.05\" max=\"0.89\" step=\"0.01\" value=\"0.50\">\n                    <div class=\"warning\" id=\"dutyWarning\">Must be 0 < D < 1</div>\n                </div>\n                \n                <div class=\"control-group\">\n                    <label>Switching Frequency (fs): <span id=\"fsValue\">50</span> kHz</label>\n                    <input type=\"range\" id=\"fsSlider\" min=\"1\" max=\"500\" step=\"1\" value=\"50\">\n                </div>\n                \n                <div class=\"control-group\">\n                    <label>Inductance (L): <span id=\"lValue\">100</span> µH</label>\n                    <input type=\"range\" id=\"lSlider\" min=\"1\" max=\"1000\" step=\"1\" value=\"100\">\n                </div>\n                \n                <div class=\"control-group\">\n                    <label>Capacitance (C): <span id=\"cValue\">100</span> µF</label>\n                    <input type=\"range\" id=\"cSlider\" min=\"1\" max=\"1000\" step=\"1\" value=\"100\">\n                </div>\n                \n                <div class=\"control-group\">\n                    <label>Load Resistance (Rload): <span id=\"rloadValue\">50</span> Ω</label>\n                    <input type=\"range\" id=\"rloadSlider\" min=\"0.5\" max=\"500\" step=\"0.5\" value=\"50\">\n                </div>\n\n                <div class=\"button-group\">\n                    <button id=\"simulateBtn\" class=\"btn btn-primary\">Run Simulation</button>\n                    <button id=\"resetBtn\" class=\"btn btn-secondary\">Reset</button>\n                </div>\n            </div>\n        </div>\n\n        <!-- Output Results -->\n        <div class=\"results-section\">\n            <h2>Calculated Results</h2>\n            <div class=\"results-grid\">\n                <div class=\"result-card primary\">\n                    <div class=\"result-icon\">📊</div>\n                    <div class=\"result-label\">Output Voltage</div>\n                    <div class=\"result-value\" id=\"voutResult\">0.00 V</div>\n                    <div class=\"result-formula\">Vout = Vin / (1 - D)</div>\n                </div>\n                \n                <div class=\"result-card secondary\">\n                    <div class=\"result-icon\">⚡</div>\n                    <div class=\"result-label\">Output Current</div>\n                    <div class=\"result-value\" id=\"ioutResult\">0.00 A</div>\n                    <div class=\"result-formula\">Iout = Vout / Rload</div>\n                </div>\n                \n                <div class=\"result-card accent\">\n                    <div class=\"result-icon\">📈</div>\n                    <div class=\"result-label\">Inductor Current Ripple</div>\n                    <div class=\"result-value\" id=\"deltaILResult\">0.00 A</div>\n                    <div class=\"result-formula\">ΔIL = (Vin × D) / (L × fs)</div>\n                </div>\n                \n                <div class=\"result-card warning\">\n                    <div class=\"result-icon\">🔋</div>\n                    <div class=\"result-label\">Capacitor Voltage Ripple</div>\n                    <div class=\"result-value\" id=\"deltaVCResult\">0.00 V</div>\n                    <div class=\"result-formula\">ΔVC = (Iout × D) / (C × fs)</div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Waveforms -->\n        <div class=\"waveforms-section\">\n            <h2>Key Waveforms</h2>\n            <div class=\"waveform-container\">\n                <div class=\"waveform-box\">\n                    <h3>Switch State & Inductor Current</h3>\n                    <canvas id=\"waveformCanvas1\"></canvas>\n                </div>\n                <div class=\"waveform-box\">\n                    <h3>Output Voltage Ripple</h3>\n                    <canvas id=\"waveformCanvas2\"></canvas>\n                </div>\n            </div>\n        </div>\n\n        <!-- Equations Reference -->\n        <div class=\"equations-section\">\n            <h2>Design Equations</h2>\n            <div class=\"equation-grid\">\n                <div class=\"equation-card\">\n                    <h3>Output Voltage</h3>\n                    <div class=\"equation\">Vout = Vin / (1 - D)</div>\n                    <p class=\"eq-desc\">Ideal boost conversion ratio</p>\n                </div>\n                <div class=\"equation-card\">\n                    <h3>Inductor Ripple Current</h3>\n                    <div class=\"equation\">ΔIL = (Vin × D) / (L × fs)</div>\n                    <p class=\"eq-desc\">Peak-to-peak inductor current variation</p>\n                </div>\n                <div class=\"equation-card\">\n                    <h3>Capacitor Ripple Voltage</h3>\n                    <div class=\"equation\">ΔVC = (Iout × D) / (C × fs)</div>\n                    <p class=\"eq-desc\">Peak-to-peak output voltage variation</p>\n                </div>\n                <div class=\"equation-card\">\n                    <h3>CCM Boundary Condition</h3>\n                    <div class=\"equation\">Lmin = (1 - D)² × Rload / (2 × fs)</div>\n                    <p class=\"eq-desc\">Minimum inductance for CCM operation</p>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);\n    min-height: 100vh;\n    padding: 20px;\n    color: #1f2937;\n}\n\n.container {\n    max-width: 1800px;\n    margin: 0 auto;\n    background: white;\n    border-radius: 20px;\n    box-shadow: 0 25px 70px rgba(0, 0, 0, 0.5);\n    overflow: hidden;\n}\n\nheader {\n    background: linear-gradient(135deg, #f59e0b 0%, #d97706 50%, #b45309 100%);\n    color: white;\n    padding: 45px;\n    text-align: center;\n    position: relative;\n    overflow: hidden;\n}\n\nheader::before {\n    content: '';\n    position: absolute;\n    width: 200%;\n    height: 200%;\n    background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 60%);\n    animation: rotate 8s linear infinite;\n    top: -50%;\n    left: -50%;\n}\n\n@keyframes rotate {\n    from { transform: rotate(0deg); }\n    to { transform: rotate(360deg); }\n}\n\nheader h1 {\n    font-size: 3em;\n    margin-bottom: 10px;\n    text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.3);\n    position: relative;\n    z-index: 1;\n}\n\n.subtitle {\n    font-size: 1.3em;\n    opacity: 0.95;\n    position: relative;\n    z-index: 1;\n}\n\n.main-grid {\n    display: grid;\n    grid-template-columns: 1fr 450px;\n    gap: 30px;\n    padding: 30px;\n}\n\n@media (max-width: 1400px) {\n    .main-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n/* Circuit Section */\n.circuit-section {\n    background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);\n    padding: 30px;\n    border-radius: 15px;\n    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);\n}\n\n.circuit-section h2 {\n    font-size: 2em;\n    margin-bottom: 25px;\n    color: #f59e0b;\n    border-bottom: 4px solid #f59e0b;\n    padding-bottom: 10px;\n}\n\n#circuit {\n    width: 100%;\n    height: auto;\n    background: white;\n    border-radius: 12px;\n    padding: 20px;\n    box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.05);\n}\n\n.wire {\n    stroke: #94a3b8;\n    stroke-width: 3;\n    transition: all 0.3s ease;\n}\n\n.wire.active {\n    stroke: #10b981;\n    stroke-width: 4;\n    filter: drop-shadow(0 0 8px #10b981);\n    animation: wireGlow 1s ease-in-out infinite;\n}\n\n@keyframes wireGlow {\n    0%, 100% { opacity: 1; }\n    50% { opacity: 0.7; }\n}\n\n.component-text {\n    font-size: 18px;\n    font-weight: bold;\n    fill: #1f2937;\n}\n\n.component-text.small {\n    font-size: 14px;\n}\n\n.value-text {\n    font-size: 13px;\n    fill: #6b7280;\n    font-weight: 600;\n}\n\n.output-text {\n    font-size: 15px;\n    font-weight: bold;\n    fill: #dc2626;\n}\n\n.output-value {\n    font-size: 18px;\n    font-weight: bold;\n    fill: #dc2626;\n}\n\n.duty-text {\n    font-size: 14px;\n    font-weight: bold;\n    fill: #2563eb;\n}\n\n#switchBlade {\n    transition: all 0.3s ease;\n}\n\n#switchBlade.on {\n    fill: #10b981;\n    animation: switchPulse 0.5s ease-in-out;\n}\n\n@keyframes switchPulse {\n    0%, 100% { opacity: 0.8; }\n    50% { opacity: 1; transform: scale(1.1); }\n}\n\n#diodeGlow {\n    transition: all 0.3s ease;\n}\n\n#diodeGlow.conducting {\n    stroke-width: 3;\n    opacity: 1;\n    animation: diodePulse 1s ease-in-out infinite;\n}\n\n@keyframes diodePulse {\n    0%, 100% { opacity: 0.8; }\n    50% { opacity: 1; }\n}\n\n.mode-indicator {\n    margin-top: 20px;\n    padding: 15px;\n    background: white;\n    border-radius: 10px;\n    display: flex;\n    align-items: center;\n    gap: 15px;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n}\n\n.mode-label {\n    font-weight: 600;\n    color: #4b5563;\n}\n\n.mode-status {\n    font-size: 1.2em;\n    font-weight: bold;\n    color: #10b981;\n}\n\n/* Control Panel */\n.control-panel {\n    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);\n    padding: 30px;\n    border-radius: 15px;\n    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);\n}\n\n.control-panel h2 {\n    font-size: 2em;\n    margin-bottom: 25px;\n    color: #d97706;\n    border-bottom: 4px solid #d97706;\n    padding-bottom: 10px;\n}\n\n.control-group {\n    margin-bottom: 25px;\n}\n\n.control-group label {\n    display: block;\n    font-weight: 600;\n    margin-bottom: 10px;\n    color: #374151;\n    font-size: 1.05em;\n}\n\n.control-group label span {\n    color: #d97706;\n    font-weight: bold;\n    font-size: 1.1em;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    height: 10px;\n    border-radius: 5px;\n    background: linear-gradient(90deg, #cbd5e0 0%, #94a3b8 100%);\n    outline: none;\n    transition: all 0.3s ease;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb {\n    appearance: none;\n    width: 26px;\n    height: 26px;\n    border-radius: 50%;\n    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);\n    cursor: pointer;\n    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);\n    transition: all 0.2s ease;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb:hover {\n    transform: scale(1.25);\n    box-shadow: 0 4px 12px rgba(245, 158, 11, 0.6);\n}\n\ninput[type=\"range\"]::-moz-range-thumb {\n    width: 26px;\n    height: 26px;\n    border-radius: 50%;\n    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);\n    cursor: pointer;\n    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);\n    border: none;\n}\n\n.warning {\n    font-size: 0.9em;\n    color: #dc2626;\n    margin-top: 5px;\n    font-style: italic;\n}\n\n.button-group {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 15px;\n    margin-top: 30px;\n}\n\n.btn {\n    padding: 16px 28px;\n    border: none;\n    border-radius: 12px;\n    font-size: 1.15em;\n    font-weight: 700;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.btn-primary {\n    background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n    color: white;\n}\n\n.btn-primary:hover {\n    transform: translateY(-3px);\n    box-shadow: 0 8px 16px rgba(16, 185, 129, 0.4);\n}\n\n.btn-secondary {\n    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);\n    color: white;\n}\n\n.btn-secondary:hover {\n    transform: translateY(-3px);\n    box-shadow: 0 8px 16px rgba(239, 68, 68, 0.4);\n}\n\n.btn:active {\n    transform: translateY(0);\n}\n\n/* Results Section */\n.results-section {\n    padding: 30px;\n    background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);\n}\n\n.results-section h2 {\n    font-size: 2em;\n    margin-bottom: 25px;\n    color: #2563eb;\n    border-bottom: 4px solid #2563eb;\n    padding-bottom: 10px;\n}\n\n.results-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));\n    gap: 25px;\n}\n\n.result-card {\n    background: white;\n    padding: 25px;\n    border-radius: 15px;\n    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);\n    transition: all 0.3s ease;\n    border-left: 6px solid;\n}\n\n.result-card:hover {\n    transform: translateY(-8px);\n    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);\n}\n\n.result-card.primary {\n    border-color: #2563eb;\n}\n\n.result-card.secondary {\n    border-color: #10b981;\n}\n\n.result-card.accent {\n    border-color: #f59e0b;\n}\n\n.result-card.warning {\n    border-color: #ef4444;\n}\n\n.result-icon {\n    font-size: 2.5em;\n    margin-bottom: 10px;\n}\n\n.result-label {\n    font-size: 1.1em;\n    color: #6b7280;\n    margin-bottom: 10px;\n    font-weight: 600;\n}\n\n.result-value {\n    font-size: 2.2em;\n    font-weight: bold;\n    color: #1f2937;\n    margin-bottom: 10px;\n}\n\n.result-formula {\n    font-family: 'Courier New', monospace;\n    font-size: 0.95em;\n    color: #4b5563;\n    background: #f3f4f6;\n    padding: 8px;\n    border-radius: 6px;\n}\n\n/* Waveforms Section */\n.waveforms-section {\n    padding: 30px;\n    background: white;\n}\n\n.waveforms-section h2 {\n    font-size: 2em;\n    margin-bottom: 25px;\n    color: #7c3aed;\n    border-bottom: 4px solid #7c3aed;\n    padding-bottom: 10px;\n}\n\n.waveform-container {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));\n    gap: 25px;\n}\n\n.waveform-box {\n    background: #f9fafb;\n    padding: 20px;\n    border-radius: 12px;\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n}\n\n.waveform-box h3 {\n    font-size: 1.3em;\n    color: #4b5563;\n    margin-bottom: 15px;\n}\n\ncanvas {\n    width: 100%;\n    height: 250px;\n    border: 2px solid #e5e7eb;\n    border-radius: 8px;\n    background: white;\n}\n\n/* Equations Section */\n.equations-section {\n    padding: 30px;\n    background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%);\n}\n\n.equations-section h2 {\n    font-size: 2em;\n    margin-bottom: 25px;\n    color: #7c3aed;\n    border-bottom: 4px solid #7c3aed;\n    padding-bottom: 10px;\n}\n\n.equation-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));\n    gap: 25px;\n}\n\n.equation-card {\n    background: white;\n    padding: 25px;\n    border-radius: 12px;\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n    transition: all 0.3s ease;\n}\n\n.equation-card:hover {\n    transform: translateY(-5px);\n    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);\n}\n\n.equation-card h3 {\n    color: #7c3aed;\n    margin-bottom: 15px;\n    font-size: 1.4em;\n}\n\n.equation {\n    font-family: 'Courier New', monospace;\n    font-size: 1.25em;\n    background: #f9fafb;\n    padding: 15px;\n    border-radius: 8px;\n    border-left: 5px solid #7c3aed;\n    color: #1f2937;\n    margin-bottom: 10px;\n}\n\n.eq-desc {\n    color: #6b7280;\n    font-size: 0.95em;\n    font-style: italic;\n}", "js": "// Boost Converter CCM Simulator\nclass BoostConverter {\n    constructor() {\n        // Circuit parameters\n        this.Vin = 12;           // Input voltage (V)\n        this.D = 0.50;           // Duty cycle\n        this.fs = 50000;         // Switching frequency (Hz)\n        this.L = 0.0001;         // Inductance (H) - 100µH\n        this.C = 0.0001;         // Capacitance (F) - 100µF\n        this.Rload = 50;         // Load resistance (Ω)\n        \n        // Calculated outputs\n        this.Vout = 0;\n        this.Iout = 0;\n        this.deltaIL = 0;\n        this.deltaVC = 0;\n        \n        // Animation state\n        this.animationRunning = false;\n        this.animationFrame = 0;\n        \n        this.initializeElements();\n        this.attachEventListeners();\n        this.calculate();\n        this.updateDisplay();\n        this.setupCanvases();\n    }\n    \n    initializeElements() {\n        // Sliders\n        this.vinSlider = document.getElementById('vinSlider');\n        this.dutySlider = document.getElementById('dutySlider');\n        this.fsSlider = document.getElementById('fsSlider');\n        this.lSlider = document.getElementById('lSlider');\n        this.cSlider = document.getElementById('cSlider');\n        this.rloadSlider = document.getElementById('rloadSlider');\n        \n        // Value displays\n        this.vinValue = document.getElementById('vinValue');\n        this.dutyValue = document.getElementById('dutyValue');\n        this.fsValue = document.getElementById('fsValue');\n        this.lValue = document.getElementById('lValue');\n        this.cValue = document.getElementById('cValue');\n        this.rloadValue = document.getElementById('rloadValue');\n        \n        // Circuit labels\n        this.vinLabel = document.getElementById('vinLabel');\n        this.inductorLabel = document.getElementById('inductorLabel');\n        this.capacitorLabel = document.getElementById('capacitorLabel');\n        this.loadLabel = document.getElementById('loadLabel');\n        this.dutyLabel = document.getElementById('dutyLabel');\n        this.voutIndicator = document.getElementById('voutValue');\n        \n        // Result displays\n        this.voutResult = document.getElementById('voutResult');\n        this.ioutResult = document.getElementById('ioutResult');\n        this.deltaILResult = document.getElementById('deltaILResult');\n        this.deltaVCResult = document.getElementById('deltaVCResult');\n        \n        // Buttons\n        this.simulateBtn = document.getElementById('simulateBtn');\n        this.resetBtn = document.getElementById('resetBtn');\n        \n        // SVG elements\n        this.wires = Array.from({ length: 11 }, (_, i) => \n            document.getElementById(`wire${i + 1}`)\n        );\n        this.switchBlade = document.getElementById('switchBlade');\n        this.diodeGlow = document.getElementById('diodeGlow');\n        \n        // Canvases\n        this.canvas1 = document.getElementById('waveformCanvas1');\n        this.ctx1 = this.canvas1.getContext('2d');\n        this.canvas2 = document.getElementById('waveformCanvas2');\n        this.ctx2 = this.canvas2.getContext('2d');\n    }\n    \n    attachEventListeners() {\n        this.vinSlider.addEventListener('input', () => this.updateVin());\n        this.dutySlider.addEventListener('input', () => this.updateDuty());\n        this.fsSlider.addEventListener('input', () => this.updateFs());\n        this.lSlider.addEventListener('input', () => this.updateL());\n        this.cSlider.addEventListener('input', () => this.updateC());\n        this.rloadSlider.addEventListener('input', () => this.updateRload());\n        \n        this.simulateBtn.addEventListener('click', () => this.toggleSimulation());\n        this.resetBtn.addEventListener('click', () => this.reset());\n        \n        window.addEventListener('resize', () => this.setupCanvases());\n    }\n    \n    updateVin() {\n        this.Vin = parseFloat(this.vinSlider.value);\n        this.vinValue.textContent = this.Vin.toFixed(1);\n        this.vinLabel.textContent = `${this.Vin}V`;\n        this.calculate();\n        this.updateDisplay();\n    }\n    \n    updateDuty() {\n        this.D = parseFloat(this.dutySlider.value);\n        this.dutyValue.textContent = this.D.toFixed(2);\n        this.dutyLabel.textContent = `D=${this.D.toFixed(2)}`;\n        this.calculate();\n        this.updateDisplay();\n    }\n    \n    updateFs() {\n        this.fs = parseFloat(this.fsSlider.value) * 1000; // Convert to Hz\n        this.fsValue.textContent = (this.fs / 1000).toFixed(0);\n        this.calculate();\n        this.updateDisplay();\n    }\n    \n    updateL() {\n        this.L = parseFloat(this.lSlider.value) / 1000000; // Convert µH to H\n        this.lValue.textContent = (this.L * 1000000).toFixed(0);\n        this.inductorLabel.textContent = `${(this.L * 1000000).toFixed(0)}µH`;\n        this.calculate();\n        this.updateDisplay();\n    }\n    \n    updateC() {\n        this.C = parseFloat(this.cSlider.value) / 1000000; // Convert µF to F\n        this.cValue.textContent = (this.C * 1000000).toFixed(0);\n        this.capacitorLabel.textContent = `${(this.C * 1000000).toFixed(0)}µF`;\n        this.calculate();\n        this.updateDisplay();\n    }\n    \n    updateRload() {\n        this.Rload = parseFloat(this.rloadSlider.value);\n        this.rloadValue.textContent = this.Rload.toFixed(1);\n        this.loadLabel.textContent = `${this.Rload.toFixed(0)}Ω`;\n        this.calculate();\n        this.updateDisplay();\n    }\n    \n    calculate() {\n        // Output voltage: Vout = Vin / (1 - D)\n        this.Vout = this.Vin / (1 - this.D);\n        \n        // Output current: Iout = Vout / Rload\n        this.Iout = this.Vout / this.Rload;\n        \n        // Inductor ripple current: deltaIL = (Vin * D) / (L * fs)\n        this.deltaIL = (this.Vin * this.D) / (this.L * this.fs);\n        \n        // Capacitor ripple voltage: deltaVC = (Iout * D) / (C * fs)\n        this.deltaVC = (this.Iout * this.D) / (this.C * this.fs);\n    }\n    \n    updateDisplay() {\n        this.voutResult.textContent = `${this.Vout.toFixed(2)} V`;\n        this.voutIndicator.textContent = `${this.Vout.toFixed(1)}V`;\n        this.ioutResult.textContent = `${this.Iout.toFixed(3)} A`;\n        this.deltaILResult.textContent = `${this.deltaIL.toFixed(3)} A`;\n        this.deltaVCResult.textContent = `${this.deltaVC.toFixed(3)} V`;\n        \n        // Animate result cards\n        document.querySelectorAll('.result-card').forEach((card, i) => {\n            setTimeout(() => {\n                card.style.animation = 'none';\n                setTimeout(() => {\n                    card.style.animation = 'fadeIn 0.5s ease';\n                }, 10);\n            }, i * 100);\n        });\n    }\n    \n    toggleSimulation() {\n        if (this.animationRunning) {\n            this.stopAnimation();\n        } else {\n            this.startAnimation();\n        }\n    }\n    \n    startAnimation() {\n        this.animationRunning = true;\n        this.simulateBtn.textContent = 'Stop Simulation';\n        this.simulateBtn.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';\n        this.animate();\n    }\n    \n    stopAnimation() {\n        this.animationRunning = false;\n        this.simulateBtn.textContent = 'Run Simulation';\n        this.simulateBtn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';\n        this.wires.forEach(wire => wire.classList.remove('active'));\n        this.switchBlade.classList.remove('on');\n        this.diodeGlow.classList.remove('conducting');\n    }\n    \n    animate() {\n        if (!this.animationRunning) return;\n        \n        const period = 1000 / (this.fs / 1000); // Period in ms for visualization\n        const timeInCycle = (Date.now() % period) / period;\n        \n        // Switch ON phase (0 to D)\n        if (timeInCycle < this.D) {\n            this.switchBlade.classList.add('on');\n            this.diodeGlow.classList.remove('conducting');\n            \n            // Current flows: Vin -> L -> Switch -> Ground\n            [0, 1, 2, 9, 10].forEach(i => {\n                if (this.wires[i]) this.wires[i].classList.add('active');\n            });\n            [3, 4, 5, 6, 7, 8].forEach(i => {\n                if (this.wires[i]) this.wires[i].classList.remove('active');\n            });\n        } \n        // Switch OFF phase (D to 1)\n        else {\n            this.switchBlade.classList.remove('on');\n            this.diodeGlow.classList.add('conducting');\n            \n            // Current flows: Vin -> L -> Diode -> Load -> Ground\n            [0, 1, 2, 3, 4, 5, 6, 7, 8].forEach(i => {\n                if (this.wires[i]) this.wires[i].classList.add('active');\n            });\n            [9, 10].forEach(i => {\n                if (this.wires[i]) this.wires[i].classList.remove('active');\n            });\n        }\n        \n        this.drawWaveforms(timeInCycle);\n        \n        requestAnimationFrame(() => this.animate());\n    }\n    \n    reset() {\n        this.stopAnimation();\n        \n        // Reset to default values\n        this.Vin = 12;\n        this.D = 0.50;\n        this.fs = 50000;\n        this.L = 0.0001;\n        this.C = 0.0001;\n        this.Rload = 50;\n        \n        // Update sliders\n        this.vinSlider.value = this.Vin;\n        this.dutySlider.value = this.D;\n        this.fsSlider.value = this.fs / 1000;\n        this.lSlider.value = this.L * 1000000;\n        this.cSlider.value = this.C * 1000000;\n        this.rloadSlider.value = this.Rload;\n        \n        // Update displays\n        this.vinValue.textContent = this.Vin;\n        this.dutyValue.textContent = this.D.toFixed(2);\n        this.fsValue.textContent = (this.fs / 1000).toFixed(0);\n        this.lValue.textContent = (this.L * 1000000).toFixed(0);\n        this.cValue.textContent = (this.C * 1000000).toFixed(0);\n        this.rloadValue.textContent = this.Rload.toFixed(1);\n        \n        this.calculate();\n        this.updateDisplay();\n        this.drawWaveforms(0);\n    }\n    \n    setupCanvases() {\n        [this.canvas1, this.canvas2].forEach(canvas => {\n            const rect = canvas.getBoundingClientRect();\n            canvas.width = rect.width * window.devicePixelRatio;\n            canvas.height = rect.height * window.devicePixelRatio;\n            const ctx = canvas.getContext('2d');\n            ctx.scale(window.devicePixelRatio, window.devicePixelRatio);\n        });\n        this.drawWaveforms(0);\n    }\n    \n    drawWaveforms(timeInCycle) {\n        this.drawSwitchAndCurrent(timeInCycle);\n        this.drawOutputRipple(timeInCycle);\n    }\n    \n    drawSwitchAndCurrent(timeInCycle) {\n        const w = this.canvas1.width / window.devicePixelRatio;\n        const h = this.canvas1.height / window.devicePixelRatio;\n        \n        this.ctx1.clearRect(0, 0, w, h);\n        \n        const padding = 40;\n        const graphW = w - 2 * padding;\n        const graphH = (h - 3 * padding) / 2;\n        \n        // Draw switch state\n        this.ctx1.fillStyle = '#1f2937';\n        this.ctx1.font = 'bold 14px Arial';\n        this.ctx1.fillText('Switch State', padding, padding - 10);\n        \n        this.ctx1.strokeStyle = '#e5e7eb';\n        this.ctx1.lineWidth = 1;\n        this.ctx1.strokeRect(padding, padding, graphW, graphH);\n        \n        // Draw switch waveform\n        this.ctx1.strokeStyle = '#f59e0b';\n        this.ctx1.lineWidth = 2;\n        this.ctx1.beginPath();\n        \n        for (let i = 0; i <= graphW; i++) {\n            const t = i / graphW;\n            const x = padding + i;\n            const switchState = (t % 1) < this.D ? 1 : 0;\n            const y = padding + graphH - switchState * graphH * 0.8;\n            \n            if (i === 0) this.ctx1.moveTo(x, y);\n            else this.ctx1.lineTo(x, y);\n        }\n        this.ctx1.stroke();\n        \n        // Current position marker\n        const markerX = padding + timeInCycle * graphW;\n        this.ctx1.strokeStyle = '#dc2626';\n        this.ctx1.lineWidth = 2;\n        this.ctx1.beginPath();\n        this.ctx1.moveTo(markerX, padding);\n        this.ctx1.lineTo(markerX, padding + graphH);\n        this.ctx1.stroke();\n        \n        // Draw inductor current\n        const y2Start = padding + graphH + padding;\n        this.ctx1.fillText('Inductor Current', padding, y2Start - 10);\n        \n        this.ctx1.strokeStyle = '#e5e7eb';\n        this.ctx1.strokeRect(padding, y2Start, graphW, graphH);\n        \n        // Calculate average current\n        const Iavg = this.Iout / (1 - this.D);\n        \n        // Draw inductor current waveform\n        this.ctx1.strokeStyle = '#10b981';\n        this.ctx1.lineWidth = 2;\n        this.ctx1.beginPath();\n        \n        for (let i = 0; i <= graphW; i++) {\n            const t = i / graphW;\n            let iL;\n            \n            if ((t % 1) < this.D) {\n                // Rising (switch ON)\n                const localT = (t % 1) / this.D;\n                iL = Iavg - this.deltaIL / 2 + this.deltaIL * localT;\n            } else {\n                // Falling (switch OFF)\n                const localT = ((t % 1) - this.D) / (1 - this.D);\n                iL = Iavg + this.deltaIL / 2 - this.deltaIL * localT;\n            }\n            \n            const x = padding + i;\n            const y = y2Start + graphH - (iL / (Iavg + this.deltaIL)) * graphH * 0.8;\n            \n            if (i === 0) this.ctx1.moveTo(x, y);\n            else this.ctx1.lineTo(x, y);\n        }\n        this.ctx1.stroke();\n        \n        // Current position marker\n        this.ctx1.strokeStyle = '#dc2626';\n        this.ctx1.lineWidth = 2;\n        this.ctx1.beginPath();\n        this.ctx1.moveTo(markerX, y2Start);\n        this.ctx1.lineTo(markerX, y2Start + graphH);\n        this.ctx1.stroke();\n    }\n    \n    drawOutputRipple(timeInCycle) {\n        const w = this.canvas2.width / window.devicePixelRatio;\n        const h = this.canvas2.height / window.devicePixelRatio;\n        \n        this.ctx2.clearRect(0, 0, w, h);\n        \n        const padding = 40;\n        const graphW = w - 2 * padding;\n        const graphH = h - 2 * padding;\n        \n        // Draw title and border\n        this.ctx2.fillStyle = '#1f2937';\n        this.ctx2.font = 'bold 14px Arial';\n        this.ctx2.fillText(`Vout Ripple (±${(this.deltaVC / 2).toFixed(3)}V)`, padding, padding - 10);\n        \n        this.ctx2.strokeStyle = '#e5e7eb';\n        this.ctx2.lineWidth = 1;\n        this.ctx2.strokeRect(padding, padding, graphW, graphH);\n        \n        // Draw average line\n        this.ctx2.strokeStyle = '#94a3b8';\n        this.ctx2.setLineDash([5, 5]);\n        this.ctx2.beginPath();\n        this.ctx2.moveTo(padding, padding + graphH / 2);\n        this.ctx2.lineTo(padding + graphW, padding + graphH / 2);\n        this.ctx2.stroke();\n        this.ctx2.setLineDash([]);\n        \n        // Draw ripple waveform (triangular)\n        this.ctx2.strokeStyle = '#2563eb';\n        this.ctx2.lineWidth = 2.5;\n        this.ctx2.beginPath();\n        \n        for (let i = 0; i <= graphW; i++) {\n            const t = i / graphW;\n            let vRipple;\n            \n            if ((t % 1) < this.D) {\n                // Discharging (switch ON)\n                const localT = (t % 1) / this.D;\n                vRipple = this.deltaVC / 2 - this.deltaVC * localT;\n            } else {\n                // Charging (switch OFF)\n                const localT = ((t % 1) - this.D) / (1 - this.D);\n                vRipple = -this.deltaVC / 2 + this.deltaVC * localT;\n            }\n            \n            const x = padding + i;\n            const y = padding + graphH / 2 - (vRipple / this.deltaVC) * graphH * 0.4;\n            \n            if (i === 0) this.ctx2.moveTo(x, y);\n            else this.ctx2.lineTo(x, y);\n        }\n        this.ctx2.stroke();\n        \n        // Current position marker\n        const markerX = padding + timeInCycle * graphW;\n        this.ctx2.strokeStyle = '#dc2626';\n        this.ctx2.lineWidth = 2;\n        this.ctx2.beginPath();\n        this.ctx2.moveTo(markerX, padding);\n        this.ctx2.lineTo(markerX, padding + graphH);\n        this.ctx2.stroke();\n        \n        // Labels\n        this.ctx2.fillStyle = '#6b7280';\n        this.ctx2.font = '12px Arial';\n        this.ctx2.fillText(`+${(this.deltaVC / 2).toFixed(3)}V`, padding - 35, padding + 10);\n        this.ctx2.fillText(`-${(this.deltaVC / 2).toFixed(3)}V`, padding - 35, padding + graphH - 5);\n    }\n}\n\n// Initialize simulator\ndocument.addEventListener('DOMContentLoaded', () => {\n    new BoostConverter();\n});"}}
{"input": {"input_text": "Buck-boost converter CCM: given Vin, duty D, fs, L, C, load R. Provide Vout and ripple.", "simulation_name": " BuckBoost CCM", "domain": "Electrical Engineering", "description": "Ideal inverting buck-boost CCM", "assumptions": ["Ideal switches", "CCM"], "entities": [], "constants": [], "parameters": [{"name": "input_voltage", "symbol": "Vin", "unit": "V", "range": [1, 40]}, {"name": "duty_cycle", "symbol": "D", "unit": "fraction", "range": [0, 0.9]}, {"name": "switching_frequency", "symbol": "fs", "unit": "Hz", "range": [1000.0, 1000000.0]}, {"name": "inductor", "symbol": "L", "unit": "H", "range": [1e-06, 0.01]}, {"name": "capacitor", "symbol": "C", "unit": "F", "range": [1e-09, 0.001]}, {"name": "load_resistance", "symbol": "Rload", "unit": "ohm", "range": [0.5, 1000.0]}], "equations": [{"description": "Output voltage", "expression": "Vout = -Vin*D/(1 - D)"}, {"description": "Inductor ripple", "expression": "DeltaIL = Vin*D/(L*fs)"}, {"description": "Capacitor ripple", "expression": "DeltaVC = (|Iout|*D)/(C*fs)"}], "initial_conditions": {}, "outputs": ["Vout", "DeltaIL", "DeltaVC"], "simulation_controls": ["Vin", "D", "fs", "L", "C", "Rload"], "constraints": ["0 < D < 1"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Inverting Buck-Boost Converter Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"dashboard\">\n    <header>\n        <h1>Inverting Buck-Boost Converter</h1>\n        <p class=\"subtitle\">Continuous Conduction Mode (CCM) Analysis</p>\n    </header>\n\n    <div class=\"main-content\">\n        <aside class=\"controls\">\n            <div class=\"control-group\">\n                <label for=\"vin\">Input Voltage ($V_{in}$)</label>\n                <div class=\"slider-row\">\n                    <input type=\"range\" id=\"vin\" min=\"1\" max=\"40\" step=\"0.5\" value=\"12\">\n                    <span id=\"val-vin\" class=\"value-display\">12.0 V</span>\n                </div>\n            </div>\n\n            <div class=\"control-group\">\n                <label for=\"duty\">Duty Cycle ($D$)</label>\n                <div class=\"slider-row\">\n                    <input type=\"range\" id=\"duty\" min=\"0.1\" max=\"0.85\" step=\"0.01\" value=\"0.4\">\n                    <span id=\"val-duty\" class=\"value-display\">0.40</span>\n                </div>\n            </div>\n\n            <div class=\"control-group\">\n                <label for=\"freq\">Frequency ($f_s$)</label>\n                <div class=\"slider-row\">\n                    <input type=\"range\" id=\"freq\" min=\"10\" max=\"500\" step=\"10\" value=\"100\">\n                    <span id=\"val-freq\" class=\"value-display\">100 kHz</span>\n                </div>\n            </div>\n\n            <div class=\"control-group\">\n                <label for=\"ind\">Inductance ($L$)</label>\n                <div class=\"slider-row\">\n                    <input type=\"range\" id=\"ind\" min=\"10\" max=\"1000\" step=\"10\" value=\"150\">\n                    <span id=\"val-ind\" class=\"value-display\">150 μH</span>\n                </div>\n            </div>\n\n            <div class=\"control-group\">\n                <label for=\"cap\">Capacitance ($C$)</label>\n                <div class=\"slider-row\">\n                    <input type=\"range\" id=\"cap\" min=\"1\" max=\"1000\" step=\"1\" value=\"100\">\n                    <span id=\"val-cap\" class=\"value-display\">100 μF</span>\n                </div>\n            </div>\n\n            <div class=\"control-group\">\n                <label for=\"res\">Load Resistance ($R$)</label>\n                <div class=\"slider-row\">\n                    <input type=\"range\" id=\"res\" min=\"1\" max=\"200\" step=\"1\" value=\"10\">\n                    <span id=\"val-res\" class=\"value-display\">10 Ω</span>\n                </div>\n            </div>\n\n            <div class=\"results-box\">\n                <h3>Steady State Outputs</h3>\n                <div class=\"result-item\">\n                    <span>$V_{out}$ (Avg):</span>\n                    <span id=\"out-vout\" class=\"res-value negative\">-8.00 V</span>\n                </div>\n                <div class=\"result-item\">\n                    <span>$\\Delta I_L$ (Ripple):</span>\n                    <span id=\"out-ripple-i\" class=\"res-value\">0.32 A</span>\n                </div>\n                <div class=\"result-item\">\n                    <span>$\\Delta V_{out}$ (Ripple):</span>\n                    <span id=\"out-ripple-v\" class=\"res-value\">0.05 V</span>\n                </div>\n                <div class=\"result-item warning\" id=\"ccm-warning\" style=\"display:none;\">\n                    Warning: Likely DCM\n                </div>\n            </div>\n        </aside>\n\n        <main class=\"visuals\">\n            <div class=\"canvas-container\">\n                <div class=\"canvas-header\">\n                    <span>Circuit Diagram</span>\n                    <span id=\"switch-state\" class=\"badge\">SW: ON</span>\n                </div>\n                <canvas id=\"circuitCanvas\"></canvas>\n            </div>\n\n            <div class=\"canvas-container\">\n                <div class=\"canvas-header\">\n                    <span>Waveforms (Oscilloscope)</span>\n                    <div class=\"legend\">\n                        <span style=\"color:#e74c3c\">● $I_L$</span>\n                        <span style=\"color:#3498db\">● $V_{out}$</span>\n                    </div>\n                </div>\n                <canvas id=\"scopeCanvas\"></canvas>\n            </div>\n        </main>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-color: #f0f2f5;\n    --card-bg: #ffffff;\n    --primary-color: #2c3e50;\n    --accent-color: #3498db;\n    --danger-color: #e74c3c;\n    --success-color: #27ae60;\n    --text-color: #333;\n    --border-color: #e1e4e8;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    margin: 0;\n    padding: 20px;\n    height: 100vh;\n    box-sizing: border-box;\n    overflow: hidden; /* Fix layout */\n}\n\n.dashboard {\n    max-width: 1400px;\n    height: 95vh;\n    margin: 0 auto;\n    display: flex;\n    flex-direction: column;\n}\n\nheader {\n    margin-bottom: 20px;\n}\n\nh1 {\n    margin: 0;\n    font-size: 1.8rem;\n    color: var(--primary-color);\n}\n\n.subtitle {\n    margin: 5px 0 0;\n    color: #666;\n    font-size: 0.9rem;\n}\n\n.main-content {\n    display: flex;\n    gap: 20px;\n    flex: 1;\n    overflow: hidden;\n}\n\n/* Sidebar Controls */\n.controls {\n    flex: 0 0 320px;\n    background: var(--card-bg);\n    padding: 20px;\n    border-radius: 8px;\n    box-shadow: 0 2px 10px rgba(0,0,0,0.05);\n    display: flex;\n    flex-direction: column;\n    overflow-y: auto;\n}\n\n.control-group {\n    margin-bottom: 15px;\n}\n\n.control-group label {\n    display: block;\n    font-weight: 600;\n    font-size: 0.9rem;\n    margin-bottom: 5px;\n}\n\n.slider-row {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\ninput[type=\"range\"] {\n    flex: 1;\n    cursor: pointer;\n}\n\n.value-display {\n    width: 70px;\n    text-align: right;\n    font-family: 'Courier New', monospace;\n    font-weight: bold;\n    color: var(--accent-color);\n}\n\n.results-box {\n    margin-top: auto;\n    background: #f8f9fa;\n    padding: 15px;\n    border-radius: 6px;\n    border: 1px solid var(--border-color);\n}\n\n.results-box h3 {\n    margin-top: 0;\n    font-size: 1rem;\n    border-bottom: 2px solid #ddd;\n    padding-bottom: 8px;\n}\n\n.result-item {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 8px;\n    font-size: 0.95rem;\n}\n\n.res-value {\n    font-weight: bold;\n    font-family: monospace;\n}\n\n.res-value.negative {\n    color: var(--accent-color);\n}\n\n.warning {\n    color: var(--danger-color);\n    font-weight: bold;\n    font-size: 0.85rem;\n    text-align: center;\n    margin-top: 10px;\n}\n\n/* Visualization Area */\n.visuals {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.canvas-container {\n    background: var(--card-bg);\n    border-radius: 8px;\n    box-shadow: 0 2px 10px rgba(0,0,0,0.05);\n    padding: 10px;\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    position: relative;\n}\n\n.canvas-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 10px;\n    font-weight: 600;\n    color: #555;\n}\n\n.badge {\n    padding: 4px 8px;\n    border-radius: 4px;\n    font-size: 0.8rem;\n    font-weight: bold;\n    background: #eee;\n}\n\ncanvas {\n    width: 100%;\n    height: 100%;\n    display: block;\n}\n\n@media (max-width: 900px) {\n    .main-content {\n        flex-direction: column;\n        overflow: auto;\n    }\n    .controls {\n        flex: none;\n    }\n    .canvas-container {\n        min-height: 300px;\n    }\n    body {\n        overflow: auto;\n        height: auto;\n    }\n}", "js": "// --- Configuration & State ---\nconst state = {\n    Vin: 12,\n    D: 0.4,\n    fs: 100000,\n    L: 150e-6,\n    C: 100e-6,\n    R: 10,\n    \n    // Calculated\n    Vout: 0,\n    I_L_avg: 0,\n    dIL: 0,\n    dVC: 0,\n    \n    // Animation\n    t: 0,\n    isSwitchOn: false\n};\n\n// DOM Elements\nconst inputs = {\n    vin: document.getElementById('vin'),\n    duty: document.getElementById('duty'),\n    freq: document.getElementById('freq'),\n    ind: document.getElementById('ind'),\n    cap: document.getElementById('cap'),\n    res: document.getElementById('res')\n};\n\nconst labels = {\n    vin: document.getElementById('val-vin'),\n    duty: document.getElementById('val-duty'),\n    freq: document.getElementById('val-freq'),\n    ind: document.getElementById('val-ind'),\n    cap: document.getElementById('val-cap'),\n    res: document.getElementById('val-res')\n};\n\nconst outputs = {\n    vout: document.getElementById('out-vout'),\n    dIL: document.getElementById('out-ripple-i'),\n    dVC: document.getElementById('out-ripple-v'),\n    warning: document.getElementById('ccm-warning'),\n    swState: document.getElementById('switch-state')\n};\n\nconst canvasCircuit = document.getElementById('circuitCanvas');\nconst canvasScope = document.getElementById('scopeCanvas');\nconst ctxCircuit = canvasCircuit.getContext('2d');\nconst ctxScope = canvasScope.getContext('2d');\n\n// --- Initialization ---\nfunction init() {\n    // Listeners\n    Object.keys(inputs).forEach(k => {\n        inputs[k].addEventListener('input', updatePhysics);\n    });\n    \n    window.addEventListener('resize', resizeCanvases);\n    \n    resizeCanvases();\n    updatePhysics();\n    animate();\n}\n\nfunction resizeCanvases() {\n    const dpr = window.devicePixelRatio || 1;\n    \n    [canvasCircuit, canvasScope].forEach(cvs => {\n        const rect = cvs.parentElement.getBoundingClientRect();\n        // Adjust for header height inside container\n        const avH = rect.height - 40; \n        cvs.width = rect.width * dpr;\n        cvs.height = avH * dpr;\n        \n        const ctx = cvs.getContext('2d');\n        ctx.scale(dpr, dpr);\n        \n        cvs.style.width = `${rect.width}px`;\n        cvs.style.height = `${avH}px`;\n        \n        cvs.logicalWidth = rect.width;\n        cvs.logicalHeight = avH;\n    });\n}\n\n// --- Physics Engine ---\nfunction updatePhysics() {\n    // Read Inputs\n    state.Vin = parseFloat(inputs.vin.value);\n    state.D = parseFloat(inputs.duty.value);\n    state.fs = parseFloat(inputs.freq.value) * 1000;\n    state.L = parseFloat(inputs.ind.value) * 1e-6;\n    state.C = parseFloat(inputs.cap.value) * 1e-6;\n    state.R = parseFloat(inputs.res.value);\n    \n    // Update Labels\n    labels.vin.innerText = state.Vin.toFixed(1) + \" V\";\n    labels.duty.innerText = state.D.toFixed(2);\n    labels.freq.innerText = (state.fs/1000).toFixed(0) + \" kHz\";\n    labels.ind.innerText = (state.L*1e6).toFixed(0) + \" μH\";\n    labels.cap.innerText = (state.C*1e6).toFixed(0) + \" μF\";\n    labels.res.innerText = state.R.toFixed(1) + \" Ω\";\n    \n    // Calculate Outputs (Buck-Boost Inverting)\n    // Vout = -Vin * (D / (1-D))\n    const gain = state.D / (1 - state.D);\n    state.Vout = -state.Vin * gain;\n    \n    // Inductor Ripple: dIL = (Vin * D) / (L * fs)\n    state.dIL = (state.Vin * state.D) / (state.L * state.fs);\n    \n    // Capacitor Ripple: dVC = (|Iout| * D) / (C * fs)\n    // Iout = Vout / R\n    const Iout = Math.abs(state.Vout) / state.R;\n    state.dVC = (Iout * state.D) / (state.C * state.fs);\n    \n    // Average Inductor Current: I_L = (I_out) / (1-D)\n    state.I_L_avg = Iout / (1 - state.D);\n\n    // Check CCM/DCM boundary\n    // DCM if dIL > 2 * I_L_avg (approx)\n    const isDCM = state.dIL > (2 * state.I_L_avg);\n    if(isDCM) {\n        outputs.warning.style.display = \"block\";\n        outputs.warning.innerText = \"Warning: Parameters entering DCM\";\n    } else {\n        outputs.warning.style.display = \"none\";\n    }\n\n    // Update Output DOM\n    outputs.vout.innerText = state.Vout.toFixed(2) + \" V\";\n    outputs.dIL.innerText = state.dIL.toFixed(3) + \" A\";\n    outputs.dVC.innerText = state.dVC.toFixed(3) + \" V\";\n}\n\n// --- Animation Loop ---\nfunction animate() {\n    // Time step\n    state.t += 0.01; // Arbitrary animation speed\n    \n    // Calculate Switch State for Animation (Visual cycle only)\n    const cyclePos = state.t % 1.0;\n    state.isSwitchOn = cyclePos < state.D;\n    \n    // Update Badge\n    if(state.isSwitchOn) {\n        outputs.swState.innerText = \"SWITCH: ON (Charging L)\";\n        outputs.swState.style.background = \"#d4efdf\";\n        outputs.swState.style.color = \"#27ae60\";\n    } else {\n        outputs.swState.innerText = \"SWITCH: OFF (Discharging L)\";\n        outputs.swState.style.background = \"#fadbd8\";\n        outputs.swState.style.color = \"#c0392b\";\n    }\n    \n    drawCircuit();\n    drawScope();\n    \n    requestAnimationFrame(animate);\n}\n\n// --- Drawing: Circuit ---\nfunction drawCircuit() {\n    const ctx = ctxCircuit;\n    const w = canvasCircuit.logicalWidth;\n    const h = canvasCircuit.logicalHeight;\n    \n    ctx.clearRect(0,0,w,h);\n    \n    const pad = 40;\n    const yLine = h / 2;\n    const xStart = pad;\n    const xEnd = w - pad;\n    \n    // Components X positions\n    const xVin = xStart + 20;\n    const xSw = xStart + (w-pad*2)*0.3;\n    const xL = xSw; // Inductor is vertical in BB topology (after sw, to gnd)\n    const xDiode = xStart + (w-pad*2)*0.6;\n    const xCap = xStart + (w-pad*2)*0.8;\n    const xR = xEnd - 20;\n    \n    // Heights\n    const yTop = yLine - 60;\n    const yBot = yLine + 60;\n    \n    ctx.lineWidth = 2;\n    ctx.lineJoin = \"round\";\n    ctx.strokeStyle = \"#333\";\n    \n    // --- Draw Wires ---\n    ctx.beginPath();\n    \n    // Input Loop: Vin -> Sw -> Node\n    ctx.moveTo(xVin, yTop);\n    ctx.lineTo(xSw - 20, yTop); // To switch\n    \n    // Switch logic visual\n    if(state.isSwitchOn) {\n        ctx.lineTo(xSw + 20, yTop); \n    } else {\n        ctx.moveTo(xSw - 20, yTop);\n        ctx.lineTo(xSw + 15, yTop - 15); // Open\n        ctx.moveTo(xSw + 20, yTop);\n    }\n    \n    // Node after switch\n    ctx.lineTo(xDiode - 20, yTop); // To Diode\n    \n    // Inductor Leg (Vertical at Switch Node in some drawings, \n    // but classic Buck-Boost: Vin -> Sw -> L -> Gnd is correct for energy storage phase)\n    // Wait, standard schematic:\n    // Vin -> Switch -> NodeA. \n    // NodeA -> Inductor -> Ground.\n    // NodeA -> Diode -> OutputNode.\n    // OutputNode -> Cap -> Ground.\n    // OutputNode -> Load -> Ground.\n    // NOTE: This produces INVERTED output. Diode must point AWAY from NodeA if using Back EMF, \n    // or correct polarity logic.\n    // With Switch OFF, L pulls current from Ground, pushes to NodeA.\n    // So Diode Anode is at Output, Cathode at NodeA? No.\n    // Current flows: Gnd -> L -> NodeA -> Diode -> Output -> Gnd. \n    // This makes Output Negative. Diode Cathode at NodeA, Anode at Output.\n    \n    // Redrawing Schematic per Standard Inverting BB:\n    // Top Rail broken by Switch.\n    // Inductor connects Top Rail (after Sw) to Gnd.\n    // Diode connects Top Rail (after Sw) to Output Rail. \n    // BUT Diode direction: Anode at Output, Cathode at Top Rail (blocks Vin).\n    \n    // Let's draw:\n    // 1. Vin (Left)\n    // 2. Switch (Series Top)\n    // 3. Inductor (Shunt to Gnd)\n    // 4. Diode (Series to Output)\n    // 5. Cap/Load (Shunt)\n    \n    // Wire: Switch Out to Inductor Top\n    ctx.moveTo(xSw + 20, yTop);\n    ctx.lineTo(xL, yTop); \n    ctx.lineTo(xL, yTop + 20); // L start\n    \n    // Wire: Inductor Bot to Gnd\n    ctx.moveTo(xL, yBot - 20);\n    ctx.lineTo(xL, yBot);\n    \n    // Wire: Switch Out to Diode\n    ctx.moveTo(xL, yTop);\n    ctx.lineTo(xDiode - 10, yTop); // Diode start\n    \n    // Wire: Diode Out to Cap/Load\n    ctx.moveTo(xDiode + 10, yTop);\n    ctx.lineTo(xR, yTop);\n    \n    // Bottom Rail (Ground)\n    ctx.moveTo(xVin, yBot);\n    ctx.lineTo(xR, yBot);\n    \n    // Vertical legs for Vin, Cap, R\n    ctx.moveTo(xVin, yTop); ctx.lineTo(xVin, yBot);\n    ctx.moveTo(xCap, yTop); ctx.lineTo(xCap, yBot);\n    ctx.moveTo(xR, yTop); ctx.lineTo(xR, yBot);\n    \n    ctx.stroke();\n    \n    // --- Components ---\n    \n    // Source\n    drawSource(ctx, xVin, (yTop+yBot)/2);\n    \n    // Inductor\n    drawInductor(ctx, xL, (yTop+yBot)/2, true); // true = vertical\n    \n    // Diode (Points Left? No, Current flows Right to Left during discharge to make neg output)\n    // Switch OFF: L current flows UP. NodeA becomes negative? \n    // No, L resists change. Current was flowing DOWN. So L tries to keep flowing DOWN. \n    // So L pulls from NodeA and pushes to Gnd.\n    // Wait. Vin -> Sw -> L(down) -> Gnd. Current Down.\n    // Switch OFF. L current continues DOWN.\n    // Loop: L(bot) -> Gnd -> Load -> Diode -> L(top).\n    // So current flows out of Gnd, through Load (up), through Diode (left), into L(top).\n    // This makes Top Rail Negative.\n    // So Diode points LEFT.\n    drawDiode(ctx, xDiode, yTop, true); // true = points left\n    \n    // Capacitor\n    drawCapacitor(ctx, xCap, (yTop+yBot)/2);\n    \n    // Resistor\n    drawResistor(ctx, xR, (yTop+yBot)/2);\n    \n    // --- Animation Flow (Electrons/Current) ---\n    ctx.fillStyle = \"#f1c40f\"; // Yellow dots\n    \n    if(state.isSwitchOn) {\n        // Loop 1: Vin -> Sw -> L -> Gnd -> Vin\n        // Path: Vin(top) -> Sw -> L(top) -> L(bot) -> Gnd -> Vin(bot)\n        drawFlow(ctx, [\n            {x: xVin, y: yTop},\n            {x: xSw, y: yTop},\n            {x: xL, y: yTop},\n            {x: xL, y: yBot},\n            {x: xVin, y: yBot},\n            {x: xVin, y: yTop}\n        ], state.t * 50);\n    } else {\n        // Loop 2: L acts as source. Current flows DOWN.\n        // Path: L(bot) -> Gnd -> Load(bot) -> Load(top) -> Diode -> L(top)\n        drawFlow(ctx, [\n            {x: xL, y: yBot},\n            {x: xR, y: yBot}, // Gnd rail\n            {x: xR, y: yTop}, // Up through load (Negative output logic)\n            {x: xDiode, y: yTop}, // Left through diode\n            {x: xL, y: yTop},\n            {x: xL, y: yBot}\n        ], state.t * 50);\n    }\n}\n\n// --- Drawing: Scope ---\nfunction drawScope() {\n    const ctx = ctxScope;\n    const w = canvasScope.logicalWidth;\n    const h = canvasScope.logicalHeight;\n    \n    ctx.clearRect(0,0,w,h);\n    \n    // Grid\n    ctx.strokeStyle = \"#eee\";\n    ctx.lineWidth = 1;\n    ctx.beginPath();\n    ctx.moveTo(0, h/2); ctx.lineTo(w, h/2); // Zero line\n    ctx.stroke();\n    \n    // We plot ~2 cycles\n    const cycles = 2.5;\n    const pts = w;\n    \n    // I_L (Inductor Current) - Red\n    ctx.strokeStyle = \"#e74c3c\";\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    \n    for(let i=0; i<pts; i++) {\n        const x = i;\n        const timeRatio = (i / w) * cycles; // 0 to 2.5\n        const localT = timeRatio % 1.0; // 0 to 1\n        \n        // Triangle Wave logic\n        // Rise during D, Fall during 1-D\n        // Center around 0 visually, but logically it's I_L_avg\n        let val = 0;\n        if(localT < state.D) {\n            // Rising: -0.5 to 0.5\n            val = -0.5 + (localT / state.D);\n        } else {\n            // Falling: 0.5 to -0.5\n            val = 0.5 - ((localT - state.D) / (1 - state.D));\n        }\n        \n        // Scale for view\n        const amp = h * 0.15;\n        const y = (h * 0.25) - (val * amp); // Top half of canvas\n        \n        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);\n    }\n    ctx.stroke();\n    \n    // V_out (Output Voltage) - Blue\n    // It is negative DC with ripple\n    ctx.strokeStyle = \"#3498db\";\n    ctx.beginPath();\n    \n    for(let i=0; i<pts; i++) {\n        const x = i;\n        const timeRatio = (i / w) * cycles;\n        const localT = timeRatio % 1.0;\n        \n        // Ripple logic (Simplified)\n        // Charging Cap (Switch OFF, 1-D): Voltage Magnitude Increases (More Negative)\n        // Discharging Cap (Switch ON, D): Voltage Magnitude Decreases (Less Negative)\n        \n        // Let's plot Magnitude for clarity, or actual negative value?\n        // Actual negative value is below zero line.\n        \n        let rippleNorm = 0;\n        if(localT < state.D) {\n            // Switch ON: Cap discharges into R. V becomes less negative (closer to 0).\n            // Linear approx for RC discharge\n            rippleNorm = -0.5 + (localT / state.D);\n        } else {\n            // Switch OFF: Inductor charges Cap. V becomes more negative (further from 0).\n            rippleNorm = 0.5 - ((localT - state.D) / (1 - state.D));\n        }\n        \n        // Scale\n        // Center line for Vout is at h * 0.75\n        const yCenter = h * 0.75;\n        const rippleAmp = h * 0.05; \n        \n        // Note: Ripple shape might be inverted depending on definition, \n        // but this visualizes the fluctuation.\n        const y = yCenter + (rippleNorm * rippleAmp);\n        \n        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);\n    }\n    ctx.stroke();\n    \n    // Labels\n    ctx.fillStyle = \"#e74c3c\";\n    ctx.fillText(\"Inductor Current (I_L)\", 10, h*0.25 - 25);\n    \n    ctx.fillStyle = \"#3498db\";\n    ctx.fillText(`Output Voltage (V_out approx ${state.Vout.toFixed(1)}V)`, 10, h*0.75 - 25);\n}\n\n// --- Helpers ---\nfunction drawSource(ctx, x, y) {\n    ctx.beginPath();\n    ctx.arc(x, y, 15, 0, Math.PI*2);\n    ctx.fillStyle = \"#fff\";\n    ctx.fill();\n    ctx.stroke();\n    ctx.fillStyle = \"#000\";\n    ctx.textAlign = \"center\";\n    ctx.fillText(\"Vin\", x, y+4);\n    ctx.font = \"10px sans-serif\";\n    ctx.fillText(\"+\", x, y-18);\n}\n\nfunction drawInductor(ctx, x, y, vertical) {\n    ctx.beginPath();\n    const len = 40;\n    const coils = 4;\n    \n    if(vertical) {\n        const r = len / (coils*2);\n        for(let i=0; i<coils; i++) {\n            ctx.arc(x, y - len/2 + r + i*r*2, r, -Math.PI/2, Math.PI/2, true); // loops\n        }\n    }\n    ctx.stroke();\n    // Clear inner lines if complex, but simple loops work\n}\n\nfunction drawDiode(ctx, x, y, pointsLeft) {\n    ctx.beginPath();\n    const sz = 10;\n    if(pointsLeft) {\n        ctx.moveTo(x + sz, y - sz);\n        ctx.lineTo(x + sz, y + sz);\n        ctx.lineTo(x - sz, y);\n        ctx.closePath();\n        // Bar\n        ctx.moveTo(x - sz, y - sz);\n        ctx.lineTo(x - sz, y + sz);\n    }\n    ctx.fillStyle = \"#fff\";\n    ctx.fill();\n    ctx.stroke();\n}\n\nfunction drawCapacitor(ctx, x, y) {\n    ctx.beginPath();\n    ctx.moveTo(x - 10, y - 5); ctx.lineTo(x + 10, y - 5);\n    ctx.moveTo(x - 10, y + 5); ctx.lineTo(x + 10, y + 5);\n    ctx.stroke();\n}\n\nfunction drawResistor(ctx, x, y) {\n    ctx.beginPath();\n    ctx.rect(x-5, y-15, 10, 30);\n    ctx.fillStyle = \"#fff\";\n    ctx.fill();\n    ctx.stroke();\n}\n\nfunction drawFlow(ctx, points, offset) {\n    const totalDist = points.reduce((acc, pt, i) => {\n        if(i===0) return 0;\n        const dx = pt.x - points[i-1].x;\n        const dy = pt.y - points[i-1].y;\n        return acc + Math.sqrt(dx*dx + dy*dy);\n    }, 0);\n    \n    const spacing = 20;\n    \n    // We walk the path\n    for(let d = 0; d < totalDist; d+=spacing) {\n        let actualD = (d + offset) % totalDist;\n        \n        // Find coordinate\n        let currentD = 0;\n        for(let i=1; i<points.length; i++) {\n            const p1 = points[i-1];\n            const p2 = points[i];\n            const segLen = Math.hypot(p2.x-p1.x, p2.y-p1.y);\n            \n            if(actualD >= currentD && actualD <= currentD + segLen) {\n                const segPos = (actualD - currentD) / segLen;\n                const px = p1.x + (p2.x - p1.x) * segPos;\n                const py = p1.y + (p2.y - p1.y) * segPos;\n                \n                ctx.beginPath();\n                ctx.arc(px, py, 2.5, 0, Math.PI*2);\n                ctx.fill();\n                break;\n            }\n            currentD += segLen;\n        }\n    }\n}\n\n// Start\ninit();"}}
{"input": {"input_text": "Op-amp inverting amplifier with Rin and Rf, ideal op-amp. Compute gain and output for Vin.", "simulation_name": " OpAmp Inverting", "domain": "Electrical Engineering", "description": "Ideal inverting amplifier gain", "assumptions": ["Ideal op-amp", "Negative feedback closed"], "entities": [], "constants": [], "parameters": [{"name": "input_voltage", "symbol": "Vin", "unit": "V", "range": [-15, 15]}, {"name": "input_resistor", "symbol": "Rin", "unit": "ohm", "range": [100, 1000000.0]}, {"name": "feedback_resistor", "symbol": "Rf", "unit": "ohm", "range": [100, 1000000.0]}], "equations": [{"description": "Gain", "expression": "Av = -Rf/Rin"}, {"description": "Output", "expression": "Vout = Av*Vin"}], "initial_conditions": {}, "outputs": ["Vout", "Av"], "simulation_controls": ["Vin", "Rin", "Rf"], "constraints": ["Rin > 0", "Rf > 0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Op-Amp Inverting Amplifier Simulator</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1>⚡ Inverting Op-Amp Amplifier</h1>\n            <p class=\"subtitle\">Ideal Operational Amplifier Configuration</p>\n        </header>\n\n        <div class=\"main-content\">\n            <!-- Circuit Diagram -->\n            <div class=\"circuit-section\">\n                <h2>Circuit Diagram</h2>\n                <svg id=\"circuit\" viewBox=\"0 0 800 400\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <!-- Input voltage source -->\n                    <g id=\"inputSource\">\n                        <circle cx=\"80\" cy=\"200\" r=\"35\" fill=\"none\" stroke=\"#2d3748\" stroke-width=\"3\"/>\n                        <text x=\"80\" y=\"205\" text-anchor=\"middle\" class=\"component-label\">Vin</text>\n                        <text x=\"80\" y=\"250\" text-anchor=\"middle\" class=\"value-label\" id=\"vinCircuitLabel\">0V</text>\n                    </g>\n                    \n                    <!-- Wires and resistors -->\n                    <line id=\"wire1\" x1=\"115\" y1=\"200\" x2=\"180\" y2=\"200\" class=\"wire\"/>\n                    \n                    <!-- Input resistor Rin -->\n                    <g id=\"rinGroup\">\n                        <rect x=\"180\" y=\"190\" width=\"80\" height=\"20\" fill=\"none\" stroke=\"#2d3748\" stroke-width=\"2\"/>\n                        <line x1=\"185\" y1=\"190\" x2=\"185\" y2=\"210\" stroke=\"#2d3748\" stroke-width=\"1\"/>\n                        <line x1=\"195\" y1=\"190\" x2=\"195\" y2=\"210\" stroke=\"#2d3748\" stroke-width=\"1\"/>\n                        <line x1=\"205\" y1=\"190\" x2=\"205\" y2=\"210\" stroke=\"#2d3748\" stroke-width=\"1\"/>\n                        <line x1=\"215\" y1=\"190\" x2=\"215\" y2=\"210\" stroke=\"#2d3748\" stroke-width=\"1\"/>\n                        <line x1=\"225\" y1=\"190\" x2=\"225\" y2=\"210\" stroke=\"#2d3748\" stroke-width=\"1\"/>\n                        <line x1=\"235\" y1=\"190\" x2=\"235\" y2=\"210\" stroke=\"#2d3748\" stroke-width=\"1\"/>\n                        <line x1=\"245\" y1=\"190\" x2=\"245\" y2=\"210\" stroke=\"#2d3748\" stroke-width=\"1\"/>\n                        <line x1=\"255\" y1=\"190\" x2=\"255\" y2=\"210\" stroke=\"#2d3748\" stroke-width=\"1\"/>\n                        <text x=\"220\" y=\"175\" text-anchor=\"middle\" class=\"component-label\">Rin</text>\n                        <text x=\"220\" y=\"235\" text-anchor=\"middle\" class=\"value-label\" id=\"rinCircuitLabel\">10kΩ</text>\n                    </g>\n                    \n                    <line id=\"wire2\" x1=\"260\" y1=\"200\" x2=\"320\" y2=\"200\" class=\"wire\"/>\n                    <circle id=\"virtualGround\" cx=\"320\" cy=\"200\" r=\"5\" fill=\"#2563eb\"/>\n                    \n                    <!-- Op-amp -->\n                    <g id=\"opampGroup\">\n                        <path d=\"M 350 150 L 350 250 L 480 200 Z\" fill=\"#f3f4f6\" stroke=\"#2d3748\" stroke-width=\"3\"/>\n                        <text x=\"395\" y=\"185\" text-anchor=\"middle\" class=\"opamp-label\">−</text>\n                        <text x=\"395\" y=\"220\" text-anchor=\"middle\" class=\"opamp-label\">+</text>\n                        <text x=\"410\" y=\"205\" text-anchor=\"middle\" class=\"component-label small\">OpAmp</text>\n                        \n                        <!-- Input terminals -->\n                        <line id=\"wire3\" x1=\"320\" y1=\"200\" x2=\"350\" y2=\"180\" class=\"wire\"/>\n                        <line id=\"wire4\" x1=\"320\" y1=\"280\" x2=\"350\" y2=\"215\" class=\"wire\"/>\n                        \n                        <!-- Output -->\n                        <line id=\"wire5\" x1=\"480\" y1=\"200\" x2=\"550\" y2=\"200\" class=\"wire output-wire\"/>\n                    </g>\n                    \n                    <!-- Feedback resistor Rf -->\n                    <g id=\"rfGroup\">\n                        <line id=\"wire6\" x1=\"320\" y1=\"200\" x2=\"320\" y2=\"100\" class=\"wire\"/>\n                        <rect x=\"310\" y=\"50\" width=\"20\" height=\"80\" fill=\"none\" stroke=\"#2d3748\" stroke-width=\"2\"/>\n                        <line x1=\"310\" y1=\"55\" x2=\"330\" y2=\"55\" stroke=\"#2d3748\" stroke-width=\"1\"/>\n                        <line x1=\"310\" y1=\"65\" x2=\"330\" y2=\"65\" stroke=\"#2d3748\" stroke-width=\"1\"/>\n                        <line x1=\"310\" y1=\"75\" x2=\"330\" y2=\"75\" stroke=\"#2d3748\" stroke-width=\"1\"/>\n                        <line x1=\"310\" y1=\"85\" x2=\"330\" y2=\"85\" stroke=\"#2d3748\" stroke-width=\"1\"/>\n                        <line x1=\"310\" y1=\"95\" x2=\"330\" y2=\"95\" stroke=\"#2d3748\" stroke-width=\"1\"/>\n                        <line x1=\"310\" y1=\"105\" x2=\"330\" y2=\"105\" stroke=\"#2d3748\" stroke-width=\"1\"/>\n                        <line x1=\"310\" y1=\"115\" x2=\"330\" y2=\"115\" stroke=\"#2d3748\" stroke-width=\"1\"/>\n                        <line x1=\"310\" y1=\"125\" x2=\"330\" y2=\"125\" stroke=\"#2d3748\" stroke-width=\"1\"/>\n                        <text x=\"350\" y=\"90\" text-anchor=\"start\" class=\"component-label\">Rf</text>\n                        <text x=\"350\" y=\"110\" text-anchor=\"start\" class=\"value-label\" id=\"rfCircuitLabel\">100kΩ</text>\n                        <line id=\"wire7\" x1=\"320\" y1=\"50\" x2=\"550\" y2=\"50\" class=\"wire\"/>\n                        <line id=\"wire8\" x1=\"550\" y1=\"50\" x2=\"550\" y2=\"200\" class=\"wire\"/>\n                    </g>\n                    \n                    <!-- Ground connection -->\n                    <line id=\"wire9\" x1=\"320\" y1=\"280\" x2=\"320\" y2=\"320\" class=\"wire\"/>\n                    <line x1=\"310\" y1=\"320\" x2=\"330\" y2=\"320\" stroke=\"#2d3748\" stroke-width=\"3\"/>\n                    <line x1=\"313\" y1=\"325\" x2=\"327\" y2=\"325\" stroke=\"#2d3748\" stroke-width=\"3\"/>\n                    <line x1=\"316\" y1=\"330\" x2=\"324\" y2=\"330\" stroke=\"#2d3748\" stroke-width=\"3\"/>\n                    <text x=\"320\" y=\"350\" text-anchor=\"middle\" class=\"component-label\">GND</text>\n                    \n                    <!-- Input ground -->\n                    <line id=\"wire10\" x1=\"80\" y1=\"235\" x2=\"80\" y2=\"280\" class=\"wire\"/>\n                    <line id=\"wire11\" x1=\"80\" y1=\"280\" x2=\"320\" y2=\"280\" class=\"wire\"/>\n                    \n                    <!-- Output indicator -->\n                    <g id=\"outputIndicator\">\n                        <circle cx=\"550\" cy=\"200\" r=\"5\" fill=\"#dc2626\"/>\n                        <line x1=\"550\" y1=\"200\" x2=\"600\" y2=\"200\" stroke=\"#dc2626\" stroke-width=\"3\"/>\n                        <text x=\"610\" y=\"195\" text-anchor=\"start\" class=\"output-label\">Vout</text>\n                        <text x=\"610\" y=\"215\" text-anchor=\"start\" class=\"output-value\" id=\"voutCircuitLabel\">0.0V</text>\n                    </g>\n                    \n                    <!-- Current flow indicators -->\n                    <g id=\"currentIndicators\">\n                        <text x=\"220\" y=\"185\" text-anchor=\"middle\" class=\"current-label\" id=\"iinLabel\">Iin=0mA</text>\n                        <text x=\"320\" y=\"75\" text-anchor=\"middle\" class=\"current-label\" id=\"ifLabel\">If=0mA</text>\n                    </g>\n                    \n                    <!-- Virtual ground annotation -->\n                    <text x=\"320\" y=\"170\" text-anchor=\"middle\" class=\"annotation\">V− ≈ 0V</text>\n                    <text x=\"320\" y=\"185\" text-anchor=\"middle\" class=\"annotation small\">(Virtual Ground)</text>\n                </svg>\n\n                <div class=\"info-panel\">\n                    <div class=\"info-item\">\n                        <span class=\"info-label\">Configuration:</span>\n                        <span class=\"info-value\">Inverting Amplifier</span>\n                    </div>\n                    <div class=\"info-item\">\n                        <span class=\"info-label\">Op-Amp Type:</span>\n                        <span class=\"info-value\">Ideal (A→∞, Rin→∞, Rout→0)</span>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Control Panel -->\n            <div class=\"control-panel\">\n                <h2>Input Parameters</h2>\n                \n                <div class=\"control-group\">\n                    <label>Input Voltage (Vin): <span id=\"vinValue\">0.0</span> V</label>\n                    <input type=\"range\" id=\"vinSlider\" min=\"-15\" max=\"15\" step=\"0.1\" value=\"0\">\n                    <div class=\"range-labels\">\n                        <span>-15V</span>\n                        <span>0V</span>\n                        <span>+15V</span>\n                    </div>\n                </div>\n                \n                <div class=\"control-group\">\n                    <label>Input Resistor (Rin): <span id=\"rinValue\">10</span> kΩ</label>\n                    <input type=\"range\" id=\"rinSlider\" min=\"0.1\" max=\"1000\" step=\"0.1\" value=\"10\">\n                    <div class=\"range-labels\">\n                        <span>100Ω</span>\n                        <span>500kΩ</span>\n                        <span>1MΩ</span>\n                    </div>\n                </div>\n                \n                <div class=\"control-group\">\n                    <label>Feedback Resistor (Rf): <span id=\"rfValue\">100</span> kΩ</label>\n                    <input type=\"range\" id=\"rfSlider\" min=\"0.1\" max=\"1000\" step=\"0.1\" value=\"100\">\n                    <div class=\"range-labels\">\n                        <span>100Ω</span>\n                        <span>500kΩ</span>\n                        <span>1MΩ</span>\n                    </div>\n                </div>\n\n                <div class=\"preset-section\">\n                    <h3>Quick Presets</h3>\n                    <div class=\"preset-buttons\">\n                        <button class=\"preset-btn\" data-preset=\"unity\">Unity Gain (×1)</button>\n                        <button class=\"preset-btn\" data-preset=\"x10\">10× Gain</button>\n                        <button class=\"preset-btn\" data-preset=\"x100\">100× Gain</button>\n                    </div>\n                </div>\n\n                <div class=\"action-buttons\">\n                    <button id=\"calculateBtn\" class=\"btn btn-primary\">Calculate</button>\n                    <button id=\"resetBtn\" class=\"btn btn-secondary\">Reset</button>\n                </div>\n            </div>\n        </div>\n\n        <!-- Results Section -->\n        <div class=\"results-section\">\n            <h2>Calculated Results</h2>\n            <div class=\"results-grid\">\n                <div class=\"result-card gain-card\">\n                    <div class=\"result-icon\">📐</div>\n                    <div class=\"result-label\">Voltage Gain (Av)</div>\n                    <div class=\"result-value large\" id=\"gainResult\">0.0</div>\n                    <div class=\"result-formula\">Av = -Rf / Rin</div>\n                    <div class=\"result-detail\" id=\"gainDetail\">|Av| = 0</div>\n                </div>\n                \n                <div class=\"result-card output-card\">\n                    <div class=\"result-icon\">⚡</div>\n                    <div class=\"result-label\">Output Voltage (Vout)</div>\n                    <div class=\"result-value large\" id=\"voutResult\">0.0 V</div>\n                    <div class=\"result-formula\">Vout = Av × Vin</div>\n                    <div class=\"result-detail\" id=\"phaseDetail\">Phase: Inverted 180°</div>\n                </div>\n                \n                <div class=\"result-card current-card\">\n                    <div class=\"result-icon\">🔄</div>\n                    <div class=\"result-label\">Input Current (Iin)</div>\n                    <div class=\"result-value\" id=\"iinResult\">0.0 mA</div>\n                    <div class=\"result-formula\">Iin = Vin / Rin</div>\n                </div>\n                \n                <div class=\"result-card feedback-card\">\n                    <div class=\"result-icon\">↩️</div>\n                    <div class=\"result-label\">Feedback Current (If)</div>\n                    <div class=\"result-value\" id=\"ifResult\">0.0 mA</div>\n                    <div class=\"result-formula\">If = Vout / Rf</div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Waveform Visualization -->\n        <div class=\"waveform-section\">\n            <h2>Input vs Output Waveforms</h2>\n            <canvas id=\"waveformCanvas\"></canvas>\n            <div class=\"waveform-legend\">\n                <div class=\"legend-item\">\n                    <div class=\"legend-color input-color\"></div>\n                    <span>Input Voltage (Vin)</span>\n                </div>\n                <div class=\"legend-item\">\n                    <div class=\"legend-color output-color\"></div>\n                    <span>Output Voltage (Vout)</span>\n                </div>\n            </div>\n        </div>\n\n        <!-- Theory Section -->\n        <div class=\"theory-section\">\n            <h2>Design Equations & Theory</h2>\n            <div class=\"theory-grid\">\n                <div class=\"theory-card\">\n                    <h3>Voltage Gain</h3>\n                    <div class=\"equation-box\">Av = -Rf / Rin</div>\n                    <p class=\"theory-text\">The negative sign indicates 180° phase inversion. The magnitude of gain is determined by the ratio of feedback to input resistance.</p>\n                </div>\n                \n                <div class=\"theory-card\">\n                    <h3>Output Voltage</h3>\n                    <div class=\"equation-box\">Vout = Av × Vin = -(Rf/Rin) × Vin</div>\n                    <p class=\"theory-text\">The output is the inverted and scaled version of the input voltage.</p>\n                </div>\n                \n                <div class=\"theory-card\">\n                    <h3>Virtual Ground Concept</h3>\n                    <div class=\"equation-box\">V− ≈ V+ = 0V</div>\n                    <p class=\"theory-text\">Due to the op-amp's infinite gain in ideal conditions, the inverting input is held at virtual ground (0V) when the non-inverting input is grounded.</p>\n                </div>\n                \n                <div class=\"theory-card\">\n                    <h3>Input Impedance</h3>\n                    <div class=\"equation-box\">Zin = Rin</div>\n                    <p class=\"theory-text\">The input impedance of the inverting amplifier is simply equal to the input resistor Rin, since the inverting input is at virtual ground.</p>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #4c1d95 100%);\n    min-height: 100vh;\n    padding: 20px;\n    color: #1f2937;\n}\n\n.container {\n    max-width: 1700px;\n    margin: 0 auto;\n    background: white;\n    border-radius: 20px;\n    box-shadow: 0 25px 80px rgba(0, 0, 0, 0.6);\n    overflow: hidden;\n}\n\nheader {\n    background: linear-gradient(135deg, #6366f1 0%, #4f46e5 50%, #4338ca 100%);\n    color: white;\n    padding: 50px;\n    text-align: center;\n    position: relative;\n    overflow: hidden;\n}\n\nheader::before {\n    content: '';\n    position: absolute;\n    width: 300px;\n    height: 300px;\n    background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 70%);\n    border-radius: 50%;\n    animation: float 6s ease-in-out infinite;\n    top: -100px;\n    left: -100px;\n}\n\nheader::after {\n    content: '';\n    position: absolute;\n    width: 200px;\n    height: 200px;\n    background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);\n    border-radius: 50%;\n    animation: float 8s ease-in-out infinite reverse;\n    bottom: -50px;\n    right: -50px;\n}\n\n@keyframes float {\n    0%, 100% { transform: translate(0, 0); }\n    50% { transform: translate(50px, 30px); }\n}\n\nheader h1 {\n    font-size: 3.2em;\n    margin-bottom: 15px;\n    text-shadow: 3px 3px 8px rgba(0, 0, 0, 0.3);\n    position: relative;\n    z-index: 1;\n}\n\n.subtitle {\n    font-size: 1.4em;\n    opacity: 0.95;\n    position: relative;\n    z-index: 1;\n}\n\n.main-content {\n    display: grid;\n    grid-template-columns: 1fr 450px;\n    gap: 30px;\n    padding: 35px;\n}\n\n@media (max-width: 1400px) {\n    .main-content {\n        grid-template-columns: 1fr;\n    }\n}\n\n/* Circuit Section */\n.circuit-section {\n    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\n    padding: 35px;\n    border-radius: 18px;\n    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12);\n}\n\n.circuit-section h2 {\n    font-size: 2.2em;\n    margin-bottom: 25px;\n    color: #4f46e5;\n    border-bottom: 4px solid #4f46e5;\n    padding-bottom: 12px;\n}\n\n#circuit {\n    width: 100%;\n    height: auto;\n    background: white;\n    border-radius: 15px;\n    padding: 25px;\n    box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.05);\n    margin-bottom: 25px;\n}\n\n.wire {\n    stroke: #94a3b8;\n    stroke-width: 3;\n    transition: all 0.4s ease;\n}\n\n.wire.active {\n    stroke: #10b981;\n    stroke-width: 4;\n    filter: drop-shadow(0 0 10px #10b981);\n    animation: pulse 1.5s ease-in-out infinite;\n}\n\n.output-wire.active {\n    stroke: #dc2626;\n    filter: drop-shadow(0 0 10px #dc2626);\n}\n\n@keyframes pulse {\n    0%, 100% { opacity: 1; }\n    50% { opacity: 0.6; }\n}\n\n.component-label {\n    font-size: 20px;\n    font-weight: bold;\n    fill: #1f2937;\n}\n\n.component-label.small {\n    font-size: 16px;\n}\n\n.value-label {\n    font-size: 15px;\n    fill: #6b7280;\n    font-weight: 600;\n}\n\n.opamp-label {\n    font-size: 28px;\n    font-weight: bold;\n    fill: #4f46e5;\n}\n\n.output-label {\n    font-size: 18px;\n    font-weight: bold;\n    fill: #dc2626;\n}\n\n.output-value {\n    font-size: 20px;\n    font-weight: bold;\n    fill: #dc2626;\n}\n\n.current-label {\n    font-size: 13px;\n    fill: #059669;\n    font-weight: 600;\n}\n\n.annotation {\n    font-size: 14px;\n    fill: #2563eb;\n    font-weight: 600;\n}\n\n.annotation.small {\n    font-size: 11px;\n    font-style: italic;\n}\n\n#virtualGround {\n    animation: groundPulse 2s ease-in-out infinite;\n}\n\n@keyframes groundPulse {\n    0%, 100% { opacity: 1; r: 5; }\n    50% { opacity: 0.6; r: 7; }\n}\n\n.info-panel {\n    background: white;\n    padding: 20px;\n    border-radius: 12px;\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);\n}\n\n.info-item {\n    display: flex;\n    justify-content: space-between;\n    padding: 12px 0;\n    border-bottom: 1px solid #e5e7eb;\n}\n\n.info-item:last-child {\n    border-bottom: none;\n}\n\n.info-label {\n    font-weight: 600;\n    color: #6b7280;\n}\n\n.info-value {\n    color: #4f46e5;\n    font-weight: 600;\n}\n\n/* Control Panel */\n.control-panel {\n    background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);\n    padding: 35px;\n    border-radius: 18px;\n    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12);\n}\n\n.control-panel h2 {\n    font-size: 2.2em;\n    margin-bottom: 30px;\n    color: #1e40af;\n    border-bottom: 4px solid #1e40af;\n    padding-bottom: 12px;\n}\n\n.control-group {\n    margin-bottom: 30px;\n}\n\n.control-group label {\n    display: block;\n    font-weight: 700;\n    margin-bottom: 12px;\n    color: #374151;\n    font-size: 1.1em;\n}\n\n.control-group label span {\n    color: #4f46e5;\n    font-size: 1.2em;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    height: 12px;\n    border-radius: 6px;\n    background: linear-gradient(90deg, #cbd5e0 0%, #94a3b8 100%);\n    outline: none;\n    transition: all 0.3s ease;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb {\n    appearance: none;\n    width: 28px;\n    height: 28px;\n    border-radius: 50%;\n    background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);\n    cursor: pointer;\n    box-shadow: 0 4px 10px rgba(79, 70, 229, 0.4);\n    transition: all 0.2s ease;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb:hover {\n    transform: scale(1.3);\n    box-shadow: 0 6px 16px rgba(79, 70, 229, 0.6);\n}\n\ninput[type=\"range\"]::-moz-range-thumb {\n    width: 28px;\n    height: 28px;\n    border-radius: 50%;\n    background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);\n    cursor: pointer;\n    box-shadow: 0 4px 10px rgba(79, 70, 229, 0.4);\n    border: none;\n}\n\n.range-labels {\n    display: flex;\n    justify-content: space-between;\n    margin-top: 8px;\n    font-size: 0.85em;\n    color: #6b7280;\n}\n\n.preset-section {\n    margin: 30px 0;\n    padding: 20px;\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);\n}\n\n.preset-section h3 {\n    font-size: 1.3em;\n    color: #374151;\n    margin-bottom: 15px;\n}\n\n.preset-buttons {\n    display: grid;\n    gap: 10px;\n}\n\n.preset-btn {\n    padding: 12px 20px;\n    border: 2px solid #4f46e5;\n    background: white;\n    color: #4f46e5;\n    border-radius: 8px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n\n.preset-btn:hover {\n    background: #4f46e5;\n    color: white;\n    transform: translateX(5px);\n}\n\n.action-buttons {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 15px;\n    margin-top: 30px;\n}\n\n.btn {\n    padding: 18px 30px;\n    border: none;\n    border-radius: 12px;\n    font-size: 1.2em;\n    font-weight: 700;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);\n    text-transform: uppercase;\n    letter-spacing: 1px;\n}\n\n.btn-primary {\n    background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n    color: white;\n}\n\n.btn-primary:hover {\n    transform: translateY(-4px);\n    box-shadow: 0 10px 20px rgba(16, 185, 129, 0.4);\n}\n\n.btn-secondary {\n    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);\n    color: white;\n}\n\n.btn-secondary:hover {\n    transform: translateY(-4px);\n    box-shadow: 0 10px 20px rgba(245, 158, 11, 0.4);\n}\n\n.btn:active {\n    transform: translateY(0);\n}\n\n/* Results Section */\n.results-section {\n    padding: 35px;\n    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);\n}\n\n.results-section h2 {\n    font-size: 2.2em;\n    margin-bottom: 30px;\n    color: #d97706;\n    border-bottom: 4px solid #d97706;\n    padding-bottom: 12px;\n}\n\n.results-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n    gap: 25px;\n}\n\n.result-card {\n    background: white;\n    padding: 30px;\n    border-radius: 18px;\n    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12);\n    transition: all 0.4s ease;\n    border-top: 6px solid;\n}\n\n.result-card:hover {\n    transform: translateY(-10px);\n    box-shadow: 0 16px 32px rgba(0, 0, 0, 0.2);\n}\n\n.gain-card {\n    border-color: #4f46e5;\n}\n\n.output-card {\n    border-color: #dc2626;\n}\n\n.current-card {\n    border-color: #10b981;\n}\n\n.feedback-card {\n    border-color: #f59e0b;\n}\n\n.result-icon {\n    font-size: 3em;\n    margin-bottom: 15px;\n}\n\n.result-label {\n    font-size: 1.15em;\n    color: #6b7280;\n    margin-bottom: 15px;\n    font-weight: 600;\n}\n\n.result-value {\n    font-size: 1.8em;\n    font-weight: bold;\n    color: #1f2937;\n    margin-bottom: 12px;\n}\n\n.result-value.large {\n    font-size: 2.5em;\n}\n\n.result-formula {\n    font-family: 'Courier New', monospace;\n    font-size: 1em;\n    color: #4b5563;\n    background: #f3f4f6;\n    padding: 10px;\n    border-radius: 8px;\n    margin-bottom: 10px;\n}\n\n.result-detail {\n    font-size: 0.95em;\n    color: #6b7280;\n    font-style: italic;\n}\n\n/* Waveform Section */\n.waveform-section {\n    padding: 35px;\n    background: white;\n}\n\n.waveform-section h2 {\n    font-size: 2.2em;\n    margin-bottom: 25px;\n    color: #7c3aed;\n    border-bottom: 4px solid #7c3aed;\n    padding-bottom: 12px;\n}\n\n#waveformCanvas {\n    width: 100%;\n    height: 350px;\n    border: 3px solid #e5e7eb;\n    border-radius: 15px;\n    background: #f9fafb;\n    box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.05);\n}\n\n.waveform-legend {\n    display: flex;\n    justify-content: center;\n    gap: 40px;\n    margin-top: 20px;\n}\n\n.legend-item {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    font-weight: 600;\n}\n\n.legend-color {\n    width: 40px;\n    height: 20px;\n    border-radius: 4px;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n}\n\n.input-color {\n    background: linear-gradient(90deg, #10b981 0%, #059669 100%);\n}\n\n.output-color {\n    background: linear-gradient(90deg, #dc2626 0%, #b91c1c 100%);\n}\n\n/* Theory Section */\n.theory-section {\n    padding: 35px;\n    background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%);\n}\n\n.theory-section h2 {\n    font-size: 2.2em;\n    margin-bottom: 30px;\n    color: #7c3aed;\n    border-bottom: 4px solid #7c3aed;\n    padding-bottom: 12px;\n}\n\n.theory-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));\n    gap: 25px;\n}\n\n.theory-card {\n    background: white;\n    padding: 28px;\n    border-radius: 15px;\n    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);\n    transition: all 0.3s ease;\n}\n\n.theory-card:hover {\n    transform: translateY(-8px);\n    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.18);\n}\n\n.theory-card h3 {\n    color: #7c3aed;\n    margin-bottom: 18px;\n    font-size: 1.5em;\n}\n\n.equation-box {\n    font-family: 'Courier New', monospace;\n    font-size: 1.3em;\n    background: #f9fafb;\n    padding: 18px;\n    border-radius: 10px;\n    border-left: 6px solid #7c3aed;\n    color: #1f2937;\n    margin-bottom: 15px;\n    font-weight: 600;\n}\n\n.theory-text {\n    color: #4b5563;\n    line-height: 1.7;\n    font-size: 1.05em;\n}\n\n/* Animations */\n@keyframes fadeIn {\n    from { opacity: 0; transform: translateY(30px); }\n    to { opacity: 1; transform: translateY(0); }\n}\n\n.result-card, .theory-card {\n    animation: fadeIn 0.6s ease;\n}", "js": "// Op-Amp Inverting Amplifier Simulator\nclass OpAmpInverting {\n    constructor() {\n        // Circuit parameters\n        this.Vin = 0;           // Input voltage (V)\n        this.Rin = 10000;       // Input resistor (Ω) - 10kΩ\n        this.Rf = 100000;       // Feedback resistor (Ω) - 100kΩ\n        \n        // Calculated outputs\n        this.Av = 0;            // Voltage gain\n        this.Vout = 0;          // Output voltage\n        this.Iin = 0;           // Input current\n        this.If = 0;            // Feedback current\n        \n        // Animation state\n        this.animationRunning = false;\n        this.animationPhase = 0;\n        \n        this.initializeElements();\n        this.attachEventListeners();\n        this.calculate();\n        this.updateDisplay();\n        this.setupCanvas();\n        this.drawWaveform();\n    }\n    \n    initializeElements() {\n        // Sliders\n        this.vinSlider = document.getElementById('vinSlider');\n        this.rinSlider = document.getElementById('rinSlider');\n        this.rfSlider = document.getElementById('rfSlider');\n        \n        // Value displays\n        this.vinValue = document.getElementById('vinValue');\n        this.rinValue = document.getElementById('rinValue');\n        this.rfValue = document.getElementById('rfValue');\n        \n        // Circuit labels\n        this.vinCircuitLabel = document.getElementById('vinCircuitLabel');\n        this.rinCircuitLabel = document.getElementById('rinCircuitLabel');\n        this.rfCircuitLabel = document.getElementById('rfCircuitLabel');\n        this.voutCircuitLabel = document.getElementById('voutCircuitLabel');\n        this.iinLabel = document.getElementById('iinLabel');\n        this.ifLabel = document.getElementById('ifLabel');\n        \n        // Result displays\n        this.gainResult = document.getElementById('gainResult');\n        this.gainDetail = document.getElementById('gainDetail');\n        this.voutResult = document.getElementById('voutResult');\n        this.phaseDetail = document.getElementById('phaseDetail');\n        this.iinResult = document.getElementById('iinResult');\n        this.ifResult = document.getElementById('ifResult');\n        \n        // Buttons\n        this.calculateBtn = document.getElementById('calculateBtn');\n        this.resetBtn = document.getElementById('resetBtn');\n        this.presetBtns = document.querySelectorAll('.preset-btn');\n        \n        // SVG wires\n        this.wires = Array.from({ length: 11 }, (_, i) => \n            document.getElementById(`wire${i + 1}`)\n        );\n        \n        // Canvas\n        this.canvas = document.getElementById('waveformCanvas');\n        this.ctx = this.canvas.getContext('2d');\n    }\n    \n    attachEventListeners() {\n        this.vinSlider.addEventListener('input', () => this.updateVin());\n        this.rinSlider.addEventListener('input', () => this.updateRin());\n        this.rfSlider.addEventListener('input', () => this.updateRf());\n        \n        this.calculateBtn.addEventListener('click', () => this.toggleAnimation());\n        this.resetBtn.addEventListener('click', () => this.reset());\n        \n        this.presetBtns.forEach(btn => {\n            btn.addEventListener('click', (e) => this.applyPreset(e.target.dataset.preset));\n        });\n        \n        window.addEventListener('resize', () => {\n            this.setupCanvas();\n            this.drawWaveform();\n        });\n    }\n    \n    updateVin() {\n        this.Vin = parseFloat(this.vinSlider.value);\n        this.vinValue.textContent = this.Vin.toFixed(1);\n        this.vinCircuitLabel.textContent = `${this.Vin.toFixed(1)}V`;\n        this.calculate();\n        this.updateDisplay();\n        this.drawWaveform();\n    }\n    \n    updateRin() {\n        this.Rin = parseFloat(this.rinSlider.value) * 1000; // Convert kΩ to Ω\n        this.rinValue.textContent = (this.Rin / 1000).toFixed(1);\n        this.rinCircuitLabel.textContent = this.formatResistance(this.Rin);\n        this.calculate();\n        this.updateDisplay();\n        this.drawWaveform();\n    }\n    \n    updateRf() {\n        this.Rf = parseFloat(this.rfSlider.value) * 1000; // Convert kΩ to Ω\n        this.rfValue.textContent = (this.Rf / 1000).toFixed(1);\n        this.rfCircuitLabel.textContent = this.formatResistance(this.Rf);\n        this.calculate();\n        this.updateDisplay();\n        this.drawWaveform();\n    }\n    \n    formatResistance(resistance) {\n        if (resistance >= 1000000) {\n            return `${(resistance / 1000000).toFixed(1)}MΩ`;\n        } else if (resistance >= 1000) {\n            return `${(resistance / 1000).toFixed(1)}kΩ`;\n        } else {\n            return `${resistance.toFixed(0)}Ω`;\n        }\n    }\n    \n    calculate() {\n        // Voltage gain: Av = -Rf / Rin\n        this.Av = -this.Rf / this.Rin;\n        \n        // Output voltage: Vout = Av * Vin\n        this.Vout = this.Av * this.Vin;\n        \n        // Input current: Iin = Vin / Rin (virtual ground at inverting input)\n        this.Iin = this.Vin / this.Rin;\n        \n        // Feedback current: If = Vout / Rf (equals Iin in ideal case)\n        this.If = this.Vout / this.Rf;\n    }\n    \n    updateDisplay() {\n        // Gain display\n        this.gainResult.textContent = this.Av.toFixed(2);\n        this.gainDetail.textContent = `|Av| = ${Math.abs(this.Av).toFixed(2)}`;\n        \n        // Output voltage display\n        this.voutResult.textContent = `${this.Vout.toFixed(2)} V`;\n        this.voutCircuitLabel.textContent = `${this.Vout.toFixed(1)}V`;\n        \n        // Phase detail\n        if (this.Vin !== 0) {\n            if ((this.Vin > 0 && this.Vout < 0) || (this.Vin < 0 && this.Vout > 0)) {\n                this.phaseDetail.textContent = 'Phase: Inverted 180°';\n            } else {\n                this.phaseDetail.textContent = 'Phase: No inversion';\n            }\n        } else {\n            this.phaseDetail.textContent = 'Phase: N/A (Vin = 0)';\n        }\n        \n        // Current displays\n        this.iinResult.textContent = `${(this.Iin * 1000).toFixed(3)} mA`;\n        this.ifResult.textContent = `${(this.If * 1000).toFixed(3)} mA`;\n        \n        // Circuit current labels\n        this.iinLabel.textContent = `Iin=${(this.Iin * 1000).toFixed(2)}mA`;\n        this.ifLabel.textContent = `If=${(Math.abs(this.If) * 1000).toFixed(2)}mA`;\n        \n        // Animate result cards\n        this.animateResultCards();\n    }\n    \n    animateResultCards() {\n        const cards = document.querySelectorAll('.result-card');\n        cards.forEach((card, i) => {\n            setTimeout(() => {\n                card.style.animation = 'none';\n                setTimeout(() => {\n                    card.style.animation = 'fadeIn 0.6s ease';\n                }, 10);\n            }, i * 100);\n        });\n    }\n    \n    applyPreset(preset) {\n        switch(preset) {\n            case 'unity':\n                this.Rin = 10000;\n                this.Rf = 10000;\n                this.rinSlider.value = 10;\n                this.rfSlider.value = 10;\n                break;\n            case 'x10':\n                this.Rin = 10000;\n                this.Rf = 100000;\n                this.rinSlider.value = 10;\n                this.rfSlider.value = 100;\n                break;\n            case 'x100':\n                this.Rin = 1000;\n                this.Rf = 100000;\n                this.rinSlider.value = 1;\n                this.rfSlider.value = 100;\n                break;\n        }\n        \n        this.rinValue.textContent = (this.Rin / 1000).toFixed(1);\n        this.rfValue.textContent = (this.Rf / 1000).toFixed(1);\n        this.rinCircuitLabel.textContent = this.formatResistance(this.Rin);\n        this.rfCircuitLabel.textContent = this.formatResistance(this.Rf);\n        \n        this.calculate();\n        this.updateDisplay();\n        this.drawWaveform();\n        \n        // Visual feedback\n        document.querySelectorAll('.preset-btn').forEach(btn => {\n            btn.style.transform = '';\n        });\n        event.target.style.transform = 'scale(0.95)';\n        setTimeout(() => {\n            event.target.style.transform = '';\n        }, 200);\n    }\n    \n    toggleAnimation() {\n        if (this.animationRunning) {\n            this.stopAnimation();\n        } else {\n            this.startAnimation();\n        }\n    }\n    \n    startAnimation() {\n        this.animationRunning = true;\n        this.calculateBtn.textContent = 'Stop Animation';\n        this.calculateBtn.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';\n        this.animate();\n    }\n    \n    stopAnimation() {\n        this.animationRunning = false;\n        this.calculateBtn.textContent = 'Calculate';\n        this.calculateBtn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';\n        this.wires.forEach(wire => wire.classList.remove('active'));\n    }\n    \n    animate() {\n        if (!this.animationRunning) return;\n        \n        this.animationPhase += 0.02;\n        \n        // Animate current flow based on Vin polarity\n        if (Math.abs(this.Vin) > 0.1) {\n            // Input path: wire1 -> wire2\n            this.wires[0].classList.add('active');\n            this.wires[1].classList.add('active');\n            \n            // Virtual ground connections: wire3, wire4\n            this.wires[2].classList.add('active');\n            this.wires[3].classList.add('active');\n            \n            // Feedback path: wire6 -> wire7 -> wire8\n            this.wires[5].classList.add('active');\n            this.wires[6].classList.add('active');\n            this.wires[7].classList.add('active');\n            \n            // Output path: wire5\n            this.wires[4].classList.add('active');\n            \n            // Ground return: wire9, wire10, wire11\n            this.wires[8].classList.add('active');\n            this.wires[9].classList.add('active');\n            this.wires[10].classList.add('active');\n        } else {\n            this.wires.forEach(wire => wire.classList.remove('active'));\n        }\n        \n        requestAnimationFrame(() => this.animate());\n    }\n    \n    reset() {\n        this.stopAnimation();\n        \n        // Reset to default values\n        this.Vin = 0;\n        this.Rin = 10000;\n        this.Rf = 100000;\n        \n        // Update sliders\n        this.vinSlider.value = 0;\n        this.rinSlider.value = 10;\n        this.rfSlider.value = 100;\n        \n        // Update displays\n        this.vinValue.textContent = '0.0';\n        this.rinValue.textContent = '10';\n        this.rfValue.textContent = '100';\n        \n        this.vinCircuitLabel.textContent = '0V';\n        this.rinCircuitLabel.textContent = '10kΩ';\n        this.rfCircuitLabel.textContent = '100kΩ';\n        \n        this.calculate();\n        this.updateDisplay();\n        this.drawWaveform();\n    }\n    \n    setupCanvas() {\n        const rect = this.canvas.getBoundingClientRect();\n        this.canvas.width = rect.width * window.devicePixelRatio;\n        this.canvas.height = rect.height * window.devicePixelRatio;\n        this.ctx.scale(window.devicePixelRatio, window.devicePixelRatio);\n    }\n    \n    drawWaveform() {\n        const w = this.canvas.width / window.devicePixelRatio;\n        const h = this.canvas.height / window.devicePixelRatio;\n        \n        this.ctx.clearRect(0, 0, w, h);\n        \n        const padding = 60;\n        const graphW = w - 2 * padding;\n        const graphH = h - 2 * padding;\n        \n        // Draw grid\n        this.ctx.strokeStyle = '#e5e7eb';\n        this.ctx.lineWidth = 1;\n        \n        for (let i = 0; i <= 10; i++) {\n            const x = padding + (graphW / 10) * i;\n            const y = padding + (graphH / 10) * i;\n            \n            this.ctx.beginPath();\n            this.ctx.moveTo(x, padding);\n            this.ctx.lineTo(x, padding + graphH);\n            this.ctx.stroke();\n            \n            this.ctx.beginPath();\n            this.ctx.moveTo(padding, y);\n            this.ctx.lineTo(padding + graphW, y);\n            this.ctx.stroke();\n        }\n        \n        // Draw axes\n        this.ctx.strokeStyle = '#1f2937';\n        this.ctx.lineWidth = 2;\n        \n        // Center line (0V)\n        const centerY = padding + graphH / 2;\n        this.ctx.setLineDash([5, 5]);\n        this.ctx.beginPath();\n        this.ctx.moveTo(padding, centerY);\n        this.ctx.lineTo(padding + graphW, centerY);\n        this.ctx.stroke();\n        this.ctx.setLineDash([]);\n        \n        // Axes\n        this.ctx.beginPath();\n        this.ctx.moveTo(padding, padding);\n        this.ctx.lineTo(padding, padding + graphH);\n        this.ctx.lineTo(padding + graphW, padding + graphH);\n        this.ctx.stroke();\n        \n        // Labels\n        this.ctx.fillStyle = '#1f2937';\n        this.ctx.font = 'bold 16px Arial';\n        this.ctx.fillText('Voltage (V)', padding - 50, padding - 15);\n        this.ctx.fillText('Time', padding + graphW - 30, padding + graphH + 40);\n        \n        // Draw voltage markers\n        const maxV = Math.max(Math.abs(this.Vin), Math.abs(this.Vout), 5);\n        this.ctx.font = '12px Arial';\n        this.ctx.fillStyle = '#6b7280';\n        this.ctx.textAlign = 'right';\n        this.ctx.fillText(`+${maxV.toFixed(1)}V`, padding - 10, padding + 5);\n        this.ctx.fillText('0V', padding - 10, centerY + 5);\n        this.ctx.fillText(`-${maxV.toFixed(1)}V`, padding - 10, padding + graphH + 5);\n        this.ctx.textAlign = 'left';\n        \n        // Draw sinusoidal waveforms\n        const cycles = 2;\n        const points = 200;\n        \n        // Input waveform (sine wave)\n        this.ctx.strokeStyle = '#10b981';\n        this.ctx.lineWidth = 3;\n        this.ctx.beginPath();\n        \n        for (let i = 0; i <= points; i++) {\n            const t = (i / points) * cycles * 2 * Math.PI;\n            const x = padding + (i / points) * graphW;\n            const y = centerY - (Math.sin(t) * this.Vin / maxV) * (graphH / 2.5);\n            \n            if (i === 0) {\n                this.ctx.moveTo(x, y);\n            } else {\n                this.ctx.lineTo(x, y);\n            }\n        }\n        this.ctx.stroke();\n        \n        // Output waveform (inverted sine wave)\n        this.ctx.strokeStyle = '#dc2626';\n        this.ctx.lineWidth = 3;\n        this.ctx.beginPath();\n        \n        for (let i = 0; i <= points; i++) {\n            const t = (i / points) * cycles * 2 * Math.PI;\n            const x = padding + (i / points) * graphW;\n            const y = centerY - (Math.sin(t) * this.Vout / maxV) * (graphH / 2.5);\n            \n            if (i === 0) {\n                this.ctx.moveTo(x, y);\n            } else {\n                this.ctx.lineTo(x, y);\n            }\n        }\n        this.ctx.stroke();\n        \n        // Draw phase shift annotation if there's significant signal\n        if (Math.abs(this.Vin) > 0.5) {\n            this.ctx.fillStyle = '#4b5563';\n            this.ctx.font = 'italic 14px Arial';\n            this.ctx.fillText('180° Phase Shift', padding + graphW / 2 - 50, padding + 20);\n        }\n    }\n}\n\n// Initialize simulator\ndocument.addEventListener('DOMContentLoaded', () => {\n    new OpAmpInverting();\n});"}}
{"input": {"input_text": "Shockley diode equation: I = Is*(exp(V/(n*Vt)) - 1). Given Is, n, temperature T compute current for applied V.", "simulation_name": " Diode Shockley", "domain": "Electrical Engineering", "description": "Ideal diode exponential I-V", "assumptions": ["Low-level injection"], "entities": [], "constants": [{"name": "boltzmann", "symbol": "kB", "value": 1.380649e-23, "unit": "J/K"}, {"name": "electron_charge", "symbol": "q", "value": 1.602176634e-19, "unit": "C"}], "parameters": [{"name": "saturation_current", "symbol": "Is", "unit": "A", "range": [1e-15, 1e-06]}, {"name": "ideality_factor", "symbol": "n", "unit": "dimensionless", "range": [1, 2]}, {"name": "temperature", "symbol": "T", "unit": "K", "range": [250, 350]}, {"name": "applied_voltage", "symbol": "V", "unit": "V", "range": [-0.5, 1]}], "equations": [{"description": "Thermal voltage", "expression": "Vt = kB*T/q"}, {"description": "Diode current", "expression": "I = Is*(exp(V/(n*Vt)) - 1)"}], "initial_conditions": {}, "outputs": ["I"], "simulation_controls": ["Is", "n", "T", "V"], "constraints": ["T > 0", "n > 0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Shockley Diode Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"container\">\n    <header>\n        <h1>Shockley Diode Equation</h1>\n        <div class=\"equation-display\">\n            $$I = I_s \\left( e^{\\frac{V}{n V_t}} - 1 \\right), \\quad V_t = \\frac{k_B T}{q}$$\n        </div>\n    </header>\n\n    <div class=\"simulation-grid\">\n        <aside class=\"controls\">\n            <h2>Parameters</h2>\n\n            <div class=\"control-group\">\n                <label for=\"voltage\">Applied Voltage ($V$)</label>\n                <div class=\"input-row\">\n                    <input type=\"range\" id=\"voltage\" min=\"-0.5\" max=\"1.0\" step=\"0.01\" value=\"0.7\">\n                    <span class=\"value-display\" id=\"val-v\">0.70 V</span>\n                </div>\n            </div>\n\n            <div class=\"control-group\">\n                <label for=\"temp\">Temperature ($T$)</label>\n                <div class=\"input-row\">\n                    <input type=\"range\" id=\"temp\" min=\"250\" max=\"350\" step=\"1\" value=\"300\">\n                    <span class=\"value-display\" id=\"val-t\">300 K</span>\n                </div>\n            </div>\n\n            <div class=\"control-group\">\n                <label for=\"ideality\">Ideality Factor ($n$)</label>\n                <div class=\"input-row\">\n                    <input type=\"range\" id=\"ideality\" min=\"1.0\" max=\"2.0\" step=\"0.05\" value=\"1.5\">\n                    <span class=\"value-display\" id=\"val-n\">1.50</span>\n                </div>\n            </div>\n\n            <div class=\"control-group\">\n                <label for=\"is_log\">Saturation Current ($I_s$)</label>\n                <div class=\"input-row\">\n                    <input type=\"range\" id=\"is_log\" min=\"-15\" max=\"-6\" step=\"0.1\" value=\"-12\">\n                    <span class=\"value-display\" id=\"val-is\">1.0 pA</span>\n                </div>\n                <small class=\"hint\">Adjusts magnitude ($10^{-15}$ to $10^{-6}$)</small>\n            </div>\n\n            <div class=\"results-panel\">\n                <h3>Calculated Output</h3>\n                <div class=\"result-row\">\n                    <span>Thermal Voltage ($V_t$):</span>\n                    <span id=\"out-vt\">25.85 mV</span>\n                </div>\n                <div class=\"result-row highlight\">\n                    <span>Diode Current ($I$):</span>\n                    <span id=\"out-current\">0.00 mA</span>\n                </div>\n                <div class=\"bias-indicator\" id=\"bias-status\">Forward Bias</div>\n            </div>\n        </aside>\n\n        <main class=\"visuals\">\n            <div class=\"canvas-card\">\n                <h3>I-V Characteristic Curve</h3>\n                <canvas id=\"graphCanvas\"></canvas>\n            </div>\n\n            <div class=\"canvas-card\">\n                <h3>Circuit Animation</h3>\n                <canvas id=\"circuitCanvas\"></canvas>\n                <div class=\"legend\">\n                    <span class=\"dot-legend\"></span> Electron Flow (Conventionally opposite to I)\n                </div>\n            </div>\n        </main>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary-color: #3f51b5;\n    --accent-color: #ff4081;\n    --bg-color: #f5f7fa;\n    --panel-bg: #ffffff;\n    --text-color: #333;\n    --border-radius: 8px;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    margin: 0;\n    padding: 0;\n    display: flex;\n    justify-content: center;\n    min-height: 100vh;\n}\n\n.container {\n    width: 95%;\n    max-width: 1200px;\n    padding: 20px;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 25px;\n}\n\nh1 {\n    margin: 0;\n    color: var(--primary-color);\n}\n\n.equation-display {\n    font-size: 1.1em;\n    margin-top: 10px;\n    background: #e8eaf6;\n    display: inline-block;\n    padding: 10px 20px;\n    border-radius: 20px;\n}\n\n.simulation-grid {\n    display: grid;\n    grid-template-columns: 320px 1fr;\n    gap: 20px;\n}\n\n/* Sidebar Controls */\n.controls {\n    background: var(--panel-bg);\n    padding: 20px;\n    border-radius: var(--border-radius);\n    box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n    height: fit-content;\n}\n\n.controls h2 {\n    margin-top: 0;\n    font-size: 1.2rem;\n    border-bottom: 2px solid #eee;\n    padding-bottom: 10px;\n}\n\n.control-group {\n    margin-bottom: 20px;\n}\n\nlabel {\n    display: block;\n    font-weight: 600;\n    margin-bottom: 5px;\n    font-size: 0.9rem;\n}\n\n.input-row {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\ninput[type=\"range\"] {\n    flex: 1;\n    cursor: pointer;\n}\n\n.value-display {\n    width: 70px;\n    text-align: right;\n    font-family: monospace;\n    font-weight: bold;\n    color: var(--primary-color);\n}\n\n.hint {\n    font-size: 0.8rem;\n    color: #777;\n    display: block;\n    margin-top: 2px;\n}\n\n.results-panel {\n    background: #f0f2f5;\n    padding: 15px;\n    border-radius: 6px;\n    border: 1px solid #dcdcdc;\n    margin-top: 30px;\n}\n\n.results-panel h3 {\n    margin: 0 0 10px 0;\n    font-size: 1rem;\n}\n\n.result-row {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 8px;\n    font-size: 0.9rem;\n}\n\n.highlight {\n    font-weight: bold;\n    color: var(--primary-color);\n    font-size: 1.1rem;\n    border-top: 1px solid #ddd;\n    padding-top: 8px;\n    margin-top: 8px;\n}\n\n.bias-indicator {\n    text-align: center;\n    margin-top: 10px;\n    padding: 5px;\n    border-radius: 4px;\n    font-weight: bold;\n    font-size: 0.9rem;\n}\n\n/* Visuals */\n.visuals {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.canvas-card {\n    background: var(--panel-bg);\n    padding: 15px;\n    border-radius: var(--border-radius);\n    box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n}\n\n.canvas-card h3 {\n    width: 100%;\n    margin: 0 0 10px 0;\n    font-size: 1rem;\n    color: #555;\n    text-align: left;\n}\n\ncanvas {\n    width: 100%;\n    border: 1px solid #eee;\n    border-radius: 4px;\n}\n\n#graphCanvas {\n    height: 300px;\n}\n\n#circuitCanvas {\n    height: 150px;\n}\n\n.legend {\n    margin-top: 5px;\n    font-size: 0.85rem;\n    color: #666;\n    display: flex;\n    align-items: center;\n    gap: 5px;\n}\n\n.dot-legend {\n    width: 8px;\n    height: 8px;\n    background: #FFD700;\n    border-radius: 50%;\n    display: inline-block;\n}\n\n@media (max-width: 800px) {\n    .simulation-grid {\n        grid-template-columns: 1fr;\n    }\n}", "js": "// --- Constants ---\nconst kB = 1.380649e-23; // Boltzmann constant (J/K)\nconst q = 1.602176634e-19; // Electron charge (C)\n\n// --- DOM Elements ---\nconst inputs = {\n    v: document.getElementById('voltage'),\n    t: document.getElementById('temp'),\n    n: document.getElementById('ideality'),\n    is_log: document.getElementById('is_log')\n};\n\nconst displays = {\n    v: document.getElementById('val-v'),\n    t: document.getElementById('val-t'),\n    n: document.getElementById('val-n'),\n    is: document.getElementById('val-is'),\n    vt: document.getElementById('out-vt'),\n    i: document.getElementById('out-current'),\n    bias: document.getElementById('bias-status')\n};\n\nconst graphCanvas = document.getElementById('graphCanvas');\nconst circuitCanvas = document.getElementById('circuitCanvas');\nconst ctxGraph = graphCanvas.getContext('2d');\nconst ctxCircuit = circuitCanvas.getContext('2d');\n\n// --- State ---\nlet state = {\n    V: 0.7,\n    T: 300,\n    n: 1.5,\n    Is: 1e-12, // 1 pA\n    \n    // Calculated\n    Vt: 0.0258,\n    I: 0\n};\n\n// Animation state\nlet electronOffset = 0;\n\n// --- Initialization ---\nfunction init() {\n    // Add event listeners\n    Object.values(inputs).forEach(input => {\n        input.addEventListener('input', updateState);\n    });\n\n    // Resize handling\n    window.addEventListener('resize', () => {\n        resizeCanvas(graphCanvas);\n        resizeCanvas(circuitCanvas);\n        drawGraph();\n    });\n\n    // Initial setup\n    resizeCanvas(graphCanvas);\n    resizeCanvas(circuitCanvas);\n    updateState();\n    animateCircuit();\n}\n\nfunction resizeCanvas(canvas) {\n    const parent = canvas.parentElement;\n    canvas.width = parent.clientWidth;\n    canvas.height = canvas.id === 'circuitCanvas' ? 150 : 300;\n}\n\n// --- Physics & Logic ---\nfunction updateState() {\n    // Read inputs\n    state.V = parseFloat(inputs.v.value);\n    state.T = parseFloat(inputs.t.value);\n    state.n = parseFloat(inputs.n.value);\n    \n    // Convert log scale slider back to linear value\n    const logIs = parseFloat(inputs.is_log.value);\n    state.Is = Math.pow(10, logIs);\n\n    // Calculate Thermal Voltage: Vt = kB * T / q\n    state.Vt = (kB * state.T) / q;\n\n    // Calculate Current: I = Is * ( exp(V / (n*Vt)) - 1 )\n    state.I = state.Is * (Math.exp(state.V / (state.n * state.Vt)) - 1);\n\n    updateUI();\n    drawGraph();\n}\n\nfunction updateUI() {\n    // Update Slider Labels\n    displays.v.textContent = `${state.V.toFixed(2)} V`;\n    displays.t.textContent = `${state.T.toFixed(0)} K`;\n    displays.n.textContent = state.n.toFixed(2);\n    displays.is.textContent = formatScientific(state.Is, 'A');\n\n    // Update Results\n    displays.vt.textContent = `${(state.Vt * 1000).toFixed(2)} mV`;\n    displays.i.textContent = formatScientific(state.I, 'A');\n\n    // Update Bias Status\n    if (state.V > 0) {\n        displays.bias.textContent = \"Forward Bias\";\n        displays.bias.style.background = \"#e8f5e9\"; // Light green\n        displays.bias.style.color = \"#2e7d32\";\n    } else if (state.V < 0) {\n        displays.bias.textContent = \"Reverse Bias\";\n        displays.bias.style.background = \"#ffebee\"; // Light red\n        displays.bias.style.color = \"#c62828\";\n    } else {\n        displays.bias.textContent = \"Zero Bias\";\n        displays.bias.style.background = \"#eee\";\n        displays.bias.style.color = \"#333\";\n    }\n}\n\nfunction formatScientific(val, unit) {\n    if (Math.abs(val) < 1e-15) return `0.00 ${unit}`; // Near zero\n    \n    // Engineering notation logic\n    const exp = Math.floor(Math.log10(Math.abs(val)));\n    \n    if (exp >= -3) return `${(val * 1e3).toFixed(2)} mA`;\n    if (exp >= -6) return `${(val * 1e6).toFixed(2)} µA`;\n    if (exp >= -9) return `${(val * 1e9).toFixed(2)} nA`;\n    if (exp >= -12) return `${(val * 1e12).toFixed(2)} pA`;\n    return `${(val * 1e15).toFixed(2)} fA`;\n}\n\n// --- Graph Visualization ---\nfunction drawGraph() {\n    const w = graphCanvas.width;\n    const h = graphCanvas.height;\n    const ctx = ctxGraph;\n\n    ctx.clearRect(0, 0, w, h);\n\n    // Define Axes limits\n    // X: -0.5V to 1.0V\n    const minV = -0.5;\n    const maxV = 1.0;\n    const rangeV = maxV - minV;\n    \n    // Y: Dynamic scale based on current settings. \n    // We compute I at maxV (1.0V) to determine vertical scale\n    // But clamp it if it's too huge, or too small\n    const maxI_theoretical = state.Is * (Math.exp(maxV / (state.n * state.Vt)) - 1);\n    \n    // We want the current operating point to be visible. \n    // If operating point I is small, zoom in. If large, zoom out.\n    // Let's set Y-max to be max(Current at 1.0V, some minimum visual range)\n    // Actually, exponential curves are hard to view. \n    // Strategy: Fix Y-axis to slightly above the current Operating Point if forward biased, \n    // or a standard range if reverse biased.\n    \n    let maxY = 0;\n    if (state.V > 0.1) {\n        // In conduction region, scale to see the current point + 20% headroom\n        // But if we slide V down, the graph shouldn't jump wildly.\n        // Let's calculate I at V=1.0 for the current parameters and use that as fixed scale for stability?\n        // No, current changes by orders of magnitude. \n        // Let's use log-like scaling or just clamp to current value * 2\n        maxY = Math.max(state.I * 1.5, 1e-6); \n    } else {\n        // Reverse/Low bias, show small scale (e.g. 1uA range)\n        maxY = 1e-6; \n    }\n    \n    // Coordinate Mapping\n    const mapX = (v) => ((v - minV) / rangeV) * (w - 60) + 40; // 40px padding left\n    const mapY = (i) => h - 30 - (i / maxY) * (h - 60); // 30px padding bottom\n\n    // Draw Axes\n    ctx.beginPath();\n    ctx.strokeStyle = \"#ccc\";\n    ctx.lineWidth = 1;\n    \n    // X Axis (at y=0 current)\n    const yZero = mapY(0);\n    ctx.moveTo(40, yZero);\n    ctx.lineTo(w, yZero);\n    \n    // Y Axis (at x=0 volts)\n    const xZero = mapX(0);\n    ctx.moveTo(xZero, 0);\n    ctx.lineTo(xZero, h - 30);\n    ctx.stroke();\n\n    // Axis Labels\n    ctx.fillStyle = \"#666\";\n    ctx.font = \"12px Arial\";\n    ctx.fillText(\"Voltage (V)\", w - 60, yZero - 5);\n    ctx.fillText(\"Current\", 5, 15);\n    \n    // Tick marks logic simplified\n    ctx.textAlign = \"center\";\n    for(let v = -0.4; v <= 1.0; v+=0.2) {\n        ctx.fillText(v.toFixed(1), mapX(v), yZero + 15);\n    }\n\n    // Draw Curve\n    ctx.beginPath();\n    ctx.strokeStyle = \"#3f51b5\";\n    ctx.lineWidth = 2;\n\n    let started = false;\n    for (let x = 0; x < w; x+=2) {\n        // Reverse map pixel to Voltage\n        const vPct = (x - 40) / (w - 60);\n        const vVal = minV + vPct * rangeV;\n        \n        if (vVal < minV || vVal > maxV) continue;\n\n        const iVal = state.Is * (Math.exp(vVal / (state.n * state.Vt)) - 1);\n        \n        const yPos = mapY(iVal);\n        \n        // Clamp drawing to canvas bounds\n        if (yPos < 0 || yPos > h) continue;\n\n        if (!started) {\n            ctx.moveTo(x, yPos);\n            started = true;\n        } else {\n            ctx.lineTo(x, yPos);\n        }\n    }\n    ctx.stroke();\n\n    // Draw Operating Point\n    const px = mapX(state.V);\n    const py = mapY(state.I);\n    \n    // Dot\n    ctx.beginPath();\n    ctx.fillStyle = \"#ff4081\";\n    ctx.arc(px, py, 5, 0, Math.PI * 2);\n    ctx.fill();\n\n    // Text Label\n    ctx.fillStyle = \"#333\";\n    ctx.textAlign = \"left\";\n    ctx.fillText(`(${state.V.toFixed(2)}V, ${formatScientific(state.I, 'A')})`, px + 10, py - 10);\n}\n\n// --- Circuit Animation ---\nfunction animateCircuit() {\n    const w = circuitCanvas.width;\n    const h = circuitCanvas.height;\n    const ctx = ctxCircuit;\n\n    ctx.clearRect(0, 0, w, h);\n\n    // Circuit Layout Coordinates\n    const yMid = h / 2;\n    const xLeft = 50;\n    const xRight = w - 50;\n    const diodeX = (xLeft + xRight) / 2;\n\n    // --- Draw Wires ---\n    ctx.strokeStyle = \"#444\";\n    ctx.lineWidth = 3;\n    ctx.beginPath();\n    ctx.moveTo(xLeft, yMid); // Left Source\n    ctx.lineTo(diodeX - 20, yMid); // To Diode\n    ctx.moveTo(diodeX + 20, yMid); // From Diode\n    ctx.lineTo(xRight, yMid); // To Load/Right\n    ctx.stroke();\n\n    // --- Draw Voltage Source (Battery style) ---\n    // Using a circle source symbol for simplicity or standard battery\n    // Let's do a circle V source on the left\n    ctx.beginPath();\n    ctx.arc(xLeft, yMid, 15, 0, Math.PI*2);\n    ctx.strokeStyle = \"#333\";\n    ctx.lineWidth = 2;\n    ctx.stroke();\n    ctx.fillStyle = \"#fff\";\n    ctx.fill();\n    \n    // Polarity based on V\n    ctx.fillStyle = \"#000\";\n    ctx.font = \"bold 14px Arial\";\n    ctx.textAlign = \"center\";\n    ctx.textBaseline = \"middle\";\n    if (state.V >= 0) {\n        ctx.fillText(\"+\", xLeft, yMid - 6);\n        ctx.fillText(\"-\", xLeft, yMid + 6);\n    } else {\n        ctx.fillText(\"-\", xLeft, yMid - 6);\n        ctx.fillText(\"+\", xLeft, yMid + 6);\n    }\n    ctx.fillText(\"V\", xLeft, yMid - 25);\n\n\n    // --- Draw Diode Symbol ---\n    ctx.beginPath();\n    ctx.fillStyle = \"#333\";\n    // Triangle pointing right\n    ctx.moveTo(diodeX - 10, yMid - 15);\n    ctx.lineTo(diodeX - 10, yMid + 15);\n    ctx.lineTo(diodeX + 10, yMid);\n    ctx.fill();\n    // Vertical Bar\n    ctx.beginPath();\n    ctx.lineWidth = 4;\n    ctx.moveTo(diodeX + 10, yMid - 15);\n    ctx.lineTo(diodeX + 10, yMid + 15);\n    ctx.stroke();\n\n\n    // --- Animate Electrons ---\n    // Real electron flow is opposite to Conventional Current.\n    // Current I > 0 flows Left -> Right. Electrons flow Right -> Left.\n    // Speed proportional to Current magnitude.\n    \n    // Calculate speed factor\n    // Logarithmic visual scaling because current changes exponentially\n    let speed = 0;\n    if (Math.abs(state.I) > 1e-12) {\n        const magnitude = Math.log10(Math.abs(state.I));\n        // Map magnitude -12 (pA) to -3 (mA) to speed 0.5 to 10\n        speed = (magnitude + 13) * 0.8;\n        if (speed < 0) speed = 0;\n    }\n\n    // Direction\n    // If V > 0, I > 0 (Left->Right). Electrons go Right->Left (Negative speed)\n    // If V < 0, I < 0 (Right->Left). Electrons go Left->Right (Positive speed)\n    \n    let direction = state.V >= 0 ? -1 : 1;\n    \n    // If Reverse bias leakage is tiny, visual movement should be barely standard\n    // Ideally, leakage is so small nothing moves.\n    if (state.V < 0) speed = 0.2; // Show very slow drift for leakage\n\n    electronOffset += speed * direction;\n\n    // Draw Electrons (Yellow dots)\n    const dotSpacing = 30;\n    const totalLength = xRight - xLeft;\n    \n    ctx.fillStyle = \"#FFD700\"; // Gold\n    \n    // We only draw dots on the wire segments\n    const wireSegments = [\n        {start: xLeft + 15, end: diodeX - 20},\n        {start: diodeX + 20, end: xRight}\n    ];\n\n    wireSegments.forEach(seg => {\n        // Clip to segment\n        ctx.save();\n        ctx.beginPath();\n        ctx.rect(seg.start, yMid - 10, seg.end - seg.start, 20);\n        ctx.clip();\n\n        for (let i = -50; i < w + 50; i += dotSpacing) {\n            let x = (i + electronOffset) % (w);\n            // Wrap logic for infinite scroll effect\n            if (x < 0) x += w;\n            \n            // Only draw if within this segment visually\n            // (The clip handles the cutting, we just draw the dots)\n            ctx.beginPath();\n            ctx.arc(x, yMid, 3, 0, Math.PI*2);\n            ctx.fill();\n        }\n        ctx.restore();\n    });\n\n    requestAnimationFrame(animateCircuit);\n}\n\n// Start\ninit();"}}
{"input": {"input_text": "MOSFET square-law model in saturation: Id = 0.5*kn*(Vgs - Vth)^2*(1 + lambda*Vds). Compute Id for given parameters.", "simulation_name": " MOSFET Saturation", "domain": "Electrical Engineering", "description": "Long-channel NMOS square-law", "assumptions": ["Saturation region", "Long channel"], "entities": [], "constants": [], "parameters": [{"name": "transconductance_param", "symbol": "kn", "unit": "A/V^2", "range": [1e-06, 0.01]}, {"name": "threshold_voltage", "symbol": "Vth", "unit": "V", "range": [0.2, 2]}, {"name": "channel_length_mod", "symbol": "lambda", "unit": "1/V", "range": [0, 0.1]}, {"name": "gate_source_voltage", "symbol": "Vgs", "unit": "V", "range": [0, 5]}, {"name": "drain_source_voltage", "symbol": "Vds", "unit": "V", "range": [0, 10]}], "equations": [{"description": "Drain current", "condition": "Vgs > Vth", "expression": "Id = 0.5*kn*(Vgs - Vth)^2*(1 + lambda*Vds)"}], "initial_conditions": {}, "outputs": ["Id"], "simulation_controls": ["kn", "Vth", "lambda", "Vgs", "Vds"], "constraints": ["Vgs >= Vth", "kn > 0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S18 MOSFET Saturation Simulator</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1>MOSFET Saturation Region Simulator</h1>\n            <p class=\"subtitle\">Long-Channel NMOS Square-Law Model</p>\n        </header>\n\n        <div class=\"main-content\">\n            <!-- Left Panel - Controls -->\n            <div class=\"control-panel\">\n                <h2>Parameters</h2>\n                \n                <div class=\"param-group\">\n                    <label for=\"kn\">\n                        Transconductance (k<sub>n</sub>)\n                        <span class=\"value-display\" id=\"kn-value\">1.00e-3 A/V²</span>\n                    </label>\n                    <input type=\"range\" id=\"kn\" min=\"-6\" max=\"-2\" step=\"0.1\" value=\"-3\">\n                    <div class=\"range-labels\">\n                        <span>1e-6</span>\n                        <span>1e-2</span>\n                    </div>\n                </div>\n\n                <div class=\"param-group\">\n                    <label for=\"vth\">\n                        Threshold Voltage (V<sub>th</sub>)\n                        <span class=\"value-display\" id=\"vth-value\">1.0 V</span>\n                    </label>\n                    <input type=\"range\" id=\"vth\" min=\"0.2\" max=\"2\" step=\"0.1\" value=\"1.0\">\n                    <div class=\"range-labels\">\n                        <span>0.2 V</span>\n                        <span>2.0 V</span>\n                    </div>\n                </div>\n\n                <div class=\"param-group\">\n                    <label for=\"lambda\">\n                        Channel Length Mod (λ)\n                        <span class=\"value-display\" id=\"lambda-value\">0.02 1/V</span>\n                    </label>\n                    <input type=\"range\" id=\"lambda\" min=\"0\" max=\"0.1\" step=\"0.005\" value=\"0.02\">\n                    <div class=\"range-labels\">\n                        <span>0</span>\n                        <span>0.1 1/V</span>\n                    </div>\n                </div>\n\n                <div class=\"param-group\">\n                    <label for=\"vgs\">\n                        Gate-Source Voltage (V<sub>gs</sub>)\n                        <span class=\"value-display\" id=\"vgs-value\">3.0 V</span>\n                    </label>\n                    <input type=\"range\" id=\"vgs\" min=\"0\" max=\"5\" step=\"0.1\" value=\"3.0\">\n                    <div class=\"range-labels\">\n                        <span>0 V</span>\n                        <span>5 V</span>\n                    </div>\n                </div>\n\n                <div class=\"param-group\">\n                    <label for=\"vds\">\n                        Drain-Source Voltage (V<sub>ds</sub>)\n                        <span class=\"value-display\" id=\"vds-value\">5.0 V</span>\n                    </label>\n                    <input type=\"range\" id=\"vds\" min=\"0\" max=\"10\" step=\"0.1\" value=\"5.0\">\n                    <div class=\"range-labels\">\n                        <span>0 V</span>\n                        <span>10 V</span>\n                    </div>\n                </div>\n\n                <div class=\"equation-box\">\n                    <h3>Equation</h3>\n                    <p class=\"equation\">I<sub>d</sub> = 0.5 × k<sub>n</sub> × (V<sub>gs</sub> - V<sub>th</sub>)² × (1 + λ × V<sub>ds</sub>)</p>\n                </div>\n            </div>\n\n            <!-- Right Panel - Visualization -->\n            <div class=\"visualization-panel\">\n                <div class=\"result-card\">\n                    <h2>Drain Current</h2>\n                    <div class=\"current-display\" id=\"id-display\">\n                        <span class=\"current-value\">2.00</span>\n                        <span class=\"current-unit\">mA</span>\n                    </div>\n                    <div class=\"status-indicator\" id=\"status\">\n                        <span class=\"status-dot\"></span>\n                        <span class=\"status-text\">Saturation Region</span>\n                    </div>\n                </div>\n\n                <div class=\"mosfet-visual\">\n                    <svg id=\"mosfet-svg\" viewBox=\"0 0 400 300\">\n                        <!-- MOSFET Structure -->\n                        <defs>\n                            <linearGradient id=\"channelGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\">\n                                <stop offset=\"0%\" style=\"stop-color:#4CAF50;stop-opacity:0\" />\n                                <stop offset=\"50%\" style=\"stop-color:#4CAF50;stop-opacity:0.8\" />\n                                <stop offset=\"100%\" style=\"stop-color:#4CAF50;stop-opacity:0\" />\n                            </linearGradient>\n                        </defs>\n                        \n                        <!-- Substrate -->\n                        <rect x=\"100\" y=\"180\" width=\"200\" height=\"80\" fill=\"#34495e\" opacity=\"0.3\"/>\n                        \n                        <!-- Source and Drain -->\n                        <rect x=\"110\" y=\"150\" width=\"30\" height=\"30\" fill=\"#2c3e50\" id=\"source\"/>\n                        <rect x=\"260\" y=\"150\" width=\"30\" height=\"30\" fill=\"#2c3e50\" id=\"drain\"/>\n                        \n                        <!-- Gate Oxide -->\n                        <rect x=\"100\" y=\"140\" width=\"200\" height=\"5\" fill=\"#95a5a6\"/>\n                        \n                        <!-- Gate -->\n                        <rect x=\"100\" y=\"110\" width=\"200\" height=\"25\" fill=\"#e74c3c\" id=\"gate\"/>\n                        \n                        <!-- Channel (animated) -->\n                        <rect x=\"140\" y=\"155\" width=\"120\" height=\"15\" fill=\"url(#channelGradient)\" id=\"channel\" opacity=\"0\"/>\n                        \n                        <!-- Electron flow particles -->\n                        <g id=\"particles\"></g>\n                        \n                        <!-- Labels -->\n                        <text x=\"125\" y=\"105\" fill=\"#fff\" font-size=\"12\" text-anchor=\"middle\">Gate</text>\n                        <text x=\"125\" y=\"170\" fill=\"#fff\" font-size=\"12\" text-anchor=\"middle\">S</text>\n                        <text x=\"275\" y=\"170\" fill=\"#fff\" font-size=\"12\" text-anchor=\"middle\">D</text>\n                        \n                        <!-- Voltage indicators -->\n                        <text x=\"50\" y=\"125\" fill=\"#e74c3c\" font-size=\"11\" id=\"vgs-label\">V_gs</text>\n                        <text x=\"320\" y=\"170\" fill=\"#3498db\" font-size=\"11\" id=\"vds-label\">V_ds</text>\n                    </svg>\n                </div>\n\n                <div class=\"chart-container\">\n                    <canvas id=\"chart\"></canvas>\n                </div>\n            </div>\n        </div>\n\n        <footer>\n            <p>Assumptions: Saturation Region | Long Channel | V<sub>gs</sub> ≥ V<sub>th</sub></p>\n        </footer>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);\n    min-height: 100vh;\n    padding: 20px;\n    color: #fff;\n}\n\n.container {\n    max-width: 1400px;\n    margin: 0 auto;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 30px;\n    animation: fadeInDown 0.6s ease-out;\n}\n\nheader h1 {\n    font-size: 2.5em;\n    margin-bottom: 10px;\n    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);\n}\n\n.subtitle {\n    font-size: 1.1em;\n    opacity: 0.9;\n    font-weight: 300;\n}\n\n.main-content {\n    display: grid;\n    grid-template-columns: 400px 1fr;\n    gap: 30px;\n    animation: fadeIn 0.8s ease-out;\n}\n\n/* Control Panel */\n.control-panel {\n    background: rgba(255, 255, 255, 0.1);\n    backdrop-filter: blur(10px);\n    border-radius: 20px;\n    padding: 30px;\n    box-shadow: 0 8px 32px rgba(0,0,0,0.2);\n    border: 1px solid rgba(255, 255, 255, 0.2);\n}\n\n.control-panel h2 {\n    margin-bottom: 25px;\n    font-size: 1.5em;\n    border-bottom: 2px solid rgba(255, 255, 255, 0.3);\n    padding-bottom: 10px;\n}\n\n.param-group {\n    margin-bottom: 25px;\n}\n\n.param-group label {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 8px;\n    font-size: 0.95em;\n}\n\n.value-display {\n    background: rgba(255, 255, 255, 0.2);\n    padding: 4px 12px;\n    border-radius: 12px;\n    font-family: 'Courier New', monospace;\n    font-size: 0.9em;\n    font-weight: bold;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    height: 8px;\n    border-radius: 5px;\n    background: rgba(255, 255, 255, 0.2);\n    outline: none;\n    transition: all 0.3s ease;\n    -webkit-appearance: none;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #4CAF50;\n    cursor: pointer;\n    box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n    transition: all 0.3s ease;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb:hover {\n    transform: scale(1.2);\n    box-shadow: 0 4px 12px rgba(76, 175, 80, 0.5);\n}\n\ninput[type=\"range\"]::-moz-range-thumb {\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #4CAF50;\n    cursor: pointer;\n    border: none;\n    box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n    transition: all 0.3s ease;\n}\n\n.range-labels {\n    display: flex;\n    justify-content: space-between;\n    margin-top: 5px;\n    font-size: 0.8em;\n    opacity: 0.7;\n}\n\n.equation-box {\n    background: rgba(0, 0, 0, 0.3);\n    border-radius: 15px;\n    padding: 20px;\n    margin-top: 30px;\n    border: 1px solid rgba(255, 255, 255, 0.2);\n}\n\n.equation-box h3 {\n    margin-bottom: 12px;\n    color: #4CAF50;\n}\n\n.equation {\n    font-family: 'Courier New', monospace;\n    font-size: 0.95em;\n    line-height: 1.6;\n    color: #fff;\n}\n\n/* Visualization Panel */\n.visualization-panel {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.result-card {\n    background: rgba(255, 255, 255, 0.1);\n    backdrop-filter: blur(10px);\n    border-radius: 20px;\n    padding: 30px;\n    text-align: center;\n    box-shadow: 0 8px 32px rgba(0,0,0,0.2);\n    border: 1px solid rgba(255, 255, 255, 0.2);\n    animation: pulse 2s ease-in-out infinite;\n}\n\n@keyframes pulse {\n    0%, 100% { transform: scale(1); }\n    50% { transform: scale(1.02); }\n}\n\n.result-card h2 {\n    margin-bottom: 15px;\n    font-size: 1.3em;\n    opacity: 0.9;\n}\n\n.current-display {\n    font-size: 3em;\n    font-weight: bold;\n    margin: 20px 0;\n    font-family: 'Courier New', monospace;\n    text-shadow: 0 0 20px rgba(76, 175, 80, 0.5);\n    transition: all 0.3s ease;\n}\n\n.current-value {\n    color: #4CAF50;\n}\n\n.current-unit {\n    font-size: 0.6em;\n    margin-left: 10px;\n    opacity: 0.8;\n}\n\n.status-indicator {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 10px;\n    margin-top: 15px;\n}\n\n.status-dot {\n    width: 12px;\n    height: 12px;\n    border-radius: 50%;\n    background: #4CAF50;\n    box-shadow: 0 0 10px #4CAF50;\n    animation: blink 1.5s ease-in-out infinite;\n}\n\n@keyframes blink {\n    0%, 100% { opacity: 1; }\n    50% { opacity: 0.3; }\n}\n\n.status-text {\n    font-size: 0.95em;\n    font-weight: 500;\n}\n\n.status-indicator.warning .status-dot {\n    background: #ff9800;\n    box-shadow: 0 0 10px #ff9800;\n}\n\n.status-indicator.warning .status-text {\n    color: #ff9800;\n}\n\n/* MOSFET Visual */\n.mosfet-visual {\n    background: rgba(0, 0, 0, 0.3);\n    border-radius: 20px;\n    padding: 20px;\n    border: 1px solid rgba(255, 255, 255, 0.2);\n}\n\n#mosfet-svg {\n    width: 100%;\n    height: auto;\n    filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));\n}\n\n.particle {\n    animation: flow 2s linear infinite;\n}\n\n@keyframes flow {\n    0% { transform: translateX(0); opacity: 0; }\n    10% { opacity: 1; }\n    90% { opacity: 1; }\n    100% { transform: translateX(120px); opacity: 0; }\n}\n\n/* Chart */\n.chart-container {\n    background: rgba(255, 255, 255, 0.1);\n    backdrop-filter: blur(10px);\n    border-radius: 20px;\n    padding: 20px;\n    border: 1px solid rgba(255, 255, 255, 0.2);\n    height: 300px;\n}\n\n#chart {\n    width: 100%;\n    height: 100%;\n}\n\n/* Footer */\nfooter {\n    text-align: center;\n    margin-top: 30px;\n    padding: 20px;\n    opacity: 0.7;\n    font-size: 0.9em;\n}\n\n/* Animations */\n@keyframes fadeIn {\n    from {\n        opacity: 0;\n        transform: translateY(20px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n@keyframes fadeInDown {\n    from {\n        opacity: 0;\n        transform: translateY(-20px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n/* Responsive */\n@media (max-width: 1024px) {\n    .main-content {\n        grid-template-columns: 1fr;\n    }\n    \n    header h1 {\n        font-size: 2em;\n    }\n    \n    .current-display {\n        font-size: 2.5em;\n    }\n}\n\n@media (max-width: 768px) {\n    body {\n        padding: 10px;\n    }\n    \n    .control-panel, .result-card, .mosfet-visual, .chart-container {\n        padding: 20px;\n    }\n    \n    header h1 {\n        font-size: 1.5em;\n    }\n}", "js": "// MOSFET Saturation Simulator\nclass MOSFETSimulator {\n    constructor() {\n        this.params = {\n            kn: 1e-3,\n            vth: 1.0,\n            lambda: 0.02,\n            vgs: 3.0,\n            vds: 5.0\n        };\n        \n        this.chart = null;\n        this.particles = [];\n        this.initializeControls();\n        this.initializeChart();\n        this.animate();\n        this.updateSimulation();\n    }\n    \n    initializeControls() {\n        // kn slider (logarithmic scale)\n        const knSlider = document.getElementById('kn');\n        knSlider.addEventListener('input', (e) => {\n            this.params.kn = Math.pow(10, parseFloat(e.target.value));\n            document.getElementById('kn-value').textContent = this.params.kn.toExponential(2) + ' A/V²';\n            this.updateSimulation();\n        });\n        \n        // Vth slider\n        const vthSlider = document.getElementById('vth');\n        vthSlider.addEventListener('input', (e) => {\n            this.params.vth = parseFloat(e.target.value);\n            document.getElementById('vth-value').textContent = this.params.vth.toFixed(1) + ' V';\n            this.updateSimulation();\n        });\n        \n        // Lambda slider\n        const lambdaSlider = document.getElementById('lambda');\n        lambdaSlider.addEventListener('input', (e) => {\n            this.params.lambda = parseFloat(e.target.value);\n            document.getElementById('lambda-value').textContent = this.params.lambda.toFixed(3) + ' 1/V';\n            this.updateSimulation();\n        });\n        \n        // Vgs slider\n        const vgsSlider = document.getElementById('vgs');\n        vgsSlider.addEventListener('input', (e) => {\n            this.params.vgs = parseFloat(e.target.value);\n            document.getElementById('vgs-value').textContent = this.params.vgs.toFixed(1) + ' V';\n            this.updateSimulation();\n        });\n        \n        // Vds slider\n        const vdsSlider = document.getElementById('vds');\n        vdsSlider.addEventListener('input', (e) => {\n            this.params.vds = parseFloat(e.target.value);\n            document.getElementById('vds-value').textContent = this.params.vds.toFixed(1) + ' V';\n            this.updateSimulation();\n        });\n    }\n    \n    calculateDrainCurrent() {\n        const { kn, vth, lambda, vgs, vds } = this.params;\n        \n        // Check if in saturation region\n        if (vgs < vth) {\n            return { id: 0, inSaturation: false };\n        }\n        \n        // Square-law model in saturation\n        const id = 0.5 * kn * Math.pow(vgs - vth, 2) * (1 + lambda * vds);\n        \n        return { id, inSaturation: true };\n    }\n    \n    updateSimulation() {\n        const result = this.calculateDrainCurrent();\n        const idMilliamps = result.id * 1000; // Convert to mA\n        \n        // Update current display\n        const currentValue = document.querySelector('.current-value');\n        const currentUnit = document.querySelector('.current-unit');\n        \n        if (idMilliamps >= 1) {\n            currentValue.textContent = idMilliamps.toFixed(2);\n            currentUnit.textContent = 'mA';\n        } else {\n            currentValue.textContent = (idMilliamps * 1000).toFixed(2);\n            currentUnit.textContent = 'µA';\n        }\n        \n        // Update status\n        const status = document.getElementById('status');\n        if (!result.inSaturation) {\n            status.classList.add('warning');\n            status.querySelector('.status-text').textContent = 'Cut-off (Vgs < Vth)';\n        } else {\n            status.classList.remove('warning');\n            status.querySelector('.status-text').textContent = 'Saturation Region';\n        }\n        \n        // Animate channel and particles\n        this.animateChannel(result.inSaturation, result.id);\n        \n        // Update chart\n        this.updateChart();\n    }\n    \n    animateChannel(inSaturation, current) {\n        const channel = document.getElementById('channel');\n        const gate = document.getElementById('gate');\n        \n        if (inSaturation) {\n            const opacity = Math.min(0.8, current * 400);\n            channel.style.opacity = opacity;\n            gate.style.fill = '#e74c3c';\n            \n            // Update particle flow rate based on current\n            this.particleFlowRate = Math.max(0.5, current * 500);\n        } else {\n            channel.style.opacity = '0';\n            gate.style.fill = '#95a5a6';\n            this.particleFlowRate = 0;\n        }\n    }\n    \n    createParticle() {\n        if (Math.random() > this.particleFlowRate / 100) return;\n        \n        const particle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n        particle.setAttribute('r', '3');\n        particle.setAttribute('cx', '140');\n        particle.setAttribute('cy', '162');\n        particle.setAttribute('fill', '#4CAF50');\n        particle.setAttribute('class', 'particle');\n        \n        const particlesGroup = document.getElementById('particles');\n        particlesGroup.appendChild(particle);\n        \n        // Remove particle after animation\n        setTimeout(() => {\n            if (particle.parentNode) {\n                particle.parentNode.removeChild(particle);\n            }\n        }, 2000);\n    }\n    \n    animate() {\n        this.createParticle();\n        requestAnimationFrame(() => this.animate());\n    }\n    \n    initializeChart() {\n        const canvas = document.getElementById('chart');\n        const ctx = canvas.getContext('2d');\n        \n        // Set canvas size\n        canvas.width = canvas.offsetWidth * window.devicePixelRatio;\n        canvas.height = canvas.offsetHeight * window.devicePixelRatio;\n        ctx.scale(window.devicePixelRatio, window.devicePixelRatio);\n        \n        this.chartCtx = ctx;\n        this.chartWidth = canvas.offsetWidth;\n        this.chartHeight = canvas.offsetHeight;\n    }\n    \n    updateChart() {\n        const ctx = this.chartCtx;\n        const width = this.chartWidth;\n        const height = this.chartHeight;\n        \n        // Clear canvas\n        ctx.clearRect(0, 0, width, height);\n        \n        // Chart margins\n        const margin = { top: 20, right: 20, bottom: 40, left: 60 };\n        const chartWidth = width - margin.left - margin.right;\n        const chartHeight = height - margin.top - margin.bottom;\n        \n        // Generate data points (Id vs Vds for current Vgs)\n        const dataPoints = [];\n        const vdsMax = 10;\n        const steps = 50;\n        \n        for (let i = 0; i <= steps; i++) {\n            const vds = (vdsMax / steps) * i;\n            const id = 0.5 * this.params.kn * Math.pow(Math.max(0, this.params.vgs - this.params.vth), 2) * (1 + this.params.lambda * vds);\n            dataPoints.push({ vds, id: id * 1000 }); // Convert to mA\n        }\n        \n        // Find max Id for scaling\n        const maxId = Math.max(...dataPoints.map(d => d.id), 1);\n        \n        // Draw axes\n        ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.moveTo(margin.left, margin.top);\n        ctx.lineTo(margin.left, height - margin.bottom);\n        ctx.lineTo(width - margin.right, height - margin.bottom);\n        ctx.stroke();\n        \n        // Draw grid\n        ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';\n        ctx.lineWidth = 1;\n        for (let i = 0; i <= 5; i++) {\n            const y = margin.top + (chartHeight / 5) * i;\n            ctx.beginPath();\n            ctx.moveTo(margin.left, y);\n            ctx.lineTo(width - margin.right, y);\n            ctx.stroke();\n        }\n        \n        // Draw curve\n        ctx.strokeStyle = '#4CAF50';\n        ctx.lineWidth = 3;\n        ctx.beginPath();\n        \n        dataPoints.forEach((point, i) => {\n            const x = margin.left + (point.vds / vdsMax) * chartWidth;\n            const y = height - margin.bottom - (point.id / maxId) * chartHeight;\n            \n            if (i === 0) {\n                ctx.moveTo(x, y);\n            } else {\n                ctx.lineTo(x, y);\n            }\n        });\n        ctx.stroke();\n        \n        // Draw current operating point\n        const currentX = margin.left + (this.params.vds / vdsMax) * chartWidth;\n        const currentId = 0.5 * this.params.kn * Math.pow(Math.max(0, this.params.vgs - this.params.vth), 2) * (1 + this.params.lambda * this.params.vds) * 1000;\n        const currentY = height - margin.bottom - (currentId / maxId) * chartHeight;\n        \n        ctx.fillStyle = '#ff5722';\n        ctx.beginPath();\n        ctx.arc(currentX, currentY, 6, 0, Math.PI * 2);\n        ctx.fill();\n        \n        // Add glow effect\n        ctx.shadowColor = '#ff5722';\n        ctx.shadowBlur = 15;\n        ctx.beginPath();\n        ctx.arc(currentX, currentY, 6, 0, Math.PI * 2);\n        ctx.fill();\n        ctx.shadowBlur = 0;\n        \n        // Labels\n        ctx.fillStyle = '#fff';\n        ctx.font = '12px Arial';\n        ctx.textAlign = 'center';\n        ctx.fillText('Vds (V)', width / 2, height - 5);\n        \n        ctx.save();\n        ctx.translate(15, height / 2);\n        ctx.rotate(-Math.PI / 2);\n        ctx.fillText('Id (mA)', 0, 0);\n        ctx.restore();\n        \n        // Axis values\n        ctx.font = '10px Arial';\n        ctx.fillText('0', margin.left, height - margin.bottom + 20);\n        ctx.fillText(vdsMax.toFixed(0), width - margin.right, height - margin.bottom + 20);\n        \n        ctx.textAlign = 'right';\n        ctx.fillText('0', margin.left - 10, height - margin.bottom);\n        ctx.fillText(maxId.toFixed(2), margin.left - 10, margin.top + 5);\n        \n        // Chart title\n        ctx.textAlign = 'center';\n        ctx.font = 'bold 14px Arial';\n        ctx.fillText(`Id vs Vds (Vgs = ${this.params.vgs.toFixed(1)}V)`, width / 2, 15);\n    }\n}\n\n// Initialize simulator when page loads\nwindow.addEventListener('DOMContentLoaded', () => {\n    new MOSFETSimulator();\n});"}}
{"input": {"input_text": "Transmission line delay: given length l, relative permittivity er, compute phase velocity and delay.", "simulation_name": " Transmission Line Delay", "domain": "Electrical Engineering", "description": "Lossless line delay estimate", "assumptions": ["Lossless line"], "entities": [], "constants": [{"name": "speed_of_light", "symbol": "c0", "value": 300000000.0, "unit": "m/s"}], "parameters": [{"name": "length", "symbol": "l", "unit": "m", "range": [0.01, 1000]}, {"name": "relative_permittivity", "symbol": "er", "unit": "dimensionless", "range": [1, 10]}], "equations": [{"description": "Phase velocity", "expression": "vp = c0/sqrt(er)"}, {"description": "One-way delay", "expression": "td = l/vp"}], "initial_conditions": {}, "outputs": ["vp", "td"], "simulation_controls": ["l", "er"], "constraints": ["er > 0", "l >= 0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Transmission Line Delay Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"dashboard\">\n    <header>\n        <h1>Transmission Line Delay</h1>\n        <p class=\"subtitle\">Calculate phase velocity and propagation delay ($t_d$)</p>\n    </header>\n\n    <div class=\"main-layout\">\n        <aside class=\"controls\">\n            <div class=\"control-section\">\n                <h2>Parameters</h2>\n                \n                <div class=\"input-group\">\n                    <label for=\"length\">Line Length ($l$)</label>\n                    <div class=\"range-container\">\n                        <input type=\"range\" id=\"length\" min=\"1\" max=\"1000\" step=\"1\" value=\"100\">\n                        <span id=\"val-length\" class=\"value-display\">100 m</span>\n                    </div>\n                </div>\n\n                <div class=\"input-group\">\n                    <label for=\"permittivity\">Relative Permittivity ($\\epsilon_r$)</label>\n                    <div class=\"range-container\">\n                        <input type=\"range\" id=\"permittivity\" min=\"1.0\" max=\"10.0\" step=\"0.1\" value=\"2.2\">\n                        <span id=\"val-perm\" class=\"value-display\">2.2</span>\n                    </div>\n                </div>\n\n                <button id=\"send-pulse-btn\">Send Pulse</button>\n            </div>\n\n            <div class=\"results-section\">\n                <h2>Calculated Results</h2>\n                \n                <div class=\"result-item\">\n                    <span class=\"label\">Phase Velocity ($v_p$):</span>\n                    <span id=\"res-vp\" class=\"value\">2.02e8 m/s</span>\n                    <small class=\"eq-hint\">$v_p = \\frac{c_0}{\\sqrt{\\epsilon_r}}$</small>\n                </div>\n\n                <div class=\"result-item\">\n                    <span class=\"label\">Time Delay ($t_d$):</span>\n                    <span id=\"res-td\" class=\"value highlight\">495 ns</span>\n                    <small class=\"eq-hint\">$t_d = \\frac{l}{v_p}$</small>\n                </div>\n            </div>\n        </aside>\n\n        <main class=\"visuals\">\n            <div class=\"canvas-container\">\n                <div class=\"canvas-header\">\n                    <span>Signal Propagation Animation</span>\n                    <span id=\"timer-display\">0.00 ns</span>\n                </div>\n                <canvas id=\"simCanvas\"></canvas>\n                <div class=\"axis-labels\">\n                    <span>Source (0 m)</span>\n                    <span>Load (<span id=\"len-label\">100</span> m)</span>\n                </div>\n            </div>\n            \n            <div class=\"info-card\">\n                <h3>Physics Insight</h3>\n                <p>\n                    \n\n[Image of coaxial cable cross section]\n\n                    The speed of a signal in a transmission line is determined by the medium surrounding the conductor. \n                    As the dielectric constant ($\\epsilon_r$) increases, the velocity decreases relative to the speed of light ($c_0$).\n                    <br><br>\n                    <strong>Current Speed:</strong> <span id=\"speed-ratio\">67</span>% of $c_0$.\n                </p>\n            </div>\n        </main>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary-color: #2980b9;\n    --accent-color: #e67e22;\n    --bg-color: #ecf0f1;\n    --panel-bg: #ffffff;\n    --text-color: #2c3e50;\n    --border-radius: 8px;\n}\n\n* {\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    margin: 0;\n    padding: 20px;\n    height: 100vh;\n    display: flex;\n    justify-content: center;\n}\n\n.dashboard {\n    background-color: var(--panel-bg);\n    width: 100%;\n    max-width: 1200px;\n    border-radius: var(--border-radius);\n    box-shadow: 0 4px 15px rgba(0,0,0,0.1);\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n    height: 90vh;\n}\n\nheader {\n    background-color: #34495e;\n    color: white;\n    padding: 20px;\n    text-align: center;\n}\n\nheader h1 {\n    margin: 0;\n    font-size: 1.8rem;\n}\n\n.subtitle {\n    margin: 5px 0 0;\n    opacity: 0.8;\n    font-size: 0.9rem;\n}\n\n.main-layout {\n    display: flex;\n    flex: 1;\n    overflow: hidden;\n}\n\n/* Controls Sidebar */\n.controls {\n    width: 350px;\n    background-color: #f8f9fa;\n    border-right: 1px solid #ddd;\n    padding: 20px;\n    display: flex;\n    flex-direction: column;\n    gap: 30px;\n}\n\n.control-section h2, .results-section h2 {\n    font-size: 1.2rem;\n    margin-top: 0;\n    border-bottom: 2px solid #3498db;\n    padding-bottom: 10px;\n    margin-bottom: 20px;\n}\n\n.input-group {\n    margin-bottom: 20px;\n}\n\nlabel {\n    display: block;\n    font-weight: 600;\n    margin-bottom: 8px;\n}\n\n.range-container {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\ninput[type=\"range\"] {\n    flex: 1;\n    cursor: pointer;\n}\n\n.value-display {\n    width: 80px;\n    text-align: right;\n    font-family: monospace;\n    font-weight: bold;\n    color: var(--primary-color);\n}\n\nbutton#send-pulse-btn {\n    width: 100%;\n    padding: 12px;\n    background-color: var(--accent-color);\n    color: white;\n    border: none;\n    border-radius: 4px;\n    font-size: 1rem;\n    font-weight: bold;\n    cursor: pointer;\n    transition: background 0.2s;\n}\n\nbutton#send-pulse-btn:hover {\n    background-color: #d35400;\n}\n\n/* Results Area */\n.result-item {\n    margin-bottom: 15px;\n    background: white;\n    padding: 10px;\n    border-radius: 4px;\n    border: 1px solid #eee;\n}\n\n.result-item .label {\n    display: block;\n    font-size: 0.9rem;\n    color: #7f8c8d;\n}\n\n.result-item .value {\n    display: block;\n    font-size: 1.4rem;\n    font-family: monospace;\n    font-weight: bold;\n    color: var(--text-color);\n}\n\n.result-item .value.highlight {\n    color: var(--accent-color);\n}\n\n.eq-hint {\n    display: block;\n    text-align: right;\n    color: #bdc3c7;\n    margin-top: 5px;\n}\n\n/* Visuals Area */\n.visuals {\n    flex: 1;\n    padding: 30px;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n    background-color: white;\n}\n\n.canvas-container {\n    flex: 2;\n    border: 1px solid #eee;\n    border-radius: var(--border-radius);\n    position: relative;\n    background: #fafafa;\n    display: flex;\n    flex-direction: column;\n}\n\n.canvas-header {\n    padding: 10px 20px;\n    background: #eee;\n    display: flex;\n    justify-content: space-between;\n    font-weight: bold;\n    color: #555;\n}\n\n#timer-display {\n    font-family: monospace;\n    color: var(--accent-color);\n}\n\ncanvas {\n    width: 100%;\n    flex: 1;\n    display: block;\n}\n\n.axis-labels {\n    display: flex;\n    justify-content: space-between;\n    padding: 10px 20px;\n    color: #777;\n    font-size: 0.9rem;\n}\n\n.info-card {\n    flex: 1;\n    background: #e8f6f3;\n    padding: 20px;\n    border-radius: var(--border-radius);\n    border: 1px solid #d1f2eb;\n}\n\n.info-card h3 {\n    margin-top: 0;\n    color: #16a085;\n}\n\n.info-card p {\n    line-height: 1.5;\n    color: #444;\n}\n\n@media (max-width: 900px) {\n    .dashboard {\n        height: auto;\n        overflow: auto;\n    }\n    .main-layout {\n        flex-direction: column;\n    }\n    .controls {\n        width: 100%;\n        border-right: none;\n        border-bottom: 1px solid #ddd;\n    }\n    .canvas-container {\n        min-height: 300px;\n    }\n}", "js": "// Constants\nconst C0 = 3e8; // Speed of light in m/s\n\n// DOM Elements\nconst inputLength = document.getElementById('length');\nconst inputPerm = document.getElementById('permittivity');\nconst btnSend = document.getElementById('send-pulse-btn');\n\nconst displayLength = document.getElementById('val-length');\nconst displayPerm = document.getElementById('val-perm');\nconst labelLenBottom = document.getElementById('len-label');\n\nconst resVp = document.getElementById('res-vp');\nconst resTd = document.getElementById('res-td');\nconst speedRatioDisplay = document.getElementById('speed-ratio');\nconst timerDisplay = document.getElementById('timer-display');\n\nconst canvas = document.getElementById('simCanvas');\nconst ctx = canvas.getContext('2d');\n\n// State\nlet state = {\n    l: 100,      // meters\n    er: 2.2,     // dimensionless\n    vp: 0,       // m/s\n    td: 0,       // seconds\n    \n    // Animation State\n    isAnimating: false,\n    pulsePos: 0,    // 0 to 1 (normalized position on line)\n    startTime: 0,   // simulation clock\n    animSpeed: 0.01 // increment per frame\n};\n\n// Initialization\nfunction init() {\n    resizeCanvas();\n    window.addEventListener('resize', resizeCanvas);\n    \n    inputLength.addEventListener('input', updateParams);\n    inputPerm.addEventListener('input', updateParams);\n    \n    btnSend.addEventListener('click', startPulse);\n    \n    updateParams();\n    drawScene();\n}\n\nfunction resizeCanvas() {\n    const parent = canvas.parentElement;\n    // Subtract header and footer heights roughly\n    canvas.width = parent.clientWidth;\n    canvas.height = parent.clientHeight - 80; \n    drawScene();\n}\n\nfunction updateParams() {\n    // Read Inputs\n    state.l = parseFloat(inputLength.value);\n    state.er = parseFloat(inputPerm.value);\n    \n    // Update Text Displays\n    displayLength.textContent = `${state.l} m`;\n    displayPerm.textContent = state.er.toFixed(1);\n    labelLenBottom.textContent = state.l;\n    \n    // Physics Calculations\n    // 1. Phase Velocity: vp = c0 / sqrt(er)\n    state.vp = C0 / Math.sqrt(state.er);\n    \n    // 2. Time Delay: td = l / vp\n    state.td = state.l / state.vp;\n    \n    // Update Results UI\n    resVp.textContent = formatScientific(state.vp) + \" m/s\";\n    resTd.textContent = formatTime(state.td);\n    \n    // Speed Ratio %\n    const ratio = (state.vp / C0) * 100;\n    speedRatioDisplay.textContent = ratio.toFixed(1);\n    \n    // If not animating, redraw to show updated static line\n    if (!state.isAnimating) {\n        drawScene();\n    }\n}\n\nfunction startPulse() {\n    state.isAnimating = true;\n    state.pulsePos = 0;\n    state.startTime = performance.now();\n    animate();\n}\n\nfunction animate(currentTime) {\n    if (!state.isAnimating) return;\n    \n    // Calculate progress\n    // We want the visual duration to be reasonable (e.g., 2 seconds) regardless of actual physics time\n    // But we want to reflect \"speed\" differences visually?\n    // Option A: Fixed visual duration, just show physics timer counting up correctly.\n    // Option B: Variable visual duration. High delay = slower pulse.\n    \n    // Let's go with Option A for UX (don't want to wait 10s for long cables), \n    // but we scale the timer display to match the physics.\n    \n    const visualDuration = 1500; // 1.5 seconds for full travel\n    const elapsed = currentTime - state.startTime;\n    \n    if (!state.startTime) state.startTime = currentTime; // Handle first frame\n    \n    // Progress 0 to 1\n    const progress = (currentTime - state.startTime) / visualDuration;\n    \n    state.pulsePos = progress;\n    \n    // Update Timer Display based on real physics time\n    const currentPhysicsTime = progress * state.td;\n    timerDisplay.textContent = formatTime(currentPhysicsTime);\n    \n    if (progress >= 1) {\n        state.pulsePos = 1;\n        state.isAnimating = false;\n        timerDisplay.textContent = formatTime(state.td); // Ensure final value is exact\n        drawScene();\n        return;\n    }\n    \n    drawScene();\n    requestAnimationFrame(animate);\n}\n\n// Drawing Logic\nfunction drawScene() {\n    const w = canvas.width;\n    const h = canvas.height;\n    const cy = h / 2;\n    const lineMargin = 50;\n    const lineStart = lineMargin;\n    const lineEnd = w - lineMargin;\n    const lineLengthPx = lineEnd - lineStart;\n    \n    ctx.clearRect(0, 0, w, h);\n    \n    // 1. Draw Transmission Line\n    // Outer Shield (Coax style)\n    ctx.fillStyle = \"#ddd\";\n    ctx.fillRect(lineStart, cy - 20, lineLengthPx, 40);\n    \n    // Dielectric Color (changes with Er)\n    // Er=1 (Air) -> White/Blueish. Er=10 -> Darker/Solid.\n    const opacity = (state.er - 1) / 9 * 0.5 + 0.1;\n    ctx.fillStyle = `rgba(52, 152, 219, ${opacity})`;\n    ctx.fillRect(lineStart, cy - 15, lineLengthPx, 30);\n    \n    // Center Conductor\n    ctx.fillStyle = \"#555\";\n    ctx.fillRect(lineStart, cy - 4, lineLengthPx, 8);\n    \n    // Terminals\n    drawTerminal(lineStart, cy, \"Source\");\n    drawTerminal(lineEnd, cy, \"Load\");\n    \n    // 2. Draw Pulse\n    // Gaussian-like shape or just a simple rect travelling\n    if (state.isAnimating || state.pulsePos > 0) {\n        const px = lineStart + state.pulsePos * lineLengthPx;\n        \n        ctx.save();\n        ctx.beginPath();\n        // Draw a pulse shape above the line representing voltage\n        const pulseWidth = 40;\n        const pulseHeight = 30;\n        \n        ctx.moveTo(px - pulseWidth/2, cy - 10);\n        ctx.quadraticCurveTo(px, cy - 10 - pulseHeight, px + pulseWidth/2, cy - 10);\n        ctx.lineTo(px + pulseWidth/2, cy + 10);\n        ctx.quadraticCurveTo(px, cy + 10 + pulseHeight, px - pulseWidth/2, cy + 10);\n        ctx.closePath();\n        \n        ctx.fillStyle = \"#e67e22\";\n        ctx.globalAlpha = 0.8;\n        ctx.fill();\n        ctx.restore();\n        \n        // Draw vertical marker\n        ctx.beginPath();\n        ctx.strokeStyle = \"#e67e22\";\n        ctx.setLineDash([5, 5]);\n        ctx.moveTo(px, cy - 40);\n        ctx.lineTo(px, cy + 40);\n        ctx.stroke();\n        ctx.setLineDash([]);\n    }\n}\n\nfunction drawTerminal(x, y, label) {\n    ctx.fillStyle = \"#34495e\";\n    ctx.fillRect(x - 5, y - 25, 10, 50);\n    \n    ctx.fillStyle = \"#333\";\n    ctx.font = \"bold 12px sans-serif\";\n    ctx.textAlign = \"center\";\n    // Text already handled by HTML labels, but drawing dots helps visual anchor\n}\n\n// Helpers\nfunction formatScientific(num) {\n    return num.toExponential(2);\n}\n\nfunction formatTime(seconds) {\n    // Determine unit\n    if (seconds < 1e-6) {\n        return (seconds * 1e9).toFixed(2) + \" ns\";\n    } else if (seconds < 1e-3) {\n        return (seconds * 1e6).toFixed(2) + \" μs\";\n    } else {\n        return (seconds * 1e3).toFixed(2) + \" ms\";\n    }\n}\n\n// Start\ninit();"}}
{"input": {"input_text": "Ideal gas in closed volume: P = n*R*T/V. Compute pressure for given n, T, V.", "simulation_name": " Ideal Gas State", "domain": "Chemistry", "description": "Ideal gas equation of state", "assumptions": ["Ideal gas"], "entities": [{"name": "gas", "amount": {"symbol": "n", "unit": "mol", "range": [0.01, 100]}}], "constants": [{"name": "gas_constant", "symbol": "R", "value": 8.314, "unit": "J/(mol*K)"}], "parameters": [{"name": "temperature", "symbol": "T", "unit": "K", "range": [200, 1200]}, {"name": "volume", "symbol": "V", "unit": "m^3", "range": [0.001, 10]}], "equations": [{"description": "Pressure", "expression": "P = n*R*T/V"}], "initial_conditions": {}, "outputs": ["P"], "simulation_controls": ["n", "T", "V"], "constraints": ["T > 0", "V > 0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Ideal Gas Law Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"lab-container\">\n    <header>\n        <h1>Ideal Gas Law: $P = \\frac{nRT}{V}$</h1>\n        <p class=\"subtitle\">Observe the relationship between Pressure, Volume, Temperature, and Moles.</p>\n    </header>\n\n    <div class=\"main-interface\">\n        <aside class=\"controls-panel\">\n            <h2>State Variables</h2>\n\n            <div class=\"control-group\">\n                <label for=\"moles\">Moles of Gas ($n$)</label>\n                <div class=\"input-wrapper\">\n                    <input type=\"range\" id=\"moles\" min=\"1\" max=\"100\" step=\"1\" value=\"10\">\n                    <span id=\"val-n\" class=\"value-display\">10.0 mol</span>\n                </div>\n            </div>\n\n            <div class=\"control-group\">\n                <label for=\"temp\">Temperature ($T$)</label>\n                <div class=\"input-wrapper\">\n                    <input type=\"range\" id=\"temp\" min=\"200\" max=\"1200\" step=\"10\" value=\"300\">\n                    <span id=\"val-t\" class=\"value-display\">300 K</span>\n                </div>\n            </div>\n\n            <div class=\"control-group\">\n                <label for=\"volume\">Volume ($V$)</label>\n                <div class=\"input-wrapper\">\n                    <input type=\"range\" id=\"volume\" min=\"0.1\" max=\"10.0\" step=\"0.1\" value=\"1.0\">\n                    <span id=\"val-v\" class=\"value-display\">1.00 m³</span>\n                </div>\n            </div>\n\n            <div class=\"readout-card\">\n                <h3>Calculated Pressure ($P$)</h3>\n                <div class=\"pressure-value\">\n                    <span id=\"res-p-pa\">0</span> <span class=\"unit\">Pa</span>\n                </div>\n                <div class=\"pressure-alt\">\n                    <span id=\"res-p-atm\">0.00</span> atm\n                </div>\n            </div>\n        </aside>\n\n        <main class=\"simulation-view\">\n            <div class=\"canvas-wrapper\">\n                <canvas id=\"gasCanvas\"></canvas>\n                <div class=\"overlay-label top-label\">Piston (Movable)</div>\n                <div class=\"overlay-label bottom-label\">Gas Chamber</div>\n            </div>\n            \n            <div class=\"info-box\">\n                <p><strong>Particle Behavior:</strong> Higher Temperature increases particle speed (kinetic energy). Smaller Volume increases collision frequency with walls, raising Pressure.</p>\n            </div>\n        </main>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary: #3f51b5;\n    --accent: #ff4081;\n    --bg-main: #f4f4f9;\n    --card-bg: #ffffff;\n    --text: #333;\n    --border: #ddd;\n}\n\n* {\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-main);\n    color: var(--text);\n    margin: 0;\n    padding: 20px;\n    height: 100vh;\n    display: flex;\n    justify-content: center;\n}\n\n.lab-container {\n    background: var(--card-bg);\n    width: 100%;\n    max-width: 1200px;\n    height: 90vh;\n    border-radius: 12px;\n    box-shadow: 0 5px 20px rgba(0,0,0,0.1);\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n}\n\nheader {\n    background: #2c3e50;\n    color: white;\n    padding: 20px 30px;\n    flex-shrink: 0;\n}\n\nheader h1 {\n    margin: 0;\n    font-size: 1.6rem;\n}\n\n.subtitle {\n    margin: 5px 0 0;\n    opacity: 0.8;\n    font-size: 0.9rem;\n}\n\n.main-interface {\n    display: flex;\n    flex: 1;\n    overflow: hidden;\n}\n\n/* Controls Sidebar */\n.controls-panel {\n    width: 350px;\n    background: #fcfcfc;\n    border-right: 1px solid var(--border);\n    padding: 30px;\n    display: flex;\n    flex-direction: column;\n    gap: 25px;\n    overflow-y: auto;\n}\n\nh2 {\n    margin-top: 0;\n    font-size: 1.2rem;\n    color: #555;\n    border-bottom: 2px solid var(--primary);\n    padding-bottom: 10px;\n}\n\n.control-group label {\n    display: block;\n    font-weight: 600;\n    margin-bottom: 8px;\n    color: #444;\n}\n\n.input-wrapper {\n    display: flex;\n    align-items: center;\n    gap: 15px;\n}\n\ninput[type=\"range\"] {\n    flex: 1;\n    cursor: pointer;\n    accent-color: var(--primary);\n}\n\n.value-display {\n    width: 80px;\n    text-align: right;\n    font-weight: bold;\n    color: var(--primary);\n    font-family: monospace;\n}\n\n.readout-card {\n    margin-top: auto;\n    background: #e3f2fd;\n    border: 1px solid #bbdefb;\n    border-radius: 8px;\n    padding: 20px;\n    text-align: center;\n}\n\n.readout-card h3 {\n    margin: 0 0 10px;\n    font-size: 1rem;\n    color: #1565c0;\n}\n\n.pressure-value {\n    font-size: 1.8rem;\n    font-weight: bold;\n    color: #0d47a1;\n}\n\n.pressure-value .unit {\n    font-size: 1rem;\n    font-weight: normal;\n    color: #555;\n}\n\n.pressure-alt {\n    margin-top: 5px;\n    color: #666;\n    font-size: 0.9rem;\n}\n\n/* Simulation View */\n.simulation-view {\n    flex: 1;\n    padding: 30px;\n    display: flex;\n    flex-direction: column;\n    background: #ffffff;\n    position: relative;\n}\n\n.canvas-wrapper {\n    flex: 1;\n    background: #fff;\n    border: 1px solid #eee;\n    border-radius: 8px;\n    position: relative;\n    overflow: hidden;\n}\n\ncanvas {\n    width: 100%;\n    height: 100%;\n    display: block;\n}\n\n.overlay-label {\n    position: absolute;\n    background: rgba(255, 255, 255, 0.8);\n    padding: 4px 8px;\n    border-radius: 4px;\n    font-size: 0.8rem;\n    color: #666;\n    font-weight: bold;\n    pointer-events: none;\n}\n\n.top-label { top: 10px; right: 10px; }\n.bottom-label { bottom: 10px; right: 10px; }\n\n.info-box {\n    margin-top: 20px;\n    padding: 15px;\n    background: #fff3e0;\n    border-left: 5px solid #ff9800;\n    color: #5d4037;\n    font-size: 0.9rem;\n    border-radius: 4px;\n}\n\n@media (max-width: 900px) {\n    .main-interface {\n        flex-direction: column;\n    }\n    .controls-panel {\n        width: 100%;\n        border-right: none;\n        border-bottom: 1px solid var(--border);\n        height: auto;\n    }\n    .canvas-wrapper {\n        min-height: 300px;\n    }\n    body {\n        height: auto;\n        overflow: auto;\n    }\n}", "js": "// --- Constants ---\nconst R = 8.314; // Ideal Gas Constant J/(mol*K)\n\n// --- DOM Elements ---\nconst inputs = {\n    n: document.getElementById('moles'),\n    t: document.getElementById('temp'),\n    v: document.getElementById('volume')\n};\n\nconst displays = {\n    n: document.getElementById('val-n'),\n    t: document.getElementById('val-t'),\n    v: document.getElementById('val-v'),\n    pPa: document.getElementById('res-p-pa'),\n    pAtm: document.getElementById('res-p-atm')\n};\n\nconst canvas = document.getElementById('gasCanvas');\nconst ctx = canvas.getContext('2d');\n\n// --- State ---\nlet state = {\n    n: 10,\n    T: 300,\n    V: 1.0,\n    P: 0,\n    \n    // Animation state\n    particles: []\n};\n\n// --- Particle Class for Animation ---\nclass Particle {\n    constructor(w, h, speedFactor) {\n        this.x = Math.random() * w;\n        this.y = Math.random() * h;\n        this.vx = (Math.random() - 0.5) * speedFactor;\n        this.vy = (Math.random() - 0.5) * speedFactor;\n        this.radius = 3;\n        // Color based on temperature? (Cold=Blue, Hot=Red) handled in draw\n    }\n\n    update(w, h, speedFactor) {\n        // Update position\n        this.x += this.vx;\n        this.y += this.vy;\n\n        // Bounce off walls\n        if (this.x < this.radius) {\n            this.x = this.radius;\n            this.vx *= -1;\n        } else if (this.x > w - this.radius) {\n            this.x = w - this.radius;\n            this.vx *= -1;\n        }\n\n        // Bounce off floor\n        if (this.y > h - this.radius) {\n            this.y = h - this.radius;\n            this.vy *= -1;\n        } \n        \n        // Bounce off Piston (Top)\n        // Note: Piston y position is 0 in local container coords? \n        // We will pass the container height 'h' which varies with Volume.\n        if (this.y < this.radius) {\n            this.y = this.radius;\n            this.vy *= -1;\n        }\n        \n        // Dynamic speed adjustment based on temperature\n        // We normalize direction and scale by new speedFactor\n        const currentSpeed = Math.sqrt(this.vx*this.vx + this.vy*this.vy);\n        if(currentSpeed > 0) {\n             this.vx = (this.vx / currentSpeed) * speedFactor;\n             this.vy = (this.vy / currentSpeed) * speedFactor;\n        }\n    }\n}\n\n// --- Initialization ---\nfunction init() {\n    // Listeners\n    inputs.n.addEventListener('input', updateParams);\n    inputs.t.addEventListener('input', updateParams);\n    inputs.v.addEventListener('input', updateParams);\n    window.addEventListener('resize', resizeCanvas);\n\n    // Initial setup\n    resizeCanvas();\n    updateParams();\n    animate();\n}\n\nfunction resizeCanvas() {\n    const parent = canvas.parentElement;\n    canvas.width = parent.clientWidth;\n    canvas.height = parent.clientHeight;\n}\n\nfunction updateParams() {\n    // Read values\n    state.n = parseFloat(inputs.n.value);\n    state.T = parseFloat(inputs.t.value);\n    state.V = parseFloat(inputs.v.value);\n\n    // Update displays\n    displays.n.textContent = state.n.toFixed(1) + \" mol\";\n    displays.t.textContent = state.T.toFixed(0) + \" K\";\n    displays.v.textContent = state.V.toFixed(2) + \" m³\";\n\n    // Calculation: P = nRT / V\n    // P is in Pascals (Pa)\n    state.P = (state.n * R * state.T) / state.V;\n\n    // Display Result\n    // Use compact notation for large numbers\n    const pPa = state.P;\n    displays.pPa.textContent = new Intl.NumberFormat('en-US', { notation: \"compact\", maximumSignificantDigits: 4 }).format(pPa);\n    \n    // Convert to atm (1 atm = 101325 Pa)\n    const pAtm = pPa / 101325;\n    displays.pAtm.textContent = pAtm.toFixed(2);\n\n    updateParticles();\n}\n\nfunction updateParticles() {\n    // Number of visual particles proportional to moles (scaled)\n    // Scale: 1 mol = 5 particles for visual clarity (min 5, max 500)\n    const targetCount = Math.floor(state.n * 3);\n    \n    // If we have too few, add. If too many, remove.\n    if (state.particles.length < targetCount) {\n        for (let i = state.particles.length; i < targetCount; i++) {\n            // Spawn inside current container dimensions\n            // To be safe, spawn in center\n            state.particles.push(new Particle(100, 100, 1)); \n        }\n    } else if (state.particles.length > targetCount) {\n        state.particles.splice(targetCount);\n    }\n}\n\n// --- Animation Loop ---\nfunction animate() {\n    const w = canvas.width;\n    const h = canvas.height;\n    \n    ctx.clearRect(0, 0, w, h);\n\n    // --- Draw Container ---\n    // The visual volume changes height based on V input.\n    // Map V range [0.1, 10] to [10% height, 90% height]\n    const minH = h * 0.1;\n    const maxH = h * 0.9;\n    \n    // Normalize V (0.1 to 10)\n    const vNorm = (state.V - 0.1) / (10 - 0.1);\n    const containerH = minH + vNorm * (maxH - minH);\n    \n    const containerW = w * 0.6; // 60% width\n    const containerX = (w - containerW) / 2;\n    const containerY = h - 20; // Bottom margin\n\n    // Draw Walls (U shape)\n    ctx.strokeStyle = \"#444\";\n    ctx.lineWidth = 5;\n    ctx.beginPath();\n    ctx.moveTo(containerX, containerY - maxH); // Top Left max ext\n    ctx.lineTo(containerX, containerY);       // Bottom Left\n    ctx.lineTo(containerX + containerW, containerY); // Bottom Right\n    ctx.lineTo(containerX + containerW, containerY - maxH); // Top Right max ext\n    ctx.stroke();\n\n    // Fill Gas Area\n    // The \"Piston\" is at (containerY - containerH)\n    const gasTop = containerY - containerH;\n    \n    // Temp Color Tint\n    // Cold (200K) -> Blueish, Hot (1200K) -> Reddish\n    const tNorm = (state.T - 200) / 1000;\n    const r = Math.floor(tNorm * 255);\n    const b = Math.floor((1 - tNorm) * 255);\n    ctx.fillStyle = `rgba(${r}, 100, ${b}, 0.1)`;\n    ctx.fillRect(containerX, gasTop, containerW, containerH);\n\n    // Draw Piston Head\n    ctx.fillStyle = \"#9e9e9e\";\n    ctx.fillRect(containerX + 2, gasTop - 15, containerW - 4, 15);\n    // Piston Rod\n    ctx.fillStyle = \"#bdbdbd\";\n    ctx.fillRect(containerX + containerW/2 - 10, gasTop - 15, 20, -1000); // extends up\n\n    // --- Animate Particles ---\n    // Speed factor: proportional to sqrt(T)\n    // T=200 -> sqrt(200)=14.1. T=1200 -> sqrt(1200)=34.6\n    // Map to pixel speed roughly 2 to 10\n    const speed = Math.sqrt(state.T) * 0.3;\n    \n    ctx.fillStyle = `rgb(${r}, 50, ${b})`;\n    \n    state.particles.forEach(p => {\n        // Update logic needs local container dimensions\n        p.update(containerW, containerH, speed);\n        \n        // Draw (translate to container space)\n        ctx.beginPath();\n        ctx.arc(containerX + p.x, gasTop + p.y, p.radius, 0, Math.PI * 2);\n        ctx.fill();\n    });\n\n    // --- Draw Arrows on Piston (Pressure) ---\n    // Visual indicator of pressure pushing up\n    // Number/Size of arrows based on P\n    const pLog = Math.log10(state.P); // Range roughly 3 to 7\n    const arrowCount = Math.max(1, Math.floor(pLog)); \n    \n    ctx.fillStyle = \"#e53935\";\n    const arrowSpacing = containerW / (arrowCount + 1);\n    \n    for(let i=1; i<=arrowCount; i++) {\n        const ax = containerX + i*arrowSpacing;\n        const ay = gasTop - 20;\n        \n        // Draw upward arrow\n        ctx.beginPath();\n        ctx.moveTo(ax, ay);\n        ctx.lineTo(ax - 5, ay + 10);\n        ctx.lineTo(ax + 5, ay + 10);\n        ctx.fill();\n    }\n\n    requestAnimationFrame(animate);\n}\n\n// Start\ninit();"}}
{"input": {"input_text": "Van der Waals gas: (P + a(n/V)^2)(V - nb) = nRT. Compute pressure P for given parameters.", "simulation_name": " Van der Waals", "domain": "Chemistry", "description": "Non-ideal gas equation", "assumptions": ["Van der Waals fluid"], "entities": [], "constants": [{"name": "gas_constant", "symbol": "R", "value": 8.314, "unit": "J/(mol*K)"}], "parameters": [{"name": "amount", "symbol": "n", "unit": "mol", "range": [0.01, 10]}, {"name": "temperature", "symbol": "T", "unit": "K", "range": [200, 800]}, {"name": "volume", "symbol": "V", "unit": "m^3", "range": [0.001, 1]}, {"name": "attraction", "symbol": "a", "unit": "Pa*m^6/mol^2", "range": [0.01, 10]}, {"name": "co_volume", "symbol": "b", "unit": "m^3/mol", "range": [1e-05, 0.001]}], "equations": [{"description": "Pressure", "expression": "P = (n*R*T)/(V - n*b) - a*(n/V)^2"}], "initial_conditions": {}, "outputs": ["P"], "simulation_controls": ["n", "T", "V", "a", "b"], "constraints": ["V > n*b"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Van der Waals Gas Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"card\">\n            <!-- Header -->\n            <div class=\"header\">\n                <h1>Van der Waals Gas Simulation</h1>\n                <p class=\"subtitle\">Non-ideal gas behavior with molecular interactions</p>\n                <div class=\"equation\">\n                    (P + a(n/V)²)(V - nb) = nRT\n                </div>\n            </div>\n            \n            <div class=\"content-grid\">\n                <!-- Visualization Section -->\n                <div class=\"left-panel\">\n                    <div class=\"section\">\n                        <h3>Gas Container</h3>\n                        <div class=\"container-wrapper\">\n                            <canvas id=\"gasCanvas\" width=\"400\" height=\"400\"></canvas>\n                        </div>\n                        \n                        <!-- Controls -->\n                        <div class=\"controls\">\n                            <button id=\"playBtn\" class=\"btn btn-primary\">\n                                <span id=\"playIcon\">▶</span> Play\n                            </button>\n                            <button id=\"resetBtn\" class=\"btn btn-secondary\">\n                                ↺ Reset\n                            </button>\n                        </div>\n                        \n                        <div class=\"speed-control\">\n                            <label>Animation Speed: <span id=\"speedValue\">1.0</span>x</label>\n                            <input type=\"range\" id=\"speedSlider\" min=\"0.1\" max=\"3\" step=\"0.1\" value=\"1\">\n                        </div>\n                    </div>\n                    \n                    <!-- Results -->\n                    <div class=\"section results\" id=\"resultsSection\">\n                        <h3>Calculated Pressure</h3>\n                        <div id=\"pressureDisplay\">\n                            <div class=\"pressure-value\" id=\"pressureValue\">—</div>\n                            <div class=\"pressure-details\" id=\"pressureDetails\"></div>\n                        </div>\n                        <div id=\"constraintWarning\" class=\"warning hidden\">\n                            ⚠ Constraint violation: V must be greater than n×b\n                        </div>\n                    </div>\n                </div>\n                \n                <!-- Parameters Section -->\n                <div class=\"right-panel\">\n                    <div class=\"section parameters\">\n                        <h3>Parameters</h3>\n                        \n                        <!-- Amount -->\n                        <div class=\"param-group\">\n                            <label>\n                                <span>Amount (n)</span>\n                                <span class=\"param-value\" id=\"nValue\">1.00 mol</span>\n                            </label>\n                            <input type=\"range\" id=\"nSlider\" min=\"0.01\" max=\"10\" step=\"0.01\" value=\"1\">\n                        </div>\n                        \n                        <!-- Temperature -->\n                        <div class=\"param-group\">\n                            <label>\n                                <span>Temperature (T)</span>\n                                <span class=\"param-value\" id=\"tValue\">300 K</span>\n                            </label>\n                            <input type=\"range\" id=\"tSlider\" min=\"200\" max=\"800\" step=\"1\" value=\"300\">\n                        </div>\n                        \n                        <!-- Volume -->\n                        <div class=\"param-group\">\n                            <label>\n                                <span>Volume (V)</span>\n                                <span class=\"param-value\" id=\"vValue\">0.1000 m³</span>\n                            </label>\n                            <input type=\"range\" id=\"vSlider\" min=\"0.001\" max=\"1\" step=\"0.001\" value=\"0.1\">\n                            <div class=\"constraint-info\" id=\"minVolume\">Min: 5.00e-5 m³</div>\n                        </div>\n                        \n                        <!-- Attraction -->\n                        <div class=\"param-group\">\n                            <label>\n                                <span>Attraction (a)</span>\n                                <span class=\"param-value\" id=\"aValue\">0.500 Pa·m⁶/mol²</span>\n                            </label>\n                            <input type=\"range\" id=\"aSlider\" min=\"0.01\" max=\"10\" step=\"0.01\" value=\"0.5\">\n                        </div>\n                        \n                        <!-- Co-volume -->\n                        <div class=\"param-group\">\n                            <label>\n                                <span>Co-volume (b)</span>\n                                <span class=\"param-value\" id=\"bValue\">5.00e-5 m³/mol</span>\n                            </label>\n                            <input type=\"range\" id=\"bSlider\" min=\"0.00001\" max=\"0.001\" step=\"0.00001\" value=\"0.00005\">\n                        </div>\n                    </div>\n                    \n                    <!-- Info -->\n                    <div class=\"section info\">\n                        <h3>About Van der Waals Gas</h3>\n                        <p><strong>Parameter a:</strong> Accounts for intermolecular attractive forces</p>\n                        <p><strong>Parameter b:</strong> Accounts for finite molecular volume (excluded volume)</p>\n                        <p class=\"info-note\">Unlike ideal gases, Van der Waals equation considers real molecular interactions and sizes.</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;\n    background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);\n    min-height: 100vh;\n    padding: 1.5rem;\n}\n\n.container {\n    max-width: 1400px;\n    margin: 0 auto;\n}\n\n.card {\n    background: white;\n    border-radius: 1rem;\n    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);\n    overflow: hidden;\n}\n\n/* Header */\n.header {\n    background: linear-gradient(135deg, #2563eb 0%, #9333ea 100%);\n    color: white;\n    padding: 2rem;\n}\n\n.header h1 {\n    font-size: 2rem;\n    margin-bottom: 0.5rem;\n}\n\n.subtitle {\n    color: #bfdbfe;\n    margin-bottom: 1rem;\n}\n\n.equation {\n    font-family: 'Courier New', monospace;\n    font-size: 0.9rem;\n    background: rgba(255, 255, 255, 0.1);\n    padding: 0.75rem;\n    border-radius: 0.5rem;\n    display: inline-block;\n}\n\n/* Content Grid */\n.content-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 1.5rem;\n    padding: 1.5rem;\n}\n\n@media (max-width: 968px) {\n    .content-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n/* Sections */\n.section {\n    background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);\n    border-radius: 0.75rem;\n    padding: 1.5rem;\n    margin-bottom: 1.5rem;\n}\n\n.section h3 {\n    color: #1f2937;\n    font-size: 1.125rem;\n    margin-bottom: 1rem;\n}\n\n/* Canvas Container */\n.container-wrapper {\n    background: white;\n    border: 4px solid #9ca3af;\n    border-radius: 0.5rem;\n    overflow: hidden;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 400px;\n}\n\n#gasCanvas {\n    display: block;\n}\n\n/* Controls */\n.controls {\n    display: flex;\n    gap: 0.75rem;\n    margin-top: 1rem;\n}\n\n.btn {\n    flex: 1;\n    padding: 0.75rem 1rem;\n    border: none;\n    border-radius: 0.5rem;\n    font-size: 1rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.2s;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 0.5rem;\n}\n\n.btn-primary {\n    background: #2563eb;\n    color: white;\n}\n\n.btn-primary:hover {\n    background: #1d4ed8;\n}\n\n.btn-secondary {\n    background: #6b7280;\n    color: white;\n}\n\n.btn-secondary:hover {\n    background: #4b5563;\n}\n\n.speed-control {\n    margin-top: 1rem;\n}\n\n.speed-control label {\n    display: block;\n    font-size: 0.875rem;\n    font-weight: 500;\n    color: #4b5563;\n    margin-bottom: 0.5rem;\n}\n\n/* Results */\n.results {\n    background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);\n}\n\n.results.invalid {\n    background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);\n}\n\n.pressure-value {\n    font-size: 2.5rem;\n    font-weight: bold;\n    color: #059669;\n    margin-bottom: 0.5rem;\n}\n\n.pressure-details {\n    font-size: 0.875rem;\n    color: #6b7280;\n}\n\n.pressure-details div {\n    margin: 0.25rem 0;\n}\n\n.warning {\n    color: #dc2626;\n    font-weight: 600;\n    margin-top: 1rem;\n}\n\n.warning.hidden {\n    display: none;\n}\n\n/* Parameters */\n.parameters {\n    background: linear-gradient(135deg, #faf5ff 0%, #ede9fe 100%);\n}\n\n.param-group {\n    margin-bottom: 1.5rem;\n}\n\n.param-group label {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.875rem;\n    font-weight: 500;\n    color: #4b5563;\n    margin-bottom: 0.5rem;\n}\n\n.param-value {\n    color: #7c3aed;\n    font-weight: 600;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    height: 6px;\n    border-radius: 3px;\n    background: #e5e7eb;\n    outline: none;\n    -webkit-appearance: none;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 18px;\n    height: 18px;\n    border-radius: 50%;\n    background: #7c3aed;\n    cursor: pointer;\n    transition: all 0.2s;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb:hover {\n    background: #6d28d9;\n    transform: scale(1.1);\n}\n\ninput[type=\"range\"]::-moz-range-thumb {\n    width: 18px;\n    height: 18px;\n    border-radius: 50%;\n    background: #7c3aed;\n    cursor: pointer;\n    border: none;\n    transition: all 0.2s;\n}\n\ninput[type=\"range\"]::-moz-range-thumb:hover {\n    background: #6d28d9;\n    transform: scale(1.1);\n}\n\n.constraint-info {\n    font-size: 0.75rem;\n    color: #6b7280;\n    margin-top: 0.25rem;\n}\n\n/* Info */\n.info {\n    background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);\n}\n\n.info p {\n    font-size: 0.875rem;\n    color: #374151;\n    margin-bottom: 0.75rem;\n}\n\n.info-note {\n    padding-top: 0.75rem;\n    border-top: 1px solid #93c5fd;\n}\n\n.left-panel,\n.right-panel {\n    display: flex;\n    flex-direction: column;\n}", "js": "// Constants\nconst R = 8.314; // Gas constant J/(mol*K)\n\n// Parameters\nlet params = {\n    n: 1,      // mol\n    T: 300,    // K\n    V: 0.1,    // m³\n    a: 0.5,    // Pa*m⁶/mol²\n    b: 0.00005 // m³/mol\n};\n\n// Animation state\nlet isPlaying = false;\nlet animationSpeed = 1.0;\nlet particles = [];\nlet animationFrame = null;\n\n// Canvas setup\nconst canvas = document.getElementById('gasCanvas');\nconst ctx = canvas.getContext('2d');\n\n// Initialize particles\nfunction initializeParticles() {\n    const particleCount = Math.min(Math.floor(params.n * 20), 100);\n    particles = [];\n    for (let i = 0; i < particleCount; i++) {\n        particles.push({\n            x: Math.random() * canvas.width,\n            y: Math.random() * canvas.height,\n            vx: (Math.random() - 0.5) * 2,\n            vy: (Math.random() - 0.5) * 2\n        });\n    }\n}\n\n// Calculate pressure using Van der Waals equation\nfunction calculatePressure(n, T, V, a, b) {\n    if (V <= n * b) return null; // Constraint violation\n    const idealTerm = (n * R * T) / (V - n * b);\n    const attractionTerm = a * Math.pow(n / V, 2);\n    return idealTerm - attractionTerm;\n}\n\n// Update pressure display\nfunction updatePressure() {\n    const P = calculatePressure(params.n, params.T, params.V, params.a, params.b);\n    const resultsSection = document.getElementById('resultsSection');\n    const pressureValue = document.getElementById('pressureValue');\n    const pressureDetails = document.getElementById('pressureDetails');\n    const constraintWarning = document.getElementById('constraintWarning');\n    \n    if (P === null) {\n        resultsSection.classList.add('invalid');\n        pressureValue.textContent = '—';\n        pressureDetails.innerHTML = '';\n        constraintWarning.classList.remove('hidden');\n    } else {\n        resultsSection.classList.remove('invalid');\n        pressureValue.textContent = P.toExponential(3) + ' Pa';\n        \n        const idealTerm = (params.n * R * params.T) / (params.V - params.n * params.b);\n        const attractionTerm = params.a * Math.pow(params.n / params.V, 2);\n        \n        pressureDetails.innerHTML = `\n            <div>Ideal term: ${idealTerm.toExponential(3)} Pa</div>\n            <div>Attraction term: ${attractionTerm.toExponential(3)} Pa</div>\n        `;\n        constraintWarning.classList.add('hidden');\n    }\n}\n\n// Update particles\nfunction updateParticles() {\n    const speed = Math.sqrt(params.T / 300);\n    const containerScale = Math.pow(params.V / 0.1, 1/3);\n    const effectiveWidth = Math.min(canvas.width * containerScale, canvas.width);\n    const effectiveHeight = Math.min(canvas.height * containerScale, canvas.height);\n    \n    particles.forEach(p => {\n        // Update position\n        p.x += p.vx * speed * animationSpeed;\n        p.y += p.vy * speed * animationSpeed;\n        \n        // Bounce off walls\n        if (p.x <= 0 || p.x >= effectiveWidth) {\n            p.vx = -p.vx;\n            p.x = Math.max(0, Math.min(effectiveWidth, p.x));\n        }\n        if (p.y <= 0 || p.y >= effectiveHeight) {\n            p.vy = -p.vy;\n            p.y = Math.max(0, Math.min(effectiveHeight, p.y));\n        }\n    });\n}\n\n// Draw particles\nfunction drawParticles() {\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    \n    // Calculate container size\n    const containerScale = Math.pow(params.V / 0.1, 1/3);\n    const effectiveWidth = Math.min(canvas.width * containerScale, canvas.width);\n    const effectiveHeight = Math.min(canvas.height * containerScale, canvas.height);\n    \n    // Draw container bounds\n    const offsetX = (canvas.width - effectiveWidth) / 2;\n    const offsetY = (canvas.height - effectiveHeight) / 2;\n    \n    ctx.strokeStyle = '#d1d5db';\n    ctx.lineWidth = 2;\n    ctx.strokeRect(offsetX, offsetY, effectiveWidth, effectiveHeight);\n    \n    // Draw particles\n    const hue = 240 - params.T / 4;\n    particles.forEach(p => {\n        ctx.beginPath();\n        ctx.arc(offsetX + p.x, offsetY + p.y, 4, 0, Math.PI * 2);\n        ctx.fillStyle = `hsl(${hue}, 70%, 50%)`;\n        ctx.shadowBlur = 10;\n        ctx.shadowColor = `hsla(${hue}, 70%, 50%, 0.5)`;\n        ctx.fill();\n        ctx.shadowBlur = 0;\n    });\n}\n\n// Animation loop\nfunction animate() {\n    if (!isPlaying) return;\n    \n    updateParticles();\n    drawParticles();\n    \n    animationFrame = requestAnimationFrame(animate);\n}\n\n// Update parameter displays\nfunction updateDisplays() {\n    document.getElementById('nValue').textContent = params.n.toFixed(2) + ' mol';\n    document.getElementById('tValue').textContent = params.T.toFixed(0) + ' K';\n    document.getElementById('vValue').textContent = params.V.toFixed(4) + ' m³';\n    document.getElementById('aValue').textContent = params.a.toFixed(3) + ' Pa·m⁶/mol²';\n    document.getElementById('bValue').textContent = params.b.toExponential(2) + ' m³/mol';\n    document.getElementById('minVolume').textContent = 'Min: ' + (params.n * params.b).toExponential(2) + ' m³';\n    document.getElementById('speedValue').textContent = animationSpeed.toFixed(1);\n    \n    updatePressure();\n    drawParticles();\n}\n\n// Event listeners\ndocument.getElementById('playBtn').addEventListener('click', function() {\n    isPlaying = !isPlaying;\n    const playIcon = document.getElementById('playIcon');\n    \n    if (isPlaying) {\n        this.innerHTML = '<span id=\"playIcon\">⏸</span> Pause';\n        animate();\n    } else {\n        this.innerHTML = '<span id=\"playIcon\">▶</span> Play';\n        if (animationFrame) {\n            cancelAnimationFrame(animationFrame);\n        }\n    }\n});\n\ndocument.getElementById('resetBtn').addEventListener('click', function() {\n    params = {\n        n: 1,\n        T: 300,\n        V: 0.1,\n        a: 0.5,\n        b: 0.00005\n    };\n    \n    // Reset sliders\n    document.getElementById('nSlider').value = 1;\n    document.getElementById('tSlider').value = 300;\n    document.getElementById('vSlider').value = 0.1;\n    document.getElementById('aSlider').value = 0.5;\n    document.getElementById('bSlider').value = 0.00005;\n    \n    // Stop animation\n    isPlaying = false;\n    document.getElementById('playBtn').innerHTML = '<span id=\"playIcon\">▶</span> Play';\n    if (animationFrame) {\n        cancelAnimationFrame(animationFrame);\n    }\n    \n    initializeParticles();\n    updateDisplays();\n});\n\ndocument.getElementById('speedSlider').addEventListener('input', function() {\n    animationSpeed = parseFloat(this.value);\n    document.getElementById('speedValue').textContent = animationSpeed.toFixed(1);\n});\n\n// Parameter sliders\ndocument.getElementById('nSlider').addEventListener('input', function() {\n    params.n = parseFloat(this.value);\n    initializeParticles();\n    updateDisplays();\n});\n\ndocument.getElementById('tSlider').addEventListener('input', function() {\n    params.T = parseFloat(this.value);\n    updateDisplays();\n});\n\ndocument.getElementById('vSlider').addEventListener('input', function() {\n    params.V = parseFloat(this.value);\n    updateDisplays();\n});\n\ndocument.getElementById('aSlider').addEventListener('input', function() {\n    params.a = parseFloat(this.value);\n    updateDisplays();\n});\n\ndocument.getElementById('bSlider').addEventListener('input', function() {\n    params.b = parseFloat(this.value);\n    updateDisplays();\n});\n\n// Initialize\ninitializeParticles();\nupdateDisplays();"}}
{"input": {"input_text": "Adiabatic compression of ideal gas: PV^gamma = constant. Given initial P1,V1,T1 and final V2 compute P2,T2.", "simulation_name": " Adiabatic Compression", "domain": "Thermodynamics", "description": "Ideal gas adiabatic relation", "assumptions": ["Ideal gas", "Reversible adiabatic"], "entities": [], "constants": [], "parameters": [{"name": "pressure1", "symbol": "P1", "unit": "Pa", "range": [10000.0, 10000000.0]}, {"name": "volume1", "symbol": "V1", "unit": "m^3", "range": [0.0001, 10]}, {"name": "temperature1", "symbol": "T1", "unit": "K", "range": [200, 800]}, {"name": "volume2", "symbol": "V2", "unit": "m^3", "range": [0.0001, 10]}, {"name": "heat_capacity_ratio", "symbol": "gamma", "unit": "dimensionless", "range": [1.1, 1.67]}], "equations": [{"description": "Pressure2", "expression": "P2 = P1*(V1/V2)^gamma"}, {"description": "Temperature2", "expression": "T2 = T1*(V1/V2)^{gamma-1}"}], "initial_conditions": {}, "outputs": ["P2", "T2"], "simulation_controls": ["P1", "V1", "T1", "V2", "gamma"], "constraints": ["V2 > 0", "gamma > 1"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S22 Adiabatic Compression Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"container\">\n    <header>\n        <h1>Adiabatic Compression (Ideal Gas)</h1>\n        <p class=\"subtitle\">Simulate the reversible adiabatic process: \\( P_1 V_1^\\gamma = P_2 V_2^\\gamma \\)</p>\n    </header>\n\n    <div class=\"simulation-grid\">\n        <aside class=\"controls\">\n            <h2>Parameters</h2>\n            \n            <div class=\"control-group\">\n                <h3>Initial State (1)</h3>\n                \n                <label for=\"p1-slider\">\n                    Pressure (\\(P_1\\))\n                    <span id=\"p1-val\" class=\"val-display\">100 kPa</span>\n                </label>\n                <input type=\"range\" id=\"p1-slider\" min=\"10000\" max=\"10000000\" step=\"10000\" value=\"100000\">\n\n                <label for=\"v1-slider\">\n                    Volume (\\(V_1\\))\n                    <span id=\"v1-val\" class=\"val-display\">5.0 m³</span>\n                </label>\n                <input type=\"range\" id=\"v1-slider\" min=\"0.1\" max=\"10\" step=\"0.1\" value=\"5.0\">\n\n                <label for=\"t1-slider\">\n                    Temperature (\\(T_1\\))\n                    <span id=\"t1-val\" class=\"val-display\">300 K</span>\n                </label>\n                <input type=\"range\" id=\"t1-slider\" min=\"200\" max=\"800\" step=\"10\" value=\"300\">\n            </div>\n\n            <div class=\"separator\"></div>\n\n            <div class=\"control-group\">\n                <label for=\"gamma-slider\">\n                    Heat Capacity Ratio (\\(\\gamma\\))\n                    <span id=\"gamma-val\" class=\"val-display\">1.40</span>\n                </label>\n                <input type=\"range\" id=\"gamma-slider\" min=\"1.1\" max=\"1.67\" step=\"0.01\" value=\"1.4\">\n            </div>\n\n            <div class=\"separator\"></div>\n\n            <div class=\"control-group highlight-group\">\n                <h3>Final State (2) - Control</h3>\n                <label for=\"v2-slider\">\n                    Final Volume (\\(V_2\\))\n                    <span id=\"v2-val\" class=\"val-display\">2.5 m³</span>\n                </label>\n                <input type=\"range\" id=\"v2-slider\" min=\"0.1\" max=\"10\" step=\"0.1\" value=\"2.5\">\n            </div>\n        </aside>\n\n        <main class=\"visuals\">\n            <div class=\"outputs\">\n                <div class=\"output-card\">\n                    <span class=\"label\">Final Pressure (\\(P_2\\))</span>\n                    <span class=\"value\" id=\"p2-output\">--</span>\n                    <span class=\"unit\">Pa</span>\n                </div>\n                <div class=\"output-card\">\n                    <span class=\"label\">Final Temperature (\\(T_2\\))</span>\n                    <span class=\"value\" id=\"t2-output\">--</span>\n                    <span class=\"unit\">K</span>\n                </div>\n            </div>\n\n            <div class=\"canvas-wrapper\">\n                <div class=\"canvas-box\">\n                    <h4>Piston Simulation</h4>\n                    <canvas id=\"pistonCanvas\"></canvas>\n                    <div class=\"legend\">\n                        <span class=\"dot-start\"></span> Initial State\n                        <span class=\"dot-current\"></span> Current State\n                    </div>\n                </div>\n                <div class=\"canvas-box\">\n                    <h4>P-V Diagram</h4>\n                    <canvas id=\"graphCanvas\"></canvas>\n                </div>\n            </div>\n        </main>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary-color: #007bff;\n    --bg-color: #f8f9fa;\n    --card-bg: #ffffff;\n    --text-color: #333;\n    --border-color: #dee2e6;\n    --accent-color: #dc3545;\n}\n\nbody {\n    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    margin: 0;\n    padding: 20px;\n    line-height: 1.6;\n}\n\n.container {\n    max-width: 1200px;\n    margin: 0 auto;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 30px;\n}\n\nheader h1 {\n    margin: 0;\n    color: var(--primary-color);\n}\n\n.subtitle {\n    color: #666;\n    font-size: 1.1em;\n}\n\n/* Simulation Grid Layout */\n.simulation-grid {\n    display: grid;\n    grid-template-columns: 300px 1fr;\n    gap: 20px;\n    align-items: start;\n}\n\n@media (max-width: 800px) {\n    .simulation-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n/* Controls Styles */\n.controls {\n    background: var(--card-bg);\n    padding: 20px;\n    border-radius: 8px;\n    box-shadow: 0 2px 10px rgba(0,0,0,0.05);\n}\n\n.controls h2 {\n    margin-top: 0;\n    font-size: 1.2em;\n    border-bottom: 2px solid var(--primary-color);\n    padding-bottom: 10px;\n    margin-bottom: 20px;\n}\n\n.controls h3 {\n    font-size: 1em;\n    color: #555;\n    margin-bottom: 10px;\n}\n\n.control-group {\n    margin-bottom: 15px;\n}\n\nlabel {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.9em;\n    font-weight: 600;\n    margin-bottom: 5px;\n}\n\n.val-display {\n    color: var(--primary-color);\n    font-family: monospace;\n}\n\ninput[type=range] {\n    width: 100%;\n    margin-bottom: 10px;\n    cursor: pointer;\n}\n\n.separator {\n    height: 1px;\n    background: var(--border-color);\n    margin: 15px 0;\n}\n\n.highlight-group {\n    background-color: #eef7ff;\n    padding: 10px;\n    border-radius: 6px;\n    border: 1px solid #cce5ff;\n}\n\n/* Visuals Section */\n.visuals {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n/* Output Cards */\n.outputs {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 20px;\n}\n\n.output-card {\n    background: var(--card-bg);\n    padding: 20px;\n    border-radius: 8px;\n    box-shadow: 0 2px 5px rgba(0,0,0,0.05);\n    text-align: center;\n    border-left: 5px solid var(--accent-color);\n}\n\n.output-card .label {\n    display: block;\n    font-size: 0.9em;\n    color: #666;\n    margin-bottom: 5px;\n}\n\n.output-card .value {\n    font-size: 1.8em;\n    font-weight: bold;\n    color: var(--text-color);\n}\n\n.output-card .unit {\n    font-size: 0.9em;\n    color: #888;\n    margin-left: 5px;\n}\n\n/* Canvas Area */\n.canvas-wrapper {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.canvas-box {\n    background: var(--card-bg);\n    padding: 15px;\n    border-radius: 8px;\n    box-shadow: 0 2px 10px rgba(0,0,0,0.05);\n    position: relative;\n}\n\n.canvas-box h4 {\n    margin: 0 0 10px 0;\n    color: #555;\n}\n\ncanvas {\n    width: 100%;\n    background: #fff;\n    border: 1px solid var(--border-color);\n    border-radius: 4px;\n}\n\n.legend {\n    margin-top: 10px;\n    font-size: 0.85em;\n    color: #666;\n    display: flex;\n    gap: 15px;\n    align-items: center;\n}\n\n.dot-start {\n    width: 10px;\n    height: 10px;\n    border-radius: 50%;\n    background: #999;\n    display: inline-block;\n}\n\n.dot-current {\n    width: 10px;\n    height: 10px;\n    border-radius: 50%;\n    background: #ff0000;\n    display: inline-block;\n}", "js": "document.addEventListener('DOMContentLoaded', () => {\n    // DOM Elements\n    const inputs = {\n        P1: document.getElementById('p1-slider'),\n        V1: document.getElementById('v1-slider'),\n        T1: document.getElementById('t1-slider'),\n        gamma: document.getElementById('gamma-slider'),\n        V2: document.getElementById('v2-slider')\n    };\n\n    const displays = {\n        P1: document.getElementById('p1-val'),\n        V1: document.getElementById('v1-val'),\n        T1: document.getElementById('t1-val'),\n        gamma: document.getElementById('gamma-val'),\n        V2: document.getElementById('v2-val'),\n        P2: document.getElementById('p2-output'),\n        T2: document.getElementById('t2-output')\n    };\n\n    const pistonCanvas = document.getElementById('pistonCanvas');\n    const graphCanvas = document.getElementById('graphCanvas');\n    const pCtx = pistonCanvas.getContext('2d');\n    const gCtx = graphCanvas.getContext('2d');\n\n    // Visual Constants\n    const CYLINDER_PADDING_TOP = 20;\n    const CYLINDER_PADDING_BOTTOM = 20;\n\n    // Simulation State\n    let state = {\n        P1: 100000,\n        V1: 5.0,\n        T1: 300,\n        gamma: 1.4,\n        V2: 2.5,\n        P2: 0,\n        T2: 0\n    };\n\n    // Particles for animation\n    const particles = [];\n    const NUM_PARTICLES = 60;\n    \n    // Canvas sizing\n    function resizeCanvases() {\n        pistonCanvas.width = pistonCanvas.parentElement.clientWidth;\n        pistonCanvas.height = 300;\n        graphCanvas.width = graphCanvas.parentElement.clientWidth;\n        graphCanvas.height = 300;\n    }\n    window.addEventListener('resize', resizeCanvases);\n    resizeCanvases();\n\n    // Particle Class\n    class Particle {\n        constructor() {\n            this.radius = 3;\n            this.reset();\n        }\n\n        reset() {\n            // Spawn randomly within safe vertical bounds\n            const safeHeight = pistonCanvas.height - CYLINDER_PADDING_TOP - CYLINDER_PADDING_BOTTOM;\n            this.y = CYLINDER_PADDING_TOP + this.radius + Math.random() * (safeHeight - 2 * this.radius);\n            \n            // Spawn randomly horizontally (initial guess, clamped later)\n            this.x = Math.random() * (pistonCanvas.width * 0.5);\n            \n            this.vx = (Math.random() - 0.5);\n            this.vy = (Math.random() - 0.5);\n        }\n\n        update(temp, limitX) {\n            // Speed factor based on Temperature\n            const speed = 0.5 + Math.sqrt(temp) * 0.15; \n\n            this.x += this.vx * speed;\n            this.y += this.vy * speed;\n\n            // --- Vertical Wall Collisions (Top & Bottom) ---\n            // Top Wall (y = 20)\n            if (this.y < CYLINDER_PADDING_TOP + this.radius) {\n                this.y = CYLINDER_PADDING_TOP + this.radius;\n                this.vy *= -1;\n            }\n            // Bottom Wall (y = height - 20)\n            if (this.y > (pistonCanvas.height - CYLINDER_PADDING_BOTTOM) - this.radius) {\n                this.y = (pistonCanvas.height - CYLINDER_PADDING_BOTTOM) - this.radius;\n                this.vy *= -1;\n            }\n            \n            // --- Horizontal Wall Collisions (Left & Piston) ---\n            // Piston Head Collision (Right side limit)\n            if (this.x > limitX - this.radius) {\n                this.x = limitX - this.radius;\n                this.vx *= -1;\n            }\n\n            // Cylinder Back Collision (Left side at x=0)\n            if (this.x < 0 + this.radius) {\n                this.x = this.radius;\n                this.vx *= -1;\n            }\n        }\n\n        draw(ctx, temp) {\n            // Color interpolation: Blue (cold) -> Red (hot)\n            const tNorm = Math.min(Math.max((temp - 200) / 1000, 0), 1);\n            const r = Math.floor(tNorm * 255);\n            const b = Math.floor((1 - tNorm) * 255);\n            \n            ctx.beginPath();\n            ctx.fillStyle = `rgb(${r}, 0, ${b})`;\n            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);\n            ctx.fill();\n        }\n    }\n\n    // Initialize particles\n    for(let i=0; i<NUM_PARTICLES; i++) {\n        particles.push(new Particle());\n    }\n\n    // Format Helpers\n    const fmt = (num, decimals = 2) => num.toFixed(decimals);\n\n    // Update Logic\n    function updatePhysics() {\n        // Read Inputs\n        state.P1 = parseFloat(inputs.P1.value);\n        state.V1 = parseFloat(inputs.V1.value);\n        state.T1 = parseFloat(inputs.T1.value);\n        state.gamma = parseFloat(inputs.gamma.value);\n        state.V2 = parseFloat(inputs.V2.value);\n\n        // Update Displays\n        displays.P1.innerText = state.P1 >= 1e6 ? `${fmt(state.P1/1e6)} MPa` : `${fmt(state.P1/1000)} kPa`;\n        displays.V1.innerText = `${state.V1} m³`;\n        displays.T1.innerText = `${state.T1} K`;\n        displays.gamma.innerText = state.gamma;\n        displays.V2.innerText = `${state.V2} m³`;\n\n        // Calculate Outputs\n        // P2 = P1 * (V1/V2)^gamma\n        state.P2 = state.P1 * Math.pow((state.V1 / state.V2), state.gamma);\n        \n        // T2 = T1 * (V1/V2)^(gamma-1)\n        state.T2 = state.T1 * Math.pow((state.V1 / state.V2), state.gamma - 1);\n\n        // Output formatting\n        displays.P2.innerText = state.P2 >= 1e6 ? fmt(state.P2/1e6) + \" M\" : (state.P2 >= 1000 ? fmt(state.P2/1000) + \" k\" : fmt(state.P2));\n        displays.T2.innerText = fmt(state.T2);\n    }\n\n    // Drawing Logic\n    function drawPistonSystem() {\n        const ctx = pCtx;\n        const w = pistonCanvas.width;\n        const h = pistonCanvas.height;\n        ctx.clearRect(0, 0, w, h);\n\n        // Define cylinder dimensions\n        // We map max Volume (10.5) to about 90% of canvas width\n        const maxDisplayV = 10.5;\n        const scaleX = (w * 0.9) / maxDisplayV;\n        \n        const pistonX = state.V2 * scaleX;\n        const initialX = state.V1 * scaleX;\n\n        // Draw Cylinder Walls (Top and Bottom)\n        ctx.fillStyle = '#f9f9f9'; // Interior background\n        ctx.fillRect(0, CYLINDER_PADDING_TOP, w, h - (CYLINDER_PADDING_TOP + CYLINDER_PADDING_BOTTOM));\n        \n        ctx.strokeStyle = '#333';\n        ctx.lineWidth = 4;\n        \n        // Draw Top Wall\n        ctx.beginPath();\n        ctx.moveTo(0, CYLINDER_PADDING_TOP);\n        ctx.lineTo(w, CYLINDER_PADDING_TOP);\n        ctx.stroke();\n\n        // Draw Bottom Wall\n        ctx.beginPath();\n        ctx.moveTo(0, h - CYLINDER_PADDING_BOTTOM);\n        ctx.lineTo(w, h - CYLINDER_PADDING_BOTTOM);\n        ctx.stroke();\n\n        // Draw Back Wall (Left)\n        ctx.beginPath();\n        ctx.moveTo(0, CYLINDER_PADDING_TOP);\n        ctx.lineTo(0, h - CYLINDER_PADDING_BOTTOM);\n        ctx.stroke();\n\n        // Draw Reference Line for V1 (Ghost Piston)\n        ctx.beginPath();\n        ctx.strokeStyle = 'rgba(0, 0, 0, 0.2)';\n        ctx.lineWidth = 2;\n        ctx.setLineDash([5, 5]);\n        ctx.moveTo(initialX, CYLINDER_PADDING_TOP);\n        ctx.lineTo(initialX, h - CYLINDER_PADDING_BOTTOM);\n        ctx.stroke();\n        ctx.setLineDash([]);\n        \n        // Draw Label for V1\n        ctx.fillStyle = '#666';\n        ctx.font = '12px sans-serif';\n        ctx.fillText(\"V1\", initialX + 5, h - 5);\n\n        // Draw Moving Piston Head\n        ctx.fillStyle = '#555';\n        ctx.fillRect(pistonX, CYLINDER_PADDING_TOP, 20, h - (CYLINDER_PADDING_TOP + CYLINDER_PADDING_BOTTOM));\n        \n        // Draw Connecting Rod\n        ctx.fillStyle = '#888';\n        ctx.fillRect(pistonX + 20, (h/2) - 10, w - pistonX, 20);\n\n        // Draw Particles\n        particles.forEach(p => {\n            p.update(state.T2, pistonX); // Pass correct right-side boundary\n            p.draw(ctx, state.T2);\n        });\n\n        // Overlay Text\n        ctx.fillStyle = 'black';\n        ctx.font = 'bold 14px sans-serif';\n        ctx.fillText(`V: ${state.V2.toFixed(2)} m³`, 10, 40);\n        ctx.fillText(`T: ${state.T2.toFixed(0)} K`, 10, 60);\n    }\n\n    function drawPVGraph() {\n        const ctx = gCtx;\n        const w = graphCanvas.width;\n        const h = graphCanvas.height;\n        ctx.clearRect(0, 0, w, h);\n\n        // Margins\n        const padLeft = 50;\n        const padBottom = 30;\n        const graphW = w - padLeft - 20;\n        const graphH = h - padBottom - 20;\n\n        // Draw Axes\n        ctx.beginPath();\n        ctx.strokeStyle = '#333';\n        ctx.lineWidth = 2;\n        // Y Axis\n        ctx.moveTo(padLeft, 10);\n        ctx.lineTo(padLeft, h - padBottom);\n        // X Axis\n        ctx.lineTo(w - 10, h - padBottom);\n        ctx.stroke();\n\n        // Labels\n        ctx.fillStyle = '#333';\n        ctx.font = '12px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.fillText(\"Volume (m³)\", w / 2 + padLeft/2, h - 5);\n        ctx.save();\n        ctx.translate(15, h/2);\n        ctx.rotate(-Math.PI/2);\n        ctx.fillText(\"Pressure (Pa)\", 0, 0);\n        ctx.restore();\n\n        // Calculate Scale\n        const C = state.P1 * Math.pow(state.V1, state.gamma);\n        const maxP = Math.max(state.P1, state.P2);\n        \n        // Scale factors\n        const scaleY = graphH / (maxP * 1.2); \n        const scaleX = graphW / 10.5;\n\n        // Plot Curve\n        ctx.beginPath();\n        ctx.strokeStyle = '#007bff';\n        ctx.lineWidth = 2;\n        \n        let startV = 0.1;\n        let endV = 10;\n        let step = 0.1;\n        \n        let first = true;\n        for (let v = startV; v <= endV; v += step) {\n            let p = C / Math.pow(v, state.gamma);\n            let x = padLeft + v * scaleX;\n            let y = (h - padBottom) - (p * scaleY);\n            \n            if (y < 0) y = -5;\n            \n            if (first) {\n                ctx.moveTo(x, y);\n                first = false;\n            } else {\n                ctx.lineTo(x, y);\n            }\n        }\n        ctx.stroke();\n\n        // Draw Points\n        function drawPoint(v, p, color, label) {\n            let x = padLeft + v * scaleX;\n            let y = (h - padBottom) - (p * scaleY);\n            \n            ctx.beginPath();\n            ctx.fillStyle = color;\n            ctx.arc(x, y, 5, 0, Math.PI * 2);\n            ctx.fill();\n            \n            ctx.fillStyle = '#000';\n            ctx.font = '10px sans-serif';\n            ctx.fillText(label, x + 8, y - 8);\n        }\n\n        drawPoint(state.V1, state.P1, '#999', '1');\n        drawPoint(state.V2, state.P2, '#ff0000', '2');\n    }\n\n    // Animation Loop\n    function loop() {\n        updatePhysics();\n        drawPistonSystem();\n        drawPVGraph();\n        requestAnimationFrame(loop);\n    }\n\n    // Event Listeners\n    Object.values(inputs).forEach(input => {\n        input.addEventListener('input', () => {\n            // physics updated in loop\n        });\n    });\n\n    // Start\n    loop();\n});"}}
{"input": {"input_text": "Isothermal reversible expansion of ideal gas from V1 to V2 at temperature T. Compute work done.", "simulation_name": " Isothermal Expansion Work", "domain": "Thermodynamics", "description": "Work of isothermal ideal gas expansion", "assumptions": ["Ideal gas", "Reversible"], "entities": [], "constants": [{"name": "gas_constant", "symbol": "R", "value": 8.314, "unit": "J/(mol*K)"}], "parameters": [{"name": "amount", "symbol": "n", "unit": "mol", "range": [0.01, 10]}, {"name": "temperature", "symbol": "T", "unit": "K", "range": [250, 700]}, {"name": "initial_volume", "symbol": "V1", "unit": "m^3", "range": [0.0001, 1]}, {"name": "final_volume", "symbol": "V2", "unit": "m^3", "range": [0.0001, 5]}], "equations": [{"description": "Work", "condition": "V2 > V1", "expression": "W = n*R*T*ln(V2/V1)"}], "initial_conditions": {}, "outputs": ["W"], "simulation_controls": ["n", "T", "V1", "V2"], "constraints": ["V1 > 0", "V2 > 0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S23 Isothermal Expansion Work</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1>Isothermal Expansion of Ideal Gas</h1>\n            <p class=\"subtitle\">Thermodynamics: Reversible Work Calculation</p>\n        </header>\n\n        <main>\n            <section class=\"controls-panel\">\n                <div class=\"card\">\n                    <h2>Parameters</h2>\n                    \n                    <div class=\"control-group\">\n                        <label for=\"amount\">Moles of Gas ($n$)</label>\n                        <div class=\"input-row\">\n                            <input type=\"range\" id=\"amount\" min=\"0.1\" max=\"10\" step=\"0.1\" value=\"1\">\n                            <span class=\"value-display\"><span id=\"amount-val\">1</span> mol</span>\n                        </div>\n                    </div>\n\n                    <div class=\"control-group\">\n                        <label for=\"temperature\">Temperature ($T$)</label>\n                        <div class=\"input-row\">\n                            <input type=\"range\" id=\"temperature\" min=\"250\" max=\"700\" step=\"10\" value=\"300\">\n                            <span class=\"value-display\"><span id=\"temp-val\">300</span> K</span>\n                        </div>\n                    </div>\n\n                    <div class=\"control-group\">\n                        <label for=\"v1\">Initial Volume ($V_1$)</label>\n                        <div class=\"input-row\">\n                            <input type=\"range\" id=\"v1\" min=\"0.1\" max=\"5.0\" step=\"0.1\" value=\"1.0\">\n                            <span class=\"value-display\"><span id=\"v1-val\">1.0</span> $m^3$</span>\n                        </div>\n                    </div>\n\n                    <div class=\"control-group\">\n                        <label for=\"v2\">Final Volume ($V_2$)</label>\n                        <div class=\"input-row\">\n                            <input type=\"range\" id=\"v2\" min=\"0.1\" max=\"5.0\" step=\"0.1\" value=\"2.0\">\n                            <span class=\"value-display\"><span id=\"v2-val\">2.0</span> $m^3$</span>\n                        </div>\n                    </div>\n\n                    <button id=\"animate-btn\" class=\"primary-btn\">Play Expansion Animation</button>\n                </div>\n\n                <div class=\"card results\">\n                    <h2>Calculated Work</h2>\n                    <div class=\"equation\">\n                        $$W = nRT \\ln\\left(\\frac{V_2}{V_1}\\right)$$\n                    </div>\n                    <div class=\"output-box\">\n                        <span class=\"label\">Work Done ($W$):</span>\n                        <span class=\"value\" id=\"work-output\">0</span>\n                        <span class=\"unit\">Joules</span>\n                    </div>\n                    <div class=\"output-sub\">\n                        <span class=\"label\">Gas Constant ($R$):</span>\n                        <span>8.314 J/(mol·K)</span>\n                    </div>\n                </div>\n            </section>\n\n            <section class=\"viz-panel\">\n                <div class=\"viz-card\">\n                    <h3>System Visualization</h3>\n                    <div class=\"piston-container\">\n                        <div class=\"cylinder\">\n                            <div class=\"gas-particles\" id=\"particles\"></div>\n                            <div class=\"piston\" id=\"piston\">\n                                <div class=\"piston-head\"></div>\n                                <div class=\"piston-rod\"></div>\n                            </div>\n                            <div class=\"volume-marker\" id=\"volume-marker\"></div>\n                        </div>\n                        <div class=\"axis-labels\">\n                            <span>0</span>\n                            <span>Volume ($m^3$)</span>\n                            <span>5.0</span>\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"viz-card\">\n                    <h3>P-V Diagram</h3>\n                    <div class=\"canvas-wrapper\">\n                        <canvas id=\"pv-graph\"></canvas>\n                    </div>\n                </div>\n            </section>\n        </main>\n    </div>\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary-color: #007BFF;\n    --secondary-color: #6c757d;\n    --success-color: #28a745;\n    --bg-color: #f8f9fa;\n    --card-bg: #ffffff;\n    --text-color: #333;\n}\n\n* {\n    box-sizing: border-box;\n    margin: 0;\n    padding: 0;\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n}\n\nbody {\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    line-height: 1.6;\n    padding: 20px;\n}\n\n.container {\n    max-width: 1200px;\n    margin: 0 auto;\n}\n\nheader {\n    margin-bottom: 2rem;\n    text-align: center;\n}\n\nheader h1 {\n    color: var(--primary-color);\n}\n\n.subtitle {\n    color: var(--secondary-color);\n}\n\nmain {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 20px;\n}\n\n@media (max-width: 768px) {\n    main {\n        grid-template-columns: 1fr;\n    }\n}\n\n/* Cards */\n.card, .viz-card {\n    background: var(--card-bg);\n    border-radius: 8px;\n    padding: 20px;\n    box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n    margin-bottom: 20px;\n}\n\nh2, h3 {\n    margin-bottom: 15px;\n    border-bottom: 2px solid #eee;\n    padding-bottom: 10px;\n    font-size: 1.2rem;\n}\n\n/* Controls */\n.control-group {\n    margin-bottom: 15px;\n}\n\n.control-group label {\n    display: block;\n    margin-bottom: 5px;\n    font-weight: 500;\n}\n\n.input-row {\n    display: flex;\n    align-items: center;\n    gap: 15px;\n}\n\ninput[type=\"range\"] {\n    flex-grow: 1;\n    cursor: pointer;\n}\n\n.value-display {\n    min-width: 80px;\n    text-align: right;\n    font-variant-numeric: tabular-nums;\n    font-weight: bold;\n    color: var(--primary-color);\n}\n\n.primary-btn {\n    display: block;\n    width: 100%;\n    padding: 12px;\n    background-color: var(--primary-color);\n    color: white;\n    border: none;\n    border-radius: 4px;\n    font-size: 1rem;\n    cursor: pointer;\n    transition: background 0.2s;\n    margin-top: 10px;\n}\n\n.primary-btn:hover {\n    background-color: #0056b3;\n}\n\n.primary-btn:disabled {\n    background-color: #ccc;\n    cursor: not-allowed;\n}\n\n/* Results */\n.equation {\n    text-align: center;\n    font-size: 1.1rem;\n    margin: 15px 0;\n    padding: 10px;\n    background: #f1f3f5;\n    border-radius: 4px;\n}\n\n.output-box {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 15px;\n    background-color: #e9ecef;\n    border-radius: 4px;\n    margin-bottom: 10px;\n}\n\n.output-box .value {\n    font-size: 1.5rem;\n    font-weight: bold;\n    color: var(--success-color);\n}\n\n.output-sub {\n    font-size: 0.9rem;\n    color: var(--secondary-color);\n    text-align: right;\n}\n\n/* Visualization - Piston */\n.piston-container {\n    height: 300px;\n    position: relative;\n    display: flex;\n    align-items: flex-end; \n    padding-left: 40px; \n}\n\n.cylinder {\n    position: relative;\n    width: 150px;\n    height: 100%; /* Represents Max Volume */\n    border: 4px solid #444;\n    border-top: none; \n    margin: 0 auto;\n    background-color: rgba(255, 255, 255, 0.5);\n    overflow: hidden;\n}\n\n/* Updated: Particles container is anchored to bottom and has variable height */\n.gas-particles {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    width: 100%;\n    /* Height is set by JS */\n    z-index: 1;\n    transition: background-color 0.3s;\n    overflow: hidden; /* Ensures particles don't bleed visually if bugged */\n}\n\n.particle {\n    position: absolute;\n    width: 6px;\n    height: 6px;\n    border-radius: 50%;\n    pointer-events: none;\n    /* Positions are percentages relative to gas-particles */\n}\n\n.piston {\n    position: absolute;\n    left: 0;\n    width: 100%;\n    height: 100%; \n    /* Top is set by JS. \n       We translate Y -100% of the head height (approx 20px) \n       so the head sits ON TOP of the gas volume, not inside it. */\n    transform: translateY(-20px); \n    z-index: 2;\n    pointer-events: none;\n    transition: top 0.1s linear;\n}\n\n.piston-head {\n    height: 20px;\n    background: linear-gradient(#999, #666);\n    border: 1px solid #444;\n    box-shadow: 0 2px 5px rgba(0,0,0,0.2);\n}\n\n.piston-rod {\n    width: 20px;\n    height: 100%; /* Long enough to go off screen */\n    background: #bbb;\n    margin: 0 auto;\n}\n\n.axis-labels {\n    position: absolute;\n    right: 20px;\n    top: 0;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n    font-size: 0.8rem;\n    color: #666;\n    padding-top: 10px;\n}\n\n/* Graph */\n.canvas-wrapper {\n    width: 100%;\n    height: 300px;\n    background: #fff;\n    border: 1px solid #ddd;\n}", "js": "// Constants\nconst R = 8.314; // J/(mol*K)\n\n// DOM Elements\nconst inputs = {\n    n: document.getElementById('amount'),\n    T: document.getElementById('temperature'),\n    v1: document.getElementById('v1'),\n    v2: document.getElementById('v2')\n};\n\nconst displays = {\n    n: document.getElementById('amount-val'),\n    T: document.getElementById('temp-val'),\n    v1: document.getElementById('v1-val'),\n    v2: document.getElementById('v2-val'),\n    w: document.getElementById('work-output')\n};\n\nconst piston = document.getElementById('piston');\nconst particlesContainer = document.getElementById('particles');\nconst canvas = document.getElementById('pv-graph');\nconst ctx = canvas.getContext('2d');\nconst animateBtn = document.getElementById('animate-btn');\n\n// State\nlet state = {\n    n: parseFloat(inputs.n.value),\n    T: parseFloat(inputs.T.value),\n    v1: parseFloat(inputs.v1.value),\n    v2: parseFloat(inputs.v2.value),\n    currentV: parseFloat(inputs.v1.value)\n};\n\nlet isAnimating = false;\nlet particles = [];\n\nfunction resizeCanvas() {\n    const parent = canvas.parentElement;\n    canvas.width = parent.clientWidth;\n    canvas.height = parent.clientHeight;\n    drawGraph();\n}\nwindow.addEventListener('resize', resizeCanvas);\n\n// --- Particles Logic ---\nfunction initParticles() {\n    particles = [];\n    for(let i=0; i<30; i++) {\n        particles.push({\n            x: Math.random() * 100, \n            y: Math.random() * 100, \n            vx: (Math.random() - 0.5) * 1.5,\n            vy: (Math.random() - 0.5) * 1.5\n        });\n    }\n}\n\nfunction updateParticles() {\n    const speedFactor = (state.T / 300) * 0.8;\n    \n    particles.forEach(p => {\n        p.x += p.vx * speedFactor;\n        p.y += p.vy * speedFactor;\n\n        // Bounce horizontally\n        if (p.x <= 0 || p.x >= 100) p.vx *= -1;\n        \n        // Bounce vertically\n        // Since the particle container RESIZES with volume, \n        // 0% is always the piston face and 100% is always the bottom.\n        if (p.y <= 0 || p.y >= 100) p.vy *= -1;\n    });\n\n    // Render\n    particlesContainer.innerHTML = '';\n    particles.forEach(p => {\n        const div = document.createElement('div');\n        div.className = 'particle';\n        div.style.left = `${p.x}%`;\n        div.style.top = `${p.y}%`;\n        const hue = Math.max(0, 240 - (state.T - 250) * (240/450)); \n        div.style.backgroundColor = `hsl(${hue}, 70%, 50%)`;\n        particlesContainer.appendChild(div);\n    });\n}\n\n// --- Physics & Visualization Logic ---\n\nfunction calculateWork() {\n    if (state.v1 <= 0) return 0;\n    const work = state.n * R * state.T * Math.log(state.v2 / state.v1);\n    return work;\n}\n\nfunction updatePiston(vol) {\n    const maxV = 5.0;\n    // Calculate percentage height of the GAS\n    const percentage = (vol / maxV) * 100;\n    const clampedPct = Math.max(0, Math.min(100, percentage));\n    \n    // 1. Move the Piston\n    // The piston 'top' corresponds to the empty space above the gas.\n    piston.style.top = `${100 - clampedPct}%`;\n    \n    // 2. Resize the Gas Container\n    // This physically traps the particles between bottom (100%) and piston (0% of this div)\n    particlesContainer.style.height = `${clampedPct}%`;\n    \n    // Update Gas color/opacity\n    const hue = Math.max(0, 240 - (state.T - 250) * (240/450));\n    particlesContainer.style.backgroundColor = `hsla(${hue}, 70%, 90%, 0.3)`;\n}\n\nfunction drawGraph() {\n    const width = canvas.width;\n    const height = canvas.height;\n    ctx.clearRect(0, 0, width, height);\n\n    const padding = 40;\n    const graphW = width - 2 * padding;\n    const graphH = height - 2 * padding;\n\n    // Fixed Scales for stability\n    const yMax = (10 * R * 700) / 0.5; // Max plausible P\n    const xMax = 5.5;\n\n    function mapX(v) { return padding + (v / xMax) * graphW; }\n    function mapY(p) { return (height - padding) - (p / yMax) * graphH; }\n\n    // Axes\n    ctx.beginPath();\n    ctx.strokeStyle = '#333';\n    ctx.lineWidth = 2;\n    ctx.moveTo(padding, padding);\n    ctx.lineTo(padding, height - padding);\n    ctx.lineTo(width - padding, height - padding);\n    ctx.stroke();\n\n    ctx.fillStyle = '#666';\n    ctx.font = '12px Arial';\n    ctx.fillText(\"Pressure (P)\", padding + 10, padding + 10);\n    ctx.fillText(\"Volume (V)\", width - padding - 60, height - padding - 10);\n\n    // Isotherm Curve\n    ctx.beginPath();\n    ctx.strokeStyle = '#007BFF';\n    ctx.lineWidth = 2;\n    \n    let startV = 0.1;\n    for (let v = startV; v <= 5.0; v += 0.05) {\n        const p = (state.n * R * state.T) / v;\n        const x = mapX(v);\n        const y = mapY(p);\n        if (v === startV) ctx.moveTo(x, y);\n        else ctx.lineTo(x, y);\n    }\n    ctx.stroke();\n\n    // Area Fill\n    const endFillV = isAnimating ? state.currentV : state.v2;\n    const lower = Math.min(state.v1, endFillV);\n    const upper = Math.max(state.v1, endFillV);\n    \n    if (upper > lower) {\n        ctx.beginPath();\n        ctx.fillStyle = 'rgba(0, 123, 255, 0.3)';\n        for (let v = lower; v <= upper; v += 0.05) {\n            const p = (state.n * R * state.T) / v;\n            ctx.lineTo(mapX(v), mapY(p));\n        }\n        ctx.lineTo(mapX(upper), mapY(0)); \n        ctx.lineTo(mapX(lower), mapY(0));\n        const pStart = (state.n * R * state.T) / lower;\n        ctx.lineTo(mapX(lower), mapY(pStart));\n        ctx.fill();\n    }\n    \n    function drawPoint(v, label, color) {\n        const p = (state.n * R * state.T) / v;\n        const x = mapX(v);\n        const y = mapY(p);\n        ctx.beginPath();\n        ctx.fillStyle = color;\n        ctx.arc(x, y, 4, 0, Math.PI*2);\n        ctx.fill();\n        ctx.fillStyle = '#000';\n        ctx.fillText(label, x + 5, y - 5);\n    }\n\n    drawPoint(state.v1, 'V1', '#28a745');\n    if (isAnimating) drawPoint(state.currentV, '', '#dc3545'); \n    else drawPoint(state.v2, 'V2', '#dc3545');\n}\n\n// --- Interaction ---\nfunction updateDisplay() {\n    displays.n.textContent = state.n;\n    displays.T.textContent = state.T;\n    displays.v1.textContent = state.v1;\n    displays.v2.textContent = state.v2;\n    \n    const work = calculateWork();\n    displays.w.textContent = work.toFixed(2);\n    \n    if (!isAnimating) {\n        // Show V2 state when idle\n        updatePiston(state.v2);\n    }\n    drawGraph();\n}\n\nfunction handleInput(e) {\n    const id = e.target.id;\n    const val = parseFloat(e.target.value);\n    \n    state[id === 'amount' ? 'n' : id === 'temperature' ? 'T' : id] = val;\n    \n    if (isAnimating) {\n        isAnimating = false;\n        cancelAnimationFrame(animationReq);\n        animateBtn.disabled = false;\n        animateBtn.textContent = \"Play Expansion Animation\";\n    }\n    updateDisplay();\n}\n\nObject.values(inputs).forEach(input => {\n    input.addEventListener('input', handleInput);\n});\n\n// Animation Loop\nlet animationReq;\nanimateBtn.addEventListener('click', () => {\n    if (isAnimating) return;\n    \n    isAnimating = true;\n    animateBtn.disabled = true;\n    animateBtn.textContent = \"Simulating...\";\n    \n    state.currentV = state.v1;\n    const targetV = state.v2;\n    const duration = 2000; \n    const startTime = performance.now();\n    \n    function step(time) {\n        if (!isAnimating) return;\n        const elapsed = time - startTime;\n        const progress = Math.min(elapsed / duration, 1);\n        \n        // Ease out\n        const ease = 1 - Math.pow(1 - progress, 3);\n        state.currentV = state.v1 + (targetV - state.v1) * ease;\n        \n        updatePiston(state.currentV);\n        drawGraph();\n        \n        if (progress < 1) {\n            animationReq = requestAnimationFrame(step);\n        } else {\n            isAnimating = false;\n            animateBtn.disabled = false;\n            animateBtn.textContent = \"Play Expansion Animation\";\n        }\n    }\n    animationReq = requestAnimationFrame(step);\n});\n\ninitParticles();\nsetInterval(updateParticles, 50);\nresizeCanvas();\nupdateDisplay();"}}
{"input": {"input_text": "Entropy change for ideal gas heated from T1 to T2 at constant volume. Compute deltaS.", "simulation_name": " Ideal Gas Entropy", "domain": "Thermodynamics", "description": "Cv-based entropy change", "assumptions": ["Constant Cv"], "entities": [], "constants": [], "parameters": [{"name": "heat_capacity_cv", "symbol": "Cv", "unit": "J/(mol*K)", "range": [10, 40]}, {"name": "temperature1", "symbol": "T1", "unit": "K", "range": [200, 600]}, {"name": "temperature2", "symbol": "T2", "unit": "K", "range": [250, 1200]}, {"name": "amount", "symbol": "n", "unit": "mol", "range": [0.01, 10]}], "equations": [{"description": "Entropy change", "condition": "T2 > 0", "expression": "DeltaS = n*Cv*ln(T2/T1)"}], "initial_conditions": {}, "outputs": ["DeltaS"], "simulation_controls": ["Cv", "T1", "T2", "n"], "constraints": ["T1 > 0", "T2 > 0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Ideal Gas Entropy Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1>Ideal Gas Entropy Change ($$\\Delta S$$)</h1>\n            <p>Constant Volume Process</p>\n        </header>\n\n        <main class=\"simulation-layout\">\n            <section class=\"controls\">\n                <div class=\"input-group\">\n                    <label for=\"amount\">Amount ($$n$$) <span id=\"val-n\">1.0</span> mol</label>\n                    <input type=\"range\" id=\"amount\" min=\"0.01\" max=\"10\" step=\"0.1\" value=\"1.0\">\n                </div>\n                \n                <div class=\"input-group\">\n                    <label for=\"cv\">Heat Capacity ($$C_v$$) <span id=\"val-cv\">25</span> J/(mol·K)</label>\n                    <input type=\"range\" id=\"cv\" min=\"10\" max=\"40\" step=\"1\" value=\"25\">\n                </div>\n\n                <div class=\"input-group\">\n                    <label for=\"t1\">Initial Temp ($$T_1$$) <span id=\"val-t1\">300</span> K</label>\n                    <input type=\"range\" id=\"t1\" min=\"200\" max=\"600\" step=\"10\" value=\"300\">\n                </div>\n\n                <div class=\"input-group\">\n                    <label for=\"t2\">Final Temp ($$T_2$$) <span id=\"val-t2\">600</span> K</label>\n                    <input type=\"range\" id=\"t2\" min=\"250\" max=\"1200\" step=\"10\" value=\"600\">\n                </div>\n\n                <div class=\"control-buttons\">\n                    <button id=\"btn-reset\">Reset</button>\n                    <button id=\"btn-animate\" class=\"primary-btn\">Heat Gas ($$T_1 \\to T_2$$)</button>\n                </div>\n\n                <div class=\"formula-box\">\n                    <h3>Formula</h3>\n                    <p>$$ \\Delta S = n C_v \\ln\\left(\\frac{T_2}{T_1}\\right) $$</p>\n                </div>\n            </section>\n\n            <section class=\"visuals\">\n                <div class=\"canvas-container\">\n                    <div class=\"overlay-info\">\n                        <div>Current T: <span id=\"current-temp\">300</span> K</div>\n                    </div>\n                    <canvas id=\"gasCanvas\"></canvas>\n                </div>\n                \n                <div class=\"results-panel\">\n                    <div class=\"result-card\">\n                        <span class=\"label\">Total Entropy Change ($$\\Delta S$$)</span>\n                        <span class=\"value\" id=\"result-ds\">0.00 J/K</span>\n                    </div>\n                    <div class=\"progress-container\">\n                        <div class=\"progress-bar\" id=\"temp-progress\"></div>\n                    </div>\n                </div>\n            </section>\n        </main>\n    </div>\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary-color: #3a86ff;\n    --secondary-color: #2c3e50;\n    --accent-color: #ff006e;\n    --bg-color: #f8f9fa;\n    --panel-bg: #ffffff;\n    --text-color: #333;\n    --border-radius: 8px;\n    --shadow: 0 4px 6px rgba(0,0,0,0.1);\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    margin: 0;\n    padding: 20px;\n    height: 100vh;\n    box-sizing: border-box;\n    display: flex;\n    justify-content: center;\n}\n\n.container {\n    max-width: 1200px;\n    width: 100%;\n    background: var(--panel-bg);\n    border-radius: var(--border-radius);\n    box-shadow: var(--shadow);\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n}\n\nheader {\n    background: var(--secondary-color);\n    color: white;\n    padding: 15px 25px;\n    text-align: center;\n}\n\nheader h1 {\n    margin: 0;\n    font-size: 1.5rem;\n}\n\nheader p {\n    margin: 5px 0 0;\n    font-size: 0.9rem;\n    opacity: 0.8;\n}\n\n.simulation-layout {\n    display: flex;\n    flex: 1;\n    overflow: hidden;\n}\n\n/* Controls Styling */\n.controls {\n    width: 300px;\n    padding: 20px;\n    background: #f1f3f5;\n    border-right: 1px solid #ddd;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n    overflow-y: auto;\n}\n\n.input-group {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.input-group label {\n    font-weight: 600;\n    font-size: 0.9rem;\n    display: flex;\n    justify-content: space-between;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    cursor: pointer;\n}\n\n.control-buttons {\n    display: flex;\n    gap: 10px;\n    margin-top: 10px;\n}\n\nbutton {\n    flex: 1;\n    padding: 10px;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-weight: 600;\n    transition: background 0.2s;\n}\n\n#btn-reset {\n    background: #e9ecef;\n    color: #495057;\n}\n\n#btn-reset:hover {\n    background: #dee2e6;\n}\n\n.primary-btn {\n    background: var(--primary-color);\n    color: white;\n}\n\n.primary-btn:hover {\n    background: #2563eb;\n}\n\n.formula-box {\n    margin-top: auto;\n    padding: 15px;\n    background: white;\n    border-radius: 4px;\n    border: 1px solid #ddd;\n    text-align: center;\n}\n\n.formula-box h3 {\n    margin: 0 0 10px;\n    font-size: 1rem;\n    color: var(--secondary-color);\n}\n\n/* Visuals Styling */\n.visuals {\n    flex: 1;\n    padding: 20px;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.canvas-container {\n    flex: 1;\n    position: relative;\n    background: #000;\n    border-radius: var(--border-radius);\n    overflow: hidden;\n    box-shadow: inset 0 0 20px rgba(0,0,0,0.5);\n}\n\ncanvas {\n    display: block;\n    width: 100%;\n    height: 100%;\n}\n\n.overlay-info {\n    position: absolute;\n    top: 15px;\n    left: 15px;\n    background: rgba(0, 0, 0, 0.7);\n    color: #fff;\n    padding: 8px 12px;\n    border-radius: 4px;\n    font-family: monospace;\n    font-size: 1.1rem;\n    border: 1px solid #444;\n}\n\n.results-panel {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.result-card {\n    background: var(--primary-color);\n    color: white;\n    padding: 15px;\n    border-radius: var(--border-radius);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    font-size: 1.2rem;\n}\n\n.result-card .value {\n    font-weight: bold;\n    font-size: 1.5rem;\n}\n\n.progress-container {\n    height: 6px;\n    background: #e9ecef;\n    border-radius: 3px;\n    overflow: hidden;\n}\n\n.progress-bar {\n    height: 100%;\n    width: 0%;\n    background: linear-gradient(90deg, var(--primary-color), var(--accent-color));\n    transition: width 0.1s linear;\n}\n\n@media (max-width: 768px) {\n    .simulation-layout {\n        flex-direction: column;\n        overflow-y: auto;\n    }\n    .controls {\n        width: auto;\n        border-right: none;\n        border-bottom: 1px solid #ddd;\n    }\n    .canvas-container {\n        min-height: 300px;\n    }\n}", "js": "document.addEventListener('DOMContentLoaded', () => {\n    // --- Configuration & State ---\n    const canvas = document.getElementById('gasCanvas');\n    const ctx = canvas.getContext('2d');\n    \n    // Inputs\n    const inputs = {\n        n: document.getElementById('amount'),\n        cv: document.getElementById('cv'),\n        t1: document.getElementById('t1'),\n        t2: document.getElementById('t2')\n    };\n\n    // Displays\n    const displays = {\n        n: document.getElementById('val-n'),\n        cv: document.getElementById('val-cv'),\n        t1: document.getElementById('val-t1'),\n        t2: document.getElementById('val-t2'),\n        currentTemp: document.getElementById('current-temp'),\n        resultDs: document.getElementById('result-ds'),\n        progressBar: document.getElementById('temp-progress')\n    };\n\n    let simulationState = {\n        n: parseFloat(inputs.n.value),\n        cv: parseFloat(inputs.cv.value),\n        t1: parseFloat(inputs.t1.value),\n        t2: parseFloat(inputs.t2.value),\n        currentTemp: parseFloat(inputs.t1.value),\n        isAnimating: false,\n        animationProgress: 0 // 0 to 1\n    };\n\n    let particles = [];\n    let animationFrameId;\n\n    // --- Particle System ---\n    class Particle {\n        constructor(width, height) {\n            this.x = Math.random() * width;\n            this.y = Math.random() * height;\n            this.vx = (Math.random() - 0.5);\n            this.vy = (Math.random() - 0.5);\n            this.radius = 3;\n            // Normalize initial vector\n            const mag = Math.sqrt(this.vx**2 + this.vy**2);\n            this.vx /= mag; \n            this.vy /= mag;\n        }\n\n        update(temp, width, height) {\n            // Speed is proportional to sqrt(T)\n            // Base speed multiplier for visualization\n            const speed = Math.sqrt(temp) * 0.15; \n            \n            this.x += this.vx * speed;\n            this.y += this.vy * speed;\n\n            // Wall collision\n            if (this.x - this.radius < 0) {\n                this.x = this.radius;\n                this.vx *= -1;\n            } else if (this.x + this.radius > width) {\n                this.x = width - this.radius;\n                this.vx *= -1;\n            }\n\n            if (this.y - this.radius < 0) {\n                this.y = this.radius;\n                this.vy *= -1;\n            } else if (this.y + this.radius > height) {\n                this.y = height - this.radius;\n                this.vy *= -1;\n            }\n        }\n\n        draw(ctx, temp) {\n            ctx.beginPath();\n            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);\n            \n            // Color based on temperature (Blue -> Red)\n            // Normalize temp between 200 and 1200 for color mapping\n            const tRatio = Math.min(Math.max((temp - 200) / 1000, 0), 1);\n            const r = Math.floor(tRatio * 255);\n            const b = Math.floor((1 - tRatio) * 255);\n            \n            ctx.fillStyle = `rgb(${r}, 50, ${b})`;\n            ctx.fill();\n            ctx.closePath();\n        }\n    }\n\n    function initParticles() {\n        const width = canvas.width;\n        const height = canvas.height;\n        particles = [];\n        // Scale particle count: 1 mol = 50 particles for visualization\n        const count = Math.max(10, Math.floor(simulationState.n * 50));\n        \n        for (let i = 0; i < count; i++) {\n            particles.push(new Particle(width, height));\n        }\n    }\n\n    // --- Physics & Calc ---\n    function calculateDeltaS() {\n        // DeltaS = n * Cv * ln(T2/T1)\n        // However, during animation, we calculate Delta S from T1 to CurrentTemp\n        const tStart = simulationState.t1;\n        const tCurrent = simulationState.currentTemp;\n        \n        if (tCurrent <= 0 || tStart <= 0) return 0;\n\n        const ds = simulationState.n * simulationState.cv * Math.log(tCurrent / tStart);\n        return ds;\n    }\n\n    // --- Render Loop ---\n    function resizeCanvas() {\n        const rect = canvas.parentElement.getBoundingClientRect();\n        canvas.width = rect.width;\n        canvas.height = rect.height;\n    }\n\n    function draw() {\n        ctx.fillStyle = 'rgba(0, 0, 0, 0.2)'; // Trail effect\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n        particles.forEach(p => {\n            p.update(simulationState.currentTemp, canvas.width, canvas.height);\n            p.draw(ctx, simulationState.currentTemp);\n        });\n\n        // Update Text\n        displays.currentTemp.textContent = simulationState.currentTemp.toFixed(0);\n        \n        const ds = calculateDeltaS();\n        displays.resultDs.textContent = `${ds.toFixed(2)} J/K`;\n\n        animationFrameId = requestAnimationFrame(draw);\n    }\n\n    // --- Interaction ---\n    function updateInputs() {\n        simulationState.n = parseFloat(inputs.n.value);\n        simulationState.cv = parseFloat(inputs.cv.value);\n        simulationState.t1 = parseFloat(inputs.t1.value);\n        simulationState.t2 = parseFloat(inputs.t2.value);\n\n        displays.n.textContent = simulationState.n;\n        displays.cv.textContent = simulationState.cv;\n        displays.t1.textContent = simulationState.t1;\n        displays.t2.textContent = simulationState.t2;\n\n        if (!simulationState.isAnimating) {\n            // If not animating, reset to T1\n            simulationState.currentTemp = simulationState.t1;\n            displays.progressBar.style.width = '0%';\n            \n            // Re-init particles if amount changes\n            const idealCount = Math.max(10, Math.floor(simulationState.n * 50));\n            if (Math.abs(particles.length - idealCount) > 5) {\n                initParticles();\n            }\n        }\n    }\n\n    function animateTemperatureTransition() {\n        if (simulationState.isAnimating) return;\n        \n        simulationState.isAnimating = true;\n        const startT = simulationState.t1;\n        const endT = simulationState.t2;\n        const duration = 2000; // 2 seconds\n        const startTime = performance.now();\n\n        function step(currentTime) {\n            const elapsed = currentTime - startTime;\n            const progress = Math.min(elapsed / duration, 1);\n            \n            // Linear interpolation\n            simulationState.currentTemp = startT + (endT - startT) * progress;\n            displays.progressBar.style.width = `${progress * 100}%`;\n\n            if (progress < 1) {\n                requestAnimationFrame(step);\n            } else {\n                simulationState.isAnimating = false;\n            }\n        }\n        requestAnimationFrame(step);\n    }\n\n    function resetSimulation() {\n        simulationState.isAnimating = false;\n        simulationState.currentTemp = simulationState.t1;\n        displays.progressBar.style.width = '0%';\n        updateInputs(); // resets displays\n        initParticles();\n    }\n\n    // --- Event Listeners ---\n    Object.values(inputs).forEach(input => {\n        input.addEventListener('input', () => {\n            // Stop any ongoing animation if user touches controls\n            simulationState.isAnimating = false; \n            updateInputs();\n        });\n    });\n\n    document.getElementById('btn-animate').addEventListener('click', animateTemperatureTransition);\n    \n    document.getElementById('btn-reset').addEventListener('click', () => {\n        // Reset Inputs to defaults\n        inputs.n.value = 1.0;\n        inputs.cv.value = 25;\n        inputs.t1.value = 300;\n        inputs.t2.value = 600;\n        resetSimulation();\n    });\n\n    window.addEventListener('resize', () => {\n        resizeCanvas();\n        initParticles();\n    });\n\n    // --- Initialization ---\n    resizeCanvas();\n    updateInputs();\n    initParticles();\n    draw();\n});"}}
{"input": {"input_text": "First-order reaction A -> products in batch reactor: C = C0*exp(-k*t). Compute concentration over time.", "simulation_name": " First Order Reaction", "domain": "Chemical Engineering", "description": "Batch first-order decay", "assumptions": ["Isothermal", "Well-mixed"], "entities": [], "constants": [], "parameters": [{"name": "initial_concentration", "symbol": "C0", "unit": "mol/L", "range": [0.001, 5]}, {"name": "rate_constant", "symbol": "k", "unit": "1/s", "range": [1e-05, 1]}, {"name": "time", "symbol": "t", "unit": "s", "range": [0, 1000000.0]}], "equations": [{"description": "Concentration", "expression": "C(t) = C0*exp(-k*t)"}], "initial_conditions": {"C": "C0", "t": 0}, "outputs": ["C"], "simulation_controls": ["C0", "k", "t"], "constraints": ["C0 >= 0", "k >= 0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S25 First Order Reaction Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n\n    <div class=\"container\">\n        <header>\n            <h1>First-Order Reaction Decay</h1>\n            <p>Simulation of Batch Reactor Kinetics: $C(t) = C_0 \\cdot e^{-kt}$</p>\n        </header>\n\n        <main class=\"simulation-grid\">\n            <section class=\"panel controls\">\n                <h2>Parameters</h2>\n                \n                <div class=\"control-group\">\n                    <label for=\"c0-slider\">\n                        Initial Concentration ($C_0$)\n                        <span class=\"value-display\" id=\"c0-val\">1.00</span> <span class=\"unit\">mol/L</span>\n                    </label>\n                    <input type=\"range\" id=\"c0-slider\" min=\"0.1\" max=\"5\" step=\"0.1\" value=\"2.5\">\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"k-slider\">\n                        Rate Constant ($k$)\n                        <span class=\"value-display\" id=\"k-val\">0.10</span> <span class=\"unit\">1/s</span>\n                    </label>\n                    <input type=\"range\" id=\"k-slider\" min=\"0.01\" max=\"1\" step=\"0.01\" value=\"0.1\">\n                </div>\n\n                <div class=\"control-buttons\">\n                    <button id=\"btn-start\">Start</button>\n                    <button id=\"btn-pause\">Pause</button>\n                    <button id=\"btn-reset\">Reset</button>\n                </div>\n\n                <div class=\"stats\">\n                    <h3>Current State</h3>\n                    <div class=\"stat-row\">\n                        <span>Time ($t$):</span>\n                        <span id=\"time-display\">0.00 s</span>\n                    </div>\n                    <div class=\"stat-row\">\n                        <span>Conc. ($C$):</span>\n                        <span id=\"conc-display\">0.00 mol/L</span>\n                    </div>\n                </div>\n            </section>\n\n            <section class=\"panel visualization\">\n                <h2>Reactor View</h2>\n                <div class=\"reactor-container\">\n                    <div class=\"beaker\">\n                        <div class=\"liquid\" id=\"liquid-visual\">\n                            <div class=\"bubbles\"></div>\n                            <div class=\"bubbles\"></div>\n                            <div class=\"bubbles\"></div>\n                        </div>\n                        <div class=\"measurements\">\n                            <span>-</span>\n                            <span>-</span>\n                            <span>-</span>\n                        </div>\n                    </div>\n                </div>\n                <p class=\"vis-caption\">Opacity indicates concentration</p>\n            </section>\n\n            <section class=\"panel graph-panel\">\n                <h2>Concentration vs. Time</h2>\n                <div class=\"canvas-wrapper\">\n                    <canvas id=\"reactionChart\"></canvas>\n                </div>\n            </section>\n        </main>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary: #3b82f6;\n    --primary-dark: #1e40af;\n    --bg-color: #f3f4f6;\n    --panel-bg: #ffffff;\n    --text-color: #1f2937;\n    --accent: #10b981;\n    --liquid-color: 59, 130, 246; /* RGB for blue */\n}\n\n* {\n    box-sizing: border-box;\n    margin: 0;\n    padding: 0;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    line-height: 1.6;\n    padding: 20px;\n}\n\n.container {\n    max-width: 1200px;\n    margin: 0 auto;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 30px;\n}\n\nheader h1 {\n    color: var(--primary-dark);\n}\n\n.simulation-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr 1fr;\n    gap: 20px;\n}\n\n@media (max-width: 900px) {\n    .simulation-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n.panel {\n    background: var(--panel-bg);\n    padding: 20px;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n    display: flex;\n    flex-direction: column;\n}\n\nh2 {\n    font-size: 1.2rem;\n    margin-bottom: 15px;\n    border-bottom: 2px solid var(--bg-color);\n    padding-bottom: 10px;\n}\n\n/* Controls */\n.control-group {\n    margin-bottom: 20px;\n}\n\nlabel {\n    display: block;\n    font-weight: 600;\n    margin-bottom: 8px;\n    font-size: 0.9rem;\n}\n\n.value-display {\n    color: var(--primary);\n    font-family: monospace;\n    font-size: 1.1rem;\n}\n\ninput[type=range] {\n    width: 100%;\n    cursor: pointer;\n}\n\n.control-buttons {\n    display: flex;\n    gap: 10px;\n    margin-bottom: 20px;\n}\n\nbutton {\n    flex: 1;\n    padding: 10px;\n    border: none;\n    border-radius: 6px;\n    background-color: var(--primary);\n    color: white;\n    font-weight: bold;\n    cursor: pointer;\n    transition: background 0.2s;\n}\n\nbutton:hover {\n    background-color: var(--primary-dark);\n}\n\n#btn-pause { background-color: #f59e0b; }\n#btn-reset { background-color: #ef4444; }\n\n.stats {\n    background: var(--bg-color);\n    padding: 15px;\n    border-radius: 8px;\n    margin-top: auto;\n}\n\n.stat-row {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 5px;\n    font-weight: 500;\n}\n\n/* Reactor Visualization */\n.visualization {\n    align-items: center;\n    justify-content: center;\n}\n\n.reactor-container {\n    height: 300px;\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: flex-end;\n    padding-bottom: 20px;\n}\n\n.beaker {\n    width: 150px;\n    height: 200px;\n    border-left: 4px solid #aaa;\n    border-right: 4px solid #aaa;\n    border-bottom: 4px solid #aaa;\n    border-radius: 0 0 10px 10px;\n    position: relative;\n    background: rgba(255,255,255,0.5);\n    overflow: hidden;\n}\n\n.liquid {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    width: 100%;\n    height: 80%; /* Initial fill */\n    background-color: rgba(var(--liquid-color), 1);\n    transition: background-color 0.1s;\n    display: flex;\n    justify-content: center;\n}\n\n/* Bubbles Animation */\n.bubbles {\n    width: 10px;\n    height: 10px;\n    background: rgba(255,255,255,0.3);\n    border-radius: 50%;\n    position: absolute;\n    bottom: -10px;\n    animation: rise 2s infinite ease-in;\n}\n\n.bubbles:nth-child(1) { left: 20%; animation-duration: 2.5s; animation-delay: 0s; }\n.bubbles:nth-child(2) { left: 50%; animation-duration: 3s; animation-delay: 1s; }\n.bubbles:nth-child(3) { left: 80%; animation-duration: 2.2s; animation-delay: 0.5s; }\n\n@keyframes rise {\n    0% { bottom: -10px; opacity: 0; }\n    50% { opacity: 1; }\n    100% { bottom: 100%; opacity: 0; }\n}\n\n.measurements {\n    position: absolute;\n    right: 5px;\n    top: 0;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-evenly;\n    align-items: flex-end;\n    color: #666;\n    font-size: 20px;\n}\n\n.vis-caption {\n    font-size: 0.8rem;\n    color: #666;\n    margin-top: 10px;\n}\n\n/* Graph */\n.canvas-wrapper {\n    width: 100%;\n    height: 300px;\n    position: relative;\n}\n\ncanvas {\n    width: 100%;\n    height: 100%;\n}", "js": "/**\n * S25 First Order Reaction Simulation\n * Physics: C(t) = C0 * exp(-k * t)\n */\n\n// Configuration State\nconst state = {\n    c0: 2.5,          // Initial Concentration (mol/L)\n    k: 0.1,           // Rate constant (1/s)\n    currentTime: 0,   // Current simulation time (s)\n    isRunning: false,\n    animationId: null,\n    maxTime: 60       // Dynamic max time for graph scaling (5 * tau)\n};\n\n// DOM Elements\nconst ui = {\n    c0Slider: document.getElementById('c0-slider'),\n    c0Val: document.getElementById('c0-val'),\n    kSlider: document.getElementById('k-slider'),\n    kVal: document.getElementById('k-val'),\n    timeDisplay: document.getElementById('time-display'),\n    concDisplay: document.getElementById('conc-display'),\n    liquid: document.getElementById('liquid-visual'),\n    canvas: document.getElementById('reactionChart'),\n    btnStart: document.getElementById('btn-start'),\n    btnPause: document.getElementById('btn-pause'),\n    btnReset: document.getElementById('btn-reset')\n};\n\n// Canvas Context\nconst ctx = ui.canvas.getContext('2d');\n\n/**\n * Initialize Simulation\n */\nfunction init() {\n    // Set Canvas Resolution\n    resizeCanvas();\n    window.addEventListener('resize', resizeCanvas);\n\n    // Event Listeners\n    ui.c0Slider.addEventListener('input', (e) => updateParams('c0', parseFloat(e.target.value)));\n    ui.kSlider.addEventListener('input', (e) => updateParams('k', parseFloat(e.target.value)));\n    \n    ui.btnStart.addEventListener('click', startSimulation);\n    ui.btnPause.addEventListener('click', pauseSimulation);\n    ui.btnReset.addEventListener('click', resetSimulation);\n\n    // Initial render\n    updateParams('c0', state.c0);\n    updateParams('k', state.k);\n    resetSimulation();\n}\n\n/**\n * Update parameters from UI\n */\nfunction updateParams(key, value) {\n    state[key] = value;\n    \n    // Update text displays\n    if (key === 'c0') ui.c0Val.innerText = value.toFixed(2);\n    if (key === 'k') ui.kVal.innerText = value.toFixed(2);\n\n    // Recalculate interesting time domain (5 time constants)\n    // tau = 1/k. 99% reaction complete by 5*tau.\n    state.maxTime = Math.max(10, 5 * (1 / state.k));\n\n    // If simulation is idle (t=0), update displays immediately without running\n    if (state.currentTime === 0 && !state.isRunning) {\n        updateVisuals();\n        drawChart();\n    } \n    // If running, the loop handles it. If paused, we redraw chart to show new path prediction\n    else if (!state.isRunning) {\n        drawChart();\n    }\n}\n\nfunction resizeCanvas() {\n    // scale for retina displays\n    const dpr = window.devicePixelRatio || 1;\n    const rect = ui.canvas.parentElement.getBoundingClientRect();\n    ui.canvas.width = rect.width * dpr;\n    ui.canvas.height = rect.height * dpr;\n    ctx.scale(dpr, dpr);\n    // Store logical size for drawing\n    state.canvasWidth = rect.width;\n    state.canvasHeight = rect.height;\n    drawChart();\n}\n\n/**\n * Core Physics Equation\n */\nfunction calculateConcentration(t) {\n    return state.c0 * Math.exp(-state.k * t);\n}\n\n/**\n * Simulation Loop\n */\nlet lastFrameTime = 0;\n\nfunction loop(timestamp) {\n    if (!state.isRunning) return;\n\n    if (!lastFrameTime) lastFrameTime = timestamp;\n    const deltaTime = (timestamp - lastFrameTime) / 1000; // seconds\n    lastFrameTime = timestamp;\n\n    // Advance time\n    // We speed up simulation time slightly for better UX if k is very small, \n    // but for this specific \"1/s\" unit range, real-time or 1x speed is usually fine.\n    // Let's use a dynamic speed factor based on k to ensure the user sees progress.\n    // If k is 0.01, reaction takes 500s. We don't want to wait 500s.\n    // Let's scale time so 5*tau takes about 10 real seconds.\n    const simulationDuration = 5 / state.k; \n    const realDuration = 10; // we want animation to finish in ~10 seconds\n    const timeScale = simulationDuration / realDuration;\n\n    state.currentTime += deltaTime * timeScale;\n\n    // Check bounds\n    if (state.currentTime > state.maxTime) {\n        state.currentTime = state.maxTime;\n        pauseSimulation();\n    }\n\n    updateVisuals();\n    drawChart();\n\n    state.animationId = requestAnimationFrame(loop);\n}\n\nfunction startSimulation() {\n    if (state.isRunning) return;\n    state.isRunning = true;\n    lastFrameTime = 0;\n    state.animationId = requestAnimationFrame(loop);\n}\n\nfunction pauseSimulation() {\n    state.isRunning = false;\n    cancelAnimationFrame(state.animationId);\n    lastFrameTime = 0;\n}\n\nfunction resetSimulation() {\n    pauseSimulation();\n    state.currentTime = 0;\n    updateVisuals();\n    drawChart();\n}\n\n/**\n * Visual Updates\n */\nfunction updateVisuals() {\n    const currentC = calculateConcentration(state.currentTime);\n\n    // 1. Update Text\n    ui.timeDisplay.innerText = state.currentTime.toFixed(2) + \" s\";\n    ui.concDisplay.innerText = currentC.toFixed(3) + \" mol/L\";\n\n    // 2. Update Reactor Liquid\n    // Opacity based on ratio of Current C to Max Possible C (5.0 defined in JSON range, or just C0?)\n    // Using C/C0 makes the visual relative to start, which is more intuitive for \"decay\".\n    // 0 concentration = 0.1 opacity (faint trace), C0 = 1.0 opacity\n    const opacity = (currentC / state.c0) * 0.9 + 0.1; \n    \n    // We update the Alpha channel of the RGBA color defined in CSS\n    ui.liquid.style.backgroundColor = `rgba(59, 130, 246, ${opacity})`;\n}\n\n/**\n * Canvas Chart Drawing\n */\nfunction drawChart() {\n    const { canvasWidth: w, canvasHeight: h, maxTime, c0, k, currentTime } = state;\n    \n    // Clear\n    ctx.clearRect(0, 0, w, h);\n\n    // Padding\n    const pad = { top: 20, right: 20, bottom: 40, left: 50 };\n    const plotW = w - pad.left - pad.right;\n    const plotH = h - pad.top - pad.bottom;\n\n    // Helper to map Data to Pixels\n    const mapX = (t) => pad.left + (t / maxTime) * plotW;\n    // Y axis goes from 0 to 5 (max range in JSON) or slightly above C0? \n    // Let's scale Y to C0 * 1.1 for better view\n    const maxY = Math.max(c0 * 1.1, 0.001); \n    const mapY = (c) => pad.top + plotH - (c / maxY) * plotH;\n\n    // 1. Draw Axes\n    ctx.beginPath();\n    ctx.strokeStyle = \"#666\";\n    ctx.lineWidth = 2;\n    // Y-Axis\n    ctx.moveTo(pad.left, pad.top);\n    ctx.lineTo(pad.left, pad.top + plotH);\n    // X-Axis\n    ctx.lineTo(pad.left + plotW, pad.top + plotH);\n    ctx.stroke();\n\n    // 2. Draw Labels\n    ctx.fillStyle = \"#444\";\n    ctx.font = \"12px Arial\";\n    ctx.textAlign = \"center\";\n    \n    // X-labels\n    for(let i=0; i<=5; i++) {\n        const val = (maxTime * i / 5);\n        const x = mapX(val);\n        ctx.fillText(val.toFixed(1), x, pad.top + plotH + 20);\n    }\n    // X-Axis Title\n    ctx.fillText(\"Time (s)\", pad.left + plotW/2, pad.top + plotH + 35);\n\n    // Y-labels\n    ctx.textAlign = \"right\";\n    ctx.textBaseline = \"middle\";\n    for(let i=0; i<=5; i++) {\n        const val = (maxY * i / 5);\n        const y = mapY(val);\n        ctx.fillText(val.toFixed(2), pad.left - 10, y);\n    }\n    // Y-Axis Title\n    ctx.save();\n    ctx.translate(15, pad.top + plotH/2);\n    ctx.rotate(-Math.PI/2);\n    ctx.textAlign = \"center\";\n    ctx.fillText(\"Concentration (mol/L)\", 0, 0);\n    ctx.restore();\n\n    // 3. Draw Theoretical Curve (Static Background Line)\n    ctx.beginPath();\n    ctx.strokeStyle = \"#cbd5e1\"; // Light grey\n    ctx.lineWidth = 2;\n    ctx.setLineDash([5, 5]); // Dashed\n    for(let px = 0; px <= plotW; px+=2) {\n        const t = (px / plotW) * maxTime;\n        const c = c0 * Math.exp(-k * t);\n        const py = mapY(c);\n        if(px===0) ctx.moveTo(pad.left + px, py);\n        else ctx.lineTo(pad.left + px, py);\n    }\n    ctx.stroke();\n    ctx.setLineDash([]); // Reset dash\n\n    // 4. Draw Active Path (Solid Blue up to current time)\n    ctx.beginPath();\n    ctx.strokeStyle = \"#3b82f6\"; // Primary blue\n    ctx.lineWidth = 3;\n    \n    // We draw from t=0 to t=currentTime\n    // Steps for smoothness\n    const steps = 100;\n    const timeStep = currentTime / steps;\n    \n    if (currentTime > 0) {\n        ctx.moveTo(mapX(0), mapY(c0));\n        for(let i = 1; i <= steps; i++) {\n            const t = i * timeStep;\n            const c = c0 * Math.exp(-k * t);\n            ctx.lineTo(mapX(t), mapY(c));\n        }\n        ctx.stroke();\n    }\n\n    // 5. Draw Current Point Marker\n    const curC = calculateConcentration(currentTime);\n    const cx = mapX(currentTime);\n    const cy = mapY(curC);\n\n    ctx.beginPath();\n    ctx.fillStyle = \"#ef4444\"; // Red dot\n    ctx.arc(cx, cy, 6, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.strokeStyle = \"#fff\";\n    ctx.lineWidth = 2;\n    ctx.stroke();\n}\n\n// Run\ninit();"}}
{"input": {"input_text": "Reversible first-order reaction A <-> B with forward k1 and reverse k2 in batch. Provide concentration of A over time.", "simulation_name": " Reversible First Order", "domain": "Chemical Engineering", "description": "A <-> B reversible kinetics", "assumptions": ["Isothermal", "Well-mixed"], "entities": [], "constants": [], "parameters": [{"name": "initial_A", "symbol": "A0", "unit": "mol/L", "range": [0, 5]}, {"name": "initial_B", "symbol": "B0", "unit": "mol/L", "range": [0, 5]}, {"name": "k1", "symbol": "k1", "unit": "1/s", "range": [1e-05, 1]}, {"name": "k2", "symbol": "k2", "unit": "1/s", "range": [1e-05, 1]}], "equations": [{"description": "Equilibrium", "expression": "Aeq = (k2/(k1+k2))*(A0+B0)"}, {"description": "Transient A", "expression": "A(t) = Aeq + (A0 - Aeq)*exp(-(k1+k2)*t)"}], "initial_conditions": {}, "outputs": ["A"], "simulation_controls": ["A0", "B0", "k1", "k2"], "constraints": ["A0 >= 0", "B0 >= 0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S26 Reversible First Order Reaction</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n</head>\n<body>\n\n    <div class=\"container\">\n        <header>\n            <h1>Reversible First-Order Reaction</h1>\n            <p>Simulation of kinetics: A <span style=\"color: #3b82f6;\">&#8652;</span> B</p>\n        </header>\n\n        <div class=\"main-content\">\n            <aside class=\"controls-panel\">\n                <div class=\"control-group\">\n                    <label for=\"A0\">Initial Concentration A ($A_0$)</label>\n                    <div class=\"slider-container\">\n                        <input type=\"range\" id=\"A0\" min=\"0\" max=\"5\" step=\"0.1\" value=\"5\">\n                        <span id=\"val-A0\">5.0</span> <span class=\"unit\">mol/L</span>\n                    </div>\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"B0\">Initial Concentration B ($B_0$)</label>\n                    <div class=\"slider-container\">\n                        <input type=\"range\" id=\"B0\" min=\"0\" max=\"5\" step=\"0.1\" value=\"0\">\n                        <span id=\"val-B0\">0.0</span> <span class=\"unit\">mol/L</span>\n                    </div>\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"k1\">Forward Rate Constant ($k_1$)</label>\n                    <div class=\"slider-container\">\n                        <input type=\"range\" id=\"k1\" min=\"0.01\" max=\"1\" step=\"0.01\" value=\"0.2\">\n                        <span id=\"val-k1\">0.20</span> <span class=\"unit\">1/s</span>\n                    </div>\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"k2\">Reverse Rate Constant ($k_2$)</label>\n                    <div class=\"slider-container\">\n                        <input type=\"range\" id=\"k2\" min=\"0.01\" max=\"1\" step=\"0.01\" value=\"0.1\">\n                        <span id=\"val-k2\">0.10</span> <span class=\"unit\">1/s</span>\n                    </div>\n                </div>\n\n                <div class=\"simulation-status\">\n                    <h3>Current State (t = <span id=\"time-display\">0.00</span>s)</h3>\n                    <div class=\"stat-row\">\n                        <span class=\"label-a\">Conc. A:</span>\n                        <span id=\"curr-A\">0.00</span> mol/L\n                    </div>\n                    <div class=\"stat-row\">\n                        <span class=\"label-b\">Conc. B:</span>\n                        <span id=\"curr-B\">0.00</span> mol/L\n                    </div>\n                    <div class=\"stat-row eq-row\">\n                        <span>Equilibrium A ($A_{eq}$):</span>\n                        <span id=\"eq-A\">0.00</span>\n                    </div>\n                </div>\n\n                <div class=\"actions\">\n                    <button id=\"btn-reset\">Reset Simulation</button>\n                    <button id=\"btn-pause\">Pause/Play</button>\n                </div>\n            </aside>\n\n            <main class=\"vis-panel\">\n                <div class=\"canvas-card\" id=\"particle-container\">\n                    <h3>Molecular View</h3>\n                    <canvas id=\"simCanvas\"></canvas>\n                    <div class=\"legend\">\n                        <span class=\"dot a-dot\"></span> Species A\n                        <span class=\"dot b-dot\" style=\"margin-left: 15px;\"></span> Species B\n                    </div>\n                </div>\n\n                <div class=\"canvas-card\">\n                    <h3>Concentration Profile</h3>\n                    <div class=\"chart-wrapper\">\n                        <canvas id=\"chartCanvas\"></canvas>\n                    </div>\n                </div>\n            </main>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary: #2563eb;\n    --bg-color: #f8fafc;\n    --card-bg: #ffffff;\n    --text-main: #1e293b;\n    --text-light: #64748b;\n    --color-A: #3b82f6; /* Blue */\n    --color-B: #ef4444; /* Red */\n    --border-radius: 12px;\n}\n\n* {\n    box-sizing: border-box;\n    margin: 0;\n    padding: 0;\n}\n\nbody {\n    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-main);\n    height: 100vh;\n    display: flex;\n    flex-direction: column;\n}\n\n.container {\n    max-width: 1400px;\n    margin: 0 auto;\n    padding: 20px;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n}\n\nheader {\n    margin-bottom: 20px;\n    padding-bottom: 10px;\n    border-bottom: 1px solid #e2e8f0;\n}\n\nheader h1 {\n    font-size: 1.5rem;\n    font-weight: 700;\n}\n\nheader p {\n    color: var(--text-light);\n}\n\n.main-content {\n    display: flex;\n    gap: 20px;\n    flex: 1;\n    overflow: hidden; /* Prevent body scroll */\n}\n\n/* Controls Panel */\n.controls-panel {\n    width: 300px;\n    flex-shrink: 0;\n    background: var(--card-bg);\n    padding: 20px;\n    border-radius: var(--border-radius);\n    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n    overflow-y: auto;\n}\n\n.control-group {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\nlabel {\n    font-weight: 600;\n    font-size: 0.9rem;\n}\n\n.slider-container {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\ninput[type=\"range\"] {\n    flex: 1;\n    cursor: pointer;\n}\n\n.unit {\n    color: var(--text-light);\n    font-size: 0.8rem;\n    width: 40px;\n}\n\n/* Simulation Status Box */\n.simulation-status {\n    background: #f1f5f9;\n    padding: 15px;\n    border-radius: 8px;\n    border: 1px solid #e2e8f0;\n}\n\n.simulation-status h3 {\n    font-size: 1rem;\n    margin-bottom: 10px;\n    color: var(--primary);\n}\n\n.stat-row {\n    display: flex;\n    justify-content: space-between;\n    font-family: monospace;\n    font-size: 1rem;\n    margin-bottom: 5px;\n}\n\n.label-a { color: var(--color-A); font-weight: bold; }\n.label-b { color: var(--color-B); font-weight: bold; }\n\n.eq-row {\n    margin-top: 10px;\n    padding-top: 5px;\n    border-top: 1px dashed #cbd5e1;\n    font-size: 0.9rem;\n    color: var(--text-light);\n}\n\n.actions {\n    margin-top: auto;\n    display: flex;\n    gap: 10px;\n}\n\nbutton {\n    flex: 1;\n    padding: 10px;\n    border: none;\n    border-radius: 6px;\n    cursor: pointer;\n    font-weight: 600;\n    transition: background 0.2s;\n}\n\n#btn-reset {\n    background-color: #e2e8f0;\n    color: var(--text-main);\n}\n\n#btn-pause {\n    background-color: var(--primary);\n    color: white;\n}\n\nbutton:hover { opacity: 0.9; }\n\n/* Visual Panel */\n.vis-panel {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n    min-width: 0; /* Fix flex overflow */\n}\n\n.canvas-card {\n    background: var(--card-bg);\n    border-radius: var(--border-radius);\n    padding: 15px;\n    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    position: relative;\n    min-height: 0;\n}\n\n.canvas-card h3 {\n    font-size: 1rem;\n    margin-bottom: 10px;\n    color: var(--text-light);\n}\n\n#simCanvas {\n    width: 100%;\n    height: 100%;\n    background: radial-gradient(circle, #f8fafc 0%, #e2e8f0 100%);\n    border-radius: 8px;\n    border: 1px solid #e2e8f0;\n}\n\n.chart-wrapper {\n    flex: 1;\n    position: relative;\n    min-height: 0;\n}\n\n.legend {\n    margin-top: 8px;\n    font-size: 0.85rem;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.dot {\n    width: 10px;\n    height: 10px;\n    border-radius: 50%;\n    display: inline-block;\n    margin-right: 5px;\n}\n\n.a-dot { background-color: var(--color-A); }\n.b-dot { background-color: var(--color-B); }\n\n/* Responsive adjustments */\n@media (max-width: 900px) {\n    .main-content {\n        flex-direction: column;\n        overflow-y: auto;\n    }\n    .controls-panel {\n        width: 100%;\n        height: auto;\n    }\n    .vis-panel {\n        height: 800px;\n    }\n}", "js": "// --- Configuration & State ---\nconst state = {\n    A0: 5.0,\n    B0: 0.0,\n    k1: 0.2,\n    k2: 0.1,\n    currentTime: 0,\n    isRunning: true,\n    totalParticles: 150, // Total dots in animation\n    animationSpeed: 1,   // Multiplier for simulation time\n    maxTime: 20          // Dynamic based on rates\n};\n\n// --- DOM Elements ---\nconst inputs = {\n    A0: document.getElementById('A0'),\n    B0: document.getElementById('B0'),\n    k1: document.getElementById('k1'),\n    k2: document.getElementById('k2')\n};\n\nconst displays = {\n    A0: document.getElementById('val-A0'),\n    B0: document.getElementById('val-B0'),\n    k1: document.getElementById('val-k1'),\n    k2: document.getElementById('val-k2'),\n    currA: document.getElementById('curr-A'),\n    currB: document.getElementById('curr-B'),\n    eqA: document.getElementById('eq-A'),\n    time: document.getElementById('time-display')\n};\n\nconst btnReset = document.getElementById('btn-reset');\nconst btnPause = document.getElementById('btn-pause');\n\n// --- Canvas Setup ---\nconst simCanvas = document.getElementById('simCanvas');\nconst ctx = simCanvas.getContext('2d');\nlet particles = [];\n\n// --- Chart Setup ---\nconst ctxChart = document.getElementById('chartCanvas').getContext('2d');\nlet kineticsChart;\n\nfunction initChart() {\n    kineticsChart = new Chart(ctxChart, {\n        type: 'line',\n        data: {\n            labels: [],\n            datasets: [\n                {\n                    label: '[A]',\n                    data: [],\n                    borderColor: '#3b82f6', // Blue\n                    backgroundColor: 'rgba(59, 130, 246, 0.1)',\n                    borderWidth: 2,\n                    pointRadius: 0,\n                    fill: false\n                },\n                {\n                    label: '[B]',\n                    data: [],\n                    borderColor: '#ef4444', // Red\n                    backgroundColor: 'rgba(239, 68, 68, 0.1)',\n                    borderWidth: 2,\n                    pointRadius: 0,\n                    fill: false\n                }\n            ]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            animation: false,\n            interaction: {\n                mode: 'index',\n                intersect: false,\n            },\n            scales: {\n                x: {\n                    type: 'linear',\n                    title: { display: true, text: 'Time (s)' },\n                    min: 0\n                },\n                y: {\n                    title: { display: true, text: 'Concentration (mol/L)' },\n                    min: 0,\n                    suggestedMax: 5\n                }\n            },\n            plugins: {\n                annotation: {\n                    annotations: {\n                        line1: {\n                            type: 'line',\n                            yMin: 0,\n                            yMax: 0,\n                            borderColor: 'rgba(0,0,0,0.2)',\n                            borderDash: [5, 5],\n                            borderWidth: 1,\n                            label: { enabled: true, content: 'Equilibrium' }\n                        }\n                    }\n                }\n            }\n        }\n    });\n}\n\n// --- Physics & Math ---\n\nfunction calculateConcentrations(t) {\n    const { A0, B0, k1, k2 } = state;\n    const totalC = A0 + B0;\n    \n    // Equilibrium Concentration of A\n    // k1*Aeq = k2*Beq  => k1*Aeq = k2*(Total - Aeq) => Aeq(k1+k2) = k2*Total\n    const Aeq = (k2 / (k1 + k2)) * totalC;\n    \n    // Transient Equation\n    // A(t) = Aeq + (A0 - Aeq) * exp(-(k1+k2)t)\n    const rateSum = k1 + k2;\n    const At = Aeq + (A0 - Aeq) * Math.exp(-rateSum * t);\n    const Bt = totalC - At;\n\n    return { At, Bt, Aeq };\n}\n\n// Calculate the full curve for the graph\nfunction updateChartData() {\n    const { k1, k2 } = state;\n    \n    // Determine a reasonable time range based on rate constants\n    // Time constant tau = 1 / (k1 + k2). 5*tau reaches ~99% steady state.\n    const tau = 1 / (k1 + k2);\n    state.maxTime = tau * 5;\n    \n    // Generate data points\n    const points = 100;\n    const dt = state.maxTime / points;\n    \n    const dataA = [];\n    const dataB = [];\n    const labels = [];\n    \n    for(let i=0; i<=points; i++) {\n        const t = i * dt;\n        const conc = calculateConcentrations(t);\n        labels.push(t); // For x-axis\n        dataA.push({x: t, y: conc.At});\n        dataB.push({x: t, y: conc.Bt});\n    }\n\n    kineticsChart.options.scales.x.max = state.maxTime;\n    kineticsChart.data.labels = labels; // Chart.js needs labels for axis sometimes\n    kineticsChart.data.datasets[0].data = dataA;\n    kineticsChart.data.datasets[1].data = dataB;\n    \n    // Update Equilibrium Line visual\n    const conc = calculateConcentrations(0); // get Aeq\n    kineticsChart.options.plugins.annotation.annotations.line1.yMin = conc.Aeq;\n    kineticsChart.options.plugins.annotation.annotations.line1.yMax = conc.Aeq;\n\n    kineticsChart.update();\n}\n\n// --- Animation System ---\n\nclass Particle {\n    constructor(type, width, height) {\n        this.x = Math.random() * width;\n        this.y = Math.random() * height;\n        this.vx = (Math.random() - 0.5) * 2;\n        this.vy = (Math.random() - 0.5) * 2;\n        this.type = type; // 'A' or 'B'\n        this.radius = 4;\n    }\n\n    update(w, h) {\n        this.x += this.vx;\n        this.y += this.vy;\n\n        // Bounce off walls\n        if (this.x < 0 || this.x > w) this.vx *= -1;\n        if (this.y < 0 || this.y > h) this.vy *= -1;\n\n        // Keep inside\n        this.x = Math.max(0, Math.min(w, this.x));\n        this.y = Math.max(0, Math.min(h, this.y));\n    }\n\n    draw(ctx) {\n        ctx.beginPath();\n        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);\n        ctx.fillStyle = this.type === 'A' ? '#3b82f6' : '#ef4444';\n        ctx.fill();\n        ctx.closePath();\n    }\n}\n\nfunction initParticles() {\n    particles = [];\n    const { width, height } = simCanvas;\n    // Initial distribution based on A0/B0 ratio\n    const totalConc = state.A0 + state.B0;\n    const ratioA = totalConc > 0 ? state.A0 / totalConc : 0.5;\n    \n    for (let i = 0; i < state.totalParticles; i++) {\n        const type = i < (state.totalParticles * ratioA) ? 'A' : 'B';\n        particles.push(new Particle(type, width, height));\n    }\n}\n\nfunction updateParticleTypes(concA, concB) {\n    const totalConc = concA + concB;\n    if (totalConc <= 0) return;\n\n    const targetCountA = Math.round((concA / totalConc) * state.totalParticles);\n    let currentCountA = particles.filter(p => p.type === 'A').length;\n\n    // Adjust types to match target concentration\n    // We change types randomly to simulate reaction events\n    if (currentCountA < targetCountA) {\n        // Need more A (Turn B -> A)\n        let diff = targetCountA - currentCountA;\n        for (let p of particles) {\n            if (diff <= 0) break;\n            if (p.type === 'B') {\n                p.type = 'A';\n                diff--;\n            }\n        }\n    } else if (currentCountA > targetCountA) {\n        // Need less A (Turn A -> B)\n        let diff = currentCountA - targetCountA;\n        for (let p of particles) {\n            if (diff <= 0) break;\n            if (p.type === 'A') {\n                p.type = 'B';\n                diff--;\n            }\n        }\n    }\n}\n\nfunction resizeCanvas() {\n    const rect = simCanvas.parentElement.getBoundingClientRect();\n    simCanvas.width = rect.width;\n    simCanvas.height = rect.height - 40; // subtract header/padding approx\n}\n\n// --- Main Loop ---\n\nlet lastFrameTime = 0;\n\nfunction loop(timestamp) {\n    if (!lastFrameTime) lastFrameTime = timestamp;\n    const dt = (timestamp - lastFrameTime) / 1000;\n    lastFrameTime = timestamp;\n\n    if (state.isRunning) {\n        state.currentTime += dt * state.animationSpeed;\n        \n        // Clamp time for display if we want, but usually reactions go to infinity. \n        // We reset visual line indicator if it exceeds graph max? \n        // For this sim, let's loop or stop? Let's just run.\n        if (state.currentTime > state.maxTime) {\n            // Optional: Pause at end or Loop. Let's Pause.\n            // state.isRunning = false; \n            // btnPause.innerText = \"Restart\";\n        }\n    }\n\n    // 1. Calculate Chemistry\n    const conc = calculateConcentrations(state.currentTime);\n\n    // 2. Update DOM\n    displays.time.innerText = state.currentTime.toFixed(2);\n    displays.currA.innerText = conc.At.toFixed(2);\n    displays.currB.innerText = conc.Bt.toFixed(2);\n    displays.eqA.innerText = conc.Aeq.toFixed(2);\n\n    // 3. Draw Particles\n    ctx.clearRect(0, 0, simCanvas.width, simCanvas.height);\n    \n    // Sync particle types with calculated concentration\n    updateParticleTypes(conc.At, conc.Bt);\n\n    particles.forEach(p => {\n        p.update(simCanvas.width, simCanvas.height);\n        p.draw(ctx);\n    });\n\n    // 4. Draw Current Time Line on Chart\n    // Chart.js makes it hard to draw a vertical line efficiently every frame without full redraw.\n    // Instead, we will rely on the static chart updated on input change, and maybe \n    // just let the user see the values in the text box.\n    // However, to make it interactive, we can use a plugin or just highlight the point.\n    // For simplicity/performance, we update the title or a specific dataset point if needed.\n    // Here we just let the chart show the full trajectory.\n\n    requestAnimationFrame(loop);\n}\n\n// --- Event Listeners ---\n\nfunction handleInputChange(e) {\n    const id = e.target.id;\n    const val = parseFloat(e.target.value);\n    state[id] = val;\n    displays[id].innerText = val.toFixed(2);\n    \n    // Reset simulation time to 0 on parameter change for clarity? \n    // Or dynamic update? Dynamic update of graph is best.\n    // Resetting time feels more natural for \"Initial Conditions\".\n    if (id === 'A0' || id === 'B0') {\n        state.currentTime = 0;\n        initParticles();\n    }\n    \n    updateChartData();\n}\n\nObject.keys(inputs).forEach(key => {\n    inputs[key].addEventListener('input', handleInputChange);\n});\n\nbtnReset.addEventListener('click', () => {\n    state.currentTime = 0;\n    initParticles();\n});\n\nbtnPause.addEventListener('click', () => {\n    state.isRunning = !state.isRunning;\n    btnPause.innerText = state.isRunning ? \"Pause\" : \"Play\";\n});\n\nwindow.addEventListener('resize', () => {\n    resizeCanvas();\n    initParticles();\n});\n\n// --- Initialization ---\n\nwindow.onload = () => {\n    resizeCanvas();\n    initChart();\n    initParticles();\n    updateChartData();\n    requestAnimationFrame(loop);\n};"}}
{"input": {"input_text": "Michaelis-Menten kinetics: v = (Vmax*S)/(Km + S). Compute rate for substrate S.", "simulation_name": " Michaelis Menten", "domain": "Biology", "description": "Enzyme saturation kinetics", "assumptions": ["Steady-state enzyme"], "entities": [], "constants": [], "parameters": [{"name": "Vmax", "symbol": "Vmax", "unit": "mol/(L*s)", "range": [1e-08, 0.01]}, {"name": "Km", "symbol": "Km", "unit": "mol/L", "range": [1e-07, 0.1]}, {"name": "substrate", "symbol": "S", "unit": "mol/L", "range": [0, 1]}], "equations": [{"description": "Rate", "expression": "v = (Vmax*S)/(Km + S)"}], "initial_conditions": {}, "outputs": ["v"], "simulation_controls": ["Vmax", "Km", "S"], "constraints": ["Vmax >= 0", "Km > 0", "S >= 0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Michaelis-Menten Kinetics Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n    <div class=\"container\">\n        <header>\n            <h1>Michaelis-Menten Kinetics</h1>\n            <p>Simulating Enzyme Saturation Kinetics</p>\n        </header>\n\n        <main class=\"sim-layout\">\n            <div class=\"panel controls-panel\">\n                <div class=\"equation-box\">\n                    $$v = \\frac{V_{max} \\cdot [S]}{K_m + [S]}$$\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"vmax\">\n                        Vmax <span class=\"unit\">(mol/L·s)</span>\n                        <span class=\"value-display\" id=\"val-vmax\">0.005</span>\n                    </label>\n                    <input type=\"range\" id=\"vmax\" min=\"0.0001\" max=\"0.01\" step=\"0.0001\" value=\"0.005\">\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"km\">\n                        Km <span class=\"unit\">(mol/L)</span>\n                        <span class=\"value-display\" id=\"val-km\">0.05</span>\n                    </label>\n                    <input type=\"range\" id=\"km\" min=\"0.001\" max=\"0.1\" step=\"0.001\" value=\"0.05\">\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"substrate\">\n                        Substrate [S] <span class=\"unit\">(mol/L)</span>\n                        <span class=\"value-display\" id=\"val-substrate\">0.5</span>\n                    </label>\n                    <input type=\"range\" id=\"substrate\" min=\"0\" max=\"1\" step=\"0.01\" value=\"0.5\">\n                </div>\n\n                <div class=\"stats-box\">\n                    <h3>Current Rate (v)</h3>\n                    <div class=\"big-stat\">\n                        <span id=\"output-v\">0.0000</span> <small>mol/(L·s)</small>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"panel visual-panel\">\n                <div class=\"tabs\">\n                    <button class=\"tab-btn active\" data-tab=\"graph\">Kinetics Graph</button>\n                    <button class=\"tab-btn\" data-tab=\"simulation\">Molecular View</button>\n                </div>\n\n                <div class=\"tab-content active\" id=\"view-graph\">\n                    <canvas id=\"kineticsGraph\"></canvas>\n                    <div class=\"graph-legend\">\n                        <span class=\"dot red\"></span> Current Operating Point\n                    </div>\n                </div>\n\n                <div class=\"tab-content\" id=\"view-simulation\">\n                    <canvas id=\"moleculeCanvas\"></canvas>\n                    <div class=\"sim-legend\">\n                        <span class=\"dot blue\"></span> Enzyme\n                        <span class=\"dot small-orange\"></span> Substrate\n                        <span class=\"dot green\"></span> Product\n                    </div>\n                </div>\n            </div>\n        </main>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary-color: #007bff;\n    --secondary-color: #6c757d;\n    --bg-color: #f8f9fa;\n    --card-bg: #ffffff;\n    --text-color: #212529;\n}\n\n* {\n    box-sizing: border-box;\n    margin: 0;\n    padding: 0;\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n}\n\nbody {\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    display: flex;\n    justify-content: center;\n    padding: 20px;\n    height: 100vh;\n}\n\n.container {\n    width: 100%;\n    max-width: 1000px;\n    background: var(--card-bg);\n    border-radius: 12px;\n    box-shadow: 0 4px 20px rgba(0,0,0,0.1);\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n}\n\nheader {\n    background: var(--primary-color);\n    color: white;\n    padding: 1.5rem;\n    text-align: center;\n}\n\nheader h1 {\n    font-size: 1.5rem;\n    margin-bottom: 0.5rem;\n}\n\nheader p {\n    font-size: 0.9rem;\n    opacity: 0.9;\n}\n\n.sim-layout {\n    display: flex;\n    flex: 1;\n    overflow: hidden;\n}\n\n.panel {\n    padding: 20px;\n    overflow-y: auto;\n}\n\n/* Left Panel: Controls */\n.controls-panel {\n    flex: 1;\n    border-right: 1px solid #e9ecef;\n    min-width: 300px;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.equation-box {\n    background: #e9ecef;\n    padding: 15px;\n    border-radius: 8px;\n    text-align: center;\n    font-size: 1.1rem;\n    margin-bottom: 10px;\n}\n\n.control-group {\n    background: white;\n}\n\n.control-group label {\n    display: block;\n    margin-bottom: 8px;\n    font-weight: 600;\n    font-size: 0.9rem;\n}\n\n.control-group .unit {\n    font-weight: 400;\n    color: var(--secondary-color);\n    font-size: 0.85rem;\n}\n\n.value-display {\n    float: right;\n    color: var(--primary-color);\n    font-family: monospace;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    cursor: pointer;\n}\n\n.stats-box {\n    margin-top: auto;\n    background: #e7f5ff;\n    padding: 20px;\n    border-radius: 8px;\n    border-left: 4px solid var(--primary-color);\n}\n\n.stats-box h3 {\n    font-size: 0.9rem;\n    color: var(--secondary-color);\n    margin-bottom: 5px;\n    text-transform: uppercase;\n}\n\n.big-stat {\n    font-size: 1.8rem;\n    font-weight: bold;\n    color: var(--text-color);\n}\n\n.big-stat small {\n    font-size: 0.9rem;\n    color: var(--secondary-color);\n    font-weight: normal;\n}\n\n/* Right Panel: Visualization */\n.visual-panel {\n    flex: 1.5;\n    display: flex;\n    flex-direction: column;\n    background: #fff;\n}\n\n.tabs {\n    display: flex;\n    border-bottom: 1px solid #dee2e6;\n    margin-bottom: 20px;\n}\n\n.tab-btn {\n    padding: 10px 20px;\n    background: none;\n    border: none;\n    cursor: pointer;\n    font-weight: 600;\n    color: var(--secondary-color);\n    border-bottom: 2px solid transparent;\n    transition: all 0.2s;\n}\n\n.tab-btn:hover {\n    color: var(--primary-color);\n}\n\n.tab-btn.active {\n    color: var(--primary-color);\n    border-bottom: 2px solid var(--primary-color);\n}\n\n.tab-content {\n    display: none;\n    flex-direction: column;\n    align-items: center;\n    flex: 1;\n}\n\n.tab-content.active {\n    display: flex;\n}\n\ncanvas {\n    border: 1px solid #dee2e6;\n    border-radius: 4px;\n    background: #fff;\n    max-width: 100%;\n}\n\n.graph-legend, .sim-legend {\n    margin-top: 15px;\n    font-size: 0.9rem;\n    display: flex;\n    gap: 15px;\n    align-items: center;\n}\n\n.dot {\n    display: inline-block;\n    width: 12px;\n    height: 12px;\n    border-radius: 50%;\n    margin-right: 5px;\n}\n\n.dot.red { background-color: #dc3545; }\n.dot.blue { background-color: #007bff; }\n.dot.small-orange { background-color: #fd7e14; transform: scale(0.8); }\n.dot.green { background-color: #28a745; }\n\n/* Responsive adjustments */\n@media (max-width: 768px) {\n    .sim-layout {\n        flex-direction: column;\n        overflow-y: auto;\n    }\n    \n    .controls-panel {\n        border-right: none;\n        border-bottom: 1px solid #e9ecef;\n    }\n    \n    body {\n        padding: 0;\n        height: auto;\n    }\n    \n    .container {\n        border-radius: 0;\n        height: auto;\n        min-height: 100vh;\n    }\n}", "js": "// Constants and State\nconst state = {\n    Vmax: 0.005,\n    Km: 0.05,\n    S: 0.5,\n    v: 0\n};\n\n// DOM Elements\nconst inputs = {\n    vmax: document.getElementById('vmax'),\n    km: document.getElementById('km'),\n    substrate: document.getElementById('substrate')\n};\n\n// Map HTML IDs to State Keys (The Fix)\nconst inputMap = {\n    vmax: 'Vmax',\n    km: 'Km',\n    substrate: 'S'\n};\n\nconst displays = {\n    vmax: document.getElementById('val-vmax'),\n    km: document.getElementById('val-km'),\n    substrate: document.getElementById('val-substrate'),\n    v: document.getElementById('output-v')\n};\n\nconst graphCanvas = document.getElementById('kineticsGraph');\nconst graphCtx = graphCanvas.getContext('2d');\nconst molCanvas = document.getElementById('moleculeCanvas');\nconst molCtx = molCanvas.getContext('2d');\n\n// --- Initialization ---\nfunction init() {\n    // Event Listeners for Sliders\n    Object.keys(inputs).forEach(key => {\n        inputs[key].addEventListener('input', (e) => {\n            const stateKey = inputMap[key]; // Get the correct state key (e.g., 'substrate' -> 'S')\n            state[stateKey] = parseFloat(e.target.value);\n            \n            // Update the text number next to the slider\n            displays[key].innerText = state[stateKey];\n            \n            updateSimulation();\n        });\n    });\n\n    // Tab Switching logic\n    document.querySelectorAll('.tab-btn').forEach(btn => {\n        btn.addEventListener('click', () => {\n            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));\n            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));\n            btn.classList.add('active');\n            document.getElementById(`view-${btn.dataset.tab}`).classList.add('active');\n            resizeCanvases();\n        });\n    });\n\n    window.addEventListener('resize', resizeCanvases);\n    \n    // Initial Run\n    resizeCanvases();\n    updateSimulation();\n    animateMolecules();\n}\n\nfunction resizeCanvases() {\n    const parent = document.querySelector('.visual-panel');\n    if (!parent) return;\n    \n    // Make canvas fill the panel, but keep it visible\n    const size = parent.clientWidth - 40;\n    \n    graphCanvas.width = size;\n    graphCanvas.height = 300;\n    \n    molCanvas.width = size;\n    molCanvas.height = 300;\n    \n    drawGraph();\n}\n\n// --- Physics / Math Logic ---\n\nfunction calculateRate(Vmax, Km, S) {\n    if (Km + S === 0) return 0;\n    return (Vmax * S) / (Km + S);\n}\n\nfunction updateSimulation() {\n    // 1. Calculate Output based on current State\n    state.v = calculateRate(state.Vmax, state.Km, state.S);\n    \n    // 2. Update Result Display\n    if(displays.v) {\n        displays.v.innerText = state.v.toExponential(2);\n    }\n    \n    // 3. Update Visuals\n    drawGraph();\n}\n\n// --- Graph Visualization ---\n\nfunction drawGraph() {\n    if (!graphCtx) return;\n\n    const width = graphCanvas.width;\n    const height = graphCanvas.height;\n    const padding = 50; // Increased padding for labels\n\n    // Clear\n    graphCtx.clearRect(0, 0, width, height);\n\n    // Axis limits\n    const maxS = 1.0; \n    const maxV = 0.012; \n\n    // Helper to map coordinates\n    // We add padding to Left and Bottom\n    const mapX = (s) => padding + (s / maxS) * (width - 2 * padding);\n    const mapY = (v) => height - padding - (v / maxV) * (height - 2 * padding);\n\n    // Draw Axes\n    graphCtx.beginPath();\n    graphCtx.strokeStyle = '#333';\n    graphCtx.lineWidth = 2;\n    graphCtx.moveTo(padding, padding); \n    graphCtx.lineTo(padding, height - padding); \n    graphCtx.lineTo(width - padding, height - padding); \n    graphCtx.stroke();\n\n    // Axis Labels\n    graphCtx.fillStyle = '#333';\n    graphCtx.font = '12px sans-serif';\n    graphCtx.textAlign = 'center';\n    graphCtx.fillText('[S] Substrate (mol/L)', width / 2, height - 10);\n    \n    graphCtx.save();\n    graphCtx.translate(15, height / 2);\n    graphCtx.rotate(-Math.PI / 2);\n    graphCtx.fillText('Reaction Rate (v)', 0, 0);\n    graphCtx.restore();\n\n    // Draw Vmax Line (Dashed limit line)\n    const yVmax = mapY(state.Vmax);\n    graphCtx.beginPath();\n    graphCtx.setLineDash([5, 5]);\n    graphCtx.strokeStyle = '#999';\n    graphCtx.moveTo(padding, yVmax);\n    graphCtx.lineTo(width - padding, yVmax);\n    graphCtx.stroke();\n    graphCtx.setLineDash([]);\n    graphCtx.fillStyle = '#666';\n    graphCtx.textAlign = 'right';\n    graphCtx.fillText('Vmax', width - padding - 5, yVmax - 5);\n\n    // Draw Km Line (Vertical Dashed)\n    // Km is the [S] where v = Vmax / 2\n    const xKm = mapX(state.Km);\n    const yHalfVmax = mapY(state.Vmax / 2);\n    \n    // Draw lines indicating Km\n    graphCtx.beginPath();\n    graphCtx.setLineDash([2, 2]);\n    graphCtx.strokeStyle = '#28a745'; // Green for Km\n    // Horizontal line to curve\n    graphCtx.moveTo(padding, yHalfVmax);\n    graphCtx.lineTo(xKm, yHalfVmax);\n    // Vertical line down\n    graphCtx.lineTo(xKm, height - padding);\n    graphCtx.stroke();\n    graphCtx.setLineDash([]);\n    \n    graphCtx.fillStyle = '#28a745';\n    graphCtx.textAlign = 'center';\n    graphCtx.fillText('Km', xKm, height - padding + 15);\n\n\n    // Draw Curve\n    graphCtx.beginPath();\n    graphCtx.strokeStyle = '#007bff';\n    graphCtx.lineWidth = 3;\n    \n    // Draw the function curve\n    for (let s = 0; s <= maxS; s += 0.01) {\n        const v = calculateRate(state.Vmax, state.Km, s);\n        const x = mapX(s);\n        const y = mapY(v);\n        if (s === 0) graphCtx.moveTo(x, y);\n        else graphCtx.lineTo(x, y);\n    }\n    graphCtx.stroke();\n\n    // Draw Current Point (Red Dot)\n    const currentX = mapX(state.S);\n    const currentY = mapY(state.v);\n    \n    graphCtx.beginPath();\n    graphCtx.fillStyle = '#dc3545';\n    graphCtx.arc(currentX, currentY, 6, 0, Math.PI * 2);\n    graphCtx.fill();\n    graphCtx.fillStyle = 'black';\n    graphCtx.fillText('Operating Point', currentX, currentY - 10);\n}\n\n// --- Molecular Visualization (Particle System) ---\nconst particles = [];\nconst numEnzymes = 8;\nlet lastFrameTime = 0;\n\n// Initialize Enzyme particles\nfor(let i=0; i<numEnzymes; i++) {\n    particles.push({\n        type: 'enzyme',\n        x: Math.random() * 300, \n        y: Math.random() * 300,\n        vx: (Math.random() - 0.5) * 1.5,\n        vy: (Math.random() - 0.5) * 1.5,\n        busy: 0 // Timer > 0 means it contains substrate\n    });\n}\n\nfunction animateMolecules(timestamp) {\n    if (!molCtx) return; // Guard if canvas not ready\n\n    if (!lastFrameTime) lastFrameTime = timestamp;\n    const dt = timestamp - lastFrameTime;\n    lastFrameTime = timestamp;\n\n    const width = molCanvas.width;\n    const height = molCanvas.height;\n    molCtx.clearRect(0, 0, width, height);\n    \n    // Background\n    molCtx.fillStyle = '#f8f9fa';\n    molCtx.fillRect(0,0, width, height);\n\n    // 1. Manage Substrate Count\n    // Map [S] 0.0 -> 1.0 to roughly 0 -> 80 particles\n    const targetSubstrate = Math.floor(state.S * 80);\n    const currentSubstrate = particles.filter(p => p.type === 'substrate').length;\n\n    if (currentSubstrate < targetSubstrate) {\n        // Add\n        particles.push({\n            type: 'substrate',\n            x: Math.random() * width,\n            y: Math.random() * height,\n            vx: (Math.random() - 0.5) * 2,\n            vy: (Math.random() - 0.5) * 2\n        });\n    } else if (currentSubstrate > targetSubstrate) {\n        // Remove (find first substrate and remove it)\n        const idx = particles.findIndex(p => p.type === 'substrate');\n        if (idx > -1) particles.splice(idx, 1);\n    }\n\n    // 2. Update Particles\n    particles.forEach(p => {\n        // Move (Enzymes and Free Substrate)\n        if (p.type !== 'enzyme' || p.busy <= 0) {\n            p.x += p.vx;\n            p.y += p.vy;\n        }\n\n        // Bounce\n        if (p.x < 0 || p.x > width) p.vx *= -1;\n        if (p.y < 0 || p.y > height) p.vy *= -1;\n\n        // Draw & Interact\n        if (p.type === 'enzyme') {\n            // Processing Speed (Vmax determines how fast it \"chews\")\n            // Higher Vmax = Faster = Lower busy time\n            // Range Vmax 0.0001 to 0.01. \n            // Map to frames: 120 frames (slow) to 20 frames (fast)\n            const processingFrames = 120 - (state.Vmax / 0.01) * 100;\n\n            if (p.busy > 0) {\n                // Processing...\n                p.busy--;\n                \n                // Draw Enzyme (Grey/Busy)\n                molCtx.beginPath();\n                molCtx.arc(p.x, p.y, 12, 0, Math.PI*2);\n                molCtx.fillStyle = '#6c757d'; \n                molCtx.fill();\n                \n                // Draw Substrate inside\n                molCtx.beginPath();\n                molCtx.arc(p.x, p.y, 5, 0, Math.PI*2);\n                molCtx.fillStyle = '#fd7e14';\n                molCtx.fill();\n\n                // Done? Release Product\n                if (p.busy <= 0) {\n                    particles.push({\n                        type: 'product',\n                        x: p.x,\n                        y: p.y,\n                        vx: (Math.random() - 0.5) * 3,\n                        vy: (Math.random() - 0.5) * 3,\n                        life: 50 // Frames to live\n                    });\n                }\n            } else {\n                // Free Enzyme\n                molCtx.beginPath();\n                molCtx.arc(p.x, p.y, 12, 0, Math.PI*2);\n                molCtx.fillStyle = '#007bff'; \n                molCtx.fill();\n                \n                // Mouth\n                molCtx.fillStyle = '#f8f9fa';\n                molCtx.beginPath();\n                molCtx.moveTo(p.x, p.y);\n                molCtx.arc(p.x, p.y, 12, -0.2 * Math.PI, 0.2 * Math.PI);\n                molCtx.fill();\n\n                // Collision Detection with Substrate (Affinity/Km)\n                // Lower Km = Higher Affinity = larger capture radius or higher probability\n                // Here we simplify: Just distance check\n                for (let j = 0; j < particles.length; j++) {\n                    let s = particles[j];\n                    if (s.type === 'substrate') {\n                        let dx = p.x - s.x;\n                        let dy = p.y - s.y;\n                        let dist = Math.sqrt(dx*dx + dy*dy);\n                        \n                        // Collision radius based on Km? \n                        // Let's keep it simple: strict collision\n                        if (dist < 15) {\n                            // Captured!\n                            particles.splice(j, 1);\n                            p.busy = processingFrames;\n                            break; \n                        }\n                    }\n                }\n            }\n        } \n        else if (p.type === 'substrate') {\n            molCtx.beginPath();\n            molCtx.arc(p.x, p.y, 4, 0, Math.PI*2);\n            molCtx.fillStyle = '#fd7e14';\n            molCtx.fill();\n        } \n        else if (p.type === 'product') {\n            molCtx.beginPath();\n            molCtx.arc(p.x, p.y, 5, 0, Math.PI*2);\n            molCtx.fillStyle = '#28a745';\n            molCtx.fill();\n            p.life--;\n        }\n    });\n\n    // Remove dead products\n    for (let i = particles.length - 1; i >= 0; i--) {\n        if (particles[i].type === 'product' && particles[i].life <= 0) {\n            particles.splice(i, 1);\n        }\n    }\n\n    requestAnimationFrame(animateMolecules);\n}\n\n// Start\ninit();"}}
{"input": {"input_text": "Competitive enzyme inhibition: v = (Vmax*S)/(Km*(1 + I/Ki) + S). Compute rate given inhibitor I.", "simulation_name": " Competitive Inhibition", "domain": "Biology", "description": "Michaelis-Menten with competitive inhibitor", "assumptions": ["Steady-state"], "entities": [], "constants": [], "parameters": [{"name": "Vmax", "symbol": "Vmax", "unit": "mol/(L*s)", "range": [1e-08, 0.01]}, {"name": "Km", "symbol": "Km", "unit": "mol/L", "range": [1e-07, 0.1]}, {"name": "substrate", "symbol": "S", "unit": "mol/L", "range": [0, 1]}, {"name": "inhibitor", "symbol": "I", "unit": "mol/L", "range": [0, 1]}, {"name": "inhibition_constant", "symbol": "Ki", "unit": "mol/L", "range": [1e-07, 0.5]}], "equations": [{"description": "Rate", "expression": "v = (Vmax*S)/(Km*(1 + I/Ki) + S)"}], "initial_conditions": {}, "outputs": ["v"], "simulation_controls": ["Vmax", "Km", "S", "I", "Ki"], "constraints": ["Vmax >= 0", "Km > 0", "Ki > 0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S28 Competitive Inhibition Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n\n    <div class=\"main-container\">\n        <header>\n            <h1>Competitive Enzyme Inhibition</h1>\n            <p class=\"formula\">\n                <span class=\"math\">v = \\frac{V_{max}[S]}{K_m(1 + \\frac{[I]}{K_i}) + [S]}</span>\n            </p>\n        </header>\n\n        <div class=\"simulation-layout\">\n            <div class=\"controls-panel\">\n                <h2>Parameters</h2>\n                \n                <div class=\"control-group\">\n                    <label for=\"vmax\">Vmax (Max Velocity) <span id=\"val-vmax\"></span></label>\n                    <input type=\"range\" id=\"vmax\" min=\"0.001\" max=\"0.01\" step=\"0.0001\">\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"km\">Km (Michaelis Constant) <span id=\"val-km\"></span></label>\n                    <input type=\"range\" id=\"km\" min=\"0.01\" max=\"0.1\" step=\"0.001\">\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"ki\">Ki (Inhibition Constant) <span id=\"val-ki\"></span></label>\n                    <input type=\"range\" id=\"ki\" min=\"0.000001\" max=\"0.5\" step=\"0.0001\">\n                    <small>Lower Ki = Stronger Inhibitor</small>\n                </div>\n\n                <hr>\n\n                <div class=\"control-group\">\n                    <label for=\"s-conc\" style=\"color: #2ecc71;\">[S] Substrate Conc. <span id=\"val-s\"></span></label>\n                    <input type=\"range\" id=\"s-conc\" min=\"0\" max=\"1\" step=\"0.01\">\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"i-conc\" style=\"color: #e74c3c;\">[I] Inhibitor Conc. <span id=\"val-i\"></span></label>\n                    <input type=\"range\" id=\"i-conc\" min=\"0\" max=\"1\" step=\"0.01\">\n                </div>\n\n                <div class=\"output-box\">\n                    <h3>Reaction Rate (v)</h3>\n                    <div id=\"output-rate\">0.0000</div>\n                    <div class=\"unit\">mol/(L·s)</div>\n                </div>\n            </div>\n\n            <div class=\"visuals-panel\">\n                \n                <div class=\"canvas-wrapper\">\n                    <h3>Michaelis-Menten Plot</h3>\n                    <canvas id=\"graphCanvas\"></canvas>\n                    <div class=\"legend\">\n                        <span class=\"l-item\"><span class=\"dot dashed\"></span> No Inhibitor</span>\n                        <span class=\"l-item\"><span class=\"dot solid\"></span> With Inhibitor</span>\n                        <span class=\"l-item\"><span class=\"dot current\"></span> Current State</span>\n                    </div>\n                </div>\n\n                <div class=\"canvas-wrapper\">\n                    <h3>Molecular View</h3>\n                    <canvas id=\"simCanvas\"></canvas>\n                    <div class=\"legend\">\n                        <span class=\"l-item\"><span class=\"shape enzyme\"></span> Enzyme</span>\n                        <span class=\"l-item\"><span class=\"shape sub\"></span> Substrate</span>\n                        <span class=\"l-item\"><span class=\"shape inh\"></span> Inhibitor</span>\n                        <span class=\"l-item\"><span class=\"shape prod\"></span> Product</span>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary: #3498db;\n    --secondary: #2c3e50;\n    --accent: #e67e22;\n    --bg: #f4f7f6;\n    --panel-bg: #ffffff;\n    --substrate: #2ecc71;\n    --inhibitor: #e74c3c;\n    --text: #333;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg);\n    color: var(--text);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n}\n\n.main-container {\n    max-width: 1200px;\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 10px;\n}\n\nheader h1 {\n    color: var(--secondary);\n    margin: 0 0 10px 0;\n}\n\n.formula {\n    background: #fff;\n    display: inline-block;\n    padding: 10px 20px;\n    border-radius: 8px;\n    box-shadow: 0 2px 5px rgba(0,0,0,0.05);\n    font-size: 1.2rem;\n    font-weight: bold;\n    color: var(--secondary);\n}\n\n.simulation-layout {\n    display: grid;\n    grid-template-columns: 300px 1fr;\n    gap: 20px;\n}\n\n@media (max-width: 900px) {\n    .simulation-layout {\n        grid-template-columns: 1fr;\n    }\n}\n\n/* Controls Panel */\n.controls-panel {\n    background: var(--panel-bg);\n    padding: 20px;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0,0,0,0.05);\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n}\n\n.controls-panel h2 {\n    margin-top: 0;\n    border-bottom: 2px solid #eee;\n    padding-bottom: 10px;\n    font-size: 1.2rem;\n}\n\n.control-group {\n    display: flex;\n    flex-direction: column;\n}\n\n.control-group label {\n    font-weight: 600;\n    font-size: 0.9rem;\n    margin-bottom: 5px;\n    display: flex;\n    justify-content: space-between;\n}\n\n.control-group small {\n    color: #777;\n    font-size: 0.8rem;\n    margin-top: 2px;\n}\n\ninput[type=range] {\n    width: 100%;\n    cursor: pointer;\n}\n\n.output-box {\n    background: #e8f6f3;\n    border: 1px solid #d1f2eb;\n    padding: 15px;\n    border-radius: 8px;\n    text-align: center;\n    margin-top: auto;\n}\n\n.output-box h3 {\n    margin: 0 0 5px 0;\n    font-size: 1rem;\n    color: var(--secondary);\n}\n\n#output-rate {\n    font-size: 1.8rem;\n    font-weight: bold;\n    color: var(--primary);\n}\n\n.unit {\n    font-size: 0.9rem;\n    color: #7f8c8d;\n}\n\n/* Visuals Panel */\n.visuals-panel {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 20px;\n}\n\n@media (max-width: 600px) {\n    .visuals-panel {\n        grid-template-columns: 1fr;\n    }\n}\n\n.canvas-wrapper {\n    background: var(--panel-bg);\n    padding: 15px;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0,0,0,0.05);\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n}\n\n.canvas-wrapper h3 {\n    width: 100%;\n    text-align: left;\n    margin: 0 0 10px 0;\n    font-size: 1rem;\n    color: var(--secondary);\n}\n\ncanvas {\n    background: #fff;\n    border: 1px solid #eee;\n    border-radius: 4px;\n    width: 100%;\n    height: 300px;\n}\n\n/* Legend Styling */\n.legend {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 15px;\n    margin-top: 10px;\n    font-size: 0.85rem;\n    color: #555;\n}\n\n.l-item {\n    display: flex;\n    align-items: center;\n    gap: 5px;\n}\n\n.dot {\n    width: 12px;\n    height: 2px;\n    display: inline-block;\n}\n\n.dashed { border-top: 2px dashed #aaa; height: 0; }\n.solid { background: var(--primary); height: 3px; }\n.current { width: 10px; height: 10px; background: var(--accent); border-radius: 50%; }\n\n.shape { width: 12px; height: 12px; display: inline-block; }\n.enzyme { background: var(--primary); border-radius: 50%; clip-path: polygon(100% 0%, 100% 100%, 50% 50%, 0% 100%, 0% 0%); border-radius:0;} /* Pacman approximation */\n.sub { background: var(--substrate); border-radius: 50%; }\n.inh { background: var(--inhibitor); clip-path: polygon(50% 0%, 0% 100%, 100% 100%); }\n.prod { background: #f1c40f; clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%); }", "js": "// --- Configuration & State ---\nconst state = {\n    vmax: 0.005,\n    km: 0.05,\n    s: 0.5,\n    i: 0.0,\n    ki: 0.1\n};\n\n// --- DOM Elements ---\nconst inputs = {\n    vmax: document.getElementById('vmax'),\n    km: document.getElementById('km'),\n    s: document.getElementById('s-conc'),\n    i: document.getElementById('i-conc'),\n    ki: document.getElementById('ki')\n};\n\nconst labels = {\n    vmax: document.getElementById('val-vmax'),\n    km: document.getElementById('val-km'),\n    s: document.getElementById('val-s'),\n    i: document.getElementById('val-i'),\n    ki: document.getElementById('val-ki')\n};\n\nconst outputRate = document.getElementById('output-rate');\n\n// --- Initialization ---\nfunction init() {\n    // Set initial input values based on state range\n    inputs.vmax.value = state.vmax;\n    inputs.km.value = state.km;\n    inputs.s.value = state.s;\n    inputs.i.value = state.i;\n    inputs.ki.value = state.ki;\n\n    // Add listeners\n    Object.keys(inputs).forEach(key => {\n        inputs[key].addEventListener('input', (e) => {\n            state[key] = parseFloat(e.target.value);\n            update();\n        });\n    });\n\n    // Start Loops\n    update();\n    requestAnimationFrame(animateParticles);\n}\n\n// --- Calculation Logic ---\nfunction calculateRate(s, i, vmax, km, ki) {\n    // Apparent Km = Km * (1 + I/Ki)\n    const kmApp = km * (1 + (i / ki));\n    return (vmax * s) / (kmApp + s);\n}\n\n// --- Main Update Function ---\nfunction update() {\n    // Update Labels\n    labels.vmax.innerText = state.vmax.toFixed(4);\n    labels.km.innerText = state.km.toFixed(3);\n    labels.s.innerText = state.s.toFixed(2);\n    labels.i.innerText = state.i.toFixed(2);\n    labels.ki.innerText = state.ki.toFixed(4);\n\n    // Calculate current Rate\n    const v = calculateRate(state.s, state.i, state.vmax, state.km, state.ki);\n    outputRate.innerText = v.toExponential(3);\n\n    // Redraw Graph\n    drawGraph();\n}\n\n// --- Graphing Logic ---\nconst graphCanvas = document.getElementById('graphCanvas');\nconst gCtx = graphCanvas.getContext('2d');\n\nfunction drawGraph() {\n    // Resize for high DPI\n    const dpr = window.devicePixelRatio || 1;\n    const rect = graphCanvas.getBoundingClientRect();\n    graphCanvas.width = rect.width * dpr;\n    graphCanvas.height = rect.height * dpr;\n    gCtx.scale(dpr, dpr);\n    \n    const w = rect.width;\n    const h = rect.height;\n    const padding = 40;\n\n    gCtx.clearRect(0, 0, w, h);\n\n    // Axes\n    gCtx.beginPath();\n    gCtx.strokeStyle = '#ccc';\n    gCtx.lineWidth = 1;\n    // Y-axis\n    gCtx.moveTo(padding, 10);\n    gCtx.lineTo(padding, h - padding);\n    // X-axis\n    gCtx.lineTo(w - 10, h - padding);\n    gCtx.stroke();\n\n    // Axis Labels\n    gCtx.fillStyle = '#666';\n    gCtx.font = '12px Arial';\n    gCtx.fillText('[S]', w - 30, h - 10);\n    gCtx.fillText('v', 10, 20);\n\n    // Max ranges for plotting\n    const maxS = 1.0; \n    const maxV = state.vmax * 1.2; // Add some headroom\n\n    // Helper to map coordinates\n    const mapX = (sVal) => padding + (sVal / maxS) * (w - padding - 20);\n    const mapY = (vVal) => (h - padding) - (vVal / maxV) * (h - padding - 20);\n\n    // 1. Draw Uninhibited Curve (Reference)\n    gCtx.beginPath();\n    gCtx.strokeStyle = '#aaa';\n    gCtx.setLineDash([5, 5]);\n    gCtx.lineWidth = 2;\n    for (let s = 0; s <= maxS; s += 0.01) {\n        const vRef = (state.vmax * s) / (state.km + s);\n        const x = mapX(s);\n        const y = mapY(vRef);\n        if (s === 0) gCtx.moveTo(x, y);\n        else gCtx.lineTo(x, y);\n    }\n    gCtx.stroke();\n\n    // 2. Draw Inhibited Curve (Active)\n    gCtx.beginPath();\n    gCtx.strokeStyle = '#3498db';\n    gCtx.setLineDash([]); // Solid line\n    gCtx.lineWidth = 3;\n    for (let s = 0; s <= maxS; s += 0.01) {\n        const vAct = calculateRate(s, state.i, state.vmax, state.km, state.ki);\n        const x = mapX(s);\n        const y = mapY(vAct);\n        if (s === 0) gCtx.moveTo(x, y);\n        else gCtx.lineTo(x, y);\n    }\n    gCtx.stroke();\n\n    // 3. Draw Current Point\n    const currentV = calculateRate(state.s, state.i, state.vmax, state.km, state.ki);\n    const cx = mapX(state.s);\n    const cy = mapY(currentV);\n\n    gCtx.beginPath();\n    gCtx.fillStyle = '#e67e22';\n    gCtx.arc(cx, cy, 6, 0, Math.PI * 2);\n    gCtx.fill();\n    gCtx.stroke(); // border\n}\n\n// --- Particle Simulation Logic ---\nconst simCanvas = document.getElementById('simCanvas');\nconst sCtx = simCanvas.getContext('2d');\nlet particles = [];\nlet enzymes = [];\n\n// Constants for simulation\nconst NUM_ENZYMES = 6;\nconst PARTICLE_SPEED = 1;\n\nclass Enzyme {\n    constructor(x, y) {\n        this.x = x;\n        this.y = y;\n        this.radius = 12;\n        this.angle = Math.random() * Math.PI * 2;\n        this.state = 'free'; // free, complex_s, complex_i\n        this.timer = 0;\n    }\n\n    draw(ctx) {\n        ctx.save();\n        ctx.translate(this.x, this.y);\n        ctx.rotate(this.angle);\n        \n        // Body\n        ctx.beginPath();\n        if (this.state === 'complex_i') ctx.fillStyle = '#c0392b'; // Blocked (Dark Red)\n        else if (this.state === 'complex_s') ctx.fillStyle = '#2ecc71'; // Processing (Green)\n        else ctx.fillStyle = '#3498db'; // Free (Blue)\n        \n        // Pacman shape\n        ctx.arc(0, 0, this.radius, 0.2 * Math.PI, 1.8 * Math.PI);\n        ctx.lineTo(0, 0);\n        ctx.fill();\n\n        ctx.restore();\n    }\n\n    update() {\n        // Random wander\n        this.angle += (Math.random() - 0.5) * 0.2;\n        this.x += Math.cos(this.angle) * 0.5;\n        this.y += Math.sin(this.angle) * 0.5;\n\n        // Bounce walls\n        if (this.x < 0) this.x = simCanvas.width;\n        if (this.x > simCanvas.width) this.x = 0;\n        if (this.y < 0) this.y = simCanvas.height;\n        if (this.y > simCanvas.height) this.y = 0;\n\n        // Handle states\n        if (this.state === 'complex_s') {\n            this.timer--;\n            if (this.timer <= 0) {\n                this.state = 'free';\n                createProduct(this.x, this.y);\n            }\n        } else if (this.state === 'complex_i') {\n            this.timer--;\n            if (this.timer <= 0) this.state = 'free';\n        }\n    }\n}\n\nclass Particle {\n    constructor(type) {\n        this.type = type; // 's' (substrate), 'i' (inhibitor), 'p' (product)\n        this.x = Math.random() * simCanvas.width;\n        this.y = Math.random() * simCanvas.height;\n        this.vx = (Math.random() - 0.5) * PARTICLE_SPEED;\n        this.vy = (Math.random() - 0.5) * PARTICLE_SPEED;\n        this.life = 100; // only for product\n    }\n\n    draw(ctx) {\n        ctx.beginPath();\n        if (this.type === 's') {\n            ctx.fillStyle = '#2ecc71';\n            ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);\n        } else if (this.type === 'i') {\n            ctx.fillStyle = '#e74c3c';\n            // Triangle\n            ctx.moveTo(this.x, this.y - 4);\n            ctx.lineTo(this.x + 4, this.y + 4);\n            ctx.lineTo(this.x - 4, this.y + 4);\n        } else if (this.type === 'p') {\n            ctx.fillStyle = `rgba(241, 196, 15, ${this.life/50})`;\n            // Star/Sparkle approximation\n            ctx.arc(this.x, this.y, 5, 0, Math.PI*2);\n        }\n        ctx.fill();\n    }\n\n    update() {\n        this.x += this.vx;\n        this.y += this.vy;\n\n        // Wrap around\n        if (this.x < 0) this.x = simCanvas.width;\n        if (this.x > simCanvas.width) this.x = 0;\n        if (this.y < 0) this.y = simCanvas.height;\n        if (this.y > simCanvas.height) this.y = 0;\n\n        if (this.type === 'p') {\n            this.life--;\n        }\n    }\n}\n\nfunction createProduct(x, y) {\n    const p = new Particle('p');\n    p.x = x; p.y = y;\n    particles.push(p);\n}\n\n// Initialize Enzymes\nfunction initSim() {\n    const rect = simCanvas.getBoundingClientRect();\n    simCanvas.width = rect.width;\n    simCanvas.height = rect.height;\n    \n    enzymes = [];\n    for(let i=0; i<NUM_ENZYMES; i++) {\n        enzymes.push(new Enzyme(Math.random()*rect.width, Math.random()*rect.height));\n    }\n}\n\nfunction animateParticles() {\n    const rect = simCanvas.getBoundingClientRect();\n    if(simCanvas.width !== rect.width || simCanvas.height !== rect.height){\n        simCanvas.width = rect.width;\n        simCanvas.height = rect.height;\n    }\n    sCtx.clearRect(0, 0, simCanvas.width, simCanvas.height);\n\n    // 1. Manage Particle Counts based on Sliders\n    // Scale slider 0-1 to 0-50 particles\n    const targetS = Math.floor(state.s * 80); \n    const targetI = Math.floor(state.i * 80);\n\n    const currentS = particles.filter(p => p.type === 's').length;\n    const currentI = particles.filter(p => p.type === 'i').length;\n\n    // Adjust S\n    if (currentS < targetS) particles.push(new Particle('s'));\n    else if (currentS > targetS) {\n        const idx = particles.findIndex(p => p.type === 's');\n        if(idx > -1) particles.splice(idx, 1);\n    }\n\n    // Adjust I\n    if (currentI < targetI) particles.push(new Particle('i'));\n    else if (currentI > targetI) {\n        const idx = particles.findIndex(p => p.type === 'i');\n        if(idx > -1) particles.splice(idx, 1);\n    }\n\n    // 2. Update & Draw Particles\n    for (let i = particles.length - 1; i >= 0; i--) {\n        const p = particles[i];\n        p.update();\n        p.draw(sCtx);\n        if (p.type === 'p' && p.life <= 0) particles.splice(i, 1);\n    }\n\n    // 3. Update Enzymes & Collision Logic\n    enzymes.forEach(e => {\n        e.update();\n        e.draw(sCtx);\n\n        if (e.state === 'free') {\n            // Check collisions\n            for (let i = particles.length - 1; i >= 0; i--) {\n                const p = particles[i];\n                const dx = p.x - e.x;\n                const dy = p.y - e.y;\n                const dist = Math.sqrt(dx*dx + dy*dy);\n\n                if (dist < e.radius + 5) {\n                    // Collision!\n                    if (p.type === 's') {\n                        // Bind Substrate\n                        e.state = 'complex_s';\n                        // Processing time inversely proportional to Vmax (High Vmax = fast processing)\n                        // Simplified map: 0.001 -> 100 frames, 0.01 -> 10 frames\n                        e.timer = Math.max(10, 1 / (state.vmax * 2000)); \n                        particles.splice(i, 1);\n                        break;\n                    } else if (p.type === 'i') {\n                        // Bind Inhibitor\n                        e.state = 'complex_i';\n                        // Block time proportional to 1/Ki (Low Ki = strong binding = long time)\n                        // Simplified map: Ki 0.5 -> 20 frames, Ki 0.0001 -> 200 frames\n                        e.timer = Math.min(300, 10 / state.ki); \n                        particles.splice(i, 1);\n                        break;\n                    }\n                }\n            }\n        }\n    });\n\n    requestAnimationFrame(animateParticles);\n}\n\n// Bootstrap\nwindow.addEventListener('load', () => {\n    init();\n    initSim();\n});\n\nwindow.addEventListener('resize', initSim);"}}
{"input": {"input_text": "Batch reactor energy balance with constant density: dT/dt = (Qin - Ua*(T - Tc) + Hr*rV)/(rho*Cp*V). Provide temperature slope.", "simulation_name": " Batch Energy Balance", "domain": "Chemical Engineering", "description": "Lumped energy balance in batch reactor", "assumptions": ["Well-mixed", "Constant properties"], "entities": [], "constants": [], "parameters": [{"name": "heat_input", "symbol": "Qin", "unit": "W", "range": [-100000.0, 100000.0]}, {"name": "heat_transfer_coeff", "symbol": "Ua", "unit": "W/K", "range": [0, 10000.0]}, {"name": "coolant_temp", "symbol": "Tc", "unit": "K", "range": [250, 500]}, {"name": "heat_of_reaction", "symbol": "Hr", "unit": "J/mol", "range": [-500000.0, 500000.0]}, {"name": "reaction_rate", "symbol": "rV", "unit": "mol/s", "range": [-10, 10]}, {"name": "density", "symbol": "rho", "unit": "kg/m^3", "range": [500, 1500]}, {"name": "heat_capacity", "symbol": "Cp", "unit": "J/(kg*K)", "range": [1000, 5000]}, {"name": "volume", "symbol": "V", "unit": "m^3", "range": [0.01, 10]}, {"name": "temperature", "symbol": "T", "unit": "K", "range": [250, 600]}], "equations": [{"description": "Temperature slope", "expression": "dTdt = (Qin - Ua*(T - Tc) + Hr*rV)/(rho*Cp*V)"}], "initial_conditions": {}, "outputs": ["dTdt"], "simulation_controls": ["Qin", "Ua", "Tc", "Hr", "rV", "rho", "Cp", "V", "T"], "constraints": ["rho > 0", "Cp > 0", "V > 0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S29 Batch Reactor Energy Balance</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1>Batch Reactor Energy Balance</h1>\n            <p class=\"subtitle\">Lumped Parameter Simulation (S29)</p>\n        </header>\n\n        <main class=\"simulation-layout\">\n            <section class=\"controls-panel\">\n                <div class=\"control-group\">\n                    <h3><i class=\"fas fa-sliders-h\"></i> Parameters</h3>\n                    \n                    <div class=\"input-wrapper\">\n                        <label for=\"Qin\">Heat Input (Qin) <span class=\"unit\">[W]</span></label>\n                        <input type=\"range\" id=\"Qin\" min=\"-100000\" max=\"100000\" step=\"1000\" value=\"0\">\n                        <span class=\"value-display\" id=\"val-Qin\">0</span>\n                    </div>\n\n                    <div class=\"input-wrapper\">\n                        <label for=\"Ua\">Heat Transfer Coeff (Ua) <span class=\"unit\">[W/K]</span></label>\n                        <input type=\"range\" id=\"Ua\" min=\"0\" max=\"10000\" step=\"100\" value=\"1000\">\n                        <span class=\"value-display\" id=\"val-Ua\">1000</span>\n                    </div>\n\n                    <div class=\"input-wrapper\">\n                        <label for=\"Tc\">Coolant Temp (Tc) <span class=\"unit\">[K]</span></label>\n                        <input type=\"range\" id=\"Tc\" min=\"250\" max=\"500\" step=\"1\" value=\"298\">\n                        <span class=\"value-display\" id=\"val-Tc\">298</span>\n                    </div>\n\n                    <div class=\"input-wrapper\">\n                        <label for=\"Hr\">Heat of Reaction (Hr) <span class=\"unit\">[J/mol]</span></label>\n                        <input type=\"range\" id=\"Hr\" min=\"-500000\" max=\"500000\" step=\"5000\" value=\"-50000\">\n                        <span class=\"value-display\" id=\"val-Hr\">-50000</span>\n                    </div>\n\n                    <div class=\"input-wrapper\">\n                        <label for=\"rV\">Reaction Rate (rV) <span class=\"unit\">[mol/s]</span></label>\n                        <input type=\"range\" id=\"rV\" min=\"-10\" max=\"10\" step=\"0.1\" value=\"1\">\n                        <span class=\"value-display\" id=\"val-rV\">1</span>\n                    </div>\n\n                    <div class=\"input-wrapper\">\n                        <label for=\"rho\">Density (ρ) <span class=\"unit\">[kg/m³]</span></label>\n                        <input type=\"range\" id=\"rho\" min=\"500\" max=\"1500\" step=\"10\" value=\"1000\">\n                        <span class=\"value-display\" id=\"val-rho\">1000</span>\n                    </div>\n\n                    <div class=\"input-wrapper\">\n                        <label for=\"Cp\">Heat Capacity (Cp) <span class=\"unit\">[J/kg·K]</span></label>\n                        <input type=\"range\" id=\"Cp\" min=\"1000\" max=\"5000\" step=\"50\" value=\"4184\">\n                        <span class=\"value-display\" id=\"val-Cp\">4184</span>\n                    </div>\n\n                    <div class=\"input-wrapper\">\n                        <label for=\"V\">Volume (V) <span class=\"unit\">[m³]</span></label>\n                        <input type=\"range\" id=\"V\" min=\"0.01\" max=\"10\" step=\"0.01\" value=\"1.0\">\n                        <span class=\"value-display\" id=\"val-V\">1.0</span>\n                    </div>\n\n                    <div class=\"input-wrapper highlight-input\">\n                        <label for=\"T\">Reactor Temp (T) <span class=\"unit\">[K]</span></label>\n                        <input type=\"range\" id=\"T\" min=\"250\" max=\"600\" step=\"1\" value=\"300\">\n                        <span class=\"value-display\" id=\"val-T\">300</span>\n                    </div>\n                </div>\n            </section>\n\n            <section class=\"visuals-panel\">\n                <div class=\"equation-box\">\n                    <div class=\"math-display\">\n                        $$ \\frac{dT}{dt} = \\frac{Q_{in} - Ua(T - T_c) + H_r \\cdot rV}{\\rho \\cdot C_p \\cdot V} $$\n                    </div>\n                    <div class=\"result-display\">\n                        <span class=\"label\">Temperature Slope (dT/dt):</span>\n                        <span id=\"output-dTdt\" class=\"result-value\">0.000</span>\n                        <span class=\"unit\">K/s</span>\n                    </div>\n                </div>\n\n                <div class=\"reactor-container\">\n                    <div class=\"jacket\">\n                        <div class=\"coolant-label\">Coolant (Tc)</div>\n                        <div class=\"reactor-wall\">\n                            <div class=\"liquid\" id=\"liquid\">\n                                <div class=\"bubbles\"></div>\n                                <div class=\"mixer\">\n                                    <div class=\"shaft\"></div>\n                                    <div class=\"blade\"></div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <div id=\"arrow-qin\" class=\"arrow-indicator hidden\"><span class=\"arrow-label\">Qin</span></div>\n                    <div id=\"arrow-loss\" class=\"arrow-indicator hidden\"><span class=\"arrow-label\">Heat Transfer</span></div>\n                </div>\n\n                <div class=\"status-bar\">\n                    <div class=\"status-item\">\n                        <span class=\"status-label\">Reaction Energy:</span>\n                        <span id=\"stat-reaction\">0 W</span>\n                    </div>\n                    <div class=\"status-item\">\n                        <span class=\"status-label\">Transfer Energy:</span>\n                        <span id=\"stat-transfer\">0 W</span>\n                    </div>\n                    <div class=\"status-item\">\n                        <span class=\"status-label\">Net Energy Flow:</span>\n                        <span id=\"stat-net\">0 W</span>\n                    </div>\n                </div>\n            </section>\n        </main>\n    </div>\n\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-color: #f4f7f6;\n    --card-bg: #ffffff;\n    --primary: #2c3e50;\n    --accent: #3498db;\n    --text-color: #333;\n    --border-color: #e0e0e0;\n    --shadow: 0 4px 6px rgba(0,0,0,0.1);\n    \n    /* Temperature Gradients */\n    --cold: #3498db;\n    --hot: #e74c3c;\n}\n\n* {\n    box-sizing: border-box;\n    margin: 0;\n    padding: 0;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    height: 100vh;\n    display: flex;\n    flex-direction: column;\n}\n\n.container {\n    max-width: 1200px;\n    margin: 0 auto;\n    padding: 20px;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n}\n\nheader {\n    margin-bottom: 20px;\n    text-align: center;\n}\n\nheader h1 {\n    font-size: 1.8rem;\n    color: var(--primary);\n}\n\n.subtitle {\n    font-size: 0.9rem;\n    color: #666;\n}\n\n.simulation-layout {\n    display: grid;\n    grid-template-columns: 350px 1fr;\n    gap: 20px;\n    flex: 1;\n    overflow: hidden; /* Prevent scrolling if not needed */\n}\n\n/* Controls Panel */\n.controls-panel {\n    background: var(--card-bg);\n    padding: 20px;\n    border-radius: 12px;\n    box-shadow: var(--shadow);\n    overflow-y: auto;\n    max-height: calc(100vh - 150px);\n}\n\n.control-group h3 {\n    margin-bottom: 15px;\n    font-size: 1.1rem;\n    border-bottom: 2px solid var(--border-color);\n    padding-bottom: 5px;\n}\n\n.input-wrapper {\n    margin-bottom: 15px;\n}\n\n.input-wrapper label {\n    display: block;\n    font-size: 0.85rem;\n    font-weight: 600;\n    margin-bottom: 5px;\n    display: flex;\n    justify-content: space-between;\n}\n\n.unit {\n    color: #888;\n    font-weight: normal;\n    font-size: 0.75rem;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    cursor: pointer;\n}\n\n.value-display {\n    display: block;\n    text-align: right;\n    font-family: monospace;\n    font-size: 0.9rem;\n    color: var(--accent);\n}\n\n.highlight-input {\n    background-color: #f0f8ff;\n    padding: 10px;\n    border-radius: 8px;\n    border: 1px solid #bde0fe;\n}\n\n/* Visuals Panel */\n.visuals-panel {\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n}\n\n.equation-box {\n    background: var(--card-bg);\n    padding: 15px;\n    border-radius: 12px;\n    box-shadow: var(--shadow);\n    text-align: center;\n}\n\n.math-display {\n    font-size: 1.1rem;\n    margin-bottom: 10px;\n    color: var(--primary);\n}\n\n.result-display {\n    font-size: 1.2rem;\n    font-weight: bold;\n    color: var(--primary);\n    background: #f8f9fa;\n    padding: 10px;\n    border-radius: 8px;\n    display: inline-block;\n}\n\n#output-dTdt {\n    color: var(--accent);\n    margin: 0 5px;\n}\n\n/* Reactor Graphics */\n.reactor-container {\n    flex: 1;\n    background: var(--card-bg);\n    border-radius: 12px;\n    box-shadow: var(--shadow);\n    position: relative;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    min-height: 300px;\n}\n\n.jacket {\n    width: 200px;\n    height: 250px;\n    border: 8px solid #ccc; /* Coolant jacket color */\n    border-radius: 0 0 40px 40px;\n    position: relative;\n    padding: 5px;\n    transition: border-color 0.5s;\n}\n\n.coolant-label {\n    position: absolute;\n    top: 50%;\n    left: -80px;\n    font-size: 0.8rem;\n    color: #666;\n    transform: rotate(-90deg);\n}\n\n.reactor-wall {\n    width: 100%;\n    height: 100%;\n    background: rgba(255, 255, 255, 0.5);\n    border: 2px solid #999;\n    border-radius: 0 0 32px 32px; /* Slightly less than jacket */\n    overflow: hidden;\n    position: relative;\n}\n\n.liquid {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    width: 100%;\n    height: 80%; /* Assume 80% full for viz */\n    background: var(--cold);\n    transition: background-color 0.5s ease;\n    display: flex;\n    justify-content: center;\n}\n\n/* Bubbles for reaction */\n.bubbles {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    background-image: radial-gradient(rgba(255,255,255,0.6) 20%, transparent 20%);\n    background-size: 20px 20px;\n    opacity: 0;\n    animation: bubbleUp 1s linear infinite;\n}\n\n@keyframes bubbleUp {\n    0% { transform: translateY(0); }\n    100% { transform: translateY(-20px); }\n}\n\n/* Mixer */\n.mixer {\n    position: absolute;\n    top: -20px;\n    width: 6px;\n    height: 90%;\n    background: #555;\n    z-index: 2;\n}\n\n.blade {\n    position: absolute;\n    bottom: 0;\n    left: -25px;\n    width: 56px;\n    height: 8px;\n    background: #555;\n    animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n    from { transform: rotateY(0deg); }\n    to { transform: rotateY(360deg); }\n}\n\n/* Arrows */\n.arrow-indicator {\n    position: absolute;\n    font-size: 2rem;\n    font-weight: bold;\n    display: flex;\n    align-items: center;\n    transition: all 0.3s;\n}\n\n.arrow-label {\n    font-size: 0.8rem;\n    margin: 0 5px;\n    background: rgba(255,255,255,0.8);\n    padding: 2px 4px;\n    border-radius: 4px;\n}\n\n#arrow-qin {\n    top: 20px;\n    right: 20%;\n    /* Default pointing down */\n}\n\n#arrow-loss {\n    right: 30%;\n    top: 50%;\n}\n\n.status-bar {\n    background: var(--card-bg);\n    padding: 15px;\n    border-radius: 12px;\n    display: flex;\n    justify-content: space-around;\n    box-shadow: var(--shadow);\n    font-size: 0.9rem;\n}\n\n.status-item {\n    text-align: center;\n}\n\n.status-label {\n    display: block;\n    color: #666;\n    font-size: 0.75rem;\n    margin-bottom: 2px;\n}\n\n/* Responsive */\n@media (max-width: 800px) {\n    .simulation-layout {\n        grid-template-columns: 1fr;\n    }\n    .controls-panel {\n        max-height: 300px;\n    }\n}", "js": "document.addEventListener('DOMContentLoaded', () => {\n    // 1. Select DOM elements\n    const inputs = {\n        Qin: document.getElementById('Qin'),\n        Ua: document.getElementById('Ua'),\n        Tc: document.getElementById('Tc'),\n        Hr: document.getElementById('Hr'),\n        rV: document.getElementById('rV'),\n        rho: document.getElementById('rho'),\n        Cp: document.getElementById('Cp'),\n        V: document.getElementById('V'),\n        T: document.getElementById('T')\n    };\n\n    const displays = {\n        Qin: document.getElementById('val-Qin'),\n        Ua: document.getElementById('val-Ua'),\n        Tc: document.getElementById('val-Tc'),\n        Hr: document.getElementById('val-Hr'),\n        rV: document.getElementById('val-rV'),\n        rho: document.getElementById('val-rho'),\n        Cp: document.getElementById('val-Cp'),\n        V: document.getElementById('val-V'),\n        T: document.getElementById('val-T')\n    };\n\n    const outputs = {\n        dTdt: document.getElementById('output-dTdt'),\n        statReaction: document.getElementById('stat-reaction'),\n        statTransfer: document.getElementById('stat-transfer'),\n        statNet: document.getElementById('stat-net')\n    };\n\n    const visuals = {\n        liquid: document.getElementById('liquid'),\n        jacket: document.querySelector('.jacket'),\n        bubbles: document.querySelector('.bubbles'),\n        arrowQin: document.getElementById('arrow-qin'),\n        arrowLoss: document.getElementById('arrow-loss')\n    };\n\n    // 2. Helper to get values\n    const getVal = (key) => parseFloat(inputs[key].value);\n\n    // 3. Color Interpolation Logic (Blue to Red)\n    function getColorForTemp(temp) {\n        // Map 250K to 600K\n        const minT = 250;\n        const maxT = 600;\n        const ratio = Math.max(0, Math.min(1, (temp - minT) / (maxT - minT)));\n        \n        // Simple interpolation between Blue (0, 0, 255) and Red (255, 0, 0)\n        // Using HSL for better transition: Blue (240) -> Red (0)\n        const hue = 240 - (ratio * 240);\n        return `hsl(${hue}, 70%, 50%)`;\n    }\n\n    function getColorForCoolant(temp) {\n        // Similar mapping for jacket border\n        const minT = 250;\n        const maxT = 500;\n        const ratio = Math.max(0, Math.min(1, (temp - minT) / (maxT - minT)));\n        const hue = 240 - (ratio * 240);\n        return `hsl(${hue}, 60%, 70%)`; // Lighter pastel\n    }\n\n    // 4. Calculation Function\n    function updateSimulation() {\n        // Fetch current values\n        const params = {\n            Qin: getVal('Qin'),\n            Ua: getVal('Ua'),\n            Tc: getVal('Tc'),\n            Hr: getVal('Hr'),\n            rV: getVal('rV'),\n            rho: getVal('rho'),\n            Cp: getVal('Cp'),\n            V: getVal('V'),\n            T: getVal('T')\n        };\n\n        // Update Text Displays\n        for (const key in params) {\n            displays[key].textContent = params[key];\n        }\n\n        // --- Core Calculation ---\n        // Formula: dTdt = (Qin - Ua*(T - Tc) + Hr*rV) / (rho*Cp*V)\n        \n        const heatTransferTerm = params.Ua * (params.T - params.Tc); // Positive if T > Tc (Heat Loss)\n        const reactionHeatTerm = params.Hr * params.rV;\n        const numerator = params.Qin - heatTransferTerm + reactionHeatTerm;\n        const denominator = params.rho * params.Cp * params.V;\n\n        let dTdt = 0;\n        if (denominator > 0) {\n            dTdt = numerator / denominator;\n        }\n\n        // --- Update Output Display ---\n        outputs.dTdt.textContent = dTdt.toFixed(4);\n        \n        // Update Status Bar\n        outputs.statReaction.textContent = reactionHeatTerm.toFixed(0) + \" W\";\n        outputs.statTransfer.textContent = (-heatTransferTerm).toFixed(0) + \" W\"; // Negative of loss = gain\n        outputs.statNet.textContent = numerator.toFixed(0) + \" W\";\n\n        // Style the Slope text (Red if heating, Blue if cooling)\n        if (dTdt > 0.0001) outputs.dTdt.style.color = \"#e74c3c\"; // Red\n        else if (dTdt < -0.0001) outputs.dTdt.style.color = \"#3498db\"; // Blue\n        else outputs.dTdt.style.color = \"#333\";\n\n        // --- Update Visuals ---\n\n        // 1. Liquid Color based on T\n        visuals.liquid.style.backgroundColor = getColorForTemp(params.T);\n\n        // 2. Jacket Color based on Tc\n        visuals.jacket.style.borderColor = getColorForCoolant(params.Tc);\n\n        // 3. Bubbles (Reaction Intensity)\n        // Opacity based on magnitude of reaction heat\n        const reactionMag = Math.abs(reactionHeatTerm);\n        const maxReaction = 500000 * 10; // Approx max possible\n        const bubbleOpacity = Math.min(1, reactionMag / (maxReaction * 0.1)); // Scale it so it's visible earlier\n        visuals.bubbles.style.opacity = bubbleOpacity;\n\n        // 4. Qin Arrow\n        if (Math.abs(params.Qin) > 100) {\n            visuals.arrowQin.classList.remove('hidden');\n            if (params.Qin > 0) {\n                // Heat Entering (Red arrow pointing down)\n                visuals.arrowQin.innerHTML = `<span class=\"arrow-label\">Qin</span> <i class=\"fas fa-long-arrow-alt-down\" style=\"color:red\"></i>`;\n            } else {\n                // Heat Leaving (Blue arrow pointing up)\n                visuals.arrowQin.innerHTML = `<span class=\"arrow-label\">Qin</span> <i class=\"fas fa-long-arrow-alt-up\" style=\"color:blue\"></i>`;\n            }\n        } else {\n            visuals.arrowQin.classList.add('hidden');\n        }\n\n        // 5. Heat Transfer Arrow (Ua term)\n        // Term is Ua(T-Tc). If T > Tc, heat flows OUT. If T < Tc, heat flows IN.\n        if (params.Ua > 0 && Math.abs(params.T - params.Tc) > 1) {\n            visuals.arrowLoss.classList.remove('hidden');\n            if (params.T > params.Tc) {\n                // T is hotter, Heat leaving reactor (Arrow pointing out right)\n                visuals.arrowLoss.innerHTML = `<i class=\"fas fa-long-arrow-alt-right\" style=\"color:orange\"></i>`;\n                visuals.arrowLoss.style.right = \"5%\"; // Move to outside wall\n            } else {\n                // T is cooler, Heat entering from jacket (Arrow pointing in left)\n                visuals.arrowLoss.innerHTML = `<i class=\"fas fa-long-arrow-alt-left\" style=\"color:orange\"></i>`;\n                visuals.arrowLoss.style.right = \"15%\"; // Move to inside wall\n            }\n        } else {\n            visuals.arrowLoss.classList.add('hidden');\n        }\n    }\n\n    // 5. Event Listeners\n    Object.values(inputs).forEach(input => {\n        input.addEventListener('input', updateSimulation);\n    });\n\n    // Initial Run\n    updateSimulation();\n});"}}
{"input": {"input_text": "CSTR first-order irreversible A -> products with feed concentration Cf, residence time tau. Steady-state C = Cf/(1 + k*tau).", "simulation_name": " CSTR First Order", "domain": "Chemical Engineering", "description": "Steady CSTR conversion first order", "assumptions": ["Steady state", "Well-mixed"], "entities": [], "constants": [], "parameters": [{"name": "feed_concentration", "symbol": "Cf", "unit": "mol/L", "range": [0, 5]}, {"name": "rate_constant", "symbol": "k", "unit": "1/s", "range": [1e-05, 1]}, {"name": "residence_time", "symbol": "tau", "unit": "s", "range": [0.01, 100000.0]}], "equations": [{"description": "Outlet concentration", "expression": "C = Cf/(1 + k*tau)"}, {"description": "Conversion", "expression": "X = 1 - C/Cf"}], "initial_conditions": {}, "outputs": ["C", "X"], "simulation_controls": ["Cf", "k", "tau"], "constraints": ["Cf >= 0", "k >= 0", "tau > 0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S30 CSTR First Order Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n\n    <div class=\"container\">\n        <header>\n            <h1>CSTR First Order Reaction</h1>\n            <p>Steady-state simulation of an irreversible reaction A &rarr; Products</p>\n        </header>\n\n        <div class=\"simulation-layout\">\n            \n            <div class=\"controls-panel\">\n                <h2>Parameters</h2>\n                \n                <div class=\"control-group\">\n                    <label for=\"feedConc\">\n                        Feed Concentration ($C_f$)\n                        <span class=\"unit\">[mol/L]</span>\n                    </label>\n                    <input type=\"range\" id=\"feedConc\" min=\"0\" max=\"5\" step=\"0.1\" value=\"2.0\">\n                    <div class=\"value-display\"><span id=\"val-feedConc\">2.0</span></div>\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"rateConst\">\n                        Rate Constant ($k$)\n                        <span class=\"unit\">[1/s]</span>\n                    </label>\n                    <input type=\"range\" id=\"rateConst\" min=\"0.00001\" max=\"1\" step=\"0.001\" value=\"0.1\">\n                    <div class=\"value-display\"><span id=\"val-rateConst\">0.1</span></div>\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"resTime\">\n                        Residence Time ($\\tau$)\n                        <span class=\"unit\">[s]</span>\n                    </label>\n                    <input type=\"range\" id=\"resTime\" min=\"0.1\" max=\"50\" step=\"0.1\" value=\"10.0\">\n                    <div class=\"value-display\"><span id=\"val-resTime\">10.0</span></div>\n                </div>\n\n                <div class=\"equations-box\">\n                    <h3>Model Equations</h3>\n                    <p>$$C = \\frac{C_f}{1 + k\\tau}$$</p>\n                    <p>$$X = 1 - \\frac{C}{C_f}$$</p>\n                </div>\n            </div>\n\n            <div class=\"visual-panel\">\n                <canvas id=\"simCanvas\"></canvas>\n            </div>\n\n            <div class=\"results-panel\">\n                <h2>Outputs</h2>\n                <div class=\"output-card\">\n                    <div class=\"output-label\">Outlet Conc. ($C$)</div>\n                    <div class=\"output-value\" id=\"out-C\">0.00</div>\n                    <div class=\"output-unit\">mol/L</div>\n                </div>\n                <div class=\"output-card\">\n                    <div class=\"output-label\">Conversion ($X$)</div>\n                    <div class=\"output-value\" id=\"out-X\">0.00</div>\n                    <div class=\"output-unit\">%</div>\n                </div>\n                \n                <div class=\"assumptions\">\n                    <strong>Assumptions:</strong> Steady state, Well-mixed, Constant density.\n                </div>\n            </div>\n\n        </div>\n    </div>\n\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary-color: #2c3e50;\n    --accent-color: #3498db;\n    --bg-color: #f4f7f6;\n    --panel-bg: #ffffff;\n    --text-color: #333;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n}\n\n.container {\n    max-width: 1200px;\n    width: 100%;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 30px;\n}\n\nheader h1 {\n    color: var(--primary-color);\n    margin: 0;\n}\n\n.simulation-layout {\n    display: grid;\n    grid-template-columns: 300px 1fr 250px;\n    gap: 20px;\n    align-items: start;\n}\n\n@media (max-width: 900px) {\n    .simulation-layout {\n        grid-template-columns: 1fr;\n    }\n}\n\n/* Panels */\n.controls-panel, .results-panel, .visual-panel {\n    background: var(--panel-bg);\n    padding: 20px;\n    border-radius: 8px;\n    box-shadow: 0 2px 10px rgba(0,0,0,0.05);\n}\n\nh2 {\n    margin-top: 0;\n    font-size: 1.2rem;\n    border-bottom: 2px solid var(--bg-color);\n    padding-bottom: 10px;\n    color: var(--primary-color);\n}\n\n/* Controls */\n.control-group {\n    margin-bottom: 20px;\n}\n\n.control-group label {\n    display: block;\n    font-weight: 600;\n    margin-bottom: 5px;\n    font-size: 0.9rem;\n}\n\n.unit {\n    font-weight: normal;\n    color: #777;\n    font-size: 0.85rem;\n}\n\ninput[type=range] {\n    width: 100%;\n    cursor: pointer;\n}\n\n.value-display {\n    text-align: right;\n    font-weight: bold;\n    color: var(--accent-color);\n}\n\n.equations-box {\n    background-color: var(--bg-color);\n    padding: 10px;\n    border-radius: 5px;\n    margin-top: 20px;\n    font-size: 0.9rem;\n}\n\n/* Canvas */\n.visual-panel {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    min-height: 400px;\n}\n\ncanvas {\n    width: 100%;\n    max-width: 600px;\n    height: 400px;\n}\n\n/* Results */\n.output-card {\n    background: var(--bg-color);\n    padding: 15px;\n    border-radius: 6px;\n    margin-bottom: 15px;\n    text-align: center;\n    border-left: 4px solid var(--accent-color);\n}\n\n.output-label {\n    font-size: 0.9rem;\n    color: #666;\n}\n\n.output-value {\n    font-size: 1.8rem;\n    font-weight: bold;\n    color: var(--primary-color);\n    margin: 5px 0;\n}\n\n.output-unit {\n    font-size: 0.8rem;\n    color: #888;\n}\n\n.assumptions {\n    font-size: 0.8rem;\n    color: #666;\n    margin-top: 20px;\n    border-top: 1px solid #eee;\n    padding-top: 10px;\n}", "js": "document.addEventListener('DOMContentLoaded', () => {\n    // Canvas Setup\n    const canvas = document.getElementById('simCanvas');\n    const ctx = canvas.getContext('2d');\n    \n    // Set actual canvas size to match display size for sharp rendering\n    function resizeCanvas() {\n        const rect = canvas.getBoundingClientRect();\n        canvas.width = rect.width;\n        canvas.height = rect.height;\n    }\n    window.addEventListener('resize', resizeCanvas);\n    resizeCanvas();\n\n    // DOM Elements\n    const inputs = {\n        Cf: document.getElementById('feedConc'),\n        k: document.getElementById('rateConst'),\n        tau: document.getElementById('resTime')\n    };\n\n    const displays = {\n        Cf: document.getElementById('val-feedConc'),\n        k: document.getElementById('val-rateConst'),\n        tau: document.getElementById('val-resTime')\n    };\n\n    const outputs = {\n        C: document.getElementById('out-C'),\n        X: document.getElementById('out-X')\n    };\n\n    // State\n    let state = {\n        Cf: parseFloat(inputs.Cf.value),\n        k: parseFloat(inputs.k.value),\n        tau: parseFloat(inputs.tau.value),\n        C: 0,\n        X: 0\n    };\n\n    // Particles for animation\n    const particles = [];\n    const NUM_PARTICLES = 50;\n\n    // --- Calculation Logic ---\n    function calculate() {\n        // C = Cf / (1 + k*tau)\n        state.C = state.Cf / (1 + state.k * state.tau);\n        \n        // X = 1 - C/Cf\n        // Handle divide by zero edge case if Cf is 0\n        if (state.Cf === 0) {\n            state.X = 0; \n        } else {\n            state.X = 1 - (state.C / state.Cf);\n        }\n\n        updateUI();\n    }\n\n    function updateUI() {\n        // Update number displays\n        displays.Cf.textContent = state.Cf.toFixed(2);\n        displays.k.textContent = state.k.toFixed(4); // k can be small\n        displays.tau.textContent = state.tau.toFixed(1);\n\n        // Update Results\n        outputs.C.textContent = state.C.toFixed(3);\n        outputs.X.textContent = (state.X * 100).toFixed(1);\n    }\n\n    // --- Event Listeners ---\n    Object.keys(inputs).forEach(key => {\n        inputs[key].addEventListener('input', (e) => {\n            state[key] = parseFloat(e.target.value);\n            calculate();\n        });\n    });\n\n    // --- Animation Logic ---\n    \n    // Helper to get color based on concentration\n    // Interpolate between light blue (low conc) and deep blue (high conc)\n    function getColor(concentration) {\n        // Max concentration in range is 5, normalize to 0-1\n        const intensity = Math.min(concentration / 5.0, 1);\n        // RGB for a nice blue: 52, 152, 219\n        const r = 52, g = 152, b = 219;\n        return `rgba(${r}, ${g}, ${b}, ${0.1 + intensity * 0.9})`;\n    }\n\n    class Particle {\n        constructor() {\n            this.reset();\n        }\n\n        reset() {\n            // Start at the inlet pipe (left side)\n            this.x = 0;\n            this.y = canvas.height * 0.35 + Math.random() * 20;\n            this.vx = 2 + Math.random();\n            this.vy = 0;\n            this.stage = 'inlet'; // inlet, tank, outlet\n            this.radius = 2 + Math.random() * 2;\n        }\n\n        update() {\n            const tankX = canvas.width * 0.3;\n            const tankWidth = canvas.width * 0.4;\n            const tankY = canvas.height * 0.2;\n            const tankHeight = canvas.height * 0.6;\n            const liquidLevel = tankY + tankHeight * 0.2; // Top of liquid\n\n            if (this.stage === 'inlet') {\n                this.x += this.vx;\n                if (this.x > tankX + 20) {\n                    this.stage = 'tank';\n                    this.x = tankX + 20 + Math.random() * (tankWidth - 40);\n                    this.y = liquidLevel + Math.random() * (tankHeight * 0.8 - 20);\n                    // Random motion in tank (well mixed)\n                    this.vx = (Math.random() - 0.5) * 2;\n                    this.vy = (Math.random() - 0.5) * 2;\n                }\n            } else if (this.stage === 'tank') {\n                this.x += this.vx;\n                this.y += this.vy;\n\n                // Bounce off walls\n                if (this.x < tankX + 10 || this.x > tankX + tankWidth - 10) this.vx *= -1;\n                if (this.y < liquidLevel + 5 || this.y > tankY + tankHeight - 5) this.vy *= -1;\n\n                // Chance to exit\n                if (Math.random() < 0.01) {\n                    this.stage = 'outlet';\n                    this.x = tankX + tankWidth;\n                    this.y = canvas.height * 0.8; // Outlet pipe height\n                    this.vx = 2 + Math.random();\n                    this.vy = 0;\n                }\n            } else if (this.stage === 'outlet') {\n                this.x += this.vx;\n                if (this.x > canvas.width) {\n                    this.reset();\n                }\n            }\n        }\n\n        draw() {\n            ctx.beginPath();\n            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);\n            \n            // Color depends on stage\n            if (this.stage === 'inlet') {\n                ctx.fillStyle = getColor(state.Cf);\n            } else {\n                // Tank and outlet have concentration C\n                ctx.fillStyle = getColor(state.C);\n            }\n            ctx.fill();\n        }\n    }\n\n    // Initialize particles\n    for (let i = 0; i < NUM_PARTICLES; i++) {\n        particles.push(new Particle());\n    }\n\n    function drawSystem() {\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n        const w = canvas.width;\n        const h = canvas.height;\n        \n        const tankX = w * 0.3;\n        const tankY = h * 0.2;\n        const tankWidth = w * 0.4;\n        const tankHeight = h * 0.6;\n        \n        // --- Draw Pipes ---\n        ctx.strokeStyle = '#888';\n        ctx.lineWidth = 4;\n\n        // Inlet Pipe\n        const pipeHeight = 30;\n        const inletY = h * 0.35;\n        \n        // Inlet Fluid Background\n        ctx.fillStyle = getColor(state.Cf);\n        ctx.fillRect(0, inletY, tankX, pipeHeight);\n        \n        // Inlet Pipe Borders\n        ctx.beginPath();\n        ctx.moveTo(0, inletY);\n        ctx.lineTo(tankX, inletY);\n        ctx.moveTo(0, inletY + pipeHeight);\n        ctx.lineTo(tankX, inletY + pipeHeight);\n        ctx.stroke();\n\n        // Outlet Pipe\n        const outletY = h * 0.8;\n        \n        // Outlet Fluid Background\n        ctx.fillStyle = getColor(state.C);\n        ctx.fillRect(tankX + tankWidth, outletY, w - (tankX + tankWidth), pipeHeight);\n\n        // Outlet Pipe Borders\n        ctx.beginPath();\n        ctx.moveTo(tankX + tankWidth, outletY);\n        ctx.lineTo(w, outletY);\n        ctx.moveTo(tankX + tankWidth, outletY + pipeHeight);\n        ctx.lineTo(w, outletY + pipeHeight);\n        ctx.stroke();\n\n        // --- Draw Tank ---\n        // Tank Content (Fluid)\n        const liquidLevel = tankY + tankHeight * 0.2; // Not full to show stirring\n        ctx.fillStyle = getColor(state.C);\n        ctx.fillRect(tankX, liquidLevel, tankWidth, tankHeight * 0.8);\n\n        // Tank Walls\n        ctx.beginPath();\n        ctx.moveTo(tankX, tankY);\n        ctx.lineTo(tankX, tankY + tankHeight);\n        ctx.lineTo(tankX + tankWidth, tankY + tankHeight);\n        ctx.lineTo(tankX + tankWidth, tankY);\n        ctx.stroke();\n\n        // --- Impeller/Stirrer ---\n        const stirrerX = tankX + tankWidth / 2;\n        ctx.beginPath();\n        ctx.moveTo(stirrerX, tankY - 20); // Motor\n        ctx.lineTo(stirrerX, liquidLevel + tankHeight * 0.5); // Shaft\n        ctx.stroke();\n\n        // Blades\n        const time = Date.now() * 0.005; // speed depends on nothing (constant visual)\n        const bladeWidth = 40 * Math.sin(time); \n        ctx.lineWidth = 6;\n        ctx.beginPath();\n        ctx.moveTo(stirrerX - bladeWidth, liquidLevel + tankHeight * 0.5);\n        ctx.lineTo(stirrerX + bladeWidth, liquidLevel + tankHeight * 0.5);\n        ctx.stroke();\n        ctx.lineWidth = 4; // Reset\n\n        // Labels\n        ctx.fillStyle = \"#333\";\n        ctx.font = \"14px Arial\";\n        ctx.fillText(\"Feed\", 10, inletY - 10);\n        ctx.fillText(`C = ${state.Cf.toFixed(2)}`, 10, inletY + 50);\n        \n        ctx.fillText(\"Product\", w - 80, outletY - 10);\n        ctx.fillText(`C = ${state.C.toFixed(2)}`, w - 80, outletY + 50);\n        \n        // --- Draw Particles ---\n        particles.forEach(p => {\n            p.update();\n            p.draw();\n        });\n\n        requestAnimationFrame(drawSystem);\n    }\n\n    // Initial Calculation and Start Loop\n    calculate();\n    drawSystem();\n});"}}
{"input": {"input_text": "Plug flow reactor first-order A -> products: C = Cf*exp(-k*tau). Compute outlet concentration.", "simulation_name": " PFR First Order", "domain": "Chemical Engineering", "description": "PFR conversion first order", "assumptions": ["Isothermal", "No axial mixing"], "entities": [], "constants": [], "parameters": [{"name": "feed_concentration", "symbol": "Cf", "unit": "mol/L", "range": [0, 5]}, {"name": "rate_constant", "symbol": "k", "unit": "1/s", "range": [1e-05, 1]}, {"name": "space_time", "symbol": "tau", "unit": "s", "range": [0.01, 100000.0]}], "equations": [{"description": "Outlet concentration", "expression": "C = Cf*exp(-k*tau)"}, {"description": "Conversion", "expression": "X = 1 - exp(-k*tau)"}], "initial_conditions": {}, "outputs": ["C", "X"], "simulation_controls": ["Cf", "k", "tau"], "constraints": ["Cf >= 0", "k >= 0", "tau > 0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>PFR First Order Reactor Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js\"></script>\n</head>\n<body>\n    <div class=\"container\">\n        <!-- Header -->\n        <div class=\"header\">\n            <h1>Plug Flow Reactor - First Order Reaction</h1>\n            <p class=\"subtitle\">A → Products | C = C<sub>f</sub> · exp(-k·τ)</p>\n            <div class=\"tags\">\n                <span class=\"tag tag-blue\">Isothermal</span>\n                <span class=\"tag tag-green\">No Axial Mixing</span>\n            </div>\n        </div>\n\n        <div class=\"main-grid\">\n            <!-- Controls Panel -->\n            <div class=\"controls-panel\">\n                <div class=\"card\">\n                    <h2>Control Parameters</h2>\n                    \n                    <!-- Feed Concentration -->\n                    <div class=\"control-group\">\n                        <label>\n                            Feed Concentration (C<sub>f</sub>): <span id=\"cf-value\">2.00</span> mol/L\n                        </label>\n                        <input type=\"range\" id=\"cf-slider\" min=\"0\" max=\"5\" step=\"0.1\" value=\"2.0\" class=\"slider slider-blue\">\n                    </div>\n\n                    <!-- Rate Constant -->\n                    <div class=\"control-group\">\n                        <label>\n                            Rate Constant (k): <span id=\"k-value\">0.1000</span> s<sup>-1</sup>\n                        </label>\n                        <input type=\"range\" id=\"k-slider\" min=\"0.00001\" max=\"1\" step=\"0.00001\" value=\"0.1\" class=\"slider slider-green\">\n                        <input type=\"number\" id=\"k-input\" value=\"0.1\" step=\"0.001\" class=\"number-input\">\n                    </div>\n\n                    <!-- Space Time -->\n                    <div class=\"control-group\">\n                        <label>\n                            Space Time (τ): <span id=\"tau-value\">10.00</span> s\n                        </label>\n                        <input type=\"range\" id=\"tau-slider\" min=\"0.01\" max=\"100\" step=\"0.1\" value=\"10\" class=\"slider slider-purple\">\n                        <input type=\"number\" id=\"tau-input\" value=\"10\" step=\"1\" class=\"number-input\">\n                    </div>\n\n                    <button id=\"animate-btn\" class=\"animate-btn\">Animate Flow</button>\n                </div>\n\n                <!-- Results -->\n                <div class=\"card results-card\">\n                    <h2>Results</h2>\n                    <div class=\"result-item result-blue\">\n                        <p class=\"result-label\">Outlet Concentration</p>\n                        <p class=\"result-value\" id=\"outlet-conc\">0.0000 mol/L</p>\n                    </div>\n                    <div class=\"result-item result-green\">\n                        <p class=\"result-label\">Conversion</p>\n                        <p class=\"result-value\" id=\"conversion\">0.00%</p>\n                    </div>\n                    <div class=\"result-item result-purple\">\n                        <p class=\"result-label\">Damköhler Number (Da)</p>\n                        <p class=\"result-value\" id=\"damkohler\">0.0000</p>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Visualization Panel -->\n            <div class=\"visualization-panel\">\n                <!-- Reactor Animation -->\n                <div class=\"card\">\n                    <h2>Reactor Visualization</h2>\n                    <div class=\"reactor-container\">\n                        <div class=\"reactor-tube\">\n                            <div class=\"concentration-gradient\"></div>\n                            <div class=\"flow-particle\" id=\"particle\"></div>\n                            <div class=\"reactor-label label-inlet\">IN: <span id=\"inlet-label\">2.00</span></div>\n                            <div class=\"reactor-label label-outlet\">OUT: <span id=\"outlet-label\">0.00</span></div>\n                        </div>\n                        <div class=\"arrow arrow-left\">→</div>\n                        <div class=\"arrow arrow-right\">→</div>\n                    </div>\n                </div>\n\n                <!-- Concentration Profile Chart -->\n                <div class=\"card\">\n                    <h2>Concentration Profile</h2>\n                    <div class=\"chart-container\">\n                        <canvas id=\"profileChart\"></canvas>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, #e0f2fe 0%, #c7d2fe 100%);\n    min-height: 100vh;\n    padding: 2rem;\n}\n\n.container {\n    max-width: 1400px;\n    margin: 0 auto;\n}\n\n/* Header */\n.header {\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    padding: 2rem;\n    margin-bottom: 2rem;\n}\n\n.header h1 {\n    color: #312e81;\n    font-size: 2rem;\n    margin-bottom: 0.5rem;\n}\n\n.subtitle {\n    color: #6b7280;\n    font-size: 1rem;\n    margin-bottom: 1rem;\n}\n\n.tags {\n    display: flex;\n    gap: 1rem;\n}\n\n.tag {\n    padding: 0.5rem 1rem;\n    border-radius: 20px;\n    font-size: 0.875rem;\n    font-weight: 500;\n}\n\n.tag-blue {\n    background: #dbeafe;\n    color: #1e40af;\n}\n\n.tag-green {\n    background: #d1fae5;\n    color: #065f46;\n}\n\n/* Main Grid */\n.main-grid {\n    display: grid;\n    grid-template-columns: 1fr 2fr;\n    gap: 1.5rem;\n}\n\n@media (max-width: 1024px) {\n    .main-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n/* Card */\n.card {\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    padding: 1.5rem;\n    margin-bottom: 1.5rem;\n}\n\n.card h2 {\n    color: #1f2937;\n    font-size: 1.25rem;\n    margin-bottom: 1.5rem;\n}\n\n/* Control Groups */\n.control-group {\n    margin-bottom: 2rem;\n}\n\n.control-group label {\n    display: block;\n    color: #374151;\n    font-weight: 600;\n    font-size: 0.875rem;\n    margin-bottom: 0.5rem;\n}\n\n.control-group label span {\n    font-weight: 700;\n    color: #111827;\n}\n\n/* Sliders */\n.slider {\n    width: 100%;\n    height: 8px;\n    border-radius: 5px;\n    outline: none;\n    -webkit-appearance: none;\n    cursor: pointer;\n}\n\n.slider-blue {\n    background: #bfdbfe;\n}\n\n.slider-green {\n    background: #bbf7d0;\n}\n\n.slider-purple {\n    background: #e9d5ff;\n}\n\n.slider::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #4f46e5;\n    cursor: pointer;\n}\n\n.slider::-moz-range-thumb {\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #4f46e5;\n    cursor: pointer;\n    border: none;\n}\n\n.number-input {\n    width: 100%;\n    margin-top: 0.5rem;\n    padding: 0.5rem;\n    border: 1px solid #d1d5db;\n    border-radius: 6px;\n    font-size: 0.875rem;\n}\n\n/* Animate Button */\n.animate-btn {\n    width: 100%;\n    background: #4f46e5;\n    color: white;\n    padding: 1rem;\n    border: none;\n    border-radius: 8px;\n    font-size: 1rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: background 0.3s;\n}\n\n.animate-btn:hover {\n    background: #4338ca;\n}\n\n/* Results */\n.results-card {\n    margin-bottom: 0;\n}\n\n.result-item {\n    padding: 1rem;\n    border-radius: 8px;\n    margin-bottom: 1rem;\n}\n\n.result-item:last-child {\n    margin-bottom: 0;\n}\n\n.result-blue {\n    background: #eff6ff;\n}\n\n.result-green {\n    background: #f0fdf4;\n}\n\n.result-purple {\n    background: #faf5ff;\n}\n\n.result-label {\n    color: #6b7280;\n    font-size: 0.875rem;\n    margin-bottom: 0.25rem;\n}\n\n.result-value {\n    font-size: 1.5rem;\n    font-weight: 700;\n}\n\n.result-blue .result-value {\n    color: #1d4ed8;\n}\n\n.result-green .result-value {\n    color: #15803d;\n}\n\n.result-purple .result-value {\n    color: #7c3aed;\n}\n\n/* Reactor Visualization */\n.reactor-container {\n    position: relative;\n    height: 192px;\n    background: linear-gradient(to right, #f3f4f6, #f9fafb);\n    border-radius: 8px;\n    border: 2px solid #d1d5db;\n    overflow: hidden;\n}\n\n.reactor-tube {\n    position: absolute;\n    top: 50%;\n    left: 0;\n    right: 0;\n    height: 96px;\n    transform: translateY(-50%);\n    background: linear-gradient(to right, #60a5fa, #93c5fd);\n}\n\n.concentration-gradient {\n    position: absolute;\n    inset: 0;\n    background: linear-gradient(to right, #2563eb, #93c5fd);\n    opacity: 0.6;\n}\n\n.flow-particle {\n    position: absolute;\n    top: 50%;\n    left: -20px;\n    width: 16px;\n    height: 16px;\n    background: #fbbf24;\n    border-radius: 50%;\n    transform: translateY(-50%);\n    box-shadow: 0 0 10px rgba(251, 191, 36, 0.6);\n    opacity: 0;\n}\n\n.flow-particle.animating {\n    opacity: 1;\n    animation: flowAnimation 3s linear;\n}\n\n@keyframes flowAnimation {\n    0% {\n        left: 0%;\n    }\n    100% {\n        left: 100%;\n    }\n}\n\n.reactor-label {\n    position: absolute;\n    top: 50%;\n    transform: translateY(-50%);\n    font-size: 0.75rem;\n    font-weight: 700;\n    color: white;\n    background: rgba(0, 0, 0, 0.5);\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n}\n\n.label-inlet {\n    left: 8px;\n}\n\n.label-outlet {\n    right: 8px;\n}\n\n.arrow {\n    position: absolute;\n    top: 50%;\n    transform: translateY(-50%);\n    font-size: 3rem;\n    color: #2563eb;\n}\n\n.arrow-left {\n    left: 0;\n}\n\n.arrow-right {\n    right: 0;\n    color: #60a5fa;\n}\n\n/* Chart */\n.chart-container {\n    position: relative;\n    height: 300px;\n    width: 100%;\n}\n\n@media (max-width: 768px) {\n    body {\n        padding: 1rem;\n    }\n\n    .header h1 {\n        font-size: 1.5rem;\n    }\n\n    .tags {\n        flex-direction: column;\n    }\n}", "js": "// Global variables\nlet Cf = 2.0;\nlet k = 0.1;\nlet tau = 10;\nlet chart = null;\n\n// Calculate outlet concentration and conversion\nfunction calculate(cfVal, kVal, tauVal) {\n    const outlet = cfVal * Math.exp(-kVal * tauVal);\n    const conversion = 1 - Math.exp(-kVal * tauVal);\n    const damkohler = kVal * tauVal;\n    return { outlet, conversion, damkohler };\n}\n\n// Generate concentration profile data\nfunction generateProfile() {\n    const points = 100;\n    const timeData = [];\n    const concentrationData = [];\n    const conversionData = [];\n    \n    for (let i = 0; i <= points; i++) {\n        const t = (tau * i) / points;\n        const conc = Cf * Math.exp(-k * t);\n        const conv = (1 - Math.exp(-k * t)) * 100;\n        \n        timeData.push(t.toFixed(2));\n        concentrationData.push(conc);\n        conversionData.push(conv);\n    }\n    \n    return { timeData, concentrationData, conversionData };\n}\n\n// Update all displays\nfunction updateDisplay() {\n    const result = calculate(Cf, k, tau);\n    \n    // Update result displays\n    document.getElementById('outlet-conc').textContent = result.outlet.toFixed(4) + ' mol/L';\n    document.getElementById('conversion').textContent = (result.conversion * 100).toFixed(2) + '%';\n    document.getElementById('damkohler').textContent = result.damkohler.toFixed(4);\n    \n    // Update reactor labels\n    document.getElementById('inlet-label').textContent = Cf.toFixed(2);\n    document.getElementById('outlet-label').textContent = result.outlet.toFixed(2);\n    \n    // Update chart\n    updateChart();\n}\n\n// Initialize chart\nfunction initChart() {\n    const ctx = document.getElementById('profileChart').getContext('2d');\n    const profileData = generateProfile();\n    \n    chart = new Chart(ctx, {\n        type: 'line',\n        data: {\n            labels: profileData.timeData,\n            datasets: [\n                {\n                    label: 'Concentration (mol/L)',\n                    data: profileData.concentrationData,\n                    borderColor: '#3b82f6',\n                    backgroundColor: 'rgba(59, 130, 246, 0.1)',\n                    borderWidth: 2,\n                    yAxisID: 'y',\n                    tension: 0.4,\n                    pointRadius: 0\n                },\n                {\n                    label: 'Conversion (%)',\n                    data: profileData.conversionData,\n                    borderColor: '#10b981',\n                    backgroundColor: 'rgba(16, 185, 129, 0.1)',\n                    borderWidth: 2,\n                    yAxisID: 'y1',\n                    tension: 0.4,\n                    pointRadius: 0\n                }\n            ]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            interaction: {\n                mode: 'index',\n                intersect: false,\n            },\n            plugins: {\n                legend: {\n                    position: 'top',\n                },\n                tooltip: {\n                    callbacks: {\n                        label: function(context) {\n                            let label = context.dataset.label || '';\n                            if (label) {\n                                label += ': ';\n                            }\n                            label += context.parsed.y.toFixed(4);\n                            return label;\n                        }\n                    }\n                }\n            },\n            scales: {\n                x: {\n                    display: true,\n                    title: {\n                        display: true,\n                        text: 'Space Time (s)'\n                    },\n                    ticks: {\n                        maxTicksLimit: 10\n                    }\n                },\n                y: {\n                    type: 'linear',\n                    display: true,\n                    position: 'left',\n                    title: {\n                        display: true,\n                        text: 'Concentration (mol/L)'\n                    },\n                    beginAtZero: true\n                },\n                y1: {\n                    type: 'linear',\n                    display: true,\n                    position: 'right',\n                    title: {\n                        display: true,\n                        text: 'Conversion (%)'\n                    },\n                    beginAtZero: true,\n                    max: 100,\n                    grid: {\n                        drawOnChartArea: false,\n                    }\n                }\n            }\n        }\n    });\n}\n\n// Update chart data\nfunction updateChart() {\n    if (chart) {\n        const profileData = generateProfile();\n        chart.data.labels = profileData.timeData;\n        chart.data.datasets[0].data = profileData.concentrationData;\n        chart.data.datasets[1].data = profileData.conversionData;\n        chart.update('none');\n    }\n}\n\n// Animate flow particle\nfunction animateFlow() {\n    const particle = document.getElementById('particle');\n    particle.classList.remove('animating');\n    \n    // Force reflow\n    void particle.offsetWidth;\n    \n    particle.classList.add('animating');\n    \n    // Remove class after animation\n    setTimeout(() => {\n        particle.classList.remove('animating');\n    }, 3000);\n}\n\n// Event listeners\ndocument.addEventListener('DOMContentLoaded', function() {\n    // Feed Concentration slider\n    const cfSlider = document.getElementById('cf-slider');\n    const cfValue = document.getElementById('cf-value');\n    \n    cfSlider.addEventListener('input', function() {\n        Cf = parseFloat(this.value);\n        cfValue.textContent = Cf.toFixed(2);\n        updateDisplay();\n    });\n    \n    // Rate Constant slider\n    const kSlider = document.getElementById('k-slider');\n    const kValue = document.getElementById('k-value');\n    const kInput = document.getElementById('k-input');\n    \n    kSlider.addEventListener('input', function() {\n        k = parseFloat(this.value);\n        kValue.textContent = k.toFixed(4);\n        kInput.value = k;\n        updateDisplay();\n    });\n    \n    kInput.addEventListener('input', function() {\n        let val = parseFloat(this.value);\n        if (val < 0.00001) val = 0.00001;\n        if (val > 1) val = 1;\n        k = val;\n        kSlider.value = k;\n        kValue.textContent = k.toFixed(4);\n        updateDisplay();\n    });\n    \n    // Space Time slider\n    const tauSlider = document.getElementById('tau-slider');\n    const tauValue = document.getElementById('tau-value');\n    const tauInput = document.getElementById('tau-input');\n    \n    tauSlider.addEventListener('input', function() {\n        tau = parseFloat(this.value);\n        tauValue.textContent = tau.toFixed(2);\n        tauInput.value = tau;\n        updateDisplay();\n    });\n    \n    tauInput.addEventListener('input', function() {\n        let val = parseFloat(this.value);\n        if (val < 0.01) val = 0.01;\n        tau = val;\n        tauSlider.value = Math.min(tau, 100);\n        tauValue.textContent = tau.toFixed(2);\n        updateDisplay();\n    });\n    \n    // Animate button\n    document.getElementById('animate-btn').addEventListener('click', animateFlow);\n    \n    // Initialize\n    initChart();\n    updateDisplay();\n});"}}
{"input": {"input_text": "Langmuir adsorption isotherm: q = qmax*K*C/(1 + K*C). Compute adsorbed amount.", "simulation_name": " Langmuir Adsorption", "domain": "Chemical Engineering", "description": "Single-site Langmuir isotherm", "assumptions": ["Monolayer adsorption"], "entities": [], "constants": [], "parameters": [{"name": "qmax", "symbol": "qmax", "unit": "mol/kg", "range": [0.01, 10]}, {"name": "equilibrium_constant", "symbol": "K", "unit": "1/(mol/L)", "range": [0.001, 1000.0]}, {"name": "concentration", "symbol": "C", "unit": "mol/L", "range": [0, 10]}], "equations": [{"description": "Adsorption", "expression": "q = qmax*K*C/(1 + K*C)"}], "initial_conditions": {}, "outputs": ["q"], "simulation_controls": ["qmax", "K", "C"], "constraints": ["qmax >= 0", "K >= 0", "C >= 0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Langmuir Adsorption Isotherm Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js\"></script>\n</head>\n<body>\n    <div class=\"container\">\n        <!-- Header -->\n        <div class=\"header\">\n            <h1>Langmuir Adsorption Isotherm</h1>\n            <p class=\"subtitle\">q = q<sub>max</sub> · K · C / (1 + K · C)</p>\n            <div class=\"tags\">\n                <span class=\"tag tag-blue\">Monolayer Adsorption</span>\n                <span class=\"tag tag-green\">Single-Site</span>\n            </div>\n        </div>\n\n        <div class=\"main-grid\">\n            <!-- Controls Panel -->\n            <div class=\"controls-panel\">\n                <div class=\"card\">\n                    <h2>Control Parameters</h2>\n                    \n                    <!-- Maximum Adsorption Capacity -->\n                    <div class=\"control-group\">\n                        <label>\n                            Max Capacity (q<sub>max</sub>): <span id=\"qmax-value\">5.00</span> mol/kg\n                        </label>\n                        <input type=\"range\" id=\"qmax-slider\" min=\"0.01\" max=\"10\" step=\"0.01\" value=\"5.0\" class=\"slider slider-blue\">\n                    </div>\n\n                    <!-- Equilibrium Constant -->\n                    <div class=\"control-group\">\n                        <label>\n                            Equilibrium Constant (K): <span id=\"k-value\">1.000</span> L/mol\n                        </label>\n                        <input type=\"range\" id=\"k-slider\" min=\"-3\" max=\"3\" step=\"0.01\" value=\"0\" class=\"slider slider-green\">\n                        <div class=\"log-scale-info\">Log scale: 10<sup id=\"k-exponent\">0</sup> = <span id=\"k-actual\">1.000</span> L/mol</div>\n                    </div>\n\n                    <!-- Concentration -->\n                    <div class=\"control-group\">\n                        <label>\n                            Concentration (C): <span id=\"c-value\">2.00</span> mol/L\n                        </label>\n                        <input type=\"range\" id=\"c-slider\" min=\"0\" max=\"10\" step=\"0.01\" value=\"2.0\" class=\"slider slider-purple\">\n                        <input type=\"number\" id=\"c-input\" value=\"2.0\" step=\"0.1\" class=\"number-input\">\n                    </div>\n\n                    <button id=\"animate-btn\" class=\"animate-btn\">Visualize Adsorption</button>\n                </div>\n\n                <!-- Results -->\n                <div class=\"card results-card\">\n                    <h2>Results</h2>\n                    <div class=\"result-item result-blue\">\n                        <p class=\"result-label\">Adsorbed Amount (q)</p>\n                        <p class=\"result-value\" id=\"adsorbed-amount\">0.0000 mol/kg</p>\n                    </div>\n                    <div class=\"result-item result-green\">\n                        <p class=\"result-label\">Fractional Coverage (θ)</p>\n                        <p class=\"result-value\" id=\"fractional-coverage\">0.00%</p>\n                    </div>\n                    <div class=\"result-item result-purple\">\n                        <p class=\"result-label\">K·C (Dimensionless)</p>\n                        <p class=\"result-value\" id=\"kc-value\">0.0000</p>\n                    </div>\n                </div>\n\n                <!-- Info Card -->\n                <div class=\"card info-card\">\n                    <h3>Langmuir Model</h3>\n                    <p>The Langmuir isotherm describes monolayer adsorption on a surface with a finite number of identical sites.</p>\n                    <ul>\n                        <li><strong>q<sub>max</sub>:</strong> Maximum adsorption capacity</li>\n                        <li><strong>K:</strong> Equilibrium constant (affinity)</li>\n                        <li><strong>θ = q/q<sub>max</sub>:</strong> Fractional surface coverage</li>\n                    </ul>\n                </div>\n            </div>\n\n            <!-- Visualization Panel -->\n            <div class=\"visualization-panel\">\n                <!-- Surface Visualization -->\n                <div class=\"card\">\n                    <h2>Surface Adsorption Visualization</h2>\n                    <div class=\"surface-container\">\n                        <div class=\"surface-grid\" id=\"surface-grid\">\n                            <!-- Grid cells will be generated by JavaScript -->\n                        </div>\n                        <div class=\"legend\">\n                            <div class=\"legend-item\">\n                                <div class=\"legend-box occupied\"></div>\n                                <span>Occupied Site</span>\n                            </div>\n                            <div class=\"legend-item\">\n                                <div class=\"legend-box vacant\"></div>\n                                <span>Vacant Site</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Isotherm Chart -->\n                <div class=\"card\">\n                    <h2>Adsorption Isotherm</h2>\n                    <div class=\"chart-container\">\n                        <canvas id=\"isothermChart\"></canvas>\n                    </div>\n                </div>\n\n                <!-- Linearized Form Chart -->\n                <div class=\"card\">\n                    <h2>Linearized Form (1/q vs 1/C)</h2>\n                    <div class=\"chart-container\">\n                        <canvas id=\"linearChart\"></canvas>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, #fef3c7 0%, #ddd6fe 100%);\n    min-height: 100vh;\n    padding: 2rem;\n}\n\n.container {\n    max-width: 1400px;\n    margin: 0 auto;\n}\n\n/* Header */\n.header {\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    padding: 2rem;\n    margin-bottom: 2rem;\n}\n\n.header h1 {\n    color: #581c87;\n    font-size: 2rem;\n    margin-bottom: 0.5rem;\n}\n\n.subtitle {\n    color: #6b7280;\n    font-size: 1rem;\n    margin-bottom: 1rem;\n}\n\n.tags {\n    display: flex;\n    gap: 1rem;\n    flex-wrap: wrap;\n}\n\n.tag {\n    padding: 0.5rem 1rem;\n    border-radius: 20px;\n    font-size: 0.875rem;\n    font-weight: 500;\n}\n\n.tag-blue {\n    background: #dbeafe;\n    color: #1e40af;\n}\n\n.tag-green {\n    background: #d1fae5;\n    color: #065f46;\n}\n\n/* Main Grid */\n.main-grid {\n    display: grid;\n    grid-template-columns: 1fr 2fr;\n    gap: 1.5rem;\n}\n\n@media (max-width: 1024px) {\n    .main-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n/* Card */\n.card {\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    padding: 1.5rem;\n    margin-bottom: 1.5rem;\n}\n\n.card h2 {\n    color: #1f2937;\n    font-size: 1.25rem;\n    margin-bottom: 1.5rem;\n}\n\n.card h3 {\n    color: #374151;\n    font-size: 1rem;\n    margin-bottom: 1rem;\n}\n\n/* Control Groups */\n.control-group {\n    margin-bottom: 2rem;\n}\n\n.control-group label {\n    display: block;\n    color: #374151;\n    font-weight: 600;\n    font-size: 0.875rem;\n    margin-bottom: 0.5rem;\n}\n\n.control-group label span {\n    font-weight: 700;\n    color: #111827;\n}\n\n/* Sliders */\n.slider {\n    width: 100%;\n    height: 8px;\n    border-radius: 5px;\n    outline: none;\n    -webkit-appearance: none;\n    cursor: pointer;\n}\n\n.slider-blue {\n    background: #bfdbfe;\n}\n\n.slider-green {\n    background: #bbf7d0;\n}\n\n.slider-purple {\n    background: #e9d5ff;\n}\n\n.slider::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #7c3aed;\n    cursor: pointer;\n}\n\n.slider::-moz-range-thumb {\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #7c3aed;\n    cursor: pointer;\n    border: none;\n}\n\n.number-input {\n    width: 100%;\n    margin-top: 0.5rem;\n    padding: 0.5rem;\n    border: 1px solid #d1d5db;\n    border-radius: 6px;\n    font-size: 0.875rem;\n}\n\n.log-scale-info {\n    margin-top: 0.5rem;\n    font-size: 0.75rem;\n    color: #6b7280;\n    font-style: italic;\n}\n\n/* Animate Button */\n.animate-btn {\n    width: 100%;\n    background: #7c3aed;\n    color: white;\n    padding: 1rem;\n    border: none;\n    border-radius: 8px;\n    font-size: 1rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: background 0.3s;\n}\n\n.animate-btn:hover {\n    background: #6d28d9;\n}\n\n/* Results */\n.results-card {\n    margin-bottom: 1.5rem;\n}\n\n.result-item {\n    padding: 1rem;\n    border-radius: 8px;\n    margin-bottom: 1rem;\n}\n\n.result-item:last-child {\n    margin-bottom: 0;\n}\n\n.result-blue {\n    background: #eff6ff;\n}\n\n.result-green {\n    background: #f0fdf4;\n}\n\n.result-purple {\n    background: #faf5ff;\n}\n\n.result-label {\n    color: #6b7280;\n    font-size: 0.875rem;\n    margin-bottom: 0.25rem;\n}\n\n.result-value {\n    font-size: 1.5rem;\n    font-weight: 700;\n}\n\n.result-blue .result-value {\n    color: #1d4ed8;\n}\n\n.result-green .result-value {\n    color: #15803d;\n}\n\n.result-purple .result-value {\n    color: #7c3aed;\n}\n\n/* Info Card */\n.info-card {\n    background: linear-gradient(135deg, #fef3c7 0%, #fce7f3 100%);\n    border: 2px solid #fbbf24;\n}\n\n.info-card p {\n    color: #374151;\n    font-size: 0.875rem;\n    line-height: 1.6;\n    margin-bottom: 1rem;\n}\n\n.info-card ul {\n    list-style: none;\n    padding: 0;\n}\n\n.info-card ul li {\n    color: #374151;\n    font-size: 0.875rem;\n    padding: 0.5rem 0;\n    border-bottom: 1px solid rgba(251, 191, 36, 0.3);\n}\n\n.info-card ul li:last-child {\n    border-bottom: none;\n}\n\n/* Surface Visualization */\n.surface-container {\n    background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);\n    border-radius: 8px;\n    padding: 1.5rem;\n    min-height: 300px;\n}\n\n.surface-grid {\n    display: grid;\n    grid-template-columns: repeat(10, 1fr);\n    gap: 8px;\n    margin-bottom: 1.5rem;\n}\n\n.site {\n    aspect-ratio: 1;\n    border-radius: 8px;\n    transition: all 0.3s ease;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 1.5rem;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n}\n\n.site.vacant {\n    background: white;\n    border: 2px dashed #d1d5db;\n}\n\n.site.occupied {\n    background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);\n    border: 2px solid #7c3aed;\n}\n\n.site.occupied::after {\n    content: '●';\n    color: white;\n    font-size: 1.2rem;\n}\n\n.site.animating {\n    animation: popIn 0.5s ease-out;\n}\n\n@keyframes popIn {\n    0% {\n        transform: scale(0);\n        opacity: 0;\n    }\n    50% {\n        transform: scale(1.2);\n    }\n    100% {\n        transform: scale(1);\n        opacity: 1;\n    }\n}\n\n.legend {\n    display: flex;\n    gap: 2rem;\n    justify-content: center;\n    padding-top: 1rem;\n    border-top: 2px solid #d1d5db;\n}\n\n.legend-item {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.legend-box {\n    width: 24px;\n    height: 24px;\n    border-radius: 4px;\n}\n\n.legend-box.occupied {\n    background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);\n    border: 2px solid #7c3aed;\n}\n\n.legend-box.vacant {\n    background: white;\n    border: 2px dashed #d1d5db;\n}\n\n.legend-item span {\n    font-size: 0.875rem;\n    color: #374151;\n    font-weight: 500;\n}\n\n/* Chart */\n.chart-container {\n    position: relative;\n    height: 300px;\n    width: 100%;\n}\n\n@media (max-width: 768px) {\n    body {\n        padding: 1rem;\n    }\n\n    .header h1 {\n        font-size: 1.5rem;\n    }\n\n    .surface-grid {\n        grid-template-columns: repeat(8, 1fr);\n        gap: 6px;\n    }\n\n    .legend {\n        flex-direction: column;\n        gap: 0.5rem;\n        align-items: center;\n    }\n}", "js": "// Global variables\nlet qmax = 5.0;\nlet K = 1.0;\nlet C = 2.0;\nlet isothermChart = null;\nlet linearChart = null;\n\n// Calculate adsorbed amount\nfunction calculate(qmaxVal, kVal, cVal) {\n    const q = (qmaxVal * kVal * cVal) / (1 + kVal * cVal);\n    const theta = q / qmaxVal; // Fractional coverage\n    const kc = kVal * cVal;\n    return { q, theta, kc };\n}\n\n// Generate isotherm data\nfunction generateIsothermData() {\n    const points = 100;\n    const concentrations = [];\n    const adsorptions = [];\n    \n    const maxC = 10;\n    for (let i = 0; i <= points; i++) {\n        const c = (maxC * i) / points;\n        const q = (qmax * K * c) / (1 + K * c);\n        concentrations.push(c.toFixed(2));\n        adsorptions.push(q);\n    }\n    \n    return { concentrations, adsorptions };\n}\n\n// Generate linearized data (1/q vs 1/C)\nfunction generateLinearizedData() {\n    const points = 50;\n    const invC = [];\n    const invQ = [];\n    \n    const minC = 0.1;\n    const maxC = 10;\n    \n    for (let i = 0; i <= points; i++) {\n        const c = minC + ((maxC - minC) * i) / points;\n        const q = (qmax * K * c) / (1 + K * c);\n        \n        if (q > 0.01) { // Avoid division by very small numbers\n            invC.push((1 / c).toFixed(4));\n            invQ.push(1 / q);\n        }\n    }\n    \n    return { invC, invQ };\n}\n\n// Update all displays\nfunction updateDisplay() {\n    const result = calculate(qmax, K, C);\n    \n    // Update result displays\n    document.getElementById('adsorbed-amount').textContent = result.q.toFixed(4) + ' mol/kg';\n    document.getElementById('fractional-coverage').textContent = (result.theta * 100).toFixed(2) + '%';\n    document.getElementById('kc-value').textContent = result.kc.toFixed(4);\n    \n    // Update charts\n    updateIsothermChart();\n    updateLinearChart();\n    \n    // Update surface visualization\n    updateSurfaceVisualization(result.theta);\n}\n\n// Initialize surface grid\nfunction initSurfaceGrid() {\n    const grid = document.getElementById('surface-grid');\n    grid.innerHTML = '';\n    \n    // Create 100 sites (10x10 grid)\n    for (let i = 0; i < 100; i++) {\n        const site = document.createElement('div');\n        site.className = 'site vacant';\n        site.id = `site-${i}`;\n        grid.appendChild(site);\n    }\n}\n\n// Update surface visualization based on fractional coverage\nfunction updateSurfaceVisualization(theta, animate = false) {\n    const totalSites = 100;\n    const occupiedSites = Math.round(theta * totalSites);\n    \n    // Create array of site indices and shuffle\n    const siteIndices = Array.from({ length: totalSites }, (_, i) => i);\n    \n    // Fisher-Yates shuffle\n    for (let i = siteIndices.length - 1; i > 0; i--) {\n        const j = Math.floor(Math.random() * (i + 1));\n        [siteIndices[i], siteIndices[j]] = [siteIndices[j], siteIndices[i]];\n    }\n    \n    // Update sites\n    for (let i = 0; i < totalSites; i++) {\n        const site = document.getElementById(`site-${siteIndices[i]}`);\n        \n        if (i < occupiedSites) {\n            if (!site.classList.contains('occupied')) {\n                site.classList.remove('vacant');\n                site.classList.add('occupied');\n                if (animate) {\n                    site.classList.add('animating');\n                    setTimeout(() => site.classList.remove('animating'), 500);\n                }\n            }\n        } else {\n            site.classList.remove('occupied');\n            site.classList.add('vacant');\n        }\n    }\n}\n\n// Initialize isotherm chart\nfunction initIsothermChart() {\n    const ctx = document.getElementById('isothermChart').getContext('2d');\n    const data = generateIsothermData();\n    \n    isothermChart = new Chart(ctx, {\n        type: 'line',\n        data: {\n            labels: data.concentrations,\n            datasets: [\n                {\n                    label: 'Adsorbed Amount q (mol/kg)',\n                    data: data.adsorptions,\n                    borderColor: '#7c3aed',\n                    backgroundColor: 'rgba(124, 58, 237, 0.1)',\n                    borderWidth: 3,\n                    tension: 0.4,\n                    pointRadius: 0\n                }\n            ]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            interaction: {\n                mode: 'index',\n                intersect: false,\n            },\n            plugins: {\n                legend: {\n                    position: 'top',\n                },\n                tooltip: {\n                    callbacks: {\n                        label: function(context) {\n                            return 'q = ' + context.parsed.y.toFixed(4) + ' mol/kg';\n                        }\n                    }\n                }\n            },\n            scales: {\n                x: {\n                    display: true,\n                    title: {\n                        display: true,\n                        text: 'Concentration C (mol/L)'\n                    },\n                    ticks: {\n                        maxTicksLimit: 10\n                    }\n                },\n                y: {\n                    display: true,\n                    title: {\n                        display: true,\n                        text: 'Adsorbed Amount q (mol/kg)'\n                    },\n                    beginAtZero: true\n                }\n            }\n        }\n    });\n    \n    // Add current point\n    addCurrentPointToChart();\n}\n\n// Initialize linearized chart\nfunction initLinearChart() {\n    const ctx = document.getElementById('linearChart').getContext('2d');\n    const data = generateLinearizedData();\n    \n    linearChart = new Chart(ctx, {\n        type: 'line',\n        data: {\n            labels: data.invC,\n            datasets: [\n                {\n                    label: '1/q (kg/mol)',\n                    data: data.invQ,\n                    borderColor: '#10b981',\n                    backgroundColor: 'rgba(16, 185, 129, 0.1)',\n                    borderWidth: 3,\n                    tension: 0,\n                    pointRadius: 0\n                }\n            ]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            interaction: {\n                mode: 'index',\n                intersect: false,\n            },\n            plugins: {\n                legend: {\n                    position: 'top',\n                },\n                tooltip: {\n                    callbacks: {\n                        label: function(context) {\n                            return '1/q = ' + context.parsed.y.toFixed(4) + ' kg/mol';\n                        }\n                    }\n                }\n            },\n            scales: {\n                x: {\n                    display: true,\n                    title: {\n                        display: true,\n                        text: '1/C (L/mol)'\n                    },\n                    ticks: {\n                        maxTicksLimit: 10\n                    }\n                },\n                y: {\n                    display: true,\n                    title: {\n                        display: true,\n                        text: '1/q (kg/mol)'\n                    },\n                    beginAtZero: true\n                }\n            }\n        }\n    });\n}\n\n// Add current operating point to isotherm chart\nfunction addCurrentPointToChart() {\n    if (isothermChart) {\n        const result = calculate(qmax, K, C);\n        \n        // Remove existing current point dataset if any\n        if (isothermChart.data.datasets.length > 1) {\n            isothermChart.data.datasets.pop();\n        }\n        \n        // Add current point\n        isothermChart.data.datasets.push({\n            label: 'Current Point',\n            data: [{ x: C, y: result.q }],\n            borderColor: '#ef4444',\n            backgroundColor: '#ef4444',\n            pointRadius: 8,\n            pointHoverRadius: 10,\n            showLine: false,\n            type: 'scatter'\n        });\n        \n        isothermChart.update('none');\n    }\n}\n\n// Update isotherm chart\nfunction updateIsothermChart() {\n    if (isothermChart) {\n        const data = generateIsothermData();\n        isothermChart.data.labels = data.concentrations;\n        isothermChart.data.datasets[0].data = data.adsorptions;\n        addCurrentPointToChart();\n    }\n}\n\n// Update linearized chart\nfunction updateLinearChart() {\n    if (linearChart) {\n        const data = generateLinearizedData();\n        linearChart.data.labels = data.invC;\n        linearChart.data.datasets[0].data = data.invQ;\n        linearChart.update('none');\n    }\n}\n\n// Animate adsorption\nfunction animateAdsorption() {\n    const result = calculate(qmax, K, C);\n    updateSurfaceVisualization(result.theta, true);\n}\n\n// Event listeners\ndocument.addEventListener('DOMContentLoaded', function() {\n    // qmax slider\n    const qmaxSlider = document.getElementById('qmax-slider');\n    const qmaxValue = document.getElementById('qmax-value');\n    \n    qmaxSlider.addEventListener('input', function() {\n        qmax = parseFloat(this.value);\n        qmaxValue.textContent = qmax.toFixed(2);\n        updateDisplay();\n    });\n    \n    // K slider (logarithmic)\n    const kSlider = document.getElementById('k-slider');\n    const kValue = document.getElementById('k-value');\n    const kExponent = document.getElementById('k-exponent');\n    const kActual = document.getElementById('k-actual');\n    \n    kSlider.addEventListener('input', function() {\n        const exponent = parseFloat(this.value);\n        K = Math.pow(10, exponent);\n        kValue.textContent = K.toFixed(3);\n        kExponent.textContent = exponent.toFixed(2);\n        kActual.textContent = K.toFixed(3);\n        updateDisplay();\n    });\n    \n    // C slider\n    const cSlider = document.getElementById('c-slider');\n    const cValue = document.getElementById('c-value');\n    const cInput = document.getElementById('c-input');\n    \n    cSlider.addEventListener('input', function() {\n        C = parseFloat(this.value);\n        cValue.textContent = C.toFixed(2);\n        cInput.value = C.toFixed(2);\n        updateDisplay();\n    });\n    \n    cInput.addEventListener('input', function() {\n        let val = parseFloat(this.value);\n        if (val < 0) val = 0;\n        if (val > 10) val = 10;\n        C = val;\n        cSlider.value = C;\n        cValue.textContent = C.toFixed(2);\n        updateDisplay();\n    });\n    \n    // Animate button\n    document.getElementById('animate-btn').addEventListener('click', animateAdsorption);\n    \n    // Initialize\n    initSurfaceGrid();\n    initIsothermChart();\n    initLinearChart();\n    updateDisplay();\n});"}}
{"input": {"input_text": "Diffusion through flat membrane steady state: J = D*(C1 - C2)/L. Compute flux.", "simulation_name": " Membrane Diffusion", "domain": "Chemical Engineering", "description": "Fickian steady flux through membrane", "assumptions": ["1D steady diffusion"], "entities": [], "constants": [], "parameters": [{"name": "diffusivity", "symbol": "D", "unit": "m^2/s", "range": [1e-12, 1e-06]}, {"name": "concentration_upstream", "symbol": "C1", "unit": "mol/m^3", "range": [0, 1000]}, {"name": "concentration_downstream", "symbol": "C2", "unit": "mol/m^3", "range": [0, 1000]}, {"name": "thickness", "symbol": "L", "unit": "m", "range": [1e-06, 0.01]}], "equations": [{"description": "Flux", "expression": "J = D*(C1 - C2)/L"}], "initial_conditions": {}, "outputs": ["J"], "simulation_controls": ["D", "C1", "C2", "L"], "constraints": ["L > 0", "D >= 0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Membrane Diffusion Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js\"></script>\n</head>\n<body>\n    <div class=\"container\">\n        <!-- Header -->\n        <div class=\"header\">\n            <h1>Membrane Diffusion - Steady State</h1>\n            <p class=\"subtitle\">J = D · (C<sub>1</sub> - C<sub>2</sub>) / L</p>\n            <div class=\"tags\">\n                <span class=\"tag tag-blue\">1D Steady Diffusion</span>\n                <span class=\"tag tag-green\">Fickian Transport</span>\n            </div>\n        </div>\n\n        <div class=\"main-grid\">\n            <!-- Controls Panel -->\n            <div class=\"controls-panel\">\n                <div class=\"card\">\n                    <h2>Control Parameters</h2>\n                    \n                    <!-- Diffusivity -->\n                    <div class=\"control-group\">\n                        <label>\n                            Diffusivity (D): <span id=\"d-value\">1.00e-9</span> m²/s\n                        </label>\n                        <input type=\"range\" id=\"d-slider\" min=\"-12\" max=\"-6\" step=\"0.1\" value=\"-9\" class=\"slider slider-blue\">\n                        <div class=\"log-scale-info\">Log scale: 10<sup id=\"d-exponent\">-9</sup> m²/s</div>\n                    </div>\n\n                    <!-- Upstream Concentration -->\n                    <div class=\"control-group\">\n                        <label>\n                            Upstream Conc. (C<sub>1</sub>): <span id=\"c1-value\">800</span> mol/m³\n                        </label>\n                        <input type=\"range\" id=\"c1-slider\" min=\"0\" max=\"1000\" step=\"1\" value=\"800\" class=\"slider slider-green\">\n                    </div>\n\n                    <!-- Downstream Concentration -->\n                    <div class=\"control-group\">\n                        <label>\n                            Downstream Conc. (C<sub>2</sub>): <span id=\"c2-value\">200</span> mol/m³\n                        </label>\n                        <input type=\"range\" id=\"c2-slider\" min=\"0\" max=\"1000\" step=\"1\" value=\"200\" class=\"slider slider-purple\">\n                    </div>\n\n                    <!-- Thickness -->\n                    <div class=\"control-group\">\n                        <label>\n                            Membrane Thickness (L): <span id=\"l-value\">1.00e-3</span> m\n                        </label>\n                        <input type=\"range\" id=\"l-slider\" min=\"-6\" max=\"-2\" step=\"0.1\" value=\"-3\" class=\"slider slider-orange\">\n                        <div class=\"log-scale-info\">Log scale: 10<sup id=\"l-exponent\">-3</sup> m = <span id=\"l-mm\">1.00</span> mm</div>\n                    </div>\n\n                    <button id=\"animate-btn\" class=\"animate-btn\">Animate Diffusion</button>\n                </div>\n\n                <!-- Results -->\n                <div class=\"card results-card\">\n                    <h2>Results</h2>\n                    <div class=\"result-item result-blue\">\n                        <p class=\"result-label\">Diffusive Flux (J)</p>\n                        <p class=\"result-value\" id=\"flux\">0.000e+0 mol/(m²·s)</p>\n                    </div>\n                    <div class=\"result-item result-green\">\n                        <p class=\"result-label\">Concentration Gradient</p>\n                        <p class=\"result-value\" id=\"gradient\">0.00e+0 mol/m⁴</p>\n                    </div>\n                    <div class=\"result-item result-purple\">\n                        <p class=\"result-label\">Driving Force (ΔC)</p>\n                        <p class=\"result-value\" id=\"delta-c\">0 mol/m³</p>\n                    </div>\n                </div>\n\n                <!-- Info Card -->\n                <div class=\"card info-card\">\n                    <h3>Fick's First Law</h3>\n                    <p>Describes steady-state diffusion through a membrane under a concentration gradient.</p>\n                    <ul>\n                        <li><strong>J:</strong> Diffusive flux</li>\n                        <li><strong>D:</strong> Diffusion coefficient</li>\n                        <li><strong>ΔC/L:</strong> Concentration gradient</li>\n                        <li><strong>Direction:</strong> High → Low concentration</li>\n                    </ul>\n                </div>\n            </div>\n\n            <!-- Visualization Panel -->\n            <div class=\"visualization-panel\">\n                <!-- Membrane Visualization -->\n                <div class=\"card\">\n                    <h2>Membrane Cross-Section</h2>\n                    <div class=\"membrane-container\">\n                        <div class=\"membrane-wrapper\">\n                            <!-- Upstream side -->\n                            <div class=\"side upstream\">\n                                <div class=\"side-label\">Upstream</div>\n                                <div class=\"concentration-label\">C<sub>1</sub> = <span id=\"c1-display\">800</span></div>\n                                <div class=\"particles-container\" id=\"upstream-particles\"></div>\n                            </div>\n                            \n                            <!-- Membrane -->\n                            <div class=\"membrane\" id=\"membrane\">\n                                <div class=\"membrane-label\">Membrane</div>\n                                <div class=\"thickness-label\">L = <span id=\"l-display\">1.00</span> mm</div>\n                                <div class=\"diffusing-particles\" id=\"diffusing-particles\"></div>\n                            </div>\n                            \n                            <!-- Downstream side -->\n                            <div class=\"side downstream\">\n                                <div class=\"side-label\">Downstream</div>\n                                <div class=\"concentration-label\">C<sub>2</sub> = <span id=\"c2-display\">200</span></div>\n                                <div class=\"particles-container\" id=\"downstream-particles\"></div>\n                            </div>\n                        </div>\n                        \n                        <!-- Flux Arrow -->\n                        <div class=\"flux-arrow\" id=\"flux-arrow\">\n                            <div class=\"arrow-label\">Flux J</div>\n                            <div class=\"arrow-body\"></div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Concentration Profile Chart -->\n                <div class=\"card\">\n                    <h2>Concentration Profile Across Membrane</h2>\n                    <div class=\"chart-container\">\n                        <canvas id=\"profileChart\"></canvas>\n                    </div>\n                </div>\n\n                <!-- Flux vs Driving Force -->\n                <div class=\"card\">\n                    <h2>Flux vs Driving Force (ΔC)</h2>\n                    <div class=\"chart-container\">\n                        <canvas id=\"fluxChart\"></canvas>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, #e0f2fe 0%, #fce7f3 100%);\n    min-height: 100vh;\n    padding: 2rem;\n}\n\n.container {\n    max-width: 1400px;\n    margin: 0 auto;\n}\n\n/* Header */\n.header {\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    padding: 2rem;\n    margin-bottom: 2rem;\n}\n\n.header h1 {\n    color: #0c4a6e;\n    font-size: 2rem;\n    margin-bottom: 0.5rem;\n}\n\n.subtitle {\n    color: #6b7280;\n    font-size: 1rem;\n    margin-bottom: 1rem;\n}\n\n.tags {\n    display: flex;\n    gap: 1rem;\n    flex-wrap: wrap;\n}\n\n.tag {\n    padding: 0.5rem 1rem;\n    border-radius: 20px;\n    font-size: 0.875rem;\n    font-weight: 500;\n}\n\n.tag-blue {\n    background: #dbeafe;\n    color: #1e40af;\n}\n\n.tag-green {\n    background: #d1fae5;\n    color: #065f46;\n}\n\n/* Main Grid */\n.main-grid {\n    display: grid;\n    grid-template-columns: 1fr 2fr;\n    gap: 1.5rem;\n}\n\n@media (max-width: 1024px) {\n    .main-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n/* Card */\n.card {\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    padding: 1.5rem;\n    margin-bottom: 1.5rem;\n}\n\n.card h2 {\n    color: #1f2937;\n    font-size: 1.25rem;\n    margin-bottom: 1.5rem;\n}\n\n.card h3 {\n    color: #374151;\n    font-size: 1rem;\n    margin-bottom: 1rem;\n}\n\n/* Control Groups */\n.control-group {\n    margin-bottom: 2rem;\n}\n\n.control-group label {\n    display: block;\n    color: #374151;\n    font-weight: 600;\n    font-size: 0.875rem;\n    margin-bottom: 0.5rem;\n}\n\n.control-group label span {\n    font-weight: 700;\n    color: #111827;\n}\n\n/* Sliders */\n.slider {\n    width: 100%;\n    height: 8px;\n    border-radius: 5px;\n    outline: none;\n    -webkit-appearance: none;\n    cursor: pointer;\n}\n\n.slider-blue {\n    background: #bfdbfe;\n}\n\n.slider-green {\n    background: #bbf7d0;\n}\n\n.slider-purple {\n    background: #e9d5ff;\n}\n\n.slider-orange {\n    background: #fed7aa;\n}\n\n.slider::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #0891b2;\n    cursor: pointer;\n}\n\n.slider::-moz-range-thumb {\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #0891b2;\n    cursor: pointer;\n    border: none;\n}\n\n.log-scale-info {\n    margin-top: 0.5rem;\n    font-size: 0.75rem;\n    color: #6b7280;\n    font-style: italic;\n}\n\n/* Animate Button */\n.animate-btn {\n    width: 100%;\n    background: #0891b2;\n    color: white;\n    padding: 1rem;\n    border: none;\n    border-radius: 8px;\n    font-size: 1rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: background 0.3s;\n}\n\n.animate-btn:hover {\n    background: #0e7490;\n}\n\n/* Results */\n.results-card {\n    margin-bottom: 1.5rem;\n}\n\n.result-item {\n    padding: 1rem;\n    border-radius: 8px;\n    margin-bottom: 1rem;\n}\n\n.result-item:last-child {\n    margin-bottom: 0;\n}\n\n.result-blue {\n    background: #eff6ff;\n}\n\n.result-green {\n    background: #f0fdf4;\n}\n\n.result-purple {\n    background: #faf5ff;\n}\n\n.result-label {\n    color: #6b7280;\n    font-size: 0.875rem;\n    margin-bottom: 0.25rem;\n}\n\n.result-value {\n    font-size: 1.5rem;\n    font-weight: 700;\n}\n\n.result-blue .result-value {\n    color: #0c4a6e;\n}\n\n.result-green .result-value {\n    color: #15803d;\n}\n\n.result-purple .result-value {\n    color: #7c3aed;\n}\n\n/* Info Card */\n.info-card {\n    background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);\n    border: 2px solid #3b82f6;\n}\n\n.info-card p {\n    color: #374151;\n    font-size: 0.875rem;\n    line-height: 1.6;\n    margin-bottom: 1rem;\n}\n\n.info-card ul {\n    list-style: none;\n    padding: 0;\n}\n\n.info-card ul li {\n    color: #374151;\n    font-size: 0.875rem;\n    padding: 0.5rem 0;\n    border-bottom: 1px solid rgba(59, 130, 246, 0.3);\n}\n\n.info-card ul li:last-child {\n    border-bottom: none;\n}\n\n/* Membrane Visualization */\n.membrane-container {\n    position: relative;\n    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\n    border-radius: 8px;\n    padding: 2rem;\n    min-height: 350px;\n}\n\n.membrane-wrapper {\n    display: flex;\n    align-items: stretch;\n    height: 280px;\n    position: relative;\n}\n\n.side {\n    flex: 1;\n    position: relative;\n    border-radius: 8px;\n    padding: 1rem;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n}\n\n.upstream {\n    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n    transition: background 0.5s ease;\n}\n\n.downstream {\n    background: linear-gradient(135deg, #93c5fd 0%, #bfdbfe 100%);\n    transition: background 0.5s ease;\n}\n\n.side-label {\n    font-size: 0.75rem;\n    font-weight: 700;\n    color: white;\n    background: rgba(0, 0, 0, 0.3);\n    padding: 0.25rem 0.75rem;\n    border-radius: 12px;\n    margin-bottom: 0.5rem;\n}\n\n.downstream .side-label {\n    color: #1e40af;\n    background: rgba(255, 255, 255, 0.5);\n}\n\n.concentration-label {\n    font-size: 0.875rem;\n    font-weight: 600;\n    color: white;\n    margin-bottom: 1rem;\n}\n\n.downstream .concentration-label {\n    color: #1e40af;\n}\n\n.particles-container {\n    flex: 1;\n    position: relative;\n    width: 100%;\n}\n\n.particle {\n    position: absolute;\n    width: 8px;\n    height: 8px;\n    background: white;\n    border-radius: 50%;\n    box-shadow: 0 0 6px rgba(255, 255, 255, 0.8);\n}\n\n.downstream .particle {\n    background: #1e40af;\n    box-shadow: 0 0 6px rgba(30, 64, 175, 0.5);\n}\n\n.membrane {\n    width: 120px;\n    background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    border: 3px solid #475569;\n    box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.3);\n}\n\n.membrane-label {\n    font-size: 0.875rem;\n    font-weight: 700;\n    color: white;\n    background: rgba(0, 0, 0, 0.4);\n    padding: 0.25rem 0.75rem;\n    border-radius: 12px;\n    margin-bottom: 0.5rem;\n}\n\n.thickness-label {\n    font-size: 0.75rem;\n    color: white;\n    background: rgba(0, 0, 0, 0.3);\n    padding: 0.25rem 0.5rem;\n    border-radius: 8px;\n}\n\n.diffusing-particles {\n    position: absolute;\n    inset: 0;\n    overflow: hidden;\n}\n\n.diffusing-particle {\n    position: absolute;\n    width: 6px;\n    height: 6px;\n    background: #fbbf24;\n    border-radius: 50%;\n    box-shadow: 0 0 8px rgba(251, 191, 36, 0.8);\n    opacity: 0;\n}\n\n.diffusing-particle.animating-left-to-right {\n    animation: diffuseLeftToRight 3s linear;\n}\n\n.diffusing-particle.animating-right-to-left {\n    animation: diffuseRightToLeft 3s linear;\n}\n\n@keyframes diffuseLeftToRight {\n    0% {\n        left: 0%;\n        opacity: 1;\n    }\n    100% {\n        left: 100%;\n        opacity: 0.3;\n    }\n}\n\n@keyframes diffuseRightToLeft {\n    0% {\n        left: 100%;\n        opacity: 1;\n    }\n    100% {\n        left: 0%;\n        opacity: 0.3;\n    }\n}\n\n.flux-arrow {\n    position: absolute;\n    bottom: 1rem;\n    left: 50%;\n    transform: translateX(-50%);\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.arrow-label {\n    font-size: 0.875rem;\n    font-weight: 700;\n    color: #dc2626;\n    background: white;\n    padding: 0.25rem 0.75rem;\n    border-radius: 12px;\n    border: 2px solid #dc2626;\n}\n\n.arrow-body {\n    width: 100px;\n    height: 4px;\n    background: #dc2626;\n    position: relative;\n}\n\n.arrow-body::after {\n    content: '';\n    position: absolute;\n    right: -10px;\n    top: 50%;\n    transform: translateY(-50%);\n    width: 0;\n    height: 0;\n    border-left: 10px solid #dc2626;\n    border-top: 6px solid transparent;\n    border-bottom: 6px solid transparent;\n}\n\n/* Chart */\n.chart-container {\n    position: relative;\n    height: 300px;\n    width: 100%;\n}\n\n@media (max-width: 768px) {\n    body {\n        padding: 1rem;\n    }\n\n    .header h1 {\n        font-size: 1.5rem;\n    }\n\n    .membrane-wrapper {\n        height: 200px;\n    }\n\n    .membrane {\n        width: 80px;\n    }\n}", "js": "// Global variables\nlet D = 1e-9;\nlet C1 = 800;\nlet C2 = 200;\nlet L = 1e-3;\nlet profileChart = null;\nlet fluxChart = null;\n\n// Calculate flux\nfunction calculate(dVal, c1Val, c2Val, lVal) {\n    const flux = (dVal * (c1Val - c2Val)) / lVal;\n    const gradient = (c1Val - c2Val) / lVal;\n    const deltaC = c1Val - c2Val;\n    return { flux, gradient, deltaC };\n}\n\n// Format scientific notation\nfunction formatScientific(value, decimals = 2) {\n    if (value === 0) return '0.00e+0';\n    const exponent = Math.floor(Math.log10(Math.abs(value)));\n    const mantissa = value / Math.pow(10, exponent);\n    return `${mantissa.toFixed(decimals)}e${exponent >= 0 ? '+' : ''}${exponent}`;\n}\n\n// Generate concentration profile data\nfunction generateProfile() {\n    const points = 100;\n    const positions = [];\n    const concentrations = [];\n    \n    for (let i = 0; i <= points; i++) {\n        const x = (L * i) / points;\n        const c = C1 - ((C1 - C2) * i) / points; // Linear profile in steady state\n        positions.push((x * 1000).toFixed(4)); // Convert to mm\n        concentrations.push(c);\n    }\n    \n    return { positions, concentrations };\n}\n\n// Generate flux vs driving force data\nfunction generateFluxData() {\n    const points = 50;\n    const deltaCs = [];\n    const fluxes = [];\n    \n    // Range from -1000 to +1000 to show both directions\n    const minDeltaC = -1000;\n    const maxDeltaC = 1000;\n    \n    for (let i = 0; i <= points; i++) {\n        const dc = minDeltaC + ((maxDeltaC - minDeltaC) * i) / points;\n        const flux = (D * dc) / L;\n        deltaCs.push(dc.toFixed(1));\n        fluxes.push(flux);\n    }\n    \n    return { deltaCs, fluxes };\n}\n\n// Update all displays\nfunction updateDisplay() {\n    const result = calculate(D, C1, C2, L);\n    \n    // Update result displays\n    const fluxSign = result.flux >= 0 ? '+' : '';\n    document.getElementById('flux').textContent = fluxSign + formatScientific(result.flux, 3) + ' mol/(m²·s)';\n    document.getElementById('gradient').textContent = formatScientific(result.gradient, 2) + ' mol/m⁴';\n    document.getElementById('delta-c').textContent = result.deltaC.toFixed(0) + ' mol/m³';\n    \n    // Update membrane display labels\n    document.getElementById('c1-display').textContent = C1.toFixed(0);\n    document.getElementById('c2-display').textContent = C2.toFixed(0);\n    document.getElementById('l-display').textContent = (L * 1000).toFixed(2);\n    \n    // Update charts\n    updateProfileChart();\n    updateFluxChart();\n    \n    // Update particles\n    updateParticles();\n    \n    // Update flux arrow direction\n    updateFluxArrow(result.flux);\n}\n\n// Update flux arrow based on flux direction\nfunction updateFluxArrow(flux) {\n    const arrow = document.getElementById('flux-arrow');\n    const arrowBody = arrow.querySelector('.arrow-body');\n    \n    if (flux > 0) {\n        // Left to right (C1 > C2)\n        arrow.style.flexDirection = 'row';\n        arrowBody.style.background = '#dc2626';\n    } else if (flux < 0) {\n        // Right to left (C2 > C1)\n        arrow.style.flexDirection = 'row-reverse';\n        arrowBody.style.background = '#2563eb';\n    } else {\n        // No flux\n        arrowBody.style.background = '#9ca3af';\n    }\n}\n\n// Initialize particles in upstream and downstream\nfunction initParticles() {\n    const upstreamContainer = document.getElementById('upstream-particles');\n    const downstreamContainer = document.getElementById('downstream-particles');\n    \n    upstreamContainer.innerHTML = '';\n    downstreamContainer.innerHTML = '';\n    \n    // Create particles based on concentration\n    const upstreamCount = Math.min(Math.floor(C1 / 50), 30);\n    const downstreamCount = Math.min(Math.floor(C2 / 50), 30);\n    \n    for (let i = 0; i < upstreamCount; i++) {\n        const particle = document.createElement('div');\n        particle.className = 'particle';\n        particle.style.left = Math.random() * 80 + 10 + '%';\n        particle.style.top = Math.random() * 80 + 10 + '%';\n        upstreamContainer.appendChild(particle);\n    }\n    \n    for (let i = 0; i < downstreamCount; i++) {\n        const particle = document.createElement('div');\n        particle.className = 'particle';\n        particle.style.left = Math.random() * 80 + 10 + '%';\n        particle.style.top = Math.random() * 80 + 10 + '%';\n        downstreamContainer.appendChild(particle);\n    }\n}\n\n// Update particles\nfunction updateParticles() {\n    initParticles();\n    updateSideColors();\n}\n\n// Update side colors based on concentration\nfunction updateSideColors() {\n    const upstreamSide = document.querySelector('.upstream');\n    const downstreamSide = document.querySelector('.downstream');\n    \n    // Determine intensity based on concentration\n    const maxConc = 1000;\n    const upstreamIntensity = Math.min(C1 / maxConc, 1);\n    const downstreamIntensity = Math.min(C2 / maxConc, 1);\n    \n    // Set colors - darker blue for higher concentration\n    if (C1 > C2) {\n        upstreamSide.style.background = `linear-gradient(135deg, \n            rgb(${59 - upstreamIntensity * 20}, ${130 - upstreamIntensity * 50}, ${246 - upstreamIntensity * 30}) 0%, \n            rgb(${37 - upstreamIntensity * 20}, ${99 - upstreamIntensity * 40}, ${235 - upstreamIntensity * 30}) 100%)`;\n        downstreamSide.style.background = `linear-gradient(135deg, \n            rgb(${147 + downstreamIntensity * 40}, ${197 + downstreamIntensity * 30}, ${253}) 0%, \n            rgb(${191 + downstreamIntensity * 40}, ${219 + downstreamIntensity * 20}, ${254}) 100%)`;\n    } else if (C2 > C1) {\n        upstreamSide.style.background = `linear-gradient(135deg, \n            rgb(${147 + upstreamIntensity * 40}, ${197 + upstreamIntensity * 30}, ${253}) 0%, \n            rgb(${191 + upstreamIntensity * 40}, ${219 + upstreamIntensity * 20}, ${254}) 100%)`;\n        downstreamSide.style.background = `linear-gradient(135deg, \n            rgb(${59 - downstreamIntensity * 20}, ${130 - downstreamIntensity * 50}, ${246 - downstreamIntensity * 30}) 0%, \n            rgb(${37 - downstreamIntensity * 20}, ${99 - downstreamIntensity * 40}, ${235 - downstreamIntensity * 30}) 100%)`;\n    } else {\n        // Equal concentrations\n        const midColor = `linear-gradient(135deg, rgb(100, 150, 250) 0%, rgb(120, 170, 250) 100%)`;\n        upstreamSide.style.background = midColor;\n        downstreamSide.style.background = midColor;\n    }\n}\n\n// Initialize profile chart\nfunction initProfileChart() {\n    const ctx = document.getElementById('profileChart').getContext('2d');\n    const data = generateProfile();\n    \n    profileChart = new Chart(ctx, {\n        type: 'line',\n        data: {\n            labels: data.positions,\n            datasets: [\n                {\n                    label: 'Concentration (mol/m³)',\n                    data: data.concentrations,\n                    borderColor: '#0891b2',\n                    backgroundColor: 'rgba(8, 145, 178, 0.1)',\n                    borderWidth: 3,\n                    tension: 0,\n                    pointRadius: 0,\n                    fill: true\n                }\n            ]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            interaction: {\n                mode: 'index',\n                intersect: false,\n            },\n            plugins: {\n                legend: {\n                    position: 'top',\n                },\n                tooltip: {\n                    callbacks: {\n                        label: function(context) {\n                            return 'C = ' + context.parsed.y.toFixed(2) + ' mol/m³';\n                        }\n                    }\n                }\n            },\n            scales: {\n                x: {\n                    display: true,\n                    title: {\n                        display: true,\n                        text: 'Position in Membrane (mm)'\n                    },\n                    ticks: {\n                        maxTicksLimit: 10\n                    }\n                },\n                y: {\n                    display: true,\n                    title: {\n                        display: true,\n                        text: 'Concentration (mol/m³)'\n                    },\n                    beginAtZero: true\n                }\n            }\n        }\n    });\n}\n\n// Initialize flux chart\nfunction initFluxChart() {\n    const ctx = document.getElementById('fluxChart').getContext('2d');\n    const data = generateFluxData();\n    \n    fluxChart = new Chart(ctx, {\n        type: 'line',\n        data: {\n            labels: data.deltaCs,\n            datasets: [\n                {\n                    label: 'Flux J (mol/(m²·s))',\n                    data: data.fluxes,\n                    borderColor: '#dc2626',\n                    backgroundColor: 'rgba(220, 38, 38, 0.1)',\n                    borderWidth: 3,\n                    tension: 0,\n                    pointRadius: 0\n                }\n            ]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            interaction: {\n                mode: 'index',\n                intersect: false,\n            },\n            plugins: {\n                legend: {\n                    position: 'top',\n                },\n                tooltip: {\n                    callbacks: {\n                        label: function(context) {\n                            return 'J = ' + formatScientific(context.parsed.y, 3) + ' mol/(m²·s)';\n                        }\n                    }\n                }\n            },\n            scales: {\n                x: {\n                    display: true,\n                    title: {\n                        display: true,\n                        text: 'Driving Force ΔC = C₁ - C₂ (mol/m³)'\n                    },\n                    ticks: {\n                        maxTicksLimit: 10\n                    }\n                },\n                y: {\n                    display: true,\n                    title: {\n                        display: true,\n                        text: 'Flux J (mol/(m²·s))'\n                    },\n                    ticks: {\n                        callback: function(value) {\n                            return formatScientific(value, 1);\n                        }\n                    }\n                }\n            }\n        }\n    });\n    \n    // Add current point\n    addCurrentPointToChart();\n}\n\n// Add current operating point to flux chart\nfunction addCurrentPointToChart() {\n    if (fluxChart) {\n        const result = calculate(D, C1, C2, L);\n        \n        // Remove existing current point dataset if any\n        if (fluxChart.data.datasets.length > 1) {\n            fluxChart.data.datasets.pop();\n        }\n        \n        // Add current point\n        fluxChart.data.datasets.push({\n            label: 'Current Point',\n            data: [{ x: result.deltaC, y: result.flux }],\n            borderColor: '#7c3aed',\n            backgroundColor: '#7c3aed',\n            pointRadius: 8,\n            pointHoverRadius: 10,\n            showLine: false,\n            type: 'scatter'\n        });\n        \n        fluxChart.update('none');\n    }\n}\n\n// Update profile chart\nfunction updateProfileChart() {\n    if (profileChart) {\n        const data = generateProfile();\n        profileChart.data.labels = data.positions;\n        profileChart.data.datasets[0].data = data.concentrations;\n        profileChart.update('none');\n    }\n}\n\n// Update flux chart\nfunction updateFluxChart() {\n    if (fluxChart) {\n        const data = generateFluxData();\n        fluxChart.data.labels = data.deltaCs;\n        fluxChart.data.datasets[0].data = data.fluxes;\n        addCurrentPointToChart();\n    }\n}\n\n// Animate diffusion\nfunction animateDiffusion() {\n    const container = document.getElementById('diffusing-particles');\n    const flux = (D * (C1 - C2)) / L;\n    \n    // Clear existing particles\n    container.innerHTML = '';\n    \n    // Determine direction and number of particles based on flux magnitude\n    const isLeftToRight = flux > 0;\n    const numParticles = Math.min(Math.floor(Math.abs(flux) / 1e-5) + 3, 12);\n    \n    // Create multiple diffusing particles\n    for (let i = 0; i < numParticles; i++) {\n        const particle = document.createElement('div');\n        particle.className = 'diffusing-particle';\n        particle.style.top = Math.random() * 80 + 10 + '%';\n        particle.style.animationDelay = (i * 0.25) + 's';\n        \n        if (isLeftToRight) {\n            particle.classList.add('animating-left-to-right');\n        } else {\n            particle.classList.add('animating-right-to-left');\n        }\n        \n        container.appendChild(particle);\n    }\n    \n    // Clean up after animation\n    setTimeout(() => {\n        container.innerHTML = '';\n    }, 3000 + (numParticles * 250));\n}\n\n// Event listeners\ndocument.addEventListener('DOMContentLoaded', function() {\n    // D slider (logarithmic)\n    const dSlider = document.getElementById('d-slider');\n    const dValue = document.getElementById('d-value');\n    const dExponent = document.getElementById('d-exponent');\n    \n    dSlider.addEventListener('input', function() {\n        const exponent = parseFloat(this.value);\n        D = Math.pow(10, exponent);\n        dValue.textContent = formatScientific(D, 2);\n        dExponent.textContent = exponent.toFixed(1);\n        updateDisplay();\n    });\n    \n    // C1 slider\n    const c1Slider = document.getElementById('c1-slider');\n    const c1Value = document.getElementById('c1-value');\n    \n    c1Slider.addEventListener('input', function() {\n        C1 = parseFloat(this.value);\n        c1Value.textContent = C1.toFixed(0);\n        updateDisplay();\n    });\n    \n    // C2 slider\n    const c2Slider = document.getElementById('c2-slider');\n    const c2Value = document.getElementById('c2-value');\n    \n    c2Slider.addEventListener('input', function() {\n        C2 = parseFloat(this.value);\n        c2Value.textContent = C2.toFixed(0);\n        updateDisplay();\n    });\n    \n    // L slider (logarithmic)\n    const lSlider = document.getElementById('l-slider');\n    const lValue = document.getElementById('l-value');\n    const lExponent = document.getElementById('l-exponent');\n    const lMm = document.getElementById('l-mm');\n    \n    lSlider.addEventListener('input', function() {\n        const exponent = parseFloat(this.value);\n        L = Math.pow(10, exponent);\n        lValue.textContent = formatScientific(L, 2);\n        lExponent.textContent = exponent.toFixed(1);\n        lMm.textContent = (L * 1000).toFixed(2);\n        updateDisplay();\n    });\n    \n    // Animate button\n    document.getElementById('animate-btn').addEventListener('click', animateDiffusion);\n    \n    // Initialize\n    initParticles();\n    initProfileChart();\n    initFluxChart();\n    updateDisplay();\n});"}}
{"input": {"input_text": "Binary distillation minimum stages via Fenske at total reflux: Nmin = log((xD/(1-xD))*(1-xB)/xB)/log(alpha).", "simulation_name": " Fenske Minimum Stages", "domain": "Chemical Engineering", "description": "Minimum ideal stages at total reflux", "assumptions": ["Constant relative volatility"], "entities": [], "constants": [], "parameters": [{"name": "distillate_molefrac_light", "symbol": "xD", "unit": "fraction", "range": [0.5, 0.999]}, {"name": "bottoms_molefrac_light", "symbol": "xB", "unit": "fraction", "range": [0.001, 0.5]}, {"name": "relative_volatility", "symbol": "alpha", "unit": "dimensionless", "range": [1.1, 5]}], "equations": [{"description": "Minimum stages", "expression": "Nmin = log((xD/(1 - xD))*((1 - xB)/xB))/log(alpha)"}], "initial_conditions": {}, "outputs": ["Nmin"], "simulation_controls": ["xD", "xB", "alpha"], "constraints": ["alpha > 1", "0 < xB < xD < 1"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Fenske Minimum Stages Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js\"></script>\n</head>\n<body>\n    <div class=\"container\">\n        <!-- Header -->\n        <div class=\"header\">\n            <h1>Fenske Equation - Minimum Distillation Stages</h1>\n            <p class=\"subtitle\">N<sub>min</sub> = log[(x<sub>D</sub>/(1-x<sub>D</sub>))·((1-x<sub>B</sub>)/x<sub>B</sub>)] / log(α)</p>\n            <div class=\"tags\">\n                <span class=\"tag tag-blue\">Total Reflux</span>\n                <span class=\"tag tag-green\">Constant Relative Volatility</span>\n                <span class=\"tag tag-purple\">Ideal Stages</span>\n            </div>\n        </div>\n\n        <div class=\"main-grid\">\n            <!-- Controls Panel -->\n            <div class=\"controls-panel\">\n                <div class=\"card\">\n                    <h2>Control Parameters</h2>\n                    \n                    <!-- Distillate Composition -->\n                    <div class=\"control-group\">\n                        <label>\n                            Distillate (x<sub>D</sub>): <span id=\"xd-value\">0.950</span>\n                        </label>\n                        <input type=\"range\" id=\"xd-slider\" min=\"0.5\" max=\"0.999\" step=\"0.001\" value=\"0.95\" class=\"slider slider-blue\">\n                        <div class=\"composition-info\">Light component mole fraction in distillate</div>\n                    </div>\n\n                    <!-- Bottoms Composition -->\n                    <div class=\"control-group\">\n                        <label>\n                            Bottoms (x<sub>B</sub>): <span id=\"xb-value\">0.050</span>\n                        </label>\n                        <input type=\"range\" id=\"xb-slider\" min=\"0.001\" max=\"0.5\" step=\"0.001\" value=\"0.05\" class=\"slider slider-green\">\n                        <div class=\"composition-info\">Light component mole fraction in bottoms</div>\n                    </div>\n\n                    <!-- Relative Volatility -->\n                    <div class=\"control-group\">\n                        <label>\n                            Relative Volatility (α): <span id=\"alpha-value\">2.50</span>\n                        </label>\n                        <input type=\"range\" id=\"alpha-slider\" min=\"1.1\" max=\"5\" step=\"0.01\" value=\"2.5\" class=\"slider slider-purple\">\n                        <div class=\"composition-info\">Ease of separation (α > 1)</div>\n                    </div>\n\n                    <button id=\"visualize-btn\" class=\"animate-btn\">Visualize Column</button>\n                </div>\n\n                <!-- Results -->\n                <div class=\"card results-card\">\n                    <h2>Results</h2>\n                    <div class=\"result-item result-blue\">\n                        <p class=\"result-label\">Minimum Stages (N<sub>min</sub>)</p>\n                        <p class=\"result-value\" id=\"nmin\">0.00</p>\n                    </div>\n                    <div class=\"result-item result-green\">\n                        <p class=\"result-label\">Separation Factor</p>\n                        <p class=\"result-value\" id=\"separation-factor\">0.00</p>\n                    </div>\n                    <div class=\"result-item result-purple\">\n                        <p class=\"result-label\">Recovery (%)</p>\n                        <p class=\"result-value\" id=\"recovery\">0.0%</p>\n                    </div>\n                </div>\n\n                <!-- Info Card -->\n                <div class=\"card info-card\">\n                    <h3>Fenske Equation</h3>\n                    <p>Calculates the minimum number of theoretical stages required for a binary distillation at total reflux (infinite reflux ratio).</p>\n                    <ul>\n                        <li><strong>N<sub>min</sub>:</strong> Minimum equilibrium stages</li>\n                        <li><strong>x<sub>D</sub>:</strong> Distillate purity (top)</li>\n                        <li><strong>x<sub>B</sub>:</strong> Bottoms purity (bottom)</li>\n                        <li><strong>α:</strong> Relative volatility (selectivity)</li>\n                    </ul>\n                </div>\n            </div>\n\n            <!-- Visualization Panel -->\n            <div class=\"visualization-panel\">\n                <!-- Distillation Column Visualization -->\n                <div class=\"card\">\n                    <h2>Distillation Column (Total Reflux)</h2>\n                    <div class=\"column-container\">\n                        <div class=\"column-wrapper\">\n                            <!-- Condenser -->\n                            <div class=\"condenser\">\n                                <div class=\"equipment-label\">Condenser</div>\n                                <div class=\"stream-label distillate-label\">\n                                    Distillate<br>x<sub>D</sub> = <span id=\"xd-display\">0.950</span>\n                                </div>\n                            </div>\n                            \n                            <!-- Column with stages -->\n                            <div class=\"column\" id=\"column\">\n                                <div class=\"column-body\" id=\"column-body\">\n                                    <!-- Stages will be generated here -->\n                                </div>\n                                <div class=\"reflux-arrow\">\n                                    <div class=\"arrow-down\"></div>\n                                    <div class=\"reflux-label\">Total Reflux</div>\n                                </div>\n                            </div>\n                            \n                            <!-- Reboiler -->\n                            <div class=\"reboiler\">\n                                <div class=\"equipment-label\">Reboiler</div>\n                                <div class=\"stream-label bottoms-label\">\n                                    Bottoms<br>x<sub>B</sub> = <span id=\"xb-display\">0.050</span>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- McCabe-Thiele Diagram -->\n                <div class=\"card\">\n                    <h2>McCabe-Thiele Diagram (Total Reflux)</h2>\n                    <div class=\"chart-container\">\n                        <canvas id=\"mcCabeChart\"></canvas>\n                    </div>\n                </div>\n\n                <!-- Nmin vs Alpha Chart -->\n                <div class=\"card\">\n                    <h2>Minimum Stages vs Relative Volatility</h2>\n                    <div class=\"chart-container\">\n                        <canvas id=\"alphaChart\"></canvas>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, #fef3c7 0%, #e0f2fe 100%);\n    min-height: 100vh;\n    padding: 2rem;\n}\n\n.container {\n    max-width: 1400px;\n    margin: 0 auto;\n}\n\n/* Header */\n.header {\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    padding: 2rem;\n    margin-bottom: 2rem;\n}\n\n.header h1 {\n    color: #7c2d12;\n    font-size: 2rem;\n    margin-bottom: 0.5rem;\n}\n\n.subtitle {\n    color: #6b7280;\n    font-size: 1rem;\n    margin-bottom: 1rem;\n}\n\n.tags {\n    display: flex;\n    gap: 1rem;\n    flex-wrap: wrap;\n}\n\n.tag {\n    padding: 0.5rem 1rem;\n    border-radius: 20px;\n    font-size: 0.875rem;\n    font-weight: 500;\n}\n\n.tag-blue {\n    background: #dbeafe;\n    color: #1e40af;\n}\n\n.tag-green {\n    background: #d1fae5;\n    color: #065f46;\n}\n\n.tag-purple {\n    background: #e9d5ff;\n    color: #6b21a8;\n}\n\n/* Main Grid */\n.main-grid {\n    display: grid;\n    grid-template-columns: 1fr 2fr;\n    gap: 1.5rem;\n}\n\n@media (max-width: 1024px) {\n    .main-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n/* Card */\n.card {\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    padding: 1.5rem;\n    margin-bottom: 1.5rem;\n}\n\n.card h2 {\n    color: #1f2937;\n    font-size: 1.25rem;\n    margin-bottom: 1.5rem;\n}\n\n.card h3 {\n    color: #374151;\n    font-size: 1rem;\n    margin-bottom: 1rem;\n}\n\n/* Control Groups */\n.control-group {\n    margin-bottom: 2rem;\n}\n\n.control-group label {\n    display: block;\n    color: #374151;\n    font-weight: 600;\n    font-size: 0.875rem;\n    margin-bottom: 0.5rem;\n}\n\n.control-group label span {\n    font-weight: 700;\n    color: #111827;\n}\n\n/* Sliders */\n.slider {\n    width: 100%;\n    height: 8px;\n    border-radius: 5px;\n    outline: none;\n    -webkit-appearance: none;\n    cursor: pointer;\n}\n\n.slider-blue {\n    background: #bfdbfe;\n}\n\n.slider-green {\n    background: #bbf7d0;\n}\n\n.slider-purple {\n    background: #e9d5ff;\n}\n\n.slider::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #ea580c;\n    cursor: pointer;\n}\n\n.slider::-moz-range-thumb {\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #ea580c;\n    cursor: pointer;\n    border: none;\n}\n\n.composition-info {\n    margin-top: 0.5rem;\n    font-size: 0.75rem;\n    color: #6b7280;\n    font-style: italic;\n}\n\n/* Animate Button */\n.animate-btn {\n    width: 100%;\n    background: #ea580c;\n    color: white;\n    padding: 1rem;\n    border: none;\n    border-radius: 8px;\n    font-size: 1rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: background 0.3s;\n}\n\n.animate-btn:hover {\n    background: #c2410c;\n}\n\n/* Results */\n.results-card {\n    margin-bottom: 1.5rem;\n}\n\n.result-item {\n    padding: 1rem;\n    border-radius: 8px;\n    margin-bottom: 1rem;\n}\n\n.result-item:last-child {\n    margin-bottom: 0;\n}\n\n.result-blue {\n    background: #eff6ff;\n}\n\n.result-green {\n    background: #f0fdf4;\n}\n\n.result-purple {\n    background: #faf5ff;\n}\n\n.result-label {\n    color: #6b7280;\n    font-size: 0.875rem;\n    margin-bottom: 0.25rem;\n}\n\n.result-value {\n    font-size: 1.5rem;\n    font-weight: 700;\n}\n\n.result-blue .result-value {\n    color: #1d4ed8;\n}\n\n.result-green .result-value {\n    color: #15803d;\n}\n\n.result-purple .result-value {\n    color: #7c3aed;\n}\n\n/* Info Card */\n.info-card {\n    background: linear-gradient(135deg, #fef3c7 0%, #fee2e2 100%);\n    border: 2px solid #f97316;\n}\n\n.info-card p {\n    color: #374151;\n    font-size: 0.875rem;\n    line-height: 1.6;\n    margin-bottom: 1rem;\n}\n\n.info-card ul {\n    list-style: none;\n    padding: 0;\n}\n\n.info-card ul li {\n    color: #374151;\n    font-size: 0.875rem;\n    padding: 0.5rem 0;\n    border-bottom: 1px solid rgba(249, 115, 22, 0.3);\n}\n\n.info-card ul li:last-child {\n    border-bottom: none;\n}\n\n/* Column Visualization */\n.column-container {\n    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\n    border-radius: 8px;\n    padding: 2rem;\n    min-height: 500px;\n    display: flex;\n    justify-content: center;\n}\n\n.column-wrapper {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    width: 100%;\n    max-width: 400px;\n}\n\n.condenser {\n    width: 200px;\n    height: 60px;\n    background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);\n    border-radius: 12px 12px 0 0;\n    border: 3px solid #2563eb;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    position: relative;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n}\n\n.reboiler {\n    width: 200px;\n    height: 60px;\n    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);\n    border-radius: 0 0 12px 12px;\n    border: 3px solid #b45309;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    position: relative;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n}\n\n.equipment-label {\n    font-size: 0.75rem;\n    font-weight: 700;\n    color: white;\n    background: rgba(0, 0, 0, 0.3);\n    padding: 0.25rem 0.75rem;\n    border-radius: 12px;\n}\n\n.stream-label {\n    position: absolute;\n    font-size: 0.75rem;\n    font-weight: 600;\n    color: white;\n    background: rgba(0, 0, 0, 0.4);\n    padding: 0.5rem 0.75rem;\n    border-radius: 8px;\n    white-space: nowrap;\n}\n\n.distillate-label {\n    top: 50%;\n    right: -150px;\n    transform: translateY(-50%);\n}\n\n.bottoms-label {\n    top: 50%;\n    right: -150px;\n    transform: translateY(-50%);\n}\n\n.column {\n    width: 200px;\n    background: linear-gradient(135deg, #cbd5e1 0%, #94a3b8 100%);\n    border-left: 3px solid #64748b;\n    border-right: 3px solid #64748b;\n    position: relative;\n    display: flex;\n    align-items: center;\n}\n\n.column-body {\n    width: 100%;\n    padding: 0.5rem 0;\n}\n\n.stage {\n    height: 30px;\n    margin: 2px 0;\n    background: linear-gradient(90deg, #e2e8f0 0%, #cbd5e1 100%);\n    border: 2px solid #64748b;\n    border-radius: 4px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 0.7rem;\n    font-weight: 600;\n    color: #1e293b;\n    position: relative;\n    overflow: hidden;\n}\n\n.stage::before {\n    content: '';\n    position: absolute;\n    left: 0;\n    top: 0;\n    height: 100%;\n    background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);\n    transition: width 0.5s ease;\n}\n\n.stage-number {\n    position: relative;\n    z-index: 1;\n    color: white;\n    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);\n}\n\n.reflux-arrow {\n    position: absolute;\n    left: -40px;\n    top: 50%;\n    transform: translateY(-50%);\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.arrow-down {\n    width: 4px;\n    height: 100px;\n    background: #dc2626;\n    position: relative;\n}\n\n.arrow-down::after {\n    content: '';\n    position: absolute;\n    bottom: -8px;\n    left: 50%;\n    transform: translateX(-50%);\n    width: 0;\n    height: 0;\n    border-left: 6px solid transparent;\n    border-right: 6px solid transparent;\n    border-top: 10px solid #dc2626;\n}\n\n.reflux-label {\n    font-size: 0.7rem;\n    font-weight: 700;\n    color: #dc2626;\n    background: white;\n    padding: 0.25rem 0.5rem;\n    border-radius: 8px;\n    border: 2px solid #dc2626;\n    white-space: nowrap;\n}\n\n/* Chart */\n.chart-container {\n    position: relative;\n    height: 350px;\n    width: 100%;\n}\n\n@media (max-width: 768px) {\n    body {\n        padding: 1rem;\n    }\n\n    .header h1 {\n        font-size: 1.5rem;\n    }\n\n    .column-wrapper {\n        max-width: 300px;\n    }\n\n    .condenser, .reboiler, .column {\n        width: 150px;\n    }\n\n    .distillate-label, .bottoms-label {\n        right: -120px;\n        font-size: 0.65rem;\n    }\n}", "js": "// Global variables\nlet xD = 0.95;\nlet xB = 0.05;\nlet alpha = 2.5;\nlet mcCabeChart = null;\nlet alphaChart = null;\n\n// Calculate minimum stages using Fenske equation\nfunction calculate(xDVal, xBVal, alphaVal) {\n    // Nmin = log((xD/(1-xD)) * ((1-xB)/xB)) / log(alpha)\n    const numerator = (xDVal / (1 - xDVal)) * ((1 - xBVal) / xBVal);\n    const nMin = Math.log(numerator) / Math.log(alphaVal);\n    \n    // Separation factor\n    const separationFactor = numerator;\n    \n    // Approximate recovery (simplified)\n    const recovery = ((xDVal - xBVal) / (1 - xBVal)) * 100;\n    \n    return { nMin, separationFactor, recovery };\n}\n\n// Generate equilibrium curve data\nfunction generateEquilibriumCurve() {\n    const points = 100;\n    const xLiquid = [];\n    const yVapor = [];\n    \n    for (let i = 0; i <= points; i++) {\n        const x = i / points;\n        // Equilibrium: y = alpha*x / (1 + (alpha-1)*x)\n        const y = (alpha * x) / (1 + (alpha - 1) * x);\n        xLiquid.push(x);\n        yVapor.push(y);\n    }\n    \n    return { xLiquid, yVapor };\n}\n\n// Generate McCabe-Thiele stepping data for total reflux\nfunction generateSteppingData() {\n    const steps = [];\n    const nMin = calculate(xD, xB, alpha).nMin;\n    const stages = Math.ceil(nMin);\n    \n    let x = xB;\n    let y = xB; // Start at bottoms\n    \n    steps.push({ x: x, y: y }); // Starting point\n    \n    for (let i = 0; i < stages + 2; i++) {\n        // Horizontal line (liquid composition constant on stage)\n        y = (alpha * x) / (1 + (alpha - 1) * x);\n        steps.push({ x: x, y: y });\n        \n        if (y >= xD) break;\n        \n        // Vertical line at total reflux (operating line is y=x)\n        x = y;\n        steps.push({ x: x, y: y });\n        \n        if (x >= xD) break;\n    }\n    \n    return steps;\n}\n\n// Generate Nmin vs alpha data\nfunction generateAlphaData() {\n    const points = 50;\n    const alphas = [];\n    const nMins = [];\n    \n    for (let i = 0; i <= points; i++) {\n        const a = 1.1 + (3.9 * i) / points; // From 1.1 to 5.0\n        const result = calculate(xD, xB, a);\n        alphas.push(a.toFixed(2));\n        nMins.push(result.nMin);\n    }\n    \n    return { alphas, nMins };\n}\n\n// Update all displays\nfunction updateDisplay() {\n    const result = calculate(xD, xB, alpha);\n    \n    // Update result displays\n    document.getElementById('nmin').textContent = result.nMin.toFixed(2);\n    document.getElementById('separation-factor').textContent = result.separationFactor.toFixed(2);\n    document.getElementById('recovery').textContent = result.recovery.toFixed(1) + '%';\n    \n    // Update column display labels\n    document.getElementById('xd-display').textContent = xD.toFixed(3);\n    document.getElementById('xb-display').textContent = xB.toFixed(3);\n    \n    // Update charts\n    updateMcCabeChart();\n    updateAlphaChart();\n}\n\n// Generate column stages\nfunction generateColumnStages() {\n    const columnBody = document.getElementById('column-body');\n    columnBody.innerHTML = '';\n    \n    const nMin = calculate(xD, xB, alpha).nMin;\n    const stages = Math.ceil(nMin);\n    \n    // Generate stages from top to bottom\n    for (let i = 1; i <= stages; i++) {\n        const stage = document.createElement('div');\n        stage.className = 'stage';\n        stage.id = `stage-${i}`;\n        \n        const stageNum = document.createElement('span');\n        stageNum.className = 'stage-number';\n        stageNum.textContent = `Stage ${i}`;\n        stage.appendChild(stageNum);\n        \n        // Calculate composition for this stage (linear interpolation for visualization)\n        const composition = xD - ((xD - xB) * (i - 1)) / stages;\n        const fillPercent = (composition / xD) * 100;\n        \n        stage.style.setProperty('--fill-width', fillPercent + '%');\n        stage.querySelector('::before')?.style.setProperty('width', fillPercent + '%');\n        \n        columnBody.appendChild(stage);\n    }\n    \n    // Set dynamic height for column\n    const columnHeight = stages * 34; // 30px height + 4px margin\n    document.getElementById('column').style.height = columnHeight + 'px';\n}\n\n// Visualize column with animation\nfunction visualizeColumn() {\n    generateColumnStages();\n    \n    const stages = document.querySelectorAll('.stage');\n    const nMin = calculate(xD, xB, alpha).nMin;\n    const totalStages = Math.ceil(nMin);\n    \n    stages.forEach((stage, index) => {\n        setTimeout(() => {\n            const composition = xD - ((xD - xB) * index) / totalStages;\n            const fillPercent = (composition / xD) * 100;\n            stage.style.setProperty('--fill-width', fillPercent + '%');\n            stage.querySelector('::before').style.width = fillPercent + '%';\n        }, index * 200);\n    });\n}\n\n// Initialize McCabe-Thiele chart\nfunction initMcCabeChart() {\n    const ctx = document.getElementById('mcCabeChart').getContext('2d');\n    const eqData = generateEquilibriumCurve();\n    const stepData = generateSteppingData();\n    \n    mcCabeChart = new Chart(ctx, {\n        type: 'line',\n        data: {\n            datasets: [\n                {\n                    label: 'Equilibrium Curve',\n                    data: eqData.xLiquid.map((x, i) => ({ x: x, y: eqData.yVapor[i] })),\n                    borderColor: '#3b82f6',\n                    backgroundColor: 'rgba(59, 130, 246, 0.1)',\n                    borderWidth: 3,\n                    tension: 0.4,\n                    pointRadius: 0,\n                    fill: false\n                },\n                {\n                    label: 'y = x (45° line)',\n                    data: [{ x: 0, y: 0 }, { x: 1, y: 1 }],\n                    borderColor: '#9ca3af',\n                    borderWidth: 2,\n                    borderDash: [5, 5],\n                    pointRadius: 0,\n                    fill: false\n                },\n                {\n                    label: 'Operating Line (Total Reflux)',\n                    data: stepData,\n                    borderColor: '#dc2626',\n                    backgroundColor: 'rgba(220, 38, 38, 0.1)',\n                    borderWidth: 2,\n                    stepped: false,\n                    pointRadius: 0,\n                    fill: false\n                }\n            ]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            interaction: {\n                mode: 'index',\n                intersect: false,\n            },\n            plugins: {\n                legend: {\n                    position: 'top',\n                },\n                tooltip: {\n                    callbacks: {\n                        label: function(context) {\n                            return context.dataset.label + ': (' + \n                                   context.parsed.x.toFixed(3) + ', ' + \n                                   context.parsed.y.toFixed(3) + ')';\n                        }\n                    }\n                }\n            },\n            scales: {\n                x: {\n                    type: 'linear',\n                    min: 0,\n                    max: 1,\n                    display: true,\n                    title: {\n                        display: true,\n                        text: 'x (Liquid Mole Fraction - Light Component)'\n                    },\n                    ticks: {\n                        stepSize: 0.1\n                    }\n                },\n                y: {\n                    type: 'linear',\n                    min: 0,\n                    max: 1,\n                    display: true,\n                    title: {\n                        display: true,\n                        text: 'y (Vapor Mole Fraction - Light Component)'\n                    },\n                    ticks: {\n                        stepSize: 0.1\n                    }\n                }\n            }\n        }\n    });\n}\n\n// Initialize alpha chart\nfunction initAlphaChart() {\n    const ctx = document.getElementById('alphaChart').getContext('2d');\n    const data = generateAlphaData();\n    \n    alphaChart = new Chart(ctx, {\n        type: 'line',\n        data: {\n            labels: data.alphas,\n            datasets: [\n                {\n                    label: 'Minimum Stages (Nmin)',\n                    data: data.nMins,\n                    borderColor: '#7c3aed',\n                    backgroundColor: 'rgba(124, 58, 237, 0.1)',\n                    borderWidth: 3,\n                    tension: 0.4,\n                    pointRadius: 0,\n                    fill: true\n                }\n            ]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            interaction: {\n                mode: 'index',\n                intersect: false,\n            },\n            plugins: {\n                legend: {\n                    position: 'top',\n                },\n                tooltip: {\n                    callbacks: {\n                        label: function(context) {\n                            return 'Nmin = ' + context.parsed.y.toFixed(2) + ' stages';\n                        }\n                    }\n                }\n            },\n            scales: {\n                x: {\n                    display: true,\n                    title: {\n                        display: true,\n                        text: 'Relative Volatility (α)'\n                    },\n                    ticks: {\n                        maxTicksLimit: 10\n                    }\n                },\n                y: {\n                    display: true,\n                    title: {\n                        display: true,\n                        text: 'Minimum Stages (Nmin)'\n                    },\n                    beginAtZero: true\n                }\n            }\n        }\n    });\n    \n    // Add current point\n    addCurrentPointToAlphaChart();\n}\n\n// Add current operating point to alpha chart\nfunction addCurrentPointToAlphaChart() {\n    if (alphaChart) {\n        const result = calculate(xD, xB, alpha);\n        \n        // Remove existing current point dataset if any\n        if (alphaChart.data.datasets.length > 1) {\n            alphaChart.data.datasets.pop();\n        }\n        \n        // Add current point\n        alphaChart.data.datasets.push({\n            label: 'Current α',\n            data: [{ x: alpha, y: result.nMin }],\n            borderColor: '#ef4444',\n            backgroundColor: '#ef4444',\n            pointRadius: 8,\n            pointHoverRadius: 10,\n            showLine: false,\n            type: 'scatter'\n        });\n        \n        alphaChart.update('none');\n    }\n}\n\n// Update McCabe-Thiele chart\nfunction updateMcCabeChart() {\n    if (mcCabeChart) {\n        const eqData = generateEquilibriumCurve();\n        const stepData = generateSteppingData();\n        \n        mcCabeChart.data.datasets[0].data = eqData.xLiquid.map((x, i) => ({ x: x, y: eqData.yVapor[i] }));\n        mcCabeChart.data.datasets[2].data = stepData;\n        mcCabeChart.update('none');\n    }\n}\n\n// Update alpha chart\nfunction updateAlphaChart() {\n    if (alphaChart) {\n        const data = generateAlphaData();\n        alphaChart.data.labels = data.alphas;\n        alphaChart.data.datasets[0].data = data.nMins;\n        addCurrentPointToAlphaChart();\n    }\n}\n\n// Event listeners\ndocument.addEventListener('DOMContentLoaded', function() {\n    // xD slider\n    const xdSlider = document.getElementById('xd-slider');\n    const xdValue = document.getElementById('xd-value');\n    \n    xdSlider.addEventListener('input', function() {\n        xD = parseFloat(this.value);\n        // Ensure xD > xB\n        if (xD <= xB) {\n            xD = xB + 0.01;\n            this.value = xD;\n        }\n        xdValue.textContent = xD.toFixed(3);\n        updateDisplay();\n    });\n    \n    // xB slider\n    const xbSlider = document.getElementById('xb-slider');\n    const xbValue = document.getElementById('xb-value');\n    \n    xbSlider.addEventListener('input', function() {\n        xB = parseFloat(this.value);\n        // Ensure xB < xD\n        if (xB >= xD) {\n            xB = xD - 0.01;\n            this.value = xB;\n        }\n        xbValue.textContent = xB.toFixed(3);\n        updateDisplay();\n    });\n    \n    // alpha slider\n    const alphaSlider = document.getElementById('alpha-slider');\n    const alphaValue = document.getElementById('alpha-value');\n    \n    alphaSlider.addEventListener('input', function() {\n        alpha = parseFloat(this.value);\n        alphaValue.textContent = alpha.toFixed(2);\n        updateDisplay();\n    });\n    \n    // Visualize button\n    document.getElementById('visualize-btn').addEventListener('click', visualizeColumn);\n    \n    // Initialize\n    generateColumnStages();\n    initMcCabeChart();\n    initAlphaChart();\n    updateDisplay();\n});"}}
{"input": {"input_text": "Raoult's law bubble-point for binary ideal mixture: P = x1*P1sat + x2*P2sat. Compute bubble pressure.", "simulation_name": " Raoult Bubble Point", "domain": "Chemical Engineering", "description": "Ideal binary bubble-point pressure", "assumptions": ["Ideal solution"], "entities": [], "constants": [], "parameters": [{"name": "liquid_molefrac_1", "symbol": "x1", "unit": "fraction", "range": [0, 1]}, {"name": "sat_pressure_1", "symbol": "P1sat", "unit": "kPa", "range": [1, 500]}, {"name": "sat_pressure_2", "symbol": "P2sat", "unit": "kPa", "range": [1, 500]}], "equations": [{"description": "Complement", "expression": "x2 = 1 - x1"}, {"description": "Bubble pressure", "expression": "P = x1*P1sat + x2*P2sat"}], "initial_conditions": {}, "outputs": ["P"], "simulation_controls": ["x1", "P1sat", "P2sat"], "constraints": ["0 <= x1 <= 1"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Raoult's Law Bubble Point Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js\"></script>\n</head>\n<body>\n    <div class=\"container\">\n        <!-- Header -->\n        <div class=\"header\">\n            <h1>Raoult's Law - Bubble Point Pressure</h1>\n            <p class=\"subtitle\">P = x<sub>1</sub>·P<sub>1</sub><sup>sat</sup> + x<sub>2</sub>·P<sub>2</sub><sup>sat</sup></p>\n            <div class=\"tags\">\n                <span class=\"tag tag-blue\">Ideal Solution</span>\n                <span class=\"tag tag-green\">Binary Mixture</span>\n                <span class=\"tag tag-purple\">VLE</span>\n            </div>\n        </div>\n\n        <div class=\"main-grid\">\n            <!-- Controls Panel -->\n            <div class=\"controls-panel\">\n                <div class=\"card\">\n                    <h2>Control Parameters</h2>\n                    \n                    <!-- Liquid Mole Fraction -->\n                    <div class=\"control-group\">\n                        <label>\n                            Liquid Mole Fraction (x<sub>1</sub>): <span id=\"x1-value\">0.500</span>\n                        </label>\n                        <input type=\"range\" id=\"x1-slider\" min=\"0\" max=\"1\" step=\"0.001\" value=\"0.5\" class=\"slider slider-blue\">\n                        <div class=\"composition-bar\">\n                            <div class=\"comp-1\" id=\"comp1-bar\"></div>\n                            <div class=\"comp-2\" id=\"comp2-bar\"></div>\n                        </div>\n                        <div class=\"composition-labels\">\n                            <span>Component 1: <span id=\"x1-percent\">50.0</span>%</span>\n                            <span>Component 2: <span id=\"x2-percent\">50.0</span>%</span>\n                        </div>\n                    </div>\n\n                    <!-- Saturation Pressure 1 -->\n                    <div class=\"control-group\">\n                        <label>\n                            P<sub>1</sub><sup>sat</sup> (Component 1): <span id=\"p1sat-value\">200</span> kPa\n                        </label>\n                        <input type=\"range\" id=\"p1sat-slider\" min=\"1\" max=\"500\" step=\"1\" value=\"200\" class=\"slider slider-green\">\n                        <div class=\"pressure-info\">Vapor pressure of pure component 1</div>\n                    </div>\n\n                    <!-- Saturation Pressure 2 -->\n                    <div class=\"control-group\">\n                        <label>\n                            P<sub>2</sub><sup>sat</sup> (Component 2): <span id=\"p2sat-value\">100</span> kPa\n                        </label>\n                        <input type=\"range\" id=\"p2sat-slider\" min=\"1\" max=\"500\" step=\"1\" value=\"100\" class=\"slider slider-purple\">\n                        <div class=\"pressure-info\">Vapor pressure of pure component 2</div>\n                    </div>\n\n                    <button id=\"animate-btn\" class=\"animate-btn\">Visualize Bubble Formation</button>\n                </div>\n\n                <!-- Results -->\n                <div class=\"card results-card\">\n                    <h2>Results</h2>\n                    <div class=\"result-item result-blue\">\n                        <p class=\"result-label\">Bubble Pressure (P)</p>\n                        <p class=\"result-value\" id=\"bubble-pressure\">150.0 kPa</p>\n                    </div>\n                    <div class=\"result-item result-green\">\n                        <p class=\"result-label\">Vapor Mole Fraction (y<sub>1</sub>)</p>\n                        <p class=\"result-value\" id=\"vapor-fraction\">0.667</p>\n                    </div>\n                    <div class=\"result-item result-purple\">\n                        <p class=\"result-label\">Relative Volatility (α)</p>\n                        <p class=\"result-value\" id=\"rel-volatility\">2.00</p>\n                    </div>\n                </div>\n\n                <!-- Info Card -->\n                <div class=\"card info-card\">\n                    <h3>Raoult's Law</h3>\n                    <p>For an ideal binary mixture, the bubble point pressure is the sum of partial pressures.</p>\n                    <ul>\n                        <li><strong>Bubble Point:</strong> Temperature/pressure where first vapor bubble forms</li>\n                        <li><strong>x<sub>i</sub>:</strong> Liquid mole fraction</li>\n                        <li><strong>P<sub>i</sub><sup>sat</sup>:</strong> Pure component vapor pressure</li>\n                        <li><strong>y<sub>1</sub> = x<sub>1</sub>·P<sub>1</sub><sup>sat</sup>/P</strong></li>\n                    </ul>\n                </div>\n            </div>\n\n            <!-- Visualization Panel -->\n            <div class=\"visualization-panel\">\n                <!-- Bubble Formation Visualization -->\n                <div class=\"card\">\n                    <h2>Bubble Formation in Liquid Mixture</h2>\n                    <div class=\"vessel-container\">\n                        <div class=\"vessel\">\n                            <div class=\"liquid-phase\" id=\"liquid-phase\">\n                                <div class=\"liquid-label\">Liquid Phase</div>\n                                <div class=\"molecules-container\" id=\"liquid-molecules\"></div>\n                                <div class=\"bubble-container\" id=\"bubble-container\"></div>\n                            </div>\n                            <div class=\"vapor-phase\" id=\"vapor-phase\">\n                                <div class=\"vapor-label\">Vapor Phase</div>\n                                <div class=\"molecules-container\" id=\"vapor-molecules\"></div>\n                            </div>\n                        </div>\n                        <div class=\"pressure-gauge\">\n                            <div class=\"gauge-label\">System Pressure</div>\n                            <div class=\"gauge-value\" id=\"gauge-pressure\">150.0 kPa</div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- P-x-y Diagram -->\n                <div class=\"card\">\n                    <h2>Pressure-Composition (P-x-y) Diagram</h2>\n                    <div class=\"chart-container\">\n                        <canvas id=\"pxyChart\"></canvas>\n                    </div>\n                </div>\n\n                <!-- Vapor Composition Chart -->\n                <div class=\"card\">\n                    <h2>Vapor-Liquid Equilibrium (y vs x)</h2>\n                    <div class=\"chart-container\">\n                        <canvas id=\"yxChart\"></canvas>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, #e0f2fe 0%, #fae8ff 100%);\n    min-height: 100vh;\n    padding: 2rem;\n}\n\n.container {\n    max-width: 1400px;\n    margin: 0 auto;\n}\n\n/* Header */\n.header {\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    padding: 2rem;\n    margin-bottom: 2rem;\n}\n\n.header h1 {\n    color: #0c4a6e;\n    font-size: 2rem;\n    margin-bottom: 0.5rem;\n}\n\n.subtitle {\n    color: #6b7280;\n    font-size: 1rem;\n    margin-bottom: 1rem;\n}\n\n.tags {\n    display: flex;\n    gap: 1rem;\n    flex-wrap: wrap;\n}\n\n.tag {\n    padding: 0.5rem 1rem;\n    border-radius: 20px;\n    font-size: 0.875rem;\n    font-weight: 500;\n}\n\n.tag-blue {\n    background: #dbeafe;\n    color: #1e40af;\n}\n\n.tag-green {\n    background: #d1fae5;\n    color: #065f46;\n}\n\n.tag-purple {\n    background: #e9d5ff;\n    color: #6b21a8;\n}\n\n/* Main Grid */\n.main-grid {\n    display: grid;\n    grid-template-columns: 1fr 2fr;\n    gap: 1.5rem;\n}\n\n@media (max-width: 1024px) {\n    .main-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n/* Card */\n.card {\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    padding: 1.5rem;\n    margin-bottom: 1.5rem;\n}\n\n.card h2 {\n    color: #1f2937;\n    font-size: 1.25rem;\n    margin-bottom: 1.5rem;\n}\n\n.card h3 {\n    color: #374151;\n    font-size: 1rem;\n    margin-bottom: 1rem;\n}\n\n/* Control Groups */\n.control-group {\n    margin-bottom: 2rem;\n}\n\n.control-group label {\n    display: block;\n    color: #374151;\n    font-weight: 600;\n    font-size: 0.875rem;\n    margin-bottom: 0.5rem;\n}\n\n.control-group label span {\n    font-weight: 700;\n    color: #111827;\n}\n\n/* Sliders */\n.slider {\n    width: 100%;\n    height: 8px;\n    border-radius: 5px;\n    outline: none;\n    -webkit-appearance: none;\n    cursor: pointer;\n}\n\n.slider-blue {\n    background: #bfdbfe;\n}\n\n.slider-green {\n    background: #bbf7d0;\n}\n\n.slider-purple {\n    background: #e9d5ff;\n}\n\n.slider::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #0891b2;\n    cursor: pointer;\n}\n\n.slider::-moz-range-thumb {\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #0891b2;\n    cursor: pointer;\n    border: none;\n}\n\n.composition-bar {\n    width: 100%;\n    height: 30px;\n    display: flex;\n    margin-top: 0.5rem;\n    border-radius: 6px;\n    overflow: hidden;\n    border: 2px solid #cbd5e1;\n}\n\n.comp-1 {\n    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n    transition: width 0.3s ease;\n}\n\n.comp-2 {\n    background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);\n    transition: width 0.3s ease;\n}\n\n.composition-labels {\n    display: flex;\n    justify-content: space-between;\n    margin-top: 0.5rem;\n    font-size: 0.75rem;\n    color: #6b7280;\n}\n\n.pressure-info {\n    margin-top: 0.5rem;\n    font-size: 0.75rem;\n    color: #6b7280;\n    font-style: italic;\n}\n\n/* Animate Button */\n.animate-btn {\n    width: 100%;\n    background: #0891b2;\n    color: white;\n    padding: 1rem;\n    border: none;\n    border-radius: 8px;\n    font-size: 1rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: background 0.3s;\n}\n\n.animate-btn:hover {\n    background: #0e7490;\n}\n\n/* Results */\n.results-card {\n    margin-bottom: 1.5rem;\n}\n\n.result-item {\n    padding: 1rem;\n    border-radius: 8px;\n    margin-bottom: 1rem;\n}\n\n.result-item:last-child {\n    margin-bottom: 0;\n}\n\n.result-blue {\n    background: #eff6ff;\n}\n\n.result-green {\n    background: #f0fdf4;\n}\n\n.result-purple {\n    background: #faf5ff;\n}\n\n.result-label {\n    color: #6b7280;\n    font-size: 0.875rem;\n    margin-bottom: 0.25rem;\n}\n\n.result-value {\n    font-size: 1.5rem;\n    font-weight: 700;\n}\n\n.result-blue .result-value {\n    color: #0c4a6e;\n}\n\n.result-green .result-value {\n    color: #15803d;\n}\n\n.result-purple .result-value {\n    color: #7c3aed;\n}\n\n/* Info Card */\n.info-card {\n    background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);\n    border: 2px solid #3b82f6;\n}\n\n.info-card p {\n    color: #374151;\n    font-size: 0.875rem;\n    line-height: 1.6;\n    margin-bottom: 1rem;\n}\n\n.info-card ul {\n    list-style: none;\n    padding: 0;\n}\n\n.info-card ul li {\n    color: #374151;\n    font-size: 0.875rem;\n    padding: 0.5rem 0;\n    border-bottom: 1px solid rgba(59, 130, 246, 0.3);\n}\n\n.info-card ul li:last-child {\n    border-bottom: none;\n}\n\n/* Vessel Visualization */\n.vessel-container {\n    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\n    border-radius: 8px;\n    padding: 2rem;\n    min-height: 400px;\n    display: flex;\n    gap: 2rem;\n    align-items: center;\n}\n\n.vessel {\n    flex: 1;\n    height: 350px;\n    border: 4px solid #475569;\n    border-radius: 12px;\n    overflow: hidden;\n    position: relative;\n    background: linear-gradient(180deg, #e0f2fe 0%, #bae6fd 100%);\n    box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.1);\n}\n\n.liquid-phase {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    height: 70%;\n    background: linear-gradient(180deg, #67e8f9 0%, #06b6d4 100%);\n    border-top: 3px dashed #0891b2;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    padding: 1rem;\n}\n\n.vapor-phase {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 30%;\n    background: linear-gradient(180deg, rgba(224, 242, 254, 0.5) 0%, rgba(224, 242, 254, 0.8) 100%);\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 1rem;\n}\n\n.liquid-label, .vapor-label {\n    font-size: 0.75rem;\n    font-weight: 700;\n    color: #0c4a6e;\n    background: rgba(255, 255, 255, 0.8);\n    padding: 0.25rem 0.75rem;\n    border-radius: 12px;\n    border: 2px solid #0891b2;\n}\n\n.molecules-container {\n    position: relative;\n    width: 100%;\n    flex: 1;\n}\n\n.molecule {\n    position: absolute;\n    width: 10px;\n    height: 10px;\n    border-radius: 50%;\n    box-shadow: 0 0 6px rgba(0, 0, 0, 0.3);\n}\n\n.molecule-1 {\n    background: #3b82f6;\n}\n\n.molecule-2 {\n    background: #a855f7;\n}\n\n.bubble-container {\n    position: relative;\n    width: 100%;\n    height: 100%;\n}\n\n.bubble {\n    position: absolute;\n    border-radius: 50%;\n    background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.8), rgba(186, 230, 253, 0.6));\n    border: 2px solid rgba(8, 145, 178, 0.4);\n    opacity: 0;\n}\n\n.bubble.animating {\n    animation: bubbleRise 3s ease-out;\n}\n\n@keyframes bubbleRise {\n    0% {\n        bottom: 10%;\n        opacity: 0;\n        transform: scale(0.5);\n    }\n    20% {\n        opacity: 1;\n    }\n    100% {\n        bottom: 95%;\n        opacity: 0;\n        transform: scale(1.5);\n    }\n}\n\n.pressure-gauge {\n    width: 150px;\n    background: white;\n    border-radius: 12px;\n    padding: 1.5rem;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    text-align: center;\n    border: 3px solid #0891b2;\n}\n\n.gauge-label {\n    font-size: 0.875rem;\n    font-weight: 600;\n    color: #6b7280;\n    margin-bottom: 1rem;\n}\n\n.gauge-value {\n    font-size: 1.75rem;\n    font-weight: 700;\n    color: #0891b2;\n}\n\n/* Chart */\n.chart-container {\n    position: relative;\n    height: 350px;\n    width: 100%;\n}\n\n@media (max-width: 768px) {\n    body {\n        padding: 1rem;\n    }\n\n    .header h1 {\n        font-size: 1.5rem;\n    }\n\n    .vessel-container {\n        flex-direction: column;\n    }\n\n    .vessel {\n        width: 100%;\n    }\n\n    .pressure-gauge {\n        width: 100%;\n    }\n}", "js": "// Global variables\nlet x1 = 0.5;\nlet P1sat = 200;\nlet P2sat = 100;\nlet pxyChart = null;\nlet yxChart = null;\n\n// Calculate bubble point and vapor composition\nfunction calculate(x1Val, p1satVal, p2satVal) {\n    const x2 = 1 - x1Val;\n    const P = x1Val * p1satVal + x2 * p2satVal; // Raoult's Law\n    const y1 = (x1Val * p1satVal) / P; // Vapor mole fraction\n    const alpha = p1satVal / p2satVal; // Relative volatility\n    \n    return { P, y1, x2, alpha };\n}\n\n// Generate P-x-y data\nfunction generatePxyData() {\n    const points = 100;\n    const x1Data = [];\n    const pBubble = [];\n    const pDew = [];\n    \n    for (let i = 0; i <= points; i++) {\n        const x = i / points;\n        const xComp2 = 1 - x;\n        \n        // Bubble point curve (liquid line)\n        const pB = x * P1sat + xComp2 * P2sat;\n        \n        // Dew point curve (vapor line) - need to solve for x from y\n        // For Raoult: y1 = x1*P1sat/P, so at dew point P = y1*P1sat + (1-y1)*P2sat\n        const y = x; // Use x values as y for dew curve\n        const pD = (y * P1sat * P2sat) / (y * P1sat + (1 - y) * P2sat);\n        \n        x1Data.push(x.toFixed(3));\n        pBubble.push(pB);\n        pDew.push(pD);\n    }\n    \n    return { x1Data, pBubble, pDew };\n}\n\n// Generate y-x equilibrium data\nfunction generateYxData() {\n    const points = 100;\n    const xData = [];\n    const yData = [];\n    \n    for (let i = 0; i <= points; i++) {\n        const x = i / points;\n        const xComp2 = 1 - x;\n        const P = x * P1sat + xComp2 * P2sat;\n        const y = (x * P1sat) / P;\n        \n        xData.push(x.toFixed(3));\n        yData.push(y);\n    }\n    \n    return { xData, yData };\n}\n\n// Update all displays\nfunction updateDisplay() {\n    const result = calculate(x1, P1sat, P2sat);\n    \n    // Update result displays\n    document.getElementById('bubble-pressure').textContent = result.P.toFixed(1) + ' kPa';\n    document.getElementById('vapor-fraction').textContent = result.y1.toFixed(3);\n    document.getElementById('rel-volatility').textContent = result.alpha.toFixed(2);\n    \n    // Update gauge\n    document.getElementById('gauge-pressure').textContent = result.P.toFixed(1) + ' kPa';\n    \n    // Update composition percentages\n    document.getElementById('x1-percent').textContent = (x1 * 100).toFixed(1);\n    document.getElementById('x2-percent').textContent = (result.x2 * 100).toFixed(1);\n    \n    // Update composition bar\n    document.getElementById('comp1-bar').style.width = (x1 * 100) + '%';\n    document.getElementById('comp2-bar').style.width = (result.x2 * 100) + '%';\n    \n    // Update charts\n    updatePxyChart();\n    updateYxChart();\n    \n    // Update molecules\n    updateMolecules();\n}\n\n// Initialize molecules in liquid and vapor phases\nfunction initMolecules() {\n    const liquidContainer = document.getElementById('liquid-molecules');\n    const vaporContainer = document.getElementById('vapor-molecules');\n    \n    liquidContainer.innerHTML = '';\n    vaporContainer.innerHTML = '';\n    \n    // Liquid molecules\n    const liquidCount = 40;\n    const comp1CountLiquid = Math.round(x1 * liquidCount);\n    \n    for (let i = 0; i < liquidCount; i++) {\n        const molecule = document.createElement('div');\n        molecule.className = i < comp1CountLiquid ? 'molecule molecule-1' : 'molecule molecule-2';\n        molecule.style.left = Math.random() * 90 + 5 + '%';\n        molecule.style.top = Math.random() * 90 + 5 + '%';\n        liquidContainer.appendChild(molecule);\n    }\n    \n    // Vapor molecules (based on y1)\n    const result = calculate(x1, P1sat, P2sat);\n    const vaporCount = 20;\n    const comp1CountVapor = Math.round(result.y1 * vaporCount);\n    \n    for (let i = 0; i < vaporCount; i++) {\n        const molecule = document.createElement('div');\n        molecule.className = i < comp1CountVapor ? 'molecule molecule-1' : 'molecule molecule-2';\n        molecule.style.left = Math.random() * 90 + 5 + '%';\n        molecule.style.top = Math.random() * 90 + 5 + '%';\n        vaporContainer.appendChild(molecule);\n    }\n}\n\n// Update molecules\nfunction updateMolecules() {\n    initMolecules();\n}\n\n// Animate bubble formation\nfunction animateBubbles() {\n    const container = document.getElementById('bubble-container');\n    container.innerHTML = '';\n    \n    // Create multiple bubbles\n    const numBubbles = 8;\n    for (let i = 0; i < numBubbles; i++) {\n        const bubble = document.createElement('div');\n        bubble.className = 'bubble';\n        \n        const size = 20 + Math.random() * 30;\n        bubble.style.width = size + 'px';\n        bubble.style.height = size + 'px';\n        bubble.style.left = Math.random() * 80 + 10 + '%';\n        bubble.style.animationDelay = (i * 0.3) + 's';\n        \n        bubble.classList.add('animating');\n        container.appendChild(bubble);\n    }\n    \n    // Clean up after animation\n    setTimeout(() => {\n        container.innerHTML = '';\n    }, 3000 + (numBubbles * 300));\n}\n\n// Initialize P-x-y chart\nfunction initPxyChart() {\n    const ctx = document.getElementById('pxyChart').getContext('2d');\n    const data = generatePxyData();\n    \n    pxyChart = new Chart(ctx, {\n        type: 'line',\n        data: {\n            labels: data.x1Data,\n            datasets: [\n                {\n                    label: 'Bubble Point (Liquid)',\n                    data: data.pBubble,\n                    borderColor: '#06b6d4',\n                    backgroundColor: 'rgba(6, 182, 212, 0.1)',\n                    borderWidth: 3,\n                    tension: 0.4,\n                    pointRadius: 0,\n                    fill: false\n                },\n                {\n                    label: 'Dew Point (Vapor)',\n                    data: data.pDew,\n                    borderColor: '#a855f7',\n                    backgroundColor: 'rgba(168, 85, 247, 0.1)',\n                    borderWidth: 3,\n                    tension: 0.4,\n                    pointRadius: 0,\n                    fill: false\n                }\n            ]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            interaction: {\n                mode: 'index',\n                intersect: false,\n            },\n            plugins: {\n                legend: {\n                    position: 'top',\n                },\n                tooltip: {\n                    callbacks: {\n                        label: function(context) {\n                            return context.dataset.label + ': ' + context.parsed.y.toFixed(2) + ' kPa';\n                        }\n                    }\n                }\n            },\n            scales: {\n                x: {\n                    display: true,\n                    title: {\n                        display: true,\n                        text: 'Mole Fraction of Component 1 (x₁, y₁)'\n                    },\n                    ticks: {\n                        maxTicksLimit: 11\n                    }\n                },\n                y: {\n                    display: true,\n                    title: {\n                        display: true,\n                        text: 'Pressure (kPa)'\n                    },\n                    beginAtZero: false\n                }\n            }\n        }\n    });\n    \n    addCurrentPointToPxyChart();\n}\n\n// Initialize y-x chart\nfunction initYxChart() {\n    const ctx = document.getElementById('yxChart').getContext('2d');\n    const data = generateYxData();\n    \n    yxChart = new Chart(ctx, {\n        type: 'line',\n        data: {\n            labels: data.xData,\n            datasets: [\n                {\n                    label: 'VLE Curve (y₁ vs x₁)',\n                    data: data.yData,\n                    borderColor: '#10b981',\n                    backgroundColor: 'rgba(16, 185, 129, 0.1)',\n                    borderWidth: 3,\n                    tension: 0.4,\n                    pointRadius: 0,\n                    fill: false\n                },\n                {\n                    label: 'y = x (45° line)',\n                    data: [0, 1],\n                    borderColor: '#9ca3af',\n                    borderWidth: 2,\n                    borderDash: [5, 5],\n                    pointRadius: 0,\n                    fill: false\n                }\n            ]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            interaction: {\n                mode: 'index',\n                intersect: false,\n            },\n            plugins: {\n                legend: {\n                    position: 'top',\n                },\n                tooltip: {\n                    callbacks: {\n                        label: function(context) {\n                            if (context.datasetIndex === 0) {\n                                return 'y₁ = ' + context.parsed.y.toFixed(3);\n                            }\n                            return context.dataset.label;\n                        }\n                    }\n                }\n            },\n            scales: {\n                x: {\n                    type: 'linear',\n                    min: 0,\n                    max: 1,\n                    display: true,\n                    title: {\n                        display: true,\n                        text: 'Liquid Mole Fraction (x₁)'\n                    },\n                    ticks: {\n                        stepSize: 0.1\n                    }\n                },\n                y: {\n                    type: 'linear',\n                    min: 0,\n                    max: 1,\n                    display: true,\n                    title: {\n                        display: true,\n                        text: 'Vapor Mole Fraction (y₁)'\n                    },\n                    ticks: {\n                        stepSize: 0.1\n                    }\n                }\n            }\n        }\n    });\n    \n    addCurrentPointToYxChart();\n}\n\n// Add current operating point to P-x-y chart\nfunction addCurrentPointToPxyChart() {\n    if (pxyChart) {\n        const result = calculate(x1, P1sat, P2sat);\n        \n        // Remove existing current point datasets if any\n        while (pxyChart.data.datasets.length > 2) {\n            pxyChart.data.datasets.pop();\n        }\n        \n        // Add current liquid point\n        pxyChart.data.datasets.push({\n            label: 'Current State',\n            data: [{ x: x1, y: result.P }],\n            borderColor: '#ef4444',\n            backgroundColor: '#ef4444',\n            pointRadius: 8,\n            pointHoverRadius: 10,\n            showLine: false,\n            type: 'scatter'\n        });\n        \n        // Add tie line\n        pxyChart.data.datasets.push({\n            label: 'Tie Line',\n            data: [{ x: x1, y: result.P }, { x: result.y1, y: result.P }],\n            borderColor: '#ef4444',\n            borderWidth: 2,\n            borderDash: [3, 3],\n            pointRadius: 4,\n            pointBackgroundColor: '#ef4444',\n            type: 'scatter',\n            showLine: true\n        });\n        \n        pxyChart.update('none');\n    }\n}\n\n// Add current operating point to y-x chart\nfunction addCurrentPointToYxChart() {\n    if (yxChart) {\n        const result = calculate(x1, P1sat, P2sat);\n        \n        // Remove existing current point dataset if any\n        if (yxChart.data.datasets.length > 2) {\n            yxChart.data.datasets.pop();\n        }\n        \n        // Add current point\n        yxChart.data.datasets.push({\n            label: 'Current Point',\n            data: [{ x: x1, y: result.y1 }],\n            borderColor: '#ef4444',\n            backgroundColor: '#ef4444',\n            pointRadius: 8,\n            pointHoverRadius: 10,\n            showLine: false,\n            type: 'scatter'\n        });\n        \n        yxChart.update('none');\n    }\n}\n\n// Update P-x-y chart\nfunction updatePxyChart() {\n    if (pxyChart) {\n        const data = generatePxyData();\n        pxyChart.data.labels = data.x1Data;\n        pxyChart.data.datasets[0].data = data.pBubble;\n        pxyChart.data.datasets[1].data = data.pDew;\n        addCurrentPointToPxyChart();\n    }\n}\n\n// Update y-x chart\nfunction updateYxChart() {\n    if (yxChart) {\n        const data = generateYxData();\n        yxChart.data.labels = data.xData;\n        yxChart.data.datasets[0].data = data.yData;\n        addCurrentPointToYxChart();\n    }\n}\n\n// Event listeners\ndocument.addEventListener('DOMContentLoaded', function() {\n    // x1 slider\n    const x1Slider = document.getElementById('x1-slider');\n    const x1Value = document.getElementById('x1-value');\n    \n    x1Slider.addEventListener('input', function() {\n        x1 = parseFloat(this.value);\n        x1Value.textContent = x1.toFixed(3);\n        updateDisplay();\n    });\n    \n    // P1sat slider\n    const p1satSlider = document.getElementById('p1sat-slider');\n    const p1satValue = document.getElementById('p1sat-value');\n    \n    p1satSlider.addEventListener('input', function() {\n        P1sat = parseFloat(this.value);\n        p1satValue.textContent = P1sat.toFixed(0);\n        updateDisplay();\n    });\n    \n    // P2sat slider\n    const p2satSlider = document.getElementById('p2sat-slider');\n    const p2satValue = document.getElementById('p2sat-value');\n    \n    p2satSlider.addEventListener('input', function() {\n        P2sat = parseFloat(this.value);\n        p2satValue.textContent = P2sat.toFixed(0);\n        updateDisplay();\n    });\n    \n    // Animate button\n    document.getElementById('animate-btn').addEventListener('click', animateBubbles);\n    \n    // Initialize\n    initMolecules();\n    initPxyChart();\n    initYxChart();\n    updateDisplay();\n});"}}
{"input": {"input_text": "Linearized double pendulum small angles with lengths L1,L2 and masses m1,m2. Provide natural frequencies.", "simulation_name": " Double Pendulum Linear", "domain": "Physics", "description": "Small-angle coupled pendulums", "assumptions": ["Small angles", "No damping"], "entities": [], "constants": [{"name": "gravity", "symbol": "g", "value": 9.81, "unit": "m/s^2"}], "parameters": [{"name": "length1", "symbol": "L1", "unit": "m", "range": [0.1, 3]}, {"name": "length2", "symbol": "L2", "unit": "m", "range": [0.1, 3]}, {"name": "mass1", "symbol": "m1", "unit": "kg", "range": [0.1, 5]}, {"name": "mass2", "symbol": "m2", "unit": "kg", "range": [0.1, 5]}], "equations": [{"description": "Approx modes", "expression": "omega1, omega2 from linearized 2x2 eigenvalues"}], "initial_conditions": {}, "outputs": ["omega1", "omega2"], "simulation_controls": ["L1", "L2", "m1", "m2"], "constraints": ["L1>0", "L2>0", "m1>0", "m2>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Double Pendulum - Linearized Analysis</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js\"></script>\n</head>\n<body>\n    <div class=\"container\">\n        <!-- Header -->\n        <div class=\"header\">\n            <h1>Linearized Double Pendulum - Natural Frequencies</h1>\n            <p class=\"subtitle\">Small-angle oscillations with coupled masses</p>\n            <div class=\"tags\">\n                <span class=\"tag tag-blue\">Small Angles</span>\n                <span class=\"tag tag-green\">No Damping</span>\n                <span class=\"tag tag-purple\">Normal Modes</span>\n            </div>\n        </div>\n\n        <div class=\"main-grid\">\n            <!-- Controls Panel -->\n            <div class=\"controls-panel\">\n                <div class=\"card\">\n                    <h2>System Parameters</h2>\n                    \n                    <!-- Length 1 -->\n                    <div class=\"control-group\">\n                        <label>\n                            Length 1 (L<sub>1</sub>): <span id=\"l1-value\">1.00</span> m\n                        </label>\n                        <input type=\"range\" id=\"l1-slider\" min=\"0.1\" max=\"3\" step=\"0.01\" value=\"1.0\" class=\"slider slider-blue\">\n                    </div>\n\n                    <!-- Length 2 -->\n                    <div class=\"control-group\">\n                        <label>\n                            Length 2 (L<sub>2</sub>): <span id=\"l2-value\">1.00</span> m\n                        </label>\n                        <input type=\"range\" id=\"l2-slider\" min=\"0.1\" max=\"3\" step=\"0.01\" value=\"1.0\" class=\"slider slider-green\">\n                    </div>\n\n                    <!-- Mass 1 -->\n                    <div class=\"control-group\">\n                        <label>\n                            Mass 1 (m<sub>1</sub>): <span id=\"m1-value\">1.00</span> kg\n                        </label>\n                        <input type=\"range\" id=\"m1-slider\" min=\"0.1\" max=\"5\" step=\"0.01\" value=\"1.0\" class=\"slider slider-purple\">\n                    </div>\n\n                    <!-- Mass 2 -->\n                    <div class=\"control-group\">\n                        <label>\n                            Mass 2 (m<sub>2</sub>): <span id=\"m2-value\">1.00</span> kg\n                        </label>\n                        <input type=\"range\" id=\"m2-slider\" min=\"0.1\" max=\"5\" step=\"0.01\" value=\"1.0\" class=\"slider slider-orange\">\n                    </div>\n\n                    <button id=\"animate-btn\" class=\"animate-btn\">Animate Modes</button>\n                </div>\n\n                <!-- Results -->\n                <div class=\"card results-card\">\n                    <h2>Natural Frequencies</h2>\n                    <div class=\"result-item result-blue\">\n                        <p class=\"result-label\">Mode 1 (Lower Frequency)</p>\n                        <p class=\"result-value\" id=\"omega1\">0.00 rad/s</p>\n                        <p class=\"result-subtext\">f<sub>1</sub> = <span id=\"freq1\">0.00</span> Hz</p>\n                    </div>\n                    <div class=\"result-item result-green\">\n                        <p class=\"result-label\">Mode 2 (Higher Frequency)</p>\n                        <p class=\"result-value\" id=\"omega2\">0.00 rad/s</p>\n                        <p class=\"result-subtext\">f<sub>2</sub> = <span id=\"freq2\">0.00</span> Hz</p>\n                    </div>\n                    <div class=\"result-item result-purple\">\n                        <p class=\"result-label\">Frequency Ratio</p>\n                        <p class=\"result-value\" id=\"ratio\">0.00</p>\n                    </div>\n                </div>\n\n                <!-- Info Card -->\n                <div class=\"card info-card\">\n                    <h3>Normal Modes</h3>\n                    <p>A double pendulum has two natural frequencies (eigenfrequencies) where the system oscillates in pure normal modes.</p>\n                    <ul>\n                        <li><strong>Mode 1:</strong> Both pendulums swing together (in-phase)</li>\n                        <li><strong>Mode 2:</strong> Pendulums swing oppositely (out-of-phase)</li>\n                        <li><strong>ω:</strong> Angular frequency (rad/s)</li>\n                        <li><strong>f:</strong> Frequency (Hz) = ω/(2π)</li>\n                    </ul>\n                </div>\n            </div>\n\n            <!-- Visualization Panel -->\n            <div class=\"visualization-panel\">\n                <!-- Pendulum Animation -->\n                <div class=\"card\">\n                    <h2>Double Pendulum Visualization</h2>\n                    <div class=\"mode-selector\">\n                        <button class=\"mode-btn active\" data-mode=\"mode1\">Mode 1</button>\n                        <button class=\"mode-btn\" data-mode=\"mode2\">Mode 2</button>\n                        <button class=\"mode-btn\" data-mode=\"mixed\">Mixed</button>\n                    </div>\n                    <div class=\"pendulum-container\">\n                        <canvas id=\"pendulumCanvas\" width=\"600\" height=\"500\"></canvas>\n                    </div>\n                </div>\n\n                <!-- Frequency Response -->\n                <div class=\"card\">\n                    <h2>Modal Frequencies vs System Parameters</h2>\n                    <div class=\"chart-container\">\n                        <canvas id=\"frequencyChart\"></canvas>\n                    </div>\n                </div>\n\n                <!-- Time Response -->\n                <div class=\"card\">\n                    <h2>Angular Displacement vs Time</h2>\n                    <div class=\"chart-container\">\n                        <canvas id=\"timeChart\"></canvas>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, #fef3c7 0%, #fce7f3 100%);\n    min-height: 100vh;\n    padding: 2rem;\n}\n\n.container {\n    max-width: 1400px;\n    margin: 0 auto;\n}\n\n/* Header */\n.header {\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    padding: 2rem;\n    margin-bottom: 2rem;\n}\n\n.header h1 {\n    color: #92400e;\n    font-size: 2rem;\n    margin-bottom: 0.5rem;\n}\n\n.subtitle {\n    color: #6b7280;\n    font-size: 1rem;\n    margin-bottom: 1rem;\n}\n\n.tags {\n    display: flex;\n    gap: 1rem;\n    flex-wrap: wrap;\n}\n\n.tag {\n    padding: 0.5rem 1rem;\n    border-radius: 20px;\n    font-size: 0.875rem;\n    font-weight: 500;\n}\n\n.tag-blue {\n    background: #dbeafe;\n    color: #1e40af;\n}\n\n.tag-green {\n    background: #d1fae5;\n    color: #065f46;\n}\n\n.tag-purple {\n    background: #e9d5ff;\n    color: #6b21a8;\n}\n\n/* Main Grid */\n.main-grid {\n    display: grid;\n    grid-template-columns: 1fr 2fr;\n    gap: 1.5rem;\n}\n\n@media (max-width: 1024px) {\n    .main-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n/* Card */\n.card {\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    padding: 1.5rem;\n    margin-bottom: 1.5rem;\n}\n\n.card h2 {\n    color: #1f2937;\n    font-size: 1.25rem;\n    margin-bottom: 1.5rem;\n}\n\n.card h3 {\n    color: #374151;\n    font-size: 1rem;\n    margin-bottom: 1rem;\n}\n\n/* Control Groups */\n.control-group {\n    margin-bottom: 2rem;\n}\n\n.control-group label {\n    display: block;\n    color: #374151;\n    font-weight: 600;\n    font-size: 0.875rem;\n    margin-bottom: 0.5rem;\n}\n\n.control-group label span {\n    font-weight: 700;\n    color: #111827;\n}\n\n/* Sliders */\n.slider {\n    width: 100%;\n    height: 8px;\n    border-radius: 5px;\n    outline: none;\n    -webkit-appearance: none;\n    cursor: pointer;\n}\n\n.slider-blue {\n    background: #bfdbfe;\n}\n\n.slider-green {\n    background: #bbf7d0;\n}\n\n.slider-purple {\n    background: #e9d5ff;\n}\n\n.slider-orange {\n    background: #fed7aa;\n}\n\n.slider::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #d97706;\n    cursor: pointer;\n}\n\n.slider::-moz-range-thumb {\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #d97706;\n    cursor: pointer;\n    border: none;\n}\n\n/* Animate Button */\n.animate-btn {\n    width: 100%;\n    background: #d97706;\n    color: white;\n    padding: 1rem;\n    border: none;\n    border-radius: 8px;\n    font-size: 1rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: background 0.3s;\n}\n\n.animate-btn:hover {\n    background: #b45309;\n}\n\n/* Results */\n.results-card {\n    margin-bottom: 1.5rem;\n}\n\n.result-item {\n    padding: 1rem;\n    border-radius: 8px;\n    margin-bottom: 1rem;\n}\n\n.result-item:last-child {\n    margin-bottom: 0;\n}\n\n.result-blue {\n    background: #eff6ff;\n}\n\n.result-green {\n    background: #f0fdf4;\n}\n\n.result-purple {\n    background: #faf5ff;\n}\n\n.result-label {\n    color: #6b7280;\n    font-size: 0.875rem;\n    margin-bottom: 0.25rem;\n}\n\n.result-value {\n    font-size: 1.5rem;\n    font-weight: 700;\n}\n\n.result-subtext {\n    font-size: 0.875rem;\n    color: #6b7280;\n    margin-top: 0.25rem;\n}\n\n.result-blue .result-value {\n    color: #1d4ed8;\n}\n\n.result-green .result-value {\n    color: #15803d;\n}\n\n.result-purple .result-value {\n    color: #7c3aed;\n}\n\n/* Info Card */\n.info-card {\n    background: linear-gradient(135deg, #fef3c7 0%, #fee2e2 100%);\n    border: 2px solid #f59e0b;\n}\n\n.info-card p {\n    color: #374151;\n    font-size: 0.875rem;\n    line-height: 1.6;\n    margin-bottom: 1rem;\n}\n\n.info-card ul {\n    list-style: none;\n    padding: 0;\n}\n\n.info-card ul li {\n    color: #374151;\n    font-size: 0.875rem;\n    padding: 0.5rem 0;\n    border-bottom: 1px solid rgba(245, 158, 11, 0.3);\n}\n\n.info-card ul li:last-child {\n    border-bottom: none;\n}\n\n/* Mode Selector */\n.mode-selector {\n    display: flex;\n    gap: 0.5rem;\n    margin-bottom: 1rem;\n    justify-content: center;\n}\n\n.mode-btn {\n    padding: 0.5rem 1rem;\n    background: #f3f4f6;\n    border: 2px solid #d1d5db;\n    border-radius: 8px;\n    font-size: 0.875rem;\n    font-weight: 600;\n    color: #6b7280;\n    cursor: pointer;\n    transition: all 0.3s;\n}\n\n.mode-btn:hover {\n    background: #e5e7eb;\n}\n\n.mode-btn.active {\n    background: #d97706;\n    color: white;\n    border-color: #d97706;\n}\n\n/* Pendulum Container */\n.pendulum-container {\n    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\n    border-radius: 8px;\n    padding: 1rem;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n\n#pendulumCanvas {\n    max-width: 100%;\n    height: auto;\n    border-radius: 8px;\n}\n\n/* Chart */\n.chart-container {\n    position: relative;\n    height: 300px;\n    width: 100%;\n}\n\n@media (max-width: 768px) {\n    body {\n        padding: 1rem;\n    }\n\n    .header h1 {\n        font-size: 1.5rem;\n    }\n\n    #pendulumCanvas {\n        width: 100%;\n        height: auto;\n    }\n\n    .mode-selector {\n        flex-direction: column;\n    }\n}", "js": "// Global variables\nlet L1 = 1.0;\nlet L2 = 1.0;\nlet m1 = 1.0;\nlet m2 = 1.0;\nconst g = 9.81;\n\nlet frequencyChart = null;\nlet timeChart = null;\nlet animationId = null;\nlet currentMode = 'mode1';\nlet time = 0;\n\n// Calculate natural frequencies using linearized equations\nfunction calculateFrequencies(l1, l2, m1Val, m2Val) {\n    // For small angles, the equations of motion become linear\n    // The characteristic equation gives two natural frequencies\n    \n    // Matrix coefficients for linearized system\n    const M = m1Val + m2Val;\n    const mu = m2Val / M;\n    \n    // Simplified calculation for natural frequencies\n    const omega1_sq = (g / l1) * (1 - mu / 2);\n    const omega2_sq = (g / l1) * (1 + mu * (1 + l1 / l2));\n    \n    // More accurate eigenvalue calculation\n    const A = g * (M / m1Val) / l1;\n    const B = g / l2;\n    const C = g * m2Val / (m1Val * l1);\n    \n    const sum = A + B;\n    const prod = A * B - C * (g / l2);\n    const discriminant = sum * sum - 4 * prod;\n    \n    let omega1, omega2;\n    if (discriminant >= 0) {\n        omega1 = Math.sqrt((sum - Math.sqrt(discriminant)) / 2);\n        omega2 = Math.sqrt((sum + Math.sqrt(discriminant)) / 2);\n    } else {\n        omega1 = Math.sqrt(omega1_sq);\n        omega2 = Math.sqrt(omega2_sq);\n    }\n    \n    const freq1 = omega1 / (2 * Math.PI);\n    const freq2 = omega2 / (2 * Math.PI);\n    const ratio = omega2 / omega1;\n    \n    return { omega1, omega2, freq1, freq2, ratio };\n}\n\n// Update all displays\nfunction updateDisplay() {\n    const result = calculateFrequencies(L1, L2, m1, m2);\n    \n    // Update result displays\n    document.getElementById('omega1').textContent = result.omega1.toFixed(3) + ' rad/s';\n    document.getElementById('omega2').textContent = result.omega2.toFixed(3) + ' rad/s';\n    document.getElementById('freq1').textContent = result.freq1.toFixed(3);\n    document.getElementById('freq2').textContent = result.freq2.toFixed(3);\n    document.getElementById('ratio').textContent = result.ratio.toFixed(3);\n    \n    // Update charts\n    updateFrequencyChart();\n    updateTimeChart();\n}\n\n// Generate frequency vs parameter data\nfunction generateFrequencyData() {\n    const points = 50;\n    const ratios = [];\n    const omega1Data = [];\n    const omega2Data = [];\n    \n    // Vary mass ratio while keeping other parameters constant\n    for (let i = 0; i <= points; i++) {\n        const m2Var = 0.1 + (4.9 * i) / points;\n        const result = calculateFrequencies(L1, L2, m1, m2Var);\n        ratios.push((m2Var / m1).toFixed(2));\n        omega1Data.push(result.omega1);\n        omega2Data.push(result.omega2);\n    }\n    \n    return { ratios, omega1Data, omega2Data };\n}\n\n// Generate time response data\nfunction generateTimeData() {\n    const result = calculateFrequencies(L1, L2, m1, m2);\n    const duration = 10; // seconds\n    const points = 200;\n    const dt = duration / points;\n    \n    const times = [];\n    const theta1Data = [];\n    const theta2Data = [];\n    \n    // Initial conditions (small angles in radians)\n    const theta1_0 = 0.2; // 0.2 radians ≈ 11.5 degrees\n    const theta2_0 = 0.1;\n    \n    for (let i = 0; i <= points; i++) {\n        const t = i * dt;\n        times.push(t.toFixed(2));\n        \n        let theta1, theta2;\n        \n        if (currentMode === 'mode1') {\n            // Mode 1: in-phase oscillation\n            theta1 = theta1_0 * Math.cos(result.omega1 * t);\n            theta2 = theta1_0 * Math.cos(result.omega1 * t);\n        } else if (currentMode === 'mode2') {\n            // Mode 2: out-of-phase oscillation\n            theta1 = theta1_0 * Math.cos(result.omega2 * t);\n            theta2 = -theta1_0 * Math.cos(result.omega2 * t);\n        } else {\n            // Mixed mode\n            theta1 = theta1_0 * Math.cos(result.omega1 * t) + 0.1 * Math.cos(result.omega2 * t);\n            theta2 = theta2_0 * Math.cos(result.omega1 * t) - 0.1 * Math.cos(result.omega2 * t);\n        }\n        \n        theta1Data.push(theta1);\n        theta2Data.push(theta2);\n    }\n    \n    return { times, theta1Data, theta2Data };\n}\n\n// Initialize frequency chart\nfunction initFrequencyChart() {\n    const ctx = document.getElementById('frequencyChart').getContext('2d');\n    const data = generateFrequencyData();\n    \n    frequencyChart = new Chart(ctx, {\n        type: 'line',\n        data: {\n            labels: data.ratios,\n            datasets: [\n                {\n                    label: 'ω₁ (Mode 1)',\n                    data: data.omega1Data,\n                    borderColor: '#3b82f6',\n                    backgroundColor: 'rgba(59, 130, 246, 0.1)',\n                    borderWidth: 3,\n                    tension: 0.4,\n                    pointRadius: 0\n                },\n                {\n                    label: 'ω₂ (Mode 2)',\n                    data: data.omega2Data,\n                    borderColor: '#10b981',\n                    backgroundColor: 'rgba(16, 185, 129, 0.1)',\n                    borderWidth: 3,\n                    tension: 0.4,\n                    pointRadius: 0\n                }\n            ]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            interaction: {\n                mode: 'index',\n                intersect: false,\n            },\n            plugins: {\n                legend: {\n                    position: 'top',\n                },\n                tooltip: {\n                    callbacks: {\n                        label: function(context) {\n                            return context.dataset.label + ': ' + context.parsed.y.toFixed(3) + ' rad/s';\n                        }\n                    }\n                }\n            },\n            scales: {\n                x: {\n                    display: true,\n                    title: {\n                        display: true,\n                        text: 'Mass Ratio (m₂/m₁)'\n                    },\n                    ticks: {\n                        maxTicksLimit: 10\n                    }\n                },\n                y: {\n                    display: true,\n                    title: {\n                        display: true,\n                        text: 'Angular Frequency (rad/s)'\n                    },\n                    beginAtZero: false\n                }\n            }\n        }\n    });\n}\n\n// Initialize time chart\nfunction initTimeChart() {\n    const ctx = document.getElementById('timeChart').getContext('2d');\n    const data = generateTimeData();\n    \n    timeChart = new Chart(ctx, {\n        type: 'line',\n        data: {\n            labels: data.times,\n            datasets: [\n                {\n                    label: 'θ₁ (Upper Pendulum)',\n                    data: data.theta1Data,\n                    borderColor: '#d97706',\n                    backgroundColor: 'rgba(217, 119, 6, 0.1)',\n                    borderWidth: 2,\n                    tension: 0.4,\n                    pointRadius: 0\n                },\n                {\n                    label: 'θ₂ (Lower Pendulum)',\n                    data: data.theta2Data,\n                    borderColor: '#7c3aed',\n                    backgroundColor: 'rgba(124, 58, 237, 0.1)',\n                    borderWidth: 2,\n                    tension: 0.4,\n                    pointRadius: 0\n                }\n            ]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            interaction: {\n                mode: 'index',\n                intersect: false,\n            },\n            plugins: {\n                legend: {\n                    position: 'top',\n                },\n                tooltip: {\n                    callbacks: {\n                        label: function(context) {\n                            return context.dataset.label + ': ' + context.parsed.y.toFixed(3) + ' rad';\n                        }\n                    }\n                }\n            },\n            scales: {\n                x: {\n                    display: true,\n                    title: {\n                        display: true,\n                        text: 'Time (s)'\n                    },\n                    ticks: {\n                        maxTicksLimit: 10\n                    }\n                },\n                y: {\n                    display: true,\n                    title: {\n                        display: true,\n                        text: 'Angular Displacement (rad)'\n                    }\n                }\n            }\n        }\n    });\n}\n\n// Update charts\nfunction updateFrequencyChart() {\n    if (frequencyChart) {\n        const data = generateFrequencyData();\n        frequencyChart.data.labels = data.ratios;\n        frequencyChart.data.datasets[0].data = data.omega1Data;\n        frequencyChart.data.datasets[1].data = data.omega2Data;\n        frequencyChart.update('none');\n    }\n}\n\nfunction updateTimeChart() {\n    if (timeChart) {\n        const data = generateTimeData();\n        timeChart.data.labels = data.times;\n        timeChart.data.datasets[0].data = data.theta1Data;\n        timeChart.data.datasets[1].data = data.theta2Data;\n        timeChart.update('none');\n    }\n}\n\n// Pendulum animation\nfunction drawPendulum() {\n    const canvas = document.getElementById('pendulumCanvas');\n    const ctx = canvas.getContext('2d');\n    const width = canvas.width;\n    const height = canvas.height;\n    \n    // Clear canvas\n    ctx.clearRect(0, 0, width, height);\n    \n    // Origin point\n    const originX = width / 2;\n    const originY = 100;\n    \n    // Scale for visualization\n    const scale = 80;\n    \n    // Calculate angles based on current mode and time\n    const result = calculateFrequencies(L1, L2, m1, m2);\n    let theta1, theta2;\n    \n    const amplitude = 0.3; // radians\n    \n    if (currentMode === 'mode1') {\n        theta1 = amplitude * Math.cos(result.omega1 * time);\n        theta2 = amplitude * Math.cos(result.omega1 * time);\n    } else if (currentMode === 'mode2') {\n        theta1 = amplitude * Math.cos(result.omega2 * time);\n        theta2 = -amplitude * Math.cos(result.omega2 * time);\n    } else {\n        theta1 = amplitude * Math.cos(result.omega1 * time) + 0.15 * Math.cos(result.omega2 * time);\n        theta2 = 0.2 * Math.cos(result.omega1 * time) - 0.15 * Math.cos(result.omega2 * time);\n    }\n    \n    // Position of mass 1\n    const x1 = originX + L1 * scale * Math.sin(theta1);\n    const y1 = originY + L1 * scale * Math.cos(theta1);\n    \n    // Position of mass 2\n    const x2 = x1 + L2 * scale * Math.sin(theta2);\n    const y2 = y1 + L2 * scale * Math.cos(theta2);\n    \n    // Draw ceiling\n    ctx.strokeStyle = '#475569';\n    ctx.lineWidth = 4;\n    ctx.beginPath();\n    ctx.moveTo(originX - 30, originY);\n    ctx.lineTo(originX + 30, originY);\n    ctx.stroke();\n    \n    // Draw pivot point\n    ctx.fillStyle = '#1f2937';\n    ctx.beginPath();\n    ctx.arc(originX, originY, 6, 0, 2 * Math.PI);\n    ctx.fill();\n    \n    // Draw rod 1\n    ctx.strokeStyle = '#d97706';\n    ctx.lineWidth = 3;\n    ctx.beginPath();\n    ctx.moveTo(originX, originY);\n    ctx.lineTo(x1, y1);\n    ctx.stroke();\n    \n    // Draw mass 1\n    const radius1 = 10 + m1 * 5;\n    ctx.fillStyle = '#f59e0b';\n    ctx.beginPath();\n    ctx.arc(x1, y1, radius1, 0, 2 * Math.PI);\n    ctx.fill();\n    ctx.strokeStyle = '#d97706';\n    ctx.lineWidth = 2;\n    ctx.stroke();\n    \n    // Draw rod 2\n    ctx.strokeStyle = '#7c3aed';\n    ctx.lineWidth = 3;\n    ctx.beginPath();\n    ctx.moveTo(x1, y1);\n    ctx.lineTo(x2, y2);\n    ctx.stroke();\n    \n    // Draw mass 2\n    const radius2 = 10 + m2 * 5;\n    ctx.fillStyle = '#a855f7';\n    ctx.beginPath();\n    ctx.arc(x2, y2, radius2, 0, 2 * Math.PI);\n    ctx.fill();\n    ctx.strokeStyle = '#7c3aed';\n    ctx.lineWidth = 2;\n    ctx.stroke();\n    \n    // Draw trail\n    ctx.strokeStyle = 'rgba(168, 85, 247, 0.3)';\n    ctx.lineWidth = 1;\n    ctx.beginPath();\n    for (let i = 0; i < 50; i++) {\n        const t = time - i * 0.05;\n        let th1, th2;\n        \n        if (currentMode === 'mode1') {\n            th1 = amplitude * Math.cos(result.omega1 * t);\n            th2 = amplitude * Math.cos(result.omega1 * t);\n        } else if (currentMode === 'mode2') {\n            th1 = amplitude * Math.cos(result.omega2 * t);\n            th2 = -amplitude * Math.cos(result.omega2 * t);\n        } else {\n            th1 = amplitude * Math.cos(result.omega1 * t) + 0.15 * Math.cos(result.omega2 * t);\n            th2 = 0.2 * Math.cos(result.omega1 * t) - 0.15 * Math.cos(result.omega2 * t);\n        }\n        \n        const tx1 = originX + L1 * scale * Math.sin(th1);\n        const ty1 = originY + L1 * scale * Math.cos(th1);\n        const tx2 = tx1 + L2 * scale * Math.sin(th2);\n        const ty2 = ty1 + L2 * scale * Math.cos(th2);\n        \n        if (i === 0) {\n            ctx.moveTo(tx2, ty2);\n        } else {\n            ctx.lineTo(tx2, ty2);\n        }\n    }\n    ctx.stroke();\n}\n\n// Animation loop\nfunction animate() {\n    drawPendulum();\n    time += 0.03;\n    animationId = requestAnimationFrame(animate);\n}\n\n// Start animation\nfunction startAnimation() {\n    if (animationId) {\n        cancelAnimationFrame(animationId);\n    }\n    time = 0;\n    animate();\n}\n\n// Event listeners\ndocument.addEventListener('DOMContentLoaded', function() {\n    // L1 slider\n    const l1Slider = document.getElementById('l1-slider');\n    const l1Value = document.getElementById('l1-value');\n    \n    l1Slider.addEventListener('input', function() {\n        L1 = parseFloat(this.value);\n        l1Value.textContent = L1.toFixed(2);\n        updateDisplay();\n    });\n    \n    // L2 slider\n    const l2Slider = document.getElementById('l2-slider');\n    const l2Value = document.getElementById('l2-value');\n    \n    l2Slider.addEventListener('input', function() {\n        L2 = parseFloat(this.value);\n        l2Value.textContent = L2.toFixed(2);\n        updateDisplay();\n    });\n    \n    // m1 slider\n    const m1Slider = document.getElementById('m1-slider');\n    const m1Value = document.getElementById('m1-value');\n    \n    m1Slider.addEventListener('input', function() {\n        m1 = parseFloat(this.value);\n        m1Value.textContent = m1.toFixed(2);\n        updateDisplay();\n    });\n    \n    // m2 slider\n    const m2Slider = document.getElementById('m2-slider');\n    const m2Value = document.getElementById('m2-value');\n    \n    m2Slider.addEventListener('input', function() {\n        m2 = parseFloat(this.value);\n        m2Value.textContent = m2.toFixed(2);\n        updateDisplay();\n    });\n    \n    // Mode buttons\n    const modeBtns = document.querySelectorAll('.mode-btn');\n    modeBtns.forEach(btn => {\n        btn.addEventListener('click', function() {\n            modeBtns.forEach(b => b.classList.remove('active'));\n            this.classList.add('active');\n            currentMode = this.dataset.mode;\n            time = 0;\n            updateTimeChart();\n        });\n    });\n    \n    // Animate button\n    document.getElementById('animate-btn').addEventListener('click', startAnimation);\n    \n    // Initialize\n    initFrequencyChart();\n    initTimeChart();\n    updateDisplay();\n    startAnimation();\n});"}}
{"input": {"input_text": "Rigid body free rotation symmetric top: omega precesses with rate tau/(I*omega). Provide precession rate given torque tau.", "simulation_name": " Gyro Precession", "domain": "Physics", "description": "Gyroscope torque-induced precession", "assumptions": ["Symmetric top", "Small nutation"], "entities": [], "constants": [], "parameters": [{"name": "torque", "symbol": "tau", "unit": "N*m", "range": [-50, 50]}, {"name": "spin_rate", "symbol": "omega", "unit": "rad/s", "range": [1, 500]}, {"name": "moment_of_inertia", "symbol": "I", "unit": "kg*m^2", "range": [0.001, 10]}], "equations": [{"description": "Precession", "expression": "Omega_p = tau/(I*omega)"}], "initial_conditions": {}, "outputs": ["Omega_p"], "simulation_controls": ["tau", "omega", "I"], "constraints": ["I>0", "omega!=0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S37 Gyro Precession Simulator</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"main-card\">\n            <!-- Header -->\n            <div class=\"header\">\n                <h1>S37 Gyro Precession</h1>\n                <p class=\"subtitle\">Gyroscope Torque-Induced Precession Simulator</p>\n                <p class=\"formula\">Ωₚ = τ/(I·ω)</p>\n            </div>\n\n            <div class=\"content-grid\">\n                <!-- Visualization -->\n                <div class=\"visualization-section\">\n                    <h2>Gyroscope Visualization</h2>\n                    <svg id=\"gyroCanvas\" width=\"400\" height=\"400\">\n                        <!-- Background circle -->\n                        <circle id=\"bgCircle\" cx=\"200\" cy=\"200\" r=\"150\" fill=\"none\" stroke=\"#e5e7eb\" stroke-width=\"2\" stroke-dasharray=\"5,5\" />\n                        \n                        <!-- Center pivot -->\n                        <circle cx=\"200\" cy=\"200\" r=\"8\" fill=\"#374151\" />\n                        \n                        <!-- Support arm -->\n                        <line id=\"supportArm\" x1=\"200\" y1=\"200\" x2=\"320\" y2=\"200\" stroke=\"#6366f1\" stroke-width=\"4\" />\n                        \n                        <!-- Gyroscope group -->\n                        <g id=\"gyroGroup\" transform=\"translate(320, 200)\">\n                            <!-- Disc -->\n                            <ellipse id=\"gyroDisc\" cx=\"0\" cy=\"0\" rx=\"30\" ry=\"15\" fill=\"#3b82f6\" opacity=\"0.7\" />\n                            \n                            <!-- Spin axis -->\n                            <line id=\"spinAxis\" x1=\"-35\" y1=\"0\" x2=\"35\" y2=\"0\" stroke=\"#1e40af\" stroke-width=\"3\" />\n                            \n                            <!-- Rotation indicator -->\n                            <circle id=\"rotIndicator\" cx=\"25\" cy=\"0\" r=\"4\" fill=\"#ef4444\" />\n                        </g>\n                        \n                        <!-- Torque arrow -->\n                        <defs>\n                            <marker id=\"arrowhead\" markerWidth=\"10\" markerHeight=\"10\" refX=\"9\" refY=\"3\" orient=\"auto\">\n                                <polygon points=\"0 0, 10 3, 0 6\" fill=\"#ef4444\" />\n                            </marker>\n                            <marker id=\"precession-arrow\" markerWidth=\"8\" markerHeight=\"8\" refX=\"7\" refY=\"3\" orient=\"auto\">\n                                <polygon points=\"0 0, 8 3, 0 6\" fill=\"#10b981\" />\n                            </marker>\n                        </defs>\n                        \n                        <g id=\"torqueArrow\" style=\"display: none;\">\n                            <line id=\"torqueLine\" x1=\"320\" y1=\"160\" x2=\"320\" y2=\"130\" stroke=\"#ef4444\" stroke-width=\"3\" marker-end=\"url(#arrowhead)\" />\n                            <text id=\"torqueLabel\" x=\"330\" y=\"145\" fill=\"#ef4444\" font-size=\"14\" font-weight=\"bold\">τ</text>\n                        </g>\n                        \n                        <!-- Precession direction arrow -->\n                        <path id=\"precessionPath\" d=\"\" fill=\"none\" stroke=\"#10b981\" stroke-width=\"2\" marker-end=\"url(#precession-arrow)\" style=\"display: none;\" />\n                        \n                        <!-- Result label -->\n                        <text id=\"resultLabel\" x=\"200\" y=\"380\" fill=\"#6b7280\" font-size=\"12\" text-anchor=\"middle\">\n                            Ωₚ = 0.000 rad/s\n                        </text>\n                    </svg>\n                    \n                    <!-- Legend -->\n                    <div class=\"legend\">\n                        <div class=\"legend-item\">\n                            <div class=\"legend-color\" style=\"background: #3b82f6;\"></div>\n                            <span>Gyroscope</span>\n                        </div>\n                        <div class=\"legend-item\">\n                            <div class=\"legend-color\" style=\"background: #ef4444;\"></div>\n                            <span>Torque (τ)</span>\n                        </div>\n                        <div class=\"legend-item\">\n                            <div class=\"legend-color\" style=\"background: #6366f1;\"></div>\n                            <span>Support Arm</span>\n                        </div>\n                        <div class=\"legend-item\">\n                            <div class=\"legend-color\" style=\"background: #10b981;\"></div>\n                            <span>Precession (Ωₚ)</span>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Controls -->\n                <div class=\"controls-section\">\n                    <h2>Simulation Controls</h2>\n                    \n                    <!-- Torque -->\n                    <div class=\"control-group\">\n                        <label>Torque (τ): <span id=\"torqueValue\">10.00</span> N·m</label>\n                        <input type=\"range\" id=\"torqueSlider\" min=\"-50\" max=\"50\" step=\"0.5\" value=\"10\">\n                        <div class=\"slider-labels\">\n                            <span>-50</span>\n                            <span>0</span>\n                            <span>50</span>\n                        </div>\n                    </div>\n\n                    <!-- Spin Rate -->\n                    <div class=\"control-group\">\n                        <label>Spin Rate (ω): <span id=\"spinRateValue\">100.00</span> rad/s</label>\n                        <input type=\"range\" id=\"spinRateSlider\" min=\"1\" max=\"500\" step=\"1\" value=\"100\">\n                        <div class=\"slider-labels\">\n                            <span>1</span>\n                            <span>250</span>\n                            <span>500</span>\n                        </div>\n                    </div>\n\n                    <!-- Moment of Inertia -->\n                    <div class=\"control-group\">\n                        <label>Moment of Inertia (I): <span id=\"inertiaValue\">1.000</span> kg·m²</label>\n                        <input type=\"range\" id=\"inertiaSlider\" min=\"0.001\" max=\"10\" step=\"0.01\" value=\"1\">\n                        <div class=\"slider-labels\">\n                            <span>0.001</span>\n                            <span>5</span>\n                            <span>10</span>\n                        </div>\n                    </div>\n\n                    <!-- Results -->\n                    <div class=\"results-box\">\n                        <h3>Results</h3>\n                        <div class=\"result-item\">\n                            <span>Precession Rate (Ωₚ):</span>\n                            <span id=\"precessionResult\" class=\"result-value\">0.1000 rad/s</span>\n                        </div>\n                        <div class=\"result-item\">\n                            <span>Direction:</span>\n                            <span id=\"directionResult\">Counter-clockwise</span>\n                        </div>\n                    </div>\n\n                    <!-- Animation Controls -->\n                    <div class=\"button-group\">\n                        <button id=\"playPauseBtn\" class=\"btn btn-primary\">Pause</button>\n                        <button id=\"resetBtn\" class=\"btn btn-secondary\">Reset</button>\n                    </div>\n\n                    <!-- Info -->\n                    <div class=\"info-box\">\n                        <h4>About Gyroscope Precession</h4>\n                        <p>When torque is applied perpendicular to a spinning gyroscope's axis, \n                        the gyroscope precesses around the vertical axis. The precession rate \n                        is inversely proportional to both the spin rate and moment of inertia.</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Physics Information -->\n        <div class=\"physics-info\">\n            <h3>Physics Concepts</h3>\n            <div class=\"concepts-grid\">\n                <div class=\"concept-card concept-blue\">\n                    <h4>Symmetric Top</h4>\n                    <p>A rigid body with rotational symmetry around one axis, like a spinning top or gyroscope.</p>\n                </div>\n                <div class=\"concept-card concept-green\">\n                    <h4>Small Nutation</h4>\n                    <p>Assumes minimal wobbling motion, allowing simplified precession calculations.</p>\n                </div>\n                <div class=\"concept-card concept-purple\">\n                    <h4>Constraints</h4>\n                    <p>I &gt; 0 (positive inertia) and ω ≠ 0 (non-zero spin rate) are required.</p>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    background: linear-gradient(135deg, #f8fafc 0%, #e0f2fe 100%);\n    min-height: 100vh;\n    padding: 2rem;\n}\n\n.container {\n    max-width: 1400px;\n    margin: 0 auto;\n}\n\n.main-card {\n    background: white;\n    border-radius: 1rem;\n    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\n    padding: 2rem;\n    margin-bottom: 1.5rem;\n}\n\n.header {\n    text-align: center;\n    margin-bottom: 2rem;\n}\n\n.header h1 {\n    font-size: 2.5rem;\n    color: #1f2937;\n    margin-bottom: 0.5rem;\n}\n\n.subtitle {\n    color: #6b7280;\n    font-size: 1rem;\n}\n\n.formula {\n    color: #9ca3af;\n    font-size: 0.875rem;\n    margin-top: 0.5rem;\n}\n\n.content-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 2rem;\n}\n\n@media (max-width: 1024px) {\n    .content-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n.visualization-section {\n    background: linear-gradient(135deg, #f8fafc 0%, #e0f2fe 100%);\n    border-radius: 0.75rem;\n    padding: 1.5rem;\n}\n\n.visualization-section h2,\n.controls-section h2 {\n    font-size: 1.25rem;\n    color: #374151;\n    margin-bottom: 1rem;\n}\n\n#gyroCanvas {\n    display: block;\n    margin: 0 auto;\n}\n\n.legend {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 0.75rem;\n    margin-top: 1rem;\n    font-size: 0.875rem;\n}\n\n.legend-item {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.legend-color {\n    width: 1rem;\n    height: 1rem;\n    border-radius: 0.25rem;\n}\n\n.controls-section h2 {\n    margin-bottom: 1.5rem;\n}\n\n.control-group {\n    margin-bottom: 1.5rem;\n}\n\n.control-group label {\n    display: block;\n    font-size: 0.875rem;\n    font-weight: 500;\n    color: #374151;\n    margin-bottom: 0.5rem;\n}\n\n.control-group input[type=\"range\"] {\n    width: 100%;\n    height: 0.5rem;\n    background: #e5e7eb;\n    border-radius: 0.5rem;\n    outline: none;\n    -webkit-appearance: none;\n    appearance: none;\n}\n\n.control-group input[type=\"range\"]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 1.25rem;\n    height: 1.25rem;\n    background: #2563eb;\n    border-radius: 50%;\n    cursor: pointer;\n}\n\n.control-group input[type=\"range\"]::-moz-range-thumb {\n    width: 1.25rem;\n    height: 1.25rem;\n    background: #2563eb;\n    border-radius: 50%;\n    cursor: pointer;\n    border: none;\n}\n\n.slider-labels {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.75rem;\n    color: #6b7280;\n    margin-top: 0.25rem;\n}\n\n.results-box {\n    background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);\n    border-radius: 0.75rem;\n    padding: 1.5rem;\n    margin-bottom: 1.5rem;\n}\n\n.results-box h3 {\n    font-size: 1.125rem;\n    color: #374151;\n    margin-bottom: 0.75rem;\n}\n\n.result-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 0.5rem;\n    color: #4b5563;\n}\n\n.result-value {\n    font-family: 'Courier New', monospace;\n    font-weight: bold;\n    color: #2563eb;\n    font-size: 1.125rem;\n}\n\n.button-group {\n    display: flex;\n    gap: 0.75rem;\n    margin-bottom: 1.5rem;\n}\n\n.btn {\n    flex: 1;\n    padding: 0.75rem 1.5rem;\n    font-size: 1rem;\n    font-weight: 600;\n    border: none;\n    border-radius: 0.5rem;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n\n.btn-primary {\n    background: #2563eb;\n    color: white;\n}\n\n.btn-primary:hover {\n    background: #1d4ed8;\n}\n\n.btn-secondary {\n    background: #4b5563;\n    color: white;\n}\n\n.btn-secondary:hover {\n    background: #374151;\n}\n\n.info-box {\n    background: #fef3c7;\n    border: 1px solid #fcd34d;\n    border-radius: 0.5rem;\n    padding: 1rem;\n}\n\n.info-box h4 {\n    color: #92400e;\n    font-size: 0.875rem;\n    font-weight: 600;\n    margin-bottom: 0.5rem;\n}\n\n.info-box p {\n    color: #b45309;\n    font-size: 0.875rem;\n    line-height: 1.5;\n}\n\n.physics-info {\n    background: white;\n    border-radius: 0.75rem;\n    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);\n    padding: 1.5rem;\n}\n\n.physics-info h3 {\n    font-size: 1.25rem;\n    color: #1f2937;\n    margin-bottom: 0.75rem;\n}\n\n.concepts-grid {\n    display: grid;\n    grid-template-columns: repeat(3, 1fr);\n    gap: 1rem;\n}\n\n@media (max-width: 768px) {\n    .concepts-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n.concept-card {\n    border-radius: 0.5rem;\n    padding: 1rem;\n}\n\n.concept-card h4 {\n    font-size: 0.875rem;\n    font-weight: 600;\n    margin-bottom: 0.5rem;\n}\n\n.concept-card p {\n    font-size: 0.875rem;\n    line-height: 1.5;\n}\n\n.concept-blue {\n    background: #dbeafe;\n}\n\n.concept-blue h4 {\n    color: #1e40af;\n}\n\n.concept-blue p {\n    color: #1e3a8a;\n}\n\n.concept-green {\n    background: #d1fae5;\n}\n\n.concept-green h4 {\n    color: #065f46;\n}\n\n.concept-green p {\n    color: #047857;\n}\n\n.concept-purple {\n    background: #e9d5ff;\n}\n\n.concept-purple h4 {\n    color: #6b21a8;\n}\n\n.concept-purple p {\n    color: #7c3aed;\n}", "js": "// State variables\nlet torque = 10;\nlet spinRate = 100;\nlet momentOfInertia = 1;\nlet precessionRate = 0;\nlet isAnimating = true;\nlet precessionAngle = 0;\nlet spinAngle = 0;\nlet lastTime = Date.now();\nlet animationFrame = null;\n\n// DOM elements\nconst torqueSlider = document.getElementById('torqueSlider');\nconst spinRateSlider = document.getElementById('spinRateSlider');\nconst inertiaSlider = document.getElementById('inertiaSlider');\nconst torqueValue = document.getElementById('torqueValue');\nconst spinRateValue = document.getElementById('spinRateValue');\nconst inertiaValue = document.getElementById('inertiaValue');\nconst precessionResult = document.getElementById('precessionResult');\nconst directionResult = document.getElementById('directionResult');\nconst resultLabel = document.getElementById('resultLabel');\nconst playPauseBtn = document.getElementById('playPauseBtn');\nconst resetBtn = document.getElementById('resetBtn');\n\n// SVG elements\nconst supportArm = document.getElementById('supportArm');\nconst gyroGroup = document.getElementById('gyroGroup');\nconst gyroDisc = document.getElementById('gyroDisc');\nconst spinAxis = document.getElementById('spinAxis');\nconst rotIndicator = document.getElementById('rotIndicator');\nconst torqueArrow = document.getElementById('torqueArrow');\nconst torqueLine = document.getElementById('torqueLine');\nconst torqueLabel = document.getElementById('torqueLabel');\nconst precessionPath = document.getElementById('precessionPath');\n\n// Calculate precession rate\nfunction calculatePrecession() {\n    if (spinRate !== 0 && momentOfInertia > 0) {\n        precessionRate = torque / (momentOfInertia * spinRate);\n    } else {\n        precessionRate = 0;\n    }\n    updateResults();\n}\n\n// Update results display\nfunction updateResults() {\n    precessionResult.textContent = precessionRate.toFixed(4) + ' rad/s';\n    resultLabel.textContent = `Ωₚ = ${precessionRate.toFixed(3)} rad/s`;\n    \n    if (precessionRate > 0) {\n        directionResult.textContent = 'Counter-clockwise';\n    } else if (precessionRate < 0) {\n        directionResult.textContent = 'Clockwise';\n    } else {\n        directionResult.textContent = 'No precession';\n    }\n}\n\n// Update visualization\nfunction updateVisualization() {\n    const centerX = 200;\n    const centerY = 200;\n    const armLength = 120;\n    \n    // Calculate gyroscope position\n    const gyroX = centerX + armLength * Math.cos(precessionAngle);\n    const gyroY = centerY + armLength * Math.sin(precessionAngle);\n    \n    // Update support arm\n    supportArm.setAttribute('x2', gyroX);\n    supportArm.setAttribute('y2', gyroY);\n    \n    // Update gyroscope group position\n    gyroGroup.setAttribute('transform', `translate(${gyroX}, ${gyroY})`);\n    \n    // Update spin rotation\n    const spinDeg = (spinAngle * 180 / Math.PI) % 360;\n    gyroDisc.setAttribute('transform', `rotate(${spinDeg})`);\n    spinAxis.setAttribute('transform', `rotate(${spinDeg})`);\n    rotIndicator.setAttribute('transform', `rotate(${spinDeg})`);\n    \n    // Update torque arrow\n    if (torque !== 0) {\n        torqueArrow.style.display = 'block';\n        const arrowY = gyroY - 40;\n        const arrowEndY = arrowY - Math.sign(torque) * 30;\n        torqueLine.setAttribute('x1', gyroX);\n        torqueLine.setAttribute('y1', arrowY);\n        torqueLine.setAttribute('x2', gyroX);\n        torqueLine.setAttribute('y2', arrowEndY);\n        torqueLabel.setAttribute('x', gyroX + 10);\n        torqueLabel.setAttribute('y', gyroY - 55);\n    } else {\n        torqueArrow.style.display = 'none';\n    }\n    \n    // Update precession path\n    if (precessionRate !== 0) {\n        precessionPath.style.display = 'block';\n        const radius = 130;\n        const arcFlag = precessionRate > 0 ? 1 : 0;\n        const endX = centerX + radius * Math.cos(Math.PI / 4);\n        const endY = centerY + radius * Math.sin(Math.PI / 4);\n        precessionPath.setAttribute('d', \n            `M ${centerX + radius} ${centerY} A ${radius} ${radius} 0 0 ${arcFlag} ${endX} ${endY}`\n        );\n    } else {\n        precessionPath.style.display = 'none';\n    }\n}\n\n// Animation loop\nfunction animate() {\n    if (!isAnimating) return;\n    \n    const now = Date.now();\n    const dt = (now - lastTime) / 1000; // Convert to seconds\n    lastTime = now;\n    \n    precessionAngle = (precessionAngle + precessionRate * dt) % (2 * Math.PI);\n    spinAngle = (spinAngle + spinRate * dt * 0.1) % (2 * Math.PI);\n    \n    updateVisualization();\n    \n    animationFrame = requestAnimationFrame(animate);\n}\n\n// Event listeners for sliders\ntorqueSlider.addEventListener('input', (e) => {\n    torque = parseFloat(e.target.value);\n    torqueValue.textContent = torque.toFixed(2);\n    calculatePrecession();\n    updateVisualization();\n});\n\nspinRateSlider.addEventListener('input', (e) => {\n    spinRate = parseFloat(e.target.value);\n    spinRateValue.textContent = spinRate.toFixed(2);\n    calculatePrecession();\n});\n\ninertiaSlider.addEventListener('input', (e) => {\n    momentOfInertia = parseFloat(e.target.value);\n    inertiaValue.textContent = momentOfInertia.toFixed(3);\n    calculatePrecession();\n});\n\n// Play/Pause button\nplayPauseBtn.addEventListener('click', () => {\n    if (isAnimating) {\n        isAnimating = false;\n        playPauseBtn.textContent = 'Play';\n        if (animationFrame) {\n            cancelAnimationFrame(animationFrame);\n        }\n    } else {\n        isAnimating = true;\n        playPauseBtn.textContent = 'Pause';\n        lastTime = Date.now();\n        animate();\n    }\n});\n\n// Reset button\nresetBtn.addEventListener('click', () => {\n    precessionAngle = 0;\n    spinAngle = 0;\n    lastTime = Date.now();\n    updateVisualization();\n});\n\n// Initialize\ncalculatePrecession();\nupdateVisualization();\nanimate();"}}
{"input": {"input_text": "Circular orbit speed: v = sqrt(mu/r). Given planet mu and radius r compute orbital period and speed.", "simulation_name": " Circular Orbit", "domain": "Astrodynamics", "description": "Keplerian circular orbit", "assumptions": ["Two-body", "Circular"], "entities": [], "constants": [], "parameters": [{"name": "gravitational_param", "symbol": "mu", "unit": "m^3/s^2", "range": [100000000000.0, 1000000000000000.0]}, {"name": "orbit_radius", "symbol": "r", "unit": "m", "range": [1000000.0, 1000000000.0]}], "equations": [{"description": "Speed", "expression": "v = sqrt(mu/r)"}, {"description": "Period", "expression": "T = 2*pi*sqrt(r^3/mu)"}], "initial_conditions": {}, "outputs": ["v", "T"], "simulation_controls": ["mu", "r"], "constraints": ["mu>0", "r>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S38 Circular Orbit Simulator</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"main-card\">\n            <!-- Header -->\n            <div class=\"header\">\n                <h1>S38 Circular Orbit</h1>\n                <p class=\"subtitle\">Keplerian Circular Orbit Simulator</p>\n                <div class=\"formulas\">\n                    <p class=\"formula\">v = √(μ/r)</p>\n                    <p class=\"formula\">T = 2π√(r³/μ)</p>\n                </div>\n            </div>\n\n            <div class=\"content-grid\">\n                <!-- Visualization -->\n                <div class=\"visualization-section\">\n                    <h2>Orbital Visualization</h2>\n                    <svg id=\"orbitCanvas\" width=\"500\" height=\"500\">\n                        <!-- Star glow effect -->\n                        <defs>\n                            <radialGradient id=\"starGlow\">\n                                <stop offset=\"0%\" style=\"stop-color:#fbbf24;stop-opacity:1\" />\n                                <stop offset=\"50%\" style=\"stop-color:#f59e0b;stop-opacity:0.8\" />\n                                <stop offset=\"100%\" style=\"stop-color:#d97706;stop-opacity:0.6\" />\n                            </radialGradient>\n                            <radialGradient id=\"planetGlow\">\n                                <stop offset=\"0%\" style=\"stop-color:#60a5fa;stop-opacity:1\" />\n                                <stop offset=\"70%\" style=\"stop-color:#3b82f6;stop-opacity:0.8\" />\n                                <stop offset=\"100%\" style=\"stop-color:#2563eb;stop-opacity:0\" />\n                            </radialGradient>\n                            <filter id=\"glow\">\n                                <feGaussianBlur stdDeviation=\"3\" result=\"coloredBlur\"/>\n                                <feMerge>\n                                    <feMergeNode in=\"coloredBlur\"/>\n                                    <feMergeNode in=\"SourceGraphic\"/>\n                                </feMerge>\n                            </filter>\n                        </defs>\n                        \n                        <!-- Background space -->\n                        <rect width=\"500\" height=\"500\" fill=\"#0f172a\"/>\n                        \n                        <!-- Stars background -->\n                        <g id=\"stars\"></g>\n                        \n                        <!-- Orbit path -->\n                        <circle id=\"orbitPath\" cx=\"250\" cy=\"250\" r=\"150\" fill=\"none\" stroke=\"#475569\" stroke-width=\"2\" stroke-dasharray=\"5,5\" opacity=\"0.5\"/>\n                        \n                        <!-- Central body (star/planet) -->\n                        <circle cx=\"250\" cy=\"250\" r=\"25\" fill=\"url(#starGlow)\" filter=\"url(#glow)\"/>\n                        <text x=\"250\" y=\"290\" fill=\"#fbbf24\" font-size=\"12\" text-anchor=\"middle\" font-weight=\"bold\">Central Body</text>\n                        \n                        <!-- Orbiting satellite -->\n                        <g id=\"satellite\">\n                            <circle cx=\"0\" cy=\"0\" r=\"12\" fill=\"url(#planetGlow)\" filter=\"url(#glow)\"/>\n                            <circle cx=\"0\" cy=\"0\" r=\"8\" fill=\"#3b82f6\"/>\n                        </g>\n                        \n                        <!-- Velocity vector -->\n                        <defs>\n                            <marker id=\"velocityArrow\" markerWidth=\"10\" markerHeight=\"10\" refX=\"9\" refY=\"3\" orient=\"auto\">\n                                <polygon points=\"0 0, 10 3, 0 6\" fill=\"#10b981\" />\n                            </marker>\n                        </defs>\n                        <line id=\"velocityVector\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"0\" stroke=\"#10b981\" stroke-width=\"2.5\" marker-end=\"url(#velocityArrow)\" opacity=\"0.9\"/>\n                        \n                        <!-- Radius line -->\n                        <line id=\"radiusLine\" x1=\"250\" y1=\"250\" x2=\"400\" y2=\"250\" stroke=\"#ec4899\" stroke-width=\"2\" stroke-dasharray=\"3,3\" opacity=\"0.7\"/>\n                        <text id=\"radiusLabel\" x=\"325\" y=\"240\" fill=\"#ec4899\" font-size=\"11\" text-anchor=\"middle\">r</text>\n                        \n                        <!-- Info display -->\n                        <text x=\"250\" y=\"30\" fill=\"#94a3b8\" font-size=\"14\" text-anchor=\"middle\" font-weight=\"bold\">\n                            <tspan id=\"orbitInfo\">Orbit: 1 of ∞</tspan>\n                        </text>\n                    </svg>\n                    \n                    <!-- Legend -->\n                    <div class=\"legend\">\n                        <div class=\"legend-item\">\n                            <div class=\"legend-color\" style=\"background: #f59e0b;\"></div>\n                            <span>Central Body</span>\n                        </div>\n                        <div class=\"legend-item\">\n                            <div class=\"legend-color\" style=\"background: #3b82f6;\"></div>\n                            <span>Satellite</span>\n                        </div>\n                        <div class=\"legend-item\">\n                            <div class=\"legend-color\" style=\"background: #10b981;\"></div>\n                            <span>Velocity (v)</span>\n                        </div>\n                        <div class=\"legend-item\">\n                            <div class=\"legend-color\" style=\"background: #ec4899;\"></div>\n                            <span>Radius (r)</span>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Controls -->\n                <div class=\"controls-section\">\n                    <h2>Orbital Parameters</h2>\n                    \n                    <!-- Gravitational Parameter -->\n                    <div class=\"control-group\">\n                        <label>Gravitational Parameter (μ): <span id=\"muValue\">3.99e14</span> m³/s²</label>\n                        <input type=\"range\" id=\"muSlider\" min=\"11\" max=\"15\" step=\"0.01\" value=\"14.6\">\n                        <div class=\"slider-labels\">\n                            <span>10¹¹</span>\n                            <span>10¹³</span>\n                            <span>10¹⁵</span>\n                        </div>\n                        <div class=\"preset-buttons\">\n                            <button class=\"preset-btn\" data-mu=\"3.986e14\">Earth</button>\n                            <button class=\"preset-btn\" data-mu=\"4.283e13\">Mars</button>\n                            <button class=\"preset-btn\" data-mu=\"1.327e20\">Sun</button>\n                        </div>\n                    </div>\n\n                    <!-- Orbit Radius -->\n                    <div class=\"control-group\">\n                        <label>Orbit Radius (r): <span id=\"radiusValue\">6.78e6</span> m</label>\n                        <input type=\"range\" id=\"radiusSlider\" min=\"6\" max=\"9\" step=\"0.01\" value=\"6.83\">\n                        <div class=\"slider-labels\">\n                            <span>10⁶</span>\n                            <span>10⁷·⁵</span>\n                            <span>10⁹</span>\n                        </div>\n                        <div class=\"preset-buttons\">\n                            <button class=\"preset-btn\" data-radius=\"6.78e6\">LEO</button>\n                            <button class=\"preset-btn\" data-radius=\"4.22e7\">GEO</button>\n                            <button class=\"preset-btn\" data-radius=\"1.50e11\">Earth-Sun</button>\n                        </div>\n                    </div>\n\n                    <!-- Animation Speed -->\n                    <div class=\"control-group\">\n                        <label>Animation Speed: <span id=\"speedValue\">1.0</span>x</label>\n                        <input type=\"range\" id=\"speedSlider\" min=\"0.1\" max=\"5\" step=\"0.1\" value=\"1\">\n                        <div class=\"slider-labels\">\n                            <span>0.1x</span>\n                            <span>2.5x</span>\n                            <span>5x</span>\n                        </div>\n                    </div>\n\n                    <!-- Results -->\n                    <div class=\"results-box\">\n                        <h3>Calculated Results</h3>\n                        <div class=\"result-item\">\n                            <span>Orbital Speed (v):</span>\n                            <span id=\"speedResult\" class=\"result-value\">7668 m/s</span>\n                        </div>\n                        <div class=\"result-item\">\n                            <span>Orbital Period (T):</span>\n                            <span id=\"periodResult\" class=\"result-value\">5558 s</span>\n                        </div>\n                        <div class=\"result-item\">\n                            <span>Period (readable):</span>\n                            <span id=\"periodReadable\">1h 32m 38s</span>\n                        </div>\n                        <div class=\"result-item\">\n                            <span>Circumference:</span>\n                            <span id=\"circumferenceResult\">4.26e7 m</span>\n                        </div>\n                    </div>\n\n                    <!-- Animation Controls -->\n                    <div class=\"button-group\">\n                        <button id=\"playPauseBtn\" class=\"btn btn-primary\">Pause</button>\n                        <button id=\"resetBtn\" class=\"btn btn-secondary\">Reset</button>\n                    </div>\n\n                    <!-- Info -->\n                    <div class=\"info-box\">\n                        <h4>About Circular Orbits</h4>\n                        <p>In a circular orbit, the gravitational force provides exactly the centripetal \n                        force needed to maintain circular motion. The orbital speed depends only on the \n                        gravitational parameter (μ) and the orbital radius (r).</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Physics Information -->\n        <div class=\"physics-info\">\n            <h3>Astrodynamics Concepts</h3>\n            <div class=\"concepts-grid\">\n                <div class=\"concept-card concept-blue\">\n                    <h4>Two-Body Problem</h4>\n                    <p>Assumes only gravitational interaction between two bodies, ignoring all other forces and perturbations.</p>\n                </div>\n                <div class=\"concept-card concept-green\">\n                    <h4>Circular Orbit</h4>\n                    <p>A special case where orbital eccentricity is zero and the distance from the central body remains constant.</p>\n                </div>\n                <div class=\"concept-card concept-purple\">\n                    <h4>Keplerian Motion</h4>\n                    <p>Orbital motion following Kepler's laws, valid for ideal two-body systems with inverse-square gravitational force.</p>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);\n    min-height: 100vh;\n    padding: 2rem;\n}\n\n.container {\n    max-width: 1400px;\n    margin: 0 auto;\n}\n\n.main-card {\n    background: linear-gradient(135deg, #1e293b 0%, #334155 100%);\n    border-radius: 1rem;\n    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);\n    padding: 2rem;\n    margin-bottom: 1.5rem;\n    border: 1px solid rgba(148, 163, 184, 0.1);\n}\n\n.header {\n    text-align: center;\n    margin-bottom: 2rem;\n}\n\n.header h1 {\n    font-size: 2.5rem;\n    color: #f1f5f9;\n    margin-bottom: 0.5rem;\n    text-shadow: 0 0 20px rgba(59, 130, 246, 0.5);\n}\n\n.subtitle {\n    color: #94a3b8;\n    font-size: 1rem;\n}\n\n.formulas {\n    margin-top: 1rem;\n    display: flex;\n    gap: 2rem;\n    justify-content: center;\n}\n\n.formula {\n    color: #cbd5e1;\n    font-size: 0.875rem;\n    font-family: 'Courier New', monospace;\n    background: rgba(15, 23, 42, 0.5);\n    padding: 0.5rem 1rem;\n    border-radius: 0.5rem;\n    border: 1px solid rgba(148, 163, 184, 0.2);\n}\n\n.content-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 2rem;\n}\n\n@media (max-width: 1024px) {\n    .content-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n.visualization-section {\n    background: rgba(15, 23, 42, 0.5);\n    border-radius: 0.75rem;\n    padding: 1.5rem;\n    border: 1px solid rgba(148, 163, 184, 0.1);\n}\n\n.visualization-section h2,\n.controls-section h2 {\n    font-size: 1.25rem;\n    color: #f1f5f9;\n    margin-bottom: 1rem;\n}\n\n#orbitCanvas {\n    display: block;\n    margin: 0 auto;\n    border-radius: 0.5rem;\n}\n\n.legend {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 0.75rem;\n    margin-top: 1rem;\n    font-size: 0.875rem;\n}\n\n.legend-item {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    color: #cbd5e1;\n}\n\n.legend-color {\n    width: 1rem;\n    height: 1rem;\n    border-radius: 0.25rem;\n}\n\n.controls-section h2 {\n    margin-bottom: 1.5rem;\n}\n\n.control-group {\n    margin-bottom: 1.5rem;\n}\n\n.control-group label {\n    display: block;\n    font-size: 0.875rem;\n    font-weight: 500;\n    color: #e2e8f0;\n    margin-bottom: 0.5rem;\n}\n\n.control-group input[type=\"range\"] {\n    width: 100%;\n    height: 0.5rem;\n    background: rgba(71, 85, 105, 0.5);\n    border-radius: 0.5rem;\n    outline: none;\n    -webkit-appearance: none;\n    appearance: none;\n}\n\n.control-group input[type=\"range\"]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 1.25rem;\n    height: 1.25rem;\n    background: #3b82f6;\n    border-radius: 50%;\n    cursor: pointer;\n    box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);\n}\n\n.control-group input[type=\"range\"]::-moz-range-thumb {\n    width: 1.25rem;\n    height: 1.25rem;\n    background: #3b82f6;\n    border-radius: 50%;\n    cursor: pointer;\n    border: none;\n    box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);\n}\n\n.slider-labels {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.75rem;\n    color: #94a3b8;\n    margin-top: 0.25rem;\n}\n\n.preset-buttons {\n    display: flex;\n    gap: 0.5rem;\n    margin-top: 0.5rem;\n}\n\n.preset-btn {\n    flex: 1;\n    padding: 0.4rem 0.8rem;\n    font-size: 0.75rem;\n    font-weight: 500;\n    background: rgba(59, 130, 246, 0.2);\n    color: #93c5fd;\n    border: 1px solid rgba(59, 130, 246, 0.3);\n    border-radius: 0.375rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.preset-btn:hover {\n    background: rgba(59, 130, 246, 0.3);\n    border-color: rgba(59, 130, 246, 0.5);\n}\n\n.results-box {\n    background: linear-gradient(135deg, rgba(37, 99, 235, 0.1) 0%, rgba(79, 70, 229, 0.1) 100%);\n    border-radius: 0.75rem;\n    padding: 1.5rem;\n    margin-bottom: 1.5rem;\n    border: 1px solid rgba(59, 130, 246, 0.2);\n}\n\n.results-box h3 {\n    font-size: 1.125rem;\n    color: #f1f5f9;\n    margin-bottom: 0.75rem;\n}\n\n.result-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 0.5rem;\n    color: #cbd5e1;\n    font-size: 0.875rem;\n}\n\n.result-value {\n    font-family: 'Courier New', monospace;\n    font-weight: bold;\n    color: #60a5fa;\n    font-size: 1rem;\n}\n\n.button-group {\n    display: flex;\n    gap: 0.75rem;\n    margin-bottom: 1.5rem;\n}\n\n.btn {\n    flex: 1;\n    padding: 0.75rem 1.5rem;\n    font-size: 1rem;\n    font-weight: 600;\n    border: none;\n    border-radius: 0.5rem;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n\n.btn-primary {\n    background: #3b82f6;\n    color: white;\n    box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);\n}\n\n.btn-primary:hover {\n    background: #2563eb;\n    box-shadow: 0 0 25px rgba(59, 130, 246, 0.5);\n}\n\n.btn-secondary {\n    background: #64748b;\n    color: white;\n}\n\n.btn-secondary:hover {\n    background: #475569;\n}\n\n.info-box {\n    background: rgba(245, 158, 11, 0.1);\n    border: 1px solid rgba(245, 158, 11, 0.3);\n    border-radius: 0.5rem;\n    padding: 1rem;\n}\n\n.info-box h4 {\n    color: #fbbf24;\n    font-size: 0.875rem;\n    font-weight: 600;\n    margin-bottom: 0.5rem;\n}\n\n.info-box p {\n    color: #fcd34d;\n    font-size: 0.875rem;\n    line-height: 1.5;\n}\n\n.physics-info {\n    background: linear-gradient(135deg, #1e293b 0%, #334155 100%);\n    border-radius: 0.75rem;\n    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);\n    padding: 1.5rem;\n    border: 1px solid rgba(148, 163, 184, 0.1);\n}\n\n.physics-info h3 {\n    font-size: 1.25rem;\n    color: #f1f5f9;\n    margin-bottom: 0.75rem;\n}\n\n.concepts-grid {\n    display: grid;\n    grid-template-columns: repeat(3, 1fr);\n    gap: 1rem;\n}\n\n@media (max-width: 768px) {\n    .concepts-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n.concept-card {\n    border-radius: 0.5rem;\n    padding: 1rem;\n    border: 1px solid;\n}\n\n.concept-card h4 {\n    font-size: 0.875rem;\n    font-weight: 600;\n    margin-bottom: 0.5rem;\n}\n\n.concept-card p {\n    font-size: 0.875rem;\n    line-height: 1.5;\n}\n\n.concept-blue {\n    background: rgba(59, 130, 246, 0.1);\n    border-color: rgba(59, 130, 246, 0.3);\n}\n\n.concept-blue h4 {\n    color: #60a5fa;\n}\n\n.concept-blue p {\n    color: #93c5fd;\n}\n\n.concept-green {\n    background: rgba(16, 185, 129, 0.1);\n    border-color: rgba(16, 185, 129, 0.3);\n}\n\n.concept-green h4 {\n    color: #34d399;\n}\n\n.concept-green p {\n    color: #6ee7b7;\n}\n\n.concept-purple {\n    background: rgba(168, 85, 247, 0.1);\n    border-color: rgba(168, 85, 247, 0.3);\n}\n\n.concept-purple h4 {\n    color: #a78bfa;\n}\n\n.concept-purple p {\n    color: #c4b5fd;\n}", "js": "// State variables\nlet mu = 3.986e14; // Earth's gravitational parameter\nlet radius = 6.78e6; // Low Earth Orbit radius\nlet orbitalSpeed = 0;\nlet orbitalPeriod = 0;\nlet isAnimating = true;\nlet orbitAngle = 0;\nlet animationSpeed = 1;\nlet lastTime = Date.now();\nlet animationFrame = null;\nlet orbitCount = 0;\nlet completedOrbits = 0;\n\n// DOM elements\nconst muSlider = document.getElementById('muSlider');\nconst radiusSlider = document.getElementById('radiusSlider');\nconst speedSlider = document.getElementById('speedSlider');\nconst muValue = document.getElementById('muValue');\nconst radiusValue = document.getElementById('radiusValue');\nconst speedValue = document.getElementById('speedValue');\nconst speedResult = document.getElementById('speedResult');\nconst periodResult = document.getElementById('periodResult');\nconst periodReadable = document.getElementById('periodReadable');\nconst circumferenceResult = document.getElementById('circumferenceResult');\nconst playPauseBtn = document.getElementById('playPauseBtn');\nconst resetBtn = document.getElementById('resetBtn');\nconst orbitInfo = document.getElementById('orbitInfo');\n\n// SVG elements\nconst orbitPath = document.getElementById('orbitPath');\nconst satellite = document.getElementById('satellite');\nconst velocityVector = document.getElementById('velocityVector');\nconst radiusLine = document.getElementById('radiusLine');\nconst radiusLabel = document.getElementById('radiusLabel');\n\n// Constants\nconst CENTER_X = 250;\nconst CENTER_Y = 250;\nconst DISPLAY_RADIUS = 150; // Visual radius on canvas\n\n// Generate stars background\nfunction generateStars() {\n    const starsGroup = document.getElementById('stars');\n    for (let i = 0; i < 100; i++) {\n        const star = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n        star.setAttribute('cx', Math.random() * 500);\n        star.setAttribute('cy', Math.random() * 500);\n        star.setAttribute('r', Math.random() * 1.5);\n        star.setAttribute('fill', '#ffffff');\n        star.setAttribute('opacity', Math.random() * 0.7 + 0.3);\n        starsGroup.appendChild(star);\n    }\n}\n\n// Format time in readable format\nfunction formatTime(seconds) {\n    if (seconds < 60) {\n        return `${seconds.toFixed(1)}s`;\n    } else if (seconds < 3600) {\n        const mins = Math.floor(seconds / 60);\n        const secs = Math.floor(seconds % 60);\n        return `${mins}m ${secs}s`;\n    } else if (seconds < 86400) {\n        const hours = Math.floor(seconds / 3600);\n        const mins = Math.floor((seconds % 3600) / 60);\n        const secs = Math.floor(seconds % 60);\n        return `${hours}h ${mins}m ${secs}s`;\n    } else {\n        const days = Math.floor(seconds / 86400);\n        const hours = Math.floor((seconds % 86400) / 3600);\n        return `${days}d ${hours}h`;\n    }\n}\n\n// Format scientific notation\nfunction formatScientific(value, decimals = 2) {\n    if (value === 0) return '0';\n    const exponent = Math.floor(Math.log10(Math.abs(value)));\n    const mantissa = value / Math.pow(10, exponent);\n    return `${mantissa.toFixed(decimals)}e${exponent}`;\n}\n\n// Calculate orbital parameters\nfunction calculateOrbit() {\n    if (radius > 0 && mu > 0) {\n        // v = sqrt(mu/r)\n        orbitalSpeed = Math.sqrt(mu / radius);\n        \n        // T = 2*pi*sqrt(r^3/mu)\n        orbitalPeriod = 2 * Math.PI * Math.sqrt(Math.pow(radius, 3) / mu);\n    } else {\n        orbitalSpeed = 0;\n        orbitalPeriod = 0;\n    }\n    updateResults();\n}\n\n// Update results display\nfunction updateResults() {\n    speedResult.textContent = `${Math.round(orbitalSpeed)} m/s`;\n    periodResult.textContent = `${Math.round(orbitalPeriod)} s`;\n    periodReadable.textContent = formatTime(orbitalPeriod);\n    \n    const circumference = 2 * Math.PI * radius;\n    circumferenceResult.textContent = formatScientific(circumference);\n}\n\n// Update visualization\nfunction updateVisualization() {\n    // Calculate satellite position\n    const satX = CENTER_X + DISPLAY_RADIUS * Math.cos(orbitAngle);\n    const satY = CENTER_Y + DISPLAY_RADIUS * Math.sin(orbitAngle);\n    \n    // Update satellite position\n    satellite.setAttribute('transform', `translate(${satX}, ${satY})`);\n    \n    // Update velocity vector (tangent to orbit)\n    const velocityLength = 40;\n    const velocityAngle = orbitAngle + Math.PI / 2; // Perpendicular to radius\n    const velEndX = satX + velocityLength * Math.cos(velocityAngle);\n    const velEndY = satY + velocityLength * Math.sin(velocityAngle);\n    \n    velocityVector.setAttribute('x1', satX);\n    velocityVector.setAttribute('y1', satY);\n    velocityVector.setAttribute('x2', velEndX);\n    velocityVector.setAttribute('y2', velEndY);\n    \n    // Update radius line\n    radiusLine.setAttribute('x2', satX);\n    radiusLine.setAttribute('y2', satY);\n    \n    // Update radius label position (midpoint)\n    const labelX = CENTER_X + (satX - CENTER_X) / 2;\n    const labelY = CENTER_Y + (satY - CENTER_Y) / 2;\n    radiusLabel.setAttribute('x', labelX);\n    radiusLabel.setAttribute('y', labelY - 5);\n    \n    // Update orbit info\n    orbitInfo.textContent = `Orbit: ${completedOrbits} completed`;\n}\n\n// Animation loop\nfunction animate() {\n    if (!isAnimating) return;\n    \n    const now = Date.now();\n    const dt = (now - lastTime) / 1000; // Convert to seconds\n    lastTime = now;\n    \n    // Calculate angular velocity (radians per second)\n    // We want to complete one visual orbit in a reasonable time\n    // Scale the actual orbital period to animation time\n    const visualPeriod = 10; // seconds for one visual orbit\n    const angularVelocity = (2 * Math.PI / visualPeriod) * animationSpeed;\n    \n    const oldAngle = orbitAngle;\n    orbitAngle = (orbitAngle + angularVelocity * dt) % (2 * Math.PI);\n    \n    // Check if we completed an orbit\n    if (oldAngle > orbitAngle) {\n        completedOrbits++;\n    }\n    \n    updateVisualization();\n    \n    animationFrame = requestAnimationFrame(animate);\n}\n\n// Event listeners for sliders\nmuSlider.addEventListener('input', (e) => {\n    const exponent = parseFloat(e.target.value);\n    mu = Math.pow(10, exponent);\n    muValue.textContent = formatScientific(mu);\n    calculateOrbit();\n});\n\nradiusSlider.addEventListener('input', (e) => {\n    const exponent = parseFloat(e.target.value);\n    radius = Math.pow(10, exponent);\n    radiusValue.textContent = formatScientific(radius);\n    calculateOrbit();\n});\n\nspeedSlider.addEventListener('input', (e) => {\n    animationSpeed = parseFloat(e.target.value);\n    speedValue.textContent = animationSpeed.toFixed(1);\n});\n\n// Preset buttons\ndocument.querySelectorAll('.preset-btn[data-mu]').forEach(btn => {\n    btn.addEventListener('click', () => {\n        mu = parseFloat(btn.dataset.mu);\n        const exponent = Math.log10(mu);\n        muSlider.value = exponent;\n        muValue.textContent = formatScientific(mu);\n        calculateOrbit();\n    });\n});\n\ndocument.querySelectorAll('.preset-btn[data-radius]').forEach(btn => {\n    btn.addEventListener('click', () => {\n        radius = parseFloat(btn.dataset.radius);\n        const exponent = Math.log10(radius);\n        radiusSlider.value = exponent;\n        radiusValue.textContent = formatScientific(radius);\n        calculateOrbit();\n    });\n});\n\n// Play/Pause button\nplayPauseBtn.addEventListener('click', () => {\n    if (isAnimating) {\n        isAnimating = false;\n        playPauseBtn.textContent = 'Play';\n        if (animationFrame) {\n            cancelAnimationFrame(animationFrame);\n        }\n    } else {\n        isAnimating = true;\n        playPauseBtn.textContent = 'Pause';\n        lastTime = Date.now();\n        animate();\n    }\n});\n\n// Reset button\nresetBtn.addEventListener('click', () => {\n    orbitAngle = 0;\n    completedOrbits = 0;\n    lastTime = Date.now();\n    updateVisualization();\n});\n\n// Initialize\ngenerateStars();\ncalculateOrbit();\nupdateVisualization();\nanimate();"}}
{"input": {"input_text": "Hohmann transfer between circular orbits r1 and r2. Compute delta-v1, delta-v2, total DV.", "simulation_name": " Hohmann Transfer", "domain": "Astrodynamics", "description": "Two-impulse Hohmann transfer", "assumptions": ["Coplanar circular orbits"], "entities": [], "constants": [], "parameters": [{"name": "gravitational_param", "symbol": "mu", "unit": "m^3/s^2", "range": [100000000000.0, 1000000000000000.0]}, {"name": "radius1", "symbol": "r1", "unit": "m", "range": [1000000.0, 1000000000.0]}, {"name": "radius2", "symbol": "r2", "unit": "m", "range": [1000000.0, 1000000000.0]}], "equations": [{"description": "v1", "expression": "v1 = sqrt(mu/r1)"}, {"description": "v2", "expression": "v2 = sqrt(mu/r2)"}, {"description": "semi-major", "expression": "a = 0.5*(r1+r2)"}, {"description": "transfer perigee", "expression": "vtp = sqrt(mu*(2/r1 - 1/a))"}, {"description": "transfer apogee", "expression": "vta = sqrt(mu*(2/r2 - 1/a))"}, {"description": "DeltaV1", "expression": "dV1 = vtp - v1"}, {"description": "DeltaV2", "expression": "dV2 = v2 - vta"}, {"description": "Total", "expression": "dVtot = |dV1| + |dV2|"}], "initial_conditions": {}, "outputs": ["dV1", "dV2", "dVtot"], "simulation_controls": ["mu", "r1", "r2"], "constraints": ["r1>0", "r2>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S39 Hohmann Transfer Simulator</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"main-card\">\n            <!-- Header -->\n            <div class=\"header\">\n                <h1>S39 Hohmann Transfer</h1>\n                <p class=\"subtitle\">Two-Impulse Hohmann Transfer Orbit</p>\n                <div class=\"formulas\">\n                    <p class=\"formula\">ΔV₁ = √(μ(2/r₁ - 1/a)) - √(μ/r₁)</p>\n                    <p class=\"formula\">ΔV₂ = √(μ/r₂) - √(μ(2/r₂ - 1/a))</p>\n                </div>\n            </div>\n\n            <div class=\"content-grid\">\n                <!-- Visualization -->\n                <div class=\"visualization-section\">\n                    <h2>Transfer Orbit Visualization</h2>\n                    <svg id=\"transferCanvas\" width=\"600\" height=\"600\">\n                        <!-- Star glow effect -->\n                        <defs>\n                            <radialGradient id=\"starGlow\">\n                                <stop offset=\"0%\" style=\"stop-color:#fbbf24;stop-opacity:1\" />\n                                <stop offset=\"50%\" style=\"stop-color:#f59e0b;stop-opacity:0.8\" />\n                                <stop offset=\"100%\" style=\"stop-color:#d97706;stop-opacity:0.6\" />\n                            </radialGradient>\n                            <radialGradient id=\"satelliteGlow\">\n                                <stop offset=\"0%\" style=\"stop-color:#60a5fa;stop-opacity:1\" />\n                                <stop offset=\"70%\" style=\"stop-color:#3b82f6;stop-opacity:0.8\" />\n                                <stop offset=\"100%\" style=\"stop-color:#2563eb;stop-opacity:0\" />\n                            </radialGradient>\n                            <filter id=\"glow\">\n                                <feGaussianBlur stdDeviation=\"3\" result=\"coloredBlur\"/>\n                                <feMerge>\n                                    <feMergeNode in=\"coloredBlur\"/>\n                                    <feMergeNode in=\"SourceGraphic\"/>\n                                </feMerge>\n                            </filter>\n                            <marker id=\"burnArrow\" markerWidth=\"10\" markerHeight=\"10\" refX=\"9\" refY=\"3\" orient=\"auto\">\n                                <polygon points=\"0 0, 10 3, 0 6\" fill=\"#ef4444\" />\n                            </marker>\n                        </defs>\n                        \n                        <!-- Background space -->\n                        <rect width=\"600\" height=\"600\" fill=\"#0a0e1a\"/>\n                        \n                        <!-- Stars background -->\n                        <g id=\"stars\"></g>\n                        \n                        <!-- Initial orbit (r1) -->\n                        <circle id=\"orbit1\" cx=\"300\" cy=\"300\" r=\"100\" fill=\"none\" stroke=\"#3b82f6\" stroke-width=\"2.5\" opacity=\"0.6\"/>\n                        \n                        <!-- Final orbit (r2) -->\n                        <circle id=\"orbit2\" cx=\"300\" cy=\"300\" r=\"200\" fill=\"none\" stroke=\"#10b981\" stroke-width=\"2.5\" opacity=\"0.6\"/>\n                        \n                        <!-- Transfer orbit (ellipse) -->\n                        <ellipse id=\"transferOrbit\" cx=\"300\" cy=\"300\" rx=\"150\" ry=\"150\" fill=\"none\" stroke=\"#a855f7\" stroke-width=\"2.5\" stroke-dasharray=\"5,5\" opacity=\"0.8\"/>\n                        \n                        <!-- Central body -->\n                        <circle cx=\"300\" cy=\"300\" r=\"20\" fill=\"url(#starGlow)\" filter=\"url(#glow)\"/>\n                        \n                        <!-- Satellite -->\n                        <g id=\"satellite\">\n                            <circle cx=\"0\" cy=\"0\" r=\"10\" fill=\"url(#satelliteGlow)\" filter=\"url(#glow)\"/>\n                            <circle cx=\"0\" cy=\"0\" r=\"6\" fill=\"#3b82f6\"/>\n                        </g>\n                        \n                        <!-- Burn markers -->\n                        <g id=\"burn1Marker\" style=\"display: none;\">\n                            <circle cx=\"0\" cy=\"0\" r=\"8\" fill=\"none\" stroke=\"#ef4444\" stroke-width=\"2\"/>\n                            <line x1=\"0\" y1=\"0\" x2=\"0\" y2=\"0\" stroke=\"#ef4444\" stroke-width=\"3\" marker-end=\"url(#burnArrow)\"/>\n                            <text x=\"0\" y=\"0\" fill=\"#ef4444\" font-size=\"12\" font-weight=\"bold\">ΔV₁</text>\n                        </g>\n                        \n                        <g id=\"burn2Marker\" style=\"display: none;\">\n                            <circle cx=\"0\" cy=\"0\" r=\"8\" fill=\"none\" stroke=\"#ef4444\" stroke-width=\"2\"/>\n                            <line x1=\"0\" y1=\"0\" x2=\"0\" y2=\"0\" stroke=\"#ef4444\" stroke-width=\"3\" marker-end=\"url(#burnArrow)\"/>\n                            <text x=\"0\" y=\"0\" fill=\"#ef4444\" font-size=\"12\" font-weight=\"bold\">ΔV₂</text>\n                        </g>\n                        \n                        <!-- Labels -->\n                        <text id=\"r1Label\" x=\"410\" y=\"300\" fill=\"#3b82f6\" font-size=\"14\" font-weight=\"bold\">r₁</text>\n                        <text id=\"r2Label\" x=\"510\" y=\"300\" fill=\"#10b981\" font-size=\"14\" font-weight=\"bold\">r₂</text>\n                        \n                        <!-- Phase indicator -->\n                        <text id=\"phaseText\" x=\"300\" y=\"40\" fill=\"#94a3b8\" font-size=\"16\" text-anchor=\"middle\" font-weight=\"bold\">\n                            Phase: Initial Orbit\n                        </text>\n                    </svg>\n                    \n                    <!-- Legend -->\n                    <div class=\"legend\">\n                        <div class=\"legend-item\">\n                            <div class=\"legend-color\" style=\"background: #3b82f6;\"></div>\n                            <span>Initial Orbit (r₁)</span>\n                        </div>\n                        <div class=\"legend-item\">\n                            <div class=\"legend-color\" style=\"background: #10b981;\"></div>\n                            <span>Final Orbit (r₂)</span>\n                        </div>\n                        <div class=\"legend-item\">\n                            <div class=\"legend-color\" style=\"background: #a855f7;\"></div>\n                            <span>Transfer Orbit</span>\n                        </div>\n                        <div class=\"legend-item\">\n                            <div class=\"legend-color\" style=\"background: #ef4444;\"></div>\n                            <span>Burn Impulses</span>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Controls -->\n                <div class=\"controls-section\">\n                    <h2>Transfer Parameters</h2>\n                    \n                    <!-- Gravitational Parameter -->\n                    <div class=\"control-group\">\n                        <label>Gravitational Parameter (μ): <span id=\"muValue\">3.99e14</span> m³/s²</label>\n                        <input type=\"range\" id=\"muSlider\" min=\"11\" max=\"15\" step=\"0.01\" value=\"14.6\">\n                        <div class=\"slider-labels\">\n                            <span>10¹¹</span>\n                            <span>10¹³</span>\n                            <span>10¹⁵</span>\n                        </div>\n                        <div class=\"preset-buttons\">\n                            <button class=\"preset-btn\" data-mu=\"3.986e14\">Earth</button>\n                            <button class=\"preset-btn\" data-mu=\"4.283e13\">Mars</button>\n                            <button class=\"preset-btn\" data-mu=\"1.327e20\">Sun</button>\n                        </div>\n                    </div>\n\n                    <!-- Initial Radius -->\n                    <div class=\"control-group\">\n                        <label>Initial Radius (r₁): <span id=\"r1Value\">6.78e6</span> m</label>\n                        <input type=\"range\" id=\"r1Slider\" min=\"6\" max=\"9\" step=\"0.01\" value=\"6.83\">\n                        <div class=\"slider-labels\">\n                            <span>10⁶</span>\n                            <span>10⁷·⁵</span>\n                            <span>10⁹</span>\n                        </div>\n                    </div>\n\n                    <!-- Final Radius -->\n                    <div class=\"control-group\">\n                        <label>Final Radius (r₂): <span id=\"r2Value\">4.22e7</span> m</label>\n                        <input type=\"range\" id=\"r2Slider\" min=\"6\" max=\"9\" step=\"0.01\" value=\"7.625\">\n                        <div class=\"slider-labels\">\n                            <span>10⁶</span>\n                            <span>10⁷·⁵</span>\n                            <span>10⁹</span>\n                        </div>\n                        <div class=\"preset-buttons\">\n                            <button class=\"preset-btn-transfer\" data-r1=\"6.78e6\" data-r2=\"4.22e7\">LEO to GEO</button>\n                            <button class=\"preset-btn-transfer\" data-r1=\"6.78e6\" data-r2=\"3.844e8\">LEO to Moon</button>\n                        </div>\n                    </div>\n\n                    <!-- Animation Speed -->\n                    <div class=\"control-group\">\n                        <label>Animation Speed: <span id=\"speedValue\">1.0</span>x</label>\n                        <input type=\"range\" id=\"speedSlider\" min=\"0.1\" max=\"3\" step=\"0.1\" value=\"1\">\n                        <div class=\"slider-labels\">\n                            <span>0.1x</span>\n                            <span>1.5x</span>\n                            <span>3x</span>\n                        </div>\n                    </div>\n\n                    <!-- Results -->\n                    <div class=\"results-box\">\n                        <h3>Delta-V Budget</h3>\n                        <div class=\"result-item\">\n                            <span>First Burn (ΔV₁):</span>\n                            <span id=\"dv1Result\" class=\"result-value\">2428 m/s</span>\n                        </div>\n                        <div class=\"result-item\">\n                            <span>Second Burn (ΔV₂):</span>\n                            <span id=\"dv2Result\" class=\"result-value\">1469 m/s</span>\n                        </div>\n                        <div class=\"result-item result-highlight\">\n                            <span>Total ΔV:</span>\n                            <span id=\"dvTotalResult\" class=\"result-value-large\">3897 m/s</span>\n                        </div>\n                        <div class=\"result-item\">\n                            <span>Transfer Time:</span>\n                            <span id=\"transferTime\">5h 15m 44s</span>\n                        </div>\n                    </div>\n\n                    <!-- Additional Info -->\n                    <div class=\"info-panel\">\n                        <h4>Orbit Details</h4>\n                        <div class=\"info-item\">\n                            <span>Initial Speed (v₁):</span>\n                            <span id=\"v1Info\">7668 m/s</span>\n                        </div>\n                        <div class=\"info-item\">\n                            <span>Final Speed (v₂):</span>\n                            <span id=\"v2Info\">3075 m/s</span>\n                        </div>\n                        <div class=\"info-item\">\n                            <span>Semi-major Axis (a):</span>\n                            <span id=\"smaInfo\">2.45e7 m</span>\n                        </div>\n                    </div>\n\n                    <!-- Animation Controls -->\n                    <div class=\"button-group\">\n                        <button id=\"playPauseBtn\" class=\"btn btn-primary\">Pause</button>\n                        <button id=\"resetBtn\" class=\"btn btn-secondary\">Reset</button>\n                    </div>\n\n                    <!-- Info -->\n                    <div class=\"info-box\">\n                        <h4>About Hohmann Transfer</h4>\n                        <p>The Hohmann transfer is the most fuel-efficient way to move between two circular coplanar orbits. It requires two engine burns: one to enter the elliptical transfer orbit, and another to circularize at the destination.</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Physics Information -->\n        <div class=\"physics-info\">\n            <h3>Astrodynamics Concepts</h3>\n            <div class=\"concepts-grid\">\n                <div class=\"concept-card concept-blue\">\n                    <h4>Coplanar Orbits</h4>\n                    <p>Both initial and final orbits lie in the same plane, eliminating the need for plane-change maneuvers which are extremely costly in terms of delta-v.</p>\n                </div>\n                <div class=\"concept-card concept-green\">\n                    <h4>Impulsive Maneuvers</h4>\n                    <p>The Hohmann transfer assumes instantaneous velocity changes (impulses). Real burns take time but this approximation is valid for high thrust-to-weight ratios.</p>\n                </div>\n                <div class=\"concept-card concept-purple\">\n                    <h4>Energy Efficiency</h4>\n                    <p>The Hohmann transfer is optimal for transferring between circular orbits when the radius ratio is less than about 15.6. For larger ratios, bi-elliptic transfers become more efficient.</p>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    background: linear-gradient(135deg, #0a0e1a 0%, #1a1f35 100%);\n    min-height: 100vh;\n    padding: 2rem;\n}\n\n.container {\n    max-width: 1500px;\n    margin: 0 auto;\n}\n\n.main-card {\n    background: linear-gradient(135deg, #1e293b 0%, #334155 100%);\n    border-radius: 1rem;\n    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);\n    padding: 2rem;\n    margin-bottom: 1.5rem;\n    border: 1px solid rgba(148, 163, 184, 0.1);\n}\n\n.header {\n    text-align: center;\n    margin-bottom: 2rem;\n}\n\n.header h1 {\n    font-size: 2.5rem;\n    color: #f1f5f9;\n    margin-bottom: 0.5rem;\n    text-shadow: 0 0 20px rgba(168, 85, 247, 0.5);\n}\n\n.subtitle {\n    color: #94a3b8;\n    font-size: 1rem;\n}\n\n.formulas {\n    margin-top: 1rem;\n    display: flex;\n    gap: 1rem;\n    justify-content: center;\n    flex-wrap: wrap;\n}\n\n.formula {\n    color: #cbd5e1;\n    font-size: 0.75rem;\n    font-family: 'Courier New', monospace;\n    background: rgba(15, 23, 42, 0.5);\n    padding: 0.5rem 1rem;\n    border-radius: 0.5rem;\n    border: 1px solid rgba(148, 163, 184, 0.2);\n}\n\n.content-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 2rem;\n}\n\n@media (max-width: 1200px) {\n    .content-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n.visualization-section {\n    background: rgba(10, 14, 26, 0.5);\n    border-radius: 0.75rem;\n    padding: 1.5rem;\n    border: 1px solid rgba(148, 163, 184, 0.1);\n}\n\n.visualization-section h2,\n.controls-section h2 {\n    font-size: 1.25rem;\n    color: #f1f5f9;\n    margin-bottom: 1rem;\n}\n\n#transferCanvas {\n    display: block;\n    margin: 0 auto;\n    border-radius: 0.5rem;\n}\n\n.legend {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 0.75rem;\n    margin-top: 1rem;\n    font-size: 0.875rem;\n}\n\n.legend-item {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    color: #cbd5e1;\n}\n\n.legend-color {\n    width: 1rem;\n    height: 1rem;\n    border-radius: 0.25rem;\n}\n\n.controls-section h2 {\n    margin-bottom: 1.5rem;\n}\n\n.control-group {\n    margin-bottom: 1.5rem;\n}\n\n.control-group label {\n    display: block;\n    font-size: 0.875rem;\n    font-weight: 500;\n    color: #e2e8f0;\n    margin-bottom: 0.5rem;\n}\n\n.control-group input[type=\"range\"] {\n    width: 100%;\n    height: 0.5rem;\n    background: rgba(71, 85, 105, 0.5);\n    border-radius: 0.5rem;\n    outline: none;\n    -webkit-appearance: none;\n    appearance: none;\n}\n\n.control-group input[type=\"range\"]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 1.25rem;\n    height: 1.25rem;\n    background: #a855f7;\n    border-radius: 50%;\n    cursor: pointer;\n    box-shadow: 0 0 10px rgba(168, 85, 247, 0.5);\n}\n\n.control-group input[type=\"range\"]::-moz-range-thumb {\n    width: 1.25rem;\n    height: 1.25rem;\n    background: #a855f7;\n    border-radius: 50%;\n    cursor: pointer;\n    border: none;\n    box-shadow: 0 0 10px rgba(168, 85, 247, 0.5);\n}\n\n.slider-labels {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.75rem;\n    color: #94a3b8;\n    margin-top: 0.25rem;\n}\n\n.preset-buttons {\n    display: flex;\n    gap: 0.5rem;\n    margin-top: 0.5rem;\n}\n\n.preset-btn,\n.preset-btn-transfer {\n    flex: 1;\n    padding: 0.4rem 0.8rem;\n    font-size: 0.75rem;\n    font-weight: 500;\n    background: rgba(168, 85, 247, 0.2);\n    color: #c4b5fd;\n    border: 1px solid rgba(168, 85, 247, 0.3);\n    border-radius: 0.375rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.preset-btn:hover,\n.preset-btn-transfer:hover {\n    background: rgba(168, 85, 247, 0.3);\n    border-color: rgba(168, 85, 247, 0.5);\n}\n\n.results-box {\n    background: linear-gradient(135deg, rgba(168, 85, 247, 0.15) 0%, rgba(147, 51, 234, 0.15) 100%);\n    border-radius: 0.75rem;\n    padding: 1.5rem;\n    margin-bottom: 1.5rem;\n    border: 1px solid rgba(168, 85, 247, 0.3);\n}\n\n.results-box h3 {\n    font-size: 1.125rem;\n    color: #f1f5f9;\n    margin-bottom: 0.75rem;\n}\n\n.result-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 0.5rem;\n    color: #cbd5e1;\n    font-size: 0.875rem;\n}\n\n.result-highlight {\n    margin-top: 0.75rem;\n    padding-top: 0.75rem;\n    border-top: 1px solid rgba(168, 85, 247, 0.3);\n}\n\n.result-value {\n    font-family: 'Courier New', monospace;\n    font-weight: bold;\n    color: #c4b5fd;\n    font-size: 1rem;\n}\n\n.result-value-large {\n    font-family: 'Courier New', monospace;\n    font-weight: bold;\n    color: #a855f7;\n    font-size: 1.25rem;\n}\n\n.info-panel {\n    background: rgba(59, 130, 246, 0.1);\n    border-radius: 0.75rem;\n    padding: 1rem;\n    margin-bottom: 1.5rem;\n    border: 1px solid rgba(59, 130, 246, 0.2);\n}\n\n.info-panel h4 {\n    font-size: 0.875rem;\n    color: #f1f5f9;\n    margin-bottom: 0.5rem;\n    font-weight: 600;\n}\n\n.info-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 0.25rem;\n    color: #cbd5e1;\n    font-size: 0.75rem;\n}\n\n.info-item span:last-child {\n    font-family: 'Courier New', monospace;\n    color: #93c5fd;\n}\n\n.button-group {\n    display: flex;\n    gap: 0.75rem;\n    margin-bottom: 1.5rem;\n}\n\n.btn {\n    flex: 1;\n    padding: 0.75rem 1.5rem;\n    font-size: 1rem;\n    font-weight: 600;\n    border: none;\n    border-radius: 0.5rem;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n\n.btn-primary {\n    background: #a855f7;\n    color: white;\n    box-shadow: 0 0 20px rgba(168, 85, 247, 0.3);\n}\n\n.btn-primary:hover {\n    background: #9333ea;\n    box-shadow: 0 0 25px rgba(168, 85, 247, 0.5);\n}\n\n.btn-secondary {\n    background: #64748b;\n    color: white;\n}\n\n.btn-secondary:hover {\n    background: #475569;\n}\n\n.info-box {\n    background: rgba(245, 158, 11, 0.1);\n    border: 1px solid rgba(245, 158, 11, 0.3);\n    border-radius: 0.5rem;\n    padding: 1rem;\n}\n\n.info-box h4 {\n    color: #fbbf24;\n    font-size: 0.875rem;\n    font-weight: 600;\n    margin-bottom: 0.5rem;\n}\n\n.info-box p {\n    color: #fcd34d;\n    font-size: 0.875rem;\n    line-height: 1.5;\n}\n\n.physics-info {\n    background: linear-gradient(135deg, #1e293b 0%, #334155 100%);\n    border-radius: 0.75rem;\n    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);\n    padding: 1.5rem;\n    border: 1px solid rgba(148, 163, 184, 0.1);\n}\n\n.physics-info h3 {\n    font-size: 1.25rem;\n    color: #f1f5f9;\n    margin-bottom: 0.75rem;\n}\n\n.concepts-grid {\n    display: grid;\n    grid-template-columns: repeat(3, 1fr);\n    gap: 1rem;\n}\n\n@media (max-width: 768px) {\n    .concepts-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n.concept-card {\n    border-radius: 0.5rem;\n    padding: 1rem;\n    border: 1px solid;\n}\n\n.concept-card h4 {\n    font-size: 0.875rem;\n    font-weight: 600;\n    margin-bottom: 0.5rem;\n}\n\n.concept-card p {\n    font-size: 0.875rem;\n    line-height: 1.5;\n}\n\n.concept-blue {\n    background: rgba(59, 130, 246, 0.1);\n    border-color: rgba(59, 130, 246, 0.3);\n}\n\n.concept-blue h4 {\n    color: #60a5fa;\n}\n\n.concept-blue p {\n    color: #93c5fd;\n}\n\n.concept-green {\n    background: rgba(16, 185, 129, 0.1);\n    border-color: rgba(16, 185, 129, 0.3);\n}\n\n.concept-green h4 {\n    color: #34d399;\n}\n\n.concept-green p {\n    color: #6ee7b7;\n}\n\n.concept-purple {\n    background: rgba(168, 85, 247, 0.1);\n    border-color: rgba(168, 85, 247, 0.3);\n}\n\n.concept-purple h4 {\n    color: #a78bfa;\n}\n\n.concept-purple p {\n    color: #c4b5fd;\n}", "js": "// State variables\nlet mu = 3.986e14; // Earth's gravitational parameter\nlet r1 = 6.78e6;   // Initial radius (LEO)\nlet r2 = 4.22e7;   // Final radius (GEO)\nlet v1, v2, a, vtp, vta, dV1, dV2, dVtot;\nlet transferTime = 0;\n\nlet isAnimating = true;\nlet animationSpeed = 1;\nlet phase = 0; // 0: initial orbit, 1: transfer orbit, 2: final orbit\nlet orbitAngle = 0;\nlet lastTime = Date.now();\nlet animationFrame = null;\n\n// DOM elements\nconst muSlider = document.getElementById('muSlider');\nconst r1Slider = document.getElementById('r1Slider');\nconst r2Slider = document.getElementById('r2Slider');\nconst speedSlider = document.getElementById('speedSlider');\nconst muValue = document.getElementById('muValue');\nconst r1Value = document.getElementById('r1Value');\nconst r2Value = document.getElementById('r2Value');\nconst speedValue = document.getElementById('speedValue');\nconst dv1Result = document.getElementById('dv1Result');\nconst dv2Result = document.getElementById('dv2Result');\nconst dvTotalResult = document.getElementById('dvTotalResult');\nconst transferTimeEl = document.getElementById('transferTime');\nconst v1Info = document.getElementById('v1Info');\nconst v2Info = document.getElementById('v2Info');\nconst smaInfo = document.getElementById('smaInfo');\nconst playPauseBtn = document.getElementById('playPauseBtn');\nconst resetBtn = document.getElementById('resetBtn');\nconst phaseText = document.getElementById('phaseText');\n\n// SVG elements\nconst orbit1 = document.getElementById('orbit1');\nconst orbit2 = document.getElementById('orbit2');\nconst transferOrbit = document.getElementById('transferOrbit');\nconst satellite = document.getElementById('satellite');\nconst burn1Marker = document.getElementById('burn1Marker');\nconst burn2Marker = document.getElementById('burn2Marker');\nconst r1Label = document.getElementById('r1Label');\nconst r2Label = document.getElementById('r2Label');\n\n// Constants\nconst CENTER_X = 300;\nconst CENTER_Y = 300;\nconst SCALE = 100; // Base scale for visual representation\n\n// Generate stars background\nfunction generateStars() {\n    const starsGroup = document.getElementById('stars');\n    for (let i = 0; i < 150; i++) {\n        const star = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n        star.setAttribute('cx', Math.random() * 600);\n        star.setAttribute('cy', Math.random() * 600);\n        star.setAttribute('r', Math.random() * 1.5);\n        star.setAttribute('fill', '#ffffff');\n        star.setAttribute('opacity', Math.random() * 0.7 + 0.3);\n        starsGroup.appendChild(star);\n    }\n}\n\n// Format time in readable format\nfunction formatTime(seconds) {\n    if (seconds < 60) {\n        return `${seconds.toFixed(1)}s`;\n    } else if (seconds < 3600) {\n        const mins = Math.floor(seconds / 60);\n        const secs = Math.floor(seconds % 60);\n        return `${mins}m ${secs}s`;\n    } else if (seconds < 86400) {\n        const hours = Math.floor(seconds / 3600);\n        const mins = Math.floor((seconds % 3600) / 60);\n        const secs = Math.floor(seconds % 60);\n        return `${hours}h ${mins}m ${secs}s`;\n    } else {\n        const days = Math.floor(seconds / 86400);\n        const hours = Math.floor((seconds % 86400) / 3600);\n        return `${days}d ${hours}h`;\n    }\n}\n\n// Format scientific notation\nfunction formatScientific(value, decimals = 2) {\n    if (value === 0) return '0';\n    const exponent = Math.floor(Math.log10(Math.abs(value)));\n    const mantissa = value / Math.pow(10, exponent);\n    return `${mantissa.toFixed(decimals)}e${exponent}`;\n}\n\n// Calculate transfer parameters\nfunction calculateTransfer() {\n    if (r1 > 0 && r2 > 0 && mu > 0) {\n        // Circular orbit velocities\n        v1 = Math.sqrt(mu / r1);\n        v2 = Math.sqrt(mu / r2);\n        \n        // Semi-major axis of transfer orbit\n        a = 0.5 * (r1 + r2);\n        \n        // Transfer orbit velocities at perigee and apogee\n        vtp = Math.sqrt(mu * (2 / r1 - 1 / a));\n        vta = Math.sqrt(mu * (2 / r2 - 1 / a));\n        \n        // Delta-V calculations\n        dV1 = vtp - v1;\n        dV2 = v2 - vta;\n        dVtot = Math.abs(dV1) + Math.abs(dV2);\n        \n        // Transfer time (half orbital period of transfer ellipse)\n        transferTime = Math.PI * Math.sqrt(Math.pow(a, 3) / mu);\n    } else {\n        v1 = v2 = a = vtp = vta = dV1 = dV2 = dVtot = transferTime = 0;\n    }\n    updateResults();\n    updateVisualization();\n}\n\n// Update results display\nfunction updateResults() {\n    dv1Result.textContent = `${Math.round(Math.abs(dV1))} m/s`;\n    dv2Result.textContent = `${Math.round(Math.abs(dV2))} m/s`;\n    dvTotalResult.textContent = `${Math.round(dVtot)} m/s`;\n    transferTimeEl.textContent = formatTime(transferTime);\n    \n    v1Info.textContent = `${Math.round(v1)} m/s`;\n    v2Info.textContent = `${Math.round(v2)} m/s`;\n    smaInfo.textContent = formatScientific(a);\n}\n\n// Update visualization\nfunction updateVisualization() {\n    // Scale radii for display (logarithmic-like scaling for better visualization)\n    const minRadius = 50;\n    const maxRadius = 250;\n    const ratio = r2 / r1;\n    \n    let displayR1, displayR2;\n    \n    if (ratio > 1) {\n        // r2 is larger\n        displayR2 = maxRadius;\n        displayR1 = Math.max(minRadius, maxRadius / Math.pow(ratio, 0.5));\n    } else {\n        // r1 is larger\n        displayR1 = maxRadius;\n        displayR2 = Math.max(minRadius, maxRadius * Math.pow(ratio, 0.5));\n    }\n    \n    // Update orbit circles\n    orbit1.setAttribute('r', displayR1);\n    orbit2.setAttribute('r', displayR2);\n    \n    // Update transfer ellipse\n    const semiMajor = (displayR1 + displayR2) / 2;\n    const semiMinor = Math.sqrt(displayR1 * displayR2);\n    \n    if (r2 > r1) {\n        transferOrbit.setAttribute('rx', semiMajor);\n        transferOrbit.setAttribute('ry', semiMinor);\n        transferOrbit.setAttribute('transform', `rotate(0 ${CENTER_X} ${CENTER_Y})`);\n    } else {\n        transferOrbit.setAttribute('rx', semiMinor);\n        transferOrbit.setAttribute('ry', semiMajor);\n        transferOrbit.setAttribute('transform', `rotate(90 ${CENTER_X} ${CENTER_Y})`);\n    }\n    \n    // Update labels\n    r1Label.setAttribute('x', CENTER_X + displayR1 + 10);\n    r2Label.setAttribute('x', CENTER_X + displayR2 + 10);\n    \n    // Store display radii for animation\n    window.displayR1 = displayR1;\n    window.displayR2 = displayR2;\n}\n\n// Update satellite position based on phase\nfunction updateSatellitePosition() {\n    let x, y;\n    \n    if (phase === 0) {\n        // Initial circular orbit\n        x = CENTER_X + window.displayR1 * Math.cos(orbitAngle);\n        y = CENTER_Y + window.displayR1 * Math.sin(orbitAngle);\n        phaseText.textContent = 'Phase: Initial Orbit';\n        burn1Marker.style.display = 'none';\n        burn2Marker.style.display = 'none';\n    } else if (phase === 1) {\n        // Transfer orbit (elliptical)\n        const semiMajor = (window.displayR1 + window.displayR2) / 2;\n        const semiMinor = Math.sqrt(window.displayR1 * window.displayR2);\n        \n        if (r2 > r1) {\n            x = CENTER_X + (semiMajor * Math.cos(orbitAngle) - (semiMajor - window.displayR1));\n            y = CENTER_Y + semiMinor * Math.sin(orbitAngle);\n        } else {\n            x = CENTER_X + semiMinor * Math.cos(orbitAngle);\n            y = CENTER_Y + (semiMajor * Math.sin(orbitAngle) - (semiMajor - window.displayR1));\n        }\n        \n        phaseText.textContent = 'Phase: Transfer Orbit';\n        \n        // Show burn markers\n        if (orbitAngle < 0.2) {\n            burn1Marker.style.display = 'block';\n            const burn1X = CENTER_X + window.displayR1;\n            const burn1Y = CENTER_Y;\n            burn1Marker.setAttribute('transform', `translate(${burn1X}, ${burn1Y})`);\n            burn1Marker.querySelector('line').setAttribute('x2', 35);\n            burn1Marker.querySelector('text').setAttribute('x', 40);\n            burn1Marker.querySelector('text').setAttribute('y', 5);\n        } else {\n            burn1Marker.style.display = 'none';\n        }\n        \n        if (orbitAngle > Math.PI - 0.2 && orbitAngle < Math.PI + 0.2) {\n            burn2Marker.style.display = 'block';\n            const burn2X = CENTER_X - window.displayR2;\n            const burn2Y = CENTER_Y;\n            burn2Marker.setAttribute('transform', `translate(${burn2X}, ${burn2Y})`);\n            burn2Marker.querySelector('line').setAttribute('x2', -35);\n            burn2Marker.querySelector('text').setAttribute('x', -40);\n            burn2Marker.querySelector('text').setAttribute('y', 5);\n            burn2Marker.querySelector('text').setAttribute('text-anchor', 'end');\n        } else {\n            burn2Marker.style.display = 'none';\n        }\n    } else {\n        // Final circular orbit\n        x = CENTER_X + window.displayR2 * Math.cos(orbitAngle);\n        y = CENTER_Y + window.displayR2 * Math.sin(orbitAngle);\n        phaseText.textContent = 'Phase: Final Orbit';\n        burn1Marker.style.display = 'none';\n        burn2Marker.style.display = 'none';\n    }\n    \n    satellite.setAttribute('transform', `translate(${x}, ${y})`);\n}\n\n// Animation loop\nfunction animate() {\n    if (!isAnimating) return;\n    \n    const now = Date.now();\n    const dt = (now - lastTime) / 1000;\n    lastTime = now;\n    \n    // Angular velocity for visual purposes\n    const baseAngularVel = 0.5; // radians per second\n    const angularVel = baseAngularVel * animationSpeed;\n    \n    orbitAngle += angularVel * dt;\n    \n    // Phase transitions\n    if (phase === 0 && orbitAngle >= 2 * Math.PI) {\n        phase = 1;\n        orbitAngle = 0;\n    } else if (phase === 1 && orbitAngle >= Math.PI) {\n        phase = 2;\n        orbitAngle = 0;\n    } else if (phase === 2 && orbitAngle >= 2 * Math.PI) {\n        phase = 0;\n        orbitAngle = 0;\n    }\n    \n    updateSatellitePosition();\n    \n    animationFrame = requestAnimationFrame(animate);\n}\n\n// Event listeners\nmuSlider.addEventListener('input', (e) => {\n    const exponent = parseFloat(e.target.value);\n    mu = Math.pow(10, exponent);\n    muValue.textContent = formatScientific(mu);\n    calculateTransfer();\n});\n\nr1Slider.addEventListener('input', (e) => {\n    const exponent = parseFloat(e.target.value);\n    r1 = Math.pow(10, exponent);\n    r1Value.textContent = formatScientific(r1);\n    calculateTransfer();\n});\n\nr2Slider.addEventListener('input', (e) => {\n    const exponent = parseFloat(e.target.value);\n    r2 = Math.pow(10, exponent);\n    r2Value.textContent = formatScientific(r2);\n    calculateTransfer();\n});\n\nspeedSlider.addEventListener('input', (e) => {\n    animationSpeed = parseFloat(e.target.value);\n    speedValue.textContent = animationSpeed.toFixed(1);\n});\n\n// Preset buttons\ndocument.querySelectorAll('.preset-btn[data-mu]').forEach(btn => {\n    btn.addEventListener('click', () => {\n        mu = parseFloat(btn.dataset.mu);\n        const exponent = Math.log10(mu);\n        muSlider.value = exponent;\n        muValue.textContent = formatScientific(mu);\n        calculateTransfer();\n    });\n});\n\ndocument.querySelectorAll('.preset-btn-transfer').forEach(btn => {\n    btn.addEventListener('click', () => {\n        r1 = parseFloat(btn.dataset.r1);\n        r2 = parseFloat(btn.dataset.r2);\n        \n        const exp1 = Math.log10(r1);\n        const exp2 = Math.log10(r2);\n        \n        r1Slider.value = exp1;\n        r2Slider.value = exp2;\n        \n        r1Value.textContent = formatScientific(r1);\n        r2Value.textContent = formatScientific(r2);\n        \n        calculateTransfer();\n    });\n});\n\nplayPauseBtn.addEventListener('click', () => {\n    if (isAnimating) {\n        isAnimating = false;\n        playPauseBtn.textContent = 'Play';\n        if (animationFrame) {\n            cancelAnimationFrame(animationFrame);\n        }\n    } else {\n        isAnimating = true;\n        playPauseBtn.textContent = 'Pause';\n        lastTime = Date.now();\n        animate();\n    }\n});\n\nresetBtn.addEventListener('click', () => {\n    phase = 0;\n    orbitAngle = 0;\n    lastTime = Date.now();\n    updateSatellitePosition();\n});\n\n// Initialize\ngenerateStars();\ncalculateTransfer();\nanimate();"}}
{"input": {"input_text": "Rocket equation: deltaV = Isp*g0*ln(m0/mf). Compute deltaV for given masses and specific impulse.", "simulation_name": " Tsiolkovsky Rocket", "domain": "Astrodynamics", "description": "Ideal rocket equation", "assumptions": ["Constant Isp", "No gravity drag"], "entities": [], "constants": [{"name": "g0", "symbol": "g0", "value": 9.81, "unit": "m/s^2"}], "parameters": [{"name": "specific_impulse", "symbol": "Isp", "unit": "s", "range": [50, 450]}, {"name": "initial_mass", "symbol": "m0", "unit": "kg", "range": [10, 1000000.0]}, {"name": "final_mass", "symbol": "mf", "unit": "kg", "range": [1, 1000000.0]}], "equations": [{"description": "DeltaV", "condition": "m0>mf", "expression": "dV = Isp*g0*ln(m0/mf)"}], "initial_conditions": {}, "outputs": ["dV"], "simulation_controls": ["Isp", "m0", "mf"], "constraints": ["m0>mf>0", "Isp>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S40 Tsiolkovsky Rocket Equation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"main-card\">\n            <!-- Header -->\n            <div class=\"header\">\n                <h1>S40 Tsiolkovsky Rocket Equation</h1>\n                <p class=\"subtitle\">Ideal Rocket Equation Calculator</p>\n                <div class=\"formulas\">\n                    <p class=\"formula\">ΔV = Isp × g₀ × ln(m₀/mf)</p>\n                    <p class=\"formula-const\">g₀ = 9.81 m/s²</p>\n                </div>\n            </div>\n\n            <div class=\"content-grid\">\n                <!-- Visualization -->\n                <div class=\"visualization-section\">\n                    <h2>Rocket Mass Visualization</h2>\n                    <svg id=\"rocketCanvas\" width=\"550\" height=\"600\">\n                        <!-- Background -->\n                        <defs>\n                            <linearGradient id=\"skyGradient\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n                                <stop offset=\"0%\" style=\"stop-color:#1e3a8a;stop-opacity:1\" />\n                                <stop offset=\"100%\" style=\"stop-color:#3b82f6;stop-opacity:1\" />\n                            </linearGradient>\n                            <linearGradient id=\"rocketGradient\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n                                <stop offset=\"0%\" style=\"stop-color:#f3f4f6;stop-opacity:1\" />\n                                <stop offset=\"100%\" style=\"stop-color:#9ca3af;stop-opacity:1\" />\n                            </linearGradient>\n                            <linearGradient id=\"fuelGradient\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n                                <stop offset=\"0%\" style=\"stop-color:#fbbf24;stop-opacity:0.9\" />\n                                <stop offset=\"100%\" style=\"stop-color:#f59e0b;stop-opacity:0.9\" />\n                            </linearGradient>\n                            <linearGradient id=\"payloadGradient\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n                                <stop offset=\"0%\" style=\"stop-color:#60a5fa;stop-opacity:1\" />\n                                <stop offset=\"100%\" style=\"stop-color:#3b82f6;stop-opacity:1\" />\n                            </linearGradient>\n                            <radialGradient id=\"flameGradient\">\n                                <stop offset=\"0%\" style=\"stop-color:#fef3c7;stop-opacity:1\" />\n                                <stop offset=\"30%\" style=\"stop-color:#fbbf24;stop-opacity:0.9\" />\n                                <stop offset=\"60%\" style=\"stop-color:#f97316;stop-opacity:0.7\" />\n                                <stop offset=\"100%\" style=\"stop-color:#ef4444;stop-opacity:0.3\" />\n                            </radialGradient>\n                        </defs>\n                        \n                        <!-- Sky background -->\n                        <rect width=\"550\" height=\"600\" fill=\"url(#skyGradient)\"/>\n                        \n                        <!-- Ground -->\n                        <rect y=\"500\" width=\"550\" height=\"100\" fill=\"#059669\" opacity=\"0.3\"/>\n                        <line x1=\"0\" y1=\"500\" x2=\"550\" y2=\"500\" stroke=\"#047857\" stroke-width=\"3\"/>\n                        \n                        <!-- Launch pad -->\n                        <rect x=\"200\" y=\"480\" width=\"150\" height=\"20\" fill=\"#374151\" rx=\"2\"/>\n                        <rect x=\"210\" y=\"470\" width=\"10\" height=\"30\" fill=\"#4b5563\"/>\n                        <rect x=\"330\" y=\"470\" width=\"10\" height=\"30\" fill=\"#4b5563\"/>\n                        \n                        <!-- Rocket body (container) -->\n                        <g id=\"rocketGroup\">\n                            <!-- Main body -->\n                            <rect id=\"rocketBody\" x=\"240\" y=\"200\" width=\"70\" height=\"280\" fill=\"url(#rocketGradient)\" stroke=\"#6b7280\" stroke-width=\"2\"/>\n                            \n                            <!-- Fuel tank (fills from bottom) -->\n                            <rect id=\"fuelTank\" x=\"245\" y=\"200\" width=\"60\" height=\"200\" fill=\"url(#fuelGradient)\" opacity=\"0.8\"/>\n                            \n                            <!-- Payload section -->\n                            <rect id=\"payloadSection\" x=\"245\" y=\"200\" width=\"60\" height=\"40\" fill=\"url(#payloadGradient)\"/>\n                            \n                            <!-- Nose cone -->\n                            <path d=\"M 240 200 L 275 150 L 310 200 Z\" fill=\"url(#rocketGradient)\" stroke=\"#6b7280\" stroke-width=\"2\"/>\n                            \n                            <!-- Fins -->\n                            <path d=\"M 240 450 L 220 480 L 240 480 Z\" fill=\"#4b5563\" stroke=\"#374151\" stroke-width=\"1.5\"/>\n                            <path d=\"M 310 450 L 330 480 L 310 480 Z\" fill=\"#4b5563\" stroke=\"#374151\" stroke-width=\"1.5\"/>\n                            \n                            <!-- Windows -->\n                            <circle cx=\"275\" cy=\"180\" r=\"8\" fill=\"#3b82f6\" opacity=\"0.6\" stroke=\"#1e40af\" stroke-width=\"2\"/>\n                            \n                            <!-- Engine nozzle -->\n                            <rect x=\"250\" y=\"480\" width=\"50\" height=\"15\" fill=\"#1f2937\"/>\n                            <path d=\"M 250 495 L 245 505 L 305 505 L 300 495 Z\" fill=\"#374151\"/>\n                            \n                            <!-- Flame effect -->\n                            <g id=\"flameEffect\">\n                                <ellipse cx=\"275\" cy=\"520\" rx=\"25\" ry=\"30\" fill=\"url(#flameGradient)\" opacity=\"0.8\">\n                                    <animate attributeName=\"ry\" values=\"30;40;30\" dur=\"0.3s\" repeatCount=\"indefinite\"/>\n                                    <animate attributeName=\"opacity\" values=\"0.8;1;0.8\" dur=\"0.3s\" repeatCount=\"indefinite\"/>\n                                </ellipse>\n                                <ellipse cx=\"275\" cy=\"535\" rx=\"20\" ry=\"25\" fill=\"#f97316\" opacity=\"0.6\">\n                                    <animate attributeName=\"ry\" values=\"25;35;25\" dur=\"0.4s\" repeatCount=\"indefinite\"/>\n                                </ellipse>\n                            </g>\n                        </g>\n                        \n                        <!-- Mass labels on rocket -->\n                        <text id=\"m0Label\" x=\"320\" y=\"350\" fill=\"#fbbf24\" font-size=\"14\" font-weight=\"bold\">m₀</text>\n                        <text id=\"mfLabel\" x=\"320\" y=\"220\" fill=\"#60a5fa\" font-size=\"14\" font-weight=\"bold\">mf</text>\n                        \n                        <!-- Info panel -->\n                        <g id=\"infoPanel\">\n                            <rect x=\"20\" y=\"20\" width=\"200\" height=\"120\" fill=\"rgba(15, 23, 42, 0.8)\" rx=\"8\" stroke=\"#475569\" stroke-width=\"2\"/>\n                            <text x=\"35\" y=\"45\" fill=\"#f1f5f9\" font-size=\"13\" font-weight=\"bold\">Mass Ratio</text>\n                            <text id=\"massRatioText\" x=\"35\" y=\"70\" fill=\"#fbbf24\" font-size=\"24\" font-weight=\"bold\">10.00</text>\n                            \n                            <text x=\"35\" y=\"95\" fill=\"#f1f5f9\" font-size=\"11\">Propellant Mass:</text>\n                            <text id=\"propellantMass\" x=\"35\" y=\"115\" fill=\"#f59e0b\" font-size=\"13\" font-weight=\"bold\">9000 kg</text>\n                        </g>\n                        \n                        <!-- Velocity arrow -->\n                        <defs>\n                            <marker id=\"velocityArrowHead\" markerWidth=\"10\" markerHeight=\"10\" refX=\"9\" refY=\"3\" orient=\"auto\">\n                                <polygon points=\"0 0, 10 3, 0 6\" fill=\"#10b981\" />\n                            </marker>\n                        </defs>\n                        <g id=\"velocityArrow\">\n                            <line x1=\"380\" y1=\"300\" x2=\"380\" y2=\"200\" stroke=\"#10b981\" stroke-width=\"4\" marker-end=\"url(#velocityArrowHead)\"/>\n                            <text x=\"390\" y=\"255\" fill=\"#10b981\" font-size=\"16\" font-weight=\"bold\">ΔV</text>\n                        </g>\n                    </svg>\n                    \n                    <!-- Legend -->\n                    <div class=\"legend\">\n                        <div class=\"legend-item\">\n                            <div class=\"legend-color\" style=\"background: linear-gradient(to bottom, #fbbf24, #f59e0b);\"></div>\n                            <span>Propellant (m₀ - mf)</span>\n                        </div>\n                        <div class=\"legend-item\">\n                            <div class=\"legend-color\" style=\"background: linear-gradient(to bottom, #60a5fa, #3b82f6);\"></div>\n                            <span>Dry Mass (mf)</span>\n                        </div>\n                        <div class=\"legend-item\">\n                            <div class=\"legend-color\" style=\"background: #10b981;\"></div>\n                            <span>Delta-V (ΔV)</span>\n                        </div>\n                        <div class=\"legend-item\">\n                            <div class=\"legend-color\" style=\"background: linear-gradient(135deg, #fef3c7, #f97316);\"></div>\n                            <span>Exhaust Plume</span>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Controls -->\n                <div class=\"controls-section\">\n                    <h2>Rocket Parameters</h2>\n                    \n                    <!-- Specific Impulse -->\n                    <div class=\"control-group\">\n                        <label>Specific Impulse (Isp): <span id=\"ispValue\">300</span> s</label>\n                        <input type=\"range\" id=\"ispSlider\" min=\"50\" max=\"450\" step=\"5\" value=\"300\">\n                        <div class=\"slider-labels\">\n                            <span>50</span>\n                            <span>250</span>\n                            <span>450</span>\n                        </div>\n                        <div class=\"preset-buttons\">\n                            <button class=\"preset-btn\" data-isp=\"250\">Solid</button>\n                            <button class=\"preset-btn\" data-isp=\"300\">RP-1/LOX</button>\n                            <button class=\"preset-btn\" data-isp=\"380\">LH2/LOX</button>\n                            <button class=\"preset-btn\" data-isp=\"450\">Ion</button>\n                        </div>\n                    </div>\n\n                    <!-- Initial Mass -->\n                    <div class=\"control-group\">\n                        <label>Initial Mass (m₀): <span id=\"m0Value\">10000</span> kg</label>\n                        <input type=\"range\" id=\"m0Slider\" min=\"1\" max=\"6\" step=\"0.01\" value=\"4\">\n                        <div class=\"slider-labels\">\n                            <span>10 kg</span>\n                            <span>10³ kg</span>\n                            <span>10⁶ kg</span>\n                        </div>\n                    </div>\n\n                    <!-- Final Mass -->\n                    <div class=\"control-group\">\n                        <label>Final Mass (mf): <span id=\"mfValue\">1000</span> kg</label>\n                        <input type=\"range\" id=\"mfSlider\" min=\"0\" max=\"6\" step=\"0.01\" value=\"3\">\n                        <div class=\"slider-labels\">\n                            <span>1 kg</span>\n                            <span>10³ kg</span>\n                            <span>10⁶ kg</span>\n                        </div>\n                    </div>\n\n                    <!-- Results -->\n                    <div class=\"results-box\">\n                        <h3>Rocket Equation Results</h3>\n                        <div class=\"result-item result-highlight\">\n                            <span>Delta-V (ΔV):</span>\n                            <span id=\"deltaVResult\" class=\"result-value-large\">6774 m/s</span>\n                        </div>\n                        <div class=\"result-item\">\n                            <span>Mass Ratio (m₀/mf):</span>\n                            <span id=\"massRatioResult\" class=\"result-value\">10.00</span>\n                        </div>\n                        <div class=\"result-item\">\n                            <span>Propellant Mass:</span>\n                            <span id=\"propMassResult\" class=\"result-value\">9000 kg</span>\n                        </div>\n                        <div class=\"result-item\">\n                            <span>Propellant Fraction:</span>\n                            <span id=\"propFractionResult\" class=\"result-value\">90.0%</span>\n                        </div>\n                    </div>\n\n                    <!-- Mission Examples -->\n                    <div class=\"mission-panel\">\n                        <h4>Mission Examples</h4>\n                        <button class=\"mission-btn\" data-dv=\"9400\">Low Earth Orbit</button>\n                        <button class=\"mission-btn\" data-dv=\"12500\">Escape Velocity</button>\n                        <button class=\"mission-btn\" data-dv=\"3200\">Lunar Landing</button>\n                        <button class=\"mission-btn\" data-dv=\"6000\">Mars Transfer</button>\n                        <p class=\"mission-info\" id=\"missionInfo\">Select a mission to see required ΔV</p>\n                    </div>\n\n                    <!-- Animation Controls -->\n                    <div class=\"button-group\">\n                        <button id=\"burnBtn\" class=\"btn btn-primary\">Ignition!</button>\n                        <button id=\"resetBtn\" class=\"btn btn-secondary\">Reset</button>\n                    </div>\n\n                    <!-- Info -->\n                    <div class=\"info-box\">\n                        <h4>Tsiolkovsky Rocket Equation</h4>\n                        <p>The ideal rocket equation relates the delta-v (change in velocity) a rocket can achieve to its mass ratio and specific impulse. It's fundamental to understanding rocket performance and mission planning.</p>\n                    </div>\n                    \n                    <div class=\"warning-box\" id=\"warningBox\" style=\"display: none;\">\n                        <h4>⚠ Warning</h4>\n                        <p id=\"warningText\">Final mass must be less than initial mass!</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Physics Information -->\n        <div class=\"physics-info\">\n            <h3>Rocket Equation Concepts</h3>\n            <div class=\"concepts-grid\">\n                <div class=\"concept-card concept-blue\">\n                    <h4>Specific Impulse (Isp)</h4>\n                    <p>A measure of rocket engine efficiency. Higher Isp means more velocity change per unit of propellant. Chemical rockets: 250-450s, Ion engines: 3000-10000s.</p>\n                </div>\n                <div class=\"concept-card concept-green\">\n                    <h4>Mass Ratio</h4>\n                    <p>The ratio of initial mass to final mass (m₀/mf). Exponentially affects delta-v. A mass ratio of 10 means 90% of the rocket is propellant.</p>\n                </div>\n                <div class=\"concept-card concept-purple\">\n                    <h4>Tyranny of the Rocket Equation</h4>\n                    <p>The logarithmic relationship means diminishing returns - doubling delta-v requires squaring the mass ratio. This makes high delta-v missions extremely challenging.</p>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%);\n    min-height: 100vh;\n    padding: 2rem;\n}\n\n.container {\n    max-width: 1500px;\n    margin: 0 auto;\n}\n\n.main-card {\n    background: linear-gradient(135deg, #1e293b 0%, #334155 100%);\n    border-radius: 1rem;\n    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);\n    padding: 2rem;\n    margin-bottom: 1.5rem;\n    border: 1px solid rgba(148, 163, 184, 0.1);\n}\n\n.header {\n    text-align: center;\n    margin-bottom: 2rem;\n}\n\n.header h1 {\n    font-size: 2.5rem;\n    color: #f1f5f9;\n    margin-bottom: 0.5rem;\n    text-shadow: 0 0 20px rgba(251, 191, 36, 0.5);\n}\n\n.subtitle {\n    color: #94a3b8;\n    font-size: 1rem;\n}\n\n.formulas {\n    margin-top: 1rem;\n    display: flex;\n    gap: 1.5rem;\n    justify-content: center;\n    align-items: center;\n    flex-wrap: wrap;\n}\n\n.formula {\n    color: #cbd5e1;\n    font-size: 0.9rem;\n    font-family: 'Courier New', monospace;\n    background: rgba(15, 23, 42, 0.5);\n    padding: 0.5rem 1.5rem;\n    border-radius: 0.5rem;\n    border: 1px solid rgba(251, 191, 36, 0.3);\n}\n\n.formula-const {\n    color: #fbbf24;\n    font-size: 0.85rem;\n    font-family: 'Courier New', monospace;\n    background: rgba(251, 191, 36, 0.1);\n    padding: 0.5rem 1rem;\n    border-radius: 0.5rem;\n    border: 1px solid rgba(251, 191, 36, 0.3);\n}\n\n.content-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 2rem;\n}\n\n@media (max-width: 1200px) {\n    .content-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n.visualization-section {\n    background: rgba(10, 14, 26, 0.5);\n    border-radius: 0.75rem;\n    padding: 1.5rem;\n    border: 1px solid rgba(148, 163, 184, 0.1);\n}\n\n.visualization-section h2,\n.controls-section h2 {\n    font-size: 1.25rem;\n    color: #f1f5f9;\n    margin-bottom: 1rem;\n}\n\n#rocketCanvas {\n    display: block;\n    margin: 0 auto;\n    border-radius: 0.5rem;\n}\n\n.legend {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 0.75rem;\n    margin-top: 1rem;\n    font-size: 0.875rem;\n}\n\n.legend-item {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    color: #cbd5e1;\n}\n\n.legend-color {\n    width: 1.5rem;\n    height: 1rem;\n    border-radius: 0.25rem;\n}\n\n.controls-section h2 {\n    margin-bottom: 1.5rem;\n}\n\n.control-group {\n    margin-bottom: 1.5rem;\n}\n\n.control-group label {\n    display: block;\n    font-size: 0.875rem;\n    font-weight: 500;\n    color: #e2e8f0;\n    margin-bottom: 0.5rem;\n}\n\n.control-group input[type=\"range\"] {\n    width: 100%;\n    height: 0.5rem;\n    background: rgba(71, 85, 105, 0.5);\n    border-radius: 0.5rem;\n    outline: none;\n    -webkit-appearance: none;\n    appearance: none;\n}\n\n.control-group input[type=\"range\"]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 1.25rem;\n    height: 1.25rem;\n    background: #fbbf24;\n    border-radius: 50%;\n    cursor: pointer;\n    box-shadow: 0 0 10px rgba(251, 191, 36, 0.5);\n}\n\n.control-group input[type=\"range\"]::-moz-range-thumb {\n    width: 1.25rem;\n    height: 1.25rem;\n    background: #fbbf24;\n    border-radius: 50%;\n    cursor: pointer;\n    border: none;\n    box-shadow: 0 0 10px rgba(251, 191, 36, 0.5);\n}\n\n.slider-labels {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.75rem;\n    color: #94a3b8;\n    margin-top: 0.25rem;\n}\n\n.preset-buttons {\n    display: flex;\n    gap: 0.5rem;\n    margin-top: 0.5rem;\n}\n\n.preset-btn {\n    flex: 1;\n    padding: 0.4rem 0.6rem;\n    font-size: 0.75rem;\n    font-weight: 500;\n    background: rgba(251, 191, 36, 0.2);\n    color: #fcd34d;\n    border: 1px solid rgba(251, 191, 36, 0.3);\n    border-radius: 0.375rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.preset-btn:hover {\n    background: rgba(251, 191, 36, 0.3);\n    border-color: rgba(251, 191, 36, 0.5);\n}\n\n.results-box {\n    background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.15) 100%);\n    border-radius: 0.75rem;\n    padding: 1.5rem;\n    margin-bottom: 1.5rem;\n    border: 1px solid rgba(251, 191, 36, 0.3);\n}\n\n.results-box h3 {\n    font-size: 1.125rem;\n    color: #f1f5f9;\n    margin-bottom: 0.75rem;\n}\n\n.result-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 0.5rem;\n    color: #cbd5e1;\n    font-size: 0.875rem;\n}\n\n.result-highlight {\n    margin-bottom: 0.75rem;\n    padding-bottom: 0.75rem;\n    border-bottom: 1px solid rgba(251, 191, 36, 0.3);\n}\n\n.result-value {\n    font-family: 'Courier New', monospace;\n    font-weight: bold;\n    color: #fcd34d;\n    font-size: 1rem;\n}\n\n.result-value-large {\n    font-family: 'Courier New', monospace;\n    font-weight: bold;\n    color: #fbbf24;\n    font-size: 1.5rem;\n}\n\n.mission-panel {\n    background: rgba(16, 185, 129, 0.1);\n    border-radius: 0.75rem;\n    padding: 1rem;\n    margin-bottom: 1.5rem;\n    border: 1px solid rgba(16, 185, 129, 0.2);\n}\n\n.mission-panel h4 {\n    font-size: 0.875rem;\n    color: #f1f5f9;\n    margin-bottom: 0.75rem;\n    font-weight: 600;\n}\n\n.mission-btn {\n    width: 100%;\n    padding: 0.5rem;\n    margin-bottom: 0.5rem;\n    font-size: 0.8rem;\n    font-weight: 500;\n    background: rgba(16, 185, 129, 0.2);\n    color: #6ee7b7;\n    border: 1px solid rgba(16, 185, 129, 0.3);\n    border-radius: 0.375rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.mission-btn:hover {\n    background: rgba(16, 185, 129, 0.3);\n    border-color: rgba(16, 185, 129, 0.5);\n}\n\n.mission-info {\n    margin-top: 0.5rem;\n    font-size: 0.75rem;\n    color: #6ee7b7;\n    text-align: center;\n}\n\n.button-group {\n    display: flex;\n    gap: 0.75rem;\n    margin-bottom: 1.5rem;\n}\n\n.btn {\n    flex: 1;\n    padding: 0.75rem 1.5rem;\n    font-size: 1rem;\n    font-weight: 600;\n    border: none;\n    border-radius: 0.5rem;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n\n.btn-primary {\n    background: #f59e0b;\n    color: white;\n    box-shadow: 0 0 20px rgba(245, 158, 11, 0.3);\n}\n\n.btn-primary:hover {\n    background: #d97706;\n    box-shadow: 0 0 25px rgba(245, 158, 11, 0.5);\n}\n\n.btn-secondary {\n    background: #64748b;\n    color: white;\n}\n\n.btn-secondary:hover {\n    background: #475569;\n}\n\n.info-box {\n    background: rgba(59, 130, 246, 0.1);\n    border: 1px solid rgba(59, 130, 246, 0.3);\n    border-radius: 0.5rem;\n    padding: 1rem;\n    margin-bottom: 1rem;\n}\n\n.info-box h4 {\n    color: #60a5fa;\n    font-size: 0.875rem;\n    font-weight: 600;\n    margin-bottom: 0.5rem;\n}\n\n.info-box p {\n    color: #93c5fd;\n    font-size: 0.875rem;\n    line-height: 1.5;\n}\n\n.warning-box {\n    background: rgba(239, 68, 68, 0.1);\n    border: 1px solid rgba(239, 68, 68, 0.3);\n    border-radius: 0.5rem;\n    padding: 1rem;\n}\n\n.warning-box h4 {\n    color: #f87171;\n    font-size: 0.875rem;\n    font-weight: 600;\n    margin-bottom: 0.5rem;\n}\n\n.warning-box p {\n    color: #fca5a5;\n    font-size: 0.875rem;\n    line-height: 1.5;\n}\n\n.physics-info {\n    background: linear-gradient(135deg, #1e293b 0%, #334155 100%);\n    border-radius: 0.75rem;\n    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);\n    padding: 1.5rem;\n    border: 1px solid rgba(148, 163, 184, 0.1);\n}\n\n.physics-info h3 {\n    font-size: 1.25rem;\n    color: #f1f5f9;\n    margin-bottom: 0.75rem;\n}\n\n.concepts-grid {\n    display: grid;\n    grid-template-columns: repeat(3, 1fr);\n    gap: 1rem;\n}\n\n@media (max-width: 768px) {\n    .concepts-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n.concept-card {\n    border-radius: 0.5rem;\n    padding: 1rem;\n    border: 1px solid;\n}\n\n.concept-card h4 {\n    font-size: 0.875rem;\n    font-weight: 600;\n    margin-bottom: 0.5rem;\n}\n\n.concept-card p {\n    font-size: 0.875rem;\n    line-height: 1.5;\n}\n\n.concept-blue {\n    background: rgba(59, 130, 246, 0.1);\n    border-color: rgba(59, 130, 246, 0.3);\n}\n\n.concept-blue h4 {\n    color: #60a5fa;\n}\n\n.concept-blue p {\n    color: #93c5fd;\n}\n\n.concept-green {\n    background: rgba(16, 185, 129, 0.1);\n    border-color: rgba(16, 185, 129, 0.3);\n}\n\n.concept-green h4 {\n    color: #34d399;\n}\n\n.concept-green p {\n    color: #6ee7b7;\n}\n\n.concept-purple {\n    background: rgba(168, 85, 247, 0.1);\n    border-color: rgba(168, 85, 247, 0.3);\n}\n\n.concept-purple h4 {\n    color: #a78bfa;\n}\n\n.concept-purple p {\n    color: #c4b5fd;\n}\n\n@keyframes launch {\n    0% {\n        transform: translateY(0);\n    }\n    100% {\n        transform: translateY(-400px);\n    }\n}\n\n.launching {\n    animation: launch 3s ease-in;\n}", "js": "// Constants\nconst G0 = 9.81; // Standard gravity (m/s²)\n\n// State variables\nlet isp = 300;  // Specific impulse (seconds)\nlet m0 = 10000; // Initial mass (kg)\nlet mf = 1000;  // Final mass (kg)\nlet deltaV = 0; // Delta-V (m/s)\nlet massRatio = 0;\nlet propellantMass = 0;\nlet propellantFraction = 0;\n\n// DOM elements\nconst ispSlider = document.getElementById('ispSlider');\nconst m0Slider = document.getElementById('m0Slider');\nconst mfSlider = document.getElementById('mfSlider');\nconst ispValue = document.getElementById('ispValue');\nconst m0Value = document.getElementById('m0Value');\nconst mfValue = document.getElementById('mfValue');\nconst deltaVResult = document.getElementById('deltaVResult');\nconst massRatioResult = document.getElementById('massRatioResult');\nconst propMassResult = document.getElementById('propMassResult');\nconst propFractionResult = document.getElementById('propFractionResult');\nconst burnBtn = document.getElementById('burnBtn');\nconst resetBtn = document.getElementById('resetBtn');\nconst warningBox = document.getElementById('warningBox');\nconst warningText = document.getElementById('warningText');\nconst missionInfo = document.getElementById('missionInfo');\n\n// SVG elements\nconst rocketGroup = document.getElementById('rocketGroup');\nconst fuelTank = document.getElementById('fuelTank');\nconst payloadSection = document.getElementById('payloadSection');\nconst massRatioText = document.getElementById('massRatioText');\nconst propellantMassText = document.getElementById('propellantMass');\nconst flameEffect = document.getElementById('flameEffect');\n\n// Format numbers\nfunction formatNumber(value, decimals = 0) {\n    if (value >= 1e6) {\n        return (value / 1e6).toFixed(1) + 'M';\n    } else if (value >= 1e3) {\n        return (value / 1e3).toFixed(1) + 'k';\n    }\n    return value.toFixed(decimals);\n}\n\n// Calculate rocket equation\nfunction calculateRocketEquation() {\n    if (m0 > mf && mf > 0 && isp > 0) {\n        // deltaV = Isp * g0 * ln(m0/mf)\n        massRatio = m0 / mf;\n        deltaV = isp * G0 * Math.log(massRatio);\n        propellantMass = m0 - mf;\n        propellantFraction = (propellantMass / m0) * 100;\n        \n        warningBox.style.display = 'none';\n    } else if (m0 <= mf) {\n        warningBox.style.display = 'block';\n        warningText.textContent = 'Initial mass (m₀) must be greater than final mass (mf)!';\n        deltaV = 0;\n        massRatio = 0;\n    } else {\n        warningBox.style.display = 'block';\n        warningText.textContent = 'All parameters must be positive!';\n        deltaV = 0;\n        massRatio = 0;\n    }\n    \n    updateResults();\n    updateVisualization();\n}\n\n// Update results display\nfunction updateResults() {\n    deltaVResult.textContent = `${Math.round(deltaV)} m/s`;\n    massRatioResult.textContent = massRatio.toFixed(2);\n    propMassResult.textContent = `${formatNumber(propellantMass)} kg`;\n    propFractionResult.textContent = `${propellantFraction.toFixed(1)}%`;\n}\n\n// Update visualization\nfunction updateVisualization() {\n    // Update info panel\n    massRatioText.textContent = massRatio.toFixed(2);\n    propellantMassText.textContent = `${formatNumber(propellantMass)} kg`;\n    \n    // Calculate visual proportions\n    const totalHeight = 280;\n    const fuelHeight = (propellantMass / m0) * totalHeight;\n    const payloadHeight = (mf / m0) * totalHeight;\n    \n    // Update fuel tank height (grows from bottom)\n    fuelTank.setAttribute('height', fuelHeight);\n    fuelTank.setAttribute('y', 200 + totalHeight - fuelHeight);\n    \n    // Update payload section\n    payloadSection.setAttribute('height', payloadHeight);\n    payloadSection.setAttribute('y', 200 + totalHeight - fuelHeight - payloadHeight);\n    \n    // Hide flame by default\n    flameEffect.style.display = 'none';\n}\n\n// Animate rocket launch\nfunction launchRocket() {\n    flameEffect.style.display = 'block';\n    rocketGroup.classList.add('launching');\n    \n    // Simulate fuel depletion\n    let currentFuel = propellantMass;\n    const fuelBurnRate = propellantMass / 3; // Burn over 3 seconds\n    \n    const burnInterval = setInterval(() => {\n        currentFuel -= fuelBurnRate * 0.05; // Update every 50ms\n        \n        if (currentFuel <= 0) {\n            currentFuel = 0;\n            clearInterval(burnInterval);\n            setTimeout(() => {\n                flameEffect.style.display = 'none';\n            }, 200);\n        }\n        \n        // Update fuel tank visual\n        const fuelFraction = currentFuel / propellantMass;\n        const totalHeight = 280;\n        const maxFuelHeight = (propellantMass / m0) * totalHeight;\n        const currentFuelHeight = fuelFraction * maxFuelHeight;\n        \n        fuelTank.setAttribute('height', currentFuelHeight);\n        fuelTank.setAttribute('y', 200 + totalHeight - currentFuelHeight);\n    }, 50);\n    \n    // Reset after animation\n    setTimeout(() => {\n        rocketGroup.classList.remove('launching');\n        rocketGroup.style.transform = 'translateY(0)';\n        updateVisualization();\n    }, 3000);\n}\n\n// Reset visualization\nfunction resetVisualization() {\n    rocketGroup.classList.remove('launching');\n    rocketGroup.style.transform = 'translateY(0)';\n    flameEffect.style.display = 'none';\n    updateVisualization();\n}\n\n// Event listeners for sliders\nispSlider.addEventListener('input', (e) => {\n    isp = parseFloat(e.target.value);\n    ispValue.textContent = isp;\n    calculateRocketEquation();\n});\n\nm0Slider.addEventListener('input', (e) => {\n    const exponent = parseFloat(e.target.value);\n    m0 = Math.pow(10, exponent);\n    m0Value.textContent = formatNumber(m0);\n    calculateRocketEquation();\n});\n\nmfSlider.addEventListener('input', (e) => {\n    const exponent = parseFloat(e.target.value);\n    mf = Math.pow(10, exponent);\n    mfValue.textContent = formatNumber(mf);\n    calculateRocketEquation();\n});\n\n// Preset buttons for Isp\ndocument.querySelectorAll('.preset-btn[data-isp]').forEach(btn => {\n    btn.addEventListener('click', () => {\n        isp = parseFloat(btn.dataset.isp);\n        ispSlider.value = isp;\n        ispValue.textContent = isp;\n        calculateRocketEquation();\n    });\n});\n\n// Mission example buttons\ndocument.querySelectorAll('.mission-btn').forEach(btn => {\n    btn.addEventListener('click', () => {\n        const requiredDV = parseFloat(btn.dataset.dv);\n        missionInfo.textContent = `${btn.textContent} requires ~${requiredDV.toLocaleString()} m/s ΔV`;\n        \n        // Highlight if current config can achieve it\n        if (deltaV >= requiredDV) {\n            missionInfo.style.color = '#6ee7b7';\n            missionInfo.textContent += ' ✓ Achievable!';\n        } else {\n            missionInfo.style.color = '#fca5a5';\n            missionInfo.textContent += ' ✗ Need more ΔV';\n        }\n    });\n});\n\n// Button controls\nburnBtn.addEventListener('click', () => {\n    if (m0 > mf) {\n        launchRocket();\n    }\n});\n\nresetBtn.addEventListener('click', () => {\n    resetVisualization();\n    missionInfo.textContent = 'Select a mission to see required ΔV';\n    missionInfo.style.color = '#6ee7b7';\n});\n\n// Initialize\ncalculateRocketEquation();"}}
{"input": {"input_text": "Atmosphere model: density decreases exponentially with altitude h: rho = rho0*exp(-h/H). Compute density.", "simulation_name": " Exponential Atmosphere", "domain": "Atmosphere", "description": "Isothermal exponential density", "assumptions": ["Isothermal layer"], "entities": [], "constants": [], "parameters": [{"name": "sea_level_density", "symbol": "rho0", "unit": "kg/m^3", "range": [0.5, 1.4]}, {"name": "scale_height", "symbol": "H", "unit": "m", "range": [5000, 10000]}, {"name": "altitude", "symbol": "h", "unit": "m", "range": [0, 25000]}], "equations": [{"description": "Density", "expression": "rho = rho0*exp(-h/H)"}], "initial_conditions": {}, "outputs": ["rho"], "simulation_controls": ["rho0", "H", "h"], "constraints": ["H>0", "rho0>0", "h>=0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Exponential Atmosphere Model</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"container\">\n    <header>\n        <h1>Exponential Atmosphere Model</h1>\n        <div class=\"equation-box\">\n            $$ \\rho(h) = \\rho_0 \\cdot e^{-h/H} $$\n        </div>\n    </header>\n\n    <div class=\"simulation-layout\">\n        \n        <aside class=\"controls\">\n            <h2>Parameters</h2>\n\n            <div class=\"control-group\">\n                <label for=\"rho0\">Sea Level Density ($\\rho_0$)</label>\n                <div class=\"input-row\">\n                    <input type=\"range\" id=\"rho0\" min=\"0.5\" max=\"1.4\" step=\"0.01\" value=\"1.225\">\n                    <span id=\"val-rho0\" class=\"value-display\">1.225</span> <span class=\"unit\">kg/m³</span>\n                </div>\n            </div>\n\n            <div class=\"control-group\">\n                <label for=\"scaleHeight\">Scale Height ($H$)</label>\n                <div class=\"input-row\">\n                    <input type=\"range\" id=\"scaleHeight\" min=\"5000\" max=\"10000\" step=\"100\" value=\"8500\">\n                    <span id=\"val-H\" class=\"value-display\">8500</span> <span class=\"unit\">m</span>\n                </div>\n                <p class=\"description\">Height at which density drops by factor $1/e$.</p>\n            </div>\n\n            <div class=\"control-group highlight-control\">\n                <label for=\"altitude\">Target Altitude ($h$)</label>\n                <div class=\"input-row\">\n                    <input type=\"range\" id=\"altitude\" min=\"0\" max=\"25000\" step=\"100\" value=\"0\">\n                    <span id=\"val-h\" class=\"value-display\">0</span> <span class=\"unit\">m</span>\n                </div>\n            </div>\n\n            <div class=\"output-panel\">\n                <h3>Calculated Density ($\\rho$)</h3>\n                <div class=\"result-value\" id=\"result-rho\">1.225</div>\n                <div class=\"unit\">kg/m³</div>\n                <div class=\"ratio-bar-container\">\n                    <div id=\"ratio-bar\" style=\"width: 100%;\"></div>\n                </div>\n                <div class=\"ratio-text\" id=\"ratio-text\">100% of Sea Level</div>\n            </div>\n        </aside>\n\n        <main class=\"visuals\">\n            <div class=\"canvas-wrapper\">\n                <h3>Visual Representation</h3>\n                <div class=\"canvas-stack\">\n                    <canvas id=\"skyCanvas\"></canvas>\n                    <div class=\"overlay-info\">Probe</div>\n                </div>\n            </div>\n            \n            <div class=\"canvas-wrapper\">\n                <h3>Density Profile ($\\rho$ vs $h$)</h3>\n                <canvas id=\"graphCanvas\"></canvas>\n            </div>\n        </main>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary-color: #3498db;\n    --accent-color: #e74c3c;\n    --panel-bg: #ffffff;\n    --bg-color: #f4f7f6;\n    --text-color: #2c3e50;\n    --border-radius: 8px;\n}\n\n* {\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    margin: 0;\n    padding: 20px;\n    height: 100vh;\n    overflow: hidden; /* Prevent scrolling if possible */\n}\n\n.container {\n    max-width: 1200px;\n    margin: 0 auto;\n    height: 95vh;\n    display: flex;\n    flex-direction: column;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 20px;\n    flex-shrink: 0;\n}\n\nheader h1 {\n    margin: 0;\n    font-size: 1.8rem;\n}\n\n.equation-box {\n    background: #eef2f3;\n    display: inline-block;\n    padding: 5px 20px;\n    border-radius: 20px;\n    margin-top: 10px;\n    border: 1px solid #dcdcdc;\n}\n\n.simulation-layout {\n    display: flex;\n    gap: 20px;\n    flex: 1;\n    min-height: 0; /* Important for flex nested scrolling */\n}\n\n/* Controls Sidebar */\n.controls {\n    flex: 0 0 350px;\n    background: var(--panel-bg);\n    padding: 25px;\n    border-radius: var(--border-radius);\n    box-shadow: 0 4px 15px rgba(0,0,0,0.1);\n    display: flex;\n    flex-direction: column;\n    overflow-y: auto;\n}\n\nh2, h3 {\n    margin-top: 0;\n    color: #34495e;\n    border-bottom: 2px solid #ecf0f1;\n    padding-bottom: 10px;\n}\n\n.control-group {\n    margin-bottom: 25px;\n}\n\n.highlight-control {\n    background: #f0f8ff;\n    padding: 15px;\n    border-radius: var(--border-radius);\n    border: 1px solid #d6eaf8;\n}\n\nlabel {\n    display: block;\n    font-weight: 600;\n    margin-bottom: 8px;\n    font-size: 0.9rem;\n}\n\n.input-row {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\ninput[type=\"range\"] {\n    flex: 1;\n    cursor: pointer;\n}\n\n.value-display {\n    font-family: monospace;\n    font-weight: bold;\n    color: var(--primary-color);\n    width: 60px;\n    text-align: right;\n}\n\n.unit {\n    font-size: 0.85rem;\n    color: #7f8c8d;\n    width: 40px;\n}\n\n.description {\n    font-size: 0.8rem;\n    color: #7f8c8d;\n    margin-top: 5px;\n    font-style: italic;\n}\n\n.output-panel {\n    margin-top: auto;\n    background: #fdfefe;\n    border: 1px solid #ecf0f1;\n    padding: 15px;\n    border-radius: var(--border-radius);\n    text-align: center;\n}\n\n.result-value {\n    font-size: 2.5rem;\n    font-weight: bold;\n    color: var(--primary-color);\n}\n\n.ratio-bar-container {\n    height: 8px;\n    background: #eee;\n    border-radius: 4px;\n    margin: 10px 0 5px;\n    overflow: hidden;\n}\n\n#ratio-bar {\n    height: 100%;\n    background: linear-gradient(90deg, #3498db, #2ecc71);\n    transition: width 0.3s ease;\n}\n\n.ratio-text {\n    font-size: 0.8rem;\n    color: #7f8c8d;\n}\n\n/* Visualization Area */\n.visuals {\n    flex: 1;\n    display: flex;\n    gap: 20px;\n}\n\n.canvas-wrapper {\n    flex: 1;\n    background: var(--panel-bg);\n    border-radius: var(--border-radius);\n    box-shadow: 0 4px 15px rgba(0,0,0,0.1);\n    padding: 15px;\n    display: flex;\n    flex-direction: column;\n}\n\n.canvas-stack {\n    position: relative;\n    flex: 1;\n    border: 1px solid #eee;\n    border-radius: 4px;\n    overflow: hidden;\n}\n\ncanvas {\n    width: 100%;\n    height: 100%;\n    display: block;\n}\n\n.overlay-info {\n    position: absolute;\n    bottom: 10px;\n    left: 10px;\n    background: rgba(255,255,255,0.8);\n    padding: 4px 8px;\n    border-radius: 4px;\n    font-size: 0.8rem;\n    pointer-events: none;\n}\n\n/* Responsive */\n@media (max-width: 900px) {\n    .simulation-layout {\n        flex-direction: column;\n        overflow-y: auto;\n    }\n    \n    body {\n        height: auto;\n        overflow: auto;\n    }\n\n    .container {\n        height: auto;\n    }\n\n    .controls {\n        flex: none;\n        width: 100%;\n    }\n\n    .visuals {\n        flex-direction: column;\n        height: 800px;\n    }\n}", "js": "// DOM Elements\nconst inputs = {\n    rho0: document.getElementById('rho0'),\n    H: document.getElementById('scaleHeight'),\n    h: document.getElementById('altitude')\n};\n\nconst displays = {\n    rho0: document.getElementById('val-rho0'),\n    H: document.getElementById('val-H'),\n    h: document.getElementById('val-h'),\n    result: document.getElementById('result-rho'),\n    ratioBar: document.getElementById('ratio-bar'),\n    ratioText: document.getElementById('ratio-text')\n};\n\nconst skyCanvas = document.getElementById('skyCanvas');\nconst graphCanvas = document.getElementById('graphCanvas');\nconst skyCtx = skyCanvas.getContext('2d');\nconst graphCtx = graphCanvas.getContext('2d');\n\n// State\nlet params = {\n    rho0: 1.225,\n    H: 8500,\n    h: 0\n};\n\n// Particle System for Sky View\nconst particles = [];\nconst NUM_PARTICLES = 150; // Base number to simulate visual density\n\nclass Particle {\n    constructor(canvasWidth, canvasHeight) {\n        this.w = canvasWidth;\n        this.h = canvasHeight;\n        this.reset();\n        // Start at random y\n        this.y = Math.random() * this.h;\n    }\n\n    reset() {\n        this.x = Math.random() * this.w;\n        this.y = 0; // Reset to top or random\n        this.vx = (Math.random() - 0.5) * 0.5; // Slight drift\n        this.vy = (Math.random() * 0.5) + 0.1; // Falling slowly or jittering\n        this.radius = Math.random() * 1.5 + 0.5;\n        this.alpha = Math.random() * 0.5 + 0.2;\n    }\n\n    update() {\n        this.x += this.vx;\n        this.y += (Math.random() - 0.5) * 0.5; // Brownian-ish vertical jitter\n\n        // Wrap around horizontally\n        if (this.x > this.w) this.x = 0;\n        if (this.x < 0) this.x = this.w;\n        if (this.y > this.h) this.y = 0;\n        if (this.y < 0) this.y = this.h;\n    }\n\n    draw(ctx, maxAlt, scaleHeight, seaLevelRho) {\n        // We only draw the particle if probability allows based on density at this height\n        // Map particle Y (pixels) to Altitude (meters)\n        // Canvas Bottom = 0m, Top = maxAlt\n        const altitudeAtY = maxAlt * (1 - (this.y / this.h));\n        \n        // Calculate density factor at this altitude\n        const densityFactor = Math.exp(-altitudeAtY / scaleHeight);\n\n        // Visual trick: render particle transparency based on density\n        // Higher density = more visible particles\n        \n        // Threshold check to simulate fewer particles higher up\n        // We use a random check against density to decide whether to draw\n        // giving a stochastic appearance of thinning air\n        if (Math.random() > densityFactor * 1.2) return; \n\n        ctx.beginPath();\n        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);\n        ctx.fillStyle = `rgba(255, 255, 255, ${this.alpha})`;\n        ctx.fill();\n    }\n}\n\n// Initialization\nfunction init() {\n    // Event Listeners\n    inputs.rho0.addEventListener('input', update);\n    inputs.H.addEventListener('input', update);\n    inputs.h.addEventListener('input', update);\n\n    window.addEventListener('resize', resizeCanvases);\n\n    // Initial Resize\n    resizeCanvases();\n    \n    // Create particles\n    for(let i=0; i<NUM_PARTICLES; i++) {\n        particles.push(new Particle(skyCanvas.width, skyCanvas.height));\n    }\n\n    // Start Loop\n    update();\n    animate();\n}\n\nfunction resizeCanvases() {\n    const containers = document.querySelectorAll('.canvas-stack, .canvas-wrapper');\n    \n    // Sky Canvas\n    skyCanvas.width = containers[0].clientWidth;\n    skyCanvas.height = containers[0].clientHeight;\n    \n    // Graph Canvas\n    graphCanvas.width = containers[1].clientWidth;\n    graphCanvas.height = containers[1].clientHeight;\n\n    // Reset particles on resize\n    particles.forEach(p => {\n        p.w = skyCanvas.width;\n        p.h = skyCanvas.height;\n    });\n}\n\nfunction update() {\n    // Get values\n    params.rho0 = parseFloat(inputs.rho0.value);\n    params.H = parseFloat(inputs.H.value);\n    params.h = parseFloat(inputs.h.value);\n\n    // Update Displays\n    displays.rho0.textContent = params.rho0.toFixed(3);\n    displays.H.textContent = params.H;\n    displays.h.textContent = params.h;\n\n    // Calculate Result\n    // rho = rho0 * exp(-h/H)\n    const rho = params.rho0 * Math.exp(-params.h / params.H);\n    \n    displays.result.textContent = rho.toFixed(4);\n\n    // Update Ratio Bar\n    const ratio = (rho / params.rho0) * 100;\n    displays.ratioBar.style.width = `${Math.min(ratio, 100)}%`;\n    displays.ratioText.textContent = `${ratio.toFixed(1)}% of Sea Level Density`;\n}\n\nfunction drawSky() {\n    const ctx = skyCtx;\n    const w = skyCanvas.width;\n    const h = skyCanvas.height;\n\n    // 1. Draw Background Gradient (Atmosphere Color)\n    // Bottom: Light Blue, Top: Black/Space\n    const grad = ctx.createLinearGradient(0, h, 0, 0);\n    grad.addColorStop(0, \"#87CEEB\"); // Sky Blue at bottom (0m)\n    grad.addColorStop(0.6, \"#4682B4\"); // Steel Blue\n    grad.addColorStop(1, \"#000011\"); // Space at top (25000m)\n    \n    ctx.fillStyle = grad;\n    ctx.fillRect(0, 0, w, h);\n\n    // 2. Draw Particles (Air Density Visual)\n    const maxSimAlt = 25000; // The top of the canvas represents 25km\n    \n    particles.forEach(p => {\n        p.update();\n        p.draw(ctx, maxSimAlt, params.H, params.rho0);\n    });\n\n    // 3. Draw \"Probe\" / Balloon at current altitude h\n    // Map params.h to pixel Y\n    // Y = 0 is Top, Y = h is Bottom.\n    // 0m = h px. 25000m = 0 px.\n    const probeY = h - (params.h / maxSimAlt) * h;\n    \n    ctx.shadowBlur = 10;\n    ctx.shadowColor = \"rgba(0,0,0,0.5)\";\n    \n    // Balloon Line\n    ctx.beginPath();\n    ctx.moveTo(w/2, probeY + 20);\n    ctx.lineTo(w/2, probeY + 60);\n    ctx.strokeStyle = \"#fff\";\n    ctx.stroke();\n\n    // Balloon Body\n    ctx.beginPath();\n    ctx.arc(w/2, probeY, 20, 0, Math.PI*2);\n    ctx.fillStyle = \"#e74c3c\";\n    ctx.fill();\n    ctx.strokeStyle = \"#c0392b\";\n    ctx.lineWidth = 2;\n    ctx.stroke();\n    \n    // Highlight spot\n    ctx.beginPath();\n    ctx.arc(w/2 - 5, probeY - 5, 5, 0, Math.PI*2);\n    ctx.fillStyle = \"rgba(255,255,255,0.3)\";\n    ctx.fill();\n\n    ctx.shadowBlur = 0;\n\n    // Label\n    ctx.fillStyle = \"white\";\n    ctx.font = \"12px Arial\";\n    ctx.fillText(`${params.h} m`, w/2 + 25, probeY + 5);\n}\n\nfunction drawGraph() {\n    const ctx = graphCtx;\n    const w = graphCanvas.width;\n    const h = graphCanvas.height;\n    \n    // Clear\n    ctx.clearRect(0, 0, w, h);\n\n    // Setup Axes\n    // X-axis: Density (0 to 1.5)\n    // Y-axis: Altitude (0 to 25000)\n    \n    const margin = {top: 20, right: 20, bottom: 40, left: 50};\n    const plotW = w - margin.left - margin.right;\n    const plotH = h - margin.top - margin.bottom;\n    \n    const maxRho = 1.5;\n    const maxAlt = 25000;\n\n    // Draw Grid & Axes\n    ctx.strokeStyle = \"#ddd\";\n    ctx.lineWidth = 1;\n    ctx.beginPath();\n    \n    // Y Axis (Altitude)\n    ctx.moveTo(margin.left, margin.top);\n    ctx.lineTo(margin.left, h - margin.bottom);\n    \n    // X Axis (Density)\n    ctx.moveTo(margin.left, h - margin.bottom);\n    ctx.lineTo(w - margin.right, h - margin.bottom);\n    ctx.stroke();\n\n    // Labels\n    ctx.fillStyle = \"#2c3e50\";\n    ctx.font = \"12px Arial\";\n    ctx.textAlign = \"center\";\n    ctx.fillText(\"Density (kg/m³)\", margin.left + plotW/2, h - 10);\n    \n    ctx.save();\n    ctx.translate(15, margin.top + plotH/2);\n    ctx.rotate(-Math.PI/2);\n    ctx.fillText(\"Altitude (m)\", 0, 0);\n    ctx.restore();\n\n    // Ticks\n    // X Ticks\n    for(let i=0; i<=5; i++) {\n        let val = (maxRho / 5) * i;\n        let x = margin.left + (val / maxRho) * plotW;\n        ctx.fillText(val.toFixed(1), x, h - margin.bottom + 15);\n    }\n    // Y Ticks\n    ctx.textAlign = \"right\";\n    for(let i=0; i<=5; i++) {\n        let val = (maxAlt / 5) * i;\n        let y = h - margin.bottom - (val / maxAlt) * plotH;\n        ctx.fillText(val, margin.left - 10, y + 4);\n    }\n\n    // Plot Curve\n    ctx.beginPath();\n    ctx.lineWidth = 3;\n    ctx.strokeStyle = \"#3498db\";\n\n    for(let yPx = 0; yPx <= plotH; yPx+=2) {\n        // Pixel Y to Altitude\n        let alt = (yPx / plotH) * maxAlt;\n        \n        // Calculate Density\n        let rho = params.rho0 * Math.exp(-alt / params.H);\n        \n        // Map to Pixel X\n        let xPx = (rho / maxRho) * plotW;\n        \n        // Invert Y for canvas (0 is top)\n        let canvasY = h - margin.bottom - yPx;\n        let canvasX = margin.left + xPx;\n\n        if (yPx === 0) ctx.moveTo(canvasX, canvasY);\n        else ctx.lineTo(canvasX, canvasY);\n    }\n    ctx.stroke();\n\n    // Plot Current Point\n    let currentRho = params.rho0 * Math.exp(-params.h / params.H);\n    let ptX = margin.left + (currentRho / maxRho) * plotW;\n    let ptY = h - margin.bottom - (params.h / maxAlt) * plotH;\n\n    ctx.beginPath();\n    ctx.arc(ptX, ptY, 6, 0, Math.PI*2);\n    ctx.fillStyle = \"#e74c3c\";\n    ctx.fill();\n    ctx.strokeStyle = \"white\";\n    ctx.lineWidth = 2;\n    ctx.stroke();\n    \n    // Dashed lines to axes\n    ctx.beginPath();\n    ctx.setLineDash([5, 5]);\n    ctx.strokeStyle = \"#999\";\n    ctx.lineWidth = 1;\n    // Horizontal\n    ctx.moveTo(margin.left, ptY);\n    ctx.lineTo(ptX, ptY);\n    // Vertical\n    ctx.moveTo(ptX, ptY);\n    ctx.lineTo(ptX, h - margin.bottom);\n    ctx.stroke();\n    ctx.setLineDash([]);\n}\n\nfunction animate() {\n    drawSky();\n    drawGraph();\n    requestAnimationFrame(animate);\n}\n\n// Start\ninit();"}}
{"input": {"input_text": "Quadratic drag ballistic fall: m dv/dt = mg - 0.5*rho*Cd*A*v^2. Provide terminal velocity.", "simulation_name": " Quadratic Drag Terminal", "domain": "Physics", "description": "Terminal speed with quadratic drag", "assumptions": ["Steady terminal", "Downward motion"], "entities": [], "constants": [{"name": "gravity", "symbol": "g", "value": 9.81, "unit": "m/s^2"}], "parameters": [{"name": "mass", "symbol": "m", "unit": "kg", "range": [0.01, 200]}, {"name": "air_density", "symbol": "rho", "unit": "kg/m^3", "range": [0.5, 1.4]}, {"name": "drag_coefficient", "symbol": "Cd", "unit": "dimensionless", "range": [0.1, 2]}, {"name": "area", "symbol": "A", "unit": "m^2", "range": [0.0001, 10]}], "equations": [{"description": "Terminal velocity", "expression": "v_term = sqrt((2*m*g)/(rho*Cd*A))"}], "initial_conditions": {}, "outputs": ["v_term"], "simulation_controls": ["m", "rho", "Cd", "A"], "constraints": ["m>0", "rho>0", "Cd>0", "A>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Quadratic Drag & Terminal Velocity</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"container\">\n    <header>\n        <h1>Quadratic Drag: Terminal Velocity</h1>\n        <div class=\"formula-box\">\n            $$ v_{term} = \\sqrt{\\frac{2mg}{\\rho C_d A}} $$\n        </div>\n    </header>\n\n    <div class=\"sim-layout\">\n        <aside class=\"controls\">\n            <h2>Object Properties</h2>\n            \n            <div class=\"control-group\">\n                <label for=\"mass\">Mass ($m$)</label>\n                <div class=\"input-wrapper\">\n                    <input type=\"range\" id=\"mass\" min=\"1\" max=\"200\" step=\"1\" value=\"70\">\n                    <span id=\"val-m\" class=\"val-display\">70 kg</span>\n                </div>\n            </div>\n\n            <div class=\"control-group\">\n                <label for=\"area\">Cross-Section Area ($A$)</label>\n                <div class=\"input-wrapper\">\n                    <input type=\"range\" id=\"area\" min=\"0.01\" max=\"2.0\" step=\"0.01\" value=\"0.5\">\n                    <span id=\"val-A\" class=\"val-display\">0.50 m²</span>\n                </div>\n                <small>Determines object visual size</small>\n            </div>\n\n            <div class=\"control-group\">\n                <label for=\"cd\">Drag Coefficient ($C_d$)</label>\n                <div class=\"input-wrapper\">\n                    <input type=\"range\" id=\"cd\" min=\"0.1\" max=\"2.0\" step=\"0.1\" value=\"0.5\">\n                    <span id=\"val-cd\" class=\"val-display\">0.5 (Sphere/Person)</span>\n                </div>\n            </div>\n\n            <h2>Environment</h2>\n            <div class=\"control-group\">\n                <label for=\"rho\">Air Density ($\\rho$)</label>\n                <div class=\"input-wrapper\">\n                    <input type=\"range\" id=\"rho\" min=\"0.5\" max=\"1.5\" step=\"0.01\" value=\"1.22\">\n                    <span id=\"val-rho\" class=\"val-display\">1.22 kg/m³</span>\n                </div>\n            </div>\n\n            <div class=\"actions\">\n                <button id=\"reset-btn\">Drop / Reset</button>\n            </div>\n        </aside>\n\n        <main class=\"visuals\">\n            <div class=\"canvas-container\">\n                <canvas id=\"simCanvas\"></canvas>\n                <div class=\"overlay-data\">\n                    <div class=\"data-row\">\n                        <span class=\"label\">Current Velocity ($v$):</span>\n                        <span id=\"curr-v\" class=\"value\">0.0 m/s</span>\n                    </div>\n                    <div class=\"data-row highlight\">\n                        <span class=\"label\">Terminal Velocity ($v_{term}$):</span>\n                        <span id=\"term-v\" class=\"value\">0.0 m/s</span>\n                    </div>\n                    <div class=\"data-row status\" id=\"status-text\">\n                        Accelerating...\n                    </div>\n                </div>\n            </div>\n            \n            <div class=\"info-card\">\n                <h3>Force Balance Diagram</h3>\n                <p>\n                    \n                    <br>\n                    At terminal velocity, the upward Drag force ($F_d$) exactly balances the downward Weight ($mg$). The object stops accelerating and falls at a constant speed.\n                </p>\n            </div>\n        </main>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary: #2980b9;\n    --secondary: #2c3e50;\n    --accent: #e74c3c;\n    --bg: #ecf0f1;\n    --panel: #ffffff;\n    --sky-top: #3498db;\n    --sky-bot: #85c1e9;\n}\n\nbody {\n    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg);\n    color: var(--secondary);\n    margin: 0;\n    padding: 20px;\n    height: 100vh;\n    box-sizing: border-box;\n    display: flex;\n    justify-content: center;\n}\n\n.container {\n    width: 100%;\n    max-width: 1200px;\n    background: var(--panel);\n    border-radius: 12px;\n    box-shadow: 0 4px 20px rgba(0,0,0,0.1);\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n    height: 95vh;\n}\n\nheader {\n    background: var(--secondary);\n    color: white;\n    padding: 15px 30px;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\nheader h1 {\n    margin: 0;\n    font-size: 1.5rem;\n}\n\n.formula-box {\n    background: rgba(255,255,255,0.1);\n    padding: 5px 15px;\n    border-radius: 6px;\n    font-size: 1.1rem;\n}\n\n.sim-layout {\n    display: flex;\n    flex: 1;\n    overflow: hidden;\n}\n\n/* Controls */\n.controls {\n    width: 320px;\n    padding: 25px;\n    background: #f8f9fa;\n    border-right: 1px solid #ddd;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n    overflow-y: auto;\n}\n\n.controls h2 {\n    font-size: 1.1rem;\n    color: var(--primary);\n    border-bottom: 2px solid #dfe6e9;\n    padding-bottom: 5px;\n    margin: 0 0 10px 0;\n}\n\n.control-group label {\n    display: block;\n    font-weight: 600;\n    margin-bottom: 8px;\n    font-size: 0.9rem;\n}\n\n.input-wrapper {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\ninput[type=\"range\"] {\n    flex: 1;\n    cursor: pointer;\n}\n\n.val-display {\n    width: 80px;\n    text-align: right;\n    font-family: monospace;\n    font-weight: bold;\n    color: var(--primary);\n}\n\nsmall {\n    color: #7f8c8d;\n    font-size: 0.8rem;\n    display: block;\n    margin-top: 4px;\n}\n\nbutton#reset-btn {\n    width: 100%;\n    padding: 12px;\n    background-color: var(--accent);\n    color: white;\n    border: none;\n    border-radius: 6px;\n    font-size: 1rem;\n    font-weight: bold;\n    cursor: pointer;\n    transition: background 0.2s;\n    margin-top: 20px;\n}\n\nbutton#reset-btn:hover {\n    background-color: #c0392b;\n}\n\n/* Visuals */\n.visuals {\n    flex: 1;\n    padding: 20px;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n    background: #fff;\n}\n\n.canvas-container {\n    flex: 2;\n    position: relative;\n    border-radius: 8px;\n    overflow: hidden;\n    border: 1px solid #bdc3c7;\n}\n\ncanvas {\n    width: 100%;\n    height: 100%;\n    display: block;\n    /* Sky Gradient */\n    background: linear-gradient(to bottom, var(--sky-top), var(--sky-bot));\n}\n\n.overlay-data {\n    position: absolute;\n    top: 15px;\n    left: 15px;\n    background: rgba(255, 255, 255, 0.9);\n    padding: 15px;\n    border-radius: 8px;\n    box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n    min-width: 200px;\n}\n\n.data-row {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 8px;\n    font-size: 0.9rem;\n}\n\n.data-row.highlight {\n    font-weight: bold;\n    color: var(--primary);\n    border-top: 1px solid #eee;\n    padding-top: 8px;\n    margin-top: 8px;\n}\n\n.value {\n    font-family: monospace;\n    font-size: 1.1rem;\n}\n\n.status {\n    text-align: center;\n    margin-top: 10px;\n    font-weight: bold;\n    color: #7f8c8d;\n    font-style: italic;\n    background: #f0f0f0;\n    padding: 4px;\n    border-radius: 4px;\n}\n\n.info-card {\n    flex: 0 0 auto;\n    background: #fdfefe;\n    border: 1px solid #ecf0f1;\n    padding: 15px;\n    border-radius: 8px;\n}\n\n.info-card h3 {\n    margin: 0 0 10px 0;\n    font-size: 1rem;\n    color: var(--secondary);\n}\n\n.info-card p {\n    margin: 0;\n    font-size: 0.9rem;\n    line-height: 1.5;\n    color: #555;\n}\n\n@media (max-width: 800px) {\n    .sim-layout {\n        flex-direction: column;\n    }\n    .controls {\n        width: 100%;\n        height: auto;\n        border-right: none;\n        border-bottom: 1px solid #ddd;\n    }\n    .canvas-container {\n        min-height: 300px;\n    }\n    .container {\n        height: auto;\n        overflow: auto;\n    }\n}", "js": "// Constants\nconst g = 9.81; // m/s^2\n\n// DOM Elements\nconst canvas = document.getElementById('simCanvas');\nconst ctx = canvas.getContext('2d');\n\nconst inputs = {\n    m: document.getElementById('mass'),\n    A: document.getElementById('area'),\n    Cd: document.getElementById('cd'),\n    rho: document.getElementById('rho')\n};\n\nconst displays = {\n    m: document.getElementById('val-m'),\n    A: document.getElementById('val-A'),\n    Cd: document.getElementById('val-cd'),\n    rho: document.getElementById('val-rho'),\n    currV: document.getElementById('curr-v'),\n    termV: document.getElementById('term-v'),\n    status: document.getElementById('status-text')\n};\n\nconst resetBtn = document.getElementById('reset-btn');\n\n// Simulation State\nlet state = {\n    m: 70,      // kg\n    A: 0.5,     // m^2\n    Cd: 0.5,    // dimensionless\n    rho: 1.22,  // kg/m^3\n    \n    // Dynamic variables\n    v: 0,           // current velocity (m/s)\n    yPos: 0,        // vertical position (for scrolling background)\n    terminalV: 0,   // calculated terminal velocity\n    \n    clouds: []      // for visual effect\n};\n\n// --- Initialization ---\n\nfunction init() {\n    resizeCanvas();\n    window.addEventListener('resize', resizeCanvas);\n    \n    // Event Listeners\n    Object.values(inputs).forEach(input => {\n        input.addEventListener('input', updateParams);\n    });\n    \n    resetBtn.addEventListener('click', resetSimulation);\n    \n    // Generate some random clouds\n    for(let i=0; i<8; i++) {\n        state.clouds.push(createCloud());\n    }\n\n    updateParams(); // Calculate initial values\n    animate();\n}\n\nfunction resizeCanvas() {\n    canvas.width = canvas.parentElement.clientWidth;\n    canvas.height = canvas.parentElement.clientHeight;\n}\n\nfunction createCloud() {\n    return {\n        x: Math.random() * canvas.width,\n        y: Math.random() * canvas.height,\n        w: 50 + Math.random() * 100,\n        speed: 0.2 + Math.random() * 0.5 // Parallax speed factor\n    };\n}\n\nfunction updateParams() {\n    state.m = parseFloat(inputs.m.value);\n    state.A = parseFloat(inputs.A.value);\n    state.Cd = parseFloat(inputs.Cd.value);\n    state.rho = parseFloat(inputs.rho.value);\n\n    // Update Text Displays\n    displays.m.textContent = state.m + \" kg\";\n    displays.A.textContent = state.A.toFixed(2) + \" m²\";\n    displays.Cd.textContent = state.Cd.toFixed(1);\n    displays.rho.textContent = state.rho.toFixed(2) + \" kg/m³\";\n\n    // Recalculate Theoretical Terminal Velocity\n    // v_term = sqrt( (2*m*g) / (rho * Cd * A) )\n    const numerator = 2 * state.m * g;\n    const denominator = state.rho * state.Cd * state.A;\n    state.terminalV = Math.sqrt(numerator / denominator);\n    \n    displays.termV.textContent = state.terminalV.toFixed(1) + \" m/s\";\n}\n\nfunction resetSimulation() {\n    state.v = 0;\n    updateParams();\n}\n\n// --- Physics Engine ---\n\nfunction updatePhysics(dt) {\n    // Forces\n    const F_gravity = state.m * g;\n    const F_drag = 0.5 * state.rho * state.Cd * state.A * (state.v * state.v);\n    \n    // Net Force & Acceleration\n    // We assume falling down, so Gravity is driving force, Drag is opposing\n    const F_net = F_gravity - F_drag;\n    const a = F_net / state.m;\n    \n    // Euler Integration\n    state.v += a * dt;\n    \n    // Update visual position (scrolling)\n    // We scale the pixel movement so it doesn't look too crazy at high speeds\n    const pixelScale = 5; \n    state.yPos += state.v * dt * pixelScale;\n\n    // Update Status Text\n    const ratio = state.v / state.terminalV;\n    if (ratio > 0.99) {\n        displays.status.textContent = \"Status: Terminal Velocity Reached\";\n        displays.status.style.color = \"#27ae60\"; // Green\n    } else {\n        displays.status.textContent = \"Status: Accelerating...\";\n        displays.status.style.color = \"#e67e22\"; // Orange\n    }\n    \n    displays.currV.textContent = state.v.toFixed(1) + \" m/s\";\n}\n\n// --- Rendering ---\n\nfunction draw() {\n    const ctx = canvas.getContext('2d');\n    const w = canvas.width;\n    const h = canvas.height;\n    const cx = w / 2;\n    const cy = h / 2;\n\n    // Clear\n    ctx.clearRect(0, 0, w, h);\n\n    // 1. Draw Background (Scrolling Clouds)\n    // To simulate falling, clouds move UP\n    ctx.fillStyle = \"rgba(255, 255, 255, 0.4)\";\n    state.clouds.forEach(cloud => {\n        // Move cloud up based on velocity\n        // cloud.y -= state.v * 0.1 * cloud.speed;\n        // Actually, let's base it on simulation yPos to match flow\n        let drawY = (cloud.y - state.yPos * cloud.speed) % h;\n        if (drawY < -50) drawY += h + 100; // Wrap around\n        \n        // Simple cloud shape (oval)\n        ctx.beginPath();\n        ctx.ellipse(cloud.x, drawY, cloud.w, cloud.w * 0.6, 0, 0, Math.PI * 2);\n        ctx.fill();\n    });\n\n    // 2. Draw Falling Object (Centered)\n    // Radius scales with Area (Area = pi * r^2 -> r = sqrt(Area/pi))\n    // We scale it up for visibility (e.g., * 40 pixels)\n    const visualRadius = Math.sqrt(state.A / Math.PI) * 50; \n    \n    ctx.shadowBlur = 10;\n    ctx.shadowColor = \"rgba(0,0,0,0.3)\";\n    \n    // Draw Ball\n    ctx.fillStyle = \"#e74c3c\"; // Red ball\n    ctx.beginPath();\n    ctx.arc(cx, cy, visualRadius, 0, Math.PI * 2);\n    ctx.fill();\n    \n    // Shine\n    ctx.fillStyle = \"rgba(255,255,255,0.3)\";\n    ctx.beginPath();\n    ctx.arc(cx - visualRadius*0.3, cy - visualRadius*0.3, visualRadius*0.3, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.shadowBlur = 0;\n\n    // 3. Draw Force Vectors\n    // Gravity (Down) - Constant visual length relative to mass? \n    // Or scale both so they fit? \n    // Let's scale vectors so that at Terminal Velocity, they are roughly 100px long.\n    // Scale Factor = 100 / (mg)\n    const scaleFactor = 100 / (state.m * g); \n    \n    const lenG = (state.m * g) * scaleFactor;\n    const lenD = (0.5 * state.rho * state.Cd * state.A * state.v * state.v) * scaleFactor;\n\n    // Gravity Arrow (Red)\n    drawArrow(ctx, cx, cy + visualRadius, cx, cy + visualRadius + lenG, \"#c0392b\", \"Weight (mg)\");\n    \n    // Drag Arrow (Blue)\n    drawArrow(ctx, cx, cy - visualRadius, cx, cy - visualRadius - lenD, \"#2980b9\", \"Drag (Fd)\");\n\n    // 4. Speed Lines (Motion Blur effect)\n    if (state.v > 1) {\n        ctx.strokeStyle = \"rgba(255, 255, 255, 0.5)\";\n        ctx.lineWidth = 2;\n        const numLines = Math.min(20, Math.floor(state.v / 2));\n        for(let i=0; i<numLines; i++) {\n            const lx = cx + (Math.random() - 0.5) * visualRadius * 3;\n            const ly = Math.random() * h;\n            const len = 20 + state.v; // Faster = longer lines\n            ctx.beginPath();\n            ctx.moveTo(lx, ly);\n            ctx.lineTo(lx, ly - len);\n            ctx.stroke();\n        }\n    }\n}\n\nfunction drawArrow(ctx, x1, y1, x2, y2, color, label) {\n    const headlen = 10; // length of head in pixels\n    const dx = x2 - x1;\n    const dy = y2 - y1;\n    const angle = Math.atan2(dy, dx);\n    \n    ctx.strokeStyle = color;\n    ctx.fillStyle = color;\n    ctx.lineWidth = 3;\n    \n    // Line\n    ctx.beginPath();\n    ctx.moveTo(x1, y1);\n    ctx.lineTo(x2, y2);\n    ctx.stroke();\n    \n    // Head\n    ctx.beginPath();\n    ctx.moveTo(x2, y2);\n    ctx.lineTo(x2 - headlen * Math.cos(angle - Math.PI / 6), y2 - headlen * Math.sin(angle - Math.PI / 6));\n    ctx.lineTo(x2 - headlen * Math.cos(angle + Math.PI / 6), y2 - headlen * Math.sin(angle + Math.PI / 6));\n    ctx.fill();\n\n    // Label\n    ctx.font = \"bold 12px Arial\";\n    ctx.fillStyle = \"#333\";\n    const labelOffset = (y2 > y1) ? 15 : -5;\n    ctx.textAlign = \"center\";\n    ctx.fillText(label, x2, y2 + labelOffset);\n}\n\n// --- Animation Loop ---\nlet lastTime = 0;\n\nfunction animate(timestamp) {\n    if (!lastTime) lastTime = timestamp;\n    const dt = (timestamp - lastTime) / 1000; // Delta time in seconds\n    lastTime = timestamp;\n\n    // Limit dt to prevent huge jumps if tab inactive\n    const safeDt = Math.min(dt, 0.1);\n\n    updatePhysics(safeDt);\n    draw();\n    \n    requestAnimationFrame(animate);\n}\n\n// Start\ninit();"}}
{"input": {"input_text": "Car braking with friction coefficient mu on level road. Stopping distance d = v0^2/(2*mu*g).", "simulation_name": " Braking Distance", "domain": "Physics", "description": "Dry friction stopping distance", "assumptions": ["No ABS modeling"], "entities": [], "constants": [{"name": "gravity", "symbol": "g", "value": 9.81, "unit": "m/s^2"}], "parameters": [{"name": "initial_speed", "symbol": "v0", "unit": "m/s", "range": [0, 60]}, {"name": "friction_coefficient", "symbol": "mu", "unit": "dimensionless", "range": [0.1, 1.2]}], "equations": [{"description": "Stopping distance", "expression": "d = v0^2/(2*mu*g)"}], "initial_conditions": {}, "outputs": ["d"], "simulation_controls": ["v0", "mu"], "constraints": ["mu>0", "v0>=0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Physics: Braking Distance</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n\n    <div class=\"app-container\">\n        <header>\n            <h1>Braking Dynamics Simulator</h1>\n            <p>visualizing kinematic friction & stopping distance</p>\n        </header>\n\n        <div class=\"canvas-wrapper\">\n            <canvas id=\"simCanvas\"></canvas>\n            <div class=\"hud\">\n                <div class=\"hud-item\" id=\"speed-hud\">0 km/h</div>\n                <div class=\"hud-item\" id=\"dist-hud\">0.0 m</div>\n            </div>\n        </div>\n\n        <div class=\"controls\">\n            <div class=\"control-card\">\n                <div class=\"control-header\">\n                    <label for=\"v0\">Initial Speed ($v_0$)</label>\n                    <span class=\"value-badge\"><span id=\"v0-display\">25</span> m/s</span>\n                </div>\n                <input type=\"range\" id=\"v0\" min=\"10\" max=\"50\" step=\"1\" value=\"25\">\n                <div class=\"sub-label\"><span id=\"kph-display\">90</span> km/h</div>\n            </div>\n\n            <div class=\"control-card\">\n                <div class=\"control-header\">\n                    <label for=\"mu\">Friction Coeff. ($\\mu$)</label>\n                    <span class=\"value-badge\" id=\"mu-display\">0.7</span>\n                </div>\n                <input type=\"range\" id=\"mu\" min=\"0.2\" max=\"1.0\" step=\"0.1\" value=\"0.7\">\n                <div class=\"sub-label\" id=\"surface-label\">Dry Asphalt</div>\n            </div>\n\n            <div class=\"action-card\">\n                <div class=\"equation-box\">\n                    $$ d = \\frac{v_0^2}{2 \\mu g} $$\n                </div>\n                <div class=\"result-box\">\n                    Est. Distance: <span id=\"calc-distance\">--</span> m\n                </div>\n                <button id=\"brake-btn\">INITIATE BRAKING</button>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-main: #f0f2f5;\n    --card-bg: #ffffff;\n    --accent: #3b82f6;\n    --danger: #ef4444;\n    --text-main: #1f2937;\n    --text-sub: #6b7280;\n}\n\nbody {\n    font-family: 'Segoe UI', system-ui, sans-serif;\n    background-color: var(--bg-main);\n    color: var(--text-main);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n}\n\n.app-container {\n    width: 100%;\n    max-width: 900px;\n    background: var(--card-bg);\n    border-radius: 16px;\n    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);\n    padding: 24px;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 24px;\n}\n\nh1 { margin: 0; font-size: 1.5rem; color: #111; }\np { margin: 4px 0 0; color: var(--text-sub); font-size: 0.9rem; }\n\n/* Canvas Section */\n.canvas-wrapper {\n    position: relative;\n    width: 100%;\n    height: 320px;\n    background: linear-gradient(180deg, #87CEEB 0%, #e0f2fe 60%, #9ca3af 60%, #4b5563 100%);\n    border-radius: 12px;\n    overflow: hidden;\n    box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);\n    margin-bottom: 24px;\n}\n\ncanvas {\n    display: block;\n    width: 100%;\n    height: 100%;\n}\n\n.hud {\n    position: absolute;\n    top: 16px;\n    right: 16px;\n    display: flex;\n    gap: 10px;\n}\n\n.hud-item {\n    background: rgba(0, 0, 0, 0.6);\n    color: #fff;\n    padding: 6px 12px;\n    border-radius: 6px;\n    font-family: monospace;\n    font-weight: bold;\n    backdrop-filter: blur(4px);\n}\n\n/* Controls Grid */\n.controls {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n    gap: 20px;\n}\n\n.control-card {\n    background: #f9fafb;\n    padding: 16px;\n    border-radius: 8px;\n    border: 1px solid #e5e7eb;\n}\n\n.control-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 12px;\n}\n\nlabel { font-weight: 600; font-size: 0.9rem; }\n\n.value-badge {\n    background: #e0e7ff;\n    color: var(--accent);\n    padding: 2px 8px;\n    border-radius: 4px;\n    font-weight: bold;\n    font-size: 0.9rem;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    cursor: pointer;\n    accent-color: var(--accent);\n}\n\n.sub-label {\n    font-size: 0.8rem;\n    color: var(--text-sub);\n    margin-top: 6px;\n    text-align: right;\n}\n\n/* Action Area */\n.action-card {\n    background: #f0f9ff;\n    border: 1px solid #bae6fd;\n    padding: 16px;\n    border-radius: 8px;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n}\n\n.equation-box {\n    text-align: center;\n    margin-bottom: 10px;\n    font-size: 1.1rem;\n}\n\n.result-box {\n    text-align: center;\n    font-weight: bold;\n    color: var(--text-main);\n    margin-bottom: 12px;\n}\n\n#brake-btn {\n    background: var(--danger);\n    color: white;\n    border: none;\n    padding: 12px;\n    border-radius: 6px;\n    font-weight: bold;\n    cursor: pointer;\n    transition: transform 0.1s, background 0.2s;\n    width: 100%;\n}\n\n#brake-btn:hover { background: #dc2626; }\n#brake-btn:active { transform: scale(0.98); }\n#brake-btn:disabled { background: #9ca3af; cursor: not-allowed; }", "js": "// Physics Constants\nconst g = 9.81;\n\n// State\nlet state = {\n    v0: 25,          // m/s\n    mu: 0.7,         // friction coeff\n    currentX: 0,     // current distance (m)\n    currentV: 0,     // current velocity (m/s)\n    isBraking: false,\n    startTime: 0,\n    stopDistance: 0,\n    scale: 10        // pixels per meter\n};\n\n// Car Visuals\nconst carDims = { length: 4.5, height: 1.4, wheelRadius: 0.35 };\n\n// DOM Elements\nconst canvas = document.getElementById('simCanvas');\nconst ctx = canvas.getContext('2d');\nconst ui = {\n    v0: document.getElementById('v0'),\n    v0Disp: document.getElementById('v0-display'),\n    kphDisp: document.getElementById('kph-display'),\n    mu: document.getElementById('mu'),\n    muDisp: document.getElementById('mu-display'),\n    surface: document.getElementById('surface-label'),\n    calcDist: document.getElementById('calc-distance'),\n    hudSpeed: document.getElementById('speed-hud'),\n    hudDist: document.getElementById('dist-hud'),\n    btn: document.getElementById('brake-btn')\n};\n\n// Initialization\nfunction init() {\n    resize();\n    window.addEventListener('resize', resize);\n    \n    ui.v0.addEventListener('input', updateParams);\n    ui.mu.addEventListener('input', updateParams);\n    ui.btn.addEventListener('click', startBraking);\n    \n    updateParams();\n    drawFrame(0); // Initial static draw\n}\n\nfunction resize() {\n    canvas.width = canvas.parentElement.clientWidth;\n    canvas.height = canvas.parentElement.clientHeight;\n    if(!state.isBraking) drawFrame(state.currentX);\n}\n\nfunction updateParams() {\n    if (state.isBraking) return;\n\n    // Read Inputs\n    state.v0 = parseFloat(ui.v0.value);\n    state.mu = parseFloat(ui.mu.value);\n\n    // Update Text\n    ui.v0Disp.innerText = state.v0;\n    ui.kphDisp.innerText = (state.v0 * 3.6).toFixed(0);\n    ui.muDisp.innerText = state.mu;\n    \n    // Surface Hint\n    let surf = \"Dry Asphalt\";\n    if(state.mu < 0.3) surf = \"Ice / Snow\";\n    else if(state.mu < 0.6) surf = \"Wet Road\";\n    else if(state.mu > 0.9) surf = \"Racing Slick / Track\";\n    ui.surface.innerText = surf;\n\n    // Calculate Theoretical Distance\n    state.stopDistance = (state.v0 ** 2) / (2 * state.mu * g);\n    ui.calcDist.innerText = state.stopDistance.toFixed(2);\n    \n    // Auto-Scale Canvas\n    // Fit stopping distance + 20% margin\n    const viewWidthMeters = Math.max(state.stopDistance * 1.2, 50); \n    state.scale = canvas.width / viewWidthMeters;\n\n    // Reset visual positions\n    state.currentX = 0;\n    state.currentV = state.v0;\n    \n    drawFrame(0);\n}\n\nfunction startBraking() {\n    if (state.isBraking) return;\n    \n    state.isBraking = true;\n    state.startTime = performance.now();\n    ui.btn.disabled = true;\n    ui.v0.disabled = true;\n    ui.mu.disabled = true;\n\n    requestAnimationFrame(animate);\n}\n\nfunction animate(time) {\n    const elapsedSec = (time - state.startTime) / 1000;\n    const a = state.mu * g;\n    \n    // Physics Calc: v = v0 - at\n    let newV = state.v0 - (a * elapsedSec);\n    \n    if (newV <= 0) {\n        // Stopped\n        state.currentV = 0;\n        state.currentX = state.stopDistance;\n        state.isBraking = false;\n        ui.btn.disabled = false;\n        ui.v0.disabled = false;\n        ui.mu.disabled = false;\n        ui.btn.innerText = \"RESET / BRAKE AGAIN\";\n        drawFrame(state.currentX);\n        return;\n    }\n\n    // Physics Calc: x = v0*t - 0.5*a*t^2\n    state.currentX = (state.v0 * elapsedSec) - (0.5 * a * elapsedSec * elapsedSec);\n    state.currentV = newV;\n\n    drawFrame(state.currentX);\n    requestAnimationFrame(animate);\n}\n\n// ---------------------------------------------------------\n// DRAWING ENGINE\n// ---------------------------------------------------------\n\nfunction drawFrame(carX) {\n    // Clear\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    \n    // Dynamic Horizon\n    const groundY = canvas.height * 0.65;\n    \n    // 1. Draw Road\n    ctx.fillStyle = \"#4b5563\";\n    ctx.fillRect(0, groundY, canvas.width, canvas.height - groundY);\n    \n    // Road Markings (Stripes)\n    ctx.strokeStyle = \"#e5e7eb\";\n    ctx.lineWidth = 2;\n    ctx.font = \"12px monospace\";\n    ctx.fillStyle = \"#d1d5db\";\n    \n    // Calculate visible range\n    // We render markers every 10m\n    const step = 10;\n    \n    for(let m = 0; m <= state.stopDistance + 20; m+=step) {\n        const px = m * state.scale;\n        \n        // Draw tick\n        ctx.beginPath();\n        ctx.moveTo(px, groundY);\n        ctx.lineTo(px, groundY + 15);\n        ctx.stroke();\n        \n        // Text\n        ctx.fillText(m + \"m\", px + 4, groundY + 30);\n    }\n    \n    // 2. Draw Stop Line (Target)\n    const stopPx = state.stopDistance * state.scale;\n    ctx.save();\n    ctx.strokeStyle = \"#ef4444\";\n    ctx.lineWidth = 4;\n    ctx.setLineDash([8, 8]);\n    ctx.beginPath();\n    ctx.moveTo(stopPx, groundY - 50);\n    ctx.lineTo(stopPx, groundY + 50);\n    ctx.stroke();\n    ctx.fillStyle = \"#ef4444\";\n    ctx.fillText(\"STOP\", stopPx - 15, groundY - 60);\n    ctx.restore();\n\n    // 3. Draw Car\n    drawCar(carX, groundY);\n\n    // 4. Update HUD\n    ui.hudSpeed.innerText = (state.currentV * 3.6).toFixed(0) + \" km/h\";\n    ui.hudDist.innerText = carX.toFixed(1) + \" m\";\n}\n\nfunction drawCar(xMeters, groundY) {\n    const x = xMeters * state.scale;\n    const len = carDims.length * state.scale;\n    const hgt = carDims.height * state.scale;\n    const wheelR = carDims.wheelRadius * state.scale;\n    \n    // Suspension/Brake Dive Logic\n    // If braking, tilt nose down. \n    // Max tilt angle ~ 3 degrees (0.05 rad)\n    let tilt = 0;\n    if(state.isBraking && state.currentV > 0.5) {\n        // More friction = harder braking = more tilt\n        tilt = Math.min(state.mu * 0.08, 0.1); \n    }\n\n    ctx.save();\n    \n    // Translate to center of car bottom for rotation\n    const centerX = x + len/2;\n    ctx.translate(centerX, groundY - wheelR); \n    ctx.rotate(tilt); // Apply dive\n    \n    // Car Body (Relative to new center)\n    ctx.fillStyle = \"#3b82f6\"; // Blue chassis\n    // Draw body shape\n    ctx.beginPath();\n    ctx.roundRect(-len/2, -hgt, len, hgt - 5, 5);\n    ctx.fill();\n    \n    // Roof / Windows\n    ctx.fillStyle = \"#bfdbfe\";\n    ctx.beginPath();\n    ctx.roundRect(-len/4, -hgt - (hgt*0.6), len/2, hgt*0.6, 5);\n    ctx.fill();\n\n    ctx.restore(); // Undo tilt for wheels (wheels stay on ground!)\n\n    // Draw Wheels (They need to rotate based on distance traveled)\n    // Wheel Rotation Angle = Distance / Radius\n    const wheelAngle = xMeters / carDims.wheelRadius;\n\n    // Rear Wheel\n    drawWheel(x + (len * 0.2), groundY - wheelR, wheelR, wheelAngle);\n    // Front Wheel\n    drawWheel(x + (len * 0.8), groundY - wheelR, wheelR, wheelAngle);\n}\n\nfunction drawWheel(cx, cy, r, angle) {\n    ctx.save();\n    ctx.translate(cx, cy);\n    ctx.rotate(angle);\n    \n    // Tire\n    ctx.beginPath();\n    ctx.arc(0, 0, r, 0, Math.PI * 2);\n    ctx.fillStyle = \"#1f2937\";\n    ctx.fill();\n    \n    // Rim\n    ctx.beginPath();\n    ctx.arc(0, 0, r * 0.6, 0, Math.PI * 2);\n    ctx.fillStyle = \"#9ca3af\";\n    ctx.fill();\n    \n    // Spokes (to see rotation)\n    ctx.strokeStyle = \"#374151\";\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.moveTo(-r*0.6, 0);\n    ctx.lineTo(r*0.6, 0);\n    ctx.moveTo(0, -r*0.6);\n    ctx.lineTo(0, r*0.6);\n    ctx.stroke();\n    \n    ctx.restore();\n}\n\ninit();"}}
{"input": {"input_text": "Cyclist power-speed on flat road: P = F*v with F = Cr*m*g + 0.5*rho*CdA*v^2. Compute speed for given power numerically; provide equation set.", "simulation_name": " Cycling Power Balance", "domain": "Biomechanics", "description": "Steady-state cycling power", "assumptions": ["No acceleration", "Flat road"], "entities": [], "constants": [{"name": "gravity", "symbol": "g", "value": 9.81, "unit": "m/s^2"}], "parameters": [{"name": "mass_total", "symbol": "m", "unit": "kg", "range": [50, 120]}, {"name": "rolling_coeff", "symbol": "Cr", "unit": "dimensionless", "range": [0.001, 0.01]}, {"name": "air_density", "symbol": "rho", "unit": "kg/m^3", "range": [0.9, 1.3]}, {"name": "drag_area", "symbol": "CdA", "unit": "m^2", "range": [0.15, 0.6]}, {"name": "power", "symbol": "P", "unit": "W", "range": [50, 600]}], "equations": [{"description": "Force", "expression": "F = Cr*m*g + 0.5*rho*CdA*v^2"}, {"description": "Power balance", "expression": "P = F*v"}], "initial_conditions": {}, "outputs": ["v"], "simulation_controls": ["m", "Cr", "rho", "CdA", "P"], "constraints": ["m>0", "Cr>0", "CdA>0", "P>=0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Cycling Power Physics</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n\n<div class=\"app-container\">\n    <header>\n        <h1>Cycling Dynamics Solver</h1>\n        <p>Newton-Raphson Equilibrium & Acceleration Physics</p>\n    </header>\n\n    <div class=\"main-content\">\n        <div class=\"canvas-wrapper\">\n            <canvas id=\"simCanvas\"></canvas>\n            <div class=\"overlay-stats\">\n                <div class=\"stat-group\">\n                    <div class=\"stat-label\">Current Speed</div>\n                    <div class=\"stat-value\"><span id=\"disp-v-curr\">0.0</span> <span class=\"unit\">km/h</span></div>\n                </div>\n                <div class=\"stat-group\">\n                    <div class=\"stat-label\">Target (Steady)</div>\n                    <div class=\"stat-value secondary\"><span id=\"disp-v-target\">0.0</span> <span class=\"unit\">km/h</span></div>\n                </div>\n                <div class=\"stat-group\">\n                    <div class=\"stat-label\">Aerodynamic Drag</div>\n                    <div class=\"stat-value\"><span id=\"disp-p-aero\">0</span> <span class=\"unit\">W</span></div>\n                </div>\n            </div>\n            <div id=\"accel-bar-container\">\n                <div id=\"accel-bar\"></div>\n            </div>\n        </div>\n\n        <div class=\"controls-wrapper\">\n            \n            <div class=\"equation-panel\">\n                $$ P_{req} = v \\cdot (C_r m g + 0.5 \\rho C_d A v^2) $$\n                <div class=\"status-msg\" id=\"status-msg\">Accelerating...</div>\n            </div>\n\n            <div class=\"sliders-grid\">\n                <div class=\"control-card highlight\">\n                    <div class=\"card-header\">\n                        <label for=\"p-input\">Power Output ($P$)</label>\n                        <span class=\"value-badge\"><span id=\"val-p\">300</span> W</span>\n                    </div>\n                    <input type=\"range\" id=\"p-input\" min=\"0\" max=\"1000\" step=\"10\" value=\"300\">\n                </div>\n\n                <div class=\"control-card\">\n                    <div class=\"card-header\">\n                        <label for=\"cda-input\">Drag Area ($C_d A$)</label>\n                        <span class=\"value-badge\"><span id=\"val-cda\">0.32</span> m²</span>\n                    </div>\n                    <input type=\"range\" id=\"cda-input\" min=\"0.15\" max=\"0.7\" step=\"0.01\" value=\"0.32\">\n                    <small>Rider Position (Tuck vs Upright)</small>\n                </div>\n\n                <div class=\"control-card\">\n                    <div class=\"card-header\">\n                        <label for=\"m-input\">Total Mass ($m$)</label>\n                        <span class=\"value-badge\"><span id=\"val-m\">80</span> kg</span>\n                    </div>\n                    <input type=\"range\" id=\"m-input\" min=\"50\" max=\"150\" step=\"1\" value=\"80\">\n                </div>\n\n                <div class=\"control-card\">\n                    <div class=\"card-header\">\n                        <label for=\"cr-input\">Rolling Res. ($C_r$)</label>\n                        <span class=\"value-badge\" id=\"val-cr\">0.004</span>\n                    </div>\n                    <input type=\"range\" id=\"cr-input\" min=\"0.001\" max=\"0.015\" step=\"0.001\" value=\"0.004\">\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n<script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n<script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-app: #f8fafc;\n    --bg-panel: #ffffff;\n    --primary: #3b82f6;\n    --text-main: #1e293b;\n    --text-sub: #64748b;\n    --accent-red: #ef4444;\n}\n\nbody {\n    font-family: 'Segoe UI', system-ui, sans-serif;\n    background-color: var(--bg-app);\n    color: var(--text-main);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n}\n\n.app-container {\n    max-width: 950px;\n    width: 100%;\n    background: var(--bg-panel);\n    border-radius: 16px;\n    box-shadow: 0 4px 20px rgba(0,0,0,0.08);\n    padding: 25px;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 25px;\n}\n\nheader h1 { margin: 0 0 5px 0; font-size: 1.6rem; letter-spacing: -0.5px; }\nheader p { margin: 0; color: var(--text-sub); font-size: 0.95rem; }\n\n.main-content {\n    display: flex;\n    flex-direction: column;\n    gap: 25px;\n}\n\n/* Visualizer */\n.canvas-wrapper {\n    position: relative;\n    width: 100%;\n    height: 340px;\n    background: linear-gradient(to bottom, #bae6fd 0%, #f0f9ff 60%, #94a3b8 60%, #475569 100%);\n    border-radius: 12px;\n    overflow: hidden;\n    box-shadow: inset 0 0 0 1px rgba(0,0,0,0.05);\n}\n\ncanvas {\n    display: block;\n    width: 100%;\n    height: 100%;\n}\n\n.overlay-stats {\n    position: absolute;\n    top: 15px;\n    left: 15px;\n    display: flex;\n    gap: 15px;\n    pointer-events: none;\n}\n\n.stat-group {\n    background: rgba(255, 255, 255, 0.9);\n    backdrop-filter: blur(4px);\n    padding: 8px 12px;\n    border-radius: 8px;\n    border: 1px solid rgba(0,0,0,0.05);\n    box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n}\n\n.stat-label {\n    font-size: 0.75rem;\n    text-transform: uppercase;\n    color: var(--text-sub);\n    font-weight: 600;\n    margin-bottom: 2px;\n}\n\n.stat-value {\n    font-size: 1.2rem;\n    font-weight: 700;\n    color: var(--text-main);\n    font-feature-settings: \"tnum\";\n}\n\n.stat-value.secondary { color: var(--text-sub); }\n.unit { font-size: 0.8rem; font-weight: normal; color: var(--text-sub); }\n\n#accel-bar-container {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    width: 100%;\n    height: 4px;\n    background: rgba(0,0,0,0.1);\n}\n\n#accel-bar {\n    height: 100%;\n    width: 0%;\n    background: var(--accent-red);\n    transition: width 0.1s;\n}\n\n/* Controls */\n.controls-wrapper {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.equation-panel {\n    background: #f1f5f9;\n    padding: 15px;\n    border-radius: 8px;\n    text-align: center;\n    font-size: 1.1rem;\n    position: relative;\n}\n\n.status-msg {\n    font-size: 0.85rem;\n    color: var(--primary);\n    margin-top: 5px;\n    font-weight: 600;\n    min-height: 1.2em;\n}\n\n.sliders-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));\n    gap: 20px;\n}\n\n.control-card {\n    background: #fff;\n    border: 1px solid #e2e8f0;\n    padding: 15px;\n    border-radius: 10px;\n    transition: border-color 0.2s;\n}\n\n.control-card:hover { border-color: #cbd5e1; }\n.control-card.highlight { border-color: var(--primary); background: #eff6ff; }\n\n.card-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 10px;\n}\n\nlabel { font-weight: 600; font-size: 0.9rem; }\n.value-badge {\n    background: #e2e8f0;\n    padding: 2px 8px;\n    border-radius: 4px;\n    font-size: 0.85rem;\n    font-weight: bold;\n    font-family: monospace;\n}\n\ninput[type=range] {\n    width: 100%;\n    cursor: pointer;\n    accent-color: var(--primary);\n}\n\nsmall { display: block; margin-top: 8px; font-size: 0.8rem; color: var(--text-sub); }\n\n@media (max-width: 600px) {\n    .overlay-stats { flex-direction: column; gap: 8px; }\n}", "js": "const canvas = document.getElementById('simCanvas');\nconst ctx = canvas.getContext('2d');\n\n// Simulation State\nconst state = {\n    // Inputs\n    P: 300,\n    CdA: 0.32,\n    m: 80,\n    Cr: 0.004,\n    rho: 1.22,\n    \n    // Physics\n    vCurrent: 0,    // m/s (Animated)\n    vTarget: 0,     // m/s (Theoretical Limit)\n    dist: 0,        // m (For animation scroll)\n    accel: 0        // m/s^2\n};\n\nconst g = 9.81;\n\n// Bike Geometry (Fixed in local coordinates)\n// Origin (0,0) is rear wheel hub\nconst bikeGeo = {\n    wheelRadius: 28,\n    wheelBase: 95,\n    bb: { x: 35, y: 10 },\n    seat: { x: 25, y: -55 },\n    headTop: { x: 90, y: -50 }, // Top of headtube (stem base)\n    headBot: { x: 86, y: -25 }, // Bottom of headtube\n    forkDrop: { x: 95, y: 0 }   // Front axle\n};\n\n// DOM Elements\nconst ui = {\n    inputs: {\n        P: document.getElementById('p-input'),\n        CdA: document.getElementById('cda-input'),\n        m: document.getElementById('m-input'),\n        Cr: document.getElementById('cr-input')\n    },\n    displays: {\n        P: document.getElementById('val-p'),\n        CdA: document.getElementById('val-cda'),\n        m: document.getElementById('val-m'),\n        Cr: document.getElementById('val-cr'),\n        vCurr: document.getElementById('disp-v-curr'),\n        vTarget: document.getElementById('disp-v-target'),\n        pAero: document.getElementById('disp-p-aero'),\n        status: document.getElementById('status-msg')\n    },\n    accelBar: document.getElementById('accel-bar')\n};\n\nlet particles = [];\n\nfunction init() {\n    resize();\n    window.addEventListener('resize', resize);\n    \n    // Bind Inputs\n    Object.keys(ui.inputs).forEach(k => {\n        ui.inputs[k].addEventListener('input', updateInputs);\n    });\n\n    // Init Wind Particles\n    for(let i=0; i<30; i++) particles.push(createParticle());\n\n    updateInputs();\n    requestAnimationFrame(loop);\n}\n\nfunction resize() {\n    canvas.width = canvas.parentElement.clientWidth;\n    canvas.height = canvas.parentElement.clientHeight;\n}\n\nfunction createParticle() {\n    return {\n        x: Math.random() * canvas.width,\n        y: Math.random() * canvas.height * 0.6,\n        len: 10 + Math.random() * 30,\n        speedMod: 0.8 + Math.random() * 0.4\n    };\n}\n\n// ----------------------------------------------------\n// Physics Engine\n// ----------------------------------------------------\n\n// Solver for steady state velocity (Newton-Raphson)\nfunction calculateTargetVelocity() {\n    const { P, m, CdA, Cr, rho } = state;\n    if (P <= 0) return 0;\n\n    // f(v) = 0.5*rho*CdA*v^3 + Cr*m*g*v - P = 0\n    let v = 10; \n    for(let i=0; i<15; i++) {\n        const f = 0.5*rho*CdA*v**3 + Cr*m*g*v - P;\n        const df = 1.5*rho*CdA*v**2 + Cr*m*g;\n        if(Math.abs(df) < 1e-7) break;\n        v -= f/df;\n    }\n    return Math.max(0, v);\n}\n\nfunction updateInputs() {\n    state.P = parseFloat(ui.inputs.P.value);\n    state.CdA = parseFloat(ui.inputs.CdA.value);\n    state.m = parseFloat(ui.inputs.m.value);\n    state.Cr = parseFloat(ui.inputs.Cr.value);\n\n    // Update Text\n    ui.displays.P.textContent = state.P;\n    ui.displays.CdA.textContent = state.CdA.toFixed(2);\n    ui.displays.m.textContent = state.m;\n    ui.displays.Cr.textContent = state.Cr.toFixed(3);\n\n    state.vTarget = calculateTargetVelocity();\n    ui.displays.vTarget.textContent = (state.vTarget * 3.6).toFixed(1);\n}\n\nfunction updatePhysics(dt) {\n    const { P, vCurrent, m, CdA, Cr, rho } = state;\n\n    // Forces\n    // 1. Propulsion: F = P/v (Clamp v to 1.0 to avoid singularity at start)\n    // At very low speeds, torque limits force, but for simple power model:\n    const vEff = Math.max(vCurrent, 1.0);\n    const F_drive = (P > 0) ? P / vEff : 0;\n\n    // 2. Resistance\n    const F_aero = 0.5 * rho * CdA * vCurrent**2;\n    const F_roll = Cr * m * g;\n    const F_resist = F_aero + F_roll;\n\n    // 3. Acceleration: a = F_net / m\n    // Note: If P=0, brakes/friction apply\n    let netForce = F_drive - F_resist;\n    \n    // Stop small oscillations near 0\n    if (vCurrent < 0.1 && netForce < 0 && P === 0) {\n        state.accel = 0;\n        state.vCurrent = 0;\n    } else {\n        state.accel = netForce / m;\n        state.vCurrent += state.accel * dt;\n    }\n\n    // Clamp speed\n    if(state.vCurrent < 0) state.vCurrent = 0;\n\n    // Update Distance for scrolling\n    state.dist += state.vCurrent * dt * 15; // 15 = visual scale factor\n\n    // Update UI Stats\n    ui.displays.vCurr.textContent = (state.vCurrent * 3.6).toFixed(1);\n    ui.displays.pAero.textContent = Math.round(F_aero * vCurrent); // Aero Power W\n    \n    // Status text\n    const diff = state.vTarget - state.vCurrent;\n    if(Math.abs(diff) < 0.1) ui.displays.status.textContent = \"Steady State Reached\";\n    else if(diff > 0) ui.displays.status.textContent = \"Accelerating...\";\n    else ui.displays.status.textContent = \"Decelerating / Coasting...\";\n\n    // Accel bar visual\n    const accelNorm = Math.min(Math.max(state.accel, 0), 2) / 2; // 0 to 2 m/s^2\n    ui.accelBar.style.width = (accelNorm * 100) + \"%\";\n}\n\n// ----------------------------------------------------\n// Drawing / IK\n// ----------------------------------------------------\n\nfunction loop(time) {\n    const dt = 0.016; // Fixed step approx\n    updatePhysics(dt);\n    draw(time);\n    requestAnimationFrame(loop);\n}\n\nfunction findJoint(p1, p2, r1, r2, forward) {\n    const dx = p2.x - p1.x;\n    const dy = p2.y - p1.y;\n    const d = Math.sqrt(dx*dx + dy*dy);\n    \n    if (d > r1+r2 || d === 0) return { x: (p1.x+p2.x)/2, y: (p1.y+p2.y)/2 }; \n\n    const a = (r1*r1 - r2*r2 + d*d) / (2*d);\n    const h = Math.sqrt(Math.max(0, r1*r1 - a*a));\n    \n    const x2 = p1.x + a * (dx/d);\n    const y2 = p1.y + a * (dy/d);\n    \n    const rx = -dy * (h/d);\n    const ry = dx * (h/d);\n\n    return forward \n        ? { x: x2 - rx, y: y2 - ry }\n        : { x: x2 + rx, y: y2 + ry };\n}\n\nfunction draw(time) {\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    \n    const roadY = canvas.height * 0.65;\n    const scale = 1.0; // Draw scale\n\n    // Background\n    drawRoad(roadY);\n    drawWind(roadY);\n\n    // Bike & Rider Container\n    ctx.save();\n    const cx = canvas.width/2 - 50;\n    const cy = roadY - bikeGeo.wheelRadius; \n    ctx.translate(cx, cy);\n\n    drawBike(state.dist);\n    drawRider(state.dist);\n\n    ctx.restore();\n}\n\nfunction drawRoad(y) {\n    ctx.fillStyle = \"#475569\";\n    ctx.fillRect(0, y, canvas.width, canvas.height - y);\n    \n    // Stripes\n    ctx.strokeStyle = \"#94a3b8\";\n    ctx.lineWidth = 3;\n    ctx.beginPath();\n    const offset = -(state.dist % 100);\n    for(let i = offset; i < canvas.width; i+=100) {\n        ctx.moveTo(i, y + 80);\n        ctx.lineTo(i + 50, y + 80);\n    }\n    ctx.stroke();\n}\n\nfunction drawBike(dist) {\n    const { wheelRadius, wheelBase, bb, seat, headTop, headBot, forkDrop } = bikeGeo;\n\n    // Wheels\n    const rot = dist / wheelRadius;\n    drawWheel(0, 0, wheelRadius, rot);\n    drawWheel(wheelBase, 0, wheelRadius, rot);\n\n    // Frame (Static Geometry)\n    ctx.strokeStyle = \"#ef4444\"; // Red\n    ctx.lineWidth = 5;\n    ctx.lineJoin = \"round\";\n    ctx.lineCap = \"round\";\n    \n    ctx.beginPath();\n    ctx.moveTo(0, 0); // Rear Hub\n    ctx.lineTo(bb.x, bb.y);\n    ctx.lineTo(headBot.x, headBot.y);\n    ctx.lineTo(headTop.x, headTop.y);\n    ctx.lineTo(seat.x, seat.y);\n    ctx.lineTo(bb.x, bb.y);\n    ctx.moveTo(seat.x, seat.y);\n    ctx.lineTo(0, 0); // Seat Stay\n    ctx.stroke();\n\n    // Fork\n    ctx.strokeStyle = \"#1e293b\";\n    ctx.beginPath();\n    ctx.moveTo(headTop.x, headTop.y); // Stem\n    ctx.lineTo(forkDrop.x, forkDrop.y); // Fork blade\n    ctx.stroke();\n\n    // Handlebars (Fixed to HeadTop)\n    // Drawing a simple drop bar shape\n    ctx.beginPath();\n    ctx.moveTo(headTop.x, headTop.y);\n    ctx.lineTo(headTop.x + 10, headTop.y); // Stem forward\n    ctx.lineTo(headTop.x + 15, headTop.y + 15); // Drop curve\n    ctx.stroke();\n}\n\nfunction drawRider(dist) {\n    // Rider fits to bike geometry\n    const { bb, seat, headTop } = bikeGeo;\n\n    // 1. Hip Position (Fixed on seat)\n    const hip = { x: seat.x + 5, y: seat.y - 10 };\n\n    // 2. Hand Position (Fixed on drops/hoods)\n    // Let's put hands on the \"hoods\" area, slightly forward of stem\n    const hand = { x: headTop.x + 10, y: headTop.y - 5 };\n\n    // 3. Shoulder Position (Variable based on CdA)\n    // CdA range 0.15 (flat) to 0.7 (upright)\n    // Map CdA to Torso Angle\n    // 0.15 -> 0 deg (horizontal), 0.7 -> 60 deg\n    const normCdA = Math.max(0, Math.min(1, (state.CdA - 0.15) / (0.6)));\n    const torsoAngle = -Math.PI * 0.1 - (normCdA * Math.PI * 0.35); // Radians\n    \n    const torsoLen = 52;\n    const shoulder = {\n        x: hip.x + Math.sin(Math.abs(torsoAngle)) * torsoLen * 0.8 + 10, // heuristic x\n        y: hip.y - Math.cos(Math.abs(torsoAngle)) * torsoLen\n    };\n    \n    // Recalculate exact shoulder from Hip + Angle + Length\n    // 0 deg = horizontal forward? No, let's just interpret visually.\n    // Upright: Shoulder is high (y negative), X near hip.\n    // Aero: Shoulder is low, X forward.\n    shoulder.y = hip.y - 45 + (normCdA * 30); \n    shoulder.x = hip.x + 20 + ((1-normCdA) * 20);\n\n    // --- Draw Far Side (Left) ---\n    const crankL = 15;\n    const angL = dist/12 + Math.PI;\n    const pedalL = { \n        x: bb.x + Math.cos(angL)*crankL, \n        y: bb.y + Math.sin(angL)*crankL \n    };\n    const kneeL = findJoint(hip, pedalL, 44, 42, true);\n    const elbowL = findJoint(shoulder, hand, 32, 30, false);\n    \n    // Draw Left Leg/Arm\n    ctx.strokeStyle = \"#64748b\"; // Darker\n    ctx.lineWidth = 8;\n    drawSegment(hip, kneeL);\n    drawSegment(kneeL, pedalL);\n    ctx.lineWidth = 6;\n    drawSegment(shoulder, elbowL);\n    drawSegment(elbowL, hand);\n\n    // --- Draw Torso/Head ---\n    ctx.strokeStyle = \"#3b82f6\"; // Blue\n    ctx.lineWidth = 14;\n    ctx.lineCap = \"round\";\n    ctx.beginPath();\n    ctx.moveTo(hip.x, hip.y);\n    ctx.lineTo(shoulder.x, shoulder.y);\n    ctx.stroke();\n\n    // Head\n    ctx.fillStyle = \"#fbbf24\";\n    ctx.beginPath();\n    ctx.arc(shoulder.x + 5, shoulder.y - 10, 9, 0, Math.PI*2);\n    ctx.fill();\n\n    // --- Draw Near Side (Right) ---\n    const angR = dist/12;\n    const pedalR = { \n        x: bb.x + Math.cos(angR)*crankL, \n        y: bb.y + Math.sin(angR)*crankL \n    };\n    const kneeR = findJoint(hip, pedalR, 44, 42, true);\n    const elbowR = findJoint(shoulder, hand, 32, 30, false);\n\n    ctx.strokeStyle = \"#2563eb\"; // Bright Blue Leg\n    ctx.lineWidth = 9;\n    drawSegment(hip, kneeR);\n    drawSegment(kneeR, pedalR);\n\n    ctx.strokeStyle = \"#60a5fa\"; // Light Blue Arm\n    ctx.lineWidth = 7;\n    drawSegment(shoulder, elbowR);\n    drawSegment(elbowR, hand);\n    \n    // Glove\n    ctx.fillStyle = \"#1e293b\";\n    ctx.beginPath();\n    ctx.arc(hand.x, hand.y, 4, 0, Math.PI*2);\n    ctx.fill();\n}\n\nfunction drawSegment(p1, p2) {\n    ctx.beginPath();\n    ctx.moveTo(p1.x, p1.y);\n    ctx.lineTo(p2.x, p2.y);\n    ctx.stroke();\n}\n\nfunction drawWheel(x, y, r, ang) {\n    ctx.save();\n    ctx.translate(x, y);\n    ctx.rotate(ang);\n    ctx.strokeStyle = \"#334155\";\n    ctx.lineWidth = 4;\n    ctx.beginPath();\n    ctx.arc(0, 0, r, 0, Math.PI*2);\n    ctx.stroke();\n    // Spokes\n    ctx.lineWidth = 1;\n    for(let i=0; i<3; i++) {\n        ctx.beginPath();\n        ctx.moveTo(0, -r);\n        ctx.lineTo(0, r);\n        ctx.stroke();\n        ctx.rotate(Math.PI/3);\n    }\n    ctx.restore();\n}\n\n// Kick off once the DOM is ready (script is loaded at the end of the body)\ninit();\n\nfunction drawWind(roadY) {\n    ctx.strokeStyle = \"rgba(255,255,255,0.4)\";\n    ctx.lineWidth = 2;\n    particles.forEach(p => {\n        p.x -= (state.vCurrent * 3) * p.speedMod; // Scale wind speed\n        if(p.x < -50) {\n            p.x = canvas.width + 50;\n            p.y = Math.random() * (roadY - 20);\n        }\n        ctx.beginPath();\n        ctx.moveTo(p.x, p.y);\n        ctx.lineTo(p.x + p.len, p.y);\n        ctx.stroke();\n    });\n}\n\nfunction drawWind(roadY) {\n    // Wind streaks move faster as speed rises to give a sense of motion\n    const speed = 60 + state.vCurrent * 25; // px/s baseline + speed-driven\n    ctx.strokeStyle = \"rgba(59, 130, 246, 0.35)\";\n    ctx.lineWidth = 2;\n\n    particles.forEach(p => {\n        p.x -= speed * 0.016 * p.speedMod; // fixed timestep to match loop\n\n        // Respawn when off screen\n        if (p.x + p.len < 0) {\n            p.x = canvas.width + Math.random() * 80;\n            p.y = Math.random() * roadY * 0.8;\n            p.len = 10 + Math.random() * 30;\n        }\n\n        ctx.beginPath();\n        ctx.moveTo(p.x, p.y);\n        ctx.lineTo(p.x + p.len, p.y);\n        ctx.stroke();\n    });\n}"}}
{"input": {"input_text": "Single-zone cooling load: Q = UA*(Tin - Tout). Compute required UA or cooling rate.", "simulation_name": " HVAC Conductive Load", "domain": "HVAC", "description": "Steady conductive load", "assumptions": ["Steady state"], "entities": [], "constants": [], "parameters": [{"name": "overall_UA", "symbol": "UA", "unit": "W/K", "range": [10, 100000.0]}, {"name": "indoor_temp", "symbol": "Tin", "unit": "C", "range": [10, 40]}, {"name": "outdoor_temp", "symbol": "Tout", "unit": "C", "range": [-30, 50]}], "equations": [{"description": "Heat rate", "expression": "Q = UA*(Tin - Tout)"}], "initial_conditions": {}, "outputs": ["Q"], "simulation_controls": ["UA", "Tin", "Tout"], "constraints": ["UA>=0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S45 HVAC Conductive Load</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"main-container\">\n    <header>\n        <h1>HVAC Conductive Load Simulator</h1>\n        <p>Steady State Heat Transfer: Single Zone</p>\n    </header>\n\n    <div class=\"simulation-layout\">\n        <div class=\"canvas-container\">\n            <canvas id=\"simCanvas\"></canvas>\n            <div class=\"canvas-overlay\">\n                <div class=\"temp-label outside\" id=\"label-tout\">Outside: 35°C</div>\n                <div class=\"temp-label inside\" id=\"label-tin\">Inside: 24°C</div>\n            </div>\n        </div>\n\n        <div class=\"controls-container\">\n            \n            <div class=\"result-card\">\n                <h3>Calculated Heat Rate ($Q$)</h3>\n                <div class=\"equation\">\n                    $$ Q = UA \\cdot (T_{out} - T_{in}) $$\n                </div>\n                <div class=\"result-value\">\n                    <span id=\"q-value\">0</span> <span class=\"unit\">Watts</span>\n                </div>\n                <div class=\"status-badge\" id=\"load-status\">Cooling Required</div>\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"tout\">\n                    Outdoor Temp ($T_{out}$): <span id=\"val-tout\">35</span>°C\n                </label>\n                <input type=\"range\" id=\"tout\" min=\"-30\" max=\"50\" step=\"1\" value=\"35\">\n                <div class=\"slider-track-visual temp-track\"></div>\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"tin\">\n                    Indoor Temp ($T_{in}$): <span id=\"val-tin\">24</span>°C\n                </label>\n                <input type=\"range\" id=\"tin\" min=\"10\" max=\"40\" step=\"1\" value=\"24\">\n                <div class=\"slider-track-visual temp-track\"></div>\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"ua\">\n                    Overall UA Value: <span id=\"val-ua\">200</span> W/K\n                </label>\n                <input type=\"range\" id=\"ua\" min=\"10\" max=\"2000\" step=\"10\" value=\"200\">\n                <small>Conductance (Insulation Level)</small>\n            </div>\n\n        </div>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary-bg: #f4f7f6;\n    --panel-bg: #ffffff;\n    --text-main: #2c3e50;\n    --accent-blue: #3498db;\n    --accent-red: #e74c3c;\n    --border-radius: 12px;\n}\n\nbody {\n    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--primary-bg);\n    color: var(--text-main);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n    min-height: 100vh;\n}\n\n.main-container {\n    width: 100%;\n    max-width: 1000px;\n    background: var(--panel-bg);\n    border-radius: var(--border-radius);\n    box-shadow: 0 10px 30px rgba(0,0,0,0.1);\n    padding: 30px;\n    display: flex;\n    flex-direction: column;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 30px;\n}\n\nheader h1 { margin: 0; font-size: 1.8rem; }\nheader p { margin: 5px 0 0; color: #7f8c8d; }\n\n.simulation-layout {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 30px;\n}\n\n@media (max-width: 768px) {\n    .simulation-layout { grid-template-columns: 1fr; }\n}\n\n/* Canvas Area */\n.canvas-container {\n    position: relative;\n    height: 400px;\n    border-radius: var(--border-radius);\n    overflow: hidden;\n    border: 1px solid #ddd;\n    box-shadow: inset 0 0 20px rgba(0,0,0,0.05);\n}\n\ncanvas {\n    display: block;\n    width: 100%;\n    height: 100%;\n}\n\n.canvas-overlay {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    pointer-events: none;\n    display: flex;\n    justify-content: space-between;\n    padding: 20px;\n    box-sizing: border-box;\n}\n\n.temp-label {\n    background: rgba(255, 255, 255, 0.85);\n    padding: 8px 15px;\n    border-radius: 20px;\n    font-weight: bold;\n    font-size: 0.9rem;\n    height: fit-content;\n    box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n    backdrop-filter: blur(4px);\n}\n\n/* Controls */\n.controls-container {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.result-card {\n    background: #ecf0f1;\n    padding: 20px;\n    border-radius: var(--border-radius);\n    text-align: center;\n    border-left: 5px solid #95a5a6; /* Changes dynamically via JS */\n    transition: border-color 0.3s;\n}\n\n.result-card h3 { margin-top: 0; font-size: 1rem; color: #7f8c8d; }\n.equation { margin-bottom: 10px; font-size: 1.1em; }\n\n.result-value {\n    font-size: 2.5rem;\n    font-weight: 800;\n    color: var(--text-main);\n}\n\n.unit { font-size: 1rem; font-weight: 400; color: #7f8c8d; }\n\n.status-badge {\n    display: inline-block;\n    margin-top: 10px;\n    padding: 5px 12px;\n    border-radius: 4px;\n    background: #bdc3c7;\n    color: white;\n    font-weight: bold;\n    font-size: 0.85rem;\n}\n\n.input-group {\n    display: flex;\n    flex-direction: column;\n}\n\nlabel { font-weight: 600; margin-bottom: 8px; display: flex; justify-content: space-between; }\n\ninput[type=range] {\n    width: 100%;\n    cursor: pointer;\n}\n\nsmall { color: #95a5a6; font-style: italic; margin-top: 4px; }", "js": "const canvas = document.getElementById('simCanvas');\nconst ctx = canvas.getContext('2d');\n\n// DOM Elements\nconst inputs = {\n    ua: document.getElementById('ua'),\n    tin: document.getElementById('tin'),\n    tout: document.getElementById('tout')\n};\nconst displays = {\n    ua: document.getElementById('val-ua'),\n    tin: document.getElementById('val-tin'),\n    tout: document.getElementById('val-tout'),\n    q: document.getElementById('q-value'),\n    status: document.getElementById('load-status'),\n    card: document.querySelector('.result-card'),\n    labelIn: document.getElementById('label-tin'),\n    labelOut: document.getElementById('label-tout')\n};\n\n// State\nlet params = {\n    ua: 200,\n    tin: 24,\n    tout: 35\n};\n\n// Animation State\nlet particles = [];\nlet lastTime = 0;\n\n// Initialize\nfunction init() {\n    resizeCanvas();\n    window.addEventListener('resize', resizeCanvas);\n    \n    // Listeners\n    Object.values(inputs).forEach(input => {\n        input.addEventListener('input', updateSim);\n    });\n\n    // Create initial particle pool\n    for(let i=0; i<50; i++) {\n        particles.push(createParticle());\n    }\n\n    updateSim();\n    requestAnimationFrame(animate);\n}\n\nfunction resizeCanvas() {\n    canvas.width = canvas.parentElement.clientWidth;\n    canvas.height = canvas.parentElement.clientHeight;\n}\n\nfunction createParticle() {\n    return {\n        x: Math.random() * canvas.width,\n        y: Math.random() * canvas.height,\n        speed: 0,\n        size: Math.random() * 3 + 2,\n        offset: Math.random() * 100\n    };\n}\n\n// Core Logic\nfunction updateSim() {\n    // Read values\n    params.ua = parseFloat(inputs.ua.value);\n    params.tin = parseFloat(inputs.tin.value);\n    params.tout = parseFloat(inputs.tout.value);\n\n    // Update Text Displays\n    displays.ua.textContent = params.ua;\n    displays.tin.textContent = params.tin;\n    displays.tout.textContent = params.tout;\n    \n    // Labels on canvas\n    displays.labelIn.textContent = `Inside: ${params.tin}°C`;\n    displays.labelOut.textContent = `Outside: ${params.tout}°C`;\n\n    // Calculate Q\n    // Note: Standard convention Q = UA * (Tout - Tin) for Gain\n    // If Result is positive: Heat Gain (Cooling Load needed)\n    // If Result is negative: Heat Loss (Heating Load needed)\n    const deltaT = params.tout - params.tin;\n    const Q = params.ua * deltaT;\n\n    // Display Result\n    displays.q.textContent = Math.abs(Q).toFixed(0);\n\n    // Update UI Styles based on state\n    if (Q > 0) {\n        displays.status.textContent = \"HEAT GAIN (Cooling Required)\";\n        displays.status.style.background = \"#e74c3c\"; // Red\n        displays.card.style.borderLeftColor = \"#e74c3c\";\n    } else if (Q < 0) {\n        displays.status.textContent = \"HEAT LOSS (Heating Required)\";\n        displays.status.style.background = \"#3498db\"; // Blue\n        displays.card.style.borderLeftColor = \"#3498db\";\n    } else {\n        displays.status.textContent = \"EQUILIBRIUM\";\n        displays.status.style.background = \"#2ecc71\"; // Green\n        displays.card.style.borderLeftColor = \"#2ecc71\";\n    }\n}\n\n// Helper: Get color from temperature\nfunction getTempColor(temp) {\n    // Map -30 (Deep Blue) to 50 (Deep Red)\n    // 20 is approx neutral (Greenish/White)\n    \n    // Normalize -30 to 50 -> 0 to 1\n    const tMin = -30;\n    const tMax = 50;\n    let norm = (temp - tMin) / (tMax - tMin);\n    norm = Math.max(0, Math.min(1, norm));\n\n    // Simple R,G,B interpolation\n    // Cold (0, 0, 255) -> Hot (255, 0, 0)\n    const r = Math.floor(norm * 255);\n    const b = Math.floor((1 - norm) * 255);\n    const g = Math.floor(100 - Math.abs(norm - 0.5) * 150); // Little green in middle\n    \n    return `rgb(${r}, ${g}, ${b})`;\n}\n\n// Animation Loop\nfunction animate(time) {\n    const dt = (time - lastTime) / 1000;\n    lastTime = time;\n\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    // 1. Draw Backgrounds (Temperatures)\n    const wallX = canvas.width / 2;\n    // Wall thickness visual varies slightly with UA (Inverse relationship conceptually, \n    // but usually higher UA means thinner insulation. Let's make wall width static \n    // but visualize insulation density or just keep it simple with colors).\n    const wallWidth = 40; \n\n    const colorOut = getTempColor(params.tout);\n    const colorIn = getTempColor(params.tin);\n\n    // Outside (Left)\n    ctx.fillStyle = colorOut;\n    ctx.fillRect(0, 0, wallX - wallWidth/2, canvas.height);\n\n    // Inside (Right)\n    ctx.fillStyle = colorIn;\n    ctx.fillRect(wallX + wallWidth/2, 0, canvas.width, canvas.height);\n\n    // 2. Draw Wall\n    ctx.fillStyle = \"#95a5a6\";\n    ctx.fillRect(wallX - wallWidth/2, 0, wallWidth, canvas.height);\n    \n    // Wall texture/hatch\n    ctx.strokeStyle = \"#7f8c8d\";\n    ctx.lineWidth = 1;\n    ctx.beginPath();\n    for(let i=0; i<canvas.height; i+=20) {\n        ctx.moveTo(wallX - wallWidth/2, i);\n        ctx.lineTo(wallX + wallWidth/2, i+20);\n    }\n    ctx.stroke();\n\n    // 3. Draw Heat Flux (Particles)\n    // Direction: Tout > Tin ? Left to Right : Right to Left\n    const deltaT = params.tout - params.tin;\n    \n    // Speed proportional to Q (or UA * deltaT)\n    // We log scale visual speed so it doesn't get too crazy\n    const speedFactor = Math.log(Math.abs(params.ua * deltaT) + 1) * 2;\n    const direction = deltaT > 0 ? 1 : -1;\n\n    ctx.fillStyle = \"rgba(255, 255, 255, 0.6)\";\n\n    if (Math.abs(deltaT) < 0.5) {\n        // Equilibrium - No flow\n        ctx.font = \"20px Arial\";\n        ctx.fillStyle = \"white\";\n        ctx.textAlign = \"center\";\n        ctx.fillText(\"No Heat Transfer\", wallX, canvas.height/2);\n    } else {\n        particles.forEach(p => {\n            // Update Position\n            p.x += speedFactor * direction;\n\n            // Reset logic\n            if (direction === 1) { // Moving Right\n                if (p.x > canvas.width) p.x = -20;\n            } else { // Moving Left\n                if (p.x < -20) p.x = canvas.width + 20;\n            }\n\n            // Draw Arrow/Particle\n            ctx.beginPath();\n            ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);\n            ctx.fill();\n        });\n        \n        // Draw Main Arrow Overlay\n        drawBigArrow(wallX, canvas.height/2, direction, Math.abs(deltaT));\n    }\n\n    requestAnimationFrame(animate);\n}\n\nfunction drawBigArrow(x, y, dir, magnitude) {\n    ctx.save();\n    ctx.translate(x, y);\n    if (dir === -1) ctx.rotate(Math.PI);\n    \n    const scale = Math.min(1 + magnitude/20, 3); // Scale arrow by temp diff\n    \n    ctx.beginPath();\n    ctx.moveTo(-30 * scale, -10 * scale);\n    ctx.lineTo(0, -10 * scale);\n    ctx.lineTo(0, -20 * scale);\n    ctx.lineTo(30 * scale, 0);\n    ctx.lineTo(0, 20 * scale);\n    ctx.lineTo(0, 10 * scale);\n    ctx.lineTo(-30 * scale, 10 * scale);\n    ctx.closePath();\n    \n    ctx.fillStyle = \"rgba(255, 255, 255, 0.4)\";\n    ctx.shadowBlur = 10;\n    ctx.shadowColor = \"white\";\n    ctx.fill();\n    ctx.restore();\n}\n\n// Start\ninit();"}}
{"input": {"input_text": "Counterflow heat exchanger LMTD: Q = U*A*LMTD with LMTD = (dT1 - dT2)/ln(dT1/dT2).", "simulation_name": " Heat Exchanger LMTD", "domain": "Thermal", "description": "Steady heat exchanger duty", "assumptions": ["Constant U", "No phase change"], "entities": [], "constants": [], "parameters": [{"name": "overall_U", "symbol": "U", "unit": "W/(m^2*K)", "range": [10, 2000]}, {"name": "area", "symbol": "A", "unit": "m^2", "range": [0.1, 500]}, {"name": "deltaT_hot_cold_in", "symbol": "dT1", "unit": "K", "range": [1, 200]}, {"name": "deltaT_hot_cold_out", "symbol": "dT2", "unit": "K", "range": [1, 200]}], "equations": [{"description": "LMTD", "condition": "dT1!=dT2", "expression": "LMTD = (dT1 - dT2)/ln(dT1/dT2)"}, {"description": "Heat duty", "expression": "Q = U*A*LMTD"}], "initial_conditions": {}, "outputs": ["LMTD", "Q"], "simulation_controls": ["U", "A", "dT1", "dT2"], "constraints": ["dT1>0", "dT2>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Counterflow Heat Exchanger LMTD</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"app-container\">\n    <header>\n        <h1>Counterflow Heat Exchanger</h1>\n        <p class=\"subtitle\">Log Mean Temperature Difference (LMTD) & Duty Calculator</p>\n    </header>\n\n    <div class=\"simulation-layout\">\n        \n        <div class=\"controls-panel\">\n            <div class=\"panel-header\">Input Parameters</div>\n            \n            <div class=\"control-group\">\n                <label>\n                    Overall Heat Transfer Coeff ($U$)\n                    <span class=\"unit\">W/(m²·K)</span>\n                </label>\n                <div class=\"slider-row\">\n                    <input type=\"range\" id=\"u-slider\" min=\"10\" max=\"2000\" step=\"10\" value=\"800\">\n                    <input type=\"number\" id=\"u-number\" value=\"800\">\n                </div>\n            </div>\n\n            <div class=\"control-group\">\n                <label>\n                    Heat Transfer Area ($A$)\n                    <span class=\"unit\">m²</span>\n                </label>\n                <div class=\"slider-row\">\n                    <input type=\"range\" id=\"a-slider\" min=\"0.1\" max=\"500\" step=\"0.1\" value=\"50\">\n                    <input type=\"number\" id=\"a-number\" value=\"50\">\n                </div>\n            </div>\n\n            <div class=\"divider\"></div>\n\n            <div class=\"control-group\">\n                <label>\n                    $\\Delta T_1$ (Left Side Gap)\n                    <span class=\"tooltip\">Hot In - Cold Out</span>\n                </label>\n                <div class=\"slider-row\">\n                    <input type=\"range\" id=\"dt1-slider\" min=\"5\" max=\"200\" step=\"1\" value=\"90\">\n                    <input type=\"number\" id=\"dt1-number\" value=\"90\">\n                    <span class=\"unit\">K</span>\n                </div>\n            </div>\n\n            <div class=\"control-group\">\n                <label>\n                    $\\Delta T_2$ (Right Side Gap)\n                    <span class=\"tooltip\">Hot Out - Cold In</span>\n                </label>\n                <div class=\"slider-row\">\n                    <input type=\"range\" id=\"dt2-slider\" min=\"5\" max=\"200\" step=\"1\" value=\"40\">\n                    <input type=\"number\" id=\"dt2-number\" value=\"40\">\n                    <span class=\"unit\">K</span>\n                </div>\n            </div>\n\n            <div class=\"results-box\">\n                <div class=\"result-row\">\n                    <span>LMTD:</span>\n                    <strong id=\"res-lmtd\" class=\"highlight-text\">0.00 K</strong>\n                </div>\n                <div class=\"result-row\">\n                    <span>Heat Duty (Q):</span>\n                    <strong id=\"res-q\" class=\"highlight-text\">0.00 kW</strong>\n                </div>\n            </div>\n            \n            <div class=\"equations\">\n                $$Q = U \\cdot A \\cdot \\text{LMTD}$$\n                $$\\text{LMTD} = \\frac{\\Delta T_1 - \\Delta T_2}{\\ln(\\Delta T_1 / \\Delta T_2)}$$\n            </div>\n        </div>\n\n        <div class=\"visualization-panel\">\n            <div class=\"canvas-wrapper\">\n                <canvas id=\"simCanvas\"></canvas>\n            </div>\n            <div class=\"legend\">\n                <div class=\"legend-item\">\n                    <div class=\"legend-color hot\"></div> \n                    <span>Hot Fluid (Flows Right &rarr;)</span>\n                </div>\n                <div class=\"legend-item\">\n                    <div class=\"legend-color cold\"></div> \n                    <span>Cold Fluid (Flows Left &larr;)</span>\n                </div>\n            </div>\n            <div class=\"info-text\">\n                Note: In Counterflow, the outlet temperature of the cold fluid can exceed the outlet temperature of the hot fluid, making it more efficient than parallel flow.\n            </div>\n        </div>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary: #2c3e50;\n    --accent: #3498db;\n    --hot: #ff4757;\n    --cold: #1e90ff;\n    --bg: #f8f9fa;\n    --panel-bg: #ffffff;\n    --border: #e9ecef;\n}\n\nbody {\n    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg);\n    color: var(--primary);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n    min-height: 100vh;\n}\n\n.app-container {\n    background: var(--panel-bg);\n    width: 100%;\n    max-width: 1100px;\n    border-radius: 12px;\n    box-shadow: 0 10px 30px rgba(0,0,0,0.1);\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n}\n\nheader {\n    background: var(--primary);\n    color: white;\n    padding: 20px;\n    text-align: center;\n}\n\nheader h1 { margin: 0; font-size: 1.8rem; }\n.subtitle { margin: 5px 0 0; opacity: 0.8; font-weight: 300; }\n\n.simulation-layout {\n    display: flex;\n    flex-wrap: wrap;\n}\n\n/* Controls Section */\n.controls-panel {\n    flex: 1;\n    min-width: 320px;\n    padding: 25px;\n    background: #fdfdfd;\n    border-right: 1px solid var(--border);\n}\n\n.panel-header {\n    font-size: 1.1rem;\n    font-weight: 700;\n    margin-bottom: 20px;\n    color: var(--primary);\n    text-transform: uppercase;\n    letter-spacing: 1px;\n}\n\n.control-group { margin-bottom: 20px; }\n\n.control-group label {\n    display: flex;\n    justify-content: space-between;\n    font-weight: 600;\n    font-size: 0.9rem;\n    margin-bottom: 8px;\n}\n\n.unit { color: #888; font-weight: 400; font-size: 0.8rem; }\n.tooltip { font-size: 0.8rem; color: #666; font-style: italic; }\n\n.slider-row {\n    display: flex;\n    align-items: center;\n    gap: 15px;\n}\n\ninput[type=\"range\"] {\n    flex: 1;\n    height: 6px;\n    background: #ddd;\n    border-radius: 5px;\n    outline: none;\n    -webkit-appearance: none;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    width: 18px;\n    height: 18px;\n    background: var(--accent);\n    border-radius: 50%;\n    cursor: pointer;\n    transition: transform 0.1s;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb:hover { transform: scale(1.2); }\n\ninput[type=\"number\"] {\n    width: 70px;\n    padding: 6px;\n    border: 1px solid #ccc;\n    border-radius: 4px;\n    text-align: right;\n    font-weight: bold;\n    color: var(--primary);\n}\n\n.divider { height: 1px; background: var(--border); margin: 20px 0; }\n\n.results-box {\n    background: #eef2f5;\n    padding: 15px;\n    border-radius: 8px;\n    margin-top: 10px;\n    border-left: 5px solid var(--accent);\n}\n\n.result-row {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 8px;\n    font-size: 1rem;\n}\n.result-row:last-child { margin-bottom: 0; }\n\n.highlight-text { color: var(--accent); font-size: 1.1rem; }\n\n.equations {\n    margin-top: 20px;\n    text-align: center;\n    font-size: 0.9rem;\n    opacity: 0.8;\n    background: #fff;\n    padding: 10px;\n    border: 1px solid #eee;\n    border-radius: 6px;\n}\n\n/* Visualization Section */\n.visualization-panel {\n    flex: 2;\n    min-width: 400px;\n    padding: 25px;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    background: white;\n}\n\n.canvas-wrapper {\n    width: 100%;\n    height: 450px;\n    border: 1px solid #ddd;\n    border-radius: 8px;\n    box-shadow: inset 0 0 20px rgba(0,0,0,0.02);\n    position: relative;\n    background: #fff;\n}\n\ncanvas {\n    width: 100%;\n    height: 100%;\n    display: block;\n}\n\n.legend {\n    display: flex;\n    gap: 30px;\n    margin-top: 15px;\n}\n\n.legend-item {\n    display: flex;\n    align-items: center;\n    font-size: 0.9rem;\n    font-weight: 500;\n}\n\n.legend-color {\n    width: 16px;\n    height: 16px;\n    margin-right: 8px;\n    border-radius: 3px;\n}\n.legend-color.hot { background: var(--hot); }\n.legend-color.cold { background: var(--cold); }\n\n.info-text {\n    margin-top: 15px;\n    font-size: 0.85rem;\n    color: #777;\n    text-align: center;\n    max-width: 80%;\n}\n\n@media (max-width: 850px) {\n    .simulation-layout { flex-direction: column; }\n    .controls-panel { border-right: none; border-bottom: 1px solid var(--border); }\n    .canvas-wrapper { height: 350px; }\n}", "js": "// --- Configuration & State ---\nconst state = {\n    U: 800,\n    A: 50,\n    dT1: 90, // Hot In - Cold Out\n    dT2: 40  // Hot Out - Cold In\n};\n\nconst dom = {\n    inputs: {\n        U: { slider: document.getElementById('u-slider'), num: document.getElementById('u-number') },\n        A: { slider: document.getElementById('a-slider'), num: document.getElementById('a-number') },\n        dT1: { slider: document.getElementById('dt1-slider'), num: document.getElementById('dt1-number') },\n        dT2: { slider: document.getElementById('dt2-slider'), num: document.getElementById('dt2-number') }\n    },\n    results: {\n        lmtd: document.getElementById('res-lmtd'),\n        q: document.getElementById('res-q')\n    },\n    canvas: document.getElementById('simCanvas')\n};\n\nconst ctx = dom.canvas.getContext('2d');\nlet animationFrameId;\nlet flowOffset = 0;\n\n// --- Initialization ---\n\nfunction init() {\n    // Attach event listeners\n    Object.keys(dom.inputs).forEach(key => {\n        const { slider, num } = dom.inputs[key];\n        \n        slider.addEventListener('input', (e) => {\n            num.value = e.target.value;\n            state[key] = parseFloat(e.target.value);\n            updatePhysics();\n        });\n\n        num.addEventListener('input', (e) => {\n            let val = parseFloat(e.target.value);\n            if (isNaN(val)) return;\n            // Clamp within min/max of slider\n            const min = parseFloat(slider.min);\n            const max = parseFloat(slider.max);\n            if (val < min) val = min;\n            if (val > max) val = max;\n            \n            slider.value = val;\n            state[key] = val;\n            updatePhysics();\n        });\n    });\n\n    // Handle Resize\n    window.addEventListener('resize', resizeCanvas);\n    resizeCanvas();\n    \n    // Start Loop\n    updatePhysics();\n    animate();\n}\n\n// --- Physics Calculation ---\n\nfunction updatePhysics() {\n    // Calculate LMTD\n    let lmtd;\n    if (Math.abs(state.dT1 - state.dT2) < 0.1) {\n        lmtd = state.dT1; // Limit as dT1 -> dT2\n    } else {\n        lmtd = (state.dT1 - state.dT2) / Math.log(state.dT1 / state.dT2);\n    }\n\n    // Calculate Heat Duty Q (Watts)\n    const q = state.U * state.A * lmtd;\n\n    // Update DOM\n    dom.results.lmtd.textContent = lmtd.toFixed(2) + \" K\";\n    dom.results.q.textContent = (q / 1000).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2}) + \" kW\";\n}\n\n// --- Drawing & Animation ---\n\nfunction resizeCanvas() {\n    const parent = dom.canvas.parentElement;\n    dom.canvas.width = parent.clientWidth;\n    dom.canvas.height = parent.clientHeight;\n}\n\nfunction animate() {\n    // Clear\n    ctx.clearRect(0, 0, dom.canvas.width, dom.canvas.height);\n\n    // Update animation state\n    flowOffset = (flowOffset + 1.5) % 20; // Speed of flow\n\n    drawDiagram();\n    drawGraph();\n\n    animationFrameId = requestAnimationFrame(animate);\n}\n\nfunction drawDiagram() {\n    const w = dom.canvas.width;\n    const h = dom.canvas.height;\n    \n    // Layout Constants\n    const diagramTop = 40;\n    const pipeLength = w - 100; // Margins\n    const startX = 50;\n    const outerH = 80;\n    const innerH = 40;\n    const centerY = diagramTop + outerH / 2;\n\n    // 1. Outer Pipe (Cold Fluid) - Shell\n    ctx.fillStyle = '#eef6fc';\n    ctx.strokeStyle = '#1e90ff';\n    ctx.lineWidth = 2;\n    // Top half\n    ctx.fillRect(startX, centerY - outerH/2, pipeLength, (outerH - innerH)/2);\n    ctx.strokeRect(startX, centerY - outerH/2, pipeLength, (outerH - innerH)/2);\n    // Bottom half\n    ctx.fillRect(startX, centerY + innerH/2, pipeLength, (outerH - innerH)/2);\n    ctx.strokeRect(startX, centerY + innerH/2, pipeLength, (outerH - innerH)/2);\n\n    // 2. Inner Pipe (Hot Fluid) - Tube\n    ctx.fillStyle = '#fff0f0';\n    ctx.strokeStyle = '#ff4757';\n    ctx.fillRect(startX, centerY - innerH/2, pipeLength, innerH);\n    ctx.strokeRect(startX, centerY - innerH/2, pipeLength, innerH);\n\n    // 3. Flow Animation (Dashed Lines)\n    \n    // Cold Fluid (Flows Left <--)\n    ctx.beginPath();\n    ctx.strokeStyle = '#1e90ff';\n    ctx.lineWidth = 2;\n    ctx.setLineDash([10, 10]);\n    ctx.lineDashOffset = -flowOffset; // Move Left\n    \n    // Top channel\n    const coldYTop = centerY - outerH/2 + (outerH-innerH)/4;\n    ctx.moveTo(pipeLength + startX, coldYTop);\n    ctx.lineTo(startX, coldYTop);\n    // Bottom channel\n    const coldYBot = centerY + innerH/2 + (outerH-innerH)/4;\n    ctx.moveTo(pipeLength + startX, coldYBot);\n    ctx.lineTo(startX, coldYBot);\n    ctx.stroke();\n\n    // Hot Fluid (Flows Right -->)\n    ctx.beginPath();\n    ctx.strokeStyle = '#ff4757';\n    ctx.lineWidth = 2;\n    ctx.lineDashOffset = flowOffset; // Move Right\n    ctx.moveTo(startX, centerY);\n    ctx.lineTo(startX + pipeLength, centerY);\n    ctx.stroke();\n    \n    ctx.setLineDash([]); // Reset dash\n\n    // 4. Heat Transfer Indicators (Wavy lines from Hot to Cold)\n    // We draw small arrows animating outwards from center pipe\n    const time = Date.now() / 500;\n    ctx.strokeStyle = 'orange';\n    ctx.lineWidth = 1.5;\n    \n    for(let i=0; i<6; i++) {\n        let x = startX + (pipeLength/7) * (i+1);\n        let waveY = Math.sin(x/20 + time*5) * 2;\n        \n        // Upward arrow (Hot -> Cold Top)\n        drawArrow(ctx, x, centerY - innerH/2 + 2, x, centerY - innerH/2 - 15, 4);\n        \n        // Downward arrow (Hot -> Cold Bottom)\n        drawArrow(ctx, x, centerY + innerH/2 - 2, x, centerY + innerH/2 + 15, 4);\n    }\n\n    // Labels\n    ctx.fillStyle = '#333';\n    ctx.font = 'bold 12px Arial';\n    ctx.fillText(\"Hot Fluid \\u2192\", startX + 10, centerY + 4);\n    ctx.fillText(\"Cold \\u2190\", startX + pipeLength - 50, centerY - outerH/2 + 15);\n}\n\nfunction drawGraph() {\n    const w = dom.canvas.width;\n    const h = dom.canvas.height;\n    \n    const startX = 50;\n    const pipeLength = w - 100;\n    const graphTop = 180;\n    const graphH = h - graphTop - 40;\n    const graphBot = graphTop + graphH;\n\n    // Draw Axes\n    ctx.beginPath();\n    ctx.strokeStyle = '#aaa';\n    ctx.lineWidth = 1;\n    // Y-Axis\n    ctx.moveTo(startX, graphTop);\n    ctx.lineTo(startX, graphBot);\n    // X-Axis\n    ctx.lineTo(startX + pipeLength, graphBot);\n    ctx.stroke();\n\n    // Labels\n    ctx.fillStyle = '#666';\n    ctx.font = '12px Arial';\n    ctx.fillText(\"Temperature (T)\", startX - 40, graphTop + graphH/2);\n    ctx.fillText(\"Position (Length)\", startX + pipeLength/2 - 30, graphBot + 30);\n\n    // --- Dynamic Temperature Profile Calculation ---\n    // We simulate realistic temps to make the graph look correct visually\n    // Logic: \n    // Left (x=0): Hot_In, Cold_Out. Diff = dT1\n    // Right (x=L): Hot_Out, Cold_In. Diff = dT2\n    \n    // Arbitrary anchor point: Cold Inlet at Right = 20 deg (visual units)\n    // Scaling: We need to fit everything in graphH (approx 150px)\n    // Let's assume max possible temp visual range is 120 units.\n    \n    // We need to define a visual drop for the hot fluid to give the lines slope.\n    // Let's assume Hot drops by roughly 30-50 units visually to show the process.\n    const visualHotDrop = 50; \n    \n    // Math for Y positions (0 is top in canvas, so higher temp = smaller Y)\n    // We map 0-200 temperature scale to graph pixel range\n    \n    const tempScale = 0.8; // pixels per degree\n    const baseTempY = graphBot - 20; // Y position of \"0 degrees\"\n    \n    // T_cold_in (Right) = 20\n    const Tc_in_val = 20;\n    const Tc_in_y = baseTempY - (Tc_in_val * tempScale);\n    \n    // T_hot_out (Right) = Tc_in + dT2\n    const Th_out_val = Tc_in_val + state.dT2;\n    const Th_out_y = baseTempY - (Th_out_val * tempScale);\n    \n    // T_hot_in (Left) = Th_out + visualHotDrop\n    // (We add visual drop to show slope)\n    const Th_in_val = Th_out_val + visualHotDrop; \n    const Th_in_y = baseTempY - (Th_in_val * tempScale);\n    \n    // T_cold_out (Left) = Th_in - dT1\n    const Tc_out_val = Th_in_val - state.dT1;\n    const Tc_out_y = baseTempY - (Tc_out_val * tempScale);\n    \n    // Safety check: Ensure graph doesn't go out of bounds (simple clamp for visual safety)\n    // If dT1 is huge, Tc_out might go below zero (visual negative). \n    // The graph handles negative Y technically, but let's shift if needed.\n    // (Omitted for simplicity, assuming reasonable inputs)\n\n    // Draw Hot Line (Red)\n    ctx.beginPath();\n    ctx.strokeStyle = '#ff4757';\n    ctx.lineWidth = 3;\n    ctx.moveTo(startX, Th_in_y);\n    ctx.lineTo(startX + pipeLength, Th_out_y);\n    ctx.stroke();\n    \n    // Draw Cold Line (Blue)\n    ctx.beginPath();\n    ctx.strokeStyle = '#1e90ff';\n    ctx.lineWidth = 3;\n    ctx.moveTo(startX, Tc_out_y);\n    ctx.lineTo(startX + pipeLength, Tc_in_y);\n    ctx.stroke();\n\n    // Draw Measurements (dT1 and dT2)\n    drawDimension(startX, Th_in_y, Tc_out_y, \"ΔT1\", true); // Left\n    drawDimension(startX + pipeLength, Th_out_y, Tc_in_y, \"ΔT2\", false); // Right\n    \n    // Draw dots at endpoints\n    drawDot(startX, Th_in_y, '#ff4757');\n    drawDot(startX + pipeLength, Th_out_y, '#ff4757');\n    drawDot(startX, Tc_out_y, '#1e90ff');\n    drawDot(startX + pipeLength, Tc_in_y, '#1e90ff');\n}\n\nfunction drawDimension(x, y1, y2, label, isLeft) {\n    // y1 is hot (higher temp, lower Y value usually, but inputs vary)\n    // Ensure we draw from min to max\n    const top = Math.min(y1, y2);\n    const bot = Math.max(y1, y2);\n    \n    ctx.beginPath();\n    ctx.strokeStyle = '#333';\n    ctx.lineWidth = 1;\n    \n    // Main vertical line\n    const offset = isLeft ? -15 : 15;\n    ctx.moveTo(x + offset, top);\n    ctx.lineTo(x + offset, bot);\n    \n    // Ticks\n    ctx.moveTo(x + offset - 4, top);\n    ctx.lineTo(x + offset + 4, top);\n    ctx.moveTo(x + offset - 4, bot);\n    ctx.lineTo(x + offset + 4, bot);\n    \n    // Connect to points (dashed)\n    ctx.setLineDash([2, 2]);\n    ctx.moveTo(x, top);\n    ctx.lineTo(x + offset, top);\n    ctx.moveTo(x, bot);\n    ctx.lineTo(x + offset, bot);\n    ctx.stroke();\n    ctx.setLineDash([]);\n\n    // Arrows\n    // (Simple triangle)\n    \n    // Label\n    ctx.fillStyle = '#333';\n    ctx.textAlign = isLeft ? 'right' : 'left';\n    ctx.textBaseline = 'middle';\n    ctx.font = 'bold 12px Arial';\n    ctx.fillText(label, x + (isLeft ? -20 : 20), (top + bot) / 2);\n}\n\nfunction drawArrow(ctx, fromX, fromY, toX, toY, headLen) {\n    const angle = Math.atan2(toY - fromY, toX - fromX);\n    ctx.beginPath();\n    ctx.moveTo(fromX, fromY);\n    ctx.lineTo(toX, toY);\n    ctx.lineTo(toX - headLen * Math.cos(angle - Math.PI / 6), toY - headLen * Math.sin(angle - Math.PI / 6));\n    ctx.moveTo(toX, toY);\n    ctx.lineTo(toX - headLen * Math.cos(angle + Math.PI / 6), toY - headLen * Math.sin(angle + Math.PI / 6));\n    ctx.stroke();\n}\n\nfunction drawDot(x, y, color) {\n    ctx.beginPath();\n    ctx.fillStyle = color;\n    ctx.arc(x, y, 4, 0, Math.PI*2);\n    ctx.fill();\n}\n\n// Start\ninit();"}}
{"input": {"input_text": "Composite wall conduction: R_total = sum(L/kA). Compute overall U and heat flux for deltaT.", "simulation_name": " Composite Wall", "domain": "Thermal", "description": "Series conduction through layers", "assumptions": ["1D steady"], "entities": [], "constants": [], "parameters": [{"name": "layer_thicknesses", "symbol": "L", "unit": "m", "range": [0.001, 0.5]}, {"name": "layer_conductivities", "symbol": "k", "unit": "W/(m*K)", "range": [0.02, 400]}, {"name": "area", "symbol": "A", "unit": "m^2", "range": [0.1, 100]}, {"name": "temperature_diff", "symbol": "dT", "unit": "K", "range": [1, 100]}], "equations": [{"description": "Thermal resistance", "expression": "R = sum(L/(k*A))"}, {"description": "Overall U", "expression": "U = 1/R"}, {"description": "Heat flux", "expression": "Q = U*A*dT"}], "initial_conditions": {}, "outputs": ["R", "U", "Q"], "simulation_controls": ["L", "k", "A", "dT"], "constraints": ["A>0", "k>0", "L>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Composite Wall Thermal Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"app\">\n    <nav class=\"sidebar\">\n        <div class=\"header\">\n            <h2>Composite Wall</h2>\n            <p>Steady State Conduction</p>\n        </div>\n\n        <div class=\"controls-section\">\n            <h3>Global Settings</h3>\n            <div class=\"control-row\">\n                <label>Area ($A$) <span id=\"val-area\">10</span> m²</label>\n                <input type=\"range\" id=\"input-area\" min=\"1\" max=\"100\" value=\"10\">\n            </div>\n            <div class=\"control-row\">\n                <label>$\\Delta T$ <span id=\"val-dt\">60</span> K</label>\n                <input type=\"range\" id=\"input-dt\" min=\"10\" max=\"200\" value=\"60\">\n            </div>\n        </div>\n\n        <div class=\"controls-section\">\n            <div class=\"layer-header\">\n                <h3>Layers</h3>\n                <div class=\"btn-group\">\n                    <button id=\"btn-add\" class=\"btn primary\">+ Add</button>\n                    <button id=\"btn-remove\" class=\"btn secondary\">- Remove</button>\n                </div>\n            </div>\n            <div id=\"layers-container\" class=\"layers-list\">\n                </div>\n        </div>\n    </nav>\n\n    <main class=\"viewport\">\n        <div class=\"stats-bar\">\n            <div class=\"stat-box\">\n                <div class=\"label\">Total Resistance ($R_{tot}$)</div>\n                <div class=\"value\"><span id=\"out-R\">0.00</span> <span class=\"unit\">K/W</span></div>\n            </div>\n            <div class=\"stat-box highlight\">\n                <div class=\"label\">Heat Transfer Rate ($Q$)</div>\n                <div class=\"value\"><span id=\"out-Q\">0.00</span> <span class=\"unit\">Watts</span></div>\n            </div>\n            <div class=\"stat-box\">\n                <div class=\"label\">Overall Coefficient ($U$)</div>\n                <div class=\"value\"><span id=\"out-U\">0.00</span> <span class=\"unit\">W/m²K</span></div>\n            </div>\n        </div>\n\n        <div class=\"canvas-container\">\n            <canvas id=\"mainCanvas\"></canvas>\n            <div class=\"legend\">\n                <div class=\"item\"><span class=\"color-box hot\"></span> Hot Side</div>\n                <div class=\"item\"><span class=\"color-box cold\"></span> Cold Side</div>\n                <div class=\"item\"><span class=\"icon\">→</span> Heat Flow</div>\n            </div>\n        </div>\n\n        <div class=\"math-footer\">\n            $$ Q = \\frac{\\Delta T}{\\sum (L_i / k_i A)} $$\n        </div>\n    </main>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg: #f8f9fa;\n    --sidebar-bg: #ffffff;\n    --text: #2d3436;\n    --accent: #0984e3;\n    --accent-hover: #74b9ff;\n    --danger: #d63031;\n    --border: #dfe6e9;\n}\n\nbody {\n    margin: 0;\n    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background: var(--bg);\n    color: var(--text);\n    height: 100vh;\n    overflow: hidden;\n}\n\n.app {\n    display: flex;\n    height: 100%;\n}\n\n/* Sidebar */\n.sidebar {\n    width: 340px;\n    background: var(--sidebar-bg);\n    border-right: 1px solid var(--border);\n    display: flex;\n    flex-direction: column;\n    padding: 20px;\n    overflow-y: auto;\n    box-shadow: 2px 0 10px rgba(0,0,0,0.05);\n    z-index: 10;\n}\n\n.header h2 { margin: 0 0 5px 0; color: var(--accent); }\n.header p { margin: 0 0 20px 0; color: #636e72; font-size: 0.9em; }\n\n.controls-section { margin-bottom: 25px; }\n.controls-section h3 { font-size: 1em; text-transform: uppercase; letter-spacing: 1px; color: #b2bec3; margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 5px; }\n\n.control-row { margin-bottom: 15px; }\n.control-row label { display: flex; justify-content: space-between; font-weight: 600; font-size: 0.9em; margin-bottom: 5px; }\n.control-row input { width: 100%; cursor: pointer; }\n\n.layer-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }\n.btn-group { display: flex; gap: 5px; }\n\n.btn {\n    border: none;\n    padding: 5px 10px;\n    border-radius: 4px;\n    cursor: pointer;\n    font-weight: bold;\n    font-size: 0.8em;\n    transition: 0.2s;\n}\n.btn.primary { background: var(--accent); color: white; }\n.btn.primary:hover { background: var(--accent-hover); }\n.btn.secondary { background: var(--danger); color: white; }\n.btn.secondary:hover { background: #ff7675; }\n\n/* Dynamic Layer Cards */\n.layer-card {\n    background: #f1f2f6;\n    border-radius: 6px;\n    padding: 10px;\n    margin-bottom: 10px;\n    border-left: 4px solid #ccc;\n}\n.layer-title { font-weight: bold; font-size: 0.9em; margin-bottom: 8px; color: #2d3436; }\n\n/* Main Viewport */\n.viewport {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    padding: 20px;\n    position: relative;\n}\n\n.stats-bar {\n    display: flex;\n    gap: 20px;\n    margin-bottom: 20px;\n}\n\n.stat-box {\n    flex: 1;\n    background: white;\n    padding: 15px;\n    border-radius: 8px;\n    box-shadow: 0 2px 5px rgba(0,0,0,0.05);\n    text-align: center;\n}\n.stat-box.highlight { border: 2px solid var(--accent); background: #e3f2fd; }\n\n.stat-box .label { font-size: 0.8em; color: #636e72; text-transform: uppercase; margin-bottom: 5px; }\n.stat-box .value { font-size: 1.5em; font-weight: bold; color: var(--text); }\n.stat-box .unit { font-size: 0.5em; color: #b2bec3; vertical-align: middle; }\n\n.canvas-container {\n    flex: 1;\n    background: white;\n    border-radius: 8px;\n    box-shadow: 0 4px 10px rgba(0,0,0,0.05);\n    position: relative;\n    overflow: hidden;\n}\ncanvas { display: block; width: 100%; height: 100%; }\n\n.legend {\n    position: absolute;\n    bottom: 15px;\n    right: 15px;\n    background: rgba(255,255,255,0.9);\n    padding: 8px 15px;\n    border-radius: 20px;\n    display: flex;\n    gap: 15px;\n    font-size: 0.8em;\n    box-shadow: 0 2px 5px rgba(0,0,0,0.1);\n}\n.legend .item { display: flex; align-items: center; gap: 5px; }\n.color-box { width: 12px; height: 12px; border-radius: 50%; }\n.color-box.hot { background: #ff4757; }\n.color-box.cold { background: #3742fa; }\n\n.math-footer {\n    text-align: center;\n    margin-top: 15px;\n    font-size: 1.1em;\n    color: #636e72;\n}\n\n/* Scrollbar Styling */\n::-webkit-scrollbar { width: 8px; }\n::-webkit-scrollbar-thumb { background: #b2bec3; border-radius: 4px; }", "js": "// --- State & Config ---\nconst APP = {\n    // Physical Parameters\n    area: 10.0,\n    dt: 60.0,\n    layers: [\n        { id: 1, L: 0.2, k: 230, name: \"Aluminum\" }, // High k\n        { id: 2, L: 0.15, k: 0.04, name: \"Insulation\" }, // Very low k\n        { id: 3, L: 0.3, k: 1.5, name: \"Concrete\" }    // Medium k\n    ],\n    \n    // Animation State\n    particles: [],\n    lastTime: 0\n};\n\n// --- DOM Elements ---\nconst els = {\n    areaIn: document.getElementById('input-area'),\n    areaVal: document.getElementById('val-area'),\n    dtIn: document.getElementById('input-dt'),\n    dtVal: document.getElementById('val-dt'),\n    layerContainer: document.getElementById('layers-container'),\n    btnAdd: document.getElementById('btn-add'),\n    btnRemove: document.getElementById('btn-remove'),\n    outR: document.getElementById('out-R'),\n    outQ: document.getElementById('out-Q'),\n    outU: document.getElementById('out-U'),\n    canvas: document.getElementById('mainCanvas')\n};\n\nconst ctx = els.canvas.getContext('2d');\n\n// --- Physics Engine ---\nfunction calculate() {\n    let R_total = 0;\n    \n    // 1. Calculate Resistance per layer\n    APP.layers.forEach(l => {\n        l.R = l.L / (l.k * APP.area);\n        R_total += l.R;\n    });\n\n    // 2. Calculate Flux (Q)\n    // Ohm's Law for Heat: Q = dT / R_total\n    const Q = APP.dt / R_total;\n\n    // 3. Calculate U\n    const U = 1 / (R_total * APP.area);\n\n    // 4. Calculate Interface Temperatures (for visualization)\n    // T_drop_layer = Q * R_layer\n    // But we work in relative terms (0.0 to 1.0) for drawing\n    let currentRelTemp = 1.0; // Start at Hot (100%)\n    \n    APP.layers.forEach(l => {\n        l.tempStart = currentRelTemp;\n        const tempDropRatio = l.R / R_total;\n        l.tempEnd = currentRelTemp - tempDropRatio;\n        currentRelTemp = l.tempEnd;\n    });\n\n    return { R_total, Q, U };\n}\n\n// --- Interaction Handlers ---\nfunction init() {\n    renderLayerInputs();\n    setupListeners();\n    resize();\n    window.addEventListener('resize', resize);\n    requestAnimationFrame(loop);\n}\n\nfunction setupListeners() {\n    // Global inputs\n    els.areaIn.addEventListener('input', e => {\n        APP.area = parseFloat(e.target.value);\n        els.areaVal.innerText = APP.area;\n    });\n    \n    els.dtIn.addEventListener('input', e => {\n        APP.dt = parseFloat(e.target.value);\n        els.dtVal.innerText = APP.dt;\n    });\n\n    // Layer buttons\n    els.btnAdd.addEventListener('click', () => {\n        if(APP.layers.length < 6) {\n            APP.layers.push({ id: Date.now(), L: 0.1, k: 50, name: \"Generic\" });\n            renderLayerInputs();\n        }\n    });\n\n    els.btnRemove.addEventListener('click', () => {\n        if(APP.layers.length > 1) {\n            APP.layers.pop();\n            renderLayerInputs();\n        }\n    });\n}\n\nfunction renderLayerInputs() {\n    els.layerContainer.innerHTML = '';\n    \n    APP.layers.forEach((layer, idx) => {\n        const div = document.createElement('div');\n        div.className = 'layer-card';\n        // Assign a color bar based on k roughly to help ID\n        const hue = layer.k > 100 ? '#ff7675' : (layer.k < 1 ? '#fdcb6e' : '#636e72');\n        div.style.borderLeftColor = hue;\n\n        div.innerHTML = `\n            <div class=\"layer-title\">Layer ${idx + 1}</div>\n            <div class=\"control-row\">\n                <label>Thickness ($L$): <span>${layer.L.toFixed(2)}</span>m</label>\n                <input type=\"range\" min=\"0.01\" max=\"0.5\" step=\"0.01\" value=\"${layer.L}\" \n                       data-idx=\"${idx}\" data-prop=\"L\">\n            </div>\n            <div class=\"control-row\">\n                <label>Conductivity ($k$): <span>${layer.k}</span> W/mK</label>\n                <input type=\"range\" min=\"0.05\" max=\"300\" step=\"0.05\" value=\"${layer.k}\" \n                       data-idx=\"${idx}\" data-prop=\"k\">\n            </div>\n        `;\n        els.layerContainer.appendChild(div);\n    });\n\n    // Attach listeners to the newly created inputs\n    const inputs = els.layerContainer.querySelectorAll('input');\n    inputs.forEach(input => {\n        input.addEventListener('input', (e) => {\n            const idx = parseInt(e.target.dataset.idx);\n            const prop = e.target.dataset.prop;\n            const val = parseFloat(e.target.value);\n            \n            APP.layers[idx][prop] = val;\n            \n            // Update the span text immediately\n            const span = e.target.previousElementSibling.querySelector('span');\n            span.innerText = prop === 'k' && val < 1 ? val.toFixed(3) : val.toFixed(2);\n        });\n    });\n}\n\n// --- Graphics & Animation ---\n\n// Helper: Heat Map Color\n// t is 0.0 (Cold/Blue) to 1.0 (Hot/Red)\nfunction getHeatColor(t) {\n    // Clamp\n    t = Math.max(0, Math.min(1, t));\n    // Simple interpolation between Blue(0,0,255) and Red(255,0,0)\n    // Using a slightly nicer palette\n    const r = Math.floor(t * 255);\n    const b = Math.floor((1 - t) * 255);\n    const g = 50; // slight grey boost\n    return `rgb(${r}, ${g}, ${b})`;\n}\n\nfunction resize() {\n    const parent = els.canvas.parentElement;\n    els.canvas.width = parent.clientWidth;\n    els.canvas.height = parent.clientHeight;\n}\n\nfunction updateParticles(Q, wallLeft, wallWidth, wallY, wallHeight) {\n    // Determine particle count and speed based on Q\n    // Q can range from ~1 to ~100,000. Log scale fits best visually.\n    const activityLevel = Math.log10(Q + 1); // 0 to ~5\n    \n    // Target particle count\n    const maxParticles = 150;\n    const targetCount = Math.min(maxParticles, Math.floor(activityLevel * 25));\n    \n    // Speed (pixels per frame approx)\n    const speed = 2 + (activityLevel * 1.5); \n\n    // Spawning\n    if (APP.particles.length < targetCount) {\n        APP.particles.push({\n            x: wallLeft + Math.random() * wallWidth, // Spawn anywhere in wall for smooth look\n            y: wallY + Math.random() * wallHeight,\n            vx: speed\n        });\n    } else if (APP.particles.length > targetCount) {\n        APP.particles.pop();\n    }\n\n    // Moving\n    for(let i=0; i<APP.particles.length; i++) {\n        let p = APP.particles[i];\n        p.vx = speed; // Update speed if Q changed\n        p.x += p.vx;\n        \n        // Wrap around\n        if(p.x > wallLeft + wallWidth) {\n            p.x = wallLeft;\n            p.y = wallY + Math.random() * wallHeight;\n        }\n    }\n}\n\nfunction draw(physics) {\n    const w = els.canvas.width;\n    const h = els.canvas.height;\n    \n    ctx.clearRect(0,0,w,h);\n\n    // Layout\n    const marginX = 50;\n    const wallHeight = h * 0.5;\n    const wallY = (h - wallHeight) / 2;\n    const drawWidth = w - (marginX * 2);\n    \n    const totalPhysicalL = APP.layers.reduce((sum, l) => sum + l.L, 0);\n    const scale = drawWidth / totalPhysicalL; // Pixels per meter\n\n    let curX = marginX;\n\n    // --- 1. Draw Layers with Gradient (The \"How layers affect it\" part) ---\n    APP.layers.forEach(l => {\n        const layerW = l.L * scale;\n        \n        // Create Gradient based on Temp Drop\n        // This visualizes the insulator vs conductor concept perfectly\n        const grad = ctx.createLinearGradient(curX, 0, curX + layerW, 0);\n        grad.addColorStop(0, getHeatColor(l.tempStart));\n        grad.addColorStop(1, getHeatColor(l.tempEnd));\n        \n        ctx.fillStyle = grad;\n        ctx.fillRect(curX, wallY, layerW, wallHeight);\n        \n        // Border\n        ctx.strokeStyle = \"rgba(255,255,255,0.5)\";\n        ctx.lineWidth = 1;\n        ctx.strokeRect(curX, wallY, layerW, wallHeight);\n\n        // Text Label\n        if (layerW > 50) {\n            ctx.fillStyle = \"white\";\n            ctx.shadowColor = \"black\";\n            ctx.shadowBlur = 4;\n            ctx.font = \"12px sans-serif\";\n            ctx.fillText(`k=${l.k}`, curX + 5, wallY + 20);\n            ctx.shadowBlur = 0;\n        }\n\n        curX += layerW;\n    });\n\n    // --- 2. Draw Particles (Heat Flux) ---\n    updateParticles(physics.Q, marginX, drawWidth, wallY, wallHeight);\n    \n    ctx.fillStyle = \"rgba(255, 255, 255, 0.6)\";\n    APP.particles.forEach(p => {\n        ctx.beginPath();\n        ctx.arc(p.x, p.y, 2, 0, Math.PI*2);\n        ctx.fill();\n    });\n\n    // --- 3. Draw Temperature Graph (Overlay) ---\n    const graphTop = wallY - 40;\n    const graphBottom = wallY + wallHeight + 40;\n    const graphH = graphBottom - graphTop;\n\n    ctx.beginPath();\n    ctx.strokeStyle = \"#2d3436\";\n    ctx.lineWidth = 3;\n\n    curX = marginX;\n    \n    // Draw lines\n    APP.layers.forEach((l, i) => {\n        const layerW = l.L * scale;\n        \n        // Map relative temp (0-1) to Y position\n        // 1.0 (Hot) is at graphTop\n        // 0.0 (Cold) is at graphBottom\n        const yStart = graphBottom - (l.tempStart * graphH);\n        const yEnd = graphBottom - (l.tempEnd * graphH);\n\n        if (i === 0) ctx.moveTo(curX, yStart);\n        ctx.lineTo(curX + layerW, yEnd);\n        \n        curX += layerW;\n    });\n    ctx.stroke();\n\n    // Draw Nodes\n    curX = marginX;\n    const drawNode = (x, t) => {\n        const y = graphBottom - (t * graphH);\n        ctx.beginPath();\n        ctx.arc(x, y, 6, 0, Math.PI*2);\n        ctx.fillStyle = getHeatColor(t);\n        ctx.strokeStyle = \"white\";\n        ctx.lineWidth = 2;\n        ctx.fill();\n        ctx.stroke();\n    };\n\n    // Draw first node\n    drawNode(marginX, APP.layers[0].tempStart);\n    \n    // Draw rest\n    APP.layers.forEach(l => {\n        curX += l.L * scale;\n        drawNode(curX, l.tempEnd);\n    });\n}\n\n// --- Main Loop ---\nfunction loop() {\n    const physics = calculate();\n    \n    // Update text stats\n    els.outR.innerText = physics.R_total.toExponential(2);\n    els.outQ.innerText = physics.Q.toFixed(1);\n    els.outU.innerText = physics.U.toFixed(2);\n\n    draw(physics);\n    requestAnimationFrame(loop);\n}\n\n// Start\ninit();"}}
{"input": {"input_text": "Newton's law of cooling convection: q = h*A*(Ts - Tinf). Compute heat rate.", "simulation_name": " Convection Cooling", "domain": "Thermal", "description": "Surface convection heat transfer", "assumptions": ["Steady"], "entities": [], "constants": [], "parameters": [{"name": "heat_transfer_coeff", "symbol": "h", "unit": "W/(m^2*K)", "range": [1, 500]}, {"name": "area", "symbol": "A", "unit": "m^2", "range": [0.01, 100]}, {"name": "surface_temp", "symbol": "Ts", "unit": "K", "range": [250, 800]}, {"name": "ambient_temp", "symbol": "Tinf", "unit": "K", "range": [200, 500]}], "equations": [{"description": "Heat rate", "expression": "q = h*A*(Ts - Tinf)"}], "initial_conditions": {}, "outputs": ["q"], "simulation_controls": ["h", "A", "Ts", "Tinf"], "constraints": ["A>0", "h>=0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S48 Convection Cooling Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"container\">\n    <header>\n        <h1>Newton's Law of Cooling</h1>\n        <p>Surface Convection Heat Transfer</p>\n    </header>\n\n    <div class=\"simulation-layout\">\n        <aside class=\"controls\">\n            <div class=\"equation-box\">\n                $$q = h \\cdot A \\cdot (T_s - T_{\\infty})$$\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"h-slider\">\n                    Heat Transfer Coeff ($h$)\n                    <span class=\"unit\">W/(m²·K)</span>\n                </label>\n                <input type=\"range\" id=\"h-slider\" min=\"1\" max=\"500\" step=\"1\" value=\"50\">\n                <span class=\"value-display\" id=\"h-val\">50</span>\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"A-slider\">\n                    Surface Area ($A$)\n                    <span class=\"unit\">m²</span>\n                </label>\n                <input type=\"range\" id=\"A-slider\" min=\"0.01\" max=\"100\" step=\"0.1\" value=\"10\">\n                <span class=\"value-display\" id=\"A-val\">10</span>\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"Ts-slider\">\n                    Surface Temp ($T_s$)\n                    <span class=\"unit\">K</span>\n                </label>\n                <input type=\"range\" id=\"Ts-slider\" min=\"250\" max=\"800\" step=\"1\" value=\"350\">\n                <span class=\"value-display\" id=\"Ts-val\">350</span>\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"Tinf-slider\">\n                    Ambient Temp ($T_{\\infty}$)\n                    <span class=\"unit\">K</span>\n                </label>\n                <input type=\"range\" id=\"Tinf-slider\" min=\"200\" max=\"500\" step=\"1\" value=\"300\">\n                <span class=\"value-display\" id=\"Tinf-val\">300</span>\n            </div>\n\n            <div class=\"result-box\">\n                <h3>Heat Rate ($q$)</h3>\n                <span id=\"q-result\">0.00</span> <span class=\"unit\">Watts</span>\n            </div>\n        </aside>\n\n        <main class=\"visualization\">\n            <div id=\"ambient-env\" class=\"environment\">\n                <div class=\"canvas-container\">\n                    <canvas id=\"convectionCanvas\"></canvas>\n                    <div id=\"surface-plate\" class=\"plate\">\n                        <span class=\"plate-label\">Surface ($T_s$)</span>\n                    </div>\n                </div>\n                <div class=\"legend\">\n                    <span id=\"env-label\">Ambient Air ($T_{\\infty}$)</span>\n                </div>\n            </div>\n        </main>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary-color: #3498db;\n    --text-color: #2c3e50;\n    --bg-color: #f4f7f6;\n    --panel-bg: #ffffff;\n    --border-radius: 8px;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n    min-height: 100vh;\n}\n\n.container {\n    width: 100%;\n    max-width: 1200px;\n    background-color: var(--panel-bg);\n    padding: 30px;\n    border-radius: var(--border-radius);\n    box-shadow: 0 4px 15px rgba(0,0,0,0.1);\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 30px;\n    border-bottom: 2px solid #eee;\n    padding-bottom: 10px;\n}\n\nh1 { margin: 0; font-size: 1.8rem; }\np { margin: 5px 0 0; color: #7f8c8d; }\n\n.simulation-layout {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 30px;\n}\n\n/* Controls */\n.controls {\n    flex: 1;\n    min-width: 300px;\n    background: #fafafa;\n    padding: 20px;\n    border-radius: var(--border-radius);\n    border: 1px solid #eee;\n}\n\n.equation-box {\n    background: #fff;\n    padding: 15px;\n    border-radius: var(--border-radius);\n    text-align: center;\n    margin-bottom: 25px;\n    font-size: 1.2rem;\n    box-shadow: 0 2px 5px rgba(0,0,0,0.05);\n}\n\n.input-group {\n    margin-bottom: 20px;\n}\n\n.input-group label {\n    display: block;\n    margin-bottom: 8px;\n    font-weight: 600;\n    font-size: 0.9rem;\n}\n\n.unit {\n    font-weight: normal;\n    color: #7f8c8d;\n    font-size: 0.8rem;\n}\n\ninput[type=range] {\n    width: 100%;\n    cursor: pointer;\n}\n\n.value-display {\n    display: block;\n    text-align: right;\n    font-weight: bold;\n    color: var(--primary-color);\n    margin-top: 5px;\n}\n\n.result-box {\n    margin-top: 30px;\n    padding: 20px;\n    background-color: #2c3e50;\n    color: white;\n    text-align: center;\n    border-radius: var(--border-radius);\n}\n\n.result-box h3 { margin: 0 0 10px 0; font-size: 1rem; opacity: 0.8; }\n#q-result { font-size: 1.8rem; font-weight: bold; }\n\n/* Visualization */\n.visualization {\n    flex: 2;\n    min-width: 300px;\n    display: flex;\n    flex-direction: column;\n}\n\n.environment {\n    position: relative;\n    width: 100%;\n    height: 500px;\n    background: #e0f7fa; /* Default ambient color */\n    border-radius: var(--border-radius);\n    border: 1px solid #ccc;\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: flex-end;\n    transition: background-color 0.5s ease;\n}\n\n.canvas-container {\n    position: relative;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: flex-end;\n    padding-bottom: 20px;\n}\n\ncanvas {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    pointer-events: none;\n}\n\n.plate {\n    width: 150px; /* Base width */\n    height: 20px;\n    background-color: #bbb;\n    border-radius: 4px;\n    box-shadow: 0 4px 6px rgba(0,0,0,0.3);\n    position: relative;\n    z-index: 2;\n    transition: background-color 0.3s, width 0.3s, transform 0.3s;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.plate-label {\n    font-size: 0.8rem;\n    color: rgba(255,255,255,0.9);\n    font-weight: bold;\n    text-shadow: 1px 1px 2px rgba(0,0,0,0.5);\n}\n\n.legend {\n    position: absolute;\n    top: 10px;\n    right: 10px;\n    background: rgba(255,255,255,0.7);\n    padding: 5px 10px;\n    border-radius: 4px;\n    font-size: 0.8rem;\n}", "js": "document.addEventListener('DOMContentLoaded', () => {\n    // Inputs\n    const hSlider = document.getElementById('h-slider');\n    const ASlider = document.getElementById('A-slider');\n    const TsSlider = document.getElementById('Ts-slider');\n    const TinfSlider = document.getElementById('Tinf-slider');\n\n    // Displays\n    const hVal = document.getElementById('h-val');\n    const AVal = document.getElementById('A-val');\n    const TsVal = document.getElementById('Ts-val');\n    const TinfVal = document.getElementById('Tinf-val');\n    const qResult = document.getElementById('q-result');\n    \n    // Visual Elements\n    const plate = document.getElementById('surface-plate');\n    const environment = document.getElementById('ambient-env');\n    const canvas = document.getElementById('convectionCanvas');\n    const ctx = canvas.getContext('2d');\n\n    // Constants for visuals\n    const MIN_TEMP = 200;\n    const MAX_TEMP = 800;\n\n    // State\n    let params = {\n        h: parseFloat(hSlider.value),\n        A: parseFloat(ASlider.value),\n        Ts: parseFloat(TsSlider.value),\n        Tinf: parseFloat(TinfSlider.value)\n    };\n\n    // Particles array\n    let particles = [];\n\n    // --- Core Logic ---\n\n    function calculateHeatRate() {\n        // Equation: q = h * A * (Ts - Tinf)\n        const q = params.h * params.A * (params.Ts - params.Tinf);\n        return q;\n    }\n\n    // --- Helper Functions ---\n\n    // Map temperature to color (Blue -> Red -> White/Yellow hot)\n    function getTempColor(temp) {\n        const ratio = (temp - MIN_TEMP) / (MAX_TEMP - MIN_TEMP);\n        \n        // Ambient background color logic (lighter)\n        if (temp === params.Tinf) {\n            // Blueish (cold) to reddish (hot), but very light\n            const r = Math.floor(200 + 55 * ratio); \n            const b = Math.floor(255 - 50 * ratio);\n            const g = Math.floor(240 - 40 * ratio);\n            return `rgb(${r}, ${g}, ${b})`;\n        }\n\n        // Surface color logic (vibrant)\n        // Simple heatmap: Blue (cold) -> Red (hot) -> Yellow (very hot)\n        let r, g, b;\n        if (ratio < 0.5) {\n            // Blue to Greenish/Red\n            r = Math.floor(2 * ratio * 255);\n            g = Math.floor(2 * ratio * 100);\n            b = Math.floor(255 * (1 - 2 * ratio));\n        } else {\n            // Red to Yellow\n            r = 255;\n            g = Math.floor(2 * (ratio - 0.5) * 255);\n            b = 0;\n        }\n        return `rgb(${r}, ${g}, ${b})`;\n    }\n\n    function updateDisplayValues() {\n        hVal.textContent = params.h;\n        AVal.textContent = params.A;\n        TsVal.textContent = params.Ts;\n        TinfVal.textContent = params.Tinf;\n\n        const q = calculateHeatRate();\n        qResult.textContent = q.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });\n    }\n\n    function updateVisuals() {\n        // 1. Update Plate Color\n        plate.style.backgroundColor = getTempColor(params.Ts);\n\n        // 2. Update Ambient Background\n        environment.style.backgroundColor = getTempColor(params.Tinf);\n\n        // 3. Update Plate Width based on Area (Square root scaling for visual sanity)\n        // Max A is 100, Min is 0.01. Let's map 0-100 to 10%-90% width\n        const areaRatio = Math.sqrt(params.A) / Math.sqrt(100); \n        const newWidth = Math.max(50, Math.min(800, 100 + (areaRatio * 600))); \n        plate.style.width = `${newWidth}px`;\n    }\n\n    function handleInput(e) {\n        const target = e.target;\n        const val = parseFloat(target.value);\n\n        if (target.id === 'h-slider') params.h = val;\n        if (target.id === 'A-slider') params.A = val;\n        if (target.id === 'Ts-slider') params.Ts = val;\n        if (target.id === 'Tinf-slider') params.Tinf = val;\n\n        updateDisplayValues();\n        updateVisuals();\n    }\n\n    // --- Animation System ---\n\n    class Particle {\n        constructor() {\n            this.reset();\n        }\n\n        reset() {\n            // Determine dimensions of the plate\n            const plateRect = plate.getBoundingClientRect();\n            const canvasRect = canvas.getBoundingClientRect();\n\n            // Spawn relative to plate position within canvas\n            const plateX = plateRect.left - canvasRect.left;\n            const plateY = plateRect.top - canvasRect.top;\n            const plateW = plateRect.width;\n\n            // Random position along the plate width\n            this.x = plateX + Math.random() * plateW;\n            this.y = plateY; // Start at top of plate\n            \n            // Velocity\n            // Speed depends on Heat Transfer Coeff (h) and Temp Difference\n            const deltaT = params.Ts - params.Tinf;\n            const speedFactor = (params.h / 500) * 2 + (Math.abs(deltaT) / 600) * 3;\n            \n            // Direction depends on heat flow (Hot surface -> Up, Cold surface -> Down usually, \n            // but for simplicity we visualize \"convection currents\" rising generally, \n            // or sinking if surface is colder than ambient)\n            \n            this.vy = -(1 + Math.random() * 2 + speedFactor); \n            if (deltaT < 0) this.vy = (1 + Math.random() * 2 + speedFactor) * 0.5; // Sink slower\n\n            this.vx = (Math.random() - 0.5) * 1; // Slight jitter\n            \n            this.life = 1.0;\n            this.decay = 0.01 + Math.random() * 0.02;\n            this.size = 2 + Math.random() * 3;\n        }\n\n        update() {\n            this.x += this.vx;\n            this.y += this.vy;\n            this.life -= this.decay;\n\n            // Wavy motion\n            this.x += Math.sin(this.y * 0.05) * 0.5;\n\n            if (this.life <= 0 || this.y < 0 || this.y > canvas.height) {\n                this.reset();\n            }\n        }\n\n        draw() {\n            const deltaT = params.Ts - params.Tinf;\n            \n            // Color interpolation: Start at Surface Temp color, fade to Ambient Temp color\n            // For simplicity, Red for heating air, Blue for cooling air\n            let r, g, b;\n            \n            if (deltaT > 0) {\n                // Heating the air: Red/Orange\n                r = 255; \n                g = Math.floor(150 * (1 - this.life)); \n                b = 100;\n            } else {\n                // Cooling the air: Blue/Cyan\n                r = 100;\n                g = Math.floor(150 * (1 - this.life));\n                b = 255;\n            }\n\n            ctx.fillStyle = `rgba(${r}, ${g}, ${b}, ${this.life * 0.6})`;\n            ctx.beginPath();\n            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);\n            ctx.fill();\n        }\n    }\n\n    function initParticles() {\n        resizeCanvas();\n        particles = [];\n        // Number of particles proportional to Area and h (visual density)\n        // Limiting to reasonable numbers for performance\n        const count = 50 + Math.floor((params.h / 5) + (params.A * 2));\n        const safeCount = Math.min(count, 300); // Max 300 particles\n\n        for (let i = 0; i < safeCount; i++) {\n            particles.push(new Particle());\n            // Pre-warm the simulation so particles aren't all at the bottom\n            particles[i].y = Math.random() * canvas.height;\n        }\n    }\n\n    function resizeCanvas() {\n        canvas.width = environment.clientWidth;\n        canvas.height = environment.clientHeight;\n    }\n\n    function animate() {\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n        // Adjust particle count dynamically if slider changed significantly\n        // (Simple check: if array length differs largely from target)\n        const targetCount = Math.min(300, 50 + Math.floor((params.h / 5) + (params.A * 2)));\n        if (particles.length < targetCount) particles.push(new Particle());\n        if (particles.length > targetCount) particles.pop();\n\n        particles.forEach(p => {\n            p.update();\n            p.draw();\n        });\n\n        requestAnimationFrame(animate);\n    }\n\n    // --- Initialization ---\n    \n    // Listeners\n    hSlider.addEventListener('input', handleInput);\n    ASlider.addEventListener('input', handleInput);\n    TsSlider.addEventListener('input', handleInput);\n    TinfSlider.addEventListener('input', handleInput);\n    window.addEventListener('resize', () => {\n        resizeCanvas();\n        // Resetting particles helps fix position issues on resize\n        particles.forEach(p => p.reset()); \n    });\n\n    // Start\n    updateDisplayValues();\n    updateVisuals();\n    initParticles();\n    animate();\n});"}}
{"input": {"input_text": "Radiation heat transfer between surface and surroundings: q = eps*sigma*A*(Ts^4 - Tsur^4).", "simulation_name": " Thermal Radiation", "domain": "Thermal", "description": "Gray surface to large surroundings", "assumptions": ["Diffuse gray", "Large surroundings"], "entities": [], "constants": [{"name": "stefan_boltzmann", "symbol": "sigma", "value": 5.670374e-08, "unit": "W/(m^2*K^4)"}], "parameters": [{"name": "emissivity", "symbol": "eps", "unit": "dimensionless", "range": [0, 1]}, {"name": "area", "symbol": "A", "unit": "m^2", "range": [0.01, 100]}, {"name": "surface_temp", "symbol": "Ts", "unit": "K", "range": [200, 1200]}, {"name": "surround_temp", "symbol": "Tsur", "unit": "K", "range": [200, 1200]}], "equations": [{"description": "Heat rate", "expression": "q = eps*sigma*A*(Ts^4 - Tsur^4)"}], "initial_conditions": {}, "outputs": ["q"], "simulation_controls": ["eps", "A", "Ts", "Tsur"], "constraints": ["0<=eps<=1", "A>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Thermal Radiation Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"container\">\n    <aside class=\"sidebar\">\n        <header>\n            <h2>S49: Radiation</h2>\n            <p>Net exchange between surface and surroundings.</p>\n        </header>\n\n        <div class=\"controls\">\n            <div class=\"control-group\">\n                <label>Emissivity ($\\epsilon$) <span class=\"val\" id=\"val-eps\">0.80</span></label>\n                <input type=\"range\" id=\"in-eps\" min=\"0.01\" max=\"1.0\" step=\"0.01\" value=\"0.8\">\n            </div>\n\n            <div class=\"control-group\">\n                <label>Surface Area ($A$) <span class=\"val\" id=\"val-area\">1.0</span> m²</label>\n                <input type=\"range\" id=\"in-area\" min=\"0.1\" max=\"5.0\" step=\"0.1\" value=\"1.0\">\n            </div>\n\n            <div class=\"control-group\">\n                <label>Surface Temp ($T_s$) <span class=\"val hot-text\" id=\"val-ts\">800</span> K</label>\n                <input type=\"range\" id=\"in-ts\" min=\"200\" max=\"1200\" step=\"10\" value=\"800\">\n            </div>\n\n            <div class=\"control-group\">\n                <label>Surroundings ($T_{sur}$) <span class=\"val cold-text\" id=\"val-tsur\">300</span> K</label>\n                <input type=\"range\" id=\"in-tsur\" min=\"200\" max=\"1200\" step=\"10\" value=\"300\">\n            </div>\n        </div>\n\n        <div class=\"equation-box\">\n            $$ q = \\epsilon \\sigma A (T_s^4 - T_{sur}^4) $$\n            <small>$\\sigma = 5.67 \\times 10^{-8} W/m^2K^4$</small>\n        </div>\n    </aside>\n\n    <main class=\"main-content\">\n        <div class=\"dashboard\">\n            <div class=\"card\">\n                <div class=\"card-title\">Net Heat Rate ($q$)</div>\n                <div class=\"card-value\" id=\"res-q\">0.00 W</div>\n                <div class=\"card-sub\" id=\"res-dir\">Net Flow: Outward</div>\n            </div>\n        </div>\n\n        <div class=\"canvas-wrapper\">\n            <canvas id=\"simCanvas\"></canvas>\n            \n            <div class=\"legend\">\n                <div class=\"legend-item\">\n                    <span class=\"dot outgoing\"></span> Emitted Photons (from Surface)\n                </div>\n                <div class=\"legend-item\">\n                    <span class=\"dot incoming\"></span> Absorbed Photons (from Surroundings)\n                </div>\n            </div>\n        </div>\n    </main>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-dark: #121212;\n    --bg-panel: #1e1e1e;\n    --text-light: #e0e0e0;\n    --text-muted: #a0a0a0;\n    --accent: #ff9f43;\n    --border: #333;\n}\n\n* { box-sizing: border-box; }\n\nbody {\n    margin: 0;\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-dark);\n    color: var(--text-light);\n    height: 100vh;\n    overflow: hidden;\n}\n\n.container {\n    display: flex;\n    height: 100%;\n}\n\n/* Sidebar */\n.sidebar {\n    width: 320px;\n    background-color: var(--bg-panel);\n    border-right: 1px solid var(--border);\n    padding: 20px;\n    display: flex;\n    flex-direction: column;\n    z-index: 10;\n    box-shadow: 2px 0 10px rgba(0,0,0,0.5);\n}\n\n.sidebar header h2 { margin: 0; color: var(--accent); }\n.sidebar header p { color: var(--text-muted); font-size: 0.9rem; margin-top: 5px; }\n\n.controls { margin-top: 30px; flex: 1; }\n\n.control-group { margin-bottom: 25px; }\n.control-group label { display: flex; justify-content: space-between; font-weight: 500; font-size: 0.9rem; margin-bottom: 8px; }\n.control-group .val { font-family: monospace; color: var(--accent); }\n\ninput[type=\"range\"] {\n    width: 100%;\n    cursor: pointer;\n    background: transparent;\n}\n\n/* Specific text colors for temps */\n.hot-text { color: #ff6b6b !important; }\n.cold-text { color: #54a0ff !important; }\n\n.equation-box {\n    background: #2d2d2d;\n    padding: 15px;\n    border-radius: 8px;\n    text-align: center;\n    font-size: 0.9rem;\n    border: 1px solid var(--border);\n}\n\n/* Main Content */\n.main-content {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    position: relative;\n}\n\n.dashboard {\n    position: absolute;\n    top: 20px;\n    left: 20px;\n    z-index: 5;\n}\n\n.card {\n    background: rgba(30, 30, 30, 0.9);\n    backdrop-filter: blur(5px);\n    border: 1px solid var(--border);\n    padding: 15px 25px;\n    border-radius: 8px;\n    min-width: 200px;\n}\n\n.card-title { font-size: 0.85rem; color: var(--text-muted); text-transform: uppercase; }\n.card-value { font-size: 1.8rem; font-weight: bold; color: var(--text-light); margin: 5px 0; }\n.card-sub { font-size: 0.9rem; font-weight: 500; }\n\n.canvas-wrapper {\n    width: 100%;\n    height: 100%;\n    position: relative;\n    background: #000; /* Deep black for radiation contrast */\n}\n\ncanvas {\n    display: block;\n    width: 100%;\n    height: 100%;\n}\n\n.legend {\n    position: absolute;\n    bottom: 20px;\n    right: 20px;\n    background: rgba(30, 30, 30, 0.8);\n    padding: 10px 15px;\n    border-radius: 6px;\n    border: 1px solid var(--border);\n    font-size: 0.85rem;\n}\n\n.legend-item { display: flex; align-items: center; gap: 8px; margin-bottom: 5px; }\n.legend-item:last-child { margin-bottom: 0; }\n.dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }\n.dot.outgoing { background: #ff6b6b; box-shadow: 0 0 5px #ff6b6b; }\n.dot.incoming { background: #54a0ff; box-shadow: 0 0 5px #54a0ff; }", "js": "// Constants\nconst SIGMA = 5.670374e-8; // Stefan-Boltzmann constant\n\n// State\nconst state = {\n    eps: 0.8,\n    area: 1.0,\n    ts: 800,\n    tsur: 300\n};\n\n// Animation State\nconst particles = [];\nlet canvas, ctx;\nlet animationFrameId;\n\n// DOM Elements\nconst ui = {\n    inEps: document.getElementById('in-eps'),\n    inArea: document.getElementById('in-area'),\n    inTs: document.getElementById('in-ts'),\n    inTsur: document.getElementById('in-tsur'),\n    valEps: document.getElementById('val-eps'),\n    valArea: document.getElementById('val-area'),\n    valTs: document.getElementById('val-ts'),\n    valTsur: document.getElementById('val-tsur'),\n    resQ: document.getElementById('res-q'),\n    resDir: document.getElementById('res-dir')\n};\n\n// Initialization\nfunction init() {\n    canvas = document.getElementById('simCanvas');\n    ctx = canvas.getContext('2d');\n\n    setupListeners();\n    resizeCanvas();\n    window.addEventListener('resize', resizeCanvas);\n    \n    // Start loop\n    loop();\n}\n\nfunction setupListeners() {\n    const update = (key, elInput, elVal) => {\n        elInput.addEventListener('input', (e) => {\n            state[key] = parseFloat(e.target.value);\n            elVal.textContent = state[key];\n            if(key === 'ts' || key === 'tsur') elVal.textContent = Math.round(state[key]);\n        });\n    };\n\n    update('eps', ui.inEps, ui.valEps);\n    update('area', ui.inArea, ui.valArea);\n    update('ts', ui.inTs, ui.valTs);\n    update('tsur', ui.inTsur, ui.valTsur);\n}\n\nfunction resizeCanvas() {\n    canvas.width = canvas.parentElement.clientWidth;\n    canvas.height = canvas.parentElement.clientHeight;\n}\n\n// Physics Calculation\nfunction calculatePhysics() {\n    // q = eps * sigma * A * (Ts^4 - Tsur^4)\n    const t4_s = Math.pow(state.ts, 4);\n    const t4_sur = Math.pow(state.tsur, 4);\n    const q = state.eps * SIGMA * state.area * (t4_s - t4_sur);\n    \n    return { q, t4_s, t4_sur };\n}\n\nfunction updateUI(q) {\n    ui.resQ.textContent = Math.abs(q).toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 }) + \" W\";\n    ui.resQ.style.color = q > 0 ? '#ff6b6b' : (q < 0 ? '#54a0ff' : '#e0e0e0');\n    \n    if (Math.abs(q) < 0.1) {\n        ui.resDir.textContent = \"Thermal Equilibrium\";\n        ui.resDir.style.color = \"#e0e0e0\";\n    } else if (q > 0) {\n        ui.resDir.textContent = \"Net Flow: Surface → Surroundings (Cooling)\";\n        ui.resDir.style.color = \"#ff6b6b\";\n    } else {\n        ui.resDir.textContent = \"Net Flow: Surroundings → Surface (Heating)\";\n        ui.resDir.style.color = \"#54a0ff\";\n    }\n}\n\n// Helper: Color Temperature Approximation\nfunction getTempColor(kelvin) {\n    // Simple interpolation for visualization\n    // 200K (Blue/Dim) -> 1200K (Red/Orange/White)\n    if (kelvin < 300) return `rgba(50, 50, 150, ${0.3 + (kelvin/1000)})`;\n    if (kelvin < 600) return `rgba(100, 100, 255, 0.8)`;\n    if (kelvin < 800) return `rgba(200, 50, 50, 0.9)`;\n    if (kelvin < 1000) return `rgba(255, 100, 50, 1)`;\n    return `rgba(255, 200, 150, 1)`; // Hot glowing\n}\n\nfunction getGlowColor(kelvin) {\n    if (kelvin < 500) return \"rgba(0, 100, 255, 0.2)\";\n    return \"rgba(255, 100, 0, 0.4)\";\n}\n\n// Animation Logic\nfunction spawnParticles(t4_s, t4_sur) {\n    const cx = canvas.width / 2;\n    const cy = canvas.height / 2;\n    const radius = 30 + (Math.sqrt(state.area) * 30); // Visual radius\n\n    // Spawn Outgoing (Emission)\n    // Probability scaled by Temp^4 and Emissivity\n    // We take log or scale down significantly because T^4 is huge\n    const emissionRate = (t4_s * state.eps) / 3e10; \n    const absorptionRate = (t4_sur * state.eps) / 3e10; // Kirchhoff's law: absorptivity = emissivity\n\n    // Spawn Outgoing\n    const numOut = Math.floor(emissionRate) + (Math.random() < (emissionRate % 1) ? 1 : 0);\n    for(let i=0; i<numOut; i++) {\n        const angle = Math.random() * Math.PI * 2;\n        particles.push({\n            type: 'out',\n            x: cx + Math.cos(angle) * radius,\n            y: cy + Math.sin(angle) * radius,\n            vx: Math.cos(angle) * 3,\n            vy: Math.sin(angle) * 3,\n            life: 100,\n            color: getTempColor(state.ts)\n        });\n    }\n\n    // Spawn Incoming (Absorption)\n    // Spawn from edge of canvas moving inward\n    const numIn = Math.floor(absorptionRate) + (Math.random() < (absorptionRate % 1) ? 1 : 0);\n    for(let i=0; i<numIn; i++) {\n        // Random point on edge\n        let ex, ey;\n        if(Math.random() > 0.5) {\n            ex = Math.random() * canvas.width;\n            ey = Math.random() > 0.5 ? 0 : canvas.height;\n        } else {\n            ex = Math.random() > 0.5 ? 0 : canvas.width;\n            ey = Math.random() * canvas.height;\n        }\n\n        // Calculate velocity vector towards center\n        const angle = Math.atan2(cy - ey, cx - ex);\n        \n        particles.push({\n            type: 'in',\n            x: ex,\n            y: ey,\n            vx: Math.cos(angle) * 3,\n            vy: Math.sin(angle) * 3,\n            life: 200, // Longer life to reach center\n            color: getTempColor(state.tsur)\n        });\n    }\n}\n\nfunction draw() {\n    const cx = canvas.width / 2;\n    const cy = canvas.height / 2;\n    \n    // Clear with a fade effect for trails (optional, but clean clear is better for physics sim)\n    // Draw Background representing surroundings\n    ctx.fillStyle = getTempColor(state.tsur); \n    // We darken the background color significantly so particles pop\n    ctx.fillStyle = `rgba(10, 10, 15, 1)`; // Keep background dark\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n    // Subtle background glow based on T_sur\n    const bgGrad = ctx.createRadialGradient(cx, cy, canvas.width/4, cx, cy, canvas.width);\n    bgGrad.addColorStop(0, \"rgba(0,0,0,0)\");\n    bgGrad.addColorStop(1, getGlowColor(state.tsur));\n    ctx.fillStyle = bgGrad;\n    ctx.fillRect(0,0, canvas.width, canvas.height);\n\n    // Draw Object\n    const radius = 30 + (Math.sqrt(state.area) * 30);\n    \n    // Object Glow\n    const glow = ctx.createRadialGradient(cx, cy, radius * 0.8, cx, cy, radius * 2);\n    glow.addColorStop(0, getTempColor(state.ts));\n    glow.addColorStop(1, \"rgba(0,0,0,0)\");\n    \n    ctx.globalCompositeOperation = 'screen'; // Make light additive\n    ctx.fillStyle = glow;\n    ctx.beginPath();\n    ctx.arc(cx, cy, radius * 2, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.globalCompositeOperation = 'source-over';\n\n    // Solid Object Body\n    ctx.fillStyle = \"#000\"; // Base\n    ctx.beginPath();\n    ctx.arc(cx, cy, radius, 0, Math.PI * 2);\n    ctx.fill();\n    \n    // Fill with Emissivity hint (lower emissivity = more reflective/shiny, but here we just show temp color opacity)\n    ctx.fillStyle = getTempColor(state.ts);\n    ctx.globalAlpha = state.eps; // Visualize emissivity as surface intensity\n    ctx.beginPath();\n    ctx.arc(cx, cy, radius, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.globalAlpha = 1.0;\n\n    // Stroke\n    ctx.strokeStyle = \"#fff\";\n    ctx.lineWidth = 1;\n    ctx.stroke();\n\n    // Update & Draw Particles\n    for(let i = particles.length - 1; i >= 0; i--) {\n        const p = particles[i];\n        \n        p.x += p.vx;\n        p.y += p.vy;\n        p.life--;\n\n        // Distance to center\n        const dist = Math.hypot(p.x - cx, p.y - cy);\n\n        // Check collisions\n        if (p.type === 'in' && dist < radius) {\n            // Absorbed\n            particles.splice(i, 1);\n            continue;\n        }\n        if (p.type === 'out' && (p.x < 0 || p.x > canvas.width || p.y < 0 || p.y > canvas.height)) {\n            // Left surroundings\n            particles.splice(i, 1);\n            continue;\n        }\n\n        // Draw Particle\n        ctx.beginPath();\n        ctx.arc(p.x, p.y, p.type === 'out' ? 3 : 2, 0, Math.PI * 2);\n        ctx.fillStyle = p.color;\n        ctx.fill();\n    }\n\n    // Limit particle count for performance\n    if(particles.length > 500) particles.splice(0, particles.length - 500);\n}\n\nfunction loop() {\n    const { q, t4_s, t4_sur } = calculatePhysics();\n    updateUI(q);\n    spawnParticles(t4_s, t4_sur);\n    draw();\n    animationFrameId = requestAnimationFrame(loop);\n}\n\n// Start\ninit();"}}
{"input": {"input_text": "Solar PV single-diode simplified: I = IL - I0*(exp((V+I*Rs)/(nVt)) - 1) - (V+I*Rs)/Rp. Provide equation set for IV curve.", "simulation_name": " PV Single Diode", "domain": "Energy", "description": "Single-diode PV IV model", "assumptions": ["Steady irradiance", "Cell temperature fixed"], "entities": [], "constants": [], "parameters": [{"name": "light_current", "symbol": "IL", "unit": "A", "range": [0, 20]}, {"name": "saturation_current", "symbol": "I0", "unit": "A", "range": [1e-10, 0.001]}, {"name": "ideality", "symbol": "n", "unit": "dimensionless", "range": [1, 2]}, {"name": "thermal_voltage", "symbol": "Vt", "unit": "V", "range": [0.02, 0.035]}, {"name": "series_resistance", "symbol": "Rs", "unit": "ohm", "range": [0, 1]}, {"name": "shunt_resistance", "symbol": "Rp", "unit": "ohm", "range": [1, 10000.0]}, {"name": "terminal_voltage", "symbol": "V", "unit": "V", "range": [0, 80]}], "equations": [{"description": "IV implicit", "expression": "I = IL - I0*(exp((V + I*Rs)/(n*Vt)) - 1) - (V + I*Rs)/Rp"}], "initial_conditions": {}, "outputs": ["I"], "simulation_controls": ["IL", "I0", "n", "Vt", "Rs", "Rp", "V"], "constraints": ["n>0", "Vt>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S50 Solar PV Single-Diode Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"main-container\">\n    <header>\n        <h1>Solar PV Single-Diode Model</h1>\n        <p>Interactive IV & PV Curve Simulation</p>\n    </header>\n\n    <div class=\"content-wrapper\">\n        <aside class=\"sidebar\">\n            <div class=\"equation-container\">\n                $$I = I_L - I_0 \\left( e^{\\frac{V + I R_s}{n V_t}} - 1 \\right) - \\frac{V + I R_s}{R_p}$$\n            </div>\n\n            <div class=\"controls-section\">\n                <h2>Parameters</h2>\n                \n                <div class=\"control-group\">\n                    <label>Light Current ($I_L$) [A]</label>\n                    <input type=\"range\" id=\"IL\" min=\"0\" max=\"20\" step=\"0.1\" value=\"8\">\n                    <span id=\"IL-val\" class=\"val-display\">8.0</span>\n                </div>\n\n                <div class=\"control-group\">\n                    <label>Saturation Current ($I_0$) [A]</label>\n                    <input type=\"range\" id=\"I0_log\" min=\"-10\" max=\"-3\" step=\"0.1\" value=\"-9\">\n                    <span id=\"I0-val\" class=\"val-display\">1.0e-9</span>\n                </div>\n\n                <div class=\"control-group\">\n                    <label>Ideality Factor ($n$)</label>\n                    <input type=\"range\" id=\"n\" min=\"1\" max=\"2\" step=\"0.05\" value=\"1.3\">\n                    <span id=\"n-val\" class=\"val-display\">1.30</span>\n                </div>\n\n                <div class=\"control-group\">\n                    <label>Thermal Voltage ($V_t$) [V]</label>\n                    <input type=\"range\" id=\"Vt\" min=\"0.02\" max=\"0.035\" step=\"0.001\" value=\"0.026\">\n                    <span id=\"Vt-val\" class=\"val-display\">0.026</span>\n                </div>\n\n                <div class=\"control-group\">\n                    <label>Series Resistance ($R_s$) [Ω]</label>\n                    <input type=\"range\" id=\"Rs\" min=\"0\" max=\"1\" step=\"0.01\" value=\"0.05\">\n                    <span id=\"Rs-val\" class=\"val-display\">0.05</span>\n                </div>\n\n                <div class=\"control-group\">\n                    <label>Shunt Resistance ($R_p$) [Ω]</label>\n                    <input type=\"range\" id=\"Rp_log\" min=\"0\" max=\"4\" step=\"0.1\" value=\"2.7\">\n                    <span id=\"Rp-val\" class=\"val-display\">501</span>\n                </div>\n            </div>\n\n            <div class=\"results-section\">\n                <h2>Key Metrics</h2>\n                <div class=\"metric-row\"><span>Short Circuit ($I_{sc}$):</span> <strong id=\"res-isc\">0.00 A</strong></div>\n                <div class=\"metric-row\"><span>Open Circuit ($V_{oc}$):</span> <strong id=\"res-voc\">0.00 V</strong></div>\n                <div class=\"metric-row\"><span>Max Power ($P_{mp}$):</span> <strong id=\"res-pmp\">0.00 W</strong></div>\n                <div class=\"metric-row\"><span>Fill Factor (FF):</span> <strong id=\"res-ff\">0.00 %</strong></div>\n            </div>\n        </aside>\n\n        <main class=\"visualization-panel\">\n            <div class=\"chart-container\">\n                <canvas id=\"ivChart\"></canvas>\n            </div>\n\n            <div class=\"operating-point-control\">\n                <label>Operating Voltage ($V$): <span id=\"V_op-val\">0.0</span> V</label>\n                <input type=\"range\" id=\"V_op\" min=\"0\" max=\"60\" step=\"0.5\" value=\"0\">\n                <div class=\"op-results\">\n                    Current: <strong id=\"op-I\">0.00 A</strong> | Power: <strong id=\"op-P\">0.00 W</strong>\n                </div>\n            </div>\n\n            <div class=\"animation-container\" id=\"animContainer\">\n                <canvas id=\"animCanvas\"></canvas>\n                <div class=\"sim-sun\"></div>\n                <div class=\"sim-panel\">\n                    <div class=\"panel-grid\"></div>\n                </div>\n                <div class=\"sim-bulb\" id=\"simBulb\"></div>\n                <div class=\"wire-top\"></div>\n                <div class=\"wire-bottom\"></div>\n            </div>\n        </main>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-color: #f0f2f5;\n    --panel-bg: #ffffff;\n    --accent-color: #3498db;\n    --text-color: #2c3e50;\n    --border-color: #e1e8ed;\n}\n\nbody {\n    margin: 0;\n    padding: 20px;\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n}\n\n.main-container {\n    max-width: 1200px;\n    margin: 0 auto;\n    background-color: var(--panel-bg);\n    border-radius: 12px;\n    box-shadow: 0 5px 15px rgba(0,0,0,0.1);\n    padding: 20px;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 25px;\n    border-bottom: 2px solid var(--border-color);\n    padding-bottom: 15px;\n}\n\nh1 { margin: 0; color: var(--accent-color); }\nh2 { font-size: 1.1rem; margin-bottom: 15px; color: var(--accent-color); border-bottom: 1px solid #eee; padding-bottom: 5px;}\np { margin: 5px 0 0; color: #7f8c8d; }\n\n.content-wrapper {\n    display: flex;\n    gap: 25px;\n    align-items: flex-start;\n}\n\n/* Sidebar */\n.sidebar {\n    flex: 1;\n    min-width: 300px;\n    background: #fafafa;\n    padding: 20px;\n    border-radius: 8px;\n    border: 1px solid var(--border-color);\n}\n\n.equation-container {\n    background: #fff;\n    padding: 10px;\n    border-radius: 6px;\n    margin-bottom: 20px;\n    text-align: center;\n    font-size: 0.9em;\n    box-shadow: inset 0 1px 4px rgba(0,0,0,0.05);\n    overflow-x: auto;\n}\n\n.control-group { margin-bottom: 15px; }\n.control-group label { display: block; font-weight: 600; font-size: 0.9rem; margin-bottom: 5px; }\n.control-group input[type=\"range\"] { width: 100%; cursor: pointer; }\n.val-display { display: block; text-align: right; font-family: monospace; font-weight: bold; color: var(--accent-color); }\n\n.results-section {\n    margin-top: 25px;\n    background: #fff;\n    padding: 15px;\n    border-radius: 8px;\n    border: 1px solid var(--border-color);\n}\n.metric-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.9rem; }\n\n/* Visualization Panel */\n.visualization-panel {\n    flex: 2;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.chart-container {\n    height: 350px;\n    position: relative;\n    background: #fff;\n    padding: 10px;\n    border-radius: 8px;\n    border: 1px solid var(--border-color);\n}\n\n.operating-point-control {\n    background: #eef6fc;\n    padding: 15px;\n    border-radius: 8px;\n    border: 1px solid var(--accent-color);\n}\n.op-results { margin-top: 10px; text-align: center; font-size: 1.1rem; }\n\n/* --- ANIMATION CONTAINER --- */\n.animation-container {\n    position: relative;\n    height: 250px;\n    background: linear-gradient(to bottom, #87CEEB 0%, #E0F7FA 100%);\n    border-radius: 8px;\n    border: 1px solid #bdc3c7;\n    overflow: hidden;\n}\n\n/* Canvas overlay for particles */\n#animCanvas {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 10;\n    pointer-events: none;\n}\n\n/* Static Elements (Sun, Panel, Bulb, Wires) */\n.sim-sun {\n    position: absolute;\n    top: 20px;\n    left: 20px;\n    width: 60px;\n    height: 60px;\n    background: radial-gradient(circle, #ffd700, #f39c12);\n    border-radius: 50%;\n    box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);\n    z-index: 5;\n}\n\n.sim-panel {\n    position: absolute;\n    bottom: 30px;\n    left: 50px;\n    width: 100px;\n    height: 80px;\n    background: #2c3e50;\n    border: 3px solid #34495e;\n    transform: perspective(300px) rotateX(10deg);\n    z-index: 5;\n}\n\n.panel-grid {\n    width: 100%;\n    height: 100%;\n    background-image: \n        linear-gradient(#fff 1px, transparent 1px),\n        linear-gradient(90deg, #fff 1px, transparent 1px);\n    background-size: 20px 20px;\n    opacity: 0.2;\n}\n\n.sim-bulb {\n    position: absolute;\n    top: 50%;\n    right: 60px;\n    transform: translateY(-50%);\n    width: 40px;\n    height: 40px;\n    background: #ecf0f1;\n    border: 2px solid #7f8c8d;\n    border-radius: 50%;\n    z-index: 5;\n    transition: background 0.1s, box-shadow 0.1s;\n}\n\n.wire-top {\n    position: absolute;\n    top: 40%;\n    left: 150px; /* Connect from panel */\n    right: 100px; /* Connect to bulb */\n    height: 2px;\n    background: #555;\n    z-index: 4;\n}\n\n.wire-bottom {\n    position: absolute;\n    bottom: 40%;\n    left: 150px;\n    right: 100px;\n    height: 2px;\n    background: #555;\n    z-index: 4;\n}\n\n/* Responsive adjustments */\n@media (max-width: 900px) {\n    .content-wrapper { flex-direction: column; }\n    .sidebar, .visualization-panel { width: 100%; }\n}", "js": "document.addEventListener('DOMContentLoaded', () => {\n    // --- Constants ---\n    const MAX_ITER = 100;\n    const TOLERANCE = 1e-6;\n\n    // --- DOM Refs ---\n    const inputs = {\n        IL: document.getElementById('IL'),\n        I0_log: document.getElementById('I0_log'),\n        n: document.getElementById('n'),\n        Vt: document.getElementById('Vt'),\n        Rs: document.getElementById('Rs'),\n        Rp_log: document.getElementById('Rp_log'),\n        V_op: document.getElementById('V_op')\n    };\n\n    const displays = {\n        IL: document.getElementById('IL-val'),\n        I0: document.getElementById('I0-val'),\n        n: document.getElementById('n-val'),\n        Vt: document.getElementById('Vt-val'),\n        Rs: document.getElementById('Rs-val'),\n        Rp: document.getElementById('Rp-val'),\n        V_op: document.getElementById('V_op-val'),\n        opI: document.getElementById('op-I'),\n        opP: document.getElementById('op-P'),\n        isc: document.getElementById('res-isc'),\n        voc: document.getElementById('res-voc'),\n        pmp: document.getElementById('res-pmp'),\n        ff: document.getElementById('res-ff')\n    };\n\n    const simBulb = document.getElementById('simBulb');\n    const animCanvas = document.getElementById('animCanvas');\n    const ctx = animCanvas.getContext('2d');\n    \n    // Static Elements for Coordinate Mapping\n    const elSun = document.querySelector('.sim-sun');\n    const elPanel = document.querySelector('.sim-panel');\n    const elBulb = document.querySelector('.sim-bulb');\n\n    let params = {};\n    let simResults = { Voc: 0, Isc: 0, Pmp: 0, currentOpI: 0, currentOpP: 0 };\n\n    // --- Physics Solver (Newton-Raphson) ---\n    function solveCurrent(V, p) {\n        let I = p.IL; // Initial guess\n        for (let i = 0; i < MAX_ITER; i++) {\n            const V_diode = V + I * p.Rs;\n            const V_th = p.n * p.Vt;\n            const exp_term = Math.exp(V_diode / V_th);\n            const f = p.IL - p.I0 * (exp_term - 1) - V_diode / p.Rp - I;\n            const df = -p.I0 * exp_term * (p.Rs / V_th) - (p.Rs / p.Rp) - 1;\n            \n            if (Math.abs(df) < 1e-9) break;\n            const delta = f / df;\n            I -= delta;\n            if (Math.abs(delta) < TOLERANCE) return I;\n        }\n        return I;\n    }\n\n    // --- Main Logic ---\n    function readParams() {\n        params = {\n            IL: parseFloat(inputs.IL.value),\n            I0: Math.pow(10, parseFloat(inputs.I0_log.value)),\n            n: parseFloat(inputs.n.value),\n            Vt: parseFloat(inputs.Vt.value),\n            Rs: parseFloat(inputs.Rs.value),\n            Rp: Math.pow(10, parseFloat(inputs.Rp_log.value)),\n            V_op: parseFloat(inputs.V_op.value)\n        };\n        \n        // Update text\n        displays.IL.textContent = params.IL.toFixed(1);\n        displays.I0.textContent = params.I0.toExponential(2);\n        displays.n.textContent = params.n.toFixed(2);\n        displays.Vt.textContent = params.Vt.toFixed(3);\n        displays.Rs.textContent = params.Rs.toFixed(3);\n        displays.Rp.textContent = params.Rp.toFixed(0);\n        displays.V_op.textContent = params.V_op.toFixed(1);\n    }\n\n    function calculateCurves() {\n        readParams();\n        const dataIV = [];\n        const dataPV = [];\n        \n        // Calculate ISC\n        simResults.Isc = solveCurrent(0, params);\n        \n        // Calculate VOC\n        let v_scan = 0, i_scan = simResults.Isc;\n        while(i_scan > 0 && v_scan < 100) {\n            v_scan += 0.5;\n            i_scan = solveCurrent(v_scan, params);\n        }\n        simResults.Voc = v_scan; \n        inputs.V_op.max = (simResults.Voc * 1.1).toFixed(1);\n\n        // Generate Plot Data\n        let maxP = 0;\n        for(let v = 0; v < simResults.Voc * 1.1; v+= (simResults.Voc/50)) {\n            const I = solveCurrent(v, params);\n            if(I < -0.5) break; \n            const P = v * I;\n            dataIV.push({x: v, y: Math.max(0, I)});\n            dataPV.push({x: v, y: Math.max(0, P)});\n            if(P > maxP) maxP = P;\n        }\n        simResults.Pmp = maxP;\n\n        // Operating Point\n        simResults.currentOpI = Math.max(0, solveCurrent(params.V_op, params));\n        simResults.currentOpP = params.V_op * simResults.currentOpI;\n\n        // Display Results\n        displays.isc.textContent = simResults.Isc.toFixed(2) + \" A\";\n        displays.voc.textContent = simResults.Voc.toFixed(2) + \" V\";\n        displays.pmp.textContent = simResults.Pmp.toFixed(2) + \" W\";\n        \n        const ff = (simResults.Voc * simResults.Isc) > 0 ? (simResults.Pmp / (simResults.Voc * simResults.Isc) * 100) : 0;\n        displays.ff.textContent = ff.toFixed(1) + \" %\";\n\n        displays.opI.textContent = simResults.currentOpI.toFixed(2) + \" A\";\n        displays.opP.textContent = simResults.currentOpP.toFixed(2) + \" W\";\n\n        // Update Chart\n        ivChart.data.datasets[0].data = dataIV;\n        ivChart.data.datasets[1].data = dataPV;\n        ivChart.data.datasets[2].data = [{x: params.V_op, y: simResults.currentOpI}];\n        ivChart.update('none');\n    }\n\n    // --- Chart Setup ---\n    const ivChart = new Chart(document.getElementById('ivChart').getContext('2d'), {\n        type: 'line',\n        data: {\n            datasets: [\n                { label: 'Current (A)', borderColor: '#3498db', data: [], yAxisID: 'y', pointRadius: 0, borderWidth: 2 },\n                { label: 'Power (W)', borderColor: '#e67e22', data: [], yAxisID: 'y1', pointRadius: 0, borderWidth: 2, borderDash: [5,5] },\n                { label: 'Op Point', borderColor: 'red', backgroundColor: 'red', data: [], pointRadius: 6, type: 'scatter' }\n            ]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            scales: {\n                x: { type: 'linear', position: 'bottom', title: {display:true, text:'Voltage (V)'} },\n                y: { type: 'linear', position: 'left', title: {display:true, text:'Current (A)'}, min: 0 },\n                y1: { type: 'linear', position: 'right', title: {display:true, text:'Power (W)'}, min: 0, grid: {drawOnChartArea: false} }\n            }\n        }\n    });\n\n    // --- Animation Logic ---\n    let particles = { photons: [], electrons: [] };\n    \n    // Helper: Get center coordinates of an element relative to canvas\n    function getCoords(el) {\n        const rect = el.getBoundingClientRect();\n        const canvasRect = animCanvas.getBoundingClientRect();\n        return {\n            x: rect.left - canvasRect.left + rect.width / 2,\n            y: rect.top - canvasRect.top + rect.height / 2,\n            w: rect.width,\n            h: rect.height,\n            top: rect.top - canvasRect.top,\n            bottom: rect.bottom - canvasRect.top\n        };\n    }\n\n    class Photon {\n        constructor(sun, panel) {\n            this.x = sun.x + (Math.random() - 0.5) * (sun.w * 0.5);\n            this.y = sun.y;\n            this.tx = panel.x + (Math.random() - 0.5) * (panel.w * 0.8);\n            this.ty = panel.y + (Math.random() - 0.5) * (panel.h * 0.5);\n            this.speed = 3 + Math.random();\n            this.active = true;\n        }\n        update() {\n            const dx = this.tx - this.x;\n            const dy = this.ty - this.y;\n            const dist = Math.sqrt(dx*dx + dy*dy);\n            if(dist < this.speed) {\n                this.active = false;\n                // Spawn electron if photon hits panel and current > 0\n                if(simResults.currentOpI > 0.05) {\n                    particles.electrons.push(new Electron(this.tx, this.ty));\n                }\n            } else {\n                this.x += (dx/dist) * this.speed;\n                this.y += (dy/dist) * this.speed;\n            }\n        }\n        draw(ctx) {\n            ctx.fillStyle = \"#f1c40f\";\n            ctx.beginPath();\n            ctx.arc(this.x, this.y, 2, 0, Math.PI*2);\n            ctx.fill();\n        }\n    }\n\n    class Electron {\n        constructor(x, y) {\n            this.x = x;\n            this.y = y;\n            this.state = 0; // 0: Panel->WireTop, 1: Across Top, 2: Down Bulb, 3: Return\n            this.speed = 2 + (simResults.currentOpI / 5); // Speed scales with current\n            this.active = true;\n        }\n        update(coords) {\n            const wireYTop = coords.bulb.top - 10; // Slightly above bulb center\n            const wireYBot = coords.bulb.bottom + 10;\n            const panelRight = coords.panel.x + coords.panel.w/2;\n            const bulbX = coords.bulb.x;\n\n            if(this.state === 0) {\n                // Move Up out of panel\n                this.y -= this.speed;\n                if(this.y < wireYTop) { this.y = wireYTop; this.state = 1; }\n            } else if(this.state === 1) {\n                // Move Right to bulb\n                this.x += this.speed * 1.5;\n                if(this.x > bulbX) { this.x = bulbX; this.state = 2; }\n            } else if(this.state === 2) {\n                // Move Down through bulb\n                this.y += this.speed;\n                if(this.y > wireYBot) { this.y = wireYBot; this.state = 3; }\n            } else if(this.state === 3) {\n                // Move Left back to panel\n                this.x -= this.speed * 1.5;\n                if(this.x < panelRight) {\n                    this.active = false; // Circuit complete\n                }\n            }\n        }\n        draw(ctx) {\n            ctx.fillStyle = \"#3498db\";\n            ctx.beginPath();\n            ctx.arc(this.x, this.y, 3, 0, Math.PI*2);\n            ctx.fill();\n        }\n    }\n\n    function animate() {\n        // Handle Canvas Resize\n        if(animCanvas.width !== animCanvas.offsetWidth || animCanvas.height !== animCanvas.offsetHeight) {\n            animCanvas.width = animCanvas.offsetWidth;\n            animCanvas.height = animCanvas.offsetHeight;\n        }\n        ctx.clearRect(0, 0, animCanvas.width, animCanvas.height);\n\n        // Get Current Positions of HTML Elements\n        const coords = {\n            sun: getCoords(elSun),\n            panel: getCoords(elPanel),\n            bulb: getCoords(elBulb)\n        };\n\n        // Spawn Photons based on IL intensity\n        const spawnRate = params.IL / 100; // Normalized\n        if(Math.random() < spawnRate) {\n            particles.photons.push(new Photon(coords.sun, coords.panel));\n        }\n\n        // Update & Draw Photons\n        particles.photons.forEach(p => p.update());\n        particles.photons = particles.photons.filter(p => p.active);\n        particles.photons.forEach(p => p.draw(ctx));\n\n        // Update & Draw Electrons\n        particles.electrons.forEach(e => e.update(coords));\n        particles.electrons = particles.electrons.filter(e => e.active);\n        particles.electrons.forEach(e => e.draw(ctx));\n        \n        // Safety cap\n        if(particles.electrons.length > 200) particles.electrons.splice(0, 50);\n\n        // Bulb Glow Effect\n        const powerRatio = simResults.Pmp > 0 ? (simResults.currentOpP / simResults.Pmp) : 0;\n        simBulb.style.boxShadow = `0 0 ${powerRatio * 40}px ${powerRatio * 10}px rgba(255, 255, 0, ${0.2 + powerRatio * 0.8})`;\n        simBulb.style.backgroundColor = `rgba(255, 255, ${255 - powerRatio*100}, 1)`;\n\n        requestAnimationFrame(animate);\n    }\n\n    // --- Init ---\n    Object.values(inputs).forEach(inp => inp.addEventListener('input', calculateCurves));\n    calculateCurves();\n    animate();\n});"}}
{"input": {"input_text": "Battery RC model (1-RC): terminal voltage Vt = OCV - I*R0 - Vrc; dVrc/dt = (I*R1 - Vrc)/C1.", "simulation_name": " Battery RC", "domain": "Energy", "description": "First-order RC battery model", "assumptions": ["Constant OCV"], "entities": [], "constants": [], "parameters": [{"name": "open_circuit_voltage", "symbol": "OCV", "unit": "V", "range": [2, 5]}, {"name": "ohmic_resistance", "symbol": "R0", "unit": "ohm", "range": [0.0001, 0.1]}, {"name": "polarization_resistance", "symbol": "R1", "unit": "ohm", "range": [0.0001, 0.5]}, {"name": "polarization_capacitance", "symbol": "C1", "unit": "F", "range": [10, 100000.0]}, {"name": "current", "symbol": "I", "unit": "A", "range": [-100, 100]}], "equations": [{"description": "RC voltage dynamics", "expression": "dVrcdt = (I*R1 - Vrc)/C1"}, {"description": "Terminal voltage", "expression": "Vt = OCV - I*R0 - Vrc"}], "initial_conditions": {"Vrc": 0}, "outputs": ["Vt", "dVrcdt"], "simulation_controls": ["OCV", "R0", "R1", "C1", "I"], "constraints": ["C1>0", "R0>=0", "R1>=0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S51: Battery RC Model Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"app-container\">\n    <aside class=\"sidebar\">\n        <header>\n            <h2>Battery Equivalent Circuit</h2>\n            <p>1st-Order Thevenin (1-RC) Model</p>\n        </header>\n\n        <div class=\"controls\">\n            <div class=\"control-group highlight-group\">\n                <label>Current ($I$) <span id=\"val-I\">0</span> A</label>\n                <input type=\"range\" id=\"in-I\" min=\"-100\" max=\"100\" step=\"1\" value=\"0\">\n                <div class=\"legend-text\">(- Charge / + Discharge)</div>\n            </div>\n\n            <div class=\"control-group\">\n                <label>Open Circuit Voltage ($OCV$) <span id=\"val-OCV\">3.7</span> V</label>\n                <input type=\"range\" id=\"in-OCV\" min=\"2\" max=\"5\" step=\"0.1\" value=\"3.7\">\n            </div>\n\n            <div class=\"control-group\">\n                <label>Ohmic Resistance ($R_0$) <span id=\"val-R0\">0.05</span> &#937;</label>\n                <input type=\"range\" id=\"in-R0\" min=\"0.0001\" max=\"0.1\" step=\"0.0001\" value=\"0.01\">\n            </div>\n\n            <div class=\"control-group\">\n                <label>Polarization Res ($R_1$) <span id=\"val-R1\">0.1</span> &#937;</label>\n                <input type=\"range\" id=\"in-R1\" min=\"0.001\" max=\"0.5\" step=\"0.001\" value=\"0.05\">\n            </div>\n\n            <div class=\"control-group\">\n                <label>Polarization Cap ($C_1$) <span id=\"val-C1\">1000</span> F</label>\n                <input type=\"range\" id=\"in-C1\" min=\"10\" max=\"10000\" step=\"10\" value=\"2000\">\n            </div>\n            \n            <button id=\"pulse-btn\" class=\"action-btn\">Trigger 10s Pulse</button>\n        </div>\n\n        <div class=\"equations\">\n            <h3>Model Dynamics</h3>\n            <p>$$ V_t = OCV - I R_0 - V_{rc} $$</p>\n            <p>$$ \\frac{dV_{rc}}{dt} = \\frac{I}{C_1} - \\frac{V_{rc}}{R_1 C_1} $$</p>\n        </div>\n    </aside>\n\n    <main class=\"main-content\">\n        <div class=\"dashboard\">\n            <div class=\"card\">\n                <div class=\"card-label\">Terminal Voltage ($V_t$)</div>\n                <div class=\"card-value\" id=\"disp-Vt\">3.70 V</div>\n            </div>\n            <div class=\"card\">\n                <div class=\"card-label\">Polarization Voltage ($V_{rc}$)</div>\n                <div class=\"card-value secondary\" id=\"disp-Vrc\">0.00 V</div>\n            </div>\n            <div class=\"card\">\n                <div class=\"card-label\">Time Constant ($\\tau$)</div>\n                <div class=\"card-value small\" id=\"disp-Tau\">0.00 s</div>\n            </div>\n        </div>\n\n        <div class=\"vis-container\">\n            <div class=\"graph-wrapper\">\n                <canvas id=\"graphCanvas\"></canvas>\n            </div>\n            <div class=\"circuit-wrapper\">\n                <canvas id=\"circuitCanvas\"></canvas>\n                \n\n[Image of equivalent circuit of a battery]\n\n            </div>\n        </div>\n    </main>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-dark: #121212;\n    --bg-panel: #1e1e1e;\n    --text-main: #e0e0e0;\n    --accent-blue: #4fa1f3;\n    --accent-green: #4caf50;\n    --accent-red: #f44336;\n    --border: #333;\n}\n\nbody {\n    margin: 0;\n    padding: 0;\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-dark);\n    color: var(--text-main);\n    height: 100vh;\n    overflow: hidden;\n}\n\n.app-container {\n    display: flex;\n    height: 100%;\n}\n\n/* Sidebar */\n.sidebar {\n    width: 340px;\n    background: var(--bg-panel);\n    border-right: 1px solid var(--border);\n    display: flex;\n    flex-direction: column;\n    padding: 20px;\n    overflow-y: auto;\n    z-index: 10;\n}\n\n.sidebar header h2 { margin: 0; color: var(--accent-green); font-size: 1.4rem; }\n.sidebar header p { color: #888; margin-top: 5px; font-size: 0.9rem; }\n\n.controls { margin-top: 20px; flex: 1; }\n\n.control-group { margin-bottom: 20px; }\n.control-group label { display: flex; justify-content: space-between; font-weight: 600; font-size: 0.9rem; margin-bottom: 8px; }\n.control-group input[type=\"range\"] { width: 100%; cursor: pointer; }\n\n.highlight-group {\n    background: rgba(255,255,255,0.05);\n    padding: 10px;\n    border-radius: 6px;\n    border: 1px solid #444;\n}\n\n.legend-text { font-size: 0.75rem; color: #888; margin-top: 4px; text-align: right; }\n\n.action-btn {\n    width: 100%;\n    padding: 10px;\n    background: var(--accent-blue);\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-weight: bold;\n    margin-top: 10px;\n}\n.action-btn:hover { background: #3b8ad9; }\n\n.equations {\n    background: #2a2a2a;\n    padding: 10px;\n    border-radius: 6px;\n    font-size: 0.85rem;\n    text-align: center;\n}\n\n/* Main Content */\n.main-content {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    padding: 20px;\n    gap: 20px;\n}\n\n.dashboard {\n    display: flex;\n    gap: 15px;\n}\n\n.card {\n    background: var(--bg-panel);\n    border: 1px solid var(--border);\n    padding: 15px;\n    border-radius: 8px;\n    min-width: 180px;\n    text-align: center;\n}\n\n.card-label { font-size: 0.8rem; color: #aaa; text-transform: uppercase; letter-spacing: 1px; }\n.card-value { font-size: 1.8rem; font-weight: bold; margin-top: 5px; color: var(--accent-green); }\n.card-value.secondary { color: var(--accent-blue); }\n.card-value.small { font-size: 1.2rem; color: #aaa; }\n\n.vis-container {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n    min-height: 0; /* Important for nested flex scroll */\n}\n\n.graph-wrapper {\n    flex: 1;\n    background: #000;\n    border: 1px solid var(--border);\n    border-radius: 8px;\n    position: relative;\n    overflow: hidden;\n}\n\n.circuit-wrapper {\n    height: 250px;\n    background: #1a1a1a;\n    border: 1px solid var(--border);\n    border-radius: 8px;\n    position: relative;\n    overflow: hidden;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n\ncanvas {\n    display: block;\n    width: 100%;\n    height: 100%;\n}", "js": "// --- Configuration & State ---\nconst state = {\n    // Parameters\n    I: 0,       // Amps (positive = discharge)\n    OCV: 3.7,   // Volts\n    R0: 0.01,   // Ohms\n    R1: 0.05,   // Ohms\n    C1: 2000,   // Farads\n    \n    // Dynamic Variables\n    Vrc: 0,     // Voltage across RC pair\n    Vt: 3.7,    // Terminal Voltage\n    time: 0\n};\n\n// History for Graphing\nconst maxPoints = 300;\nconst history = {\n    t: new Array(maxPoints).fill(0),\n    Vt: new Array(maxPoints).fill(3.7),\n    I: new Array(maxPoints).fill(0),\n    Vrc: new Array(maxPoints).fill(0)\n};\n\n// Canvas Contexts\nconst graphCanvas = document.getElementById('graphCanvas');\nconst graphCtx = graphCanvas.getContext('2d');\nconst circCanvas = document.getElementById('circuitCanvas');\nconst circCtx = circCanvas.getContext('2d');\n\n// --- Physics Engine ---\nlet lastTime = performance.now();\nconst dt = 0.05; // Simulation timestep (seconds) per frame\n\nfunction updatePhysics() {\n    // Standard 1-RC Battery Model Equation\n    // dVrc/dt = (I/C1) - (Vrc / (R1 * C1))\n    \n    // 1. Calculate derivatives\n    // Note: I is positive for discharge. \n    // If I > 0, Vrc increases (polarization builds up).\n    const tau = state.R1 * state.C1;\n    const dVrc_dt = (state.I / state.C1) - (state.Vrc / tau);\n    \n    // 2. Euler Integration\n    state.Vrc += dVrc_dt * dt;\n    state.time += dt;\n\n    // 3. Terminal Voltage Equation\n    // Vt = OCV - I*R0 - Vrc\n    state.Vt = state.OCV - (state.I * state.R0) - state.Vrc;\n\n    // 4. Update History Buffers (Rolling)\n    history.t.shift();\n    history.t.push(state.time);\n    \n    history.Vt.shift();\n    history.Vt.push(state.Vt);\n    \n    history.I.shift();\n    history.I.push(state.I);\n\n    history.Vrc.shift();\n    history.Vrc.push(state.Vrc);\n}\n\n// --- Pulse Trigger Logic ---\nlet pulseActive = false;\nlet prePulseCurrent = 0;\nfunction triggerPulse() {\n    if(pulseActive) return;\n    \n    const pulseCurrent = 50; // Amp pulse\n    prePulseCurrent = parseFloat(document.getElementById('in-I').value);\n    \n    // Set UI and State\n    updateInput('in-I', pulseCurrent);\n    pulseActive = true;\n\n    // Reset after 10 seconds (simulated time, but we use real timeout for UX)\n    setTimeout(() => {\n        updateInput('in-I', prePulseCurrent);\n        pulseActive = false;\n    }, 2000); // 2 seconds real time representing a short burst\n}\n\nfunction updateInput(id, val) {\n    const el = document.getElementById(id);\n    el.value = val;\n    el.dispatchEvent(new Event('input'));\n}\n\n// --- Visualization ---\n\nfunction resizeCanvases() {\n    graphCanvas.width = graphCanvas.parentElement.clientWidth;\n    graphCanvas.height = graphCanvas.parentElement.clientHeight;\n    circCanvas.width = circCanvas.parentElement.clientWidth;\n    circCanvas.height = circCanvas.parentElement.clientHeight;\n}\n\nfunction drawGraph() {\n    const w = graphCanvas.width;\n    const h = graphCanvas.height;\n    graphCtx.clearRect(0, 0, w, h);\n\n    // Draw Grid\n    graphCtx.strokeStyle = \"#333\";\n    graphCtx.lineWidth = 1;\n    graphCtx.beginPath();\n    for(let i=0; i<5; i++) {\n        let y = (h/5)*i;\n        graphCtx.moveTo(0, y);\n        graphCtx.lineTo(w, y);\n    }\n    graphCtx.stroke();\n\n    // Scales\n    const maxV = 5.0; // Max Voltage for Y-axis\n    const minV = 2.0; \n    const rangeV = maxV - minV;\n    \n    // Helper to map Y\n    const mapY = (val) => h - ((val - minV) / rangeV) * h;\n    const mapX = (i) => (i / (maxPoints - 1)) * w;\n\n    // Draw Voltage (Vt) - Green\n    graphCtx.strokeStyle = \"#4caf50\";\n    graphCtx.lineWidth = 3;\n    graphCtx.beginPath();\n    for(let i=0; i<maxPoints; i++) {\n        const x = mapX(i);\n        const y = mapY(history.Vt[i]);\n        if(i===0) graphCtx.moveTo(x, y);\n        else graphCtx.lineTo(x, y);\n    }\n    graphCtx.stroke();\n\n    // Draw OCV Reference - Dashed Grey\n    const yOCV = mapY(state.OCV);\n    graphCtx.strokeStyle = \"#666\";\n    graphCtx.setLineDash([5, 5]);\n    graphCtx.beginPath();\n    graphCtx.moveTo(0, yOCV);\n    graphCtx.lineTo(w, yOCV);\n    graphCtx.stroke();\n    graphCtx.setLineDash([]);\n\n    // Draw Current (I) - Blue (Secondary Axis, scaled abstractly)\n    // Map I (-100 to 100) to middle strip of screen\n    graphCtx.strokeStyle = \"rgba(79, 161, 243, 0.4)\";\n    graphCtx.lineWidth = 2;\n    graphCtx.beginPath();\n    for(let i=0; i<maxPoints; i++) {\n        const x = mapX(i);\n        // Normalize I to +/- 50 pixels from center height\n        const y = (h/2) - (history.I[i] / 100) * (h/4); \n        if(i===0) graphCtx.moveTo(x, y);\n        else graphCtx.lineTo(x, y);\n    }\n    graphCtx.stroke();\n}\n\nfunction drawCircuit() {\n    const w = circCanvas.width;\n    const h = circCanvas.height;\n    circCtx.clearRect(0, 0, w, h);\n\n    const cx = w/2;\n    const cy = h/2;\n    const colorLine = \"#e0e0e0\";\n    const colorElectron = \"#f44336\"; // Red for charge flow\n    \n    circCtx.strokeStyle = colorLine;\n    circCtx.lineWidth = 3;\n    circCtx.lineJoin = \"round\";\n\n    // --- Draw Components ---\n    // 1. OCV Source (Left)\n    const battX = cx - 150;\n    circCtx.beginPath();\n    // Top terminal\n    circCtx.moveTo(battX, cy - 40);\n    circCtx.lineTo(battX, cy - 10);\n    // Battery symbol\n    circCtx.moveTo(battX - 15, cy - 10); circCtx.lineTo(battX + 15, cy - 10); // Long plate\n    circCtx.moveTo(battX - 8, cy + 10); circCtx.lineTo(battX + 8, cy + 10);   // Short plate\n    // Bottom terminal\n    circCtx.moveTo(battX, cy + 10);\n    circCtx.lineTo(battX, cy + 40);\n    circCtx.stroke();\n    circCtx.fillStyle = \"#fff\";\n    circCtx.fillText(\"OCV\", battX - 30, cy);\n\n    // 2. R0 (Series Resistor)\n    const r0X = cx - 50;\n    circCtx.beginPath();\n    circCtx.moveTo(battX, cy - 40); // From battery top\n    circCtx.lineTo(r0X - 20, cy - 40);\n    // Zigzag\n    let zigX = r0X - 20;\n    for(let i=0; i<4; i++) {\n        circCtx.lineTo(zigX + 5, cy - 40 - 10);\n        circCtx.lineTo(zigX + 10, cy - 40 + 10);\n        zigX += 10;\n    }\n    circCtx.lineTo(r0X + 20, cy - 40);\n    circCtx.stroke();\n    circCtx.fillText(\"R0\", r0X - 5, cy - 60);\n\n    // 3. RC Pair (Right)\n    const rcX = cx + 80;\n    const topWireY = cy - 40;\n    const botWireY = cy + 40;\n    \n    // Connect R0 to RC node\n    circCtx.beginPath();\n    circCtx.moveTo(r0X + 20, topWireY);\n    circCtx.lineTo(rcX, topWireY);\n    circCtx.stroke();\n\n    // R1 (Vertical Zigzag)\n    const r1X = rcX - 20;\n    circCtx.beginPath();\n    circCtx.moveTo(r1X, topWireY);\n    circCtx.lineTo(r1X, topWireY + 10);\n    // Zigzag vertical\n    let zigY = topWireY + 10;\n    const zigH = (botWireY - topWireY - 20);\n    circCtx.lineTo(r1X - 5, zigY + zigH*0.25);\n    circCtx.lineTo(r1X + 5, zigY + zigH*0.5);\n    circCtx.lineTo(r1X - 5, zigY + zigH*0.75);\n    circCtx.lineTo(r1X, zigY + zigH);\n    circCtx.lineTo(r1X, botWireY);\n    circCtx.stroke();\n    circCtx.fillText(\"R1\", r1X - 25, cy);\n\n    // C1 (Capacitor Symbol)\n    const c1X = rcX + 20;\n    circCtx.beginPath();\n    circCtx.moveTo(c1X, topWireY);\n    circCtx.lineTo(c1X, cy - 5);\n    // Plates\n    circCtx.moveTo(c1X - 10, cy - 5); circCtx.lineTo(c1X + 10, cy - 5);\n    circCtx.moveTo(c1X - 10, cy + 5); circCtx.lineTo(c1X + 10, cy + 5);\n    circCtx.moveTo(c1X, cy + 5);\n    circCtx.lineTo(c1X, botWireY);\n    circCtx.stroke();\n    circCtx.fillText(\"C1\", c1X + 15, cy);\n\n    // Return path\n    circCtx.beginPath();\n    circCtx.moveTo(rcX, botWireY);\n    circCtx.lineTo(battX, botWireY);\n    circCtx.stroke();\n\n    // --- Animation: Current Flow ---\n    if (Math.abs(state.I) > 1) {\n        circCtx.fillStyle = state.I > 0 ? \"#f44336\" : \"#4fa1f3\"; // Red discharge, Blue charge\n        const speed = state.I * 0.1;\n        const timeOffset = (Date.now() / 1000) * speed * 5;\n        \n        // Draw dots along the top wire path\n        // Simplified path for particles: Battery -> R0 -> RC -> Battery\n        const pathY = topWireY - 5; // offset slightly above wire\n        \n        for (let i = 0; i < 10; i++) {\n            let px = (timeOffset + i * 40) % 300; // loop length\n            if (px < 0) px += 300;\n            \n            // Map px to physical coordinates\n            // 0 to 150: Top wire (Left to Right)\n            // 150 to 220: Down through load (abstracted)\n            // ... simplifying just to show flow direction on top wire\n            \n            let xPos = battX + px;\n            if(xPos < rcX + 50) {\n               circCtx.beginPath();\n               circCtx.arc(xPos, topWireY, 3, 0, Math.PI*2);\n               circCtx.fill();\n            }\n        }\n    }\n\n    // --- Visualization: C1 Charge Level ---\n    // Visualize Vrc as color intensity on C1\n    const maxVrc = state.I * state.R1 * 2; // Approximate scaling\n    const intensity = Math.min(1, Math.abs(state.Vrc) / 0.5); // Arbitrary scale for visual\n    circCtx.fillStyle = `rgba(255, 165, 0, ${intensity})`; // Orange glow\n    circCtx.fillRect(c1X - 10, cy - 5, 20, 10);\n\n}\n\n// --- Main Loop ---\nfunction loop() {\n    updatePhysics();\n    \n    // UI Updates\n    document.getElementById('disp-Vt').innerText = state.Vt.toFixed(2) + \" V\";\n    document.getElementById('disp-Vrc').innerText = state.Vrc.toFixed(3) + \" V\";\n    document.getElementById('disp-Tau').innerText = (state.R1 * state.C1).toFixed(1) + \" s\";\n\n    drawGraph();\n    drawCircuit();\n    \n    requestAnimationFrame(loop);\n}\n\n// --- Initialization ---\nfunction init() {\n    // Attach Listeners\n    ['I', 'OCV', 'R0', 'R1', 'C1'].forEach(key => {\n        const el = document.getElementById('in-' + key);\n        const disp = document.getElementById('val-' + key);\n        \n        el.addEventListener('input', (e) => {\n            state[key] = parseFloat(e.target.value);\n            disp.innerText = state[key];\n        });\n    });\n\n    document.getElementById('pulse-btn').addEventListener('click', triggerPulse);\n\n    resizeCanvases();\n    window.addEventListener('resize', resizeCanvases);\n    \n    loop();\n}\n\ninit();"}}
{"input": {"input_text": "Wind turbine power: P = 0.5*rho*A*Cp*V^3. Compute power for given wind speed.", "simulation_name": " Wind Turbine", "domain": "Energy", "description": "Idealized wind power capture", "assumptions": ["Constant Cp"], "entities": [], "constants": [], "parameters": [{"name": "air_density", "symbol": "rho", "unit": "kg/m^3", "range": [0.9, 1.3]}, {"name": "swept_area", "symbol": "A", "unit": "m^2", "range": [1, 10000]}, {"name": "power_coefficient", "symbol": "Cp", "unit": "dimensionless", "range": [0, 0.59]}, {"name": "wind_speed", "symbol": "V", "unit": "m/s", "range": [0, 30]}], "equations": [{"description": "Power", "expression": "P = 0.5*rho*A*Cp*V^3"}], "initial_conditions": {}, "outputs": ["P"], "simulation_controls": ["rho", "A", "Cp", "V"], "constraints": ["Cp>=0", "A>0", "rho>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S52 Wind Turbine Power Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"container\">\n    <header>\n        <h1>Wind Turbine Power Calculator</h1>\n        <p>Interactive simulation of wind energy capture</p>\n    </header>\n\n    <div class=\"simulation-layout\">\n        <aside class=\"controls\">\n            <div class=\"equation-box\">\n                $$P = \\frac{1}{2} \\rho A C_p V^3$$\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"V-slider\">Wind Speed ($V$)</label>\n                <div class=\"control-row\">\n                    <input type=\"range\" id=\"V-slider\" min=\"0\" max=\"30\" step=\"0.1\" value=\"10\">\n                    <span class=\"value-display\"><span id=\"V-val\">10.0</span> m/s</span>\n                </div>\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"A-slider\">Swept Area ($A$)</label>\n                <div class=\"control-row\">\n                    <input type=\"range\" id=\"A-slider\" min=\"1\" max=\"10000\" step=\"10\" value=\"2000\">\n                    <span class=\"value-display\"><span id=\"A-val\">2000</span> m²</span>\n                </div>\n                <small class=\"helper-text\">Rotor Radius: <span id=\"radius-val\">25.2</span> m</small>\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"rho-slider\">Air Density ($\\rho$)</label>\n                <div class=\"control-row\">\n                    <input type=\"range\" id=\"rho-slider\" min=\"0.9\" max=\"1.3\" step=\"0.01\" value=\"1.225\">\n                    <span class=\"value-display\"><span id=\"rho-val\">1.225</span> kg/m³</span>\n                </div>\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"Cp-slider\">Power Coeff ($C_p$)</label>\n                <div class=\"control-row\">\n                    <input type=\"range\" id=\"Cp-slider\" min=\"0\" max=\"0.59\" step=\"0.01\" value=\"0.4\">\n                    <span class=\"value-display\"><span id=\"Cp-val\">0.40</span></span>\n                </div>\n                <small class=\"helper-text\">Max 0.59 (Betz Limit)</small>\n            </div>\n\n            <div class=\"result-box\">\n                <h3>Power Output</h3>\n                <div class=\"power-display\">\n                    <span id=\"P-result\">0.00</span>\n                    <span class=\"unit\">kW</span>\n                </div>\n            </div>\n        </aside>\n\n        <main class=\"visualization\">\n            <div class=\"canvas-container\">\n                <canvas id=\"turbineCanvas\"></canvas>\n                <div class=\"overlay-metrics\">\n                    <div id=\"wind-meter\">Wind: 10 m/s</div>\n                </div>\n            </div>\n            \n            <div class=\"chart-container\">\n                <canvas id=\"powerCurveChart\"></canvas>\n            </div>\n        </main>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary-color: #27ae60; /* Green energy color */\n    --secondary-color: #2980b9; /* Wind/Sky color */\n    --bg-color: #f4f7f6;\n    --panel-bg: #ffffff;\n    --text-color: #2c3e50;\n    --border-radius: 8px;\n}\n\nbody {\n    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n}\n\n.container {\n    width: 100%;\n    max-width: 1200px;\n    background-color: var(--panel-bg);\n    padding: 25px;\n    border-radius: var(--border-radius);\n    box-shadow: 0 4px 15px rgba(0,0,0,0.1);\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 25px;\n    border-bottom: 2px solid #eee;\n    padding-bottom: 15px;\n}\n\nh1 { margin: 0; color: var(--secondary-color); }\np { margin: 5px 0 0; color: #7f8c8d; }\n\n.simulation-layout {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 30px;\n}\n\n/* Controls Styling */\n.controls {\n    flex: 1;\n    min-width: 300px;\n    background: #fafafa;\n    padding: 20px;\n    border-radius: var(--border-radius);\n    border: 1px solid #eee;\n}\n\n.equation-box {\n    background: #fff;\n    padding: 10px;\n    border-radius: var(--border-radius);\n    text-align: center;\n    margin-bottom: 20px;\n    font-size: 1.1rem;\n    border: 1px solid #eee;\n}\n\n.input-group {\n    margin-bottom: 20px;\n}\n\n.input-group label {\n    display: block;\n    margin-bottom: 5px;\n    font-weight: 600;\n    font-size: 0.9rem;\n}\n\n.control-row {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\ninput[type=range] {\n    flex-grow: 1;\n    cursor: pointer;\n    accent-color: var(--secondary-color);\n}\n\n.value-display {\n    width: 80px;\n    text-align: right;\n    font-family: monospace;\n    font-weight: bold;\n    color: var(--secondary-color);\n}\n\n.helper-text {\n    display: block;\n    text-align: right;\n    font-size: 0.75rem;\n    color: #95a5a6;\n    margin-top: 2px;\n}\n\n.result-box {\n    margin-top: 30px;\n    padding: 20px;\n    background-color: var(--primary-color);\n    color: white;\n    text-align: center;\n    border-radius: var(--border-radius);\n    box-shadow: 0 4px 6px rgba(39, 174, 96, 0.2);\n}\n\n.result-box h3 { margin: 0 0 10px 0; font-size: 1rem; opacity: 0.9; }\n.power-display { font-size: 2rem; font-weight: bold; }\n.unit { font-size: 1rem; font-weight: normal; margin-left: 5px; }\n\n/* Visualization Styling */\n.visualization {\n    flex: 2;\n    min-width: 400px;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.canvas-container {\n    position: relative;\n    width: 100%;\n    height: 350px;\n    background: linear-gradient(to bottom, #87CEEB 0%, #e0f7fa 80%, #2ecc71 80%, #27ae60 100%);\n    border-radius: var(--border-radius);\n    overflow: hidden;\n    border: 1px solid #ccc;\n}\n\ncanvas#turbineCanvas {\n    width: 100%;\n    height: 100%;\n    display: block;\n}\n\n.overlay-metrics {\n    position: absolute;\n    top: 10px;\n    left: 10px;\n    background: rgba(255,255,255,0.8);\n    padding: 5px 10px;\n    border-radius: 4px;\n    font-weight: bold;\n    font-size: 0.8rem;\n    color: var(--text-color);\n}\n\n.chart-container {\n    height: 250px;\n    background: #fff;\n    padding: 10px;\n    border-radius: var(--border-radius);\n    border: 1px solid #eee;\n}", "js": "document.addEventListener('DOMContentLoaded', () => {\n    // Inputs\n    const sliders = {\n        V: document.getElementById('V-slider'),\n        A: document.getElementById('A-slider'),\n        rho: document.getElementById('rho-slider'),\n        Cp: document.getElementById('Cp-slider')\n    };\n\n    // Value Displays\n    const displays = {\n        V: document.getElementById('V-val'),\n        A: document.getElementById('A-val'),\n        rho: document.getElementById('rho-val'),\n        Cp: document.getElementById('Cp-val'),\n        radius: document.getElementById('radius-val'),\n        P: document.getElementById('P-result'),\n        windMeter: document.getElementById('wind-meter')\n    };\n\n    // Visualization Canvas\n    const canvas = document.getElementById('turbineCanvas');\n    const ctx = canvas.getContext('2d');\n\n    // State Variables\n    let params = {\n        V: parseFloat(sliders.V.value),\n        A: parseFloat(sliders.A.value),\n        rho: parseFloat(sliders.rho.value),\n        Cp: parseFloat(sliders.Cp.value)\n    };\n\n    let turbineAngle = 0;\n    let windParticles = [];\n\n    // --- Chart Setup (Chart.js) ---\n    const chartCtx = document.getElementById('powerCurveChart').getContext('2d');\n    const powerChart = new Chart(chartCtx, {\n        type: 'line',\n        data: {\n            labels: [], // Wind speeds 0-30\n            datasets: [{\n                label: 'Power Curve (kW)',\n                data: [],\n                borderColor: '#2980b9',\n                backgroundColor: 'rgba(41, 128, 185, 0.1)',\n                borderWidth: 2,\n                pointRadius: 0,\n                fill: true,\n                tension: 0.4\n            }, {\n                label: 'Current Operating Point',\n                data: [],\n                backgroundColor: '#e74c3c',\n                borderColor: '#e74c3c',\n                pointRadius: 6,\n                pointHoverRadius: 8,\n                type: 'scatter'\n            }]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            scales: {\n                x: {\n                    type: 'linear',\n                    title: { display: true, text: 'Wind Speed (m/s)' },\n                    min: 0,\n                    max: 30\n                },\n                y: {\n                    title: { display: true, text: 'Power (kW)' },\n                    beginAtZero: true\n                }\n            },\n            plugins: {\n                tooltip: {\n                    callbacks: {\n                        label: function(context) {\n                            return context.raw.y ? `Power: ${context.raw.y.toFixed(2)} kW` : '';\n                        }\n                    }\n                }\n            }\n        }\n    });\n\n    // --- Core Logic ---\n\n    function calculatePower(V, A, rho, Cp) {\n        // P = 0.5 * rho * A * Cp * V^3\n        // Result is in Watts. Convert to kW for display.\n        const watts = 0.5 * rho * A * Cp * Math.pow(V, 3);\n        return watts / 1000; // kW\n    }\n\n    function updateSimulation() {\n        // Read Inputs\n        params.V = parseFloat(sliders.V.value);\n        params.A = parseFloat(sliders.A.value);\n        params.rho = parseFloat(sliders.rho.value);\n        params.Cp = parseFloat(sliders.Cp.value);\n\n        // Calculate Radius (Area = pi * r^2  => r = sqrt(A/pi))\n        const radius = Math.sqrt(params.A / Math.PI);\n\n        // Update Text\n        displays.V.textContent = params.V.toFixed(1);\n        displays.A.textContent = params.A.toFixed(0);\n        displays.rho.textContent = params.rho.toFixed(3);\n        displays.Cp.textContent = params.Cp.toFixed(2);\n        displays.radius.textContent = radius.toFixed(1);\n        displays.windMeter.textContent = `Wind: ${params.V.toFixed(1)} m/s`;\n\n        // Calculate Current Power\n        const currentPowerKW = calculatePower(params.V, params.A, params.rho, params.Cp);\n        displays.P.textContent = currentPowerKW.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });\n\n        // Update Chart Data\n        updateChart(currentPowerKW);\n    }\n\n    function updateChart(currentP) {\n        // Generate curve for V from 0 to 30 based on CURRENT A, rho, Cp\n        const curveData = [];\n        for (let v = 0; v <= 30; v += 1) {\n            curveData.push({\n                x: v,\n                y: calculatePower(v, params.A, params.rho, params.Cp)\n            });\n        }\n\n        powerChart.data.datasets[0].data = curveData;\n        powerChart.data.datasets[1].data = [{ x: params.V, y: currentP }];\n        \n        // Dynamically adjust Y scale max to prevent flat lines if power is huge\n        // Or keep it steady if changes are small. \n        // For simplicity, we let Chart.js auto-scale, but ensure 0 is baseline.\n        powerChart.update('none'); // 'none' mode prevents full re-animation on every slider drag\n    }\n\n    // --- Animation System ---\n\n    class WindParticle {\n        constructor(width, height) {\n            this.width = width;\n            this.height = height;\n            this.reset();\n        }\n\n        reset() {\n            this.x = Math.random() * this.width;\n            this.y = Math.random() * (this.height * 0.7); // Only in sky\n            this.speed = Math.random() * 2 + 1; // Base variance\n            this.length = Math.random() * 20 + 10;\n        }\n\n        update(windSpeed) {\n            // Speed scaling factor\n            this.x += this.speed + (windSpeed * 0.5); \n            \n            if (this.x > this.width) {\n                this.x = -this.length;\n                this.y = Math.random() * (this.height * 0.7);\n            }\n        }\n\n        draw(ctx) {\n            ctx.beginPath();\n            ctx.strokeStyle = \"rgba(255, 255, 255, 0.4)\";\n            ctx.lineWidth = 2;\n            ctx.moveTo(this.x, this.y);\n            ctx.lineTo(this.x - this.length, this.y);\n            ctx.stroke();\n        }\n    }\n\n    function resizeCanvas() {\n        canvas.width = canvas.parentElement.clientWidth;\n        canvas.height = canvas.parentElement.clientHeight;\n        \n        // Reset particles on resize\n        windParticles = [];\n        for(let i=0; i<30; i++) {\n            windParticles.push(new WindParticle(canvas.width, canvas.height));\n        }\n    }\n\n    function drawTurbine() {\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n        \n        const centerX = canvas.width * 0.7; // Position turbine on the right\n        const groundHeight = canvas.height * 0.2;\n        const towerBaseY = canvas.height - groundHeight;\n        const towerTopY = canvas.height * 0.4;\n        \n        // 1. Draw Background Elements (Hills, etc already in CSS gradient, maybe add detail?)\n        \n        // 2. Draw Wind Particles\n        // Visual density increases with rho slightly (optional, but nice detail)\n        windParticles.forEach(p => {\n            p.update(params.V);\n            p.draw(ctx);\n        });\n\n        // 3. Draw Tower\n        ctx.fillStyle = \"#ecf0f1\";\n        ctx.beginPath();\n        ctx.moveTo(centerX - 5, towerBaseY); // Base Left\n        ctx.lineTo(centerX + 5, towerBaseY); // Base Right\n        ctx.lineTo(centerX + 2, towerTopY);  // Top Right\n        ctx.lineTo(centerX - 2, towerTopY);  // Top Left\n        ctx.fill();\n\n        // 4. Calculate Turbine Visual Scale\n        // Map Area (1 - 10000) to a reasonable pixel radius (20px - 120px)\n        // Using Log scale for visual sanity\n        const minPx = 30;\n        const maxPx = 130;\n        const minA = 1;\n        const maxA = 10000;\n        // Log mapping: ratio = log(A) / log(maxA) roughly\n        const logA = Math.log(params.A);\n        const logMin = Math.log(minA);\n        const logMax = Math.log(maxA);\n        const scale = (logA - logMin) / (logMax - logMin);\n        const bladeLength = minPx + scale * (maxPx - minPx);\n\n        // 5. Draw Blades\n        ctx.save();\n        ctx.translate(centerX, towerTopY);\n        \n        // Rotation speed depends on Wind Speed V\n        // Note: Realistically, RPM saturates, but for viz, V proportionality is good\n        // Also if V=0, no rotation.\n        const rotationSpeed = params.V * 0.02; \n        turbineAngle += rotationSpeed;\n        \n        ctx.rotate(turbineAngle);\n\n        ctx.fillStyle = \"#fff\";\n        ctx.strokeStyle = \"#bdc3c7\";\n        ctx.lineWidth = 1;\n\n        // Draw 3 blades\n        for (let i = 0; i < 3; i++) {\n            ctx.beginPath();\n            ctx.moveTo(0, 0);\n            // Simple blade shape\n            ctx.quadraticCurveTo(10, -bladeLength/2, 0, -bladeLength);\n            ctx.quadraticCurveTo(-10, -bladeLength/2, 0, 0);\n            ctx.fill();\n            ctx.stroke();\n            ctx.rotate((2 * Math.PI) / 3); // Rotate 120 degrees\n        }\n        \n        // Hub\n        ctx.beginPath();\n        ctx.arc(0, 0, 5, 0, 2 * Math.PI);\n        ctx.fillStyle = \"#bdc3c7\";\n        ctx.fill();\n\n        ctx.restore();\n\n        requestAnimationFrame(drawTurbine);\n    }\n\n    // --- Events ---\n    Object.values(sliders).forEach(s => s.addEventListener('input', updateSimulation));\n    window.addEventListener('resize', resizeCanvas);\n\n    // --- Init ---\n    resizeCanvas();\n    updateSimulation();\n    drawTurbine();\n});"}}
{"input": {"input_text": "Hydraulic orifice equation: Q = Cd*A*sqrt(2*DeltaP/rho). Compute flow rate for pressure drop.", "simulation_name": " Orifice Flow", "domain": "Fluid Mechanics", "description": "Incompressible orifice equation", "assumptions": ["Incompressible", "Sharp-edged"], "entities": [], "constants": [], "parameters": [{"name": "discharge_coeff", "symbol": "Cd", "unit": "dimensionless", "range": [0.5, 0.9]}, {"name": "area", "symbol": "A", "unit": "m^2", "range": [1e-06, 0.1]}, {"name": "pressure_drop", "symbol": "DeltaP", "unit": "Pa", "range": [10, 10000000.0]}, {"name": "density", "symbol": "rho", "unit": "kg/m^3", "range": [100, 1500]}], "equations": [{"description": "Flow", "expression": "Q = Cd*A*sqrt(2*DeltaP/rho)"}], "initial_conditions": {}, "outputs": ["Q"], "simulation_controls": ["Cd", "A", "DeltaP", "rho"], "constraints": ["DeltaP>=0", "A>0", "rho>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S53 Orifice Flow Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"container\">\n    <header>\n        <h1>Hydraulic Orifice Flow</h1>\n        <p>Simulate flow rate through a sharp-edged orifice.</p>\n    </header>\n\n    <div class=\"simulation-layout\">\n        <aside class=\"controls\">\n            <div class=\"equation-display\">\n                $$Q = C_d \\cdot A \\sqrt{\\frac{2 \\Delta P}{\\rho}}$$\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"pressure_drop\">Pressure Drop ($\\Delta P$) [Pa]</label>\n                <input type=\"range\" id=\"pressure_drop\" min=\"10\" max=\"100000\" step=\"10\" value=\"50000\">\n                <div class=\"value-display\"><span id=\"val_pressure_drop\">50000</span> Pa</div>\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"area\">Orifice Area ($A$) [$m^2$]</label>\n                <input type=\"range\" id=\"area\" min=\"0.001\" max=\"0.1\" step=\"0.001\" value=\"0.01\">\n                <div class=\"value-display\"><span id=\"val_area\">0.01</span> m²</div>\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"discharge_coeff\">Discharge Coeff ($C_d$)</label>\n                <input type=\"range\" id=\"discharge_coeff\" min=\"0.5\" max=\"0.9\" step=\"0.01\" value=\"0.61\">\n                <div class=\"value-display\"><span id=\"val_discharge_coeff\">0.61</span></div>\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"density\">Fluid Density ($\\rho$) [$kg/m^3$]</label>\n                <input type=\"range\" id=\"density\" min=\"100\" max=\"1500\" step=\"10\" value=\"1000\">\n                <div class=\"value-display\"><span id=\"val_density\">1000</span> kg/m³</div>\n            </div>\n\n            <div class=\"result-box\">\n                <h3>Flow Rate ($Q$)</h3>\n                <p id=\"output_flow\">0.000 m³/s</p>\n            </div>\n        </aside>\n\n        <main class=\"visualizer\">\n            <canvas id=\"simCanvas\"></canvas>\n            <div class=\"legend\">\n                <span><span class=\"dot high-p\"></span> High Pressure</span>\n                <span><span class=\"dot low-p\"></span> Low Pressure</span>\n            </div>\n        </main>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary-color: #3498db;\n    --secondary-color: #2c3e50;\n    --accent-color: #e74c3c;\n    --bg-color: #f4f7f6;\n    --panel-bg: #ffffff;\n    --text-color: #333;\n}\n\n* {\n    box-sizing: border-box;\n    margin: 0;\n    padding: 0;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    display: flex;\n    justify-content: center;\n    padding: 20px;\n    height: 100vh;\n}\n\n.container {\n    width: 100%;\n    max-width: 1200px;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 10px;\n}\n\nheader h1 {\n    color: var(--secondary-color);\n}\n\n.simulation-layout {\n    display: grid;\n    grid-template-columns: 300px 1fr;\n    gap: 20px;\n    height: 100%;\n}\n\n/* Controls Styling */\n.controls {\n    background: var(--panel-bg);\n    padding: 20px;\n    border-radius: 8px;\n    box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n}\n\n.equation-display {\n    background: #eef2f5;\n    padding: 10px;\n    border-radius: 4px;\n    text-align: center;\n    font-size: 1.1em;\n    margin-bottom: 10px;\n}\n\n.input-group {\n    display: flex;\n    flex-direction: column;\n    gap: 5px;\n}\n\nlabel {\n    font-weight: 600;\n    font-size: 0.9em;\n    color: var(--secondary-color);\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    cursor: pointer;\n}\n\n.value-display {\n    font-size: 0.85em;\n    color: #666;\n    text-align: right;\n}\n\n.result-box {\n    margin-top: auto;\n    background: var(--secondary-color);\n    color: white;\n    padding: 15px;\n    border-radius: 6px;\n    text-align: center;\n}\n\n.result-box h3 {\n    font-size: 1em;\n    margin-bottom: 5px;\n    opacity: 0.9;\n}\n\n.result-box p {\n    font-size: 1.5em;\n    font-weight: bold;\n}\n\n/* Visualizer Styling */\n.visualizer {\n    background: var(--panel-bg);\n    border-radius: 8px;\n    box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n    position: relative;\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n}\n\ncanvas {\n    width: 100%;\n    height: 100%;\n    background: linear-gradient(to right, #f0f8ff, #e6f3ff);\n}\n\n.legend {\n    position: absolute;\n    bottom: 10px;\n    right: 10px;\n    background: rgba(255,255,255,0.8);\n    padding: 5px 10px;\n    border-radius: 4px;\n    font-size: 0.8em;\n    display: flex;\n    gap: 15px;\n}\n\n.dot {\n    display: inline-block;\n    width: 10px;\n    height: 10px;\n    border-radius: 50%;\n    margin-right: 5px;\n}\n.high-p { background-color: #e74c3c; }\n.low-p { background-color: #3498db; }\n\n/* Responsive */\n@media (max-width: 768px) {\n    .simulation-layout {\n        grid-template-columns: 1fr;\n        grid-template-rows: auto 400px;\n    }\n}", "js": "document.addEventListener('DOMContentLoaded', () => {\n    // --- Configuration ---\n    const canvas = document.getElementById('simCanvas');\n    const ctx = canvas.getContext('2d');\n    \n    // Inputs\n    const inputs = {\n        Cd: document.getElementById('discharge_coeff'),\n        A: document.getElementById('area'),\n        DeltaP: document.getElementById('pressure_drop'),\n        rho: document.getElementById('density')\n    };\n\n    // Value Displays\n    const displays = {\n        Cd: document.getElementById('val_discharge_coeff'),\n        A: document.getElementById('val_area'),\n        DeltaP: document.getElementById('val_pressure_drop'),\n        rho: document.getElementById('val_density'),\n        Q: document.getElementById('output_flow')\n    };\n\n    // State\n    let params = {\n        Cd: 0.61,\n        A: 0.01,\n        DeltaP: 50000,\n        rho: 1000\n    };\n\n    let computedQ = 0;\n    \n    // Particle System\n    const particles = [];\n    const numParticles = 150;\n\n    // --- Resize Handling ---\n    function resizeCanvas() {\n        canvas.width = canvas.offsetWidth;\n        canvas.height = canvas.offsetHeight;\n    }\n    window.addEventListener('resize', resizeCanvas);\n    resizeCanvas();\n\n    // --- Physics Calculation ---\n    function calculateFlow() {\n        // Parse inputs\n        params.Cd = parseFloat(inputs.Cd.value);\n        params.A = parseFloat(inputs.A.value);\n        params.DeltaP = parseFloat(inputs.DeltaP.value);\n        params.rho = parseFloat(inputs.rho.value);\n\n        // Update UI Text\n        displays.Cd.innerText = params.Cd.toFixed(2);\n        displays.A.innerText = params.A.toFixed(3);\n        displays.DeltaP.innerText = params.DeltaP.toFixed(0);\n        displays.rho.innerText = params.rho.toFixed(0);\n\n        // Calculate Q = Cd * A * sqrt(2 * DeltaP / rho)\n        const term = (2 * params.DeltaP) / params.rho;\n        if (term < 0) {\n            computedQ = 0;\n        } else {\n            computedQ = params.Cd * params.A * Math.sqrt(term);\n        }\n\n        displays.Q.innerText = computedQ.toFixed(4) + \" m³/s\";\n    }\n\n    // --- Animation System ---\n    class Particle {\n        constructor() {\n            this.reset();\n            // Scatter initial x randomly\n            this.x = Math.random() * canvas.width;\n        }\n\n        reset() {\n            this.x = 0;\n            // Random Y within pipe height (vertically centered)\n            // Pipe visual height is roughly 60% of canvas height\n            const pipeHeight = canvas.height * 0.6;\n            const topMargin = (canvas.height - pipeHeight) / 2;\n            this.y = topMargin + Math.random() * pipeHeight;\n            this.size = Math.random() * 3 + 2;\n            this.speedBase = Math.random() * 0.5 + 0.5;\n        }\n\n        update(orificeOpeningY, orificeX) {\n            // Determine velocity based on Calculated Q\n            // Scale Q for visual speed (arbitrary factor for visual appeal)\n            let velocityFactor = computedQ * 20; \n            \n            // Constrain visual speed to keep it viewable\n            if (velocityFactor < 0.5) velocityFactor = 0.5;\n            if (velocityFactor > 15) velocityFactor = 15;\n\n            // Physics Logic:\n            // Velocity increases as it passes through the orifice (Constriction)\n            // V1 = Q/A1 (Pipe), V2 = Q/A2 (Orifice)\n            // For visual simplicity, we speed up particles near the center (Orifice)\n            \n            let currentSpeed = this.speedBase * velocityFactor;\n\n            // Approaching Orifice Logic\n            // If particle is near the orifice X and outside the opening Y, block it or funnel it\n            const pipeCenterY = canvas.height / 2;\n            const halfOpening = orificeOpeningY / 2;\n            \n            const distToOrifice = orificeX - this.x;\n\n            if (Math.abs(distToOrifice) < 50) {\n                // Acceleration zone near orifice (Vena Contracta effect)\n                currentSpeed *= 2.5;\n\n                // Simple funneling effect visually\n                if (this.y < pipeCenterY - halfOpening) this.y += 2;\n                if (this.y > pipeCenterY + halfOpening) this.y -= 2;\n            }\n\n            this.x += currentSpeed;\n\n            if (this.x > canvas.width) {\n                this.reset();\n            }\n        }\n\n        draw(ctx, pressureColor) {\n            ctx.fillStyle = pressureColor;\n            ctx.beginPath();\n            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);\n            ctx.fill();\n        }\n    }\n\n    // Initialize Particles\n    for (let i = 0; i < numParticles; i++) {\n        particles.push(new Particle());\n    }\n\n    function drawPipe(orificeOpeningHeight, orificeX) {\n        const pipeHeight = canvas.height * 0.6;\n        const topY = (canvas.height - pipeHeight) / 2;\n        const bottomY = topY + pipeHeight;\n        \n        ctx.fillStyle = \"#bbb\"; // Pipe wall color\n        ctx.strokeStyle = \"#555\";\n        ctx.lineWidth = 3;\n\n        // Top Wall\n        ctx.fillRect(0, topY - 10, canvas.width, 10);\n        // Bottom Wall\n        ctx.fillRect(0, bottomY, canvas.width, 10);\n\n        // Orifice Plate (Top)\n        const plateWidth = 20;\n        const pipeCenterY = canvas.height / 2;\n        const plateHeight = (pipeHeight - orificeOpeningHeight) / 2;\n\n        ctx.fillStyle = \"#333\";\n        // Top Plate\n        ctx.fillRect(orificeX - plateWidth/2, topY, plateWidth, plateHeight);\n        // Bottom Plate\n        ctx.fillRect(orificeX - plateWidth/2, bottomY - plateHeight, plateWidth, plateHeight);\n    }\n\n    function animate() {\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n        // 1. Calculate Visual Parameters\n        // Map Area A (0.001 - 0.1) to visual pixel height (10px to PipeHeight)\n        const pipeHeight = canvas.height * 0.6;\n        const maxA = 0.1; \n        const minA = 0.001;\n        \n        // Normalize A\n        let normalizedA = (params.A - minA) / (maxA - minA);\n        // Clamp for visual sanity\n        if(normalizedA < 0.1) normalizedA = 0.1;\n        \n        const orificeOpeningHeight = normalizedA * pipeHeight;\n        const orificeX = canvas.width / 2;\n\n        // 2. Draw Background/Pipe\n        drawPipe(orificeOpeningHeight, orificeX);\n\n        // 3. Draw Fluid (Particles)\n        // Color interpolation based on Pressure\n        // High Pressure (Left) = Red, Low Pressure (Right) = Blue\n        // Note: DeltaP is Drop. P1 = High, P2 = P1 - DeltaP.\n        // Visually we just map High DeltaP to a \"Redder\" input side.\n        \n        const highPressureColor = `rgba(231, 76, 60, 0.7)`; // Red\n        const lowPressureColor = `rgba(52, 152, 219, 0.7)`; // Blue\n\n        particles.forEach(p => {\n            p.update(orificeOpeningHeight, orificeX);\n            \n            // Color logic: Before Orifice = High Pressure, After = Low Pressure\n            let color = (p.x < orificeX) ? highPressureColor : lowPressureColor;\n            p.draw(ctx, color);\n        });\n\n        requestAnimationFrame(animate);\n    }\n\n    // --- Event Listeners ---\n    Object.values(inputs).forEach(input => {\n        input.addEventListener('input', calculateFlow);\n    });\n\n    // Start\n    calculateFlow();\n    animate();\n});"}}
{"input": {"input_text": "Pipe flow Darcy-Weisbach: hf = f*(L/D)*(v^2/(2g)). Compute head loss for given flow velocity and friction factor.", "simulation_name": " Darcy Weisbach", "domain": "Fluid Mechanics", "description": "Head loss in pipe", "assumptions": ["Steady incompressible"], "entities": [], "constants": [{"name": "gravity", "symbol": "g", "value": 9.81, "unit": "m/s^2"}], "parameters": [{"name": "friction_factor", "symbol": "f", "unit": "dimensionless", "range": [0.005, 0.1]}, {"name": "length", "symbol": "L", "unit": "m", "range": [0.1, 10000]}, {"name": "diameter", "symbol": "D", "unit": "m", "range": [0.005, 2]}, {"name": "velocity", "symbol": "v", "unit": "m/s", "range": [0.01, 10]}], "equations": [{"description": "Head loss", "expression": "hf = f*(L/D)*(v^2/(2*g))"}], "initial_conditions": {}, "outputs": ["hf"], "simulation_controls": ["f", "L", "D", "v"], "constraints": ["f>0", "L>0", "D>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S54 Darcy-Weisbach Pipe Flow</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"container\">\n    <header>\n        <h1>Darcy-Weisbach Pipe Flow</h1>\n        <p>Interactive Head Loss & Friction Simulation</p>\n    </header>\n\n    <div class=\"simulation-layout\">\n        <aside class=\"controls\">\n            <div class=\"equation-box\">\n                $$h_f = f \\cdot \\frac{L}{D} \\cdot \\frac{v^2}{2g}$$\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"f-slider\">\n                    Friction Factor ($f$)\n                    <span class=\"tooltip\">Controls wall roughness & turbulence</span>\n                </label>\n                <div class=\"control-row\">\n                    <input type=\"range\" id=\"f-slider\" min=\"0.005\" max=\"0.1\" step=\"0.001\" value=\"0.02\">\n                    <span class=\"value-display\" id=\"f-val\">0.020</span>\n                </div>\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"L-slider\">Pipe Length ($L$) <span class=\"unit\">m</span></label>\n                <div class=\"control-row\">\n                    <input type=\"range\" id=\"L-slider\" min=\"0.1\" max=\"1000\" step=\"1\" value=\"100\">\n                    <span class=\"value-display\" id=\"L-val\">100</span>\n                </div>\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"D-slider\">Pipe Diameter ($D$) <span class=\"unit\">m</span></label>\n                <div class=\"control-row\">\n                    <input type=\"range\" id=\"D-slider\" min=\"0.01\" max=\"2\" step=\"0.01\" value=\"0.5\">\n                    <span class=\"value-display\" id=\"D-val\">0.50</span>\n                </div>\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"v-slider\">Flow Velocity ($v$) <span class=\"unit\">m/s</span></label>\n                <div class=\"control-row\">\n                    <input type=\"range\" id=\"v-slider\" min=\"0.01\" max=\"10\" step=\"0.01\" value=\"2.5\">\n                    <span class=\"value-display\" id=\"v-val\">2.50</span>\n                </div>\n            </div>\n\n            <div class=\"result-box\">\n                <h3>Head Loss ($h_f$)</h3>\n                <div class=\"hf-display\">\n                    <span id=\"hf-result\">0.00</span> <span class=\"unit\">m</span>\n                </div>\n            </div>\n        </aside>\n\n        <main class=\"visualization\">\n            <div class=\"canvas-wrapper\">\n                <canvas id=\"flowCanvas\"></canvas>\n                <div class=\"overlay-info\">\n                    <span>Flow Direction &rarr;</span>\n                </div>\n            </div>\n            <div class=\"legend\">\n                <div class=\"legend-item\"><span class=\"dot water\"></span> Water</div>\n                <div class=\"legend-item\"><span class=\"dot wall\"></span> Wall Roughness</div>\n                <div class=\"legend-item\"><span class=\"dot turb\"></span> Turbulence</div>\n            </div>\n            <div class=\"description\">\n                <p><strong>Visual Guide:</strong> Increasing <em>Friction ($f$)</em> makes walls jagged and flow chaotic. Increasing <em>Velocity ($v$)</em> speeds up particles. Note how drag slows particles near the walls.</p>\n            </div>\n        </main>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary-color: #3498db;\n    --dark-blue: #2980b9;\n    --bg-color: #f0f4f8;\n    --panel-bg: #ffffff;\n    --text-color: #2c3e50;\n    --border-radius: 8px;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n    min-height: 100vh;\n}\n\n.container {\n    width: 100%;\n    max-width: 1100px;\n    background-color: var(--panel-bg);\n    padding: 30px;\n    border-radius: var(--border-radius);\n    box-shadow: 0 5px 15px rgba(0,0,0,0.1);\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 30px;\n    border-bottom: 2px solid #eef2f5;\n    padding-bottom: 15px;\n}\n\nh1 { margin: 0; color: var(--dark-blue); font-size: 1.8rem;}\np { margin: 5px 0 0; color: #7f8c8d; }\n\n.simulation-layout {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 30px;\n}\n\n/* Controls */\n.controls {\n    flex: 1;\n    min-width: 300px;\n    background: #fafafa;\n    padding: 20px;\n    border-radius: var(--border-radius);\n    border: 1px solid #e1e8ed;\n}\n\n.equation-box {\n    background: #fff;\n    padding: 15px;\n    border-radius: var(--border-radius);\n    text-align: center;\n    margin-bottom: 25px;\n    font-size: 1.2rem;\n    box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);\n}\n\n.input-group { margin-bottom: 20px; }\n.input-group label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.95rem; }\n.tooltip { font-size: 0.75rem; color: #7f8c8d; font-weight: normal; margin-left: 5px; }\n\n.control-row { display: flex; align-items: center; gap: 15px; }\n\ninput[type=range] {\n    flex-grow: 1;\n    cursor: pointer;\n    height: 6px;\n    background: #d3d3d3;\n    border-radius: 5px;\n    outline: none;\n    accent-color: var(--primary-color);\n}\n\n.value-display {\n    width: 60px;\n    text-align: right;\n    font-weight: bold;\n    color: var(--primary-color);\n    font-family: monospace;\n}\n\n.result-box {\n    margin-top: 30px;\n    padding: 20px;\n    background-color: var(--dark-blue);\n    color: white;\n    text-align: center;\n    border-radius: var(--border-radius);\n}\n\n.result-box h3 { margin: 0 0 10px 0; font-size: 1rem; opacity: 0.9; }\n.hf-display { font-size: 2rem; font-weight: bold; }\n.unit { font-size: 0.9rem; font-weight: normal; color: #cbd5e0; }\n\n/* Visualization */\n.visualization {\n    flex: 2;\n    min-width: 350px;\n    display: flex;\n    flex-direction: column;\n}\n\n.canvas-wrapper {\n    position: relative;\n    width: 100%;\n    height: 400px;\n    background: #222; /* Very dark background for contrast */\n    border-radius: var(--border-radius);\n    overflow: hidden;\n    border: 1px solid #34495e;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    box-shadow: inset 0 0 20px rgba(0,0,0,0.5);\n}\n\ncanvas { width: 100%; height: 100%; display: block; }\n\n.overlay-info {\n    position: absolute;\n    top: 10px;\n    left: 10px;\n    color: rgba(255,255,255,0.7);\n    font-weight: bold;\n    background: rgba(0,0,0,0.5);\n    padding: 5px 10px;\n    border-radius: 4px;\n    font-size: 0.8rem;\n    pointer-events: none;\n}\n\n.legend {\n    display: flex;\n    justify-content: center;\n    gap: 20px;\n    margin-top: 15px;\n    font-size: 0.9rem;\n}\n\n.legend-item { display: flex; align-items: center; gap: 5px; }\n.dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; }\n.dot.water { background-color: #00BFFF; box-shadow: 0 0 5px #00BFFF; }\n.dot.wall { background-color: #555; border-radius: 2px; border: 1px solid #777;}\n.dot.turb { border: 1px dashed #00BFFF; background: transparent; }\n\n.description {\n    margin-top: 20px;\n    font-size: 0.9rem;\n    color: #666;\n    background: #eef;\n    padding: 10px;\n    border-radius: 6px;\n    border-left: 4px solid var(--primary-color);\n}", "js": "document.addEventListener('DOMContentLoaded', () => {\n    // --- Inputs & Elements ---\n    const sliders = {\n        f: document.getElementById('f-slider'),\n        L: document.getElementById('L-slider'),\n        D: document.getElementById('D-slider'),\n        v: document.getElementById('v-slider')\n    };\n\n    const displays = {\n        f: document.getElementById('f-val'),\n        L: document.getElementById('L-val'),\n        D: document.getElementById('D-val'),\n        v: document.getElementById('v-val'),\n        hf: document.getElementById('hf-result')\n    };\n\n    const canvas = document.getElementById('flowCanvas');\n    const ctx = canvas.getContext('2d');\n\n    const g = 9.81;\n    const numParticles = 300; // Increased particle count for better fluid look\n\n    // --- State ---\n    let params = {\n        f: parseFloat(sliders.f.value),\n        L: parseFloat(sliders.L.value),\n        D: parseFloat(sliders.D.value),\n        v: parseFloat(sliders.v.value)\n    };\n\n    let particles = [];\n    let pipeYTop = 0;\n    let pipeYBot = 0;\n\n    // --- Physics Calculation ---\n    function calculateHeadLoss() {\n        // Darcy-Weisbach Equation\n        const hf = params.f * (params.L / params.D) * (Math.pow(params.v, 2) / (2 * g));\n        return hf;\n    }\n\n    function updateValues() {\n        // Update State\n        params.f = parseFloat(sliders.f.value);\n        params.L = parseFloat(sliders.L.value);\n        params.D = parseFloat(sliders.D.value);\n        params.v = parseFloat(sliders.v.value);\n\n        // Update UI\n        displays.f.textContent = params.f.toFixed(3);\n        displays.L.textContent = params.L.toFixed(0);\n        displays.D.textContent = params.D.toFixed(2);\n        displays.v.textContent = params.v.toFixed(2);\n\n        const hf = calculateHeadLoss();\n        displays.hf.textContent = hf.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });\n    }\n\n    // --- Animation Logic ---\n\n    class Particle {\n        constructor() {\n            this.reset();\n        }\n\n        reset() {\n            this.x = Math.random() * canvas.width;\n            \n            // Spawn strictly inside the pipe area\n            const height = pipeYBot - pipeYTop;\n            // Add slight padding so they don't spawn *inside* the wall\n            const padding = height * 0.05; \n            this.y = pipeYTop + padding + Math.random() * (height - padding * 2);\n            \n            this.size = Math.random() * 2 + 1;\n            this.color = `rgba(0, 191, 255, ${Math.random() * 0.5 + 0.3})`;\n            this.vx = 0;\n            this.vy = 0;\n        }\n\n        update() {\n            // 1. Calculate Pipe Geometry\n            const centerY = (pipeYTop + pipeYBot) / 2;\n            const radius = (pipeYBot - pipeYTop) / 2;\n            const distFromCenter = Math.abs(this.y - centerY);\n            \n            // 2. Velocity Profile (Parabolic Flow)\n            // v = v_max * (1 - r^2/R^2)\n            // Center moves fast, edges move slow\n            const relativeR = distFromCenter / radius;\n            const profileFactor = 1 - Math.pow(relativeR, 2); // 1 at center, 0 at wall\n            \n            // Map real velocity to visual pixels per frame\n            // Base speed + scaled speed\n            const visualBaseSpeed = params.v * 2; \n            // Avoid particles stopping completely at wall (keep 10% min speed)\n            this.vx = visualBaseSpeed * (0.1 + 0.9 * profileFactor);\n\n            // 3. Friction & Turbulence Effects\n            // Friction Factor f determines how chaotic the flow is\n            // Map f (0.005 - 0.1) to turbulence intensity\n            const turbulenceFactor = (params.f - 0.005) * 50; // Scaling factor\n            \n            // Random jitter perpendicular to flow\n            // Jitter increases near walls (drag) and with higher f\n            const wallProximity = relativeR; // 0 at center, 1 at wall\n            const jitterX = (Math.random() - 0.5) * turbulenceFactor * params.v * wallProximity; \n            const jitterY = (Math.random() - 0.5) * turbulenceFactor * params.v;\n\n            this.x += this.vx + jitterX;\n            this.y += jitterY;\n\n            // 4. Wall Collision\n            if (this.y <= pipeYTop + 2 || this.y >= pipeYBot - 2) {\n                // \"Bounce\" or reset to laminar flow if they hit rough wall\n                this.y = Math.max(pipeYTop + 5, Math.min(pipeYBot - 5, this.y));\n                // Hitting a rough wall slows you down more\n                this.x -= 1; \n            }\n\n            // Loop\n            if (this.x > canvas.width) {\n                this.x = -10;\n                // Re-randomize Y slightly on wrap\n                const height = pipeYBot - pipeYTop;\n                this.y = pipeYTop + (height * 0.1) + Math.random() * (height * 0.8);\n            }\n        }\n\n        draw(ctx) {\n            ctx.fillStyle = this.color;\n            ctx.beginPath();\n            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);\n            ctx.fill();\n        }\n    }\n\n    function calculatePipeDimensions() {\n        // Scale Diameter D (0.01 - 2) to Screen Pixels (20px - 90% height)\n        const maxH = canvas.height * 0.8;\n        const minH = 30;\n        const ratio = params.D / 2; \n        const pipeH = minH + ratio * (maxH - minH);\n        \n        pipeYTop = (canvas.height - pipeH) / 2;\n        pipeYBot = pipeYTop + pipeH;\n    }\n\n    function drawWalls() {\n        // Draw Main Pipe Body (dark void)\n        ctx.fillStyle = \"#1a1a1a\";\n        ctx.fillRect(0, pipeYTop, canvas.width, pipeYBot - pipeYTop);\n\n        // Draw Walls with Roughness\n        ctx.fillStyle = \"#555\"; // Wall color\n        \n        // Roughness Amplitude based on f\n        const roughnessAmp = (params.f / 0.1) * 10; \n\n        // Top Wall\n        ctx.beginPath();\n        ctx.moveTo(0, 0);\n        ctx.lineTo(0, pipeYTop);\n        for(let x = 0; x <= canvas.width; x+=5) {\n            // Jagged line generator\n            const noise = (Math.random() - 0.5) * roughnessAmp;\n            ctx.lineTo(x, pipeYTop + noise);\n        }\n        ctx.lineTo(canvas.width, 0);\n        ctx.fill();\n\n        // Bottom Wall\n        ctx.beginPath();\n        ctx.moveTo(0, canvas.height);\n        ctx.lineTo(0, pipeYBot);\n        for(let x = 0; x <= canvas.width; x+=5) {\n            const noise = (Math.random() - 0.5) * roughnessAmp;\n            ctx.lineTo(x, pipeYBot + noise);\n        }\n        ctx.lineTo(canvas.width, canvas.height);\n        ctx.fill();\n    }\n\n    function resizeCanvas() {\n        canvas.width = canvas.parentElement.clientWidth;\n        canvas.height = canvas.parentElement.clientHeight;\n        calculatePipeDimensions();\n    }\n\n    function initParticles() {\n        resizeCanvas();\n        particles = [];\n        for(let i=0; i<numParticles; i++) {\n            particles.push(new Particle());\n        }\n    }\n\n    function animate() {\n        // Redraw Background\n        ctx.fillStyle = \"#222\"; \n        ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n        calculatePipeDimensions();\n        \n        // Draw Walls (Static layer, but roughness jitters if we redraw every frame? \n        // No, let's keep randomness in the loop for \"visual noise\" effect of flowing water against rough surface)\n        drawWalls();\n\n        // Draw Particles\n        particles.forEach(p => {\n            p.update();\n            p.draw(ctx);\n        });\n\n        // Overlay Arrow\n        drawVelocityVector();\n\n        requestAnimationFrame(animate);\n    }\n\n    function drawVelocityVector() {\n        // Draw a simple vector arrow in center to show V magnitude\n        const len = params.v * 20; \n        const centerY = canvas.height / 2;\n        const centerX = canvas.width / 2;\n        \n        ctx.strokeStyle = \"rgba(255, 255, 255, 0.2)\";\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.moveTo(centerX - len/2, centerY);\n        ctx.lineTo(centerX + len/2, centerY);\n        // Arrowhead\n        ctx.lineTo(centerX + len/2 - 10, centerY - 5);\n        ctx.moveTo(centerX + len/2, centerY);\n        ctx.lineTo(centerX + len/2 - 10, centerY + 5);\n        ctx.stroke();\n    }\n\n    // --- Events ---\n    Object.values(sliders).forEach(s => s.addEventListener('input', updateValues));\n    window.addEventListener('resize', () => {\n        resizeCanvas();\n        particles.forEach(p => p.reset());\n    });\n\n    // --- Start ---\n    initParticles();\n    updateValues();\n    animate();\n});"}}
{"input": {"input_text": "Pump affinity laws: head ~ (rpm/ rpm_ref)^2, flow ~ rpm/rpm_ref, power ~ (rpm/rpm_ref)^3. Provide scaling relations.", "simulation_name": " Pump Affinity", "domain": "Fluid Mechanics", "description": "Centrifugal pump scaling", "assumptions": ["Similar pumps"], "entities": [], "constants": [], "parameters": [{"name": "speed", "symbol": "N", "unit": "rpm", "range": [100, 6000]}, {"name": "reference_speed", "symbol": "Nref", "unit": "rpm", "range": [100, 6000]}, {"name": "reference_head", "symbol": "Href", "unit": "m", "range": [0.5, 200]}, {"name": "reference_flow", "symbol": "Qref", "unit": "m^3/s", "range": [0.0001, 10]}, {"name": "reference_power", "symbol": "Pref", "unit": "W", "range": [10, 10000000.0]}], "equations": [{"description": "Head", "expression": "H = Href*(N/Nref)^2"}, {"description": "Flow", "expression": "Q = Qref*(N/Nref)"}, {"description": "Power", "expression": "P = Pref*(N/Nref)^3"}], "initial_conditions": {}, "outputs": ["H", "Q", "P"], "simulation_controls": ["N", "Nref", "Href", "Qref", "Pref"], "constraints": ["Nref>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S55 Pump Affinity Laws Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"container\">\n    <header>\n        <h1>Pump Affinity Laws</h1>\n        <p>Explore how Pump Speed (RPM) scales Flow, Head, and Power.</p>\n    </header>\n\n    <div class=\"simulation-grid\">\n        <aside class=\"controls\">\n            <div class=\"equations-box\">\n                <div class=\"eq-item\">$$ \\frac{Q}{Q_{ref}} = \\frac{N}{N_{ref}} $$</div>\n                <div class=\"eq-item\">$$ \\frac{H}{H_{ref}} = \\left(\\frac{N}{N_{ref}}\\right)^2 $$</div>\n                <div class=\"eq-item\">$$ \\frac{P}{P_{ref}} = \\left(\\frac{N}{N_{ref}}\\right)^3 $$</div>\n            </div>\n\n            <div class=\"control-group\">\n                <h3>Operating Speed</h3>\n                <label>Speed ($N$) [RPM]</label>\n                <input type=\"range\" id=\"speed\" min=\"100\" max=\"6000\" step=\"50\" value=\"3000\">\n                <div class=\"val-display\"><span id=\"val_speed\">3000</span> RPM</div>\n            </div>\n\n            <hr>\n\n            <div class=\"control-group\">\n                <h3>Reference Conditions</h3>\n                \n                <label>Ref. Speed ($N_{ref}$)</label>\n                <input type=\"range\" id=\"ref_speed\" min=\"100\" max=\"6000\" step=\"50\" value=\"1500\">\n                <div class=\"val-display\"><span id=\"val_ref_speed\">1500</span> RPM</div>\n\n                <label>Ref. Flow ($Q_{ref}$) [m³/s]</label>\n                <input type=\"range\" id=\"ref_flow\" min=\"0.001\" max=\"10\" step=\"0.1\" value=\"1.5\">\n                <div class=\"val-display\"><span id=\"val_ref_flow\">1.5</span> m³/s</div>\n\n                <label>Ref. Head ($H_{ref}$) [m]</label>\n                <input type=\"range\" id=\"ref_head\" min=\"0.5\" max=\"200\" step=\"1\" value=\"50\">\n                <div class=\"val-display\"><span id=\"val_ref_head\">50</span> m</div>\n\n                <label>Ref. Power ($P_{ref}$) [W]</label>\n                <input type=\"range\" id=\"ref_power\" min=\"100\" max=\"100000\" step=\"100\" value=\"5000\">\n                <div class=\"val-display\"><span id=\"val_ref_power\">5000</span> W</div>\n            </div>\n        </aside>\n\n        <main class=\"visualizer\">\n            <div class=\"results-bar\">\n                <div class=\"card flow-card\">\n                    <h4>Flow ($Q$)</h4>\n                    <span id=\"out_Q\" class=\"big-num\">0</span> <span class=\"unit\">m³/s</span>\n                </div>\n                <div class=\"card head-card\">\n                    <h4>Head ($H$)</h4>\n                    <span id=\"out_H\" class=\"big-num\">0</span> <span class=\"unit\">m</span>\n                </div>\n                <div class=\"card power-card\">\n                    <h4>Power ($P$)</h4>\n                    <span id=\"out_P\" class=\"big-num\">0</span> <span class=\"unit\">kW</span>\n                </div>\n            </div>\n\n            <div class=\"canvas-container\">\n                <canvas id=\"pumpCanvas\"></canvas>\n                <div class=\"overlay-legend\">\n                    <p><strong>Visualizing Scaling Ratios:</strong></p>\n                    <p><span class=\"dot c-flow\"></span> Flow $\\propto N$ (Linear)</p>\n                    <p><span class=\"dot c-head\"></span> Head $\\propto N^2$ (Quadratic)</p>\n                    <p><span class=\"dot c-power\"></span> Power $\\propto N^3$ (Cubic)</p>\n                </div>\n            </div>\n        </main>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-dark: #1e272e;\n    --panel-bg: #2d3436;\n    --text-main: #ecf0f1;\n    --accent-flow: #00cec9;  /* Cyan for Flow */\n    --accent-head: #fdcb6e;  /* Orange for Head */\n    --accent-power: #ff7675; /* Red for Power */\n    --input-bg: #636e72;\n}\n\n* {\n    box-sizing: border-box;\n    margin: 0;\n    padding: 0;\n}\n\nbody {\n    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-dark);\n    color: var(--text-main);\n    height: 100vh;\n    display: flex;\n    justify-content: center;\n    overflow: hidden; /* Prevent body scroll, handle inside container */\n}\n\n.container {\n    width: 100%;\n    max-width: 1400px;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    padding: 20px;\n}\n\nheader {\n    margin-bottom: 20px;\n    border-bottom: 1px solid #444;\n    padding-bottom: 10px;\n}\n\nheader h1 { font-weight: 300; letter-spacing: 1px; }\nheader p { color: #b2bec3; font-size: 0.9rem; }\n\n/* Grid Layout */\n.simulation-grid {\n    display: grid;\n    grid-template-columns: 320px 1fr;\n    gap: 20px;\n    flex: 1;\n    min-height: 0; /* Important for scroll */\n}\n\n/* Controls Aside */\n.controls {\n    background-color: var(--panel-bg);\n    padding: 20px;\n    border-radius: 8px;\n    overflow-y: auto;\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n    box-shadow: 0 4px 10px rgba(0,0,0,0.3);\n}\n\n.equations-box {\n    background: rgba(0,0,0,0.2);\n    padding: 10px;\n    border-radius: 6px;\n    margin-bottom: 10px;\n    font-size: 0.9rem;\n    text-align: center;\n}\n\n.control-group label {\n    display: block;\n    font-size: 0.85rem;\n    margin-top: 10px;\n    color: #dfe6e9;\n}\n\n.control-group h3 {\n    color: #74b9ff;\n    border-bottom: 1px solid #555;\n    padding-bottom: 5px;\n    margin-bottom: 10px;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    margin: 8px 0;\n    cursor: pointer;\n    accent-color: #0984e3;\n}\n\n.val-display {\n    font-size: 0.9rem;\n    color: #81ecec;\n    text-align: right;\n    font-family: monospace;\n}\n\nhr { border: 0; border-top: 1px solid #555; margin: 10px 0; }\n\n/* Visualizer Main */\n.visualizer {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n    height: 100%;\n}\n\n/* Result Cards */\n.results-bar {\n    display: grid;\n    grid-template-columns: 1fr 1fr 1fr;\n    gap: 15px;\n}\n\n.card {\n    background: var(--panel-bg);\n    padding: 15px;\n    border-radius: 8px;\n    text-align: center;\n    border-top: 4px solid #fff;\n    box-shadow: 0 4px 6px rgba(0,0,0,0.2);\n}\n\n.flow-card { border-color: var(--accent-flow); }\n.head-card { border-color: var(--accent-head); }\n.power-card { border-color: var(--accent-power); }\n\n.card h4 { font-size: 0.9rem; opacity: 0.8; margin-bottom: 5px; }\n.big-num { font-size: 1.8rem; font-weight: bold; }\n.unit { font-size: 0.9rem; opacity: 0.7; }\n\n/* Canvas Area */\n.canvas-container {\n    flex: 1;\n    background: #222;\n    border-radius: 8px;\n    position: relative;\n    border: 1px solid #444;\n}\n\ncanvas {\n    width: 100%;\n    height: 100%;\n    display: block;\n}\n\n.overlay-legend {\n    position: absolute;\n    bottom: 15px;\n    right: 15px;\n    background: rgba(0,0,0,0.7);\n    padding: 10px;\n    border-radius: 4px;\n    font-size: 0.8rem;\n    pointer-events: none;\n}\n\n.dot {\n    display: inline-block;\n    width: 10px;\n    height: 10px;\n    border-radius: 50%;\n    margin-right: 5px;\n}\n.c-flow { background: var(--accent-flow); }\n.c-head { background: var(--accent-head); }\n.c-power { background: var(--accent-power); }\n\n/* Responsive */\n@media (max-width: 900px) {\n    .simulation-grid { grid-template-columns: 1fr; grid-template-rows: auto 1fr; }\n    .results-bar { grid-template-columns: 1fr 1fr; }\n    .power-card { grid-column: span 2; }\n}", "js": "document.addEventListener('DOMContentLoaded', () => {\n    // --- Elements ---\n    const canvas = document.getElementById('pumpCanvas');\n    const ctx = canvas.getContext('2d');\n\n    const inputs = {\n        N: document.getElementById('speed'),\n        Nref: document.getElementById('ref_speed'),\n        Qref: document.getElementById('ref_flow'),\n        Href: document.getElementById('ref_head'),\n        Pref: document.getElementById('ref_power')\n    };\n\n    const displays = {\n        N: document.getElementById('val_speed'),\n        Nref: document.getElementById('val_ref_speed'),\n        Qref: document.getElementById('val_ref_flow'),\n        Href: document.getElementById('val_ref_head'),\n        Pref: document.getElementById('val_ref_power'),\n        outQ: document.getElementById('out_Q'),\n        outH: document.getElementById('out_H'),\n        outP: document.getElementById('out_P')\n    };\n\n    // --- State ---\n    let params = {\n        N: 3000,\n        Nref: 1500,\n        Qref: 1.5,\n        Href: 50,\n        Pref: 5000\n    };\n\n    let rotationAngle = 0;\n    \n    // --- Resize Canvas ---\n    function resizeCanvas() {\n        canvas.width = canvas.parentElement.offsetWidth;\n        canvas.height = canvas.parentElement.offsetHeight;\n    }\n    window.addEventListener('resize', resizeCanvas);\n    resizeCanvas();\n\n    // --- Calculation Logic ---\n    function calculate() {\n        // 1. Read Inputs\n        params.N = parseFloat(inputs.N.value);\n        params.Nref = parseFloat(inputs.Nref.value);\n        params.Qref = parseFloat(inputs.Qref.value);\n        params.Href = parseFloat(inputs.Href.value);\n        params.Pref = parseFloat(inputs.Pref.value);\n\n        // 2. Update Displays\n        displays.N.textContent = params.N;\n        displays.Nref.textContent = params.Nref;\n        displays.Qref.textContent = params.Qref.toFixed(2);\n        displays.Href.textContent = params.Href.toFixed(1);\n        displays.Pref.textContent = params.Pref.toFixed(0);\n\n        // 3. Apply Affinity Laws\n        // Ratio\n        const ratio = params.N / params.Nref;\n\n        // Flow ~ N (Linear)\n        const Q = params.Qref * ratio;\n        \n        // Head ~ N^2 (Quadratic)\n        const H = params.Href * Math.pow(ratio, 2);\n        \n        // Power ~ N^3 (Cubic)\n        const P = params.Pref * Math.pow(ratio, 3);\n\n        // 4. Update Outputs\n        displays.outQ.textContent = Q.toFixed(3);\n        displays.outH.textContent = H.toFixed(2);\n        \n        // Format Power (W to kW if > 1000)\n        if (P >= 1000) {\n            displays.outP.textContent = (P / 1000).toFixed(2);\n            displays.outP.nextElementSibling.textContent = \"kW\";\n        } else {\n            displays.outP.textContent = P.toFixed(1);\n            displays.outP.nextElementSibling.textContent = \"W\";\n        }\n\n        return { ratio, Q, H, P };\n    }\n\n    // --- Visualization Functions ---\n    \n    function drawImpeller(ctx, x, y, size, angle, speedRatio) {\n        ctx.save();\n        ctx.translate(x, y);\n        ctx.rotate(angle);\n\n        ctx.strokeStyle = '#dfe6e9';\n        ctx.lineWidth = 4;\n        ctx.lineCap = 'round';\n\n        // Draw hub\n        ctx.fillStyle = '#636e72';\n        ctx.beginPath();\n        ctx.arc(0, 0, size * 0.2, 0, Math.PI * 2);\n        ctx.fill();\n\n        // Draw blades\n        const numBlades = 6;\n        for (let i = 0; i < numBlades; i++) {\n            ctx.save();\n            ctx.rotate((Math.PI * 2 / numBlades) * i);\n            \n            ctx.beginPath();\n            ctx.moveTo(size * 0.2, 0);\n            // Curve the blade\n            ctx.quadraticCurveTo(size * 0.5, size * 0.2, size, size * 0.1);\n            ctx.stroke();\n            ctx.restore();\n        }\n\n        ctx.restore();\n\n        // Draw Casing Hint (Static circle)\n        ctx.strokeStyle = '#2d3436';\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.arc(x, y, size + 10, 0, Math.PI * 2);\n        ctx.stroke();\n        \n        // Label\n        ctx.fillStyle = '#fff';\n        ctx.font = '14px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.fillText(`RPM: ${params.N}`, x, y + size + 30);\n    }\n\n    function drawBarChart(ctx, x, y, width, height, ratio) {\n        // This chart visualizes the GROWTH factors\n        // Base = Reference (1.0 scale)\n        // Bars show the multipliers: ratio, ratio^2, ratio^3\n\n        const barWidth = width / 4;\n        const spacing = width / 8;\n        const floorY = y + height;\n        \n        // Max Scale calculation for y-axis\n        // If ratio is 2 (double speed), power is 8x. We need dynamic scaling.\n        // Let's cap visual max at ratio=2.5 -> Power=15.6x roughly, \n        // but for usability, we scale based on current max value.\n        \n        const r1 = ratio;\n        const r2 = ratio * ratio;\n        const r3 = ratio * ratio * ratio;\n        \n        let maxVal = Math.max(1.5, r1, r2, r3); // Ensure at least 1.5x space\n        \n        const scaleY = (val) => {\n            return (val / maxVal) * (height - 30); // Leave room for labels\n        };\n\n        // Draw Axis\n        ctx.strokeStyle = '#aaa';\n        ctx.lineWidth = 1;\n        ctx.beginPath();\n        ctx.moveTo(x, floorY);\n        ctx.lineTo(x + width, floorY); // X axis\n        ctx.stroke();\n\n        // Reference Line (Ratio = 1.0)\n        const refY = floorY - scaleY(1.0);\n        ctx.strokeStyle = '#555';\n        ctx.setLineDash([5, 5]);\n        ctx.beginPath();\n        ctx.moveTo(x, refY);\n        ctx.lineTo(x + width, refY);\n        ctx.stroke();\n        ctx.setLineDash([]);\n        \n        ctx.fillStyle = '#aaa';\n        ctx.font = '10px sans-serif';\n        ctx.fillText('Ref (1.0x)', x + width + 5, refY + 3);\n\n        // Helper to draw bar\n        const drawBar = (index, val, color, label) => {\n            const bx = x + spacing + index * (barWidth + spacing);\n            const bh = scaleY(val);\n            const by = floorY - bh;\n\n            ctx.fillStyle = color;\n            ctx.fillRect(bx, by, barWidth, bh);\n            \n            // Text Value\n            ctx.fillStyle = '#fff';\n            ctx.textAlign = 'center';\n            ctx.font = 'bold 12px sans-serif';\n            ctx.fillText(val.toFixed(2) + 'x', bx + barWidth/2, by - 5);\n            \n            // Label\n            ctx.fillStyle = '#ccc';\n            ctx.font = '11px sans-serif';\n            ctx.fillText(label, bx + barWidth/2, floorY + 15);\n        };\n\n        drawBar(0, r1, '#00cec9', 'Flow');\n        drawBar(1, r2, '#fdcb6e', 'Head');\n        drawBar(2, r3, '#ff7675', 'Power');\n    }\n\n    // --- Animation Loop ---\n    function animate() {\n        const { ratio } = calculate();\n        \n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n        // Layout: Pump on Left, Chart on Right (if wide enough)\n        // Or Pump Top, Chart Bottom\n        \n        const w = canvas.width;\n        const h = canvas.height;\n        const isWide = w > 600;\n\n        let pumpX = isWide ? w * 0.25 : w / 2;\n        let pumpY = isWide ? h / 2 : h * 0.3;\n        let pumpSize = Math.min(w, h) * (isWide ? 0.25 : 0.15);\n\n        // 1. Draw Pump\n        // Update rotation based on Speed (N)\n        // Base speed factor\n        const speedFactor = 0.005; // rad per frame per RPM (arbitrary visual scale)\n        rotationAngle += params.N * 0.002; \n        \n        drawImpeller(ctx, pumpX, pumpY, pumpSize, rotationAngle, ratio);\n\n        // 2. Draw Scaling Chart\n        let chartX = isWide ? w * 0.55 : 50;\n        let chartY = isWide ? h * 0.2 : h * 0.6;\n        let chartW = isWide ? w * 0.4 : w - 100;\n        let chartH = isWide ? h * 0.6 : h * 0.35;\n\n        drawBarChart(ctx, chartX, chartY, chartW, chartH, ratio);\n\n        requestAnimationFrame(animate);\n    }\n\n    // --- Listeners ---\n    Object.values(inputs).forEach(input => {\n        input.addEventListener('input', calculate);\n    });\n\n    // Start\n    animate();\n});"}}
{"input": {"input_text": "Open channel flow Manning: V = (1/n) R^(2/3) S^(1/2). Compute discharge Q = A*V.", "simulation_name": " Manning Equation", "domain": "Hydrology", "description": "Uniform open-channel velocity", "assumptions": ["Steady uniform"], "entities": [], "constants": [], "parameters": [{"name": "manning_n", "symbol": "n", "unit": "s/m^{1/3}", "range": [0.01, 0.2]}, {"name": "hydraulic_radius", "symbol": "R", "unit": "m", "range": [0.01, 5]}, {"name": "slope", "symbol": "S", "unit": "dimensionless", "range": [1e-05, 0.1]}, {"name": "area", "symbol": "A", "unit": "m^2", "range": [0.01, 50]}], "equations": [{"description": "Velocity", "expression": "V = (1/n)*R^{2/3}*S^{1/2}"}, {"description": "Discharge", "expression": "Q = A*V"}], "initial_conditions": {}, "outputs": ["V", "Q"], "simulation_controls": ["n", "R", "S", "A"], "constraints": ["n>0", "R>0", "S>=0", "A>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S56 Manning Equation Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"container\">\n    <header>\n        <h1>Manning Equation Calculator</h1>\n        <p>Open Channel Flow Velocity & Discharge</p>\n    </header>\n\n    <div class=\"simulation-layout\">\n        <aside class=\"controls\">\n            <div class=\"equation-box\">\n                $$V = \\frac{1}{n} R^{2/3} S^{1/2}$$\n                $$Q = A \\cdot V$$\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"n-slider\">\n                    Manning's Roughness ($n$)\n                    <span class=\"tooltip-icon\" title=\"0.01: Smooth Glass, 0.03: Gravel, 0.1+: Overgrown\">?</span>\n                </label>\n                <div class=\"diagram-hint\"></div>\n                <div class=\"control-row\">\n                    <input type=\"range\" id=\"n-slider\" min=\"0.01\" max=\"0.2\" step=\"0.005\" value=\"0.035\">\n                    <span class=\"value-display\" id=\"n-val\">0.035</span>\n                </div>\n                <div id=\"material-hint\" class=\"helper-text\">Natural Channel (Stones/Weeds)</div>\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"R-slider\">Hydraulic Radius ($R$) <span class=\"unit\">m</span></label>\n                <div class=\"control-row\">\n                    <input type=\"range\" id=\"R-slider\" min=\"0.01\" max=\"5\" step=\"0.01\" value=\"1.5\">\n                    <span class=\"value-display\" id=\"R-val\">1.50</span>\n                </div>\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"S-slider\">Channel Slope ($S$)</label>\n                <div class=\"control-row\">\n                    <input type=\"range\" id=\"S-slider\" min=\"0.00001\" max=\"0.1\" step=\"0.0001\" value=\"0.01\">\n                    <span class=\"value-display\" id=\"S-val\">0.0100</span>\n                </div>\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"A-slider\">Cross-Section Area ($A$) <span class=\"unit\">m²</span></label>\n                <div class=\"control-row\">\n                    <input type=\"range\" id=\"A-slider\" min=\"0.01\" max=\"50\" step=\"0.1\" value=\"10\">\n                    <span class=\"value-display\" id=\"A-val\">10.0</span>\n                </div>\n            </div>\n\n            <div class=\"results-panel\">\n                <div class=\"res-item\">\n                    <h3>Velocity ($V$)</h3>\n                    <span id=\"V-result\">0.00</span> <span class=\"unit\">m/s</span>\n                </div>\n                <div class=\"res-item highlight\">\n                    <h3>Discharge ($Q$)</h3>\n                    <span id=\"Q-result\">0.00</span> <span class=\"unit\">m³/s</span>\n                </div>\n            </div>\n        </aside>\n\n        <main class=\"visualization\">\n            <div class=\"canvas-wrapper\">\n                <canvas id=\"channelCanvas\"></canvas>\n                <div class=\"overlay-info\">\n                    <span id=\"flow-status\">Flow Status: Normal</span>\n                </div>\n            </div>\n            \n            <div class=\"viz-legend\">\n                <div class=\"legend-item\">\n                    <div class=\"swatch water\"></div> Water\n                </div>\n                <div class=\"legend-item\">\n                    <div class=\"swatch bed\"></div> Channel Bed\n                </div>\n            </div>\n            \n            <div class=\"explanation\">\n                <p><strong>Simulation View:</strong> This side-view animation visualizes the flow velocity. The tilt represents the slope ($S$), and the jaggedness of the bottom represents roughness ($n$).</p>\n            </div>\n        </main>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary: #2980b9;\n    --accent: #3498db;\n    --dark: #2c3e50;\n    --light: #ecf0f1;\n    --bed-color: #795548; /* Brown/Earth */\n    --water-color: rgba(52, 152, 219, 0.6);\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: #f4f7f6;\n    color: var(--dark);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n}\n\n.container {\n    width: 100%;\n    max-width: 1200px;\n    background: white;\n    padding: 25px;\n    border-radius: 12px;\n    box-shadow: 0 5px 20px rgba(0,0,0,0.1);\n}\n\nheader {\n    text-align: center;\n    border-bottom: 2px solid #eee;\n    margin-bottom: 25px;\n    padding-bottom: 10px;\n}\n\nh1 { margin: 0; color: var(--primary); }\np { margin: 5px 0 0; color: #7f8c8d; }\n\n.simulation-layout {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 30px;\n}\n\n/* Controls Panel */\n.controls {\n    flex: 1;\n    min-width: 320px;\n    background: #fafafa;\n    padding: 20px;\n    border-radius: 8px;\n    border: 1px solid #e0e0e0;\n}\n\n.equation-box {\n    background: white;\n    padding: 15px;\n    border-radius: 8px;\n    text-align: center;\n    margin-bottom: 20px;\n    font-size: 1.1em;\n    border: 1px solid #eee;\n}\n\n.input-group { margin-bottom: 20px; }\n\n.input-group label {\n    display: flex;\n    justify-content: space-between;\n    font-weight: 600;\n    margin-bottom: 8px;\n}\n\n.tooltip-icon {\n    background: #ddd;\n    border-radius: 50%;\n    width: 18px;\n    height: 18px;\n    text-align: center;\n    line-height: 18px;\n    font-size: 12px;\n    cursor: help;\n    color: #555;\n}\n\n.diagram-hint {\n    font-size: 0.8rem;\n    color: #999;\n    font-style: italic;\n    margin-bottom: 5px;\n    display: none; /* Hidden by default, just there for context structure */\n}\n\n.control-row {\n    display: flex;\n    align-items: center;\n    gap: 15px;\n}\n\ninput[type=range] {\n    flex-grow: 1;\n    cursor: pointer;\n    accent-color: var(--primary);\n}\n\n.value-display {\n    width: 70px;\n    text-align: right;\n    font-family: monospace;\n    font-weight: bold;\n    color: var(--primary);\n}\n\n.helper-text {\n    font-size: 0.8rem;\n    color: #7f8c8d;\n    text-align: right;\n    margin-top: 4px;\n    font-style: italic;\n}\n\n.results-panel {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 15px;\n    margin-top: 25px;\n}\n\n.res-item {\n    background: var(--dark);\n    color: white;\n    padding: 15px;\n    border-radius: 8px;\n    text-align: center;\n}\n\n.res-item.highlight {\n    background: var(--primary);\n}\n\n.res-item h3 { margin: 0 0 5px 0; font-size: 0.9rem; opacity: 0.8; }\n.res-item span { font-size: 1.5rem; font-weight: bold; }\n.unit { font-size: 1rem; font-weight: normal; opacity: 0.8; }\n\n/* Visualization Panel */\n.visualization {\n    flex: 2;\n    min-width: 400px;\n    display: flex;\n    flex-direction: column;\n}\n\n.canvas-wrapper {\n    position: relative;\n    width: 100%;\n    height: 400px;\n    background: linear-gradient(to bottom, #87CEEB 0%, #E0F7FA 100%);\n    border-radius: 8px;\n    overflow: hidden;\n    border: 2px solid #bdc3c7;\n}\n\ncanvas {\n    width: 100%;\n    height: 100%;\n    display: block;\n}\n\n.overlay-info {\n    position: absolute;\n    top: 10px;\n    left: 10px;\n    background: rgba(255,255,255,0.8);\n    padding: 5px 10px;\n    border-radius: 4px;\n    font-size: 0.85rem;\n    font-weight: bold;\n    color: var(--dark);\n}\n\n.viz-legend {\n    display: flex;\n    justify-content: center;\n    gap: 20px;\n    margin-top: 15px;\n}\n\n.legend-item {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-size: 0.9rem;\n}\n\n.swatch {\n    width: 16px;\n    height: 16px;\n    border-radius: 3px;\n}\n\n.swatch.water { background: var(--water-color); border: 1px solid var(--accent); }\n.swatch.bed { background: var(--bed-color); }\n\n.explanation {\n    margin-top: 15px;\n    font-size: 0.9rem;\n    color: #666;\n    background: #eee;\n    padding: 10px;\n    border-radius: 6px;\n}", "js": "document.addEventListener('DOMContentLoaded', () => {\n    // --- Elements ---\n    const sliders = {\n        n: document.getElementById('n-slider'),\n        R: document.getElementById('R-slider'),\n        S: document.getElementById('S-slider'),\n        A: document.getElementById('A-slider')\n    };\n\n    const displays = {\n        n: document.getElementById('n-val'),\n        R: document.getElementById('R-val'),\n        S: document.getElementById('S-val'),\n        A: document.getElementById('A-val'),\n        V: document.getElementById('V-result'),\n        Q: document.getElementById('Q-result'),\n        hint: document.getElementById('material-hint')\n    };\n\n    const canvas = document.getElementById('channelCanvas');\n    const ctx = canvas.getContext('2d');\n\n    // --- State ---\n    let params = {\n        n: parseFloat(sliders.n.value),\n        R: parseFloat(sliders.R.value),\n        S: parseFloat(sliders.S.value),\n        A: parseFloat(sliders.A.value)\n    };\n\n    let calculated = {\n        V: 0,\n        Q: 0\n    };\n\n    // Particles system\n    let particles = [];\n    const maxParticles = 300;\n    // Pre-calculated terrain noise\n    let bedNoise = [];\n\n    // --- Material Hints ---\n    function updateMaterialHint(n) {\n        let text = \"\";\n        if (n < 0.015) text = \"Glass / Smooth Concrete\";\n        else if (n < 0.025) text = \"Earth / Corrugated Metal\";\n        else if (n < 0.035) text = \"Natural Channel (Clean)\";\n        else if (n < 0.060) text = \"Natural (Stones & Weeds)\";\n        else text = \"Heavy Brush / Timber\";\n        displays.hint.textContent = text;\n    }\n\n    // --- Physics ---\n    function calculate() {\n        // V = (1/n) * R^(2/3) * S^(1/2)\n        const n = params.n;\n        const R = params.R;\n        const S = params.S;\n        const A = params.A;\n\n        const V = (1.0 / n) * Math.pow(R, 2/3) * Math.pow(S, 1/2);\n        const Q = V * A;\n\n        calculated.V = V;\n        calculated.Q = Q;\n\n        // UI Updates\n        displays.V.textContent = V.toFixed(2);\n        displays.Q.textContent = Q.toFixed(2);\n        \n        // Update input displays\n        displays.n.textContent = n.toFixed(3);\n        displays.R.textContent = R.toFixed(2);\n        displays.S.textContent = S.toFixed(5);\n        displays.A.textContent = A.toFixed(1);\n\n        updateMaterialHint(n);\n    }\n\n    // --- Animation Setup ---\n    \n    class Particle {\n        constructor(cw, ch) {\n            this.reset(cw, ch);\n        }\n\n        reset(cw, ch) {\n            this.x = Math.random() * cw;\n            this.y = Math.random() * ch; // Initial scatter\n            this.size = Math.random() * 2 + 2;\n            this.speedMod = Math.random() * 0.2 + 0.9; // Slight variation\n            this.active = true;\n        }\n\n        update(V, cw, ch, depthPx) {\n            // Visual speed scaling: 1 m/s = 20 px/frame (capped for sanity)\n            let visualSpeed = V * 10;\n            if(visualSpeed > 50) visualSpeed = 50; // Cap visual speed\n            if(visualSpeed < 0.5 && V > 0) visualSpeed = 0.5; // Min speed if moving\n\n            this.x += visualSpeed * this.speedMod;\n\n            // Wrap around\n            if (this.x > cw) {\n                this.x = -10;\n                this.y = Math.random() * depthPx; // Respawn at random depth\n            }\n        }\n\n        draw(ctx) {\n            ctx.fillStyle = \"rgba(255, 255, 255, 0.5)\";\n            ctx.beginPath();\n            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);\n            ctx.fill();\n        }\n    }\n\n    function generateBedNoise(width) {\n        // Generate static noise for the ground based on width\n        bedNoise = [];\n        for (let i = 0; i <= width; i+=5) {\n            bedNoise.push(Math.random());\n        }\n    }\n\n    function resizeCanvas() {\n        canvas.width = canvas.parentElement.clientWidth;\n        canvas.height = canvas.parentElement.clientHeight;\n        generateBedNoise(canvas.width);\n        // Reset particles\n        particles = [];\n        for (let i = 0; i < maxParticles; i++) {\n            particles.push(new Particle(canvas.width, canvas.height));\n        }\n    }\n\n    // --- Main Loop ---\n    function animate() {\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n        const w = canvas.width;\n        const h = canvas.height;\n\n        // 1. Calculate Geometry for Visuals\n        // We visualize a side slice.\n        // Slope S: 0.0001 to 0.1.\n        // 0.1 is very steep. We need to exaggerate slope visually but clamp it so it doesn't break rendering.\n        // Visual Rotation Angle:\n        let visualSlopeAngle = Math.atan(params.S);\n        // Exaggerate small slopes for visibility, clamp large ones\n        if (params.S < 0.01) visualSlopeAngle *= 20; \n        else if (params.S < 0.05) visualSlopeAngle *= 5;\n        \n        const rotationCenterX = w / 2;\n        const rotationCenterY = h / 2;\n\n        ctx.save();\n        \n        // Translate and Rotate Context to show slope\n        ctx.translate(rotationCenterX, rotationCenterY);\n        ctx.rotate(visualSlopeAngle);\n        ctx.translate(-rotationCenterX, -rotationCenterY);\n\n        // 2. Determine Water Depth visually\n        // R ranges 0.01 to 5.\n        // Map R to pixels. Max depth = 60% of canvas.\n        const maxDepthPx = h * 0.7;\n        const minDepthPx = 20;\n        // Simple linear mapping for visualization\n        const depthRatio = Math.min(1, params.R / 5.0);\n        const waterDepthPx = minDepthPx + (depthRatio * (maxDepthPx - minDepthPx));\n        \n        // Bed Y position\n        const bedY = h * 0.8;\n        const waterSurfaceY = bedY - waterDepthPx;\n\n        // 3. Draw Water Body\n        ctx.fillStyle = \"rgba(52, 152, 219, 0.6)\";\n        ctx.fillRect(-100, waterSurfaceY, w + 200, waterDepthPx); // Oversized width for rotation safety\n\n        // 4. Draw Particles (Flow)\n        // Clip particles to water area\n        ctx.save();\n        ctx.beginPath();\n        ctx.rect(-100, waterSurfaceY, w + 200, waterDepthPx);\n        ctx.clip();\n        \n        // Offset particles coordinate system to water surface\n        ctx.translate(0, waterSurfaceY); \n        \n        particles.forEach(p => {\n            // Only update/draw based on current V and depth\n            p.update(calculated.V, w, h, waterDepthPx);\n            p.draw(ctx);\n        });\n        ctx.restore(); // End clip\n\n        // 5. Draw Bed (Roughness)\n        ctx.fillStyle = \"#795548\"; // Brown\n        ctx.beginPath();\n        ctx.moveTo(-100, h); // Bottom Left\n        ctx.lineTo(-100, bedY); // Top Left (start of bed)\n\n        // Draw rough surface\n        // n ranges 0.01 to 0.2\n        const roughnessScale = (params.n - 0.01) * 300; // Amplitude scaling\n        \n        for (let x = 0; x <= w + 100; x += 5) {\n            // Map x to noise array index\n            const noiseIdx = Math.floor((x % w) / 5) % bedNoise.length;\n            const noise = bedNoise[noiseIdx];\n            const yOffset = (noise - 0.5) * roughnessScale;\n            ctx.lineTo(x - 50, bedY + yOffset);\n        }\n\n        ctx.lineTo(w + 100, h); // Bottom Right\n        ctx.fill();\n\n        ctx.restore(); // End Rotation\n\n        // 6. Slope Indicator (Overlay - Fixed orientation)\n        // Draw a small triangle to show slope angle if slope is significant\n        /*\n        ctx.fillStyle = \"black\";\n        ctx.font = \"12px sans-serif\";\n        ctx.fillText(`Slope: ${(params.S * 100).toFixed(2)}%`, 10, 20);\n        */\n\n        requestAnimationFrame(animate);\n    }\n\n    // --- Input Handling ---\n    function handleInput() {\n        params.n = parseFloat(sliders.n.value);\n        params.R = parseFloat(sliders.R.value);\n        params.S = parseFloat(sliders.S.value);\n        params.A = parseFloat(sliders.A.value);\n        \n        calculate();\n    }\n\n    Object.values(sliders).forEach(s => s.addEventListener('input', handleInput));\n    window.addEventListener('resize', resizeCanvas);\n\n    // --- Initialization ---\n    resizeCanvas();\n    calculate();\n    animate();\n});"}}
{"input": {"input_text": "Shallow water wave celerity: c = sqrt(g*h). Compute wave speed for depth h.", "simulation_name": " Shallow Water Wave", "domain": "Hydrology", "description": "Gravity wave speed in shallow water", "assumptions": ["Linear shallow water"], "entities": [], "constants": [{"name": "gravity", "symbol": "g", "value": 9.81, "unit": "m/s^2"}], "parameters": [{"name": "depth", "symbol": "h", "unit": "m", "range": [0.01, 200]}], "equations": [{"description": "Wave speed", "expression": "c = sqrt(g*h)"}], "initial_conditions": {}, "outputs": ["c"], "simulation_controls": ["h"], "constraints": ["h>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S57 Shallow Water Wave Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"main-container\">\n    <header>\n        <h1>Shallow Water Wave Celerity</h1>\n        <p>Simulate how water depth affects wave propagation speed.</p>\n    </header>\n\n    <div class=\"simulation-layout\">\n        <aside class=\"controls\">\n            <div class=\"equation-box\">\n                $$c = \\sqrt{g \\cdot h}$$\n                <small>Where $g \\approx 9.81 \\, m/s^2$</small>\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"depthSlider\">Water Depth ($h$)</label>\n                <input type=\"range\" id=\"depthSlider\" min=\"0.1\" max=\"200\" step=\"0.1\" value=\"50\">\n                <div class=\"value-display\">\n                    <span id=\"val_h\">50.0</span> m\n                </div>\n            </div>\n\n            <div class=\"results-panel\">\n                <div class=\"result-item\">\n                    <span class=\"label\">Wave Celerity ($c$)</span>\n                    <span class=\"value\" id=\"out_c\">0.00</span>\n                    <span class=\"unit\">m/s</span>\n                </div>\n                <div class=\"result-item\">\n                    <span class=\"label\">Speed in km/h</span>\n                    <span class=\"value\" id=\"out_kmh\">0.00</span>\n                    <span class=\"unit\">km/h</span>\n                </div>\n            </div>\n            \n            <div class=\"info-note\">\n                <p><strong>Note:</strong> In shallow water physics, wave speed depends only on depth, not wavelength.</p>\n            </div>\n        </aside>\n\n        <main class=\"canvas-wrapper\">\n            <canvas id=\"waveCanvas\"></canvas>\n            <div class=\"overlay-data\">\n                <span>Visual Scale: Auto-adjusting</span>\n            </div>\n        </main>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary-blue: #3498db;\n    --deep-blue: #2980b9;\n    --sky-blue: #ecf0f1; /* Light grey-ish blue for sky */\n    --text-color: #2c3e50;\n    --panel-bg: #ffffff;\n}\n\n* {\n    box-sizing: border-box;\n    margin: 0;\n    padding: 0;\n}\n\nbody {\n    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: #f4f7f6;\n    color: var(--text-color);\n    height: 100vh;\n    display: flex;\n    justify-content: center;\n    padding: 20px;\n}\n\n.main-container {\n    width: 100%;\n    max-width: 1200px;\n    background: var(--panel-bg);\n    border-radius: 12px;\n    box-shadow: 0 10px 25px rgba(0,0,0,0.1);\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n}\n\nheader {\n    background: var(--deep-blue);\n    color: white;\n    padding: 20px;\n    text-align: center;\n}\n\nheader h1 { margin-bottom: 5px; font-weight: 300; }\nheader p { opacity: 0.8; font-size: 0.9rem; }\n\n.simulation-layout {\n    display: flex;\n    flex: 1;\n    overflow: hidden; /* Prevent scrolling inside layout if possible */\n}\n\n/* Controls Side */\n.controls {\n    width: 320px;\n    padding: 25px;\n    border-right: 1px solid #eee;\n    background: #fafafa;\n    display: flex;\n    flex-direction: column;\n    gap: 25px;\n}\n\n.equation-box {\n    background: white;\n    padding: 15px;\n    border-radius: 8px;\n    border: 1px solid #e0e0e0;\n    text-align: center;\n    font-size: 1.2rem;\n}\n.equation-box small {\n    display: block;\n    margin-top: 5px;\n    font-size: 0.8rem;\n    color: #7f8c8d;\n}\n\n.input-group label {\n    display: block;\n    font-weight: 600;\n    margin-bottom: 10px;\n    color: var(--deep-blue);\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    cursor: pointer;\n}\n\n.value-display {\n    text-align: right;\n    font-weight: bold;\n    color: var(--deep-blue);\n    margin-top: 5px;\n}\n\n.results-panel {\n    background: var(--deep-blue);\n    color: white;\n    padding: 20px;\n    border-radius: 8px;\n    margin-top: auto; /* Push to bottom of controls if space allows */\n}\n\n.result-item {\n    margin-bottom: 15px;\n}\n.result-item:last-child { margin-bottom: 0; }\n\n.result-item .label {\n    display: block;\n    font-size: 0.85rem;\n    opacity: 0.9;\n    margin-bottom: 3px;\n    text-transform: uppercase;\n    letter-spacing: 1px;\n}\n\n.result-item .value {\n    font-size: 2rem;\n    font-weight: 700;\n}\n\n.result-item .unit {\n    font-size: 1rem;\n    opacity: 0.8;\n}\n\n.info-note {\n    font-size: 0.8rem;\n    color: #7f8c8d;\n    background: #eee;\n    padding: 10px;\n    border-radius: 4px;\n}\n\n/* Visual Side */\n.canvas-wrapper {\n    flex: 1;\n    position: relative;\n    background: var(--sky-blue);\n}\n\ncanvas {\n    width: 100%;\n    height: 100%;\n    display: block;\n}\n\n.overlay-data {\n    position: absolute;\n    bottom: 10px;\n    right: 10px;\n    font-size: 0.8rem;\n    color: rgba(0,0,0,0.4);\n    pointer-events: none;\n}\n\n/* Responsive */\n@media (max-width: 800px) {\n    .simulation-layout {\n        flex-direction: column;\n    }\n    .controls {\n        width: 100%;\n        border-right: none;\n        border-bottom: 1px solid #eee;\n    }\n    .canvas-wrapper {\n        height: 400px; /* Fixed height for mobile */\n    }\n}", "js": "document.addEventListener('DOMContentLoaded', () => {\n    const canvas = document.getElementById('waveCanvas');\n    const ctx = canvas.getContext('2d');\n\n    // Inputs & Outputs\n    const depthSlider = document.getElementById('depthSlider');\n    const valH = document.getElementById('val_h');\n    const outC = document.getElementById('out_c');\n    const outKmh = document.getElementById('out_kmh');\n\n    // Constants\n    const g = 9.81;\n\n    // Simulation State\n    let h = 50; // meters\n    let c = 0;  // m/s\n    let wavePhase = 0;\n    \n    // Wave Visual Parameters\n    let waveAmplitude = 10; \n    let waveLength = 200; // visual pixels\n\n    function resizeCanvas() {\n        canvas.width = canvas.parentElement.offsetWidth;\n        canvas.height = canvas.parentElement.offsetHeight;\n    }\n    window.addEventListener('resize', resizeCanvas);\n    resizeCanvas();\n\n    function updatePhysics() {\n        // Get input\n        h = parseFloat(depthSlider.value);\n        \n        // Update UI\n        valH.textContent = h.toFixed(1);\n\n        // Calculate Celerity: c = sqrt(g * h)\n        c = Math.sqrt(g * h);\n\n        // Update Results\n        outC.textContent = c.toFixed(2);\n        outKmh.textContent = (c * 3.6).toFixed(1); // Convert m/s to km/h\n    }\n\n    function draw() {\n        // Clear background (Sky)\n        // Create a nice gradient for the sky\n        let skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);\n        skyGradient.addColorStop(0, \"#87CEEB\"); // Sky Blue\n        skyGradient.addColorStop(1, \"#E0F7FA\"); // Light Cyan\n        ctx.fillStyle = skyGradient;\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n        // Determine Visual Water Level\n        // We want to visualize the depth change, but 0.1m to 200m is a huge range.\n        // We will map 0-200m to 10%-80% of canvas height linearly for visual feedback.\n        \n        const maxVisualDepth = canvas.height * 0.8;\n        const minVisualDepth = canvas.height * 0.1;\n        const maxInputH = 200;\n        \n        // Calculate visual height of the water column\n        // Linear mapping for simplicity of \"more h = more water\"\n        const visualWaterHeight = minVisualDepth + (h / maxInputH) * (maxVisualDepth - minVisualDepth);\n        \n        const waterSurfaceY = canvas.height - visualWaterHeight;\n\n        // Draw Seabed\n        ctx.fillStyle = \"#8B4513\"; // Brown\n        ctx.fillRect(0, canvas.height - 10, canvas.width, 10);\n        \n        // Draw Depth Marker Line (Visual aid)\n        ctx.strokeStyle = \"rgba(0,0,0,0.3)\";\n        ctx.beginPath();\n        ctx.moveTo(canvas.width - 50, waterSurfaceY);\n        ctx.lineTo(canvas.width - 50, canvas.height);\n        ctx.stroke();\n        \n        // Label Depth\n        ctx.fillStyle = \"#333\";\n        ctx.font = \"12px Arial\";\n        ctx.fillText(`h = ${h}m`, canvas.width - 90, canvas.height / 2 + waterSurfaceY/2);\n\n        // Draw Water with Waves\n        ctx.beginPath();\n        ctx.moveTo(0, canvas.height); // Start bottom left\n        ctx.lineTo(0, waterSurfaceY); // Go to surface start\n\n        // Draw sine wave for surface\n        // c determines the speed of phase change\n        // We scale c down to make it viewable on screen pixels\n        // Visual speed factor:\n        const visualSpeedFactor = 0.05; \n        \n        // Increment phase based on Celerity\n        wavePhase -= c * visualSpeedFactor; \n\n        for (let x = 0; x <= canvas.width; x += 5) {\n            // y = MeanLevel + Amplitude * sin(kx + phase)\n            let y = waterSurfaceY + Math.sin((x * 2 * Math.PI / waveLength) + wavePhase) * waveAmplitude;\n            ctx.lineTo(x, y);\n        }\n\n        ctx.lineTo(canvas.width, canvas.height); // Bottom right\n        ctx.closePath();\n\n        // Water Gradient\n        let waterGradient = ctx.createLinearGradient(0, waterSurfaceY, 0, canvas.height);\n        waterGradient.addColorStop(0, \"rgba(52, 152, 219, 0.8)\"); // Surface Blue\n        waterGradient.addColorStop(1, \"rgba(41, 128, 185, 1)\");   // Deep Blue\n        ctx.fillStyle = waterGradient;\n        ctx.fill();\n\n        // Draw a visual \"particle\" or floating object to emphasize motion speed\n        drawFloatingObject(waterSurfaceY);\n        \n        requestAnimationFrame(draw);\n    }\n\n    function drawFloatingObject(surfaceBaseY) {\n        // Draw a simple boat/buoy that bobs on the wave\n        // It stays in the center horizontally (x = canvas.width/2)\n        // But moves vertically with the wave math\n        const boatX = canvas.width / 2;\n        const boatY = surfaceBaseY + Math.sin((boatX * 2 * Math.PI / waveLength) + wavePhase) * waveAmplitude;\n\n        ctx.fillStyle = \"#e74c3c\"; // Red Buoy\n        ctx.beginPath();\n        ctx.arc(boatX, boatY, 8, 0, Math.PI * 2);\n        ctx.fill();\n        \n        // Draw speed arrow\n        // Arrow length proportional to c\n        const arrowLen = c * 3; // Scaling factor\n        ctx.strokeStyle = \"#c0392b\";\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.moveTo(boatX, boatY - 15);\n        ctx.lineTo(boatX + arrowLen, boatY - 15);\n        ctx.stroke();\n\n        // Arrowhead\n        ctx.beginPath();\n        ctx.moveTo(boatX + arrowLen, boatY - 15);\n        ctx.lineTo(boatX + arrowLen - 5, boatY - 18);\n        ctx.lineTo(boatX + arrowLen - 5, boatY - 12);\n        ctx.fill();\n        \n        // Speed Text above arrow\n        ctx.fillStyle = \"#c0392b\";\n        ctx.font = \"bold 11px Arial\";\n        ctx.fillText(\"V = \" + c.toFixed(1) + \" m/s\", boatX, boatY - 25);\n    }\n\n    // Initialize\n    depthSlider.addEventListener('input', updatePhysics);\n    updatePhysics();\n    draw();\n});"}}
{"input": {"input_text": "Seismic moment magnitude relation: M0 = 10^{1.5*Mw + 9.1}. Compute seismic moment from magnitude.", "simulation_name": " Seismic Moment", "domain": "Geophysics", "description": "Magnitude to seismic moment", "assumptions": ["Empirical scaling"], "entities": [], "constants": [], "parameters": [{"name": "moment_magnitude", "symbol": "Mw", "unit": "dimensionless", "range": [0, 9.5]}], "equations": [{"description": "Seismic moment", "expression": "M0 = 10^{1.5*Mw + 9.1}"}], "initial_conditions": {}, "outputs": ["M0"], "simulation_controls": ["Mw"], "constraints": ["Mw>=0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S58 Seismic Moment Calculator</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"container\">\n    <header>\n        <h1>Seismic Moment Calculator</h1>\n        <p>Convert Moment Magnitude ($M_w$) to Seismic Moment ($M_0$)</p>\n    </header>\n\n    <div class=\"simulation-layout\">\n        <aside class=\"controls\">\n            <div class=\"equation-box\">\n                $$M_0 = 10^{1.5 M_w + 9.1}$$\n                <small>Result in Newton-meters (N·m)</small>\n            </div>\n\n            <div class=\"input-group\">\n                <label for=\"Mw-slider\">\n                    Moment Magnitude ($M_w$)\n                    <span class=\"tooltip-icon\" title=\"A logarithmic scale of earthquake size.\">?</span>\n                </label>\n                <div class=\"control-row\">\n                    <input type=\"range\" id=\"Mw-slider\" min=\"0\" max=\"9.5\" step=\"0.1\" value=\"5.0\">\n                    <span class=\"value-display\" id=\"Mw-val\">5.0</span>\n                </div>\n                <div id=\"magnitude-desc\" class=\"helper-text\">Moderate Earthquake</div>\n            </div>\n\n            <div class=\"result-box\">\n                <h3>Seismic Moment ($M_0$)</h3>\n                <div class=\"result-display\">\n                    <span id=\"M0-result\">0.00</span> \n                    <span class=\"unit\">N·m</span>\n                </div>\n                <div class=\"scientific-notation\" id=\"M0-sci\">\n                    (1.00 &times; 10<sup>16</sup> N·m)\n                </div>\n            </div>\n\n            <div class=\"energy-box\">\n                <h4>Energy Equivalent</h4>\n                <p>Roughly equal to:</p>\n                <strong id=\"energy-equiv\">Loading...</strong>\n            </div>\n        </aside>\n\n        <main class=\"visualization\">\n            <div class=\"viz-header\">\n                <h2>Scale Visualization</h2>\n                <p>Radius represents relative rupture area</p>\n                <div style=\"font-size:0.8em; margin-top:5px; color:#888;\">\n                   \n                </div>\n            </div>\n            \n            <div class=\"canvas-wrapper\">\n                <canvas id=\"quakeCanvas\"></canvas>\n                <div class=\"scale-legend\">\n                    <span class=\"legend-dot current\"></span> Selected Quake\n                    <span class=\"legend-dot ref-sm\"></span> Mag 4\n                    <span class=\"legend-dot ref-md\"></span> Mag 7\n                </div>\n            </div>\n            \n            <div class=\"historical-context\">\n                <h3>Historical Context</h3>\n                <ul id=\"historical-list\">\n                    <li data-mag=\"9.5\">1960 Valdivia (9.5)</li>\n                    <li data-mag=\"9.1\">2004 Sumatra (9.1)</li>\n                    <li data-mag=\"7.8\">1906 San Francisco (7.8)</li>\n                    <li data-mag=\"7.0\">2010 Haiti (7.0)</li>\n                    <li data-mag=\"6.9\">1989 Loma Prieta (6.9)</li>\n                    <li data-mag=\"3.0\">Minor Tremor (3.0)</li>\n                </ul>\n            </div>\n        </main>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary: #c0392b; /* Earth/Danger Red */\n    --secondary: #e74c3c;\n    --dark: #2c3e50;\n    --light: #ecf0f1;\n    --text: #34495e;\n}\n\nbody {\n    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: #f8f9fa;\n    color: var(--text);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n}\n\n.container {\n    width: 100%;\n    max-width: 1100px;\n    background: white;\n    padding: 30px;\n    border-radius: 10px;\n    box-shadow: 0 5px 15px rgba(0,0,0,0.1);\n}\n\nheader {\n    text-align: center;\n    border-bottom: 2px solid #eee;\n    margin-bottom: 30px;\n    padding-bottom: 10px;\n}\n\nh1 { margin: 0; color: var(--dark); }\np { margin: 5px 0 0; color: #7f8c8d; }\n\n.simulation-layout {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 40px;\n}\n\n/* Controls Panel */\n.controls {\n    flex: 1;\n    min-width: 320px;\n    background: #fafafa;\n    padding: 25px;\n    border-radius: 8px;\n    border: 1px solid #eee;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.equation-box {\n    background: white;\n    padding: 15px;\n    border-radius: 6px;\n    text-align: center;\n    font-size: 1.1em;\n    border: 1px solid #e0e0e0;\n}\n\n.equation-box small {\n    display: block;\n    font-size: 0.8em;\n    color: #999;\n    margin-top: 5px;\n}\n\n.input-group label {\n    display: flex;\n    justify-content: space-between;\n    font-weight: 600;\n    margin-bottom: 8px;\n}\n\n.tooltip-icon {\n    background: #bdc3c7;\n    color: white;\n    border-radius: 50%;\n    width: 18px;\n    height: 18px;\n    text-align: center;\n    font-size: 12px;\n    line-height: 18px;\n    cursor: help;\n}\n\n.control-row {\n    display: flex;\n    align-items: center;\n    gap: 15px;\n}\n\ninput[type=range] {\n    flex-grow: 1;\n    cursor: pointer;\n    accent-color: var(--primary);\n    height: 8px;\n}\n\n.value-display {\n    width: 50px;\n    text-align: right;\n    font-family: monospace;\n    font-weight: bold;\n    color: var(--primary);\n    font-size: 1.2em;\n}\n\n.helper-text {\n    text-align: right;\n    font-size: 0.9em;\n    color: #7f8c8d;\n    font-style: italic;\n    margin-top: 5px;\n    height: 20px; /* Prevent jump */\n}\n\n.result-box {\n    background: var(--dark);\n    color: white;\n    padding: 20px;\n    border-radius: 8px;\n    text-align: center;\n}\n\n.result-box h3 { margin: 0 0 10px 0; font-size: 0.9em; opacity: 0.8; text-transform: uppercase; letter-spacing: 1px;}\n\n.result-display {\n    font-size: 1.4em;\n    font-weight: bold;\n    margin-bottom: 5px;\n    word-break: break-all;\n}\n\n.scientific-notation {\n    font-family: monospace;\n    color: #f1c40f;\n    font-size: 1.1em;\n}\n\n.unit { font-size: 0.7em; font-weight: normal; color: #bdc3c7; }\n\n.energy-box {\n    background: #fff3cd;\n    border: 1px solid #ffeeba;\n    color: #856404;\n    padding: 15px;\n    border-radius: 6px;\n    font-size: 0.9em;\n    text-align: center;\n}\n.energy-box h4 { margin: 0 0 5px 0; }\n.energy-box p { margin: 0 0 5px 0; font-size: 0.8em; }\n\n/* Visualization Panel */\n.visualization {\n    flex: 2;\n    min-width: 350px;\n    display: flex;\n    flex-direction: column;\n}\n\n.viz-header {\n    text-align: center;\n    margin-bottom: 15px;\n}\n.viz-header h2 { margin: 0; font-size: 1.2em; }\n.viz-header p { margin: 0; font-size: 0.8em; color: #7f8c8d; }\n\n.canvas-wrapper {\n    position: relative;\n    width: 100%;\n    height: 400px;\n    background: #fdfdfd;\n    border: 2px solid #ecf0f1;\n    border-radius: 8px;\n    overflow: hidden;\n    /* Grid background */\n    background-image: radial-gradient(#ddd 1px, transparent 1px);\n    background-size: 20px 20px;\n}\n\ncanvas {\n    width: 100%;\n    height: 100%;\n    display: block;\n}\n\n.scale-legend {\n    position: absolute;\n    bottom: 10px;\n    left: 10px;\n    background: rgba(255,255,255,0.9);\n    padding: 8px 12px;\n    border-radius: 20px;\n    border: 1px solid #ddd;\n    display: flex;\n    gap: 15px;\n    font-size: 0.8em;\n}\n\n.legend-dot {\n    width: 10px;\n    height: 10px;\n    border-radius: 50%;\n    display: inline-block;\n    margin-right: 5px;\n}\n\n.legend-dot.current { background: rgba(192, 57, 43, 0.8); border: 1px solid #c0392b; }\n.legend-dot.ref-sm { background: rgba(52, 152, 219, 0.3); border: 1px dashed #2980b9; }\n.legend-dot.ref-md { background: rgba(52, 152, 219, 0.3); border: 1px solid #2980b9; }\n\n.historical-context {\n    margin-top: 20px;\n    padding: 15px;\n    background: #fff;\n    border-top: 1px solid #eee;\n}\n\n.historical-context h3 { margin: 0 0 10px 0; font-size: 1em; color: var(--dark); }\n\n#historical-list {\n    list-style: none;\n    padding: 0;\n    margin: 0;\n    display: flex;\n    flex-wrap: wrap;\n    gap: 10px;\n}\n\n#historical-list li {\n    padding: 5px 10px;\n    border-radius: 15px;\n    background: #f0f0f0;\n    font-size: 0.85em;\n    color: #7f8c8d;\n    transition: all 0.3s;\n}\n\n#historical-list li.active {\n    background: var(--primary);\n    color: white;\n    transform: scale(1.05);\n    box-shadow: 0 2px 5px rgba(0,0,0,0.2);\n}", "js": "document.addEventListener('DOMContentLoaded', () => {\n    // --- Elements ---\n    const mwSlider = document.getElementById('Mw-slider');\n    const mwVal = document.getElementById('Mw-val');\n    const magnitudeDesc = document.getElementById('magnitude-desc');\n    const m0Result = document.getElementById('M0-result');\n    const m0Sci = document.getElementById('M0-sci');\n    const energyEquiv = document.getElementById('energy-equiv');\n    const canvas = document.getElementById('quakeCanvas');\n    const ctx = canvas.getContext('2d');\n    const historyList = document.querySelectorAll('#historical-list li');\n\n    // --- State ---\n    let Mw = parseFloat(mwSlider.value);\n    \n    // Wave animation properties\n    let time = 0;\n    let waveRings = []; \n\n    // --- Logic ---\n\n    // Calculate Seismic Moment M0\n    function calculateM0(mag) {\n        // M0 = 10^(1.5 * Mw + 9.1)\n        const exponent = (1.5 * mag) + 9.1;\n        return Math.pow(10, exponent);\n    }\n\n    // Get qualitative description\n    function getDescription(mag) {\n        if (mag < 2.0) return \"Micro - Rarely felt\";\n        if (mag < 4.0) return \"Minor - Often felt\";\n        if (mag < 5.0) return \"Light - Minor damage\";\n        if (mag < 6.0) return \"Moderate - Slight damage\";\n        if (mag < 7.0) return \"Strong - Damage in populated areas\";\n        if (mag < 8.0) return \"Major - Serious damage\";\n        return \"Great - Total destruction\";\n    }\n\n    // Rough Energy Analogies (Joules approximation)\n    // Energy E ≈ M0 / 20000 (roughly, or logE = 5.24 + 1.44Mw)\n    // Here we use analogies based on Moment.\n    function getEnergyAnalogy(mag) {\n        if (mag < 2) return \"Hand Grenade\";\n        if (mag < 3) return \"Large Construction Blast\";\n        if (mag < 4) return \"Small Atomic Bomb (Low Yield)\";\n        if (mag < 5) return \"Hiroshima Atomic Bomb\";\n        if (mag < 6) return \"Standard Thunderstorm Energy\";\n        if (mag < 7) return \"Largest Nuclear Test (Tsar Bomba)\";\n        if (mag < 8) return \"Mount St. Helens Eruption\";\n        if (mag < 9) return \"Krakatoa Eruption\";\n        return \"Total Annual US Energy Consumption\";\n    }\n\n    function updateDisplay() {\n        Mw = parseFloat(mwSlider.value);\n        \n        // 1. Update Controls text\n        mwVal.textContent = Mw.toFixed(1);\n        magnitudeDesc.textContent = getDescription(Mw);\n\n        // 2. Calculate M0\n        const m0 = calculateM0(Mw);\n\n        // 3. Update Result Displays\n        // Full number for smaller values, Sci notation for huge ones\n        if (m0 < 1e5) {\n            m0Result.textContent = Math.round(m0).toLocaleString();\n        } else {\n            // Just show \"Large Number\" or Sci notation primarily\n            m0Result.textContent = m0.toExponential(2);\n        }\n        \n        // Detailed Scientific Notation\n        const exponent = Math.floor(Math.log10(m0));\n        const mantissa = (m0 / Math.pow(10, exponent)).toFixed(2);\n        m0Sci.innerHTML = `(${mantissa} &times; 10<sup>${exponent}</sup> N·m)`;\n\n        // 4. Update Energy Analogy\n        energyEquiv.textContent = getEnergyAnalogy(Mw);\n\n        // 5. Highlight History\n        historyList.forEach(li => {\n            const histMag = parseFloat(li.dataset.mag);\n            // Highlight if within +/- 0.2 range\n            if (Math.abs(histMag - Mw) <= 0.2) {\n                li.classList.add('active');\n            } else {\n                li.classList.remove('active');\n            }\n        });\n    }\n\n    // --- Visualization ---\n    \n    function resizeCanvas() {\n        canvas.width = canvas.parentElement.clientWidth;\n        canvas.height = canvas.parentElement.clientHeight;\n    }\n\n    function draw() {\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n        \n        const cx = canvas.width / 2;\n        const cy = canvas.height / 2;\n\n        // Visual Scaling Strategy:\n        // Seismic Moment scales exponentially (10^1.5 ≈ 32x energy per magnitude step).\n        // Area scales roughly by 10 per magnitude step?\n        // Let's visualize \"Relative Rupture Radius\".\n        // Radius R scales approx 10^(0.5 * Mw).\n        // We normalize so Mag 5 fits nicely in the center.\n        \n        // Base scale: Mag 5 = 40px radius\n        const scaleFactor = 40 / Math.pow(10, 0.5 * 5); \n        const r = Math.pow(10, 0.5 * Mw) * scaleFactor;\n\n        // 1. Draw Reference Circles (Static context)\n        // Mag 4\n        ctx.beginPath();\n        ctx.strokeStyle = \"rgba(52, 152, 219, 0.3)\";\n        ctx.setLineDash([5, 5]);\n        const r4 = Math.pow(10, 0.5 * 4) * scaleFactor;\n        ctx.arc(cx, cy, r4, 0, Math.PI * 2);\n        ctx.stroke();\n        ctx.setLineDash([]);\n        \n        // Mag 7 (might be huge)\n        const r7 = Math.pow(10, 0.5 * 7) * scaleFactor;\n        if(r7 < Math.max(canvas.width, canvas.height)) {\n            ctx.beginPath();\n            ctx.strokeStyle = \"rgba(52, 152, 219, 0.3)\";\n            ctx.lineWidth = 1;\n            ctx.arc(cx, cy, r7, 0, Math.PI * 2);\n            ctx.stroke();\n        }\n\n        // 2. Draw Current Magnitude Circle (The \"Quake\")\n        // Use a gradient for impact\n        const gradient = ctx.createRadialGradient(cx, cy, 0, cx, cy, r);\n        gradient.addColorStop(0, \"rgba(231, 76, 60, 0.8)\"); // Center red\n        gradient.addColorStop(0.7, \"rgba(192, 57, 43, 0.4)\");\n        gradient.addColorStop(1, \"rgba(192, 57, 43, 0.0)\"); // Fade out\n        \n        ctx.fillStyle = gradient;\n        ctx.beginPath();\n        ctx.arc(cx, cy, r, 0, Math.PI * 2);\n        ctx.fill();\n\n        // 3. Draw \"Seismic Waves\" (Animation)\n        // Add a new ring occasionally\n        if (time % 60 === 0) { // Every ~1 sec\n            waveRings.push({ r: 0, opacity: 1.0 });\n        }\n        \n        ctx.strokeStyle = \"#c0392b\";\n        ctx.lineWidth = 2;\n\n        for (let i = 0; i < waveRings.length; i++) {\n            const ring = waveRings[i];\n            \n            // Expansion speed depends on magnitude (larger quakes feel slower/heavier)\n            ring.r += 1 + (Mw * 0.2); \n            ring.opacity -= 0.01;\n\n            if (ring.opacity <= 0) {\n                waveRings.splice(i, 1);\n                i--;\n            } else {\n                ctx.beginPath();\n                ctx.globalAlpha = ring.opacity;\n                ctx.arc(cx, cy, ring.r, 0, Math.PI * 2);\n                ctx.stroke();\n                ctx.globalAlpha = 1.0;\n            }\n        }\n        \n        // Center Epicenter Marker\n        ctx.fillStyle = \"#fff\";\n        ctx.beginPath();\n        ctx.arc(cx, cy, 3, 0, Math.PI*2);\n        ctx.fill();\n\n        time++;\n        requestAnimationFrame(draw);\n    }\n\n    // --- Init ---\n    mwSlider.addEventListener('input', updateDisplay);\n    window.addEventListener('resize', resizeCanvas);\n\n    resizeCanvas();\n    updateDisplay();\n    draw();\n});"}}
{"input": {"input_text": "Apparent magnitude difference relates to brightness ratio: m2 - m1 = -2.5 log10(F2/F1). Compute flux ratio from magnitudes.", "simulation_name": " Apparent Magnitude", "domain": "Astronomy", "description": "Magnitude to flux ratio", "assumptions": ["Same band"], "entities": [], "constants": [], "parameters": [{"name": "magnitude1", "symbol": "m1", "unit": "mag", "range": [-5, 20]}, {"name": "magnitude2", "symbol": "m2", "unit": "mag", "range": [-5, 30]}], "equations": [{"description": "Flux ratio", "expression": "F2_over_F1 = 10^{-0.4*(m2 - m1)}"}], "initial_conditions": {}, "outputs": ["F2_over_F1"], "simulation_controls": ["m1", "m2"], "constraints": ["m1 finite", "m2 finite"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S59 Apparent Magnitude Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"cosmos-container\">\n    <header>\n        <h1>Stellar Magnitude Comparator</h1>\n        <p>Compare the brightness (flux) of two celestial objects based on their apparent magnitudes.</p>\n    </header>\n\n    <div class=\"simulation-layout\">\n        <aside class=\"controls\">\n            <div class=\"equation-box\">\n                $$ \\frac{F_2}{F_1} = 10^{-0.4(m_2 - m_1)} $$\n                <div class=\"note\">A difference of 5 magnitudes = 100x brightness factor.</div>\n            </div>\n\n            <div class=\"control-group\">\n                <label for=\"m1\">Magnitude Object 1 ($m_1$)</label>\n                <div class=\"slider-row\">\n                    <input type=\"range\" id=\"m1\" min=\"-5\" max=\"20\" step=\"0.1\" value=\"0\">\n                    <span id=\"val_m1\" class=\"val-display\">0.0</span>\n                </div>\n                <div class=\"obj-label\">Reference Star (Fixed visual base)</div>\n            </div>\n\n            <div class=\"control-group\">\n                <label for=\"m2\">Magnitude Object 2 ($m_2$)</label>\n                <div class=\"slider-row\">\n                    <input type=\"range\" id=\"m2\" min=\"-5\" max=\"20\" step=\"0.1\" value=\"5\">\n                    <span id=\"val_m2\" class=\"val-display\">5.0</span>\n                </div>\n                <div class=\"obj-label\">Comparison Star</div>\n            </div>\n\n            <div class=\"results-panel\">\n                <h3>Flux Ratio ($F_2 / F_1$)</h3>\n                <div id=\"output_ratio\" class=\"big-result\">0.010</div>\n                <p id=\"comparison_text\">Object 2 is 100.00 times dimmer than Object 1.</p>\n            </div>\n        </aside>\n\n        <main class=\"viewport\">\n            <canvas id=\"starCanvas\"></canvas>\n            <div class=\"legend\">\n                <div class=\"legend-item\">\n                    <span class=\"dot ref-dot\"></span> Object 1\n                </div>\n                <div class=\"legend-item\">\n                    <span class=\"dot comp-dot\"></span> Object 2\n                </div>\n            </div>\n        </main>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --space-bg: #0b0d17;\n    --panel-bg: rgba(20, 25, 40, 0.9);\n    --text-color: #e0e6ed;\n    --accent-blue: #4dabf7;\n    --accent-gold: #ffd43b;\n    --star-ref-color: #ffffff;\n    --star-comp-color: #ffd43b;\n}\n\n* {\n    box-sizing: border-box;\n    margin: 0;\n    padding: 0;\n}\n\nbody {\n    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--space-bg);\n    color: var(--text-color);\n    height: 100vh;\n    display: flex;\n    justify-content: center;\n    padding: 20px;\n    overflow: hidden;\n}\n\n.cosmos-container {\n    width: 100%;\n    max-width: 1200px;\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n}\n\nheader {\n    text-align: center;\n    padding-bottom: 10px;\n    border-bottom: 1px solid rgba(255,255,255,0.1);\n}\n\nheader h1 {\n    font-weight: 300;\n    letter-spacing: 2px;\n    text-transform: uppercase;\n    color: var(--accent-blue);\n}\n\nheader p {\n    color: #8da3b8;\n    font-size: 0.9rem;\n}\n\n.simulation-layout {\n    display: flex;\n    gap: 20px;\n    height: 100%;\n    min-height: 0; /* logic for flexbox scrolling */\n}\n\n/* Controls */\n.controls {\n    flex: 0 0 350px;\n    background: var(--panel-bg);\n    padding: 25px;\n    border-radius: 8px;\n    border: 1px solid rgba(255,255,255,0.05);\n    display: flex;\n    flex-direction: column;\n    gap: 25px;\n    overflow-y: auto;\n}\n\n.equation-box {\n    background: rgba(0,0,0,0.3);\n    padding: 15px;\n    border-radius: 6px;\n    text-align: center;\n    border: 1px solid rgba(77, 171, 247, 0.2);\n}\n\n.note {\n    font-size: 0.8rem;\n    color: #8da3b8;\n    margin-top: 8px;\n    font-style: italic;\n}\n\n.control-group label {\n    display: block;\n    color: var(--accent-blue);\n    font-weight: 600;\n    margin-bottom: 8px;\n}\n\n.slider-row {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\ninput[type=\"range\"] {\n    flex: 1;\n    cursor: pointer;\n    accent-color: var(--accent-blue);\n}\n\n.val-display {\n    font-family: monospace;\n    width: 40px;\n    text-align: right;\n}\n\n.obj-label {\n    font-size: 0.75rem;\n    color: #666;\n    margin-top: 4px;\n}\n\n.results-panel {\n    margin-top: auto;\n    background: rgba(77, 171, 247, 0.1);\n    padding: 20px;\n    border-radius: 6px;\n    text-align: center;\n    border: 1px solid rgba(77, 171, 247, 0.3);\n}\n\n.results-panel h3 {\n    font-size: 1rem;\n    opacity: 0.8;\n}\n\n.big-result {\n    font-size: 2rem;\n    font-weight: bold;\n    color: #fff;\n    margin: 10px 0;\n    font-family: monospace;\n}\n\n#comparison_text {\n    font-size: 0.9rem;\n    color: var(--accent-gold);\n}\n\n/* Visualization */\n.viewport {\n    flex: 1;\n    background: radial-gradient(circle at center, #1b2735 0%, #090a0f 100%);\n    border-radius: 8px;\n    border: 1px solid rgba(255,255,255,0.1);\n    position: relative;\n    box-shadow: inset 0 0 50px rgba(0,0,0,0.5);\n}\n\ncanvas {\n    display: block;\n    width: 100%;\n    height: 100%;\n}\n\n.legend {\n    position: absolute;\n    bottom: 20px;\n    right: 20px;\n    display: flex;\n    gap: 20px;\n    background: rgba(0,0,0,0.6);\n    padding: 10px 20px;\n    border-radius: 20px;\n    border: 1px solid rgba(255,255,255,0.1);\n}\n\n.legend-item {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-size: 0.85rem;\n}\n\n.dot {\n    width: 10px;\n    height: 10px;\n    border-radius: 50%;\n}\n.ref-dot { background: var(--star-ref-color); box-shadow: 0 0 5px var(--star-ref-color); }\n.comp-dot { background: var(--star-comp-color); box-shadow: 0 0 5px var(--star-comp-color); }\n\n/* Responsive */\n@media (max-width: 800px) {\n    .simulation-layout { flex-direction: column; }\n    .controls { flex: none; width: 100%; }\n    .viewport { min-height: 400px; }\n}", "js": "document.addEventListener('DOMContentLoaded', () => {\n    const canvas = document.getElementById('starCanvas');\n    const ctx = canvas.getContext('2d');\n\n    const inputs = {\n        m1: document.getElementById('m1'),\n        m2: document.getElementById('m2')\n    };\n\n    const displays = {\n        m1: document.getElementById('val_m1'),\n        m2: document.getElementById('val_m2'),\n        ratio: document.getElementById('output_ratio'),\n        text: document.getElementById('comparison_text')\n    };\n\n    // --- State ---\n    let m1 = 0;\n    let m2 = 5;\n    let fluxRatio = 1;\n    \n    // Background stars for aesthetic\n    let bgStars = [];\n\n    // --- Initialization ---\n    function resizeCanvas() {\n        canvas.width = canvas.offsetWidth;\n        canvas.height = canvas.offsetHeight;\n        initBgStars();\n    }\n    window.addEventListener('resize', resizeCanvas);\n    \n    function initBgStars() {\n        bgStars = [];\n        for(let i=0; i<100; i++) {\n            bgStars.push({\n                x: Math.random() * canvas.width,\n                y: Math.random() * canvas.height,\n                size: Math.random() * 1.5,\n                opacity: Math.random()\n            });\n        }\n    }\n    resizeCanvas();\n\n    // --- Logic ---\n    function update() {\n        m1 = parseFloat(inputs.m1.value);\n        m2 = parseFloat(inputs.m2.value);\n\n        displays.m1.textContent = m1.toFixed(1);\n        displays.m2.textContent = m2.toFixed(1);\n\n        // Formula: F2/F1 = 10^(-0.4 * (m2 - m1))\n        const deltaM = m2 - m1;\n        fluxRatio = Math.pow(10, -0.4 * deltaM);\n\n        // Display Formatting\n        // If number is huge or tiny, use scientific notation\n        if (fluxRatio > 1000 || fluxRatio < 0.001) {\n            displays.ratio.textContent = fluxRatio.toExponential(3);\n        } else {\n            displays.ratio.textContent = fluxRatio.toFixed(3);\n        }\n\n        // Comparison Text\n        if (fluxRatio > 1) {\n            displays.text.textContent = `Object 2 is ${(fluxRatio).toFixed(2)}x BRIGHTER than Object 1`;\n            displays.text.style.color = \"#4dabf7\"; // Blue\n        } else if (fluxRatio < 1) {\n            displays.text.textContent = `Object 2 is ${(1/fluxRatio).toFixed(2)}x DIMMER than Object 1`;\n            displays.text.style.color = \"#ff7675\"; // Red/Dim\n        } else {\n            displays.text.textContent = \"Both objects have equal brightness.\";\n            displays.text.style.color = \"#fff\";\n        }\n    }\n\n    // --- Rendering Helpers ---\n    \n    // Draw a star with a glow effect\n    function drawStar(x, y, baseRadius, color, brightnessFactor) {\n        // Brightness Factor determines opacity and \"glow\" radius\n        // However, brightness varies by orders of magnitude (1 to 1,000,000+)\n        // We must compress this for visual display using a Log scale.\n        \n        // Logarithmic visual mapping\n        // We want 1.0 to look \"normal\". \n        // 100x brightness shouldn't cover the whole screen, but be significantly larger/whiter.\n        \n        let visualScale = Math.log10(brightnessFactor + 1); // +1 prevents log(0)\n        if(visualScale < 0.2) visualScale = 0.2; // Min visibility\n        \n        // Radius\n        const r = baseRadius * (0.5 + 0.5 * visualScale);\n        \n        // Glow\n        const gradient = ctx.createRadialGradient(x, y, r * 0.2, x, y, r * 3);\n        gradient.addColorStop(0, color);\n        gradient.addColorStop(0.4, color);\n        gradient.addColorStop(1, 'rgba(0,0,0,0)');\n\n        ctx.fillStyle = gradient;\n        ctx.globalAlpha = Math.min(1, 0.3 + 0.2 * visualScale); // Cap opacity\n        \n        ctx.beginPath();\n        ctx.arc(x, y, r * 3, 0, Math.PI * 2);\n        ctx.fill();\n\n        // Core\n        ctx.fillStyle = '#fff';\n        ctx.globalAlpha = 1;\n        ctx.beginPath();\n        ctx.arc(x, y, r * 0.5, 0, Math.PI * 2);\n        ctx.fill();\n\n        // Diffraction Spikes (Cross) for style\n        ctx.strokeStyle = color;\n        ctx.lineWidth = 1;\n        ctx.globalAlpha = 0.6;\n        const spikeLen = r * 4;\n        \n        ctx.beginPath();\n        ctx.moveTo(x - spikeLen, y);\n        ctx.lineTo(x + spikeLen, y);\n        ctx.moveTo(x, y - spikeLen);\n        ctx.lineTo(x, y + spikeLen);\n        ctx.stroke();\n\n        ctx.globalAlpha = 1; // Reset\n    }\n\n    // --- Animation Loop ---\n    let tick = 0;\n    function animate() {\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n        // 1. Draw Background Stars\n        ctx.fillStyle = \"#fff\";\n        bgStars.forEach(star => {\n            // Twinkle\n            let alpha = star.opacity + Math.sin(tick * 0.05 + star.x) * 0.2;\n            if (alpha < 0) alpha = 0;\n            ctx.globalAlpha = alpha;\n            ctx.beginPath();\n            ctx.arc(star.x, star.y, star.size, 0, Math.PI*2);\n            ctx.fill();\n        });\n        ctx.globalAlpha = 1;\n\n        // 2. Draw Main Stars\n        const centerY = canvas.height / 2;\n        const spacing = canvas.width / 4;\n        \n        // Star 1 (Reference)\n        // We fix Star 1 visual brightness to a constant \"1.0\" visual baseline\n        // unless we want to show relative shift. \n        // Let's keep Star 1 fixed visually to provide a stable reference point.\n        drawStar(spacing, centerY, 15, \"#ffffff\", 10); // 10 is arbitrary visual baseline\n        \n        // Star 2 (Comparison)\n        // Flux Ratio is F2 / F1. \n        // Visual Input = 10 (baseline) * fluxRatio\n        // Since range is huge, we clamp the visual input so the screen doesn't turn white.\n        let visualBrightness = 10 * fluxRatio;\n        \n        // Clamp for visual sanity (it can go to 10^10)\n        // We rely on the text for the exact number, visuals are qualitative.\n        if (visualBrightness > 1000) visualBrightness = 1000; \n\n        drawStar(spacing * 3, centerY, 15, \"#ffd43b\", visualBrightness);\n\n        // Labels on Canvas\n        ctx.fillStyle = \"#aaa\";\n        ctx.font = \"14px Arial\";\n        ctx.textAlign = \"center\";\n        ctx.fillText(\"Reference (m1)\", spacing, centerY + 80);\n        ctx.fillText(\"Comparison (m2)\", spacing * 3, centerY + 80);\n\n        tick++;\n        requestAnimationFrame(animate);\n    }\n\n    // Listeners\n    inputs.m1.addEventListener('input', update);\n    inputs.m2.addEventListener('input', update);\n\n    // Start\n    update();\n    animate();\n});"}}
{"input": {"input_text": "Beer-Lambert law: I = I0*exp(-alpha*L). Compute transmitted intensity given absorption coefficient and path length.", "simulation_name": " Beer Lambert", "domain": "Optics", "description": "Exponential attenuation", "assumptions": ["Monochromatic light"], "entities": [], "constants": [], "parameters": [{"name": "incident_intensity", "symbol": "I0", "unit": "W/m^2", "range": [0, 10000.0]}, {"name": "absorption_coeff", "symbol": "alpha", "unit": "1/m", "range": [0, 1000]}, {"name": "path_length", "symbol": "L", "unit": "m", "range": [0, 10]}], "equations": [{"description": "Transmitted", "expression": "I = I0*exp(-alpha*L)"}], "initial_conditions": {}, "outputs": ["I"], "simulation_controls": ["I0", "alpha", "L"], "constraints": ["I0>=0", "alpha>=0", "L>=0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S60 Beer-Lambert Law Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"container\">\n    <header>\n        <h1>Beer-Lambert Law</h1>\n        <p>Optical Attenuation & Exponential Decay</p>\n    </header>\n\n    <div class=\"simulation-layout\">\n        <aside class=\"controls\">\n            <div class=\"equation-box\">\n                $$I = I_0 e^{-\\alpha L}$$\n            </div>\n\n            <div class=\"input-group\">\n                <label>Incident Intensity ($I_0$) <span class=\"unit\">W/m²</span></label>\n                <div class=\"control-row\">\n                    <input type=\"range\" id=\"I0-slider\" min=\"1000\" max=\"10000\" step=\"100\" value=\"10000\">\n                    <span class=\"value-display\" id=\"I0-val\">10000</span>\n                </div>\n            </div>\n\n            <div class=\"input-group\">\n                <label>Absorption Coeff ($\\alpha$) <span class=\"unit\">m⁻¹</span></label>\n                <div class=\"control-row\">\n                    <input type=\"range\" id=\"alpha-slider\" min=\"0\" max=\"2\" step=\"0.01\" value=\"0.5\">\n                    <span class=\"value-display\" id=\"alpha-val\">0.50</span>\n                </div>\n                <small style=\"color:#777; display:block; text-align:right;\">Controls how fast light fades</small>\n            </div>\n\n            <div class=\"input-group\">\n                <label>Path Length ($L$) <span class=\"unit\">m</span></label>\n                <div class=\"control-row\">\n                    <input type=\"range\" id=\"L-slider\" min=\"0\" max=\"10\" step=\"0.1\" value=\"5\">\n                    <span class=\"value-display\" id=\"L-val\">5.0</span>\n                </div>\n            </div>\n            \n            <div class=\"checkbox-group\">\n                <input type=\"checkbox\" id=\"show-curve\" checked>\n                <label for=\"show-curve\">Overlay Theory Curve</label>\n            </div>\n\n            <div class=\"results-panel\">\n                <div class=\"result-item\">\n                    <h3>Transmitted ($I$)</h3>\n                    <span id=\"I-result\">0.00</span> <span class=\"unit\">W/m²</span>\n                </div>\n                <div class=\"result-item\">\n                    <h3>Transmission</h3>\n                    <span id=\"trans-percent\">0.00</span> <span class=\"unit\">%</span>\n                </div>\n            </div>\n        </aside>\n\n        <main class=\"visualization\">\n            <div class=\"canvas-wrapper\">\n                <canvas id=\"opticsCanvas\"></canvas>\n                <div class=\"beam-labels\">\n                    <div class=\"label-left\">Source</div>\n                    <div class=\"label-right\">Detector</div>\n                </div>\n            </div>\n\n            <div class=\"chart-container\">\n                <canvas id=\"decayChart\"></canvas>\n            </div>\n        </main>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-color: #121212;\n    --panel-bg: #1e1e1e;\n    --text-color: #e0e0e0;\n    --accent-color: #00ff9d; /* Laser Green */\n    --border-radius: 8px;\n}\n\nbody {\n    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n}\n\n.container {\n    width: 100%;\n    max-width: 1200px;\n    background-color: var(--panel-bg);\n    padding: 25px;\n    border-radius: var(--border-radius);\n    box-shadow: 0 10px 30px rgba(0,0,0,0.5);\n}\n\nheader {\n    text-align: center;\n    border-bottom: 1px solid #333;\n    padding-bottom: 15px;\n    margin-bottom: 25px;\n}\n\nh1 { margin: 0; color: var(--accent-color); text-transform: uppercase; letter-spacing: 2px; }\np { margin: 5px 0 0; color: #888; }\n\n.simulation-layout {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 30px;\n}\n\n.controls {\n    flex: 1;\n    min-width: 300px;\n    background: #252525;\n    padding: 20px;\n    border-radius: var(--border-radius);\n    border: 1px solid #333;\n}\n\n.equation-box {\n    background: #000;\n    padding: 10px;\n    border-radius: 6px;\n    text-align: center;\n    margin-bottom: 25px;\n    border: 1px solid #444;\n    font-size: 1.2rem;\n}\n\n.input-group { margin-bottom: 20px; }\n.input-group label { display: flex; justify-content: space-between; font-weight: 600; margin-bottom: 8px; color: #ccc; }\n.unit { color: #666; font-size: 0.9em; font-weight: normal; }\n\n.control-row { display: flex; align-items: center; gap: 15px; }\ninput[type=range] { flex-grow: 1; cursor: pointer; accent-color: var(--accent-color); }\n.value-display { width: 60px; text-align: right; font-family: monospace; font-weight: bold; color: var(--accent-color); }\n\n.checkbox-group {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    margin-bottom: 20px;\n    font-size: 0.9rem;\n    color: #ccc;\n}\n\n.results-panel {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 10px;\n    margin-top: 30px;\n    background: #111;\n    padding: 15px;\n    border-radius: 6px;\n    border: 1px solid #333;\n}\n.result-item { text-align: center; }\n.result-item h3 { margin: 0 0 5px 0; font-size: 0.85rem; color: #888; text-transform: uppercase;}\n.result-item span { font-size: 1.2rem; font-weight: bold; color: #fff; }\n\n.visualization {\n    flex: 2;\n    min-width: 400px;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.canvas-wrapper {\n    position: relative;\n    width: 100%;\n    height: 350px;\n    background: #000;\n    border-radius: var(--border-radius);\n    border: 1px solid #333;\n    overflow: hidden;\n}\n\ncanvas#opticsCanvas { width: 100%; height: 100%; display: block; }\n\n.beam-labels {\n    position: absolute;\n    bottom: 5px;\n    width: 100%;\n    display: flex;\n    justify-content: space-between;\n    padding: 0 20px;\n    font-size: 0.8rem;\n    color: #555;\n    text-transform: uppercase;\n    pointer-events: none;\n    box-sizing: border-box;\n}\n\n.chart-container {\n    height: 200px;\n    background: #252525;\n    padding: 10px;\n    border-radius: var(--border-radius);\n    border: 1px solid #333;\n}", "js": "document.addEventListener('DOMContentLoaded', () => {\n    // --- Elements ---\n    const sliders = {\n        I0: document.getElementById('I0-slider'),\n        alpha: document.getElementById('alpha-slider'),\n        L: document.getElementById('L-slider')\n    };\n    const showCurveCheck = document.getElementById('show-curve');\n\n    const displays = {\n        I0: document.getElementById('I0-val'),\n        alpha: document.getElementById('alpha-val'),\n        L: document.getElementById('L-val'),\n        I: document.getElementById('I-result'),\n        trans: document.getElementById('trans-percent')\n    };\n\n    const canvas = document.getElementById('opticsCanvas');\n    const ctx = canvas.getContext('2d');\n\n    // --- State ---\n    let params = {\n        I0: parseFloat(sliders.I0.value),\n        alpha: parseFloat(sliders.alpha.value),\n        L: parseFloat(sliders.L.value)\n    };\n    let photons = [];\n\n    // --- Chart Setup ---\n    const decayChart = new Chart(document.getElementById('decayChart').getContext('2d'), {\n        type: 'line',\n        data: {\n            datasets: [{\n                label: 'Intensity Profile',\n                data: [],\n                borderColor: '#00ff9d',\n                backgroundColor: 'rgba(0, 255, 157, 0.1)',\n                borderWidth: 2,\n                pointRadius: 0,\n                fill: true,\n                tension: 0.4\n            }, {\n                label: 'Output',\n                data: [],\n                backgroundColor: '#fff',\n                borderColor: '#fff',\n                pointRadius: 5,\n                type: 'scatter'\n            }]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            scales: {\n                x: {\n                    type: 'linear',\n                    title: { display: true, text: 'Distance (m)', color: '#888' },\n                    grid: { color: '#333' },\n                    ticks: { color: '#888' },\n                    min: 0, max: 10\n                },\n                y: {\n                    title: { display: true, text: 'Intensity (W/m²)', color: '#888' },\n                    grid: { color: '#333' },\n                    ticks: { color: '#888' },\n                    beginAtZero: true,\n                    max: 10000\n                }\n            },\n            plugins: { legend: { display: false } }\n        }\n    });\n\n    // --- Core Logic ---\n    function calculateIntensity(x) {\n        return params.I0 * Math.exp(-params.alpha * x);\n    }\n\n    function update() {\n        params.I0 = parseFloat(sliders.I0.value);\n        params.alpha = parseFloat(sliders.alpha.value);\n        params.L = parseFloat(sliders.L.value);\n\n        displays.I0.textContent = params.I0;\n        displays.alpha.textContent = params.alpha.toFixed(2);\n        displays.L.textContent = params.L.toFixed(1);\n\n        const I_out = calculateIntensity(params.L);\n        const transPercent = (I_out / params.I0) * 100;\n\n        displays.I.textContent = I_out.toLocaleString('en-US', { maximumFractionDigits: 0 });\n        displays.trans.textContent = transPercent.toFixed(1);\n\n        updateChart(I_out);\n    }\n\n    function updateChart(I_out) {\n        const data = [];\n        for(let x = 0; x <= 10; x += 0.2) {\n            data.push({ x: x, y: calculateIntensity(x) });\n        }\n        decayChart.data.datasets[0].data = data;\n        decayChart.data.datasets[1].data = [{ x: params.L, y: I_out }];\n        decayChart.options.scales.y.max = 10500; // Fixed scale to see drop clearly\n        decayChart.update('none');\n    }\n\n    // --- Animation System ---\n\n    class Photon {\n        constructor() {\n            this.reset();\n            // Start at random x to avoid \"waves\" of spawning\n            this.x = Math.random() * canvas.width;\n        }\n\n        reset() {\n            this.x = 0;\n            // Beam thickness\n            this.y = (canvas.height / 2) + (Math.random() - 0.5) * 80;\n            this.speed = 5 + Math.random() * 3;\n            this.opacity = 1;\n        }\n\n        update(mediumStart, pixelsPerMeter) {\n            this.x += this.speed;\n\n            // If inside medium, calculate opacity based on Beer-Lambert\n            if (this.x > mediumStart) {\n                const distanceInMediumPixels = this.x - mediumStart;\n                const distanceInMeters = distanceInMediumPixels / pixelsPerMeter;\n                \n                // If we haven't exited the medium yet\n                if (distanceInMeters <= params.L) {\n                    // I/I0 = exp(-alpha * x)\n                    // We map this ratio directly to opacity\n                    this.opacity = Math.exp(-params.alpha * distanceInMeters);\n                } else {\n                    // We have exited the medium. \n                    // Opacity remains constant at the exit value (transmission)\n                    this.opacity = Math.exp(-params.alpha * params.L);\n                }\n            } else {\n                this.opacity = 1;\n            }\n\n            // Loop\n            if (this.x > canvas.width) this.reset();\n        }\n\n        draw(ctx) {\n            if (this.opacity < 0.01) return; // Optimization\n            \n            ctx.fillStyle = `rgba(0, 255, 157, ${this.opacity})`;\n            ctx.beginPath();\n            // Particle size\n            ctx.arc(this.x, this.y, 1.5, 0, Math.PI * 2);\n            ctx.fill();\n        }\n    }\n\n    function resizeCanvas() {\n        canvas.width = canvas.parentElement.clientWidth;\n        canvas.height = canvas.parentElement.clientHeight;\n    }\n\n    function animate() {\n        ctx.fillStyle = \"#000\";\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n        // --- 1. Draw The Absorbing Medium ---\n        const pixelsPerMeter = canvas.width / 12; // 12 meters fit in view\n        const mediumStart = 50; \n        const mediumWidth = params.L * pixelsPerMeter;\n\n        // Visual style for the block\n        const grad = ctx.createLinearGradient(mediumStart, 0, mediumStart + mediumWidth, 0);\n        grad.addColorStop(0, \"rgba(50, 50, 80, 0.5)\");\n        grad.addColorStop(1, \"rgba(50, 50, 80, 0.8)\"); // Gets darker/denser visually to imply depth?\n        \n        ctx.fillStyle = grad;\n        ctx.strokeStyle = \"#446\";\n        ctx.lineWidth = 1;\n        ctx.fillRect(mediumStart, 30, mediumWidth, canvas.height - 60);\n        ctx.strokeRect(mediumStart, 30, mediumWidth, canvas.height - 60);\n\n        // Label for L\n        ctx.fillStyle = \"#fff\";\n        ctx.textAlign = \"center\";\n        ctx.font = \"12px sans-serif\";\n        if (params.L > 0.5) {\n            ctx.fillText(`L = ${params.L.toFixed(1)}m`, mediumStart + mediumWidth/2, canvas.height - 15);\n        }\n\n        // --- 2. Draw Theory Curve Overlay (Optional) ---\n        if (showCurveCheck.checked) {\n            ctx.beginPath();\n            ctx.strokeStyle = \"rgba(255, 255, 255, 0.3)\";\n            ctx.setLineDash([5, 5]);\n            ctx.lineWidth = 2;\n            \n            const beamCenter = canvas.height / 2;\n            const beamRadius = 40; // Visual radius of our particle beam\n\n            // Draw envelope top\n            ctx.moveTo(mediumStart, beamCenter - beamRadius);\n            for(let x = 0; x <= mediumWidth; x+=5) {\n                const distM = x / pixelsPerMeter;\n                const ratio = Math.exp(-params.alpha * distM);\n                // We visualize intensity curve as a \"narrowing\" or just plotting the ratio?\n                // Let's plot the ratio 1.0 to 0.0 as a graph overlay on top of the beam\n                // Actually, let's just draw the decay curve overlayed on the beam area\n                const yOffset = beamRadius * ratio; \n                ctx.lineTo(mediumStart + x, beamCenter - yOffset);\n            }\n            ctx.stroke();\n            \n            // Draw envelope bottom\n            ctx.beginPath();\n            ctx.moveTo(mediumStart, beamCenter + beamRadius);\n            for(let x = 0; x <= mediumWidth; x+=5) {\n                const distM = x / pixelsPerMeter;\n                const ratio = Math.exp(-params.alpha * distM);\n                const yOffset = beamRadius * ratio; \n                ctx.lineTo(mediumStart + x, beamCenter + yOffset);\n            }\n            ctx.stroke();\n            ctx.setLineDash([]);\n        }\n\n        // --- 3. Draw Photons ---\n        // Adjust particle count based on I0 slider for density effect\n        const targetCount = Math.floor(params.I0 / 10); \n        \n        // Add or remove particles to match target\n        while(photons.length < targetCount) photons.push(new Photon());\n        while(photons.length > targetCount) photons.pop();\n\n        photons.forEach(p => {\n            p.update(mediumStart, pixelsPerMeter);\n            p.draw(ctx);\n        });\n\n        requestAnimationFrame(animate);\n    }\n\n    // --- Events ---\n    Object.values(sliders).forEach(s => s.addEventListener('input', update));\n    window.addEventListener('resize', resizeCanvas);\n    \n    // Init\n    resizeCanvas();\n    update();\n    animate();\n});"}}
{"input": {"input_text": "Single-slit diffraction minima: sin(theta) = m*lambda/a. Compute first minimum angle m=1.", "simulation_name": " Single Slit Diffraction", "domain": "Optics", "description": "Fraunhofer single-slit minima", "assumptions": ["Far field"], "entities": [], "constants": [], "parameters": [{"name": "wavelength", "symbol": "lambda", "unit": "m", "range": [1e-09, 0.001]}, {"name": "slit_width", "symbol": "a", "unit": "m", "range": [1e-06, 0.01]}], "equations": [{"description": "First minimum", "expression": "theta = asin(lambda/a)"}], "initial_conditions": {}, "outputs": ["theta"], "simulation_controls": ["lambda", "a"], "constraints": ["a>0", "lambda>0", "lambda/a<=1"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S61 Single Slit Diffraction (Visible Light)</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n    <div class=\"container\">\n        <header>\n            <h1>Single Slit Diffraction</h1>\n            <p class=\"subtitle\">Visible Spectrum Analysis (380nm - 750nm)</p>\n        </header>\n\n        <main>\n            <div class=\"canvas-container\">\n                <canvas id=\"diffractionCanvas\"></canvas>\n                <div class=\"overlay-info\">\n                    Intensity Profile: \\( I(\\theta) \\propto \\text{sinc}^2(\\beta) \\)\n                </div>\n            </div>\n\n            <div class=\"controls-panel\">\n                <div class=\"control-group\">\n                    <label for=\"wavelength\">Wavelength (\\(\\lambda\\))</label>\n                    <div class=\"slider-wrapper\">\n                        <input type=\"range\" id=\"wavelength\" min=\"380\" max=\"750\" step=\"1\" value=\"550\">\n                        <div class=\"spectrum-bar\"></div>\n                    </div>\n                    <div class=\"value-display\">\n                        <span id=\"wavelength-val\">550</span> <span id=\"wavelength-unit\">nm</span>\n                    </div>\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"slit_width\">Slit Width (\\(a\\))</label>\n                    <input type=\"range\" id=\"slit_width\" min=\"-6\" max=\"-3.5\" step=\"0.01\" value=\"-5\">\n                    <div class=\"value-display\">\n                        <span id=\"slit-val\">10.0</span> <span id=\"slit-unit\">μm</span>\n                    </div>\n                </div>\n\n                <div class=\"results-panel\">\n                    <h3>Calculated Results (m=1)</h3>\n                    <div class=\"equation\">\n                        $$ \\theta = \\arcsin\\left(\\frac{\\lambda}{a}\\right) $$\n                    </div>\n                    \n                    <div class=\"result-item\">\n                        <span class=\"label\">Diffraction Ratio (\\(\\lambda/a\\)):</span>\n                        <span class=\"value\" id=\"ratio-val\">0.055</span>\n                    </div>\n\n                    <div class=\"result-item highlight\">\n                        <span class=\"label\">First Minimum Angle (\\(\\theta\\)):</span>\n                        <span class=\"value\" id=\"theta-val\">3.15</span>&deg;\n                    </div>\n                    \n                    <div id=\"warning-msg\" class=\"warning hidden\">\n                        Warning: \\(\\lambda > a\\). No diffraction minimum exists.\n                    </div>\n                </div>\n            </div>\n        </main>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary-color: #3b82f6;\n    --bg-color: #f8fafc;\n    --card-bg: #ffffff;\n    --text-color: #1e293b;\n    --slider-track: #e2e8f0;\n}\n\n* {\n    box-sizing: border-box;\n    margin: 0;\n    padding: 0;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    line-height: 1.6;\n    height: 100vh;\n    display: flex;\n    flex-direction: column;\n}\n\n.container {\n    max-width: 1200px;\n    margin: 0 auto;\n    padding: 20px;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 20px;\n}\n\nh1 {\n    font-weight: 700;\n    color: var(--text-color);\n}\n\n.subtitle {\n    color: #64748b;\n    font-size: 0.9rem;\n}\n\nmain {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n    flex: 1;\n}\n\n@media (min-width: 768px) {\n    main {\n        flex-direction: row;\n        align-items: stretch;\n    }\n}\n\n/* Canvas Area */\n.canvas-container {\n    flex: 2;\n    background: #000;\n    border-radius: 12px;\n    position: relative;\n    overflow: hidden;\n    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n    min-height: 300px;\n}\n\ncanvas {\n    width: 100%;\n    height: 100%;\n    display: block;\n}\n\n.overlay-info {\n    position: absolute;\n    top: 10px;\n    right: 15px;\n    color: rgba(255, 255, 255, 0.7);\n    font-size: 0.8rem;\n    pointer-events: none;\n}\n\n/* Controls Panel */\n.controls-panel {\n    flex: 1;\n    background: var(--card-bg);\n    padding: 25px;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n    overflow-y: auto;\n}\n\n.control-group {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\nlabel {\n    font-weight: 600;\n    font-size: 0.9rem;\n}\n\n.slider-wrapper {\n    position: relative;\n    width: 100%;\n}\n\n/* Spectrum background for the wavelength slider */\n.spectrum-bar {\n    height: 4px;\n    width: 100%;\n    margin-top: 4px;\n    border-radius: 2px;\n    background: linear-gradient(to right, \n        #8b00ff, /* 380nm */\n        #0000ff, /* 450nm */\n        #00ff00, /* 520nm */\n        #ffff00, /* 580nm */\n        #ff7f00, /* 600nm */\n        #ff0000  /* 750nm */\n    );\n    opacity: 0.8;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    height: 6px;\n    background: var(--slider-track);\n    border-radius: 5px;\n    outline: none;\n    -webkit-appearance: none;\n    margin-bottom: 2px;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    width: 20px;\n    height: 20px;\n    background: var(--primary-color);\n    border-radius: 50%;\n    cursor: pointer;\n    transition: background .15s ease-in-out;\n    border: 2px solid #fff;\n    box-shadow: 0 1px 3px rgba(0,0,0,0.3);\n    margin-top: -7px; /* Align with track */\n}\n\n/* Custom track style to align thumb */\ninput[type=\"range\"]::-webkit-slider-runnable-track {\n    width: 100%;\n    height: 6px;\n    cursor: pointer;\n    background: var(--slider-track);\n    border-radius: 5px;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb:hover {\n    background: #2563eb;\n    transform: scale(1.1);\n}\n\n.value-display {\n    display: flex;\n    justify-content: flex-end;\n    gap: 5px;\n    font-family: 'Courier New', monospace;\n    font-weight: 600;\n    color: var(--primary-color);\n}\n\n/* Results Panel */\n.results-panel {\n    margin-top: 20px;\n    padding-top: 20px;\n    border-top: 2px solid var(--slider-track);\n}\n\n.results-panel h3 {\n    font-size: 1.1rem;\n    margin-bottom: 15px;\n}\n\n.equation {\n    text-align: center;\n    margin-bottom: 15px;\n    font-size: 1.1em;\n}\n\n.result-item {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 10px;\n    padding: 8px;\n    border-radius: 6px;\n    background: #f1f5f9;\n}\n\n.result-item.highlight {\n    background: #eff6ff;\n    border: 1px solid #bfdbfe;\n}\n\n.result-item .label {\n    font-size: 0.9rem;\n    color: #475569;\n}\n\n.result-item .value {\n    font-weight: 700;\n    font-size: 1rem;\n}\n\n.warning {\n    background-color: #fef2f2;\n    color: #b91c1c;\n    padding: 10px;\n    border-radius: 6px;\n    border: 1px solid #fecaca;\n    font-size: 0.85rem;\n    text-align: center;\n    margin-top: 10px;\n}\n\n.hidden {\n    display: none;\n}", "js": "/**\n * Single Slit Diffraction Simulation (Visible Light)\n * Computes: theta = asin(lambda/a)\n * Visualizes: Intensity profile I = I0 * (sin(beta)/beta)^2\n */\n\n// --- DOM Elements ---\nconst canvas = document.getElementById('diffractionCanvas');\nconst ctx = canvas.getContext('2d');\n\nconst wavelengthSlider = document.getElementById('wavelength');\nconst slitSlider = document.getElementById('slit_width');\n\nconst wavelengthValDisplay = document.getElementById('wavelength-val');\nconst slitValDisplay = document.getElementById('slit-val');\nconst slitUnitDisplay = document.getElementById('slit-unit');\n\nconst ratioDisplay = document.getElementById('ratio-val');\nconst thetaDisplay = document.getElementById('theta-val');\nconst warningMsg = document.getElementById('warning-msg');\n\n// --- State ---\nlet state = {\n    // Wavelength in Meters (Slider is in nm: 380-750)\n    lambda: parseFloat(wavelengthSlider.value) * 1e-9, \n    // Slit Width in Meters (Slider is log scale 10^x)\n    a: Math.pow(10, parseFloat(slitSlider.value))\n};\n\n// --- Utilities ---\n\nfunction formatSlitWidth(val) {\n    // Auto-scale units for display\n    if (val < 1e-3) return { num: (val * 1e6).toFixed(1), unit: 'μm' };\n    if (val < 1) return { num: (val * 1e3).toFixed(2), unit: 'mm' };\n    return { num: val.toFixed(3), unit: 'm' };\n}\n\n// Convert wavelength (nm) to RGB color\nfunction wavelengthToColor(nm) {\n    let r, g, b;\n    if (nm >= 380 && nm < 440) {\n        r = -(nm - 440) / (440 - 380);\n        g = 0;\n        b = 1;\n    } else if (nm >= 440 && nm < 490) {\n        r = 0;\n        g = (nm - 440) / (490 - 440);\n        b = 1;\n    } else if (nm >= 490 && nm < 510) {\n        r = 0;\n        g = 1;\n        b = -(nm - 510) / (510 - 490);\n    } else if (nm >= 510 && nm < 580) {\n        r = (nm - 510) / (580 - 510);\n        g = 1;\n        b = 0;\n    } else if (nm >= 580 && nm < 645) {\n        r = 1;\n        g = -(nm - 645) / (645 - 580);\n        b = 0;\n    } else if (nm >= 645 && nm <= 750) {\n        r = 1;\n        g = 0;\n        b = 0;\n    } else {\n        return 'rgb(100,100,100)'; // Fallback\n    }\n\n    // Intensity falloff near limits of vision\n    let factor;\n    if (nm >= 380 && nm < 420) factor = 0.3 + 0.7 * (nm - 380) / (420 - 380);\n    else if (nm >= 420 && nm < 700) factor = 1.0;\n    else if (nm >= 700 && nm <= 750) factor = 0.3 + 0.7 * (750 - nm) / (750 - 700);\n    else factor = 0;\n\n    const rgb = [Math.round(r * factor * 255), Math.round(g * factor * 255), Math.round(b * factor * 255)];\n    return `rgb(${rgb[0]}, ${rgb[1]}, ${rgb[2]})`;\n}\n\n// --- Physics Calculation ---\nfunction calculate() {\n    const ratio = state.lambda / state.a;\n    \n    // Update Ratio UI\n    ratioDisplay.textContent = ratio.toExponential(3);\n\n    // Check constraints\n    if (ratio >= 1) {\n        thetaDisplay.textContent = \"Undefined\";\n        warningMsg.classList.remove('hidden');\n        return null;\n    } else {\n        warningMsg.classList.add('hidden');\n        const thetaRad = Math.asin(ratio);\n        const thetaDeg = (thetaRad * 180 / Math.PI).toFixed(2);\n        thetaDisplay.textContent = thetaDeg;\n        return thetaRad;\n    }\n}\n\n// --- Drawing ---\nfunction draw() {\n    // Handle resizing\n    canvas.width = canvas.parentElement.clientWidth;\n    canvas.height = canvas.parentElement.clientHeight;\n    \n    const w = canvas.width;\n    const h = canvas.height;\n    const centerY = h / 2;\n    const centerX = w / 2;\n\n    const thetaMin = calculate(); // First minimum angle in radians\n    const nm = state.lambda * 1e9;\n    const color = wavelengthToColor(nm);\n\n    // Clear canvas\n    ctx.fillStyle = '#000000';\n    ctx.fillRect(0, 0, w, h);\n\n    // Dynamic Scaling:\n    // Ensure the central maximum always fits nicely.\n    // Width of central max ~ 2 * thetaMin\n    // We want this to occupy roughly 40-50% of the screen width usually.\n    let displayScale = 0;\n    \n    if (thetaMin !== null && thetaMin > 0) {\n         // Map the first minimum to x = 150 pixels from center\n         displayScale = 150 / Math.sin(thetaMin); \n    } else {\n        displayScale = 10;\n    }\n\n    // Clamp zoom to prevent rendering issues at extreme values\n    displayScale = Math.min(Math.max(displayScale, 200), 50000);\n\n    const patternHeight = 120;\n    const patternYStart = h - patternHeight - 20;\n\n    // 1. Draw Diffraction Gradient Band\n    const gradient = ctx.createLinearGradient(0, 0, w, 0);\n    const steps = 150; \n    \n    for(let i = 0; i <= steps; i++) {\n        const x = (i / steps) * w;\n        const distFromCenter = Math.abs(x - centerX);\n        \n        // Calculate sin(theta) for this pixel\n        const sinTheta = distFromCenter / displayScale; \n        \n        let intensity = 0;\n        if (sinTheta === 0) {\n            intensity = 1;\n        } else {\n            // Beta = (pi * a * sin(theta)) / lambda\n            const beta = Math.PI * (state.a * sinTheta / state.lambda);\n            if (beta !== 0) {\n                intensity = Math.pow(Math.sin(beta) / beta, 2);\n            } else {\n                intensity = 1;\n            }\n        }\n        \n        // Enhance visibility of side lobes (gamma correction-ish)\n        // A pure linear intensity is hard to see on screens for higher orders\n        const visualIntensity = Math.pow(intensity, 0.5); \n\n        // Parse RGB color to inject alpha\n        const rgbVals = color.match(/\\d+/g);\n        if(rgbVals) {\n             gradient.addColorStop(i/steps, `rgba(${rgbVals[0]}, ${rgbVals[1]}, ${rgbVals[2]}, ${visualIntensity})`);\n        }\n    }\n\n    ctx.fillStyle = gradient;\n    ctx.fillRect(0, patternYStart, w, patternHeight);\n    \n    // Draw Axis Line\n    ctx.strokeStyle = '#555';\n    ctx.beginPath();\n    ctx.moveTo(0, patternYStart + patternHeight);\n    ctx.lineTo(w, patternYStart + patternHeight);\n    ctx.stroke();\n\n    ctx.fillStyle = '#aaa';\n    ctx.font = '12px sans-serif';\n    ctx.fillText('Diffraction Pattern on Screen', 10, patternYStart - 8);\n\n    // 2. Draw Intensity Graph (Sinc Curve)\n    ctx.strokeStyle = '#ffffff';\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.shadowBlur = 4;\n    ctx.shadowColor = color; // Glow effect matching the light\n\n    for (let x = 0; x < w; x+=2) {\n        const distFromCenter = Math.abs(x - centerX);\n        const sinTheta = distFromCenter / displayScale;\n        \n        let intensity = 0;\n        if (sinTheta === 0) intensity = 1;\n        else {\n            const beta = Math.PI * (state.a * sinTheta / state.lambda);\n            intensity = Math.pow(Math.sin(beta) / beta, 2);\n        }\n\n        const plotY = patternYStart - (intensity * (h * 0.45)); \n        if (x === 0) ctx.moveTo(x, plotY);\n        else ctx.lineTo(x, plotY);\n    }\n    ctx.stroke();\n    ctx.shadowBlur = 0; // Reset shadow\n\n    // 3. Annotate First Minimum\n    if (thetaMin !== null) {\n        const xOffset = (Math.sin(thetaMin) * displayScale);\n        const m1Right = centerX + xOffset;\n        const m1Left = centerX - xOffset;\n\n        // Visual markers\n        ctx.strokeStyle = '#888';\n        ctx.setLineDash([4, 4]);\n\n        if (m1Right < w) {\n            ctx.beginPath();\n            ctx.moveTo(m1Right, patternYStart);\n            ctx.lineTo(m1Right, patternYStart - (h * 0.45));\n            ctx.stroke();\n            \n            drawLabel(`m=1`, m1Right, patternYStart - (h * 0.45) - 20);\n            drawLabel(`θ=${(thetaMin * 180 / Math.PI).toFixed(2)}°`, m1Right, patternYStart - (h * 0.45) - 5);\n        }\n        \n        if (m1Left > 0) {\n            ctx.beginPath();\n            ctx.moveTo(m1Left, patternYStart);\n            ctx.lineTo(m1Left, patternYStart - (h * 0.45));\n            ctx.stroke();\n            drawLabel(`m=-1`, m1Left, patternYStart - (h * 0.45) - 5);\n        }\n        ctx.setLineDash([]);\n    }\n}\n\nfunction drawLabel(text, x, y) {\n    ctx.fillStyle = '#fff';\n    ctx.textAlign = 'center';\n    ctx.fillText(text, x, y);\n}\n\n// --- Event Listeners ---\n\nfunction update() {\n    // 1. Read Inputs\n    const lambdaNm = parseFloat(wavelengthSlider.value); // Linear nm\n    const slitLog = parseFloat(slitSlider.value);       // Log meters\n\n    state.lambda = lambdaNm * 1e-9;\n    state.a = Math.pow(10, slitLog);\n\n    // 2. Update Text\n    wavelengthValDisplay.textContent = lambdaNm;\n    \n    // Color the thumb of the slider to match physics\n    const color = wavelengthToColor(lambdaNm);\n    wavelengthSlider.style.setProperty('--primary-color', color);\n    \n    // Slit Text\n    const sFmt = formatSlitWidth(state.a);\n    slitValDisplay.textContent = sFmt.num;\n    slitUnitDisplay.textContent = sFmt.unit;\n\n    // 3. Draw\n    draw();\n}\n\n// Init listeners\nwavelengthSlider.addEventListener('input', update);\nslitSlider.addEventListener('input', update);\nwindow.addEventListener('resize', draw);\n\n// Initial call\nupdate();"}}
{"input": {"input_text": "Double-slit interference maxima: sin(theta) = m*lambda/d. Compute first-order angle m=1.", "simulation_name": " Double Slit Interference", "domain": "Optics", "description": "Fringe angle for double slit", "assumptions": ["Far field"], "entities": [], "constants": [], "parameters": [{"name": "wavelength", "symbol": "lambda", "unit": "m", "range": [1e-09, 0.001]}, {"name": "slit_spacing", "symbol": "d", "unit": "m", "range": [1e-06, 0.01]}], "equations": [{"description": "First maximum", "expression": "theta = asin(lambda/d)"}], "initial_conditions": {}, "outputs": ["theta"], "simulation_controls": ["lambda", "d"], "constraints": ["d>0", "lambda>0", "lambda/d<=1"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S62 Double Slit Interference Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1>Double Slit Interference</h1>\n            <p class=\"subtitle\">Optics Domain: First-Order Maximum Analysis</p>\n        </header>\n\n        <main>\n            <div class=\"canvas-container\">\n                <canvas id=\"simCanvas\"></canvas>\n                <div class=\"legend\">\n                    <span style=\"color: #4facfe;\">● Wavefronts</span>\n                    <span style=\"color: #ff5e62;\">● Intensity Profile</span>\n                    <span style=\"color: #ffd700;\">● 1st Order Max (m=1)</span>\n                </div>\n            </div>\n\n            <div class=\"controls-panel\">\n                <div class=\"control-group\">\n                    <label for=\"lambdaSlider\">\n                        Wavelength ($\\lambda$)\n                        <span class=\"unit-display\" id=\"lambdaVal\">5.00e-7 m</span>\n                    </label>\n                    <input type=\"range\" id=\"lambdaSlider\" min=\"-9\" max=\"-3\" step=\"0.01\" value=\"-6.3\">\n                    <div class=\"range-labels\">\n                        <span>1nm</span>\n                        <span>1mm</span>\n                    </div>\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"dSlider\">\n                        Slit Spacing ($d$)\n                        <span class=\"unit-display\" id=\"dVal\">2.00e-6 m</span>\n                    </label>\n                    <input type=\"range\" id=\"dSlider\" min=\"-6\" max=\"-2\" step=\"0.01\" value=\"-5.7\">\n                    <div class=\"range-labels\">\n                        <span>1&mu;m</span>\n                        <span>1cm</span>\n                    </div>\n                </div>\n\n                <div class=\"output-group\">\n                    <h2>Results ($m=1$)</h2>\n                    <div class=\"result-box\">\n                        <span class=\"label\">Angle ($\\theta$):</span>\n                        <span class=\"value\" id=\"thetaOutput\">--</span>\n                    </div>\n                    <div class=\"result-box\">\n                        <span class=\"label\">Ratio ($\\lambda/d$):</span>\n                        <span class=\"value\" id=\"ratioOutput\">--</span>\n                    </div>\n                    <div id=\"errorMsg\" class=\"error-message hidden\">\n                        Error: $\\lambda > d$ (No interference pattern)\n                    </div>\n                </div>\n            </div>\n        </main>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-color: #0f172a;\n    --panel-bg: #1e293b;\n    --text-primary: #f1f5f9;\n    --text-secondary: #94a3b8;\n    --accent: #38bdf8;\n    --error: #ef4444;\n}\n\nbody {\n    margin: 0;\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-primary);\n    display: flex;\n    justify-content: center;\n    min-height: 100vh;\n}\n\n.container {\n    max-width: 1000px;\n    width: 100%;\n    padding: 20px;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\nheader {\n    text-align: center;\n    border-bottom: 1px solid #334155;\n    padding-bottom: 15px;\n}\n\nh1 {\n    margin: 0;\n    font-size: 1.8rem;\n    color: var(--accent);\n}\n\n.subtitle {\n    margin: 5px 0 0;\n    color: var(--text-secondary);\n    font-size: 0.9rem;\n}\n\nmain {\n    display: grid;\n    grid-template-columns: 2fr 1fr;\n    gap: 20px;\n}\n\n@media (max-width: 768px) {\n    main {\n        grid-template-columns: 1fr;\n    }\n}\n\n/* Canvas Area */\n.canvas-container {\n    background-color: #000;\n    border-radius: 8px;\n    position: relative;\n    border: 1px solid #334155;\n    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n    display: flex;\n    flex-direction: column;\n}\n\ncanvas {\n    width: 100%;\n    height: 400px;\n    border-radius: 8px 8px 0 0;\n    cursor: crosshair;\n}\n\n.legend {\n    background-color: var(--panel-bg);\n    padding: 8px 15px;\n    display: flex;\n    gap: 15px;\n    font-size: 0.8rem;\n    border-radius: 0 0 8px 8px;\n    justify-content: center;\n}\n\n/* Controls Panel */\n.controls-panel {\n    background-color: var(--panel-bg);\n    padding: 20px;\n    border-radius: 8px;\n    display: flex;\n    flex-direction: column;\n    gap: 25px;\n    height: fit-content;\n}\n\n.control-group {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\nlabel {\n    font-weight: 600;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    font-size: 0.9rem;\n}\n\n.unit-display {\n    font-family: 'Courier New', monospace;\n    color: var(--accent);\n    background: rgba(56, 189, 248, 0.1);\n    padding: 2px 6px;\n    border-radius: 4px;\n    font-size: 0.85rem;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    cursor: pointer;\n    accent-color: var(--accent);\n}\n\n.range-labels {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.75rem;\n    color: var(--text-secondary);\n}\n\n/* Output Area */\n.output-group {\n    background-color: rgba(0, 0, 0, 0.2);\n    padding: 15px;\n    border-radius: 6px;\n    margin-top: 10px;\n}\n\n.output-group h2 {\n    margin: 0 0 15px 0;\n    font-size: 1rem;\n    color: var(--text-secondary);\n    border-bottom: 1px solid #334155;\n    padding-bottom: 5px;\n}\n\n.result-box {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 10px;\n    align-items: center;\n}\n\n.result-box .value {\n    font-family: 'Courier New', monospace;\n    font-size: 1.1rem;\n    color: #ffd700; /* Gold */\n    font-weight: bold;\n}\n\n.error-message {\n    color: var(--error);\n    font-size: 0.85rem;\n    text-align: center;\n    background: rgba(239, 68, 68, 0.1);\n    padding: 8px;\n    border-radius: 4px;\n    border: 1px solid var(--error);\n}\n\n.hidden {\n    display: none;\n}", "js": "/**\n * S62 Double Slit Interference Simulation\n * Domain: Optics\n * * Logic:\n * 1. Inputs: Wavelength (lambda) and Slit Spacing (d).\n * 2. Calculate theta = asin(lambda / d).\n * 3. Visualize wave propagation and intensity pattern on canvas.\n */\n\n// DOM Elements\nconst canvas = document.getElementById('simCanvas');\nconst ctx = canvas.getContext('2d');\n\nconst lambdaSlider = document.getElementById('lambdaSlider');\nconst dSlider = document.getElementById('dSlider');\nconst lambdaValDisplay = document.getElementById('lambdaVal');\nconst dValDisplay = document.getElementById('dVal');\nconst thetaOutput = document.getElementById('thetaOutput');\nconst ratioOutput = document.getElementById('ratioOutput');\nconst errorMsg = document.getElementById('errorMsg');\n\n// State Variables (Values in SI units: meters)\nlet state = {\n    lambda: 500e-9, // 500 nm default\n    d: 2e-6,        // 2 micrometers default\n    theta: 0,\n    isValid: true,\n    time: 0\n};\n\n// Initialization\nfunction init() {\n    resizeCanvas();\n    window.addEventListener('resize', resizeCanvas);\n    \n    // Add event listeners to sliders\n    lambdaSlider.addEventListener('input', handleInput);\n    dSlider.addEventListener('input', handleInput);\n\n    // Initial calculation\n    handleInput();\n    \n    // Start Animation Loop\n    requestAnimationFrame(animate);\n}\n\nfunction resizeCanvas() {\n    // Handle High DPI displays\n    const dpr = window.devicePixelRatio || 1;\n    const rect = canvas.getBoundingClientRect();\n    \n    canvas.width = rect.width * dpr;\n    canvas.height = rect.height * dpr;\n    ctx.scale(dpr, dpr);\n}\n\nfunction handleInput() {\n    // Inputs are on logarithmic scales (base 10)\n    // Slider value x represents 10^x\n    state.lambda = Math.pow(10, parseFloat(lambdaSlider.value));\n    state.d = Math.pow(10, parseFloat(dSlider.value));\n\n    // Update UI text\n    lambdaValDisplay.textContent = formatSci(state.lambda) + \" m\";\n    dValDisplay.textContent = formatSci(state.d) + \" m\";\n\n    calculatePhysics();\n}\n\nfunction calculatePhysics() {\n    const ratio = state.lambda / state.d;\n    \n    ratioOutput.textContent = ratio.toFixed(4);\n\n    // Check constraints: lambda/d <= 1\n    if (ratio > 1) {\n        state.isValid = false;\n        state.theta = NaN;\n        thetaOutput.textContent = \"Undefined\";\n        errorMsg.classList.remove('hidden');\n    } else {\n        state.isValid = true;\n        // Calculate First Order Maximum (m=1)\n        const rad = Math.asin(ratio);\n        const deg = rad * (180 / Math.PI);\n        state.theta = deg;\n        thetaOutput.textContent = deg.toFixed(2) + \"°\";\n        errorMsg.classList.add('hidden');\n    }\n}\n\nfunction formatSci(num) {\n    return num.toExponential(2);\n}\n\n// Animation Loop\nfunction animate() {\n    state.time += 0.1; // Increment time for wave animation\n    draw();\n    requestAnimationFrame(animate);\n}\n\nfunction draw() {\n    const width = canvas.width / (window.devicePixelRatio || 1);\n    const height = canvas.height / (window.devicePixelRatio || 1);\n    \n    // Clear Canvas\n    ctx.fillStyle = '#000';\n    ctx.fillRect(0, 0, width, height);\n\n    const centerX = width * 0.1; // Slits position (left side)\n    const centerY = height / 2;\n    const screenX = width * 0.85; // Screen position (right side)\n\n    // 1. Draw Geometry (Slits and Screen)\n    ctx.strokeStyle = '#666';\n    ctx.lineWidth = 2;\n\n    // Draw Screen Line\n    ctx.beginPath();\n    ctx.moveTo(screenX, 20);\n    ctx.lineTo(screenX, height - 20);\n    ctx.stroke();\n\n    // Draw Optical Axis\n    ctx.strokeStyle = '#333';\n    ctx.setLineDash([5, 5]);\n    ctx.beginPath();\n    ctx.moveTo(0, centerY);\n    ctx.lineTo(width, centerY);\n    ctx.stroke();\n    ctx.setLineDash([]);\n\n    // 2. Visualize Slits\n    // Since actual d is microscopic, we use a schematic representation width\n    const schematicGap = 20; \n    ctx.strokeStyle = '#fff';\n    ctx.lineWidth = 4;\n    \n    // Wall Top\n    ctx.beginPath();\n    ctx.moveTo(centerX, 0);\n    ctx.lineTo(centerX, centerY - schematicGap);\n    ctx.stroke();\n    \n    // Wall Middle\n    ctx.beginPath();\n    ctx.moveTo(centerX, centerY - 2); // Small blockage in middle\n    ctx.lineTo(centerX, centerY + 2);\n    ctx.stroke();\n\n    // Wall Bottom\n    ctx.beginPath();\n    ctx.moveTo(centerX, centerY + schematicGap);\n    ctx.lineTo(centerX, height);\n    ctx.stroke();\n\n    // 3. Draw Wave Animation (Schematic)\n    // We draw arcs emanating from the two schematic slits\n    if (state.isValid) {\n        ctx.lineWidth = 1;\n        // Color based on wavelength (approximate mapping for visual flair)\n        // Since lambda varies wildly, we just use a standard blue-cyan for logic\n        ctx.strokeStyle = 'rgba(79, 172, 254, 0.4)';\n        \n        const numWaves = 10;\n        const waveSpeed = 2; \n        const phase = (state.time * waveSpeed) % 20;\n\n        for (let i = 0; i < width; i+=20) {\n            let r = i + phase;\n            if(r > screenX - centerX) continue; // Don't draw past screen\n\n            // Top Slit Source\n            ctx.beginPath();\n            ctx.arc(centerX, centerY - 10, r, -Math.PI/2, Math.PI/2);\n            ctx.stroke();\n\n            // Bottom Slit Source\n            ctx.beginPath();\n            ctx.arc(centerX, centerY + 10, r, -Math.PI/2, Math.PI/2);\n            ctx.stroke();\n        }\n    }\n\n    // 4. Draw Intensity Pattern on Screen\n    drawIntensityProfile(width, height, screenX, centerY);\n\n    // 5. Draw First Order Max Ray (m=1)\n    if (state.isValid) {\n        drawGeometryRays(width, height, centerX, centerY, screenX);\n    }\n}\n\nfunction drawIntensityProfile(w, h, screenX, centerY) {\n    if (!state.isValid) return;\n\n    ctx.beginPath();\n    ctx.strokeStyle = '#ff5e62';\n    ctx.lineWidth = 2;\n\n    // We map the physical intensity function to the canvas pixels\n    // I = I0 * cos^2( (pi * d * sin(theta)) / lambda )\n    // On the screen, y = L * tan(theta). For small angles y ~ L*theta\n    // Phase difference phi = (2*pi*d*y) / (lambda * L)\n    \n    // Schematic Scaling:\n    // We cannot use real lambda/d for drawing because the ratio changes by orders of magnitude.\n    // We compute a \"visual frequency\" based on the ratio to show the effect.\n    // If lambda/d is small, fringes are close. If lambda/d is large, fringes are wide.\n    \n    let ratio = state.lambda / state.d;\n    \n    // Visual scaling factor to make the graph look nice on canvas\n    // A ratio of 0.1 should show several fringes. A ratio of 0.5 fewer.\n    const visualScale = 2000 * ratio; \n\n    for (let y = 0; y < h; y++) {\n        let dy = y - centerY; // Distance from center of screen in pixels\n        \n        // Intensity formula adaptation for visualization\n        // The argument inside cos represents phase shift.\n        let intensity = Math.pow(Math.cos(dy / visualScale * Math.PI), 2);\n        \n        // Draw the curve offset from the screen line\n        let xVal = screenX + (intensity * 40); // Amplitude of 40px\n        \n        if (y === 0) ctx.moveTo(xVal, y);\n        else ctx.lineTo(xVal, y);\n    }\n    ctx.stroke();\n    \n    // Fill the area\n    ctx.lineTo(screenX, h);\n    ctx.lineTo(screenX, 0);\n    ctx.fillStyle = 'rgba(255, 94, 98, 0.2)';\n    ctx.fill();\n}\n\nfunction drawGeometryRays(w, h, cx, cy, sx) {\n    // Calculate the Y position on the screen for m=1\n    // In physics: sin(theta) = lambda/d\n    // On canvas: we use the same schematic visualScale from drawIntensityProfile to ensure alignment\n    \n    let ratio = state.lambda / state.d;\n    \n    // We need to match the peak of the intensity graph we just drew.\n    // The first zero of cos^2(k*y) is at k*y = pi/2 -> y = pi/(2k).\n    // The first peak (m=1) is at k*y = pi -> y = pi/k.\n    // In drawIntensity, k = PI / visualScale.\n    // So Peak Y = visualScale.\n    \n    const visualScale = 2000 * ratio;\n    const yOffset = visualScale;\n\n    // Limit yOffset to stay within canvas for sanity\n    if (yOffset > h/2) return; // Off screen\n\n    const targetY_up = cy - yOffset;\n    \n    // Draw Ray Line\n    ctx.strokeStyle = '#ffd700'; // Gold\n    ctx.lineWidth = 1.5;\n    ctx.setLineDash([2, 2]);\n    \n    ctx.beginPath();\n    ctx.moveTo(cx, cy);\n    ctx.lineTo(sx, targetY_up);\n    ctx.stroke();\n    ctx.setLineDash([]);\n\n    // Draw Point on screen\n    ctx.fillStyle = '#ffd700';\n    ctx.beginPath();\n    ctx.arc(sx, targetY_up, 4, 0, Math.PI*2);\n    ctx.fill();\n\n    // Draw Label\n    ctx.fillStyle = '#fff';\n    ctx.font = '12px sans-serif';\n    ctx.fillText(`m=1 (${state.theta.toFixed(1)}°)`, sx + 10, targetY_up + 4);\n}\n\n// Start simulation\ninit();"}}
{"input": {"input_text": "Malus' law: I = I0*cos^2(theta). Compute transmitted intensity after polarizer at angle theta.", "simulation_name": " Malus Law", "domain": "Optics", "description": "Polarizer transmission", "assumptions": ["Ideal polarizer"], "entities": [], "constants": [], "parameters": [{"name": "incident_intensity", "symbol": "I0", "unit": "W/m^2", "range": [0, 10000.0]}, {"name": "angle", "symbol": "theta", "unit": "rad", "range": [0, 3.1416]}], "equations": [{"description": "Transmitted", "expression": "I = I0*cos(theta)^2"}], "initial_conditions": {}, "outputs": ["I"], "simulation_controls": ["I0", "theta"], "constraints": ["I0>=0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S63 Malus Law Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"simulation-container\">\n        <header>\n            <h1>Malus' Law Simulation</h1>\n            <p>Polarizer Transmission: $I = I_0 \\cos^2(\\theta)$</p>\n        </header>\n\n        <div class=\"canvas-wrapper\">\n            <canvas id=\"simCanvas\"></canvas>\n            <div class=\"labels\">\n                <span class=\"label-left\">Incident Light ($I_0$)</span>\n                <span class=\"label-center\">Polarizer ($\\theta$)</span>\n                <span class=\"label-right\">Transmitted Light ($I$)</span>\n            </div>\n        </div>\n\n        <div class=\"controls-section\">\n            <div class=\"control-group\">\n                <label for=\"i0-slider\">Incident Intensity ($I_0$): <span id=\"i0-val\">5000</span> $W/m^2$</label>\n                <input type=\"range\" id=\"i0-slider\" min=\"0\" max=\"10000\" step=\"100\" value=\"5000\">\n            </div>\n\n            <div class=\"control-group\">\n                <label for=\"theta-slider\">Angle ($\\theta$): <span id=\"theta-val\">0.00</span> rad (<span id=\"deg-val\">0</span>°)</label>\n                <input type=\"range\" id=\"theta-slider\" min=\"0\" max=\"3.1416\" step=\"0.01\" value=\"0\">\n            </div>\n        </div>\n\n        <div class=\"results-section\">\n            <div class=\"result-card\">\n                <h3>Transmitted Intensity ($I$)</h3>\n                <p class=\"big-number\"><span id=\"output-i\">5000.00</span> <small>W/m²</small></p>\n            </div>\n        </div>\n    </div>\n    \n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-color: #1a1a2e;\n    --card-bg: #16213e;\n    --accent-color: #0f3460;\n    --text-color: #e94560;\n    --light-text: #eaeaea;\n    --highlight: #fcd34d;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--light-text);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n    min-height: 100vh;\n}\n\n.simulation-container {\n    background-color: var(--card-bg);\n    border-radius: 12px;\n    box-shadow: 0 10px 30px rgba(0,0,0,0.5);\n    width: 100%;\n    max-width: 900px;\n    padding: 20px;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\nheader {\n    text-align: center;\n    border-bottom: 1px solid rgba(255,255,255,0.1);\n    padding-bottom: 10px;\n}\n\nheader h1 {\n    margin: 0;\n    font-size: 1.8rem;\n    color: var(--highlight);\n}\n\nheader p {\n    margin: 5px 0 0;\n    opacity: 0.8;\n}\n\n/* Canvas Area */\n.canvas-wrapper {\n    position: relative;\n    background: radial-gradient(circle at center, #252a41 0%, #111 100%);\n    border-radius: 8px;\n    border: 1px solid #333;\n    overflow: hidden;\n}\n\ncanvas {\n    display: block;\n    width: 100%;\n    height: 400px;\n}\n\n.labels {\n    display: flex;\n    justify-content: space-between;\n    padding: 5px 20px;\n    background: rgba(0,0,0,0.3);\n    font-size: 0.9rem;\n    color: #888;\n}\n\n/* Controls */\n.controls-section {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 20px;\n    background: rgba(0,0,0,0.2);\n    padding: 20px;\n    border-radius: 8px;\n}\n\n.control-group {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.control-group label {\n    font-weight: 600;\n}\n\ninput[type=\"range\"] {\n    -webkit-appearance: none;\n    width: 100%;\n    height: 8px;\n    background: #333;\n    border-radius: 5px;\n    outline: none;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    width: 20px;\n    height: 20px;\n    background: var(--text-color);\n    border-radius: 50%;\n    cursor: pointer;\n    transition: background 0.2s;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb:hover {\n    background: #ff6b81;\n}\n\n/* Results */\n.results-section {\n    display: flex;\n    justify-content: center;\n}\n\n.result-card {\n    background: var(--accent-color);\n    padding: 15px 40px;\n    border-radius: 8px;\n    text-align: center;\n    box-shadow: 0 4px 6px rgba(0,0,0,0.2);\n    border: 1px solid rgba(255,255,255,0.1);\n}\n\n.result-card h3 {\n    margin: 0 0 5px 0;\n    font-size: 1rem;\n    text-transform: uppercase;\n    letter-spacing: 1px;\n    opacity: 0.8;\n}\n\n.big-number {\n    font-size: 2.5rem;\n    font-weight: bold;\n    color: var(--highlight);\n    margin: 0;\n}\n\n.big-number small {\n    font-size: 1rem;\n    color: #ccc;\n    font-weight: normal;\n}\n\n/* Responsive */\n@media (max-width: 600px) {\n    .controls-section {\n        grid-template-columns: 1fr;\n    }\n}", "js": "// Canvas Setup\nconst canvas = document.getElementById('simCanvas');\nconst ctx = canvas.getContext('2d');\n\n// DOM Elements\nconst i0Slider = document.getElementById('i0-slider');\nconst thetaSlider = document.getElementById('theta-slider');\nconst i0Display = document.getElementById('i0-val');\nconst thetaDisplay = document.getElementById('theta-val');\nconst degDisplay = document.getElementById('deg-val');\nconst outputDisplay = document.getElementById('output-i');\n\n// State Variables\nlet state = {\n    I0: 5000,           // Incident Intensity\n    theta: 0,           // Angle in radians\n    I: 5000,            // Transmitted Intensity\n    time: 0             // For animation\n};\n\n// Resize Canvas\nfunction resizeCanvas() {\n    const parent = canvas.parentElement;\n    canvas.width = parent.clientWidth;\n    canvas.height = 400; // Fixed height for simulation\n}\n\nwindow.addEventListener('resize', resizeCanvas);\nresizeCanvas();\n\n// Constants for Visualization\nconst MAX_I0 = 10000;\nconst WAVE_SPEED = 0.1;\nconst FREQUENCY = 0.1;\nconst SCALE_FACTOR = 80; // Scale amplitude for drawing\n\n// Logic\nfunction calculate() {\n    // Malus' Law: I = I0 * cos^2(theta)\n    const cosTheta = Math.cos(state.theta);\n    state.I = state.I0 * (cosTheta * cosTheta);\n}\n\nfunction updateUI() {\n    i0Display.textContent = state.I0;\n    thetaDisplay.textContent = parseFloat(state.theta).toFixed(2);\n    degDisplay.textContent = (state.theta * (180 / Math.PI)).toFixed(0);\n    outputDisplay.textContent = state.I.toFixed(2);\n}\n\n// Drawing Helper: Draw Sine Wave\n// startX, endX: Horizontal bounds\n// amplitude: Wave height\n// angle: Rotation of the vibration plane (0 is vertical)\n// phase: Animation offset\nfunction drawWave(startX, endX, amplitude, angle, phase, color, opacity) {\n    ctx.beginPath();\n    ctx.strokeStyle = `rgba(${color}, ${opacity})`;\n    ctx.lineWidth = 3;\n\n    const centerY = canvas.height / 2;\n    const step = 2; // Pixel step for smoothness\n\n    // We draw the wave as if it's 3D projected onto 2D.\n    // A vertical wave (angle 0) oscillates in Y.\n    // A horizontal wave (angle PI/2) oscillates in Z (depth), which we simulate via perspective or just flat.\n    // To make it clear, we will rotate the drawing context.\n\n    // Save context to rotate for polarization angle\n    ctx.save();\n    \n    // We visualize the \"envelope\" of polarization by rotating the wave on the canvas plane\n    // This is a stylistic choice to show the angle clearly.\n    // In reality, it rotates around the propagation axis (Z), but here we map polarization angle to screen Y-X rotation\n    // so the user can \"see\" the angle physically.\n    \n    // However, rotating the whole wave path looks like the light is changing direction.\n    // Better visualization:\n    // The wave travels Left -> Right (X-axis).\n    // The vibration is in the Y-Z plane.\n    // We will draw the projection of the vibration onto the screen Y axis.\n    // Amplitude displayed = Real Amplitude * cos(visual_angle).\n    // But to show the \"twist\", we can draw \"slanted\" lines representing the field vectors.\n    \n    for (let x = startX; x <= endX; x += step) {\n        // Sine calculation\n        const k = 0.05; // Wave number\n        const yRaw = amplitude * Math.sin(k * (x - startX) - phase);\n        \n        // Apply rotation to the vector (x, y)\n        // Actually, the wave propagates in X. Displacement is in the plane perpendicular to X.\n        // Let's draw the displacement vector at the specific angle.\n        \n        const yDisp = yRaw * Math.cos(angle); // Project on Y\n        const xDisp = -yRaw * Math.sin(angle) * 0.3; // Project on X (foreshortened for pseudo-3D)\n        \n        // We add xDisp to current x, yDisp to centerY\n        if (x === startX) {\n            ctx.moveTo(x + xDisp, centerY + yDisp);\n        } else {\n            ctx.lineTo(x + xDisp, centerY + yDisp);\n        }\n    }\n    \n    ctx.stroke();\n    ctx.restore();\n}\n\n// Drawing Helper: Draw Polarizer Filter\nfunction drawPolarizer(x, angle) {\n    const centerY = canvas.height / 2;\n    const radius = 90;\n\n    ctx.save();\n    ctx.translate(x, centerY);\n    \n    // Outer Frame\n    ctx.beginPath();\n    ctx.arc(0, 0, radius, 0, Math.PI * 2);\n    ctx.fillStyle = 'rgba(50, 50, 60, 0.8)';\n    ctx.fill();\n    ctx.strokeStyle = '#888';\n    ctx.lineWidth = 4;\n    ctx.stroke();\n\n    // Rotate for the slit\n    ctx.rotate(angle);\n\n    // Draw Slit / Axis\n    ctx.beginPath();\n    ctx.moveTo(0, -radius);\n    ctx.lineTo(0, radius);\n    ctx.strokeStyle = 'rgba(255, 255, 255, 0.9)';\n    ctx.lineWidth = 2;\n    ctx.setLineDash([10, 5]);\n    ctx.stroke();\n    ctx.setLineDash([]);\n\n    // Draw Grating lines (aesthetic)\n    ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';\n    ctx.lineWidth = 1;\n    for(let i = -radius + 10; i < radius; i+=10) {\n        ctx.beginPath();\n        ctx.moveTo(i, -Math.sqrt(radius*radius - i*i));\n        ctx.lineTo(i, Math.sqrt(radius*radius - i*i));\n        ctx.stroke();\n    }\n\n    ctx.restore();\n}\n\nfunction draw() {\n    // Clear\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    const centerY = canvas.height / 2;\n    const polarizerX = canvas.width / 2;\n    \n    // Normalize Amplitude based on Max Intensity\n    // Amplitude is proportional to sqrt(Intensity)\n    const maxAmp = SCALE_FACTOR;\n    const inputAmp = Math.sqrt(state.I0 / MAX_I0) * maxAmp;\n    const outputAmp = Math.sqrt(state.I / MAX_I0) * maxAmp;\n\n    // 1. Draw Incident Wave (Left of Polarizer)\n    // Assume incident is vertically polarized (Angle = 0)\n    // To make it look \"unfiltered\", we sometimes draw chaotic waves, \n    // but the problem implies I0 is incident intensity. \n    // Usually Malus law implies I0 is the intensity of *polarized* light hitting the analyzer.\n    // So we draw a vertically polarized wave.\n    drawWave(0, polarizerX - 40, inputAmp, 0, state.time, \"255, 200, 0\", 1.0);\n\n    // Draw Light Beam (Glow effect background)\n    ctx.globalCompositeOperation = 'screen';\n    const grd = ctx.createLinearGradient(0, 0, canvas.width, 0);\n    grd.addColorStop(0, `rgba(255, 200, 0, ${state.I0/MAX_I0 * 0.2})`);\n    grd.addColorStop(0.5, `rgba(255, 200, 0, ${state.I0/MAX_I0 * 0.2})`);\n    grd.addColorStop(0.51, `rgba(255, 200, 0, ${state.I/MAX_I0 * 0.2})`);\n    grd.addColorStop(1, `rgba(255, 200, 0, ${state.I/MAX_I0 * 0.1})`);\n    ctx.fillStyle = grd;\n    ctx.fillRect(0, centerY - 100, canvas.width, 200);\n    ctx.globalCompositeOperation = 'source-over';\n\n    // 2. Draw Transmitted Wave (Right of Polarizer)\n    // Angle matches the polarizer angle\n    // Amplitude matches calculated I\n    drawWave(polarizerX + 40, canvas.width, outputAmp, state.theta, state.time, \"255, 200, 0\", 1.0);\n\n    // 3. Draw Polarizer\n    drawPolarizer(polarizerX, state.theta);\n    \n    // Draw Axis Arrows (Coordinate System Helper)\n    // Left side (Vertical)\n    if (state.I0 > 0) {\n        ctx.beginPath();\n        ctx.strokeStyle = \"#FFF\";\n        ctx.lineWidth = 2;\n        ctx.moveTo(50, centerY - inputAmp);\n        ctx.lineTo(50, centerY + inputAmp);\n        // Arrowheads\n        ctx.moveTo(45, centerY - inputAmp + 5);\n        ctx.lineTo(50, centerY - inputAmp);\n        ctx.lineTo(55, centerY - inputAmp + 5);\n        ctx.stroke();\n        ctx.fillStyle = \"#FFF\";\n        ctx.fillText(\"E0\", 45, centerY - inputAmp - 10);\n    }\n\n    // Right side (Rotated)\n    if (state.I > 0) {\n        const xBase = polarizerX + 100;\n        const xDisp = -outputAmp * Math.sin(state.theta) * 0.3;\n        const yDisp = outputAmp * Math.cos(state.theta);\n        \n        ctx.beginPath();\n        ctx.strokeStyle = \"#FFF\";\n        ctx.moveTo(xBase - xDisp, centerY - yDisp);\n        ctx.lineTo(xBase + xDisp, centerY + yDisp);\n        ctx.stroke();\n        ctx.fillText(\"E\", xBase, centerY - yDisp - 10);\n    }\n\n    // Update Animation Time\n    state.time += WAVE_SPEED;\n    \n    requestAnimationFrame(draw);\n}\n\n// Event Listeners\ni0Slider.addEventListener('input', (e) => {\n    state.I0 = parseFloat(e.target.value);\n    calculate();\n    updateUI();\n});\n\nthetaSlider.addEventListener('input', (e) => {\n    state.theta = parseFloat(e.target.value);\n    calculate();\n    updateUI();\n});\n\n// Initialization\ncalculate();\nupdateUI();\nrequestAnimationFrame(draw);"}}
{"input": {"input_text": "Doppler effect for sound moving source: f' = f*(c/(c - vs)). Compute observed frequency.", "simulation_name": " Doppler Sound", "domain": "Acoustics", "description": "Classical Doppler for moving source", "assumptions": ["Still observer"], "entities": [], "constants": [], "parameters": [{"name": "source_frequency", "symbol": "f", "unit": "Hz", "range": [10, 20000]}, {"name": "sound_speed", "symbol": "c", "unit": "m/s", "range": [300, 360]}, {"name": "source_speed", "symbol": "vs", "unit": "m/s", "range": [-100, 100]}], "equations": [{"description": "Observed frequency", "expression": "f_obs = f*(c/(c - vs))"}], "initial_conditions": {}, "outputs": ["f_obs"], "simulation_controls": ["f", "c", "vs"], "constraints": ["|vs|<c", "f>=0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S64 Doppler Sound Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n\n    <div class=\"simulation-container\">\n        <header>\n            <h1>S64 Doppler Sound</h1>\n            <p>Classical Doppler effect for a moving source and stationary observer.</p>\n        </header>\n\n        <div class=\"main-content\">\n            <div class=\"canvas-wrapper\">\n                <canvas id=\"simCanvas\"></canvas>\n                <div class=\"legend\">\n                    <span class=\"legend-item\"><span class=\"dot source-dot\"></span> Source</span>\n                    <span class=\"legend-item\"><span class=\"dot observer-dot\"></span> Observer</span>\n                </div>\n            </div>\n\n            <div class=\"controls-panel\">\n                <h2>Parameters</h2>\n                \n                <div class=\"control-group\">\n                    <label for=\"f_slider\">\n                        Source Frequency ($f$)\n                        <span class=\"value-display\" id=\"f_val\">440</span> Hz\n                    </label>\n                    <input type=\"range\" id=\"f_slider\" min=\"10\" max=\"20000\" step=\"10\" value=\"440\">\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"c_slider\">\n                        Speed of Sound ($c$)\n                        <span class=\"value-display\" id=\"c_val\">340</span> m/s\n                    </label>\n                    <input type=\"range\" id=\"c_slider\" min=\"300\" max=\"360\" step=\"1\" value=\"340\">\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"vs_slider\">\n                        Source Speed ($v_s$)\n                        <span class=\"value-display\" id=\"vs_val\">0</span> m/s\n                    </label>\n                    <input type=\"range\" id=\"vs_slider\" min=\"-100\" max=\"100\" step=\"1\" value=\"50\">\n                    <small class=\"note\">Positive = Moving towards observer</small>\n                </div>\n\n                <hr>\n\n                <div class=\"output-group\">\n                    <h2>Results</h2>\n                    <div class=\"equation\">\n                        $$f_{obs} = f \\left( \\frac{c}{c - v_s} \\right)$$\n                    </div>\n                    <div class=\"result-box\">\n                        <span class=\"label\">Observed Frequency ($f_{obs}$):</span>\n                        <span class=\"value\" id=\"f_obs_display\">--</span>\n                        <span class=\"unit\">Hz</span>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary-color: #3498db;\n    --accent-color: #e74c3c;\n    --observer-color: #2ecc71;\n    --bg-color: #f4f4f9;\n    --panel-bg: #ffffff;\n    --text-color: #333;\n    --canvas-bg: #1e1e1e;\n}\n\n* {\n    box-sizing: border-box;\n    margin: 0;\n    padding: 0;\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n}\n\nbody {\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    display: flex;\n    justify-content: center;\n    padding: 20px;\n}\n\n.simulation-container {\n    width: 100%;\n    max-width: 1000px;\n    background: var(--panel-bg);\n    border-radius: 12px;\n    box-shadow: 0 4px 20px rgba(0,0,0,0.1);\n    padding: 20px;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 20px;\n}\n\nheader h1 {\n    color: #2c3e50;\n    margin-bottom: 5px;\n}\n\n.main-content {\n    display: grid;\n    grid-template-columns: 2fr 1fr;\n    gap: 20px;\n}\n\n@media (max-width: 768px) {\n    .main-content {\n        grid-template-columns: 1fr;\n    }\n}\n\n/* Canvas Styling */\n.canvas-wrapper {\n    position: relative;\n    background: var(--canvas-bg);\n    border-radius: 8px;\n    overflow: hidden;\n    height: 400px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n\ncanvas {\n    width: 100%;\n    height: 100%;\n    display: block;\n}\n\n.legend {\n    position: absolute;\n    bottom: 10px;\n    left: 10px;\n    background: rgba(0,0,0,0.6);\n    padding: 8px;\n    border-radius: 4px;\n    color: #fff;\n    font-size: 0.85rem;\n}\n\n.legend-item {\n    margin-right: 15px;\n    display: inline-flex;\n    align-items: center;\n}\n\n.dot {\n    width: 10px;\n    height: 10px;\n    border-radius: 50%;\n    display: inline-block;\n    margin-right: 5px;\n}\n\n.source-dot { background-color: var(--accent-color); }\n.observer-dot { background-color: var(--observer-color); }\n\n/* Controls Styling */\n.controls-panel {\n    background: #f8f9fa;\n    padding: 20px;\n    border-radius: 8px;\n    border: 1px solid #eee;\n}\n\n.controls-panel h2 {\n    font-size: 1.2rem;\n    margin-bottom: 15px;\n    border-bottom: 2px solid #ddd;\n    padding-bottom: 5px;\n}\n\n.control-group {\n    margin-bottom: 20px;\n}\n\n.control-group label {\n    display: block;\n    margin-bottom: 8px;\n    font-weight: 600;\n    font-size: 0.9rem;\n}\n\n.value-display {\n    color: var(--primary-color);\n    font-weight: bold;\n    margin-left: 5px;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    cursor: pointer;\n}\n\n.note {\n    display: block;\n    font-size: 0.75rem;\n    color: #666;\n    margin-top: 4px;\n}\n\nhr {\n    border: 0;\n    border-top: 1px solid #ddd;\n    margin: 20px 0;\n}\n\n/* Output Styling */\n.equation {\n    text-align: center;\n    margin-bottom: 15px;\n    font-size: 1.1rem;\n}\n\n.result-box {\n    background: var(--primary-color);\n    color: white;\n    padding: 15px;\n    border-radius: 8px;\n    text-align: center;\n}\n\n.result-box .label {\n    display: block;\n    font-size: 0.9rem;\n    opacity: 0.9;\n    margin-bottom: 5px;\n}\n\n.result-box .value {\n    font-size: 1.8rem;\n    font-weight: bold;\n}\n\n.result-box .unit {\n    font-size: 1rem;\n    opacity: 0.9;\n}", "js": "// Configuration & State\nconst state = {\n    f: 440,      // Source frequency (Hz)\n    c: 340,      // Speed of sound (m/s)\n    vs: 50,      // Source speed (m/s)\n    f_obs: 0     // Observed frequency\n};\n\n// Canvas Setup\nconst canvas = document.getElementById('simCanvas');\nconst ctx = canvas.getContext('2d');\nlet animationId;\n\n// Physics Constants for Visualization\nconst PIXELS_PER_METER = 0.5; // Scale: 1 meter = 0.5 pixels\nconst VISUAL_TIME_SCALE = 0.02; // Slow down physics for visual clarity\n\n// Simulation Entities\nlet waves = [];\nlet source = { x: 0, y: 0 };\nlet observer = { x: 0, y: 0 };\nlet lastEmissionTime = 0;\n\n// DOM Elements\nconst els = {\n    f: document.getElementById('f_slider'),\n    c: document.getElementById('c_slider'),\n    vs: document.getElementById('vs_slider'),\n    f_val: document.getElementById('f_val'),\n    c_val: document.getElementById('c_val'),\n    vs_val: document.getElementById('vs_val'),\n    out: document.getElementById('f_obs_display')\n};\n\n// Initialization\nfunction init() {\n    resizeCanvas();\n    window.addEventListener('resize', resizeCanvas);\n    \n    // Initial positions\n    observer.x = canvas.width * 0.8; // Observer sits at 80% width\n    observer.y = canvas.height / 2;\n    source.x = canvas.width * 0.2;   // Source starts at 20% width\n    source.y = canvas.height / 2;\n\n    // Add Listeners\n    setupListeners();\n    \n    // Start Loop\n    calculate();\n    animate();\n}\n\nfunction resizeCanvas() {\n    const parent = canvas.parentElement;\n    canvas.width = parent.clientWidth;\n    canvas.height = parent.clientHeight;\n    \n    // Reset positions on resize\n    observer.x = canvas.width * 0.8;\n    observer.y = canvas.height / 2;\n}\n\nfunction setupListeners() {\n    // Helper to update state and UI\n    const updateHandler = (key, elId, valId) => (e) => {\n        state[key] = parseFloat(e.target.value);\n        document.getElementById(valId).textContent = state[key];\n        calculate();\n    };\n\n    els.f.addEventListener('input', updateHandler('f', 'f_slider', 'f_val'));\n    els.c.addEventListener('input', updateHandler('c', 'c_slider', 'c_val'));\n    els.vs.addEventListener('input', updateHandler('vs', 'vs_slider', 'vs_val'));\n}\n\n// ---------------------------------------------------------\n// Physics & Calculation Engine\n// ---------------------------------------------------------\n\nfunction calculate() {\n    // Formula: f_obs = f * (c / (c - vs))\n    // Note: vs is input as positive towards observer.\n    \n    // Validation constraint check: |vs| < c\n    if (Math.abs(state.vs) >= state.c) {\n        els.out.textContent = \"Error (|vs| >= c)\";\n        return;\n    }\n\n    // Calculate\n    const val = state.f * (state.c / (state.c - state.vs));\n    state.f_obs = val;\n\n    // Display formatted\n    els.out.textContent = val.toFixed(2);\n}\n\n// ---------------------------------------------------------\n// Animation Loop\n// ---------------------------------------------------------\n\nfunction animate(timestamp) {\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    \n    // 1. Update Source Position\n    // We move the source based on vs. \n    // To keep it in view, if it goes too far right, wrap to left.\n    // Movement logic: pixel_speed = real_speed * scale * dt\n    // We assume a constant roughly 60fps for simple delta here, or use timestamp\n    \n    // Move Source\n    source.x += state.vs * PIXELS_PER_METER * VISUAL_TIME_SCALE;\n\n    // Wrap Logic: If source passes observer significantly or goes off screen\n    if (source.x > canvas.width + 100) {\n        source.x = -50; \n    } else if (source.x < -100) {\n        source.x = canvas.width + 50;\n    }\n\n    // 2. Manage Waves\n    // Emission rate: For visualization, we can't draw 20,000 circles.\n    // We map Freq (10-20k) to a visual pulse interval (e.g., 500ms - 50ms)\n    // Higher F = Faster visual pulses, but clamped.\n    \n    // Map frequency 10..20000 to period 800..50 (arbitrary visual units)\n    // Logarithmic mapping feels better for frequency\n    const minPeriod = 5;  // High freq\n    const maxPeriod = 60; // Low freq\n    // Simple linear interpolation for emission threshold\n    // t = max - ( (f - minF)/(maxF - minF) ) * (max - min)\n    const normF = (state.f - 10) / (20000 - 10);\n    const emissionThreshold = maxPeriod - (normF * (maxPeriod - minPeriod));\n\n    lastEmissionTime++;\n    if (lastEmissionTime > emissionThreshold) {\n        // Emit wave\n        waves.push({\n            x: source.x,\n            y: source.y,\n            r: 0,\n            opacity: 1\n        });\n        lastEmissionTime = 0;\n    }\n\n    // Update and Draw Waves\n    for (let i = waves.length - 1; i >= 0; i--) {\n        let w = waves[i];\n        \n        // Expand wave: radius increases by speed of sound (c)\n        w.r += state.c * PIXELS_PER_METER * VISUAL_TIME_SCALE;\n        \n        // Fade out as it gets huge\n        if (w.r > canvas.width) {\n            w.opacity -= 0.01;\n        }\n\n        // Remove dead waves\n        if (w.opacity <= 0) {\n            waves.splice(i, 1);\n            continue;\n        }\n\n        // Draw Wave\n        ctx.beginPath();\n        ctx.arc(w.x, w.y, w.r, 0, Math.PI * 2);\n        ctx.strokeStyle = `rgba(52, 152, 219, ${w.opacity})`; // Blueish\n        ctx.lineWidth = 2;\n        ctx.stroke();\n    }\n\n    // 3. Draw Entities\n    \n    // Draw Observer (Stationary)\n    ctx.beginPath();\n    ctx.arc(observer.x, observer.y, 8, 0, Math.PI * 2);\n    ctx.fillStyle = '#2ecc71'; // Green\n    ctx.fill();\n    // Observer Label\n    ctx.fillStyle = '#fff';\n    ctx.font = '12px Arial';\n    ctx.fillText(\"Observer\", observer.x - 20, observer.y + 25);\n\n    // Draw Source (Moving)\n    ctx.beginPath();\n    ctx.arc(source.x, source.y, 8, 0, Math.PI * 2);\n    ctx.fillStyle = '#e74c3c'; // Red\n    ctx.fill();\n    \n    // Velocity Vector Indicator for Source\n    if (Math.abs(state.vs) > 1) {\n        ctx.beginPath();\n        ctx.moveTo(source.x, source.y);\n        const dir = state.vs > 0 ? 1 : -1;\n        const arrowLen = 30;\n        ctx.lineTo(source.x + (arrowLen * dir), source.y);\n        ctx.strokeStyle = '#fff';\n        ctx.lineWidth = 2;\n        ctx.stroke();\n        \n        // Arrowhead\n        ctx.beginPath();\n        ctx.moveTo(source.x + (arrowLen * dir), source.y);\n        ctx.lineTo(source.x + ((arrowLen - 5) * dir), source.y - 5);\n        ctx.lineTo(source.x + ((arrowLen - 5) * dir), source.y + 5);\n        ctx.fillStyle = '#fff';\n        ctx.fill();\n    }\n\n    animationId = requestAnimationFrame(animate);\n}\n\n// Start\ninit();"}}
{"input": {"input_text": "Relativistic Doppler for light source moving away: f' = f*sqrt((1 - beta)/(1 + beta)) where beta = v/c.", "simulation_name": " Doppler Light", "domain": "Relativity", "description": "Relativistic longitudinal Doppler", "assumptions": ["In vacuum"], "entities": [], "constants": [{"name": "speed_of_light", "symbol": "c", "value": 300000000.0, "unit": "m/s"}], "parameters": [{"name": "source_frequency", "symbol": "f", "unit": "Hz", "range": [1000000.0, 1e+20]}, {"name": "source_speed", "symbol": "v", "unit": "m/s", "range": [0, 290000000.0]}], "equations": [{"description": "Beta", "expression": "beta = v/c"}, {"description": "Observed frequency", "expression": "f_obs = f*sqrt((1 - beta)/(1 + beta))"}], "initial_conditions": {}, "outputs": ["f_obs"], "simulation_controls": ["f", "v"], "constraints": ["0<=v<c"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S65 Doppler Light Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"container\">\n    <header>\n        <h1>Relativistic Doppler Effect</h1>\n        <p>Simulation of a light source moving away from an observer (Longitudinal Doppler Shift).</p>\n    </header>\n\n    <div class=\"simulation-layout\">\n        \n        <aside class=\"controls\">\n            <div class=\"control-group\">\n                <h3>Parameters</h3>\n                <label for=\"speedInput\">\n                    Source Speed ($v$)\n                    <span class=\"tooltip\">Velocity relative to observer</span>\n                </label>\n                <input type=\"range\" id=\"speedInput\" min=\"-299000000\" max=\"299000000\" step=\"1000000\" value=\"0\">\n                <div class=\"value-display\">\n                    <span id=\"speedValue\">0</span> m/s (<span id=\"betaValue\">0.00</span> $c$)\n                </div>\n            </div>\n\n            <div class=\"control-group\">\n                <label for=\"freqInput\">\n                    Source Frequency ($f_{source}$)\n                    <span class=\"tooltip\">Emitted frequency</span>\n                </label>\n                <input type=\"range\" id=\"freqInput\" min=\"14\" max=\"15.5\" step=\"0.01\" value=\"14.7\"> \n                <div class=\"value-display\">\n                    <span id=\"freqValue\">5.00e14</span> Hz\n                </div>\n            </div>\n\n            <div class=\"output-panel\">\n                <h3>Calculated Outputs</h3>\n                <div class=\"equation\">\n                    $$ f_{obs} = f_{source} \\sqrt{\\frac{1 - \\beta}{1 + \\beta}} $$\n                </div>\n                <div class=\"result-box\">\n                    <label>Observed Frequency ($f_{obs}$):</label>\n                    <span id=\"obsFreqValue\" class=\"highlight\">--</span> Hz\n                </div>\n                <div class=\"result-box\">\n                    <label>Doppler Shift:</label>\n                    <span id=\"shiftType\" class=\"highlight\">None</span>\n                </div>\n            </div>\n            \n            <button id=\"resetBtn\">Reset Source</button>\n        </aside>\n\n        <main class=\"canvas-container\">\n            <canvas id=\"simCanvas\"></canvas>\n            <div class=\"legend\">\n                <div class=\"legend-item\"><span class=\"dot obs\"></span> Observer</div>\n                <div class=\"legend-item\"><span class=\"dot src\"></span> Moving Source</div>\n                <div class=\"legend-item\"><span class=\"line wave\"></span> Light Wavefront</div>\n            </div>\n        </main>\n\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-color: #121212;\n    --surface-color: #1e1e1e;\n    --primary-color: #4CAF50;\n    --accent-color: #2196F3;\n    --text-color: #e0e0e0;\n    --secondary-text: #b0b0b0;\n    --border-color: #333;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n    min-height: 100vh;\n}\n\n.container {\n    width: 100%;\n    max-width: 1200px;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\nheader {\n    text-align: center;\n    border-bottom: 1px solid var(--border-color);\n    padding-bottom: 10px;\n}\n\nheader h1 {\n    margin: 0;\n    font-size: 1.8rem;\n    color: var(--accent-color);\n}\n\nheader p {\n    color: var(--secondary-text);\n    margin: 5px 0 0;\n}\n\n.simulation-layout {\n    display: grid;\n    grid-template-columns: 300px 1fr;\n    gap: 20px;\n}\n\n/* Controls Styling */\n.controls {\n    background-color: var(--surface-color);\n    padding: 20px;\n    border-radius: 8px;\n    border: 1px solid var(--border-color);\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.control-group {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\nlabel {\n    font-weight: 600;\n    font-size: 0.9rem;\n    display: flex;\n    justify-content: space-between;\n}\n\n.tooltip {\n    font-size: 0.75rem;\n    color: var(--secondary-text);\n    font-weight: normal;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    cursor: pointer;\n}\n\n.value-display {\n    font-family: 'Courier New', monospace;\n    font-size: 0.9rem;\n    color: var(--primary-color);\n    text-align: right;\n}\n\n/* Output Panel */\n.output-panel {\n    background-color: #252525;\n    padding: 15px;\n    border-radius: 6px;\n    border-top: 3px solid var(--accent-color);\n}\n\n.output-panel h3 {\n    margin-top: 0;\n    font-size: 1rem;\n    color: var(--secondary-text);\n}\n\n.equation {\n    margin: 10px 0;\n    font-size: 0.9rem;\n    color: var(--secondary-text);\n    text-align: center;\n}\n\n.result-box {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 8px;\n    font-size: 0.9rem;\n}\n\n.highlight {\n    font-weight: bold;\n    color: var(--accent-color);\n}\n\n#resetBtn {\n    background-color: var(--border-color);\n    color: white;\n    border: none;\n    padding: 10px;\n    border-radius: 4px;\n    cursor: pointer;\n    transition: background 0.2s;\n}\n\n#resetBtn:hover {\n    background-color: #444;\n}\n\n/* Canvas Area */\n.canvas-container {\n    background-color: black;\n    border-radius: 8px;\n    border: 1px solid var(--border-color);\n    position: relative;\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n}\n\ncanvas {\n    display: block;\n    width: 100%;\n    height: 100%;\n    background: radial-gradient(circle at left, #0a0a0a, #000);\n}\n\n.legend {\n    position: absolute;\n    bottom: 10px;\n    right: 10px;\n    display: flex;\n    gap: 15px;\n    background: rgba(0, 0, 0, 0.7);\n    padding: 5px 10px;\n    border-radius: 4px;\n    font-size: 0.8rem;\n    color: var(--secondary-text);\n}\n\n.dot {\n    display: inline-block;\n    width: 10px;\n    height: 10px;\n    border-radius: 50%;\n    margin-right: 5px;\n}\n\n.dot.obs { background-color: #4CAF50; }\n.dot.src { background-color: white; }\n.line.wave {\n    display: inline-block;\n    width: 20px;\n    height: 2px;\n    background-color: #555;\n    vertical-align: middle;\n    margin-right: 5px;\n}\n\n@media (max-width: 800px) {\n    .simulation-layout {\n        grid-template-columns: 1fr;\n    }\n    .canvas-container {\n        height: 400px;\n    }\n}", "js": "/**\n * S65 Doppler Light Simulation\n * Simulates Relativistic Longitudinal Doppler Effect\n */\n\n// --- Constants & Globals ---\nconst C_REAL = 3e8; // Speed of light in m/s\nconst CANVAS_C = 4; // Simulation speed of light (pixels per frame)\n\n// State\nlet v_real = 0;     // Current velocity in m/s\nlet f_source = 0;   // Current frequency in Hz\nlet beta = 0;       // v/c\nlet f_obs = 0;      // Observed frequency\n\n// Animation State\nlet sourceX = 100;      // Starting X position of source\nconst OBSERVER_X = 50;  // X position of observer\nlet waves = [];         // Array to store emitted wavefronts\nlet lastEmissionTime = 0;\nlet animationId;\n\n// DOM Elements\nconst canvas = document.getElementById('simCanvas');\nconst ctx = canvas.getContext('2d');\nconst speedInput = document.getElementById('speedInput');\nconst freqInput = document.getElementById('freqInput');\nconst speedValDisplay = document.getElementById('speedValue');\nconst betaValDisplay = document.getElementById('betaValue');\nconst freqValDisplay = document.getElementById('freqValue');\nconst obsFreqValDisplay = document.getElementById('obsFreqValue');\nconst shiftTypeDisplay = document.getElementById('shiftType');\nconst resetBtn = document.getElementById('resetBtn');\n\n// --- Initialization ---\n\nfunction resizeCanvas() {\n    canvas.width = canvas.parentElement.clientWidth;\n    canvas.height = canvas.parentElement.clientHeight || 500;\n}\n\nwindow.addEventListener('resize', resizeCanvas);\nresizeCanvas();\n\n// --- Core Physics Calculation ---\n\nfunction updateCalculations() {\n    // 1. Get Inputs\n    v_real = parseFloat(speedInput.value);\n    \n    // Logarithmic slider handling for frequency to cover large range\n    // Slider value is exponent x (10^x)\n    const exponent = parseFloat(freqInput.value);\n    f_source = Math.pow(10, exponent);\n\n    // 2. Calculate Beta\n    beta = v_real / C_REAL;\n\n    // 3. Calculate Observed Frequency\n    // Relativistic Doppler Formula for source moving away:\n    // f_obs = f * sqrt((1 - beta) / (1 + beta))\n    const dopplerFactor = Math.sqrt((1 - beta) / (1 + beta));\n    f_obs = f_source * dopplerFactor;\n\n    // 4. Update UI Text\n    speedValDisplay.textContent = v_real.toExponential(2);\n    betaValDisplay.textContent = beta.toFixed(3);\n\n    if (v_real < -1000) { // Moving towards (allow small buffer for 0)\n        shiftTypeDisplay.textContent = \"Blueshift\";\n        shiftTypeDisplay.style.color = \"#2196F3\"; // Blue color\n    } else if (v_real > 1000) { // Moving away\n        shiftTypeDisplay.textContent = \"Redshift\";\n        shiftTypeDisplay.style.color = \"#ff4444\"; // Red color\n    } else {\n        shiftTypeDisplay.textContent = \"None\";\n        shiftTypeDisplay.style.color = \"#ccc\";\n    }\n    \n    freqValDisplay.textContent = f_source.toExponential(2);\n    obsFreqValDisplay.textContent = f_obs.toExponential(2);\n}\n\n// --- Visual Mapping Helper ---\n\n// Returns a color based on the ratio of f_obs / f_source\n// 1.0 = Green (No shift), <1.0 = Redder, >1.0 = Bluer\nfunction getDopplerColor(ratio) {\n    // Standard Green (120)\n    let hue = 120;\n    \n    if (ratio > 1.0) {\n        // Blueshift: Ratio > 1. Map to Blue/Violet (approx 260)\n        // We scale it so a 2x frequency shift hits max blue\n        hue = 120 + (ratio - 1) * 140; \n        if (hue > 260) hue = 260; // Cap at Violet\n    } else {\n        // Redshift: Ratio < 1. Map to Red (0)\n        hue = 120 * Math.pow(ratio, 3);\n    }\n    \n    return `hsl(${hue}, 100%, 50%)`;\n}\n\n// --- Animation Loop ---\n\nfunction animate(timestamp) {\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    // 1. Draw Observer\n    ctx.fillStyle = '#4CAF50';\n    ctx.beginPath();\n    ctx.arc(OBSERVER_X, canvas.height / 2, 8, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.fillStyle = '#fff';\n    ctx.font = '12px Arial';\n    ctx.fillText(\"Observer\", OBSERVER_X - 25, canvas.height / 2 + 25);\n\n    // 2. Update Source Position\n    // Map real beta to simulation pixels\n    // v_sim = beta * c_sim\n    const v_sim = beta * CANVAS_C;\n    sourceX += v_sim;\n\n    // Loop source if it goes off screen\n    if (sourceX > canvas.width + 100) {\n        sourceX = OBSERVER_X + 50; // Reset near observer\n        waves = []; // Clear waves to avoid visual confusion on reset\n    }\n\n    // 3. Emit Waves\n    // We visually emit waves at a rate proportional to f_source\n    // But for visual clarity, we cap the rate so the screen isn't just white noise.\n    // We define a base period in frames.\n    \n    // Visual spacing (wavelength) = c / f. \n    // Higher f = smaller period.\n    // We normalize f_source range (1e14 - 1e16 approx for visible) to a visual emission interval.\n    // Since range is 1e6 to 1e20, we just use a fixed base emission rate for the \"concept\",\n    // relying on the velocity to show the Doppler effect (wavelength stretching).\n    \n    const emissionPeriod = 20; // Frames between emissions (base)\n    // Note: In this specific simulation, we don't change emission rate based on f_source\n    // slider because the dynamic range is too huge to visualize. \n    // We visualize the *shift* caused by velocity. The f_source slider updates the math values.\n\n    if (timestamp - lastEmissionTime > emissionPeriod * 16) { // approx ms conversion\n        waves.push({\n            x: sourceX,           // Center of the wave is where source WAS\n            y: canvas.height / 2,\n            r: 0,\n            id: Date.now()\n        });\n        lastEmissionTime = timestamp;\n    }\n\n    // 4. Draw and Update Waves\n    // Calculate current doppler ratio for coloring\n    const ratio = Math.sqrt((1 - beta) / (1 + beta));\n    const waveColor = getDopplerColor(ratio);\n\n    for (let i = waves.length - 1; i >= 0; i--) {\n        let w = waves[i];\n        \n        // Expand wave\n        w.r += CANVAS_C;\n\n        // Draw\n        ctx.beginPath();\n        ctx.arc(w.x, w.y, w.r, 0, Math.PI * 2);\n        \n        // Visual Logic: \n        // Waves propagating LEFT towards observer are redshifted.\n        // We draw the whole circle with the shifted color for simplicity, \n        // or we could gradient it. Let's use the shifted color for the whole wave \n        // to clearly indicate the \"Received\" frequency state relative to that velocity.\n        ctx.strokeStyle = waveColor;\n        ctx.lineWidth = 2;\n        ctx.globalAlpha = Math.max(0, 1 - w.r / (canvas.width * 1.2)); // Fade out\n        ctx.stroke();\n        ctx.globalAlpha = 1.0;\n\n        // Remove old waves\n        if (w.r > canvas.width * 1.5) {\n            waves.splice(i, 1);\n        }\n    }\n\n    // 5. Draw Source\n    ctx.fillStyle = '#fff';\n    ctx.beginPath();\n    ctx.arc(sourceX, canvas.height / 2, 6, 0, Math.PI * 2);\n    ctx.fill();\n    \n    // Draw Velocity Vector\n    if (beta > 0) {\n        ctx.strokeStyle = '#fff';\n        ctx.beginPath();\n        ctx.moveTo(sourceX, canvas.height / 2);\n        ctx.lineTo(sourceX + (beta * 50) + 10, canvas.height / 2); // Scale arrow\n        ctx.stroke();\n        // Arrowhead\n        ctx.beginPath();\n        ctx.moveTo(sourceX + (beta * 50) + 10, canvas.height / 2);\n        ctx.lineTo(sourceX + (beta * 50), canvas.height / 2 - 3);\n        ctx.lineTo(sourceX + (beta * 50), canvas.height / 2 + 3);\n        ctx.fill();\n    }\n\n    animationId = requestAnimationFrame(animate);\n}\n\n// --- Event Listeners ---\n\nspeedInput.addEventListener('input', updateCalculations);\nfreqInput.addEventListener('input', updateCalculations);\n\nresetBtn.addEventListener('click', () => {\n    sourceX = OBSERVER_X + 50;\n    waves = [];\n});\n\n// --- Start ---\nupdateCalculations();\nrequestAnimationFrame(animate);"}}
{"input": {"input_text": "Time dilation: moving clock runs slower by factor gamma = 1/sqrt(1 - beta^2). Compute proper vs coordinate time.", "simulation_name": " Time Dilation", "domain": "Relativity", "description": "Special relativity time dilation", "assumptions": ["Inertial frames"], "entities": [], "constants": [{"name": "speed_of_light", "symbol": "c", "value": 300000000.0, "unit": "m/s"}], "parameters": [{"name": "relative_speed", "symbol": "v", "unit": "m/s", "range": [0, 290000000.0]}, {"name": "proper_time", "symbol": "tau", "unit": "s", "range": [0, 1000000.0]}], "equations": [{"description": "Gamma", "expression": "gamma = 1/sqrt(1 - (v/c)^2)"}, {"description": "Coordinate time", "expression": "t = gamma*tau"}], "initial_conditions": {}, "outputs": ["gamma", "t"], "simulation_controls": ["v", "tau"], "constraints": ["0<=v<c"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S66 Time Dilation Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1>S66 Time Dilation</h1>\n            <p>Explore how time slows down for a moving object relative to a stationary observer.</p>\n        </header>\n\n        <main class=\"sim-layout\">\n            <section class=\"controls-panel\">\n                <h2>Parameters</h2>\n                \n                <div class=\"control-group\">\n                    <label for=\"velocity-slider\">\n                        Relative Speed ($v$) <span class=\"unit\">(m/s)</span>\n                    </label>\n                    <input type=\"range\" id=\"velocity-slider\" min=\"0\" max=\"299000000\" step=\"100000\" value=\"0\">\n                    <div class=\"value-display\">\n                        <span id=\"velocity-val\">0</span> m/s \n                        <span class=\"secondary-val\">(<span id=\"beta-val\">0.00</span>$c$)</span>\n                    </div>\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"time-slider\">\n                        Proper Time ($\\tau$) <span class=\"unit\">(s)</span>\n                    </label>\n                    <input type=\"range\" id=\"time-slider\" min=\"1\" max=\"60\" step=\"1\" value=\"10\">\n                    <div class=\"value-display\">\n                        <span id=\"time-val\">10</span> s\n                    </div>\n                </div>\n\n                <div class=\"equations-box\">\n                    <h3>Equations</h3>\n                    <div class=\"math-row\">\n                        $$ \\gamma = \\frac{1}{\\sqrt{1 - \\beta^2}} $$\n                    </div>\n                    <div class=\"math-row\">\n                        $$ t = \\gamma \\tau $$\n                    </div>\n                    <p class=\"small\">Where $\\beta = v/c$ and $c \\approx 3 \\times 10^8$ m/s.</p>\n                </div>\n            </section>\n\n            <section class=\"visualization-panel\">\n                <div class=\"canvas-container\">\n                    <canvas id=\"simCanvas\"></canvas>\n                    \n                    <div class=\"clock-labels\">\n                        <div class=\"label-stationary\">Stationary Frame<br>(Observer)</div>\n                        <div class=\"label-moving\">Moving Frame<br>(Rocket)</div>\n                    </div>\n                </div>\n\n                <div class=\"results-panel\">\n                    <div class=\"result-card\">\n                        <span class=\"label\">Lorentz Factor ($\\gamma$)</span>\n                        <span class=\"value\" id=\"gamma-result\">1.000</span>\n                    </div>\n                    <div class=\"result-card highlight\">\n                        <span class=\"label\">Coordinate Time ($t$)</span>\n                        <span class=\"value\" id=\"coord-time-result\">10.00 s</span>\n                        <span class=\"description\">Time elapsed for stationary observer</span>\n                    </div>\n                </div>\n            </section>\n        </main>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary-color: #3b82f6;\n    --secondary-color: #1e293b;\n    --accent-color: #ef4444;\n    --bg-color: #f8fafc;\n    --panel-bg: #ffffff;\n    --text-color: #334155;\n    --border-radius: 12px;\n}\n\nbody {\n    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n}\n\n.container {\n    max-width: 1200px;\n    width: 100%;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 30px;\n}\n\nheader h1 {\n    color: var(--secondary-color);\n    margin: 0 0 10px 0;\n}\n\n.sim-layout {\n    display: grid;\n    grid-template-columns: 350px 1fr;\n    gap: 25px;\n}\n\n/* Controls Panel */\n.controls-panel {\n    background: var(--panel-bg);\n    padding: 25px;\n    border-radius: var(--border-radius);\n    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n    height: fit-content;\n}\n\n.controls-panel h2 {\n    margin-top: 0;\n    font-size: 1.25rem;\n    border-bottom: 2px solid #e2e8f0;\n    padding-bottom: 10px;\n    margin-bottom: 20px;\n}\n\n.control-group {\n    margin-bottom: 25px;\n}\n\nlabel {\n    display: block;\n    font-weight: 600;\n    margin-bottom: 8px;\n    font-size: 0.95rem;\n}\n\n.unit {\n    color: #64748b;\n    font-weight: normal;\n    font-size: 0.85rem;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    height: 6px;\n    background: #e2e8f0;\n    border-radius: 5px;\n    outline: none;\n    -webkit-appearance: none;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    width: 18px;\n    height: 18px;\n    background: var(--primary-color);\n    border-radius: 50%;\n    cursor: pointer;\n    transition: background .15s ease-in-out;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb:hover {\n    background: #2563eb;\n}\n\n.value-display {\n    margin-top: 8px;\n    font-family: 'Courier New', monospace;\n    font-weight: bold;\n    color: var(--secondary-color);\n    text-align: right;\n}\n\n.secondary-val {\n    color: #64748b;\n    font-size: 0.9em;\n}\n\n.equations-box {\n    background: #f1f5f9;\n    padding: 15px;\n    border-radius: 8px;\n    margin-top: 30px;\n    border-left: 4px solid var(--primary-color);\n}\n\n.equations-box h3 {\n    margin-top: 0;\n    font-size: 1rem;\n    color: var(--secondary-color);\n}\n\n.math-row {\n    margin: 10px 0;\n    text-align: center;\n}\n\n.small {\n    font-size: 0.8rem;\n    color: #64748b;\n    margin-top: 10px;\n    line-height: 1.4;\n}\n\n/* Visualization Panel */\n.visualization-panel {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.canvas-container {\n    background: #0f172a; /* Dark space background */\n    border-radius: var(--border-radius);\n    position: relative;\n    overflow: hidden;\n    height: 400px;\n    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n}\n\ncanvas {\n    display: block;\n    width: 100%;\n    height: 100%;\n}\n\n.clock-labels {\n    position: absolute;\n    top: 15px;\n    width: 100%;\n    display: flex;\n    justify-content: space-around;\n    pointer-events: none;\n    color: white;\n    font-weight: bold;\n    text-shadow: 0 2px 4px rgba(0,0,0,0.8);\n    font-size: 0.9rem;\n    text-align: center;\n}\n\n/* Results Panel */\n.results-panel {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 20px;\n}\n\n.result-card {\n    background: var(--panel-bg);\n    padding: 20px;\n    border-radius: var(--border-radius);\n    box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    text-align: center;\n}\n\n.result-card.highlight {\n    background: #eff6ff;\n    border: 1px solid #bfdbfe;\n}\n\n.result-card .label {\n    font-size: 0.9rem;\n    color: #64748b;\n    margin-bottom: 5px;\n    font-weight: 600;\n}\n\n.result-card .value {\n    font-size: 2rem;\n    font-weight: bold;\n    color: var(--secondary-color);\n}\n\n.result-card.highlight .value {\n    color: var(--primary-color);\n}\n\n.description {\n    font-size: 0.8rem;\n    color: #94a3b8;\n    margin-top: 5px;\n}\n\n/* Responsive adjustments */\n@media (max-width: 800px) {\n    .sim-layout {\n        grid-template-columns: 1fr;\n    }\n    \n    .results-panel {\n        grid-template-columns: 1fr;\n    }\n}", "js": "/**\n * S66 Time Dilation Simulation\n */\n\n// --- Constants ---\nconst C = 299792458; // Speed of light in m/s (exact)\nconst ANIMATION_FPS = 60;\n\n// --- State ---\nconst state = {\n    v: 0,           // Velocity (m/s)\n    tau_target: 10, // Target proper time (s)\n    \n    // Animation state\n    elapsed_tau: 0, // Running proper time (simulated seconds)\n    elapsed_t: 0,   // Running coordinate time (simulated seconds)\n    \n    // Computed values\n    beta: 0,\n    gamma: 1,\n    coordinate_time_total: 10,\n    \n    // Canvas context\n    canvas: null,\n    ctx: null,\n    width: 0,\n    height: 0,\n    stars: [], // Background stars\n};\n\n// --- DOM Elements ---\nconst els = {\n    vSlider: document.getElementById('velocity-slider'),\n    tSlider: document.getElementById('time-slider'),\n    vVal: document.getElementById('velocity-val'),\n    betaVal: document.getElementById('beta-val'),\n    timeVal: document.getElementById('time-val'),\n    gammaResult: document.getElementById('gamma-result'),\n    coordTimeResult: document.getElementById('coord-time-result'),\n    canvas: document.getElementById('simCanvas')\n};\n\n// --- Initialization ---\nfunction init() {\n    // Canvas Setup\n    state.canvas = els.canvas;\n    state.ctx = state.canvas.getContext('2d');\n    resizeCanvas();\n    window.addEventListener('resize', resizeCanvas);\n\n    // Initialize Stars\n    generateStars(100);\n\n    // Event Listeners\n    els.vSlider.addEventListener('input', updateParams);\n    els.tSlider.addEventListener('input', updateParams);\n\n    // Initial Calculation\n    updateParams();\n\n    // Start Loop\n    requestAnimationFrame(animate);\n}\n\nfunction resizeCanvas() {\n    const parent = state.canvas.parentElement;\n    state.canvas.width = parent.clientWidth;\n    state.canvas.height = parent.clientHeight;\n    state.width = state.canvas.width;\n    state.height = state.canvas.height;\n    generateStars(100); // Regenerate stars on resize\n}\n\nfunction generateStars(count) {\n    state.stars = [];\n    for (let i = 0; i < count; i++) {\n        state.stars.push({\n            x: Math.random() * state.width,\n            y: Math.random() * state.height,\n            size: Math.random() * 2,\n            opacity: Math.random()\n        });\n    }\n}\n\n// --- Physics & Updates ---\nfunction updateParams() {\n    // Read inputs\n    state.v = parseFloat(els.vSlider.value);\n    state.tau_target = parseFloat(els.tSlider.value);\n\n    // Update UI text\n    els.vVal.textContent = state.v.toLocaleString();\n    els.timeVal.textContent = state.tau_target;\n\n    // Calculate Physics\n    state.beta = state.v / C;\n    \n    // Clamp beta slightly below 1 to avoid Infinity\n    if (state.beta >= 1) state.beta = 0.9999;\n    \n    els.betaVal.textContent = state.beta.toFixed(3);\n\n    // Gamma\n    state.gamma = 1 / Math.sqrt(1 - (state.beta * state.beta));\n    \n    // Coordinate Time (Total)\n    state.coordinate_time_total = state.gamma * state.tau_target;\n\n    // Update Results UI\n    els.gammaResult.textContent = state.gamma.toFixed(3);\n    els.coordTimeResult.textContent = state.coordinate_time_total.toFixed(2) + \" s\";\n}\n\n// --- Drawing Helpers ---\n\nfunction drawClock(ctx, x, y, radius, timeValue, label, color) {\n    // Clock Face\n    ctx.beginPath();\n    ctx.arc(x, y, radius, 0, 2 * Math.PI);\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';\n    ctx.fill();\n    ctx.lineWidth = 3;\n    ctx.strokeStyle = color;\n    ctx.stroke();\n\n    // Ticks\n    for (let i = 0; i < 12; i++) {\n        const angle = (i * 30) * Math.PI / 180;\n        const tickLen = i % 3 === 0 ? 10 : 5;\n        const tx1 = x + Math.cos(angle) * (radius - tickLen);\n        const ty1 = y + Math.sin(angle) * (radius - tickLen);\n        const tx2 = x + Math.cos(angle) * (radius - 2);\n        const ty2 = y + Math.sin(angle) * (radius - 2);\n        \n        ctx.beginPath();\n        ctx.moveTo(tx1, ty1);\n        ctx.lineTo(tx2, ty2);\n        ctx.strokeStyle = '#fff';\n        ctx.lineWidth = 2;\n        ctx.stroke();\n    }\n\n    // Hand (seconds) - Mapping time to rotation\n    const angle = (timeValue % 60) * 6 * Math.PI / 180 - Math.PI / 2;\n    \n    ctx.beginPath();\n    ctx.moveTo(x, y);\n    ctx.lineTo(x + Math.cos(angle) * (radius - 10), y + Math.sin(angle) * (radius - 10));\n    ctx.strokeStyle = '#ef4444'; // Red hand\n    ctx.lineWidth = 3;\n    ctx.lineCap = 'round';\n    ctx.stroke();\n\n    // Center pivot\n    ctx.beginPath();\n    ctx.arc(x, y, 4, 0, 2 * Math.PI);\n    ctx.fillStyle = '#fff';\n    ctx.fill();\n\n    // Digital readout below\n    ctx.font = 'bold 20px monospace';\n    ctx.fillStyle = color;\n    ctx.textAlign = 'center';\n    ctx.fillText(timeValue.toFixed(2) + \" s\", x, y + radius + 30);\n}\n\nfunction drawRocket(ctx, x, y, width, height) {\n    ctx.save();\n    ctx.translate(x, y);\n    \n    // Body\n    ctx.beginPath();\n    ctx.ellipse(0, 0, width/2, height/2, 0, 0, 2 * Math.PI);\n    ctx.fillStyle = '#e2e8f0';\n    ctx.fill();\n    \n    // Engine flame (flickering)\n    if (state.v > 0) {\n        const flameLen = (Math.random() * 10 + 20) * (state.beta + 0.2);\n        ctx.beginPath();\n        ctx.moveTo(-width/2 + 5, -5);\n        ctx.lineTo(-width/2 - flameLen, 0);\n        ctx.lineTo(-width/2 + 5, 5);\n        ctx.fillStyle = '#f59e0b';\n        ctx.fill();\n    }\n\n    // Window\n    ctx.beginPath();\n    ctx.arc(10, -5, 5, 0, 2 * Math.PI);\n    ctx.fillStyle = '#3b82f6';\n    ctx.fill();\n\n    ctx.restore();\n}\n\n// --- Animation Loop ---\nlet lastTime = 0;\n\nfunction animate(timestamp) {\n    if (!lastTime) lastTime = timestamp;\n    const dt = (timestamp - lastTime) / 1000; // Delta time in seconds\n    lastTime = timestamp;\n\n    const ctx = state.ctx;\n    const w = state.width;\n    const h = state.height;\n\n    // Clear background\n    ctx.fillStyle = '#0f172a';\n    ctx.fillRect(0, 0, w, h);\n\n    // Draw Stars (Parallax effect based on velocity)\n    const starSpeed = 50 + (state.beta * 500); \n    \n    state.stars.forEach(star => {\n        star.x -= starSpeed * dt * (star.size / 2);\n        if (star.x < 0) star.x = w;\n\n        ctx.beginPath();\n        ctx.arc(star.x, star.y, star.size, 0, 2 * Math.PI);\n        ctx.fillStyle = `rgba(255, 255, 255, ${star.opacity})`;\n        ctx.fill();\n    });\n\n    // --- Time Evolution Logic ---\n    const simSpeed = 1.0; // 1 simulation second per real second\n    \n    // Reset if we exceed the target proper time for looping effect\n    if (state.elapsed_tau > state.tau_target) {\n        state.elapsed_tau = 0;\n        state.elapsed_t = 0;\n    }\n\n    // Increment proper time\n    const dTau = dt * simSpeed;\n    state.elapsed_tau += dTau;\n    \n    // Increment coordinate time (t = gamma * tau)\n    state.elapsed_t += dTau * state.gamma;\n\n\n    // --- Draw Clocks ---\n    const clockY = h / 2 + 80;\n    \n    // 1. Stationary Clock (Observer on Earth) - Left\n    // This clock ticks FASTER (t > tau)\n    drawClock(ctx, w * 0.25, clockY, 50, state.elapsed_t, \"Stationary\", \"#3b82f6\");\n\n    // 2. Moving Clock (On Rocket) - Right\n    // This clock ticks \"Normally\" (Proper time) relative to itself\n    drawClock(ctx, w * 0.75, clockY, 50, state.elapsed_tau, \"Moving\", \"#ef4444\");\n\n\n    // --- Draw Scene ---\n    // Stationary Observer (Earth icon)\n    ctx.font = '40px Arial';\n    ctx.textAlign = 'center';\n    ctx.fillText('🌍', w * 0.25, h/2 - 50);\n\n    // Moving Rocket\n    // Moves across screen \n    const progress = state.elapsed_tau / state.tau_target;\n    const rocketX = (w * 0.1) + ((w * 0.8) * progress);\n    \n    drawRocket(ctx, rocketX, h/2 - 60, 60, 30);\n\n    requestAnimationFrame(animate);\n}\n\n// Start\nwindow.onload = init;"}}
{"input": {"input_text": "Lorentz length contraction: L = L0*sqrt(1 - beta^2). Compute contracted length.", "simulation_name": " Length Contraction", "domain": "Relativity", "description": "Moving rod length contraction", "assumptions": ["Parallel motion"], "entities": [], "constants": [{"name": "speed_of_light", "symbol": "c", "value": 300000000.0, "unit": "m/s"}], "parameters": [{"name": "rest_length", "symbol": "L0", "unit": "m", "range": [0, 1000000.0]}, {"name": "speed", "symbol": "v", "unit": "m/s", "range": [0, 290000000.0]}], "equations": [{"description": "Contracted length", "expression": "L = L0*sqrt(1 - (v/c)^2)"}], "initial_conditions": {}, "outputs": ["L"], "simulation_controls": ["L0", "v"], "constraints": ["0<=v<c", "L0>=0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S67 Length Contraction Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"container\">\n    <header>\n        <h1>Relativity: Length Contraction</h1>\n        <p class=\"subtitle\">Observe how an object's length contracts as it approaches the speed of light.</p>\n    </header>\n\n    <div class=\"simulation-wrapper\">\n        <div class=\"scene\">\n            <div class=\"track-label\">Rest Frame (Observer co-moving with rod)</div>\n            <div class=\"track\" id=\"track-rest\">\n                <div class=\"rod rod-rest\" id=\"rod-rest\">\n                    <span class=\"rod-label\">L₀</span>\n                </div>\n            </div>\n\n            <div class=\"track-label\">Laboratory Frame (Observer watching rod move)</div>\n            <div class=\"track\" id=\"track-moving\">\n                <div class=\"rod rod-moving\" id=\"rod-moving\">\n                    <span class=\"rod-label\">L</span>\n                </div>\n            </div>\n            \n            <div class=\"grid-lines\"></div>\n        </div>\n\n        <div class=\"controls-panel\">\n            <div class=\"equation-box\">\n                $$L = L_0 \\sqrt{1 - \\frac{v^2}{c^2}}$$\n            </div>\n\n            <div class=\"control-group\">\n                <label for=\"l0-input\">Rest Length ($L_0$)</label>\n                <input type=\"range\" id=\"l0-input\" min=\"10\" max=\"100\" value=\"80\" step=\"1\">\n                <span class=\"value-display\"><span id=\"l0-value\">80</span> m</span>\n            </div>\n\n            <div class=\"control-group\">\n                <label for=\"v-input\">Velocity ($v$)</label>\n                <input type=\"range\" id=\"v-input\" min=\"0\" max=\"0.995\" value=\"0\" step=\"0.001\">\n                <span class=\"value-display\"><span id=\"v-value\">0.000</span> c</span>\n            </div>\n\n            <div class=\"output-panel\">\n                <div class=\"output-item\">\n                    <span class=\"label\">Contraction Factor ($\\sqrt{1-\\beta^2}$):</span>\n                    <span class=\"value\" id=\"factor-value\">1.000</span>\n                </div>\n                <div class=\"output-item highlight\">\n                    <span class=\"label\">Contracted Length ($L$):</span>\n                    <span class=\"value\" id=\"l-value\">80.00</span> m\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary-color: #3498db;\n    --accent-color: #e74c3c;\n    --bg-color: #f4f7f6;\n    --panel-bg: #ffffff;\n    --text-color: #2c3e50;\n    --rod-height: 40px;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    min-height: 100vh;\n}\n\n.container {\n    width: 100%;\n    max-width: 900px;\n    background: var(--panel-bg);\n    border-radius: 12px;\n    box-shadow: 0 10px 30px rgba(0,0,0,0.1);\n    padding: 30px;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 30px;\n}\n\nh1 {\n    margin: 0;\n    font-size: 2rem;\n}\n\n.subtitle {\n    color: #7f8c8d;\n    margin-top: 5px;\n}\n\n.simulation-wrapper {\n    display: flex;\n    flex-direction: column;\n    gap: 30px;\n}\n\n/* Visualization Scene */\n.scene {\n    background: #2c3e50;\n    border-radius: 8px;\n    padding: 20px;\n    position: relative;\n    overflow: hidden;\n    color: white;\n}\n\n.track-label {\n    font-size: 0.9rem;\n    opacity: 0.8;\n    margin-bottom: 5px;\n    margin-top: 15px;\n}\n\n.track-label:first-child {\n    margin-top: 0;\n}\n\n.track {\n    height: 60px;\n    position: relative;\n    border-bottom: 1px dashed rgba(255,255,255,0.2);\n    display: flex;\n    align-items: center;\n}\n\n.rod {\n    height: var(--rod-height);\n    border-radius: 4px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    font-weight: bold;\n    color: white;\n    text-shadow: 0 1px 2px rgba(0,0,0,0.3);\n    box-shadow: 0 4px 6px rgba(0,0,0,0.3);\n    /* Transition for smooth width changes */\n    transition: width 0.1s linear, transform 0s linear; \n    position: absolute;\n    left: 0;\n}\n\n.rod-rest {\n    background: linear-gradient(to bottom, #3498db, #2980b9);\n    width: 0; /* Set by JS */\n}\n\n.rod-moving {\n    background: linear-gradient(to bottom, #e74c3c, #c0392b);\n    width: 0; /* Set by JS */\n    will-change: transform, width;\n}\n\n.grid-lines {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-image: linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),\n    linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);\n    background-size: 20px 20px;\n    pointer-events: none;\n}\n\n/* Controls Panel */\n.controls-panel {\n    background: #ecf0f1;\n    padding: 20px;\n    border-radius: 8px;\n}\n\n.equation-box {\n    text-align: center;\n    font-size: 1.2rem;\n    margin-bottom: 20px;\n    background: white;\n    padding: 10px;\n    border-radius: 6px;\n    border: 1px solid #bdc3c7;\n}\n\n.control-group {\n    margin-bottom: 20px;\n}\n\nlabel {\n    display: block;\n    font-weight: 600;\n    margin-bottom: 8px;\n}\n\ninput[type=range] {\n    width: 100%;\n    cursor: pointer;\n}\n\n.value-display {\n    display: block;\n    text-align: right;\n    font-family: 'Courier New', Courier, monospace;\n    font-weight: bold;\n    margin-top: 5px;\n}\n\n.output-panel {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 15px;\n    margin-top: 20px;\n    padding-top: 20px;\n    border-top: 2px solid #bdc3c7;\n}\n\n.output-item {\n    background: white;\n    padding: 10px;\n    border-radius: 6px;\n    text-align: center;\n}\n\n.output-item.highlight {\n    background: #dff9fb;\n    border: 1px solid #81ecec;\n}\n\n.output-item .label {\n    display: block;\n    font-size: 0.85rem;\n    color: #7f8c8d;\n    margin-bottom: 5px;\n}\n\n.output-item .value {\n    font-size: 1.2rem;\n    font-weight: bold;\n    color: var(--text-color);\n}\n\n@media (min-width: 768px) {\n    .simulation-wrapper {\n        flex-direction: row;\n    }\n    .scene {\n        flex: 2;\n    }\n    .controls-panel {\n        flex: 1;\n    }\n    .output-panel {\n        grid-template-columns: 1fr;\n    }\n}", "js": "document.addEventListener('DOMContentLoaded', () => {\n    // DOM Elements\n    const l0Input = document.getElementById('l0-input');\n    const vInput = document.getElementById('v-input');\n    \n    const l0Display = document.getElementById('l0-value');\n    const vDisplay = document.getElementById('v-value');\n    const factorDisplay = document.getElementById('factor-value');\n    const lDisplay = document.getElementById('l-value');\n    \n    const rodRest = document.getElementById('rod-rest');\n    const rodMoving = document.getElementById('rod-moving');\n    const scene = document.querySelector('.scene');\n\n    // Constants\n    const C = 3e8; // Speed of light (m/s) - Conceptual use\n    \n    // Animation State\n    let animationId;\n    let positionX = 0;\n    let lastTime = 0;\n\n    function calculateValues() {\n        const l0 = parseFloat(l0Input.value); // meters (conceptual)\n        const vRatio = parseFloat(vInput.value); // v/c\n        \n        // Lorentz Factor calculation: sqrt(1 - v^2/c^2)\n        // Since input is already v/c, we just square the input\n        const betaSquared = vRatio * vRatio;\n        const contractionFactor = Math.sqrt(1 - betaSquared);\n        \n        const lContracted = l0 * contractionFactor;\n\n        return {\n            l0,\n            vRatio,\n            contractionFactor,\n            lContracted\n        };\n    }\n\n    function updateUI() {\n        const { l0, vRatio, contractionFactor, lContracted } = calculateValues();\n\n        // Update Text Displays\n        l0Display.textContent = l0.toFixed(0);\n        vDisplay.textContent = vRatio.toFixed(3);\n        factorDisplay.textContent = contractionFactor.toFixed(3);\n        lDisplay.textContent = lContracted.toFixed(2);\n\n        // Update Visuals\n        // We map 1 meter to X pixels. Let's say max width (100m) takes up 80% of container\n        const containerWidth = scene.clientWidth;\n        const maxInputL = 100;\n        const pixelScale = (containerWidth * 0.8) / maxInputL;\n\n        const widthRestPx = l0 * pixelScale;\n        const widthMovingPx = lContracted * pixelScale;\n\n        rodRest.style.width = `${widthRestPx}px`;\n        rodMoving.style.width = `${widthMovingPx}px`;\n        \n        // Center the rest rod\n        rodRest.style.left = `${(containerWidth - widthRestPx) / 2}px`;\n    }\n\n    function animate(timestamp) {\n        if (!lastTime) lastTime = timestamp;\n        const deltaTime = timestamp - lastTime;\n        lastTime = timestamp;\n\n        const { vRatio, lContracted } = calculateValues();\n        \n        // Determine container width for wrapping\n        const containerWidth = scene.clientWidth;\n        \n        // Calculate speed in pixels per frame\n        // Visual speed needs to be artificially scaled to be viewable.\n        // If v=0, speed=0. If v=c, speed is fast but viewable.\n        // Let's say max speed is 500 pixels per second.\n        const visualSpeedScale = 300; \n        const velocityPxPerSec = vRatio * visualSpeedScale;\n        \n        // Update position\n        positionX += (velocityPxPerSec * (deltaTime / 1000));\n\n        // Get current width of moving rod (in pixels) for wrapping logic\n        const maxInputL = 100;\n        const pixelScale = (containerWidth * 0.8) / maxInputL;\n        const currentRodWidth = lContracted * pixelScale;\n\n        // Wrap around logic\n        if (positionX > containerWidth) {\n            positionX = -currentRodWidth;\n        }\n\n        // Apply transform\n        rodMoving.style.transform = `translateX(${positionX}px)`;\n\n        animationId = requestAnimationFrame(animate);\n    }\n\n    // Event Listeners\n    l0Input.addEventListener('input', updateUI);\n    vInput.addEventListener('input', updateUI);\n\n    // Handle Window Resize to keep scaling correct\n    window.addEventListener('resize', updateUI);\n\n    // Initialize\n    updateUI();\n    animationId = requestAnimationFrame(animate);\n});"}}
{"input": {"input_text": "Quantum particle in 1D box length L: energy levels En = n^2*pi^2*hbar^2/(2mL^2).", "simulation_name": " Particle in Box", "domain": "Quantum Mechanics", "description": "Infinite square well energies", "assumptions": ["Infinite walls"], "entities": [], "constants": [{"name": "reduced_planck", "symbol": "hbar", "value": 1.0545718e-34, "unit": "J*s"}], "parameters": [{"name": "mass", "symbol": "m", "unit": "kg", "range": [9.11e-31, 1e-25]}, {"name": "length", "symbol": "L", "unit": "m", "range": [1e-10, 1e-06]}, {"name": "quantum_number", "symbol": "n", "unit": "integer", "range": [1, 10]}], "equations": [{"description": "Energy", "expression": "E = n^2*pi^2*hbar^2/(2*m*L^2)"}], "initial_conditions": {}, "outputs": ["E"], "simulation_controls": ["m", "L", "n"], "constraints": ["n>=1", "m>0", "L>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Quantum Particle in a 1D Box Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"container\">\n    <header>\n        <h1>Particle in a 1D Infinite Potential Well</h1>\n        <p class=\"subtitle\">Visualizing Energy Levels and Wavefunctions</p>\n    </header>\n\n    <main class=\"simulation-layout\">\n        \n        <section class=\"controls-panel\">\n            <h3>Parameters</h3>\n            \n            <div class=\"control-group\">\n                <label for=\"quantum-n\">Quantum Number ($n$): <span id=\"val-n\">1</span></label>\n                <input type=\"range\" id=\"quantum-n\" min=\"1\" max=\"10\" step=\"1\" value=\"1\">\n            </div>\n\n            <div class=\"control-group\">\n                <label for=\"length-l\">Box Length ($L$): <span id=\"val-l\">1.0</span> nm</label>\n                <input type=\"range\" id=\"length-l\" min=\"0.5\" max=\"5.0\" step=\"0.1\" value=\"1.0\">\n            </div>\n\n            <div class=\"control-group\">\n                <label for=\"mass-m\">Particle Mass ($m$): <span id=\"val-m\">1.0</span> $m_e$</label>\n                <input type=\"range\" id=\"mass-m\" min=\"0.1\" max=\"5.0\" step=\"0.1\" value=\"1.0\">\n                <small>($m_e$ = electron mass)</small>\n            </div>\n\n            <div class=\"formula-box\">\n                <h4>Energy Formula</h4>\n                $$E_n = \\frac{n^2 \\pi^2 \\hbar^2}{2mL^2}$$\n            </div>\n\n            <div class=\"results-box\">\n                <h4>Calculated Energy ($E_n$)</h4>\n                <div class=\"energy-display\">\n                    <span id=\"energy-ev\" class=\"highlight\">0.00 eV</span>\n                    <span id=\"energy-joules\" class=\"sub-text\">0.00 J</span>\n                </div>\n            </div>\n        </section>\n\n        <section class=\"visualization-panel\">\n            <canvas id=\"quantumCanvas\"></canvas>\n            <div class=\"legend\">\n                <span class=\"legend-item\"><span class=\"color-box wave\"></span> Real part $\\text{Re}(\\Psi)$ (Animation)</span>\n                <span class=\"legend-item\"><span class=\"color-box prob\"></span> Probability Density $|\\psi|^2$</span>\n            </div>\n        </section>\n\n    </main>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-color: #0f172a;\n    --panel-bg: #1e293b;\n    --text-color: #e2e8f0;\n    --accent-color: #38bdf8;\n    --secondary-accent: #f472b6;\n    --border-color: #334155;\n    --highlight: #fbbf24;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n    min-height: 100vh;\n}\n\n.container {\n    max-width: 1200px;\n    width: 100%;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 30px;\n}\n\n.subtitle {\n    color: #94a3b8;\n    font-weight: 300;\n}\n\n.simulation-layout {\n    display: grid;\n    grid-template-columns: 300px 1fr;\n    gap: 20px;\n    background-color: var(--panel-bg);\n    border-radius: 12px;\n    padding: 20px;\n    box-shadow: 0 10px 25px rgba(0,0,0,0.5);\n}\n\n@media (max-width: 800px) {\n    .simulation-layout {\n        grid-template-columns: 1fr;\n    }\n}\n\n/* Controls Panel */\n.controls-panel {\n    border-right: 1px solid var(--border-color);\n    padding-right: 20px;\n}\n\n@media (max-width: 800px) {\n    .controls-panel {\n        border-right: none;\n        border-bottom: 1px solid var(--border-color);\n        padding-right: 0;\n        padding-bottom: 20px;\n    }\n}\n\n.control-group {\n    margin-bottom: 25px;\n}\n\nlabel {\n    display: block;\n    margin-bottom: 8px;\n    font-weight: 600;\n}\n\ninput[type=range] {\n    width: 100%;\n    cursor: pointer;\n    accent-color: var(--accent-color);\n}\n\nsmall {\n    color: #94a3b8;\n    font-size: 0.85em;\n}\n\n/* Formula & Results */\n.formula-box {\n    background: rgba(0,0,0,0.2);\n    padding: 10px;\n    border-radius: 8px;\n    margin-bottom: 20px;\n    text-align: center;\n}\n\n.results-box {\n    background: rgba(56, 189, 248, 0.1);\n    border: 1px solid var(--accent-color);\n    padding: 15px;\n    border-radius: 8px;\n    text-align: center;\n}\n\n.energy-display {\n    display: flex;\n    flex-direction: column;\n    gap: 5px;\n    margin-top: 10px;\n}\n\n.highlight {\n    font-size: 1.5em;\n    font-weight: bold;\n    color: var(--accent-color);\n}\n\n.sub-text {\n    font-size: 0.9em;\n    color: #94a3b8;\n    word-break: break-all;\n}\n\n/* Visualization Panel */\n.visualization-panel {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    position: relative;\n    padding: 10px;\n}\n\ncanvas {\n    width: 100%;\n    height: 400px;\n    background: radial-gradient(circle at center, #253045 0%, #1e293b 100%);\n    border-radius: 8px;\n    box-shadow: inset 0 0 20px rgba(0,0,0,0.3);\n}\n\n.legend {\n    margin-top: 15px;\n    display: flex;\n    gap: 20px;\n    font-size: 0.9em;\n}\n\n.legend-item {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.color-box {\n    width: 15px;\n    height: 15px;\n    border-radius: 3px;\n}\n\n.color-box.wave { background-color: var(--accent-color); }\n.color-box.prob { background-color: rgba(244, 114, 182, 0.3); border: 1px solid var(--secondary-accent); }", "js": "// Constants\nconst HBAR = 1.0545718e-34; // Reduced Planck constant (J*s)\nconst MASS_ELECTRON = 9.10938356e-31; // Mass of electron (kg)\nconst EV_CONVERSION = 1.60218e-19; // Joules per eV\n\n// DOM Elements\nconst canvas = document.getElementById('quantumCanvas');\nconst ctx = canvas.getContext('2d');\n\nconst inputN = document.getElementById('quantum-n');\nconst inputL = document.getElementById('length-l');\nconst inputM = document.getElementById('mass-m');\n\nconst valN = document.getElementById('val-n');\nconst valL = document.getElementById('val-l');\nconst valM = document.getElementById('val-m');\n\nconst dispEv = document.getElementById('energy-ev');\nconst dispJoules = document.getElementById('energy-joules');\n\n// State Variables\nlet n = 1;\nlet L_nm = 1.0; // Length in nanometers\nlet m_rel = 1.0; // Mass relative to electron mass\nlet time = 0;\n\n// Resize Canvas\nfunction resizeCanvas() {\n    canvas.width = canvas.parentElement.clientWidth;\n    canvas.height = 400; // Fixed height\n}\nwindow.addEventListener('resize', resizeCanvas);\nresizeCanvas();\n\n// --- Physics Calculations ---\n\nfunction calculateEnergy(n, L_nm, m_rel) {\n    // Convert inputs to SI units\n    const L = L_nm * 1e-9; // meters\n    const m = m_rel * MASS_ELECTRON; // kg\n\n    // E = (n^2 * pi^2 * hbar^2) / (2 * m * L^2)\n    const numerator = Math.pow(n, 2) * Math.pow(Math.PI, 2) * Math.pow(HBAR, 2);\n    const denominator = 2 * m * Math.pow(L, 2);\n    \n    const EnergyJoules = numerator / denominator;\n    const EnergyEv = EnergyJoules / EV_CONVERSION;\n\n    return { J: EnergyJoules, eV: EnergyEv };\n}\n\n// --- Drawing Functions ---\n\nfunction draw() {\n    // Clear canvas\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    const w = canvas.width;\n    const h = canvas.height;\n\n    // Define Simulation Area (The Box) inside the canvas\n    // We keep some padding for axes\n    const padding = 40;\n    const boxWidth = w - (padding * 2);\n    const boxHeight = h - (padding * 2);\n    const boxLeft = padding;\n    const boxRight = w - padding;\n    const baselineY = h / 2; // The zero line for the wave\n\n    // 1. Draw Infinite Walls\n    ctx.fillStyle = '#334155'; // Dark grey walls\n    ctx.fillRect(0, 0, boxLeft, h); // Left wall area\n    ctx.fillRect(boxRight, 0, padding, h); // Right wall area\n\n    // Wall Borders\n    ctx.strokeStyle = '#94a3b8';\n    ctx.lineWidth = 3;\n    ctx.beginPath();\n    // Left Wall Line\n    ctx.moveTo(boxLeft, 0);\n    ctx.lineTo(boxLeft, h);\n    // Right Wall Line\n    ctx.moveTo(boxRight, 0);\n    ctx.lineTo(boxRight, h);\n    ctx.stroke();\n\n    // 2. Draw Zero Line (Axis)\n    ctx.strokeStyle = '#475569';\n    ctx.lineWidth = 1;\n    ctx.setLineDash([5, 5]);\n    ctx.beginPath();\n    ctx.moveTo(boxLeft, baselineY);\n    ctx.lineTo(boxRight, baselineY);\n    ctx.stroke();\n    ctx.setLineDash([]);\n\n    // 3. Calculate Wavefunction Scaling\n    // We want the wave to fit nicely within the box height visually\n    const amplitudeScale = (boxHeight / 2) * 0.8; \n    \n    // 4. Draw Probability Density |psi|^2 (Static Background)\n    ctx.fillStyle = 'rgba(244, 114, 182, 0.2)'; // Pinkish transparent\n    ctx.strokeStyle = 'rgba(244, 114, 182, 0.8)';\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.moveTo(boxLeft, baselineY);\n\n    for (let x = 0; x <= boxWidth; x++) {\n        // Normalized x from 0 to 1\n        const xNorm = x / boxWidth;\n        \n        // Psi(x) part: sin(n * pi * x/L)\n        const psi = Math.sin(n * Math.PI * xNorm);\n        \n        // Probability |Psi|^2 = sin^2(...)\n        // We scale it up to visualize it\n        const prob = psi * psi;\n        \n        // Plot y. Note: Canvas Y grows downwards, so we subtract from baseline\n        const yPlot = baselineY - (prob * amplitudeScale);\n        ctx.lineTo(boxLeft + x, yPlot);\n    }\n    \n    ctx.lineTo(boxRight, baselineY);\n    ctx.closePath();\n    ctx.fill();\n    ctx.stroke();\n\n    // 5. Draw Real Part of Wavefunction Re(Psi) (Animated)\n    // Animation factor: cos(omega * t). \n    // Since actual frequency is too high, we use an arbitrary visual speed.\n    // Higher n oscillates faster in reality, let's mimic that slightly.\n    const speedFactor = 0.05 + (n * 0.01); \n    const phase = Math.cos(time * speedFactor);\n\n    ctx.strokeStyle = '#38bdf8'; // Cyan\n    ctx.lineWidth = 3;\n    ctx.beginPath();\n    ctx.moveTo(boxLeft, baselineY);\n\n    for (let x = 0; x <= boxWidth; x++) {\n        const xNorm = x / boxWidth;\n        // Spatial part\n        const psiSpatial = Math.sin(n * Math.PI * xNorm);\n        // Full Real part = Spatial * cos(t)\n        const psiReal = psiSpatial * phase;\n\n        const yPlot = baselineY - (psiReal * amplitudeScale);\n        ctx.lineTo(boxLeft + x, yPlot);\n    }\n    ctx.stroke();\n\n    // 6. Labels\n    ctx.fillStyle = '#e2e8f0';\n    ctx.font = '14px sans-serif';\n    ctx.fillText(\"x = 0\", boxLeft - 10, h - 10);\n    ctx.fillText(`x = ${L_nm} nm`, boxRight - 40, h - 10);\n    ctx.fillText(\"V = ∞\", 5, h/2);\n    ctx.fillText(\"V = ∞\", w - 35, h/2);\n    \n    // Increment time for animation\n    time++;\n    requestAnimationFrame(draw);\n}\n\n// --- Updates ---\n\nfunction updateSimulation() {\n    // Read values\n    n = parseInt(inputN.value);\n    L_nm = parseFloat(inputL.value);\n    m_rel = parseFloat(inputM.value);\n\n    // Update Text Displays\n    valN.textContent = n;\n    valL.textContent = L_nm.toFixed(1);\n    valM.textContent = m_rel.toFixed(1);\n\n    // Calculate Energy\n    const energies = calculateEnergy(n, L_nm, m_rel);\n    \n    // Update Energy Display\n    dispEv.textContent = energies.eV.toExponential(3) + \" eV\";\n    dispJoules.textContent = energies.J.toExponential(3) + \" J\";\n}\n\n// --- Event Listeners ---\n\ninputN.addEventListener('input', updateSimulation);\ninputL.addEventListener('input', updateSimulation);\ninputM.addEventListener('input', updateSimulation);\n\n// Initialize\nupdateSimulation();\ndraw();"}}
{"input": {"input_text": "Hydrogen-like atom Bohr model: En = -13.6 eV * Z^2 / n^2. Compute level energy.", "simulation_name": " Bohr Energy", "domain": "Quantum Mechanics", "description": "Bohr energy levels", "assumptions": ["Hydrogenic"], "entities": [], "constants": [], "parameters": [{"name": "atomic_number", "symbol": "Z", "unit": "dimensionless", "range": [1, 10]}, {"name": "quantum_number", "symbol": "n", "unit": "integer", "range": [1, 10]}], "equations": [{"description": "Energy", "expression": "E = -13.6*Z^2/n^2"}], "initial_conditions": {}, "outputs": ["E"], "simulation_controls": ["Z", "n"], "constraints": ["n>=1"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Bohr Model Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n    <div class=\"container\">\n        <header>\n            <h1>Bohr Model: Hydrogen-like Atom</h1>\n            <p class=\"subtitle\">Simulating Energy Levels: \\( E_n = -13.6 \\text{ eV} \\cdot \\frac{Z^2}{n^2} \\)</p>\n        </header>\n\n        <div class=\"simulation-layout\">\n            <div class=\"canvas-wrapper\">\n                <canvas id=\"atomCanvas\"></canvas>\n                <div class=\"legend\">\n                    <span><span class=\"dot electron-dot\"></span> Electron</span>\n                    <span><span class=\"dot nucleus-dot\"></span> Nucleus</span>\n                </div>\n            </div>\n\n            <div class=\"controls-panel\">\n                \n                <div class=\"control-group\">\n                    <label for=\"zInput\">Atomic Number (\\(Z\\)): <span id=\"zVal\">1</span></label>\n                    <input type=\"range\" id=\"zInput\" min=\"1\" max=\"10\" step=\"1\" value=\"1\">\n                    <div class=\"description\">Protons in nucleus. Increases attraction.</div>\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"nInput\">Principal Quantum Number (\\(n\\)): <span id=\"nVal\">1</span></label>\n                    <input type=\"range\" id=\"nInput\" min=\"1\" max=\"10\" step=\"1\" value=\"1\">\n                    <div class=\"description\">Energy level/Orbit shell.</div>\n                </div>\n\n                <hr>\n\n                <div class=\"results\">\n                    <h3>Calculated Energy</h3>\n                    <div class=\"energy-display\" id=\"energyOutput\">-13.60 eV</div>\n                    \n                    <div class=\"stats-grid\">\n                        <div class=\"stat-item\">\n                            <span class=\"stat-label\">Relative Radius (\\( \\propto n^2/Z \\))</span>\n                            <span class=\"stat-value\" id=\"radiusOutput\">1.00 \\(a_0\\)</span>\n                        </div>\n                        <div class=\"stat-item\">\n                            <span class=\"stat-label\">Relative Velocity (\\( \\propto Z/n \\))</span>\n                            <span class=\"stat-value\" id=\"velocityOutput\">1.00 \\(v_1\\)</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary-color: #3498db;\n    --accent-color: #e74c3c;\n    --bg-color: #f4f7f6;\n    --panel-bg: #ffffff;\n    --text-color: #2c3e50;\n    --canvas-bg: #111;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n    min-height: 100vh;\n}\n\n.container {\n    max-width: 1000px;\n    width: 100%;\n    background: var(--panel-bg);\n    border-radius: 12px;\n    box-shadow: 0 10px 25px rgba(0,0,0,0.1);\n    padding: 20px;\n    display: flex;\n    flex-direction: column;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 20px;\n}\n\nh1 { margin: 0; font-size: 1.8rem; }\n.subtitle { color: #7f8c8d; margin-top: 5px; font-size: 0.9rem; }\n\n.simulation-layout {\n    display: flex;\n    gap: 20px;\n    flex-wrap: wrap;\n}\n\n/* Canvas Section */\n.canvas-wrapper {\n    flex: 2;\n    min-width: 300px;\n    position: relative;\n    background: var(--canvas-bg);\n    border-radius: 8px;\n    overflow: hidden;\n    height: 400px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\ncanvas {\n    width: 100%;\n    height: 100%;\n}\n\n.legend {\n    position: absolute;\n    bottom: 10px;\n    right: 10px;\n    background: rgba(255, 255, 255, 0.1);\n    padding: 5px 10px;\n    border-radius: 4px;\n    color: #fff;\n    font-size: 0.8rem;\n    pointer-events: none;\n}\n\n.dot {\n    display: inline-block;\n    width: 8px;\n    height: 8px;\n    border-radius: 50%;\n    margin-right: 5px;\n}\n.electron-dot { background-color: #00f0ff; box-shadow: 0 0 5px #00f0ff; }\n.nucleus-dot { background-color: #ff4d4d; box-shadow: 0 0 5px #ff4d4d; }\n\n/* Controls Section */\n.controls-panel {\n    flex: 1;\n    min-width: 250px;\n    background: #fdfdfd;\n    padding: 20px;\n    border-radius: 8px;\n    border: 1px solid #eee;\n}\n\n.control-group {\n    margin-bottom: 20px;\n}\n\nlabel {\n    display: block;\n    font-weight: 600;\n    margin-bottom: 8px;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    cursor: pointer;\n}\n\n.description {\n    font-size: 0.8rem;\n    color: #7f8c8d;\n    margin-top: 5px;\n}\n\nhr { border: 0; border-top: 1px solid #eee; margin: 20px 0; }\n\n.results h3 {\n    margin-top: 0;\n    font-size: 1.1rem;\n    color: #2c3e50;\n}\n\n.energy-display {\n    font-size: 2rem;\n    font-weight: bold;\n    color: var(--primary-color);\n    margin: 10px 0 20px 0;\n}\n\n.stats-grid {\n    display: grid;\n    grid-template-columns: 1fr;\n    gap: 10px;\n}\n\n.stat-item {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.9rem;\n    background: #f8f9fa;\n    padding: 8px;\n    border-radius: 4px;\n}\n\n.stat-label { color: #666; }\n.stat-value { font-weight: 600; }\n\n@media (max-width: 768px) {\n    .simulation-layout { flex-direction: column; }\n    .canvas-wrapper { height: 300px; }\n}", "js": "// Constants\nconst RYDBERG_ENERGY = 13.6; // eV\n\n// DOM Elements\nconst canvas = document.getElementById('atomCanvas');\nconst ctx = canvas.getContext('2d');\nconst zInput = document.getElementById('zInput');\nconst nInput = document.getElementById('nInput');\nconst zVal = document.getElementById('zVal');\nconst nVal = document.getElementById('nVal');\nconst energyOutput = document.getElementById('energyOutput');\nconst radiusOutput = document.getElementById('radiusOutput');\nconst velocityOutput = document.getElementById('velocityOutput');\n\n// State\nlet Z = 1;\nlet n = 1;\nlet electronAngle = 0;\n\n// Resize canvas handling\nlet width, height, centerX, centerY;\nfunction resize() {\n    width = canvas.parentElement.clientWidth;\n    height = canvas.parentElement.clientHeight;\n    canvas.width = width;\n    canvas.height = height;\n    centerX = width / 2;\n    centerY = height / 2;\n}\nwindow.addEventListener('resize', resize);\nresize();\n\n// Calculation Logic\nfunction updateCalculations() {\n    // 1. Energy: E = -13.6 * Z^2 / n^2\n    const energy = -RYDBERG_ENERGY * (Math.pow(Z, 2) / Math.pow(n, 2));\n    \n    // 2. Relative Radius (Bohr radius units): r ~ n^2 / Z\n    const relRadius = Math.pow(n, 2) / Z;\n    \n    // 3. Relative Velocity: v ~ Z / n\n    const relVelocity = Z / n;\n\n    // Update Text UI\n    zVal.textContent = Z;\n    nVal.textContent = n;\n    energyOutput.textContent = `${energy.toFixed(2)} eV`;\n    radiusOutput.textContent = `${relRadius.toFixed(2)} a₀`;\n    velocityOutput.textContent = `${relVelocity.toFixed(2)} v₁`;\n    \n    // Update MathJax typeset if needed (optional dynamic refresh)\n}\n\n// Animation Loop\nfunction draw() {\n    // Clear canvas\n    ctx.fillStyle = '#111'; // Dark space background\n    ctx.fillRect(0, 0, width, height);\n\n    // Physics parameters for visualization\n    // We want to visualize the orbit. \n    // Since r scales with n^2 (1 to 100 range), we can't draw 1:1 scale easily.\n    // Approach: We scale the view such that the orbit is always a comfortable size (e.g., 35% of canvas min dimension).\n    // However, to show the effect of Z and n, we will animate the transition or use visual cues.\n    \n    const baseRadius = Math.min(width, height) * 0.35; \n    \n    // Orbit Ring\n    ctx.beginPath();\n    ctx.strokeStyle = 'rgba(52, 152, 219, 0.3)';\n    ctx.lineWidth = 2;\n    ctx.arc(centerX, centerY, baseRadius, 0, Math.PI * 2);\n    ctx.stroke();\n\n    // Draw Nucleus\n    // Nucleus size grows slightly with Z to indicate mass/charge increase\n    const nucleusSize = 6 + (Z * 1.5); \n    ctx.beginPath();\n    ctx.fillStyle = '#ff4d4d'; // Reddish nucleus\n    ctx.shadowBlur = 15;\n    ctx.shadowColor = '#ff4d4d';\n    ctx.arc(centerX, centerY, nucleusSize, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.shadowBlur = 0;\n\n    // Draw Nucleus Label\n    ctx.fillStyle = '#fff';\n    ctx.font = '10px Arial';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText(`${Z}+`, centerX, centerY);\n\n    // Electron Motion\n    // Velocity v proportional to Z/n\n    // Base speed factor\n    const speedFactor = 0.02;\n    const orbitalSpeed = (Z / n) * speedFactor;\n    \n    electronAngle += orbitalSpeed;\n\n    const electronX = centerX + Math.cos(electronAngle) * baseRadius;\n    const electronY = centerY + Math.sin(electronAngle) * baseRadius;\n\n    // Draw Electron\n    ctx.beginPath();\n    ctx.fillStyle = '#00f0ff'; // Cyan electron\n    ctx.shadowBlur = 10;\n    ctx.shadowColor = '#00f0ff';\n    ctx.arc(electronX, electronY, 5, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.shadowBlur = 0;\n\n    // Draw Electron Trail (visual effect)\n    ctx.beginPath();\n    ctx.strokeStyle = 'rgba(0, 240, 255, 0.1)';\n    ctx.lineWidth = 4;\n    ctx.arc(centerX, centerY, baseRadius, electronAngle - 0.5, electronAngle);\n    ctx.stroke();\n\n    requestAnimationFrame(draw);\n}\n\n// Event Listeners\nzInput.addEventListener('input', (e) => {\n    Z = parseInt(e.target.value);\n    updateCalculations();\n});\n\nnInput.addEventListener('input', (e) => {\n    n = parseInt(e.target.value);\n    updateCalculations();\n});\n\n// Initialize\nupdateCalculations();\ndraw();"}}
{"input": {"input_text": "Wien's displacement law: lambda_max = b/T. Compute peak wavelength for blackbody temperature T.", "simulation_name": " Wien Law", "domain": "Thermal Radiation", "description": "Peak wavelength of blackbody", "assumptions": ["Blackbody"], "entities": [], "constants": [{"name": "wien_constant", "symbol": "b", "value": 0.002897771955, "unit": "m*K"}], "parameters": [{"name": "temperature", "symbol": "T", "unit": "K", "range": [100, 10000]}], "equations": [{"description": "Peak wavelength", "expression": "lambda_max = b/T"}], "initial_conditions": {}, "outputs": ["lambda_max"], "simulation_controls": ["T"], "constraints": ["T>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Wien's Displacement Law Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n    <div class=\"main-container\">\n        <header>\n            <h1>Wien's Displacement Law</h1>\n            <p class=\"subtitle\">Peak Wavelength: \\( \\lambda_{max} = \\frac{b}{T} \\)</p>\n        </header>\n\n        <div class=\"simulation-grid\">\n            \n            <div class=\"viz-panel\">\n                <div class=\"canvas-container\">\n                    <canvas id=\"radiationGraph\"></canvas>\n                    <div class=\"graph-label y-axis\">Intensity (arb.)</div>\n                    <div class=\"graph-label x-axis\">Wavelength (\\( \\lambda \\))</div>\n                </div>\n                \n                <div class=\"color-preview\">\n                    <div id=\"blackbodyObject\" class=\"glowing-orb\"></div>\n                    <p>Approximate Color</p>\n                </div>\n            </div>\n\n            <div class=\"controls-panel\">\n                <div class=\"parameter-group\">\n                    <label for=\"tempInput\">Temperature (\\(T\\))</label>\n                    <div class=\"slider-container\">\n                        <input type=\"range\" id=\"tempInput\" min=\"100\" max=\"10000\" step=\"50\" value=\"5800\">\n                        <span class=\"value-display\"><span id=\"tempVal\">5800</span> K</span>\n                    </div>\n                    <div class=\"description\">Move slider to change blackbody temperature.</div>\n                </div>\n\n                <hr>\n\n                <div class=\"results-group\">\n                    <h3>Calculation Result</h3>\n                    <div class=\"result-box\">\n                        <span class=\"label\">\\(\\lambda_{max}\\):</span>\n                        <span class=\"value\" id=\"lambdaOutput\">500</span>\n                        <span class=\"unit\" id=\"unitOutput\">nm</span>\n                    </div>\n                    \n                    <div class=\"spectrum-indicator\">\n                        <div class=\"pointer\" id=\"spectrumPointer\"></div>\n                        <div class=\"spectrum-bar\"></div>\n                        <div class=\"spectrum-labels\">\n                            <span>UV</span>\n                            <span>Visible</span>\n                            <span>IR</span>\n                        </div>\n                    </div>\n                    <p class=\"context-text\" id=\"regionText\">Region: Visible Light</p>\n                </div>\n            </div>\n\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-color: #121212;\n    --panel-bg: #1e1e1e;\n    --text-color: #e0e0e0;\n    --accent-color: #00bcd4;\n    --graph-grid: #333;\n    --graph-line: #ffeb3b;\n}\n\nbody {\n    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n    min-height: 100vh;\n}\n\n.main-container {\n    max-width: 1100px;\n    width: 100%;\n    background-color: var(--panel-bg);\n    padding: 30px;\n    border-radius: 12px;\n    box-shadow: 0 10px 30px rgba(0,0,0,0.5);\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 30px;\n    border-bottom: 1px solid #333;\n    padding-bottom: 15px;\n}\n\nh1 { margin: 0; font-weight: 300; letter-spacing: 1px; }\n.subtitle { color: #aaa; margin-top: 10px; font-size: 1.1em; }\n\n.simulation-grid {\n    display: grid;\n    grid-template-columns: 2fr 1fr;\n    gap: 30px;\n}\n\n/* Visualization Panel */\n.viz-panel {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.canvas-container {\n    position: relative;\n    background: #000;\n    border: 1px solid #444;\n    border-radius: 8px;\n    height: 350px;\n}\n\ncanvas {\n    width: 100%;\n    height: 100%;\n    display: block;\n}\n\n.graph-label {\n    position: absolute;\n    font-size: 0.8rem;\n    color: #888;\n}\n.y-axis { top: 10px; left: 10px; transform-origin: top left; }\n.x-axis { bottom: 5px; right: 10px; }\n\n.color-preview {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 15px;\n    padding: 15px;\n    background: #252525;\n    border-radius: 8px;\n}\n\n.glowing-orb {\n    width: 50px;\n    height: 50px;\n    border-radius: 50%;\n    background: #fff;\n    box-shadow: 0 0 20px 5px rgba(255, 255, 255, 0.5);\n    transition: background-color 0.1s, box-shadow 0.1s;\n}\n\n/* Controls Panel */\n.controls-panel {\n    background: #2c2c2c;\n    padding: 25px;\n    border-radius: 8px;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n}\n\n.parameter-group { margin-bottom: 20px; }\n\nlabel { display: block; margin-bottom: 10px; font-weight: 600; color: var(--accent-color); }\n\n.slider-container {\n    display: flex;\n    align-items: center;\n    gap: 15px;\n}\n\ninput[type=range] {\n    flex-grow: 1;\n    cursor: pointer;\n}\n\n.value-display {\n    font-family: 'Courier New', monospace;\n    font-weight: bold;\n    min-width: 70px;\n    text-align: right;\n}\n\n.description { font-size: 0.85rem; color: #888; margin-top: 5px; }\n\nhr { width: 100%; border: 0; border-top: 1px solid #444; margin: 20px 0; }\n\n.results-group h3 { margin-top: 0; font-size: 1rem; color: #aaa; }\n\n.result-box {\n    background: #1a1a1a;\n    padding: 15px;\n    border-radius: 6px;\n    border-left: 4px solid var(--accent-color);\n    margin-bottom: 20px;\n    font-size: 1.2rem;\n    display: flex;\n    align-items: baseline;\n    gap: 10px;\n}\n\n.result-box .value { font-size: 1.8rem; font-weight: bold; color: #fff; }\n\n/* Spectrum Bar */\n.spectrum-indicator {\n    position: relative;\n    height: 60px;\n    margin-top: 20px;\n}\n\n.spectrum-bar {\n    height: 20px;\n    width: 100%;\n    border-radius: 10px;\n    background: linear-gradient(to right, \n        #333 0%, #333 30%, /* UV area (symbolic) */\n        #4b0082 35%, #0000ff 40%, #00ff00 45%, #ffff00 50%, #ff7f00 55%, #ff0000 60%, /* Visible */\n        #333 65%, #333 100% /* IR area */\n    );\n    /* Note: This gradient is symbolic for the UI slider, actual calculation handles the logic */\n    background: linear-gradient(90deg, \n        #444 0%,      /* Far UV */\n        #800080 20%,  /* UV border */\n        #0000ff 30%,  /* Blue */\n        #00ff00 38%,  /* Green */\n        #ff0000 46%,  /* Red */\n        #440000 55%,  /* Near IR */\n        #222 100%     /* Far IR */\n    );\n    margin-bottom: 5px;\n}\n\n.pointer {\n    width: 0; \n    height: 0; \n    border-left: 8px solid transparent;\n    border-right: 8px solid transparent;\n    border-bottom: 10px solid #fff;\n    position: absolute;\n    top: 22px;\n    transform: translateX(-50%);\n    transition: left 0.1s;\n}\n\n.spectrum-labels {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.7rem;\n    color: #888;\n}\n\n.context-text {\n    text-align: center;\n    font-style: italic;\n    color: var(--accent-color);\n    margin-top: 5px;\n}\n\n@media (max-width: 800px) {\n    .simulation-grid { grid-template-columns: 1fr; }\n    .canvas-container { height: 250px; }\n}", "js": "// Constants\nconst WIEN_CONSTANT = 2.897771955e-3; // m*K\n\n// DOM Elements\nconst canvas = document.getElementById('radiationGraph');\nconst ctx = canvas.getContext('2d');\nconst tempInput = document.getElementById('tempInput');\nconst tempVal = document.getElementById('tempVal');\nconst lambdaOutput = document.getElementById('lambdaOutput');\nconst unitOutput = document.getElementById('unitOutput');\nconst regionText = document.getElementById('regionText');\nconst blackbodyObject = document.getElementById('blackbodyObject');\nconst spectrumPointer = document.getElementById('spectrumPointer');\n\n// State\nlet temperature = 5800; // Kelvin\n\n// Resize Handling\nlet width, height;\nfunction resize() {\n    width = canvas.parentElement.clientWidth;\n    height = canvas.parentElement.clientHeight;\n    canvas.width = width;\n    canvas.height = height;\n    updateSimulation();\n}\nwindow.addEventListener('resize', resize);\n\n// Main Calculation & Update Function\nfunction updateSimulation() {\n    // 1. Get Temperature\n    temperature = parseInt(tempInput.value);\n    tempVal.textContent = temperature;\n\n    // 2. Calculate Peak Wavelength (Wien's Law)\n    // lambda_max = b / T\n    const lambdaMaxMeters = WIEN_CONSTANT / temperature;\n    \n    // Convert to nice units\n    let displayVal, displayUnit;\n    let lambdaNm = lambdaMaxMeters * 1e9; // nanometers\n\n    if (lambdaNm > 1000) {\n        displayVal = (lambdaNm / 1000).toFixed(2);\n        displayUnit = \"µm\";\n    } else {\n        displayVal = Math.round(lambdaNm);\n        displayUnit = \"nm\";\n    }\n\n    lambdaOutput.textContent = displayVal;\n    unitOutput.textContent = displayUnit;\n\n    // 3. Update Visuals\n    updateGraph(lambdaNm);\n    updateColor(temperature);\n    updateSpectrumBar(lambdaNm);\n}\n\n// Draw the Blackbody Curve\nfunction updateGraph(peakNm) {\n    // We want the graph to show the shape of Planck's law.\n    // X-axis: Wavelength. Y-axis: Spectral Radiance.\n    \n    // To make the \"displacement\" visible but keep the graph readable,\n    // we need to choose a window. \n    // If we fix the window, high T peaks go off screen left, low T peaks go off screen right.\n    // A common way to visualize Wien's law is to scale the X-axis dynamically \n    // such that the peak is always roughly centered, OR let it move.\n    \n    // Let's define a visible range based on the current peak to keep it nice.\n    // Range: 0 to 4 * peak. This ensures the \"tail\" is visible.\n    const maxX = peakNm * 4; \n    \n    ctx.clearRect(0, 0, width, height);\n\n    // Draw Grid / Axes\n    ctx.strokeStyle = '#333';\n    ctx.lineWidth = 1;\n    ctx.beginPath();\n    // Y axis\n    ctx.moveTo(40, 0); ctx.lineTo(40, height - 20);\n    // X axis\n    ctx.moveTo(40, height - 20); ctx.lineTo(width, height - 20);\n    ctx.stroke();\n\n    // Plot Curve\n    // Planck's Law Shape: I(lambda) ~ (1/lambda^5) * (1 / (exp(hc/lkT) - 1))\n    // Simplified for shape relative to peak: \n    // x = lambda / lambda_max\n    // I(x) ~ 1/x^5 * 1 / (exp(4.965/x) - 1)  <-- 4.965 comes from solving dI/dl=0\n    \n    ctx.beginPath();\n    ctx.strokeStyle = '#ffeb3b';\n    ctx.lineWidth = 3;\n\n    const xStart = 40;\n    const yBase = height - 20;\n    const graphWidth = width - xStart;\n    const graphHeight = height - 40;\n\n    let first = true;\n\n    // We iterate pixels across the screen\n    for (let px = 0; px < graphWidth; px++) {\n        // Map pixel to wavelength (nm)\n        // px=0 -> nm=0, px=max -> nm=maxX\n        const nm = (px / graphWidth) * maxX;\n        \n        if (nm <= 0) continue;\n\n        // Calculate normalized intensity (0 to 1)\n        // Using dimensionless variable x = lambda / peak_lambda\n        const x = nm / peakNm;\n        \n        // Planck distribution normalized to peak = 1.0\n        // Formula: (x^-5 / (e^(4.9651/x) - 1)) normalized by peak value.\n        // Peak occurs at x=1. Value at x=1 is approx 21.2.\n        // So we divide by that to normalize to 0-1 range.\n        \n        const rawVal = (1 / Math.pow(x, 5)) * (1 / (Math.exp(4.965114 / x) - 1));\n        const normVal = rawVal * 21.2014; // Normalization factor\n\n        const py = yBase - (normVal * graphHeight * 0.9); // 0.9 to leave top margin\n\n        if (first) {\n            ctx.moveTo(xStart + px, py);\n            first = false;\n        } else {\n            ctx.lineTo(xStart + px, py);\n        }\n    }\n    ctx.stroke();\n\n    // Draw Peak Line (Wien's Law)\n    // The peak is exactly at peakNm\n    const peakPx = xStart + (peakNm / maxX) * graphWidth;\n    const peakPy = yBase - (1.0 * graphHeight * 0.9);\n\n    ctx.beginPath();\n    ctx.strokeStyle = '#00bcd4'; // Cyan\n    ctx.setLineDash([5, 5]);\n    ctx.moveTo(peakPx, yBase);\n    ctx.lineTo(peakPx, peakPy);\n    ctx.stroke();\n    ctx.setLineDash([]);\n\n    // Draw Peak Label\n    ctx.fillStyle = '#00bcd4';\n    ctx.font = '12px Arial';\n    ctx.fillText(`Peak: ${Math.round(peakNm)} nm`, peakPx + 5, peakPy + 15);\n    \n    // Draw Axis Labels (Dynamic)\n    ctx.fillStyle = '#888';\n    ctx.textAlign = 'right';\n    ctx.fillText(`${Math.round(maxX)} nm`, width, height - 5);\n}\n\n// Update the Color Sphere\nfunction updateColor(temp) {\n    const color = getKelvinRGB(temp);\n    blackbodyObject.style.backgroundColor = color;\n    blackbodyObject.style.boxShadow = `0 0 30px 10px ${color}`;\n}\n\n// Update Spectrum Bar Position\nfunction updateSpectrumBar(nm) {\n    let region = \"\";\n    let percent = 0;\n\n    // Map wavelength ranges to a simple 0-100 linear scale for the UI bar\n    // The bar gradient is: Far UV (0%) -> UV Border (20%) -> Visible (30-60%) -> IR (100%)\n    \n    if (nm < 10) {\n        region = \"X-Rays / Gamma\";\n        percent = 5;\n    } else if (nm < 380) {\n        region = \"Ultraviolet\";\n        // Map 10-380 to 5-30%\n        percent = 5 + ((nm - 10) / 370) * 25;\n    } else if (nm >= 380 && nm <= 750) {\n        region = \"Visible Light\";\n        // Map 380-750 to 30-60%\n        percent = 30 + ((nm - 380) / 370) * 30;\n    } else if (nm > 750) {\n        region = \"Infrared\";\n        // Map 750-10000+ to 60-100% (log scale approx for UI)\n        percent = 60 + Math.min(40, Math.log10(nm/750) * 20);\n    }\n\n    spectrumPointer.style.left = `${percent}%`;\n    regionText.textContent = region;\n    \n    // Change pointer color based on background darkness? Keep white.\n}\n\n// Helper: Approx RGB from Temperature (Tanner Helland's algorithm adapted)\nfunction getKelvinRGB(temp) {\n    temp = temp / 100;\n    let r, g, b;\n\n    if (temp <= 66) {\n        r = 255;\n        g = temp;\n        g = 99.4708025861 * Math.log(g) - 161.1195681661;\n        \n        if (temp <= 19) {\n            b = 0;\n        } else {\n            b = temp - 10;\n            b = 138.5177312231 * Math.log(b) - 305.0447927307;\n        }\n    } else {\n        r = temp - 60;\n        r = 329.698727446 * Math.pow(r, -0.1332047592);\n        \n        g = temp - 60;\n        g = 288.1221695283 * Math.pow(g, -0.0755148492);\n        \n        b = 255;\n    }\n\n    // Clamp\n    r = Math.min(255, Math.max(0, r));\n    g = Math.min(255, Math.max(0, g));\n    b = Math.min(255, Math.max(0, b));\n\n    return `rgb(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)})`;\n}\n\n// Event Listeners\ntempInput.addEventListener('input', updateSimulation);\n\n// Initialize\nresize();\n// Wait for resize to fire or call explicitly\nsetTimeout(updateSimulation, 100);"}}
{"input": {"input_text": "Planck spectral radiance peak frequency approximation: nu_max ≈ 2.821*kT/h. Compute peak frequency.", "simulation_name": " Planck Peak Frequency", "domain": "Thermal Radiation", "description": "Peak frequency of Planck spectrum", "assumptions": ["Blackbody"], "entities": [], "constants": [{"name": "boltzmann", "symbol": "kB", "value": 1.380649e-23, "unit": "J/K"}, {"name": "planck", "symbol": "h", "value": 6.62607015e-34, "unit": "J*s"}], "parameters": [{"name": "temperature", "symbol": "T", "unit": "K", "range": [100, 10000]}], "equations": [{"description": "Peak frequency", "expression": "nu_max = 2.821*kB*T/h"}], "initial_conditions": {}, "outputs": ["nu_max"], "simulation_controls": ["T"], "constraints": ["T>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S71 Planck Peak Frequency</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"main-card\">\n            <!-- Header -->\n            <div class=\"header\">\n                <h1>S71 Planck Peak Frequency</h1>\n                <p class=\"subtitle\">Blackbody Radiation Spectral Peak</p>\n                <div class=\"formulas\">\n                    <p class=\"formula\">νₘₐₓ ≈ 2.821 × (kᵦT/h)</p>\n                    <div class=\"constants\">\n                        <p class=\"formula-const\">kᵦ = 1.381 × 10⁻²³ J/K</p>\n                        <p class=\"formula-const\">h = 6.626 × 10⁻³⁴ J·s</p>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"content-grid\">\n                <!-- Visualization -->\n                <div class=\"visualization-section\">\n                    <h2>Blackbody Radiation Spectrum</h2>\n                    <svg id=\"spectrumCanvas\" width=\"600\" height=\"500\">\n                        <!-- Gradient definitions -->\n                        <defs>\n                            <linearGradient id=\"spectrumGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\">\n                                <stop offset=\"0%\" style=\"stop-color:#8b5cf6;stop-opacity:1\" />\n                                <stop offset=\"20%\" style=\"stop-color:#3b82f6;stop-opacity:1\" />\n                                <stop offset=\"40%\" style=\"stop-color:#10b981;stop-opacity:1\" />\n                                <stop offset=\"50%\" style=\"stop-color:#fbbf24;stop-opacity:1\" />\n                                <stop offset=\"60%\" style=\"stop-color:#f59e0b;stop-opacity:1\" />\n                                <stop offset=\"100%\" style=\"stop-color:#ef4444;stop-opacity:1\" />\n                            </linearGradient>\n                            <linearGradient id=\"curveGradient\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n                                <stop offset=\"0%\" style=\"stop-color:#fbbf24;stop-opacity:0.8\" />\n                                <stop offset=\"100%\" style=\"stop-color:#fbbf24;stop-opacity:0.1\" />\n                            </linearGradient>\n                        </defs>\n                        \n                        <!-- Background -->\n                        <rect width=\"600\" height=\"500\" fill=\"#0a0e1a\"/>\n                        \n                        <!-- Grid -->\n                        <g id=\"gridLines\" opacity=\"0.2\">\n                            <line x1=\"80\" y1=\"50\" x2=\"80\" y2=\"400\" stroke=\"#94a3b8\" stroke-width=\"2\"/>\n                            <line x1=\"80\" y1=\"400\" x2=\"570\" y2=\"400\" stroke=\"#94a3b8\" stroke-width=\"2\"/>\n                        </g>\n                        \n                        <!-- Spectrum color bar -->\n                        <rect x=\"80\" y=\"420\" width=\"490\" height=\"20\" fill=\"url(#spectrumGradient)\" rx=\"4\"/>\n                        <text x=\"80\" y=\"455\" fill=\"#94a3b8\" font-size=\"11\">UV</text>\n                        <text x=\"220\" y=\"455\" fill=\"#94a3b8\" font-size=\"11\">Visible</text>\n                        <text x=\"530\" y=\"455\" fill=\"#94a3b8\" font-size=\"11\">IR</text>\n                        \n                        <!-- Planck curve -->\n                        <path id=\"planckCurve\" d=\"\" fill=\"url(#curveGradient)\" opacity=\"0.6\"/>\n                        <path id=\"planckLine\" d=\"\" fill=\"none\" stroke=\"#fbbf24\" stroke-width=\"3\"/>\n                        \n                        <!-- Peak marker -->\n                        <g id=\"peakMarker\">\n                            <line x1=\"0\" y1=\"400\" x2=\"0\" y2=\"0\" stroke=\"#ef4444\" stroke-width=\"2\" stroke-dasharray=\"5,5\"/>\n                            <circle cx=\"0\" cy=\"0\" r=\"6\" fill=\"#ef4444\" stroke=\"#fee2e2\" stroke-width=\"2\"/>\n                            <text x=\"0\" y=\"0\" fill=\"#ef4444\" font-size=\"12\" font-weight=\"bold\" text-anchor=\"middle\">νₘₐₓ</text>\n                        </g>\n                        \n                        <!-- Axes labels -->\n                        <text x=\"300\" y=\"490\" fill=\"#cbd5e1\" font-size=\"14\" text-anchor=\"middle\" font-weight=\"bold\">Frequency (Hz)</text>\n                        <text x=\"30\" y=\"230\" fill=\"#cbd5e1\" font-size=\"14\" text-anchor=\"middle\" transform=\"rotate(-90 30 230)\" font-weight=\"bold\">Spectral Radiance</text>\n                        \n                        <!-- Temperature indicator -->\n                        <g id=\"tempIndicator\">\n                            <rect x=\"430\" y=\"60\" width=\"140\" height=\"80\" fill=\"rgba(15, 23, 42, 0.9)\" rx=\"8\" stroke=\"#475569\" stroke-width=\"2\"/>\n                            <text x=\"500\" y=\"85\" fill=\"#f1f5f9\" font-size=\"13\" font-weight=\"bold\" text-anchor=\"middle\">Temperature</text>\n                            <text id=\"tempDisplay\" x=\"500\" y=\"110\" fill=\"#fbbf24\" font-size=\"24\" font-weight=\"bold\" text-anchor=\"middle\">5778 K</text>\n                            <text id=\"tempType\" x=\"500\" y=\"130\" fill=\"#94a3b8\" font-size=\"11\" text-anchor=\"middle\">Sun's Surface</text>\n                        </g>\n                        \n                        <!-- Color representation of blackbody -->\n                        <g id=\"blackbodyGlow\">\n                            <circle id=\"glowCircle\" cx=\"500\" cy=\"300\" r=\"60\" opacity=\"0.8\"/>\n                            <circle id=\"bodyCircle\" cx=\"500\" cy=\"300\" r=\"40\" opacity=\"1\"/>\n                            <text x=\"500\" y=\"375\" fill=\"#cbd5e1\" font-size=\"12\" text-anchor=\"middle\">Blackbody</text>\n                            <text x=\"500\" y=\"390\" fill=\"#cbd5e1\" font-size=\"12\" text-anchor=\"middle\">Emission</text>\n                        </g>\n                    </svg>\n                    \n                    <!-- Legend -->\n                    <div class=\"legend\">\n                        <div class=\"legend-item\">\n                            <div class=\"legend-color\" style=\"background: #fbbf24;\"></div>\n                            <span>Planck Distribution</span>\n                        </div>\n                        <div class=\"legend-item\">\n                            <div class=\"legend-color\" style=\"background: #ef4444;\"></div>\n                            <span>Peak Frequency</span>\n                        </div>\n                        <div class=\"legend-item\">\n                            <div class=\"legend-color\" style=\"background: linear-gradient(to right, #8b5cf6, #ef4444);\"></div>\n                            <span>Electromagnetic Spectrum</span>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Controls -->\n                <div class=\"controls-section\">\n                    <h2>Blackbody Parameters</h2>\n                    \n                    <!-- Temperature Slider -->\n                    <div class=\"control-group\">\n                        <label>Temperature (T): <span id=\"tempValue\">5778</span> K</label>\n                        <input type=\"range\" id=\"tempSlider\" min=\"100\" max=\"10000\" step=\"10\" value=\"5778\">\n                        <div class=\"slider-labels\">\n                            <span>100 K</span>\n                            <span>5000 K</span>\n                            <span>10000 K</span>\n                        </div>\n                    </div>\n\n                    <!-- Preset Temperatures -->\n                    <div class=\"preset-section\">\n                        <h4>Temperature Presets</h4>\n                        <div class=\"preset-grid\">\n                            <button class=\"preset-btn\" data-temp=\"2.7\">CMB (2.7 K)</button>\n                            <button class=\"preset-btn\" data-temp=\"300\">Room (300 K)</button>\n                            <button class=\"preset-btn\" data-temp=\"1000\">Lava (1000 K)</button>\n                            <button class=\"preset-btn\" data-temp=\"3000\">Incandescent (3000 K)</button>\n                            <button class=\"preset-btn\" data-temp=\"5778\">Sun Surface (5778 K)</button>\n                            <button class=\"preset-btn\" data-temp=\"10000\">Hot Star (10000 K)</button>\n                        </div>\n                    </div>\n\n                    <!-- Results -->\n                    <div class=\"results-box\">\n                        <h3>Spectral Peak Results</h3>\n                        <div class=\"result-item result-highlight\">\n                            <span>Peak Frequency (νₘₐₓ):</span>\n                            <span id=\"peakFreqResult\" class=\"result-value-large\">3.39e14 Hz</span>\n                        </div>\n                        <div class=\"result-item\">\n                            <span>Peak Wavelength (λₘₐₓ):</span>\n                            <span id=\"peakWavelengthResult\" class=\"result-value\">502 nm</span>\n                        </div>\n                        <div class=\"result-item\">\n                            <span>Spectral Region:</span>\n                            <span id=\"spectralRegion\" class=\"result-value\">Visible (Green)</span>\n                        </div>\n                        <div class=\"result-item\">\n                            <span>Color Temperature:</span>\n                            <span id=\"colorTemp\" class=\"result-value\">Yellow-White</span>\n                        </div>\n                    </div>\n\n                    <!-- Additional Physics Info -->\n                    <div class=\"physics-panel\">\n                        <h4>Related Physics</h4>\n                        <div class=\"info-item\">\n                            <span>Wien's Displacement:</span>\n                            <span id=\"wienDisp\">λₘₐₓT = 2.90e-3 m·K</span>\n                        </div>\n                        <div class=\"info-item\">\n                            <span>Stefan-Boltzmann Power:</span>\n                            <span id=\"stefanPower\">σT⁴ ∝ T⁴</span>\n                        </div>\n                        <div class=\"info-item\">\n                            <span>Energy at Peak:</span>\n                            <span id=\"energyAtPeak\">E = hν = 2.24 eV</span>\n                        </div>\n                    </div>\n\n                    <!-- Info Box -->\n                    <div class=\"info-box\">\n                        <h4>About Planck's Law</h4>\n                        <p>Planck's radiation law describes the electromagnetic radiation emitted by a blackbody in thermal equilibrium. The peak frequency increases linearly with temperature, explaining why hot objects glow different colors.</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Physics Information -->\n        <div class=\"physics-info\">\n            <h3>Thermal Radiation Concepts</h3>\n            <div class=\"concepts-grid\">\n                <div class=\"concept-card concept-blue\">\n                    <h4>Blackbody Radiation</h4>\n                    <p>An idealized physical body that absorbs all incident electromagnetic radiation and emits thermal radiation according to Planck's law. Real objects approximate this behavior.</p>\n                </div>\n                <div class=\"concept-card concept-green\">\n                    <h4>Wien's Displacement Law</h4>\n                    <p>The peak wavelength λₘₐₓ is inversely proportional to temperature: λₘₐₓT = 2.90×10⁻³ m·K. Hot objects emit at shorter wavelengths (blue), cool objects at longer wavelengths (red).</p>\n                </div>\n                <div class=\"concept-card concept-purple\">\n                    <h4>Peak Frequency Formula</h4>\n                    <p>The approximate peak frequency νₘₐₓ ≈ 2.821kᵦT/h shows that hotter objects radiate at higher frequencies. This explains the color progression from red-hot to white-hot to blue-hot.</p>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    background: linear-gradient(135deg, #0a0e1a 0%, #1e1b4b 100%);\n    min-height: 100vh;\n    padding: 2rem;\n}\n\n.container {\n    max-width: 1500px;\n    margin: 0 auto;\n}\n\n.main-card {\n    background: linear-gradient(135deg, #1e293b 0%, #334155 100%);\n    border-radius: 1rem;\n    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);\n    padding: 2rem;\n    margin-bottom: 1.5rem;\n    border: 1px solid rgba(148, 163, 184, 0.1);\n}\n\n.header {\n    text-align: center;\n    margin-bottom: 2rem;\n}\n\n.header h1 {\n    font-size: 2.5rem;\n    color: #f1f5f9;\n    margin-bottom: 0.5rem;\n    text-shadow: 0 0 20px rgba(251, 191, 36, 0.5);\n}\n\n.subtitle {\n    color: #94a3b8;\n    font-size: 1rem;\n}\n\n.formulas {\n    margin-top: 1rem;\n    display: flex;\n    gap: 1.5rem;\n    justify-content: center;\n    align-items: center;\n    flex-wrap: wrap;\n}\n\n.formula {\n    color: #cbd5e1;\n    font-size: 0.95rem;\n    font-family: 'Courier New', monospace;\n    background: rgba(15, 23, 42, 0.5);\n    padding: 0.5rem 1.5rem;\n    border-radius: 0.5rem;\n    border: 1px solid rgba(251, 191, 36, 0.3);\n}\n\n.constants {\n    display: flex;\n    gap: 1rem;\n    flex-wrap: wrap;\n}\n\n.formula-const {\n    color: #94a3b8;\n    font-size: 0.75rem;\n    font-family: 'Courier New', monospace;\n    background: rgba(71, 85, 105, 0.3);\n    padding: 0.4rem 0.8rem;\n    border-radius: 0.375rem;\n    border: 1px solid rgba(148, 163, 184, 0.2);\n}\n\n.content-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 2rem;\n}\n\n@media (max-width: 1200px) {\n    .content-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n.visualization-section {\n    background: rgba(10, 14, 26, 0.5);\n    border-radius: 0.75rem;\n    padding: 1.5rem;\n    border: 1px solid rgba(148, 163, 184, 0.1);\n}\n\n.visualization-section h2,\n.controls-section h2 {\n    font-size: 1.25rem;\n    color: #f1f5f9;\n    margin-bottom: 1rem;\n}\n\n#spectrumCanvas {\n    display: block;\n    margin: 0 auto;\n    border-radius: 0.5rem;\n}\n\n.legend {\n    display: grid;\n    grid-template-columns: repeat(3, 1fr);\n    gap: 0.75rem;\n    margin-top: 1rem;\n    font-size: 0.875rem;\n}\n\n@media (max-width: 768px) {\n    .legend {\n        grid-template-columns: 1fr;\n    }\n}\n\n.legend-item {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    color: #cbd5e1;\n}\n\n.legend-color {\n    width: 1.5rem;\n    height: 1rem;\n    border-radius: 0.25rem;\n}\n\n.controls-section h2 {\n    margin-bottom: 1.5rem;\n}\n\n.control-group {\n    margin-bottom: 1.5rem;\n}\n\n.control-group label {\n    display: block;\n    font-size: 0.875rem;\n    font-weight: 500;\n    color: #e2e8f0;\n    margin-bottom: 0.5rem;\n}\n\n.control-group input[type=\"range\"] {\n    width: 100%;\n    height: 0.5rem;\n    background: rgba(71, 85, 105, 0.5);\n    border-radius: 0.5rem;\n    outline: none;\n    -webkit-appearance: none;\n    appearance: none;\n}\n\n.control-group input[type=\"range\"]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 1.25rem;\n    height: 1.25rem;\n    background: #fbbf24;\n    border-radius: 50%;\n    cursor: pointer;\n    box-shadow: 0 0 10px rgba(251, 191, 36, 0.5);\n}\n\n.control-group input[type=\"range\"]::-moz-range-thumb {\n    width: 1.25rem;\n    height: 1.25rem;\n    background: #fbbf24;\n    border-radius: 50%;\n    cursor: pointer;\n    border: none;\n    box-shadow: 0 0 10px rgba(251, 191, 36, 0.5);\n}\n\n.slider-labels {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.75rem;\n    color: #94a3b8;\n    margin-top: 0.25rem;\n}\n\n.preset-section {\n    margin-bottom: 1.5rem;\n}\n\n.preset-section h4 {\n    font-size: 0.875rem;\n    color: #f1f5f9;\n    margin-bottom: 0.75rem;\n    font-weight: 600;\n}\n\n.preset-grid {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 0.5rem;\n}\n\n.preset-btn {\n    padding: 0.5rem 0.75rem;\n    font-size: 0.75rem;\n    font-weight: 500;\n    background: rgba(251, 191, 36, 0.15);\n    color: #fcd34d;\n    border: 1px solid rgba(251, 191, 36, 0.3);\n    border-radius: 0.375rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.preset-btn:hover {\n    background: rgba(251, 191, 36, 0.25);\n    border-color: rgba(251, 191, 36, 0.5);\n}\n\n.results-box {\n    background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.15) 100%);\n    border-radius: 0.75rem;\n    padding: 1.5rem;\n    margin-bottom: 1.5rem;\n    border: 1px solid rgba(251, 191, 36, 0.3);\n}\n\n.results-box h3 {\n    font-size: 1.125rem;\n    color: #f1f5f9;\n    margin-bottom: 0.75rem;\n}\n\n.result-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 0.5rem;\n    color: #cbd5e1;\n    font-size: 0.875rem;\n}\n\n.result-highlight {\n    margin-bottom: 0.75rem;\n    padding-bottom: 0.75rem;\n    border-bottom: 1px solid rgba(251, 191, 36, 0.3);\n}\n\n.result-value {\n    font-family: 'Courier New', monospace;\n    font-weight: bold;\n    color: #fcd34d;\n    font-size: 1rem;\n}\n\n.result-value-large {\n    font-family: 'Courier New', monospace;\n    font-weight: bold;\n    color: #fbbf24;\n    font-size: 1.25rem;\n}\n\n.physics-panel {\n    background: rgba(59, 130, 246, 0.1);\n    border-radius: 0.75rem;\n    padding: 1rem;\n    margin-bottom: 1.5rem;\n    border: 1px solid rgba(59, 130, 246, 0.2);\n}\n\n.physics-panel h4 {\n    font-size: 0.875rem;\n    color: #f1f5f9;\n    margin-bottom: 0.75rem;\n    font-weight: 600;\n}\n\n.info-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 0.5rem;\n    color: #cbd5e1;\n    font-size: 0.75rem;\n}\n\n.info-item span:last-child {\n    font-family: 'Courier New', monospace;\n    color: #93c5fd;\n    font-size: 0.7rem;\n}\n\n.info-box {\n    background: rgba(168, 85, 247, 0.1);\n    border: 1px solid rgba(168, 85, 247, 0.3);\n    border-radius: 0.5rem;\n    padding: 1rem;\n}\n\n.info-box h4 {\n    color: #c4b5fd;\n    font-size: 0.875rem;\n    font-weight: 600;\n    margin-bottom: 0.5rem;\n}\n\n.info-box p {\n    color: #ddd6fe;\n    font-size: 0.875rem;\n    line-height: 1.5;\n}\n\n.physics-info {\n    background: linear-gradient(135deg, #1e293b 0%, #334155 100%);\n    border-radius: 0.75rem;\n    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);\n    padding: 1.5rem;\n    border: 1px solid rgba(148, 163, 184, 0.1);\n}\n\n.physics-info h3 {\n    font-size: 1.25rem;\n    color: #f1f5f9;\n    margin-bottom: 0.75rem;\n}\n\n.concepts-grid {\n    display: grid;\n    grid-template-columns: repeat(3, 1fr);\n    gap: 1rem;\n}\n\n@media (max-width: 768px) {\n    .concepts-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n.concept-card {\n    border-radius: 0.5rem;\n    padding: 1rem;\n    border: 1px solid;\n}\n\n.concept-card h4 {\n    font-size: 0.875rem;\n    font-weight: 600;\n    margin-bottom: 0.5rem;\n}\n\n.concept-card p {\n    font-size: 0.875rem;\n    line-height: 1.5;\n}\n\n.concept-blue {\n    background: rgba(59, 130, 246, 0.1);\n    border-color: rgba(59, 130, 246, 0.3);\n}\n\n.concept-blue h4 {\n    color: #60a5fa;\n}\n\n.concept-blue p {\n    color: #93c5fd;\n}\n\n.concept-green {\n    background: rgba(16, 185, 129, 0.1);\n    border-color: rgba(16, 185, 129, 0.3);\n}\n\n.concept-green h4 {\n    color: #34d399;\n}\n\n.concept-green p {\n    color: #6ee7b7;\n}\n\n.concept-purple {\n    background: rgba(168, 85, 247, 0.1);\n    border-color: rgba(168, 85, 247, 0.3);\n}\n\n.concept-purple h4 {\n    color: #a78bfa;\n}\n\n.concept-purple p {\n    color: #c4b5fd;\n}", "js": "// Physical constants\nconst KB = 1.380649e-23; // Boltzmann constant (J/K)\nconst H = 6.62607015e-34; // Planck constant (J·s)\nconst C = 299792458; // Speed of light (m/s)\nconst WIEN_CONSTANT = 2.897771955e-3; // Wien's displacement constant (m·K)\n\n// State variables\nlet temperature = 5778; // Temperature in Kelvin (Sun's surface)\nlet peakFrequency = 0;\nlet peakWavelength = 0;\n\n// DOM elements\nconst tempSlider = document.getElementById('tempSlider');\nconst tempValue = document.getElementById('tempValue');\nconst tempDisplay = document.getElementById('tempDisplay');\nconst tempType = document.getElementById('tempType');\nconst peakFreqResult = document.getElementById('peakFreqResult');\nconst peakWavelengthResult = document.getElementById('peakWavelengthResult');\nconst spectralRegion = document.getElementById('spectralRegion');\nconst colorTemp = document.getElementById('colorTemp');\nconst wienDisp = document.getElementById('wienDisp');\nconst stefanPower = document.getElementById('stefanPower');\nconst energyAtPeak = document.getElementById('energyAtPeak');\n\n// SVG elements\nconst planckCurve = document.getElementById('planckCurve');\nconst planckLine = document.getElementById('planckLine');\nconst peakMarker = document.getElementById('peakMarker');\nconst glowCircle = document.getElementById('glowCircle');\nconst bodyCircle = document.getElementById('bodyCircle');\n\n// Temperature presets with descriptions\nconst tempPresets = {\n    2.7: 'CMB',\n    300: 'Room Temp',\n    1000: 'Lava',\n    3000: 'Incandescent',\n    5778: \"Sun's Surface\",\n    10000: 'Hot Star'\n};\n\n// Format scientific notation\nfunction formatScientific(value, decimals = 2) {\n    if (value === 0) return '0';\n    const exponent = Math.floor(Math.log10(Math.abs(value)));\n    const mantissa = value / Math.pow(10, exponent);\n    return `${mantissa.toFixed(decimals)}e${exponent}`;\n}\n\n// Format wavelength with appropriate units\nfunction formatWavelength(wavelengthMeters) {\n    if (wavelengthMeters < 1e-9) {\n        return `${(wavelengthMeters * 1e12).toFixed(1)} pm`;\n    } else if (wavelengthMeters < 1e-6) {\n        return `${(wavelengthMeters * 1e9).toFixed(0)} nm`;\n    } else if (wavelengthMeters < 1e-3) {\n        return `${(wavelengthMeters * 1e6).toFixed(1)} μm`;\n    } else if (wavelengthMeters < 1) {\n        return `${(wavelengthMeters * 1e3).toFixed(1)} mm`;\n    } else {\n        return `${wavelengthMeters.toFixed(2)} m`;\n    }\n}\n\n// Determine spectral region and color\nfunction getSpectralInfo(wavelengthNm) {\n    if (wavelengthNm < 10) {\n        return { region: 'X-ray', color: 'Violet' };\n    } else if (wavelengthNm < 380) {\n        return { region: 'Ultraviolet', color: 'UV' };\n    } else if (wavelengthNm < 450) {\n        return { region: 'Visible (Violet)', color: 'Violet' };\n    } else if (wavelengthNm < 495) {\n        return { region: 'Visible (Blue)', color: 'Blue' };\n    } else if (wavelengthNm < 570) {\n        return { region: 'Visible (Green)', color: 'Green' };\n    } else if (wavelengthNm < 590) {\n        return { region: 'Visible (Yellow)', color: 'Yellow' };\n    } else if (wavelengthNm < 620) {\n        return { region: 'Visible (Orange)', color: 'Orange' };\n    } else if (wavelengthNm < 750) {\n        return { region: 'Visible (Red)', color: 'Red' };\n    } else if (wavelengthNm < 1e6) {\n        return { region: 'Infrared', color: 'IR' };\n    } else {\n        return { region: 'Radio', color: 'Radio' };\n    }\n}\n\n// Get blackbody color based on temperature\nfunction getBlackbodyColor(temp) {\n    if (temp < 1000) {\n        return { glow: '#4b0000', body: '#1a0000' };\n    } else if (temp < 2000) {\n        return { glow: '#ff4500', body: '#8b0000' };\n    } else if (temp < 3000) {\n        return { glow: '#ff6347', body: '#dc143c' };\n    } else if (temp < 4000) {\n        return { glow: '#ffa500', body: '#ff4500' };\n    } else if (temp < 5000) {\n        return { glow: '#ffff00', body: '#ffa500' };\n    } else if (temp < 6500) {\n        return { glow: '#fffacd', body: '#ffff00' };\n    } else if (temp < 8000) {\n        return { glow: '#f0f8ff', body: '#fffacd' };\n    } else {\n        return { glow: '#add8e6', body: '#87ceeb' };\n    }\n}\n\n// Get color description\nfunction getColorDescription(temp) {\n    if (temp < 1000) return 'Dim Red';\n    if (temp < 2000) return 'Red';\n    if (temp < 3000) return 'Orange-Red';\n    if (temp < 4000) return 'Orange';\n    if (temp < 5000) return 'Yellow-Orange';\n    if (temp < 6500) return 'Yellow-White';\n    if (temp < 8000) return 'White';\n    return 'Blue-White';\n}\n\n// Calculate peak frequency using Planck's approximation\nfunction calculatePeakFrequency() {\n    if (temperature > 0) {\n        // nu_max ≈ 2.821 * kB * T / h\n        peakFrequency = 2.821 * KB * temperature / H;\n        \n        // Calculate wavelength from frequency: λ = c/ν\n        peakWavelength = C / peakFrequency;\n    } else {\n        peakFrequency = 0;\n        peakWavelength = 0;\n    }\n    \n    updateResults();\n    updateVisualization();\n}\n\n// Update results display\nfunction updateResults() {\n    // Peak frequency\n    peakFreqResult.textContent = `${formatScientific(peakFrequency)} Hz`;\n    \n    // Peak wavelength\n    peakWavelengthResult.textContent = formatWavelength(peakWavelength);\n    \n    // Spectral region\n    const wavelengthNm = peakWavelength * 1e9;\n    const spectralInfo = getSpectralInfo(wavelengthNm);\n    spectralRegion.textContent = spectralInfo.region;\n    \n    // Color temperature\n    colorTemp.textContent = getColorDescription(temperature);\n    \n    // Wien's displacement\n    const wienLambda = WIEN_CONSTANT / temperature;\n    wienDisp.textContent = `λₘₐₓT = ${formatScientific(WIEN_CONSTANT, 3)} m·K`;\n    \n    // Stefan-Boltzmann (qualitative)\n    const stefanRelative = Math.pow(temperature / 5778, 4);\n    stefanPower.textContent = `${stefanRelative.toFixed(2)}× Sun`;\n    \n    // Energy at peak\n    const energyJ = H * peakFrequency;\n    const energyEv = energyJ / 1.602176634e-19;\n    energyAtPeak.textContent = `E = ${energyEv.toFixed(2)} eV`;\n}\n\n// Update visualization\nfunction updateVisualization() {\n    // Update temperature displays\n    tempDisplay.textContent = `${Math.round(temperature)} K`;\n    const presetName = tempPresets[temperature] || '';\n    tempType.textContent = presetName || `${Math.round(temperature)} K`;\n    \n    // Update blackbody glow color\n    const colors = getBlackbodyColor(temperature);\n    glowCircle.setAttribute('fill', colors.glow);\n    bodyCircle.setAttribute('fill', colors.body);\n    \n    // Draw Planck curve\n    drawPlanckCurve();\n}\n\n// Draw the Planck distribution curve\nfunction drawPlanckCurve() {\n    const width = 490;\n    const height = 350;\n    const offsetX = 80;\n    const offsetY = 50;\n    \n    // Frequency range for visualization (log scale)\n    const minFreqLog = 13; // 10^13 Hz\n    const maxFreqLog = 16; // 10^16 Hz\n    const peakFreqLog = Math.log10(peakFrequency);\n    \n    // Adjust range to center on peak\n    const rangeLog = 2; // ±2 orders of magnitude from peak\n    const centerLog = peakFreqLog;\n    const startLog = Math.max(12, centerLog - rangeLog);\n    const endLog = Math.min(17, centerLog + rangeLog);\n    \n    const points = 100;\n    let pathData = '';\n    let lineData = '';\n    let maxIntensity = 0;\n    \n    // Calculate curve points\n    const intensities = [];\n    for (let i = 0; i <= points; i++) {\n        const freqLog = startLog + (endLog - startLog) * i / points;\n        const freq = Math.pow(10, freqLog);\n        \n        // Simplified Planck function (relative intensity)\n        const x = H * freq / (KB * temperature);\n        let intensity;\n        if (x > 100) {\n            intensity = 0;\n        } else {\n            intensity = Math.pow(freq, 3) / (Math.exp(x) - 1);\n        }\n        \n        intensities.push(intensity);\n        if (intensity > maxIntensity) maxIntensity = intensity;\n    }\n    \n    // Normalize and create path\n    for (let i = 0; i <= points; i++) {\n        const freqLog = startLog + (endLog - startLog) * i / points;\n        const x = offsetX + (freqLog - startLog) / (endLog - startLog) * width;\n        const normalizedIntensity = intensities[i] / maxIntensity;\n        const y = offsetY + height - normalizedIntensity * height;\n        \n        if (i === 0) {\n            pathData += `M ${x} ${offsetY + height} L ${x} ${y}`;\n            lineData += `M ${x} ${y}`;\n        } else {\n            pathData += ` L ${x} ${y}`;\n            lineData += ` L ${x} ${y}`;\n        }\n    }\n    \n    pathData += ` L ${offsetX + width} ${offsetY + height} Z`;\n    \n    planckCurve.setAttribute('d', pathData);\n    planckLine.setAttribute('d', lineData);\n    \n    // Position peak marker\n    const peakX = offsetX + (peakFreqLog - startLog) / (endLog - startLog) * width;\n    const peakIdx = Math.round((peakFreqLog - startLog) / (endLog - startLog) * points);\n    const peakIntensity = peakIdx >= 0 && peakIdx < intensities.length ? \n        intensities[peakIdx] / maxIntensity : 0.8;\n    const peakY = offsetY + height - peakIntensity * height;\n    \n    peakMarker.querySelector('line').setAttribute('x1', peakX);\n    peakMarker.querySelector('line').setAttribute('x2', peakX);\n    peakMarker.querySelector('circle').setAttribute('cx', peakX);\n    peakMarker.querySelector('circle').setAttribute('cy', peakY);\n    peakMarker.querySelector('text').setAttribute('x', peakX);\n    peakMarker.querySelector('text').setAttribute('y', peakY - 15);\n}\n\n// Event listeners\ntempSlider.addEventListener('input', (e) => {\n    temperature = parseFloat(e.target.value);\n    tempValue.textContent = Math.round(temperature);\n    calculatePeakFrequency();\n});\n\n// Preset buttons\ndocument.querySelectorAll('.preset-btn').forEach(btn => {\n    btn.addEventListener('click', () => {\n        temperature = parseFloat(btn.dataset.temp);\n        tempSlider.value = temperature;\n        tempValue.textContent = Math.round(temperature);\n        calculatePeakFrequency();\n    });\n});\n\n// Initialize\ncalculatePeakFrequency();"}}
{"input": {"input_text": "Fourier series resolution: frequency bin width df = fs/N. Compute df for sampling rate fs and N points.", "simulation_name": " FFT Resolution", "domain": "Signal Processing", "description": "DFT bin spacing", "assumptions": ["Uniform sampling"], "entities": [], "constants": [], "parameters": [{"name": "sample_rate", "symbol": "fs", "unit": "Hz", "range": [1, 1000000000.0]}, {"name": "samples", "symbol": "N", "unit": "count", "range": [2, 10000000.0]}], "equations": [{"description": "Bin width", "expression": "df = fs/N"}], "initial_conditions": {}, "outputs": ["df"], "simulation_controls": ["fs", "N"], "constraints": ["N>0", "fs>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S72 FFT Resolution</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"card\">\n            <h1>S72 FFT Resolution</h1>\n            <p class=\"subtitle\">Fourier Series Resolution: Frequency Bin Width df = fs/N</p>\n\n            <div class=\"controls-grid\">\n                <div class=\"control-panel\">\n                    <label>\n                        Sampling Rate (fs): <span id=\"fs-value\">1000 Hz</span>\n                    </label>\n                    <input type=\"range\" id=\"fs-slider\" min=\"1\" max=\"100000\" step=\"1\" value=\"1000\">\n                    <div class=\"range-labels\">\n                        <span>1 Hz</span>\n                        <span>100 kHz</span>\n                    </div>\n                </div>\n\n                <div class=\"control-panel\">\n                    <label>\n                        Number of Samples (N): <span id=\"n-value\">1024</span>\n                    </label>\n                    <input type=\"range\" id=\"n-slider\" min=\"2\" max=\"16384\" step=\"2\" value=\"1024\">\n                    <div class=\"range-labels\">\n                        <span>2</span>\n                        <span>16384</span>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"result-panel\">\n                <h2>Frequency Bin Width (df)</h2>\n                <div class=\"result-value\" id=\"df-value\">0.98 Hz</div>\n                <div class=\"formula\" id=\"formula\">df = 1000 / 1024 Hz</div>\n            </div>\n\n            <div class=\"visualization\">\n                <h3>Frequency Spectrum Visualization</h3>\n                <div class=\"chart-container\">\n                    <canvas id=\"spectrum-canvas\"></canvas>\n                </div>\n                <div class=\"chart-note\">\n                    Each bin represents a frequency range of <span id=\"bin-width\">0.98</span> Hz\n                </div>\n            </div>\n\n            <div class=\"info-box\">\n                <h4>💡 Key Insights</h4>\n                <ul>\n                    <li>Higher sampling rate (fs) → Wider frequency bin spacing</li>\n                    <li>More samples (N) → Narrower frequency bin spacing (better resolution)</li>\n                    <li>To resolve two closely spaced frequencies, they must be at least df apart</li>\n                    <li>FFT resolution is independent of signal frequency content</li>\n                </ul>\n            </div>\n        </div>\n    </div>\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Arial', sans-serif;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    min-height: 100vh;\n    padding: 20px;\n}\n\n.container {\n    max-width: 1200px;\n    margin: 0 auto;\n}\n\n.card {\n    background: white;\n    border-radius: 15px;\n    padding: 30px;\n    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);\n}\n\nh1 {\n    text-align: center;\n    color: #667eea;\n    margin-bottom: 10px;\n    font-size: 2em;\n}\n\n.subtitle {\n    text-align: center;\n    color: #666;\n    margin-bottom: 30px;\n}\n\n.controls-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n    gap: 20px;\n    margin-bottom: 30px;\n}\n\n.control-panel {\n    background: #f8f9fa;\n    padding: 20px;\n    border-radius: 10px;\n    border: 2px solid #667eea;\n}\n\n.control-panel:nth-child(2) {\n    border-color: #764ba2;\n}\n\n.control-panel label {\n    display: block;\n    margin-bottom: 10px;\n    font-weight: bold;\n    color: #333;\n}\n\n.control-panel label span {\n    color: #667eea;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    height: 8px;\n    border-radius: 5px;\n    outline: none;\n    -webkit-appearance: none;\n    background: #ddd;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #667eea;\n    cursor: pointer;\n}\n\ninput[type=\"range\"]::-moz-range-thumb {\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #667eea;\n    cursor: pointer;\n    border: none;\n}\n\n.range-labels {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.8em;\n    color: #666;\n    margin-top: 5px;\n}\n\n.result-panel {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    padding: 30px;\n    border-radius: 10px;\n    margin-bottom: 30px;\n    text-align: center;\n    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);\n}\n\n.result-panel h2 {\n    margin: 0 0 10px 0;\n    font-size: 1.2em;\n}\n\n.result-value {\n    font-size: 3em;\n    font-weight: bold;\n    margin-bottom: 10px;\n}\n\n.formula {\n    font-size: 1em;\n    opacity: 0.9;\n}\n\n.visualization {\n    background: #f8f9fa;\n    padding: 20px;\n    border-radius: 10px;\n    margin-bottom: 20px;\n}\n\n.visualization h3 {\n    margin-top: 0;\n    color: #333;\n}\n\n.chart-container {\n    position: relative;\n    width: 100%;\n    height: 300px;\n    background: white;\n    border-radius: 5px;\n    margin-top: 15px;\n    padding: 10px;\n}\n\n#spectrum-canvas {\n    display: block;\n    width: 100%;\n    height: 100%;\n}\n\n.chart-note {\n    text-align: center;\n    margin-top: 10px;\n    color: #666;\n    font-size: 0.9em;\n}\n\n.chart-note span {\n    font-weight: bold;\n    color: #667eea;\n}\n\n.info-box {\n    background: #fff3cd;\n    border: 1px solid #ffc107;\n    border-radius: 10px;\n    padding: 15px;\n}\n\n.info-box h4 {\n    margin-top: 0;\n    color: #856404;\n}\n\n.info-box ul {\n    margin: 0;\n    padding-left: 20px;\n    color: #856404;\n}\n\n.info-box li {\n    margin: 5px 0;\n}\n\n@media (max-width: 768px) {\n    .card {\n        padding: 20px;\n    }\n    \n    h1 {\n        font-size: 1.5em;\n    }\n    \n    .result-value {\n        font-size: 2em;\n    }\n}", "js": "let fs = 1000;\nlet N = 1024;\nlet df = 0;\nlet spectrumData = [];\n\nconst fsSlider = document.getElementById('fs-slider');\nconst nSlider = document.getElementById('n-slider');\nconst fsValue = document.getElementById('fs-value');\nconst nValue = document.getElementById('n-value');\nconst dfValue = document.getElementById('df-value');\nconst formula = document.getElementById('formula');\nconst binWidth = document.getElementById('bin-width');\nconst canvas = document.getElementById('spectrum-canvas');\nconst ctx = canvas.getContext('2d');\n\nfunction formatNumber(num) {\n    if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';\n    if (num >= 1e3) return (num / 1e3).toFixed(2) + 'k';\n    if (num < 0.01) return num.toExponential(2);\n    return num.toFixed(2);\n}\n\nfunction calculateDf() {\n    df = fs / N;\n    dfValue.textContent = formatNumber(df) + ' Hz';\n    formula.textContent = `df = ${formatNumber(fs)} / ${formatNumber(N)} Hz`;\n    binWidth.textContent = formatNumber(df);\n}\n\nfunction generateSpectrumData() {\n    spectrumData = [];\n    const numBins = Math.min(50, N / 2);\n    \n    for (let i = 0; i < numBins; i++) {\n        spectrumData.push({\n            bin: i,\n            frequency: i * df,\n            magnitude: Math.random() * 0.3 + 0.1\n        });\n    }\n}\n\nfunction drawSpectrum() {\n    const width = canvas.width;\n    const height = canvas.height;\n    \n    ctx.clearRect(0, 0, width, height);\n    \n    if (spectrumData.length === 0) return;\n    \n    const padding = { top: 20, right: 30, bottom: 50, left: 60 };\n    const chartWidth = width - padding.left - padding.right;\n    const chartHeight = height - padding.top - padding.bottom;\n    \n    // Draw background\n    ctx.fillStyle = '#fafafa';\n    ctx.fillRect(padding.left, padding.top, chartWidth, chartHeight);\n    \n    // Draw grid lines\n    ctx.strokeStyle = '#e0e0e0';\n    ctx.lineWidth = 1;\n    \n    // Horizontal grid lines\n    for (let i = 0; i <= 5; i++) {\n        const y = padding.top + (chartHeight * i / 5);\n        ctx.beginPath();\n        ctx.moveTo(padding.left, y);\n        ctx.lineTo(padding.left + chartWidth, y);\n        ctx.stroke();\n        \n        // Y-axis labels\n        ctx.fillStyle = '#666';\n        ctx.font = '11px Arial';\n        ctx.textAlign = 'right';\n        ctx.textBaseline = 'middle';\n        ctx.fillText((1 - i / 5).toFixed(1), padding.left - 8, y);\n    }\n    \n    // Vertical grid lines\n    const numVerticalLines = 5;\n    for (let i = 0; i <= numVerticalLines; i++) {\n        const x = padding.left + (chartWidth * i / numVerticalLines);\n        ctx.strokeStyle = '#e0e0e0';\n        ctx.beginPath();\n        ctx.moveTo(x, padding.top);\n        ctx.lineTo(x, padding.top + chartHeight);\n        ctx.stroke();\n    }\n    \n    // Draw line chart\n    ctx.strokeStyle = '#667eea';\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    \n    const maxFreq = spectrumData[spectrumData.length - 1].frequency;\n    \n    spectrumData.forEach((point, index) => {\n        const x = padding.left + (point.frequency / maxFreq) * chartWidth;\n        const y = padding.top + chartHeight - (point.magnitude * chartHeight);\n        \n        if (index === 0) {\n            ctx.moveTo(x, y);\n        } else {\n            ctx.lineTo(x, y);\n        }\n    });\n    \n    ctx.stroke();\n    \n    // Draw dots\n    spectrumData.forEach(point => {\n        const x = padding.left + (point.frequency / maxFreq) * chartWidth;\n        const y = padding.top + chartHeight - (point.magnitude * chartHeight);\n        \n        ctx.fillStyle = '#667eea';\n        ctx.beginPath();\n        ctx.arc(x, y, 3, 0, Math.PI * 2);\n        ctx.fill();\n    });\n    \n    // Draw axes\n    ctx.strokeStyle = '#333';\n    ctx.lineWidth = 2;\n    \n    // X-axis\n    ctx.beginPath();\n    ctx.moveTo(padding.left, padding.top + chartHeight);\n    ctx.lineTo(padding.left + chartWidth, padding.top + chartHeight);\n    ctx.stroke();\n    \n    // Y-axis\n    ctx.beginPath();\n    ctx.moveTo(padding.left, padding.top);\n    ctx.lineTo(padding.left, padding.top + chartHeight);\n    ctx.stroke();\n    \n    // X-axis label\n    ctx.fillStyle = '#333';\n    ctx.font = '12px Arial';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'top';\n    ctx.fillText('Frequency (Hz)', padding.left + chartWidth / 2, height - 20);\n    \n    // Y-axis label\n    ctx.save();\n    ctx.translate(15, padding.top + chartHeight / 2);\n    ctx.rotate(-Math.PI / 2);\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'top';\n    ctx.fillText('Magnitude', 0, 0);\n    ctx.restore();\n    \n    // X-axis tick labels\n    ctx.fillStyle = '#666';\n    ctx.font = '11px Arial';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'top';\n    \n    for (let i = 0; i <= numVerticalLines; i++) {\n        const freq = (maxFreq * i / numVerticalLines);\n        const x = padding.left + (chartWidth * i / numVerticalLines);\n        ctx.fillText(formatNumber(freq), x, padding.top + chartHeight + 5);\n    }\n}\n\nfunction resizeCanvas() {\n    const container = canvas.parentElement;\n    const rect = container.getBoundingClientRect();\n    \n    // Set canvas size with device pixel ratio for sharp rendering\n    const dpr = window.devicePixelRatio || 1;\n    canvas.width = rect.width * dpr;\n    canvas.height = rect.height * dpr;\n    \n    // Scale context to match device pixel ratio\n    ctx.scale(dpr, dpr);\n    \n    // Set CSS size\n    canvas.style.width = rect.width + 'px';\n    canvas.style.height = rect.height + 'px';\n    \n    drawSpectrum();\n}\n\nfunction updateSimulation() {\n    calculateDf();\n    generateSpectrumData();\n    drawSpectrum();\n}\n\nfsSlider.addEventListener('input', (e) => {\n    fs = parseFloat(e.target.value);\n    fsValue.textContent = formatNumber(fs) + ' Hz';\n    updateSimulation();\n});\n\nnSlider.addEventListener('input', (e) => {\n    N = parseInt(e.target.value);\n    nValue.textContent = formatNumber(N);\n    updateSimulation();\n});\n\nwindow.addEventListener('resize', resizeCanvas);\n\n// Initialize\nresizeCanvas();\nupdateSimulation();"}}
{"input": {"input_text": "Nyquist sampling theorem: fs >= 2*fb. Check if sampling rate is sufficient for given max frequency fb.", "simulation_name": " Nyquist Check", "domain": "Signal Processing", "description": "Aliasing check", "assumptions": ["Bandlimited"], "entities": [], "constants": [], "parameters": [{"name": "bandlimit", "symbol": "fb", "unit": "Hz", "range": [1, 100000000.0]}, {"name": "sample_rate", "symbol": "fs", "unit": "Hz", "range": [1, 1000000000.0]}], "equations": [{"description": "Condition", "expression": "valid = fs >= 2*fb"}], "initial_conditions": {}, "outputs": ["valid"], "simulation_controls": ["fb", "fs"], "constraints": ["fb>0", "fs>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S73 Nyquist Check</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"card\">\n            <h1>S73 Nyquist Check</h1>\n            <p class=\"subtitle\">Nyquist Sampling Theorem: fs ≥ 2·fb</p>\n\n            <div class=\"controls-grid\">\n                <div class=\"control-panel\">\n                    <label>\n                        Maximum Frequency (fb): <span id=\"fb-value\">1000 Hz</span>\n                    </label>\n                    <input type=\"range\" id=\"fb-slider\" min=\"1\" max=\"10000\" step=\"1\" value=\"1000\">\n                    <div class=\"range-labels\">\n                        <span>1 Hz</span>\n                        <span>10 kHz</span>\n                    </div>\n                </div>\n\n                <div class=\"control-panel\">\n                    <label>\n                        Sampling Rate (fs): <span id=\"fs-value\">5000 Hz</span>\n                    </label>\n                    <input type=\"range\" id=\"fs-slider\" min=\"1\" max=\"20000\" step=\"1\" value=\"5000\">\n                    <div class=\"range-labels\">\n                        <span>1 Hz</span>\n                        <span>20 kHz</span>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"result-panel\" id=\"result-panel\">\n                <div class=\"status-icon\" id=\"status-icon\">✓</div>\n                <h2 id=\"status-text\">Sampling Rate is Sufficient</h2>\n                <div class=\"result-details\">\n                    <div class=\"detail-item\">\n                        <span class=\"label\">Nyquist Rate (2·fb):</span>\n                        <span class=\"value\" id=\"nyquist-value\">2000 Hz</span>\n                    </div>\n                    <div class=\"detail-item\">\n                        <span class=\"label\">Current Sampling Rate:</span>\n                        <span class=\"value\" id=\"current-fs\">5000 Hz</span>\n                    </div>\n                    <div class=\"detail-item\">\n                        <span class=\"label\">Margin:</span>\n                        <span class=\"value\" id=\"margin-value\">+3000 Hz</span>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"visualization\">\n                <h3>Signal Visualization</h3>\n                <div class=\"chart-container\">\n                    <canvas id=\"signal-canvas\"></canvas>\n                </div>\n            </div>\n\n            <div class=\"info-box\">\n                <h4> Nyquist Sampling Theorem</h4>\n                <ul>\n                    <li><strong>Valid Sampling:</strong> fs ≥ 2·fb prevents aliasing</li>\n                    <li><strong>Nyquist Rate:</strong> Minimum sampling rate = 2·fb</li>\n                    <li><strong>Aliasing occurs</strong> when fs < 2·fb (undersampling)</li>\n                    <li><strong>Oversampling:</strong> fs > 2·fb provides margin for practical filters</li>\n                </ul>\n            </div>\n        </div>\n    </div>\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Arial', sans-serif;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    min-height: 100vh;\n    padding: 20px;\n}\n\n.container {\n    max-width: 1200px;\n    margin: 0 auto;\n}\n\n.card {\n    background: white;\n    border-radius: 15px;\n    padding: 30px;\n    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);\n}\n\nh1 {\n    text-align: center;\n    color: #667eea;\n    margin-bottom: 10px;\n    font-size: 2em;\n}\n\n.subtitle {\n    text-align: center;\n    color: #666;\n    margin-bottom: 30px;\n    font-size: 1.1em;\n}\n\n.controls-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n    gap: 20px;\n    margin-bottom: 30px;\n}\n\n.control-panel {\n    background: #f8f9fa;\n    padding: 20px;\n    border-radius: 10px;\n    border: 2px solid #667eea;\n}\n\n.control-panel:nth-child(2) {\n    border-color: #764ba2;\n}\n\n.control-panel label {\n    display: block;\n    margin-bottom: 10px;\n    font-weight: bold;\n    color: #333;\n}\n\n.control-panel label span {\n    color: #667eea;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    height: 8px;\n    border-radius: 5px;\n    outline: none;\n    -webkit-appearance: none;\n    background: #ddd;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #667eea;\n    cursor: pointer;\n}\n\ninput[type=\"range\"]::-moz-range-thumb {\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #667eea;\n    cursor: pointer;\n    border: none;\n}\n\n.range-labels {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.8em;\n    color: #666;\n    margin-top: 5px;\n}\n\n.result-panel {\n    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);\n    color: white;\n    padding: 30px;\n    border-radius: 10px;\n    margin-bottom: 30px;\n    text-align: center;\n    box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);\n    transition: all 0.3s ease;\n}\n\n.result-panel.invalid {\n    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);\n    box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);\n}\n\n.status-icon {\n    font-size: 4em;\n    margin-bottom: 10px;\n    animation: pulse 2s infinite;\n}\n\n@keyframes pulse {\n    0%, 100% { transform: scale(1); }\n    50% { transform: scale(1.1); }\n}\n\n.result-panel h2 {\n    margin: 0 0 20px 0;\n    font-size: 1.5em;\n}\n\n.result-details {\n    display: flex;\n    justify-content: space-around;\n    flex-wrap: wrap;\n    gap: 15px;\n    margin-top: 20px;\n}\n\n.detail-item {\n    background: rgba(255, 255, 255, 0.2);\n    padding: 15px 20px;\n    border-radius: 8px;\n    min-width: 200px;\n}\n\n.detail-item .label {\n    display: block;\n    font-size: 0.9em;\n    opacity: 0.9;\n    margin-bottom: 5px;\n}\n\n.detail-item .value {\n    display: block;\n    font-size: 1.3em;\n    font-weight: bold;\n}\n\n.visualization {\n    background: #f8f9fa;\n    padding: 20px;\n    border-radius: 10px;\n    margin-bottom: 20px;\n}\n\n.visualization h3 {\n    margin-top: 0;\n    color: #333;\n    margin-bottom: 15px;\n}\n\n.chart-container {\n    position: relative;\n    width: 100%;\n    height: 400px;\n    background: white;\n    border-radius: 5px;\n    padding: 10px;\n}\n\n#signal-canvas {\n    display: block;\n    width: 100%;\n    height: 100%;\n}\n\n.info-box {\n    background: #e7f3ff;\n    border: 1px solid #2196F3;\n    border-radius: 10px;\n    padding: 15px;\n}\n\n.info-box h4 {\n    margin-top: 0;\n    color: #1976D2;\n}\n\n.info-box ul {\n    margin: 10px 0 0 0;\n    padding-left: 20px;\n    color: #1565C0;\n}\n\n.info-box li {\n    margin: 8px 0;\n}\n\n.info-box strong {\n    color: #0D47A1;\n}\n\n@media (max-width: 768px) {\n    .card {\n        padding: 20px;\n    }\n    \n    h1 {\n        font-size: 1.5em;\n    }\n    \n    .result-panel h2 {\n        font-size: 1.2em;\n    }\n    \n    .result-details {\n        flex-direction: column;\n    }\n    \n    .chart-container {\n        height: 300px;\n    }\n}", "js": "let fb = 1000;\nlet fs = 5000;\nlet valid = true;\nlet nyquistRate = 2000;\n\nconst fbSlider = document.getElementById('fb-slider');\nconst fsSlider = document.getElementById('fs-slider');\nconst fbValue = document.getElementById('fb-value');\nconst fsValue = document.getElementById('fs-value');\nconst resultPanel = document.getElementById('result-panel');\nconst statusIcon = document.getElementById('status-icon');\nconst statusText = document.getElementById('status-text');\nconst nyquistValue = document.getElementById('nyquist-value');\nconst currentFs = document.getElementById('current-fs');\nconst marginValue = document.getElementById('margin-value');\nconst canvas = document.getElementById('signal-canvas');\nconst ctx = canvas.getContext('2d');\n\nfunction formatNumber(num) {\n    if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';\n    if (num >= 1e3) return (num / 1e3).toFixed(2) + 'k';\n    return num.toFixed(0);\n}\n\nfunction checkNyquist() {\n    nyquistRate = 2 * fb;\n    valid = fs >= nyquistRate;\n    \n    nyquistValue.textContent = formatNumber(nyquistRate) + ' Hz';\n    currentFs.textContent = formatNumber(fs) + ' Hz';\n    \n    const margin = fs - nyquistRate;\n    marginValue.textContent = (margin >= 0 ? '+' : '') + formatNumber(margin) + ' Hz';\n    \n    if (valid) {\n        resultPanel.classList.remove('invalid');\n        statusIcon.textContent = '✓';\n        statusText.textContent = 'Sampling Rate is Sufficient';\n    } else {\n        resultPanel.classList.add('invalid');\n        statusIcon.textContent = '✗';\n        statusText.textContent = 'Aliasing Will Occur!';\n    }\n}\n\nfunction drawSignalVisualization() {\n    const width = canvas.width;\n    const height = canvas.height;\n    \n    ctx.clearRect(0, 0, width, height);\n    \n    const padding = { top: 30, right: 30, bottom: 60, left: 60 };\n    const chartWidth = width - padding.left - padding.right;\n    const chartHeight = (height - padding.top - padding.bottom - 40) / 2;\n    \n    // Draw original signal (top)\n    drawWaveform(\n        padding.left, \n        padding.top, \n        chartWidth, \n        chartHeight, \n        'Original Signal (fb = ' + formatNumber(fb) + ' Hz)',\n        false\n    );\n    \n    // Draw sampled signal (bottom)\n    drawWaveform(\n        padding.left, \n        padding.top + chartHeight + 40, \n        chartWidth, \n        chartHeight, \n        'Sampled Signal (fs = ' + formatNumber(fs) + ' Hz)',\n        true\n    );\n}\n\nfunction drawWaveform(x, y, w, h, title, showSamples) {\n    // Background\n    ctx.fillStyle = '#fafafa';\n    ctx.fillRect(x, y, w, h);\n    \n    // Grid\n    ctx.strokeStyle = '#e0e0e0';\n    ctx.lineWidth = 1;\n    for (let i = 0; i <= 4; i++) {\n        const gridY = y + (h * i / 4);\n        ctx.beginPath();\n        ctx.moveTo(x, gridY);\n        ctx.lineTo(x + w, gridY);\n        ctx.stroke();\n    }\n    \n    // Title\n    ctx.fillStyle = '#333';\n    ctx.font = 'bold 12px Arial';\n    ctx.textAlign = 'left';\n    ctx.fillText(title, x, y - 10);\n    \n    // Draw continuous signal\n    ctx.strokeStyle = valid ? '#667eea' : '#dc3545';\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    \n    const cycles = 3;\n    const points = 500;\n    \n    for (let i = 0; i <= points; i++) {\n        const t = (i / points) * cycles;\n        const xPos = x + (i / points) * w;\n        const signal = Math.sin(2 * Math.PI * t);\n        const yPos = y + h/2 - (signal * h * 0.4);\n        \n        if (i === 0) {\n            ctx.moveTo(xPos, yPos);\n        } else {\n            ctx.lineTo(xPos, yPos);\n        }\n    }\n    ctx.stroke();\n    \n    // Draw sample points if requested\n    if (showSamples) {\n        const samplesPerCycle = fs / fb;\n        const totalSamples = Math.floor(cycles * samplesPerCycle);\n        \n        ctx.fillStyle = valid ? '#28a745' : '#dc3545';\n        \n        for (let i = 0; i <= totalSamples; i++) {\n            const t = (i / samplesPerCycle);\n            const xPos = x + (t / cycles) * w;\n            const signal = Math.sin(2 * Math.PI * t);\n            const yPos = y + h/2 - (signal * h * 0.4);\n            \n            // Draw sample stem\n            ctx.strokeStyle = valid ? '#28a745' : '#dc3545';\n            ctx.lineWidth = 1.5;\n            ctx.beginPath();\n            ctx.moveTo(xPos, y + h/2);\n            ctx.lineTo(xPos, yPos);\n            ctx.stroke();\n            \n            // Draw sample point\n            ctx.beginPath();\n            ctx.arc(xPos, yPos, 4, 0, Math.PI * 2);\n            ctx.fill();\n        }\n        \n        // Draw reconstructed signal (dashed) if undersampled\n        if (!valid) {\n            ctx.strokeStyle = '#ffc107';\n            ctx.lineWidth = 2;\n            ctx.setLineDash([5, 5]);\n            ctx.beginPath();\n            \n            const aliasedFreq = Math.abs(fs - fb);\n            \n            for (let i = 0; i <= points; i++) {\n                const t = (i / points) * cycles;\n                const xPos = x + (i / points) * w;\n                const signal = Math.sin(2 * Math.PI * t * (aliasedFreq / fb));\n                const yPos = y + h/2 - (signal * h * 0.4);\n                \n                if (i === 0) {\n                    ctx.moveTo(xPos, yPos);\n                } else {\n                    ctx.lineTo(xPos, yPos);\n                }\n            }\n            ctx.stroke();\n            ctx.setLineDash([]);\n        }\n    }\n    \n    // Axes\n    ctx.strokeStyle = '#333';\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.moveTo(x, y + h/2);\n    ctx.lineTo(x + w, y + h/2);\n    ctx.stroke();\n    \n    // Y-axis labels\n    ctx.fillStyle = '#666';\n    ctx.font = '10px Arial';\n    ctx.textAlign = 'right';\n    ctx.textBaseline = 'middle';\n    ctx.fillText('1', x - 5, y);\n    ctx.fillText('0', x - 5, y + h/2);\n    ctx.fillText('-1', x - 5, y + h);\n    \n    // X-axis label\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'top';\n    ctx.fillText('Time', x + w/2, y + h + 5);\n}\n\nfunction resizeCanvas() {\n    const container = canvas.parentElement;\n    const rect = container.getBoundingClientRect();\n    \n    const dpr = window.devicePixelRatio || 1;\n    canvas.width = rect.width * dpr;\n    canvas.height = rect.height * dpr;\n    \n    ctx.scale(dpr, dpr);\n    \n    canvas.style.width = rect.width + 'px';\n    canvas.style.height = rect.height + 'px';\n    \n    drawSignalVisualization();\n}\n\nfunction updateSimulation() {\n    checkNyquist();\n    drawSignalVisualization();\n}\n\nfbSlider.addEventListener('input', (e) => {\n    fb = parseFloat(e.target.value);\n    fbValue.textContent = formatNumber(fb) + ' Hz';\n    updateSimulation();\n});\n\nfsSlider.addEventListener('input', (e) => {\n    fs = parseFloat(e.target.value);\n    fsValue.textContent = formatNumber(fs) + ' Hz';\n    updateSimulation();\n});\n\nwindow.addEventListener('resize', resizeCanvas);\n\n// Initialize\nresizeCanvas();\nupdateSimulation();"}}
{"input": {"input_text": "Butterworth low-pass magnitude: |H(jw)| = 1/sqrt(1 + (w/wc)^{2n}). Compute magnitude at frequency w.", "simulation_name": " Butterworth Magnitude", "domain": "Signal Processing", "description": "Butterworth LPF magnitude", "assumptions": ["Normalized gain"], "entities": [], "constants": [], "parameters": [{"name": "order", "symbol": "n", "unit": "dimensionless", "range": [1, 10]}, {"name": "cutoff", "symbol": "wc", "unit": "rad/s", "range": [1, 1000000.0]}, {"name": "frequency", "symbol": "w", "unit": "rad/s", "range": [0, 10000000.0]}], "equations": [{"description": "Magnitude", "expression": "Mag = 1/sqrt(1 + (w/wc)^{2*n})"}], "initial_conditions": {}, "outputs": ["Mag"], "simulation_controls": ["n", "wc", "w"], "constraints": ["n>=1", "wc>0", "w>=0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S74 Butterworth Magnitude</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"card\">\n            <h1>S74 Butterworth Magnitude</h1>\n            <p class=\"subtitle\">Butterworth Low-Pass Filter: |H(jω)| = 1/√(1 + (ω/ωc)^(2n))</p>\n\n            <div class=\"controls-grid\">\n                <div class=\"control-panel\">\n                    <label>\n                        Filter Order (n): <span id=\"n-value\">2</span>\n                    </label>\n                    <input type=\"range\" id=\"n-slider\" min=\"1\" max=\"10\" step=\"1\" value=\"2\">\n                    <div class=\"range-labels\">\n                        <span>1</span>\n                        <span>10</span>\n                    </div>\n                </div>\n\n                <div class=\"control-panel\">\n                    <label>\n                        Cutoff Frequency (ωc): <span id=\"wc-value\">1000 rad/s</span>\n                    </label>\n                    <input type=\"range\" id=\"wc-slider\" min=\"1\" max=\"10000\" step=\"1\" value=\"1000\">\n                    <div class=\"range-labels\">\n                        <span>1 rad/s</span>\n                        <span>10k rad/s</span>\n                    </div>\n                </div>\n\n                <div class=\"control-panel\">\n                    <label>\n                        Test Frequency (ω): <span id=\"w-value\">500 rad/s</span>\n                    </label>\n                    <input type=\"range\" id=\"w-slider\" min=\"0\" max=\"20000\" step=\"1\" value=\"500\">\n                    <div class=\"range-labels\">\n                        <span>0 rad/s</span>\n                        <span>20k rad/s</span>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"result-panel\">\n                <h2>Magnitude Response</h2>\n                <div class=\"result-value\" id=\"mag-value\">0.894</div>\n                <div class=\"result-details\">\n                    <div class=\"detail-item\">\n                        <span class=\"label\">Magnitude (dB):</span>\n                        <span class=\"value\" id=\"mag-db\">-0.97 dB</span>\n                    </div>\n                    <div class=\"detail-item\">\n                        <span class=\"label\">Attenuation:</span>\n                        <span class=\"value\" id=\"attenuation\">10.6%</span>\n                    </div>\n                    <div class=\"detail-item\">\n                        <span class=\"label\">ω/ωc Ratio:</span>\n                        <span class=\"value\" id=\"ratio\">0.50</span>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"visualization\">\n                <h3>Frequency Response</h3>\n                <div class=\"chart-container\">\n                    <canvas id=\"response-canvas\"></canvas>\n                </div>\n            </div>\n\n            <div class=\"info-box\">\n                <h4>🔊 Butterworth Filter Characteristics</h4>\n                <ul>\n                    <li><strong>Maximally Flat:</strong> No ripple in passband or stopband</li>\n                    <li><strong>-3dB Point:</strong> Magnitude = 0.707 at ω = ωc</li>\n                    <li><strong>Roll-off:</strong> -20n dB/decade (n = filter order)</li>\n                    <li><strong>Higher Order:</strong> Steeper transition, better selectivity</li>\n                </ul>\n            </div>\n        </div>\n    </div>\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Arial', sans-serif;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    min-height: 100vh;\n    padding: 20px;\n}\n\n.container {\n    max-width: 1200px;\n    margin: 0 auto;\n}\n\n.card {\n    background: white;\n    border-radius: 15px;\n    padding: 30px;\n    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);\n}\n\nh1 {\n    text-align: center;\n    color: #667eea;\n    margin-bottom: 10px;\n    font-size: 2em;\n}\n\n.subtitle {\n    text-align: center;\n    color: #666;\n    margin-bottom: 30px;\n    font-size: 1em;\n}\n\n.controls-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));\n    gap: 20px;\n    margin-bottom: 30px;\n}\n\n.control-panel {\n    background: #f8f9fa;\n    padding: 20px;\n    border-radius: 10px;\n    border: 2px solid #667eea;\n}\n\n.control-panel:nth-child(2) {\n    border-color: #764ba2;\n}\n\n.control-panel:nth-child(3) {\n    border-color: #20c997;\n}\n\n.control-panel label {\n    display: block;\n    margin-bottom: 10px;\n    font-weight: bold;\n    color: #333;\n}\n\n.control-panel label span {\n    color: #667eea;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    height: 8px;\n    border-radius: 5px;\n    outline: none;\n    -webkit-appearance: none;\n    background: #ddd;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #667eea;\n    cursor: pointer;\n}\n\ninput[type=\"range\"]::-moz-range-thumb {\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #667eea;\n    cursor: pointer;\n    border: none;\n}\n\n.range-labels {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.8em;\n    color: #666;\n    margin-top: 5px;\n}\n\n.result-panel {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    padding: 30px;\n    border-radius: 10px;\n    margin-bottom: 30px;\n    text-align: center;\n    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);\n}\n\n.result-panel h2 {\n    margin: 0 0 10px 0;\n    font-size: 1.2em;\n}\n\n.result-value {\n    font-size: 3.5em;\n    font-weight: bold;\n    margin-bottom: 20px;\n}\n\n.result-details {\n    display: flex;\n    justify-content: space-around;\n    flex-wrap: wrap;\n    gap: 15px;\n    margin-top: 20px;\n}\n\n.detail-item {\n    background: rgba(255, 255, 255, 0.2);\n    padding: 15px 20px;\n    border-radius: 8px;\n    min-width: 180px;\n}\n\n.detail-item .label {\n    display: block;\n    font-size: 0.9em;\n    opacity: 0.9;\n    margin-bottom: 5px;\n}\n\n.detail-item .value {\n    display: block;\n    font-size: 1.3em;\n    font-weight: bold;\n}\n\n.visualization {\n    background: #f8f9fa;\n    padding: 20px;\n    border-radius: 10px;\n    margin-bottom: 20px;\n}\n\n.visualization h3 {\n    margin-top: 0;\n    color: #333;\n    margin-bottom: 15px;\n}\n\n.chart-container {\n    position: relative;\n    width: 100%;\n    height: 400px;\n    background: white;\n    border-radius: 5px;\n    padding: 10px;\n}\n\n#response-canvas {\n    display: block;\n    width: 100%;\n    height: 100%;\n}\n\n.info-box {\n    background: #e7f3ff;\n    border: 1px solid #2196F3;\n    border-radius: 10px;\n    padding: 15px;\n}\n\n.info-box h4 {\n    margin-top: 0;\n    color: #1976D2;\n}\n\n.info-box ul {\n    margin: 10px 0 0 0;\n    padding-left: 20px;\n    color: #1565C0;\n}\n\n.info-box li {\n    margin: 8px 0;\n}\n\n.info-box strong {\n    color: #0D47A1;\n}\n\n@media (max-width: 768px) {\n    .card {\n        padding: 20px;\n    }\n    \n    h1 {\n        font-size: 1.5em;\n    }\n    \n    .result-value {\n        font-size: 2.5em;\n    }\n    \n    .result-details {\n        flex-direction: column;\n    }\n    \n    .chart-container {\n        height: 300px;\n    }\n}", "js": "let n = 2;\nlet wc = 1000;\nlet w = 500;\nlet magnitude = 0;\n\nconst nSlider = document.getElementById('n-slider');\nconst wcSlider = document.getElementById('wc-slider');\nconst wSlider = document.getElementById('w-slider');\nconst nValue = document.getElementById('n-value');\nconst wcValue = document.getElementById('wc-value');\nconst wValue = document.getElementById('w-value');\nconst magValue = document.getElementById('mag-value');\nconst magDb = document.getElementById('mag-db');\nconst attenuation = document.getElementById('attenuation');\nconst ratio = document.getElementById('ratio');\nconst canvas = document.getElementById('response-canvas');\nconst ctx = canvas.getContext('2d');\n\nfunction formatNumber(num) {\n    if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';\n    if (num >= 1e3) return (num / 1e3).toFixed(2) + 'k';\n    if (num < 0.01) return num.toExponential(2);\n    return num.toFixed(0);\n}\n\nfunction calculateMagnitude(freq) {\n    const ratio = freq / wc;\n    const mag = 1 / Math.sqrt(1 + Math.pow(ratio, 2 * n));\n    return mag;\n}\n\nfunction updateResults() {\n    magnitude = calculateMagnitude(w);\n    \n    magValue.textContent = magnitude.toFixed(4);\n    \n    const dB = 20 * Math.log10(magnitude);\n    magDb.textContent = dB.toFixed(2) + ' dB';\n    \n    const atten = (1 - magnitude) * 100;\n    attenuation.textContent = atten.toFixed(1) + '%';\n    \n    const freqRatio = w / wc;\n    ratio.textContent = freqRatio.toFixed(2);\n}\n\nfunction drawFrequencyResponse() {\n    const width = canvas.width;\n    const height = canvas.height;\n    \n    ctx.clearRect(0, 0, width, height);\n    \n    const padding = { top: 30, right: 40, bottom: 60, left: 70 };\n    const chartWidth = width - padding.left - padding.right;\n    const chartHeight = height - padding.top - padding.bottom;\n    \n    // Background\n    ctx.fillStyle = '#fafafa';\n    ctx.fillRect(padding.left, padding.top, chartWidth, chartHeight);\n    \n    // Grid lines\n    ctx.strokeStyle = '#e0e0e0';\n    ctx.lineWidth = 1;\n    \n    // Horizontal grid (magnitude)\n    for (let i = 0; i <= 10; i++) {\n        const y = padding.top + (chartHeight * i / 10);\n        ctx.beginPath();\n        ctx.moveTo(padding.left, y);\n        ctx.lineTo(padding.left + chartWidth, y);\n        ctx.stroke();\n        \n        // Y-axis labels (dB)\n        ctx.fillStyle = '#666';\n        ctx.font = '11px Arial';\n        ctx.textAlign = 'right';\n        ctx.textBaseline = 'middle';\n        const dbVal = -i * 6;\n        ctx.fillText(dbVal + ' dB', padding.left - 8, y);\n    }\n    \n    // Vertical grid (frequency - log scale)\n    const decades = 4;\n    for (let decade = 0; decade <= decades; decade++) {\n        const freq = Math.pow(10, decade) * (wc / 1000);\n        const logFreq = Math.log10(freq / (wc / 1000));\n        const x = padding.left + (logFreq / decades) * chartWidth;\n        \n        if (x >= padding.left && x <= padding.left + chartWidth) {\n            ctx.strokeStyle = '#e0e0e0';\n            ctx.beginPath();\n            ctx.moveTo(x, padding.top);\n            ctx.lineTo(x, padding.top + chartHeight);\n            ctx.stroke();\n        }\n    }\n    \n    // Draw cutoff frequency line\n    ctx.strokeStyle = '#ffc107';\n    ctx.lineWidth = 2;\n    ctx.setLineDash([5, 5]);\n    const cutoffX = padding.left + chartWidth / 2;\n    ctx.beginPath();\n    ctx.moveTo(cutoffX, padding.top);\n    ctx.lineTo(cutoffX, padding.top + chartHeight);\n    ctx.stroke();\n    ctx.setLineDash([]);\n    \n    // Draw -3dB line\n    ctx.strokeStyle = '#ff9800';\n    ctx.lineWidth = 1;\n    ctx.setLineDash([3, 3]);\n    const db3Y = padding.top + chartHeight * (3 / 60);\n    ctx.beginPath();\n    ctx.moveTo(padding.left, db3Y);\n    ctx.lineTo(padding.left + chartWidth, db3Y);\n    ctx.stroke();\n    ctx.setLineDash([]);\n    \n    // Draw frequency response curve\n    ctx.strokeStyle = '#667eea';\n    ctx.lineWidth = 3;\n    ctx.beginPath();\n    \n    const points = 500;\n    const minFreq = wc / 1000;\n    const maxFreq = wc * 100;\n    \n    // Clipping region to prevent drawing outside chart\n    ctx.save();\n    ctx.beginPath();\n    ctx.rect(padding.left, padding.top, chartWidth, chartHeight);\n    ctx.clip();\n    \n    ctx.beginPath();\n    for (let i = 0; i <= points; i++) {\n        const logFreq = Math.log10(minFreq) + (i / points) * (Math.log10(maxFreq) - Math.log10(minFreq));\n        const freq = Math.pow(10, logFreq);\n        const mag = calculateMagnitude(freq);\n        const db = 20 * Math.log10(mag);\n        \n        // Clamp dB to visible range\n        const clampedDb = Math.max(-60, Math.min(0, db));\n        \n        const x = padding.left + ((logFreq - Math.log10(minFreq)) / (Math.log10(maxFreq) - Math.log10(minFreq))) * chartWidth;\n        const y = padding.top + chartHeight - ((clampedDb + 60) / 60) * chartHeight;\n        \n        if (i === 0) {\n            ctx.moveTo(x, y);\n        } else {\n            ctx.lineTo(x, y);\n        }\n    }\n    ctx.stroke();\n    ctx.restore();\n    \n    // Draw current frequency marker\n    const currentLogFreq = Math.log10(w);\n    const currentX = padding.left + ((currentLogFreq - Math.log10(minFreq)) / (Math.log10(maxFreq) - Math.log10(minFreq))) * chartWidth;\n    const currentMag = calculateMagnitude(w);\n    const currentDb = 20 * Math.log10(currentMag);\n    const clampedCurrentDb = Math.max(-60, Math.min(0, currentDb));\n    const currentY = padding.top + chartHeight - ((clampedCurrentDb + 60) / 60) * chartHeight;\n    \n    if (currentX >= padding.left && currentX <= padding.left + chartWidth) {\n        // Vertical line to point\n        ctx.strokeStyle = '#dc3545';\n        ctx.lineWidth = 2;\n        ctx.setLineDash([3, 3]);\n        ctx.beginPath();\n        ctx.moveTo(currentX, padding.top + chartHeight);\n        ctx.lineTo(currentX, currentY);\n        ctx.stroke();\n        ctx.setLineDash([]);\n        \n        // Point\n        ctx.fillStyle = '#dc3545';\n        ctx.beginPath();\n        ctx.arc(currentX, currentY, 6, 0, Math.PI * 2);\n        ctx.fill();\n        \n        ctx.strokeStyle = 'white';\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.arc(currentX, currentY, 6, 0, Math.PI * 2);\n        ctx.stroke();\n    }\n    \n    // Axes\n    ctx.strokeStyle = '#333';\n    ctx.lineWidth = 2;\n    \n    // X-axis\n    ctx.beginPath();\n    ctx.moveTo(padding.left, padding.top + chartHeight);\n    ctx.lineTo(padding.left + chartWidth, padding.top + chartHeight);\n    ctx.stroke();\n    \n    // Y-axis\n    ctx.beginPath();\n    ctx.moveTo(padding.left, padding.top);\n    ctx.lineTo(padding.left, padding.top + chartHeight);\n    ctx.stroke();\n    \n    // Labels\n    ctx.fillStyle = '#333';\n    ctx.font = '12px Arial';\n    \n    // X-axis label\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'top';\n    ctx.fillText('Frequency (rad/s)', padding.left + chartWidth / 2, height - 25);\n    \n    // Y-axis label\n    ctx.save();\n    ctx.translate(20, padding.top + chartHeight / 2);\n    ctx.rotate(-Math.PI / 2);\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'top';\n    ctx.fillText('Magnitude (dB)', 0, 0);\n    ctx.restore();\n    \n    // X-axis tick labels\n    ctx.fillStyle = '#666';\n    ctx.font = '10px Arial';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'top';\n    \n    for (let decade = 0; decade <= decades; decade++) {\n        const freq = Math.pow(10, decade) * (wc / 1000);\n        const logFreq = Math.log10(freq / (wc / 1000));\n        const x = padding.left + (logFreq / decades) * chartWidth;\n        \n        if (x >= padding.left && x <= padding.left + chartWidth) {\n            ctx.fillText(formatNumber(freq), x, padding.top + chartHeight + 5);\n        }\n    }\n    \n    // Legend\n    ctx.font = '11px Arial';\n    ctx.textAlign = 'left';\n    \n    ctx.fillStyle = '#ffc107';\n    ctx.fillText('ωc = ' + formatNumber(wc) + ' rad/s', padding.left + 10, padding.top + 10);\n    \n    ctx.fillStyle = '#dc3545';\n    ctx.fillText('ω = ' + formatNumber(w) + ' rad/s', padding.left + 10, padding.top + 25);\n    \n    ctx.fillStyle = '#667eea';\n    ctx.fillText('Order n = ' + n, padding.left + 10, padding.top + 40);\n}\n\nfunction resizeCanvas() {\n    const container = canvas.parentElement;\n    const rect = container.getBoundingClientRect();\n    \n    const dpr = window.devicePixelRatio || 1;\n    canvas.width = rect.width * dpr;\n    canvas.height = rect.height * dpr;\n    \n    ctx.scale(dpr, dpr);\n    \n    canvas.style.width = rect.width + 'px';\n    canvas.style.height = rect.height + 'px';\n    \n    drawFrequencyResponse();\n}\n\nfunction updateSimulation() {\n    updateResults();\n    drawFrequencyResponse();\n}\n\nnSlider.addEventListener('input', (e) => {\n    n = parseInt(e.target.value);\n    nValue.textContent = n;\n    updateSimulation();\n});\n\nwcSlider.addEventListener('input', (e) => {\n    wc = parseFloat(e.target.value);\n    wcValue.textContent = formatNumber(wc) + ' rad/s';\n    updateSimulation();\n});\n\nwSlider.addEventListener('input', (e) => {\n    w = parseFloat(e.target.value);\n    wValue.textContent = formatNumber(w) + ' rad/s';\n    updateSimulation();\n});\n\nwindow.addEventListener('resize', resizeCanvas);\n\n// Initialize\nresizeCanvas();\nupdateSimulation();"}}
{"input": {"input_text": "AM modulation depth m: s(t) = Ac(1 + m*cos(wm t))cos(wc t). Given m, compute sideband power fraction m^2/2.", "simulation_name": " AM Sideband Power", "domain": "Communications", "description": "AM single-tone sideband power", "assumptions": ["DSB-TC"], "entities": [], "constants": [], "parameters": [{"name": "modulation_index", "symbol": "m", "unit": "dimensionless", "range": [0, 1]}], "equations": [{"description": "Sideband fraction", "expression": "sideband_fraction = m^2/2"}], "initial_conditions": {}, "outputs": ["sideband_fraction"], "simulation_controls": ["m"], "constraints": ["0<=m<=1"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S75 AM Sideband Power</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"card\">\n            <h1>S75 AM Sideband Power</h1>\n            <p class=\"subtitle\">AM Modulation: s(t) = Ac(1 + m·cos(ωm t))cos(ωc t)</p>\n\n            <div class=\"controls-grid\">\n                <div class=\"control-panel\">\n                    <label>\n                        Modulation Index (m): <span id=\"m-value\">0.50</span>\n                    </label>\n                    <input type=\"range\" id=\"m-slider\" min=\"0\" max=\"1\" step=\"0.01\" value=\"0.5\">\n                    <div class=\"range-labels\">\n                        <span>0.00</span>\n                        <span>1.00</span>\n                    </div>\n                    <div class=\"modulation-status\" id=\"mod-status\">50% Modulation</div>\n                </div>\n            </div>\n\n            <div class=\"result-panel\">\n                <h2>Sideband Power Fraction</h2>\n                <div class=\"result-value\" id=\"sideband-value\">0.125</div>\n                <div class=\"result-details\">\n                    <div class=\"detail-item\">\n                        <span class=\"label\">Sideband Power (%):</span>\n                        <span class=\"value\" id=\"sideband-percent\">12.5%</span>\n                    </div>\n                    <div class=\"detail-item\">\n                        <span class=\"label\">Carrier Power (%):</span>\n                        <span class=\"value\" id=\"carrier-percent\">87.5%</span>\n                    </div>\n                    <div class=\"detail-item\">\n                        <span class=\"label\">Efficiency:</span>\n                        <span class=\"value\" id=\"efficiency\">12.5%</span>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"visualization\">\n                <h3>AM Signal Waveform</h3>\n                <div class=\"chart-container\">\n                    <canvas id=\"waveform-canvas\"></canvas>\n                </div>\n            </div>\n\n            <div class=\"visualization\">\n                <h3>Frequency Spectrum</h3>\n                <div class=\"chart-container\">\n                    <canvas id=\"spectrum-canvas\"></canvas>\n                </div>\n            </div>\n\n            <div class=\"power-breakdown\">\n                <h3>Power Distribution</h3>\n                <div class=\"power-bars\">\n                    <div class=\"power-bar-item\">\n                        <div class=\"power-bar-label\">Carrier</div>\n                        <div class=\"power-bar-container\">\n                            <div class=\"power-bar carrier-bar\" id=\"carrier-bar\"></div>\n                        </div>\n                        <div class=\"power-bar-value\" id=\"carrier-bar-value\">87.5%</div>\n                    </div>\n                    <div class=\"power-bar-item\">\n                        <div class=\"power-bar-label\">Sidebands</div>\n                        <div class=\"power-bar-container\">\n                            <div class=\"power-bar sideband-bar\" id=\"sideband-bar\"></div>\n                        </div>\n                        <div class=\"power-bar-value\" id=\"sideband-bar-value\">12.5%</div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"info-box\">\n                <h4>📡 AM Sideband Power Analysis</h4>\n                <ul>\n                    <li><strong>DSB-TC:</strong> Double Sideband with Transmitted Carrier</li>\n                    <li><strong>Power Formula:</strong> Psideband / Ptotal = m²/2</li>\n                    <li><strong>Maximum Efficiency:</strong> 33.3% at m = 1 (100% modulation)</li>\n                    <li><strong>Carrier Waste:</strong> Carrier contains no information but most power</li>\n                </ul>\n            </div>\n        </div>\n    </div>\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Arial', sans-serif;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    min-height: 100vh;\n    padding: 20px;\n}\n\n.container {\n    max-width: 1200px;\n    margin: 0 auto;\n}\n\n.card {\n    background: white;\n    border-radius: 15px;\n    padding: 30px;\n    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);\n}\n\nh1 {\n    text-align: center;\n    color: #667eea;\n    margin-bottom: 10px;\n    font-size: 2em;\n}\n\n.subtitle {\n    text-align: center;\n    color: #666;\n    margin-bottom: 30px;\n    font-size: 1em;\n}\n\n.controls-grid {\n    display: grid;\n    grid-template-columns: 1fr;\n    gap: 20px;\n    margin-bottom: 30px;\n}\n\n.control-panel {\n    background: #f8f9fa;\n    padding: 20px;\n    border-radius: 10px;\n    border: 2px solid #667eea;\n}\n\n.control-panel label {\n    display: block;\n    margin-bottom: 10px;\n    font-weight: bold;\n    color: #333;\n}\n\n.control-panel label span {\n    color: #667eea;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    height: 8px;\n    border-radius: 5px;\n    outline: none;\n    -webkit-appearance: none;\n    background: #ddd;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #667eea;\n    cursor: pointer;\n}\n\ninput[type=\"range\"]::-moz-range-thumb {\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #667eea;\n    cursor: pointer;\n    border: none;\n}\n\n.range-labels {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.8em;\n    color: #666;\n    margin-top: 5px;\n}\n\n.modulation-status {\n    margin-top: 10px;\n    padding: 10px;\n    background: #e7f3ff;\n    border-radius: 5px;\n    text-align: center;\n    font-weight: bold;\n    color: #1976D2;\n}\n\n.result-panel {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    padding: 30px;\n    border-radius: 10px;\n    margin-bottom: 30px;\n    text-align: center;\n    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);\n}\n\n.result-panel h2 {\n    margin: 0 0 10px 0;\n    font-size: 1.2em;\n}\n\n.result-value {\n    font-size: 3.5em;\n    font-weight: bold;\n    margin-bottom: 20px;\n}\n\n.result-details {\n    display: flex;\n    justify-content: space-around;\n    flex-wrap: wrap;\n    gap: 15px;\n    margin-top: 20px;\n}\n\n.detail-item {\n    background: rgba(255, 255, 255, 0.2);\n    padding: 15px 20px;\n    border-radius: 8px;\n    min-width: 180px;\n}\n\n.detail-item .label {\n    display: block;\n    font-size: 0.9em;\n    opacity: 0.9;\n    margin-bottom: 5px;\n}\n\n.detail-item .value {\n    display: block;\n    font-size: 1.3em;\n    font-weight: bold;\n}\n\n.visualization {\n    background: #f8f9fa;\n    padding: 20px;\n    border-radius: 10px;\n    margin-bottom: 20px;\n}\n\n.visualization h3 {\n    margin-top: 0;\n    color: #333;\n    margin-bottom: 15px;\n}\n\n.chart-container {\n    position: relative;\n    width: 100%;\n    height: 300px;\n    background: white;\n    border-radius: 5px;\n    padding: 10px;\n}\n\n#waveform-canvas, #spectrum-canvas {\n    display: block;\n    width: 100%;\n    height: 100%;\n}\n\n.power-breakdown {\n    background: #f8f9fa;\n    padding: 20px;\n    border-radius: 10px;\n    margin-bottom: 20px;\n}\n\n.power-breakdown h3 {\n    margin-top: 0;\n    color: #333;\n    margin-bottom: 20px;\n}\n\n.power-bars {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.power-bar-item {\n    display: flex;\n    align-items: center;\n    gap: 15px;\n}\n\n.power-bar-label {\n    font-weight: bold;\n    color: #333;\n    min-width: 100px;\n}\n\n.power-bar-container {\n    flex: 1;\n    height: 30px;\n    background: #e0e0e0;\n    border-radius: 15px;\n    overflow: hidden;\n}\n\n.power-bar {\n    height: 100%;\n    transition: width 0.3s ease;\n    border-radius: 15px;\n}\n\n.carrier-bar {\n    background: linear-gradient(90deg, #ffc107 0%, #ff9800 100%);\n}\n\n.sideband-bar {\n    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);\n}\n\n.power-bar-value {\n    font-weight: bold;\n    color: #333;\n    min-width: 60px;\n    text-align: right;\n}\n\n.info-box {\n    background: #e7f3ff;\n    border: 1px solid #2196F3;\n    border-radius: 10px;\n    padding: 15px;\n}\n\n.info-box h4 {\n    margin-top: 0;\n    color: #1976D2;\n}\n\n.info-box ul {\n    margin: 10px 0 0 0;\n    padding-left: 20px;\n    color: #1565C0;\n}\n\n.info-box li {\n    margin: 8px 0;\n}\n\n.info-box strong {\n    color: #0D47A1;\n}\n\n@media (max-width: 768px) {\n    .card {\n        padding: 20px;\n    }\n    \n    h1 {\n        font-size: 1.5em;\n    }\n    \n    .result-value {\n        font-size: 2.5em;\n    }\n    \n    .result-details {\n        flex-direction: column;\n    }\n    \n    .chart-container {\n        height: 250px;\n    }\n    \n    .power-bar-item {\n        flex-direction: column;\n        align-items: stretch;\n    }\n    \n    .power-bar-label, .power-bar-value {\n        text-align: left;\n    }\n}", "js": "let m = 0.5;\nlet sidebandFraction = 0;\n\nconst mSlider = document.getElementById('m-slider');\nconst mValue = document.getElementById('m-value');\nconst modStatus = document.getElementById('mod-status');\nconst sidebandValue = document.getElementById('sideband-value');\nconst sidebandPercent = document.getElementById('sideband-percent');\nconst carrierPercent = document.getElementById('carrier-percent');\nconst efficiency = document.getElementById('efficiency');\nconst carrierBar = document.getElementById('carrier-bar');\nconst sidebandBar = document.getElementById('sideband-bar');\nconst carrierBarValue = document.getElementById('carrier-bar-value');\nconst sidebandBarValue = document.getElementById('sideband-bar-value');\nconst waveformCanvas = document.getElementById('waveform-canvas');\nconst spectrumCanvas = document.getElementById('spectrum-canvas');\nconst waveCtx = waveformCanvas.getContext('2d');\nconst specCtx = spectrumCanvas.getContext('2d');\n\nfunction formatNumber(num) {\n    if (num < 0.01) return num.toExponential(2);\n    return num.toFixed(3);\n}\n\nfunction calculateSidebandPower() {\n    sidebandFraction = (m * m) / 2;\n    \n    sidebandValue.textContent = formatNumber(sidebandFraction);\n    \n    const sidebandPct = sidebandFraction * 100;\n    const carrierPct = 100 - sidebandPct;\n    \n    sidebandPercent.textContent = sidebandPct.toFixed(2) + '%';\n    carrierPercent.textContent = carrierPct.toFixed(2) + '%';\n    efficiency.textContent = sidebandPct.toFixed(2) + '%';\n    \n    // Update power bars\n    carrierBar.style.width = carrierPct + '%';\n    sidebandBar.style.width = sidebandPct + '%';\n    carrierBarValue.textContent = carrierPct.toFixed(1) + '%';\n    sidebandBarValue.textContent = sidebandPct.toFixed(1) + '%';\n    \n    // Update modulation status\n    const modPct = m * 100;\n    if (m === 0) {\n        modStatus.textContent = 'No Modulation (Carrier Only)';\n        modStatus.style.background = '#ffebee';\n        modStatus.style.color = '#c62828';\n    } else if (m < 0.3) {\n        modStatus.textContent = modPct.toFixed(0) + '% Modulation (Low)';\n        modStatus.style.background = '#fff3e0';\n        modStatus.style.color = '#e65100';\n    } else if (m < 0.7) {\n        modStatus.textContent = modPct.toFixed(0) + '% Modulation (Moderate)';\n        modStatus.style.background = '#e7f3ff';\n        modStatus.style.color = '#1976D2';\n    } else if (m < 1) {\n        modStatus.textContent = modPct.toFixed(0) + '% Modulation (High)';\n        modStatus.style.background = '#e8f5e9';\n        modStatus.style.color = '#2e7d32';\n    } else {\n        modStatus.textContent = '100% Modulation (Maximum)';\n        modStatus.style.background = '#e8f5e9';\n        modStatus.style.color = '#1b5e20';\n    }\n}\n\nfunction drawWaveform() {\n    const width = waveformCanvas.width;\n    const height = waveformCanvas.height;\n    \n    waveCtx.clearRect(0, 0, width, height);\n    \n    const padding = { top: 30, right: 30, bottom: 50, left: 60 };\n    const chartWidth = width - padding.left - padding.right;\n    const chartHeight = height - padding.top - padding.bottom;\n    \n    // Background\n    waveCtx.fillStyle = '#fafafa';\n    waveCtx.fillRect(padding.left, padding.top, chartWidth, chartHeight);\n    \n    // Grid\n    waveCtx.strokeStyle = '#e0e0e0';\n    waveCtx.lineWidth = 1;\n    \n    for (let i = 0; i <= 4; i++) {\n        const y = padding.top + (chartHeight * i / 4);\n        waveCtx.beginPath();\n        waveCtx.moveTo(padding.left, y);\n        waveCtx.lineTo(padding.left + chartWidth, y);\n        waveCtx.stroke();\n    }\n    \n    // Draw envelope\n    waveCtx.strokeStyle = '#ff9800';\n    waveCtx.lineWidth = 2;\n    waveCtx.setLineDash([5, 5]);\n    \n    const points = 500;\n    const cycles = 4;\n    \n    // Upper envelope\n    waveCtx.beginPath();\n    for (let i = 0; i <= points; i++) {\n        const t = (i / points) * cycles * 2 * Math.PI;\n        const x = padding.left + (i / points) * chartWidth;\n        const envelope = 1 + m * Math.cos(t / cycles);\n        const y = padding.top + chartHeight / 2 - (envelope * chartHeight * 0.35);\n        \n        if (i === 0) {\n            waveCtx.moveTo(x, y);\n        } else {\n            waveCtx.lineTo(x, y);\n        }\n    }\n    waveCtx.stroke();\n    \n    // Lower envelope\n    waveCtx.beginPath();\n    for (let i = 0; i <= points; i++) {\n        const t = (i / points) * cycles * 2 * Math.PI;\n        const x = padding.left + (i / points) * chartWidth;\n        const envelope = 1 + m * Math.cos(t / cycles);\n        const y = padding.top + chartHeight / 2 + (envelope * chartHeight * 0.35);\n        \n        if (i === 0) {\n            waveCtx.moveTo(x, y);\n        } else {\n            waveCtx.lineTo(x, y);\n        }\n    }\n    waveCtx.stroke();\n    waveCtx.setLineDash([]);\n    \n    // Draw AM signal\n    waveCtx.strokeStyle = '#667eea';\n    waveCtx.lineWidth = 2;\n    waveCtx.beginPath();\n    \n    for (let i = 0; i <= points; i++) {\n        const t = (i / points) * cycles * 2 * Math.PI;\n        const x = padding.left + (i / points) * chartWidth;\n        const modulating = Math.cos(t / cycles);\n        const carrier = Math.cos(t * 20);\n        const signal = (1 + m * modulating) * carrier;\n        const y = padding.top + chartHeight / 2 - (signal * chartHeight * 0.35);\n        \n        if (i === 0) {\n            waveCtx.moveTo(x, y);\n        } else {\n            waveCtx.lineTo(x, y);\n        }\n    }\n    waveCtx.stroke();\n    \n    // Axes\n    waveCtx.strokeStyle = '#333';\n    waveCtx.lineWidth = 2;\n    waveCtx.beginPath();\n    waveCtx.moveTo(padding.left, padding.top + chartHeight / 2);\n    waveCtx.lineTo(padding.left + chartWidth, padding.top + chartHeight / 2);\n    waveCtx.stroke();\n    \n    // Labels\n    waveCtx.fillStyle = '#333';\n    waveCtx.font = '12px Arial';\n    waveCtx.textAlign = 'center';\n    waveCtx.textBaseline = 'top';\n    waveCtx.fillText('Time', padding.left + chartWidth / 2, height - 25);\n    \n    waveCtx.save();\n    waveCtx.translate(20, padding.top + chartHeight / 2);\n    waveCtx.rotate(-Math.PI / 2);\n    waveCtx.textAlign = 'center';\n    waveCtx.fillText('Amplitude', 0, 0);\n    waveCtx.restore();\n    \n    // Y-axis labels\n    waveCtx.fillStyle = '#666';\n    waveCtx.font = '10px Arial';\n    waveCtx.textAlign = 'right';\n    waveCtx.textBaseline = 'middle';\n    waveCtx.fillText((1 + m).toFixed(1), padding.left - 5, padding.top);\n    waveCtx.fillText('0', padding.left - 5, padding.top + chartHeight / 2);\n    waveCtx.fillText('-' + (1 + m).toFixed(1), padding.left - 5, padding.top + chartHeight);\n    \n    // Legend\n    waveCtx.font = '11px Arial';\n    waveCtx.textAlign = 'left';\n    waveCtx.fillStyle = '#667eea';\n    waveCtx.fillText('AM Signal', padding.left + 10, padding.top + 10);\n    waveCtx.fillStyle = '#ff9800';\n    waveCtx.fillText('Envelope', padding.left + 90, padding.top + 10);\n}\n\nfunction drawSpectrum() {\n    const width = spectrumCanvas.width;\n    const height = spectrumCanvas.height;\n    \n    specCtx.clearRect(0, 0, width, height);\n    \n    const padding = { top: 30, right: 30, bottom: 50, left: 60 };\n    const chartWidth = width - padding.left - padding.right;\n    const chartHeight = height - padding.top - padding.bottom;\n    \n    // Background\n    specCtx.fillStyle = '#fafafa';\n    specCtx.fillRect(padding.left, padding.top, chartWidth, chartHeight);\n    \n    // Grid\n    specCtx.strokeStyle = '#e0e0e0';\n    specCtx.lineWidth = 1;\n    \n    for (let i = 0; i <= 4; i++) {\n        const y = padding.top + (chartHeight * i / 4);\n        specCtx.beginPath();\n        specCtx.moveTo(padding.left, y);\n        specCtx.lineTo(padding.left + chartWidth, y);\n        specCtx.stroke();\n    }\n    \n    // Carrier power (normalized to 1)\n    const carrierPower = 1;\n    const sidebandPower = m * m / 4; // Each sideband\n    \n    const maxPower = Math.max(carrierPower, sidebandPower * 2);\n    \n    // Draw spectral lines\n    const centerX = padding.left + chartWidth / 2;\n    const spacing = chartWidth / 8;\n    \n    // Lower sideband\n    drawSpectralLine(specCtx, centerX - spacing, padding.top, chartHeight, sidebandPower / maxPower, '#764ba2', 'LSB');\n    \n    // Carrier\n    drawSpectralLine(specCtx, centerX, padding.top, chartHeight, carrierPower / maxPower, '#ffc107', 'fc');\n    \n    // Upper sideband\n    drawSpectralLine(specCtx, centerX + spacing, padding.top, chartHeight, sidebandPower / maxPower, '#667eea', 'USB');\n    \n    // Axes\n    specCtx.strokeStyle = '#333';\n    specCtx.lineWidth = 2;\n    specCtx.beginPath();\n    specCtx.moveTo(padding.left, padding.top + chartHeight);\n    specCtx.lineTo(padding.left + chartWidth, padding.top + chartHeight);\n    specCtx.stroke();\n    \n    specCtx.beginPath();\n    specCtx.moveTo(padding.left, padding.top);\n    specCtx.lineTo(padding.left, padding.top + chartHeight);\n    specCtx.stroke();\n    \n    // Labels\n    specCtx.fillStyle = '#333';\n    specCtx.font = '12px Arial';\n    specCtx.textAlign = 'center';\n    specCtx.textBaseline = 'top';\n    specCtx.fillText('Frequency', padding.left + chartWidth / 2, height - 25);\n    \n    specCtx.save();\n    specCtx.translate(20, padding.top + chartHeight / 2);\n    specCtx.rotate(-Math.PI / 2);\n    specCtx.textAlign = 'center';\n    specCtx.fillText('Power', 0, 0);\n    specCtx.restore();\n    \n    // Frequency labels\n    specCtx.fillStyle = '#666';\n    specCtx.font = '10px Arial';\n    specCtx.textAlign = 'center';\n    specCtx.textBaseline = 'top';\n    specCtx.fillText('fc - fm', centerX - spacing, padding.top + chartHeight + 5);\n    specCtx.fillText('fc', centerX, padding.top + chartHeight + 5);\n    specCtx.fillText('fc + fm', centerX + spacing, padding.top + chartHeight + 5);\n}\n\nfunction drawSpectralLine(ctx, x, y, height, magnitude, color, label) {\n    const lineHeight = magnitude * height * 0.8;\n    const lineY = y + height - lineHeight;\n    \n    // Draw line\n    ctx.strokeStyle = color;\n    ctx.lineWidth = 3;\n    ctx.beginPath();\n    ctx.moveTo(x, y + height);\n    ctx.lineTo(x, lineY);\n    ctx.stroke();\n    \n    // Draw circle at top\n    ctx.fillStyle = color;\n    ctx.beginPath();\n    ctx.arc(x, lineY, 5, 0, Math.PI * 2);\n    ctx.fill();\n    \n    // Draw label\n    ctx.fillStyle = color;\n    ctx.font = 'bold 10px Arial';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'bottom';\n    ctx.fillText(label, x, lineY - 8);\n}\n\nfunction resizeCanvas(canvas) {\n    const container = canvas.parentElement;\n    const rect = container.getBoundingClientRect();\n    \n    const dpr = window.devicePixelRatio || 1;\n    canvas.width = rect.width * dpr;\n    canvas.height = rect.height * dpr;\n    \n    const ctx = canvas.getContext('2d');\n    ctx.scale(dpr, dpr);\n    \n    canvas.style.width = rect.width + 'px';\n    canvas.style.height = rect.height + 'px';\n}\n\nfunction updateSimulation() {\n    calculateSidebandPower();\n    drawWaveform();\n    drawSpectrum();\n}\n\nmSlider.addEventListener('input', (e) => {\n    m = parseFloat(e.target.value);\n    mValue.textContent = m.toFixed(2);\n    updateSimulation();\n});\n\nwindow.addEventListener('resize', () => {\n    resizeCanvas(waveformCanvas);\n    resizeCanvas(spectrumCanvas);\n    updateSimulation();\n});\n\n// Initialize\nresizeCanvas(waveformCanvas);\nresizeCanvas(spectrumCanvas);\nupdateSimulation();"}}
{"input": {"input_text": "FM Carson's rule: bandwidth ≈ 2*(delta_f + fm). Compute BW from peak deviation and modulating frequency.", "simulation_name": " FM Bandwidth", "domain": "Communications", "description": "Carson bandwidth estimate", "assumptions": ["Single-tone modulation"], "entities": [], "constants": [], "parameters": [{"name": "freq_deviation", "symbol": "delta_f", "unit": "Hz", "range": [1, 1000000.0]}, {"name": "modulating_freq", "symbol": "fm", "unit": "Hz", "range": [1, 1000000.0]}], "equations": [{"description": "Bandwidth", "expression": "BW = 2*(delta_f + fm)"}], "initial_conditions": {}, "outputs": ["BW"], "simulation_controls": ["delta_f", "fm"], "constraints": ["delta_f>=0", "fm>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S76 FM Bandwidth</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"card\">\n            <h1>S76 FM Bandwidth</h1>\n            <p class=\"subtitle\">Carson's Rule: BW ≈ 2(Δf + fm)</p>\n\n            <div class=\"controls-grid\">\n                <div class=\"control-panel\">\n                    <label>\n                        Peak Frequency Deviation (Δf): <span id=\"delta-value\">75 kHz</span>\n                    </label>\n                    <input type=\"range\" id=\"delta-slider\" min=\"1\" max=\"200000\" step=\"100\" value=\"75000\">\n                    <div class=\"range-labels\">\n                        <span>1 Hz</span>\n                        <span>200 kHz</span>\n                    </div>\n                </div>\n\n                <div class=\"control-panel\">\n                    <label>\n                        Modulating Frequency (fm): <span id=\"fm-value\">15 kHz</span>\n                    </label>\n                    <input type=\"range\" id=\"fm-slider\" min=\"1\" max=\"50000\" step=\"10\" value=\"15000\">\n                    <div class=\"range-labels\">\n                        <span>1 Hz</span>\n                        <span>50 kHz</span>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"result-panel\">\n                <h2>Carson's Bandwidth</h2>\n                <div class=\"result-value\" id=\"bw-value\">180 kHz</div>\n                <div class=\"result-details\">\n                    <div class=\"detail-item\">\n                        <span class=\"label\">Modulation Index (β):</span>\n                        <span class=\"value\" id=\"beta-value\">5.00</span>\n                    </div>\n                    <div class=\"detail-item\">\n                        <span class=\"label\">Type:</span>\n                        <span class=\"value\" id=\"mod-type\">Wideband FM</span>\n                    </div>\n                    <div class=\"detail-item\">\n                        <span class=\"label\">Bandwidth Ratio:</span>\n                        <span class=\"value\" id=\"bw-ratio\">12.0×</span>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"visualization\">\n                <h3>Frequency Spectrum</h3>\n                <div class=\"chart-container\">\n                    <canvas id=\"spectrum-canvas\"></canvas>\n                </div>\n            </div>\n\n            <div class=\"visualization\">\n                <h3>FM Signal Visualization</h3>\n                <div class=\"chart-container\">\n                    <canvas id=\"signal-canvas\"></canvas>\n                </div>\n            </div>\n\n            <div class=\"bandwidth-breakdown\">\n                <h3>Bandwidth Components</h3>\n                <div class=\"component-grid\">\n                    <div class=\"component-card\">\n                        <div class=\"component-label\">Deviation Term</div>\n                        <div class=\"component-value\" id=\"deviation-term\">150 kHz</div>\n                        <div class=\"component-formula\">2 × Δf</div>\n                    </div>\n                    <div class=\"component-card\">\n                        <div class=\"component-label\">Modulation Term</div>\n                        <div class=\"component-value\" id=\"modulation-term\">30 kHz</div>\n                        <div class=\"component-formula\">2 × fm</div>\n                    </div>\n                    <div class=\"component-card highlight\">\n                        <div class=\"component-label\">Total Bandwidth</div>\n                        <div class=\"component-value\" id=\"total-bw\">180 kHz</div>\n                        <div class=\"component-formula\">2(Δf + fm)</div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"info-box\">\n                <h4>📻 FM Bandwidth Analysis</h4>\n                <ul>\n                    <li><strong>Carson's Rule:</strong> Approximates 98% of FM signal power</li>\n                    <li><strong>Narrowband FM:</strong> β < 0.3 → BW ≈ 2fm</li>\n                    <li><strong>Wideband FM:</strong> β > 1 → BW ≈ 2Δf</li>\n                    <li><strong>Modulation Index:</strong> β = Δf / fm</li>\n                </ul>\n            </div>\n        </div>\n    </div>\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Arial', sans-serif;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    min-height: 100vh;\n    padding: 20px;\n}\n\n.container {\n    max-width: 1200px;\n    margin: 0 auto;\n}\n\n.card {\n    background: white;\n    border-radius: 15px;\n    padding: 30px;\n    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);\n}\n\nh1 {\n    text-align: center;\n    color: #667eea;\n    margin-bottom: 10px;\n    font-size: 2em;\n}\n\n.subtitle {\n    text-align: center;\n    color: #666;\n    margin-bottom: 30px;\n    font-size: 1.1em;\n}\n\n.controls-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n    gap: 20px;\n    margin-bottom: 30px;\n}\n\n.control-panel {\n    background: #f8f9fa;\n    padding: 20px;\n    border-radius: 10px;\n    border: 2px solid #667eea;\n}\n\n.control-panel:nth-child(2) {\n    border-color: #764ba2;\n}\n\n.control-panel label {\n    display: block;\n    margin-bottom: 10px;\n    font-weight: bold;\n    color: #333;\n}\n\n.control-panel label span {\n    color: #667eea;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    height: 8px;\n    border-radius: 5px;\n    outline: none;\n    -webkit-appearance: none;\n    background: #ddd;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #667eea;\n    cursor: pointer;\n}\n\ninput[type=\"range\"]::-moz-range-thumb {\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #667eea;\n    cursor: pointer;\n    border: none;\n}\n\n.range-labels {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.8em;\n    color: #666;\n    margin-top: 5px;\n}\n\n.result-panel {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    padding: 30px;\n    border-radius: 10px;\n    margin-bottom: 30px;\n    text-align: center;\n    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);\n}\n\n.result-panel h2 {\n    margin: 0 0 10px 0;\n    font-size: 1.2em;\n}\n\n.result-value {\n    font-size: 3.5em;\n    font-weight: bold;\n    margin-bottom: 20px;\n}\n\n.result-details {\n    display: flex;\n    justify-content: space-around;\n    flex-wrap: wrap;\n    gap: 15px;\n    margin-top: 20px;\n}\n\n.detail-item {\n    background: rgba(255, 255, 255, 0.2);\n    padding: 15px 20px;\n    border-radius: 8px;\n    min-width: 180px;\n}\n\n.detail-item .label {\n    display: block;\n    font-size: 0.9em;\n    opacity: 0.9;\n    margin-bottom: 5px;\n}\n\n.detail-item .value {\n    display: block;\n    font-size: 1.3em;\n    font-weight: bold;\n}\n\n.visualization {\n    background: #f8f9fa;\n    padding: 20px;\n    border-radius: 10px;\n    margin-bottom: 20px;\n}\n\n.visualization h3 {\n    margin-top: 0;\n    color: #333;\n    margin-bottom: 15px;\n}\n\n.chart-container {\n    position: relative;\n    width: 100%;\n    height: 300px;\n    background: white;\n    border-radius: 5px;\n    padding: 10px;\n}\n\n#spectrum-canvas, #signal-canvas {\n    display: block;\n    width: 100%;\n    height: 100%;\n}\n\n.bandwidth-breakdown {\n    background: #f8f9fa;\n    padding: 20px;\n    border-radius: 10px;\n    margin-bottom: 20px;\n}\n\n.bandwidth-breakdown h3 {\n    margin-top: 0;\n    color: #333;\n    margin-bottom: 20px;\n}\n\n.component-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    gap: 15px;\n}\n\n.component-card {\n    background: white;\n    padding: 20px;\n    border-radius: 10px;\n    text-align: center;\n    border: 2px solid #e0e0e0;\n    transition: transform 0.2s;\n}\n\n.component-card:hover {\n    transform: translateY(-5px);\n}\n\n.component-card.highlight {\n    background: linear-gradient(135deg, #fff3cd 0%, #ffe8a1 100%);\n    border-color: #ffc107;\n}\n\n.component-label {\n    font-size: 0.9em;\n    color: #666;\n    margin-bottom: 10px;\n}\n\n.component-value {\n    font-size: 1.8em;\n    font-weight: bold;\n    color: #667eea;\n    margin-bottom: 5px;\n}\n\n.component-card.highlight .component-value {\n    color: #f57c00;\n}\n\n.component-formula {\n    font-size: 0.85em;\n    color: #999;\n    font-style: italic;\n}\n\n.info-box {\n    background: #e7f3ff;\n    border: 1px solid #2196F3;\n    border-radius: 10px;\n    padding: 15px;\n}\n\n.info-box h4 {\n    margin-top: 0;\n    color: #1976D2;\n}\n\n.info-box ul {\n    margin: 10px 0 0 0;\n    padding-left: 20px;\n    color: #1565C0;\n}\n\n.info-box li {\n    margin: 8px 0;\n}\n\n.info-box strong {\n    color: #0D47A1;\n}\n\n@media (max-width: 768px) {\n    .card {\n        padding: 20px;\n    }\n    \n    h1 {\n        font-size: 1.5em;\n    }\n    \n    .result-value {\n        font-size: 2.5em;\n    }\n    \n    .result-details {\n        flex-direction: column;\n    }\n    \n    .chart-container {\n        height: 250px;\n    }\n    \n    .component-grid {\n        grid-template-columns: 1fr;\n    }\n}", "js": "let deltaF = 75000;\nlet fm = 15000;\nlet BW = 0;\nlet beta = 0;\n\nconst deltaSlider = document.getElementById('delta-slider');\nconst fmSlider = document.getElementById('fm-slider');\nconst deltaValue = document.getElementById('delta-value');\nconst fmValue = document.getElementById('fm-value');\nconst bwValue = document.getElementById('bw-value');\nconst betaValue = document.getElementById('beta-value');\nconst modType = document.getElementById('mod-type');\nconst bwRatio = document.getElementById('bw-ratio');\nconst deviationTerm = document.getElementById('deviation-term');\nconst modulationTerm = document.getElementById('modulation-term');\nconst totalBw = document.getElementById('total-bw');\nconst spectrumCanvas = document.getElementById('spectrum-canvas');\nconst signalCanvas = document.getElementById('signal-canvas');\nconst specCtx = spectrumCanvas.getContext('2d');\nconst sigCtx = signalCanvas.getContext('2d');\n\nfunction formatNumber(num) {\n    if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';\n    if (num >= 1e3) return (num / 1e3).toFixed(1) + 'k';\n    return num.toFixed(0);\n}\n\nfunction calculateBandwidth() {\n    BW = 2 * (deltaF + fm);\n    beta = deltaF / fm;\n    \n    bwValue.textContent = formatNumber(BW) + 'Hz';\n    betaValue.textContent = beta.toFixed(2);\n    \n    // Determine modulation type\n    if (beta < 0.3) {\n        modType.textContent = 'Narrowband FM';\n    } else if (beta < 1) {\n        modType.textContent = 'Intermediate FM';\n    } else {\n        modType.textContent = 'Wideband FM';\n    }\n    \n    // Bandwidth ratio\n    const ratio = BW / (2 * fm);\n    bwRatio.textContent = ratio.toFixed(1) + '×';\n    \n    // Component breakdown\n    deviationTerm.textContent = formatNumber(2 * deltaF) + 'Hz';\n    modulationTerm.textContent = formatNumber(2 * fm) + 'Hz';\n    totalBw.textContent = formatNumber(BW) + 'Hz';\n}\n\nfunction drawSpectrum() {\n    const width = spectrumCanvas.width;\n    const height = spectrumCanvas.height;\n    \n    specCtx.clearRect(0, 0, width, height);\n    \n    const padding = { top: 30, right: 40, bottom: 50, left: 60 };\n    const chartWidth = width - padding.left - padding.right;\n    const chartHeight = height - padding.top - padding.bottom;\n    \n    // Background\n    specCtx.fillStyle = '#fafafa';\n    specCtx.fillRect(padding.left, padding.top, chartWidth, chartHeight);\n    \n    // Grid\n    specCtx.strokeStyle = '#e0e0e0';\n    specCtx.lineWidth = 1;\n    \n    for (let i = 0; i <= 4; i++) {\n        const y = padding.top + (chartHeight * i / 4);\n        specCtx.beginPath();\n        specCtx.moveTo(padding.left, y);\n        specCtx.lineTo(padding.left + chartWidth, y);\n        specCtx.stroke();\n    }\n    \n    // Draw carrier frequency marker\n    const centerX = padding.left + chartWidth / 2;\n    \n    // Draw bandwidth indicator\n    const bwPixels = (BW / (BW * 1.5)) * chartWidth;\n    const bwLeft = centerX - bwPixels / 2;\n    const bwRight = centerX + bwPixels / 2;\n    \n    specCtx.fillStyle = 'rgba(102, 126, 234, 0.1)';\n    specCtx.fillRect(bwLeft, padding.top, bwPixels, chartHeight);\n    \n    specCtx.strokeStyle = '#667eea';\n    specCtx.lineWidth = 2;\n    specCtx.setLineDash([5, 5]);\n    specCtx.beginPath();\n    specCtx.moveTo(bwLeft, padding.top);\n    specCtx.lineTo(bwLeft, padding.top + chartHeight);\n    specCtx.moveTo(bwRight, padding.top);\n    specCtx.lineTo(bwRight, padding.top + chartHeight);\n    specCtx.stroke();\n    specCtx.setLineDash([]);\n    \n    // Draw spectral components using Bessel functions approximation\n    const maxSidebands = Math.min(Math.ceil(beta + 2), 15);\n    const spacing = chartWidth / (maxSidebands * 4);\n    \n    for (let n = -maxSidebands; n <= maxSidebands; n++) {\n        const x = centerX + n * spacing;\n        \n        // Approximate Bessel function magnitude\n        let magnitude;\n        if (n === 0) {\n            // Carrier\n            magnitude = Math.abs(Math.cos(beta / 2));\n        } else {\n            // Sidebands - simplified approximation\n            magnitude = Math.exp(-Math.abs(n) / (beta + 1)) * (beta / (Math.abs(n) + 1));\n        }\n        \n        magnitude = Math.min(magnitude, 1);\n        \n        const lineHeight = magnitude * chartHeight * 0.8;\n        const lineY = padding.top + chartHeight - lineHeight;\n        \n        // Draw spectral line\n        const color = n === 0 ? '#ffc107' : '#667eea';\n        specCtx.strokeStyle = color;\n        specCtx.lineWidth = 2;\n        specCtx.beginPath();\n        specCtx.moveTo(x, padding.top + chartHeight);\n        specCtx.lineTo(x, lineY);\n        specCtx.stroke();\n        \n        // Draw circle at top\n        specCtx.fillStyle = color;\n        specCtx.beginPath();\n        specCtx.arc(x, lineY, 3, 0, Math.PI * 2);\n        specCtx.fill();\n    }\n    \n    // Axes\n    specCtx.strokeStyle = '#333';\n    specCtx.lineWidth = 2;\n    specCtx.beginPath();\n    specCtx.moveTo(padding.left, padding.top + chartHeight);\n    specCtx.lineTo(padding.left + chartWidth, padding.top + chartHeight);\n    specCtx.stroke();\n    \n    specCtx.beginPath();\n    specCtx.moveTo(padding.left, padding.top);\n    specCtx.lineTo(padding.left, padding.top + chartHeight);\n    specCtx.stroke();\n    \n    // Labels\n    specCtx.fillStyle = '#333';\n    specCtx.font = '12px Arial';\n    specCtx.textAlign = 'center';\n    specCtx.textBaseline = 'top';\n    specCtx.fillText('Frequency', padding.left + chartWidth / 2, height - 25);\n    \n    specCtx.save();\n    specCtx.translate(20, padding.top + chartHeight / 2);\n    specCtx.rotate(-Math.PI / 2);\n    specCtx.textAlign = 'center';\n    specCtx.fillText('Amplitude', 0, 0);\n    specCtx.restore();\n    \n    // Frequency markers\n    specCtx.fillStyle = '#666';\n    specCtx.font = '10px Arial';\n    specCtx.textAlign = 'center';\n    specCtx.textBaseline = 'top';\n    specCtx.fillText('fc', centerX, padding.top + chartHeight + 5);\n    specCtx.fillText('fc - BW/2', bwLeft, padding.top + chartHeight + 20);\n    specCtx.fillText('fc + BW/2', bwRight, padding.top + chartHeight + 20);\n    \n    // Bandwidth label\n    specCtx.fillStyle = '#667eea';\n    specCtx.font = 'bold 11px Arial';\n    specCtx.fillText('BW = ' + formatNumber(BW) + 'Hz', centerX, padding.top + 10);\n}\n\nfunction drawSignal() {\n    const width = signalCanvas.width;\n    const height = signalCanvas.height;\n    \n    sigCtx.clearRect(0, 0, width, height);\n    \n    const padding = { top: 30, right: 30, bottom: 50, left: 60 };\n    const chartWidth = width - padding.left - padding.right;\n    const chartHeight = height - padding.top - padding.bottom;\n    \n    // Background\n    sigCtx.fillStyle = '#fafafa';\n    sigCtx.fillRect(padding.left, padding.top, chartWidth, chartHeight);\n    \n    // Grid\n    sigCtx.strokeStyle = '#e0e0e0';\n    sigCtx.lineWidth = 1;\n    \n    for (let i = 0; i <= 4; i++) {\n        const y = padding.top + (chartHeight * i / 4);\n        sigCtx.beginPath();\n        sigCtx.moveTo(padding.left, y);\n        sigCtx.lineTo(padding.left + chartWidth, y);\n        sigCtx.stroke();\n    }\n    \n    // Draw modulating signal (dashed)\n    sigCtx.strokeStyle = '#ff9800';\n    sigCtx.lineWidth = 2;\n    sigCtx.setLineDash([5, 5]);\n    sigCtx.beginPath();\n    \n    const points = 500;\n    const cycles = 3;\n    \n    for (let i = 0; i <= points; i++) {\n        const t = (i / points) * cycles * 2 * Math.PI;\n        const x = padding.left + (i / points) * chartWidth;\n        const modulating = Math.cos(t);\n        const y = padding.top + chartHeight / 2 - (modulating * chartHeight * 0.25);\n        \n        if (i === 0) {\n            sigCtx.moveTo(x, y);\n        } else {\n            sigCtx.lineTo(x, y);\n        }\n    }\n    sigCtx.stroke();\n    sigCtx.setLineDash([]);\n    \n    // Draw FM signal\n    sigCtx.strokeStyle = '#667eea';\n    sigCtx.lineWidth = 2;\n    sigCtx.beginPath();\n    \n    let phase = 0;\n    const dt = 1 / points;\n    \n    for (let i = 0; i <= points; i++) {\n        const t = (i / points) * cycles * 2 * Math.PI;\n        const x = padding.left + (i / points) * chartWidth;\n        \n        const modulating = Math.cos(t);\n        const instantFreq = 1 + (beta * 0.5) * modulating;\n        phase += instantFreq * dt * 20;\n        \n        const signal = Math.cos(phase);\n        const y = padding.top + chartHeight / 2 - (signal * chartHeight * 0.4);\n        \n        if (i === 0) {\n            sigCtx.moveTo(x, y);\n        } else {\n            sigCtx.lineTo(x, y);\n        }\n    }\n    sigCtx.stroke();\n    \n    // Axes\n    sigCtx.strokeStyle = '#333';\n    sigCtx.lineWidth = 2;\n    sigCtx.beginPath();\n    sigCtx.moveTo(padding.left, padding.top + chartHeight / 2);\n    sigCtx.lineTo(padding.left + chartWidth, padding.top + chartHeight / 2);\n    sigCtx.stroke();\n    \n    // Labels\n    sigCtx.fillStyle = '#333';\n    sigCtx.font = '12px Arial';\n    sigCtx.textAlign = 'center';\n    sigCtx.textBaseline = 'top';\n    sigCtx.fillText('Time', padding.left + chartWidth / 2, height - 25);\n    \n    sigCtx.save();\n    sigCtx.translate(20, padding.top + chartHeight / 2);\n    sigCtx.rotate(-Math.PI / 2);\n    sigCtx.textAlign = 'center';\n    sigCtx.fillText('Amplitude', 0, 0);\n    sigCtx.restore();\n    \n    // Legend\n    sigCtx.font = '11px Arial';\n    sigCtx.textAlign = 'left';\n    sigCtx.fillStyle = '#667eea';\n    sigCtx.fillText('FM Signal', padding.left + 10, padding.top + 10);\n    sigCtx.fillStyle = '#ff9800';\n    sigCtx.fillText('Modulating Signal', padding.left + 100, padding.top + 10);\n}\n\nfunction resizeCanvas(canvas) {\n    const container = canvas.parentElement;\n    const rect = container.getBoundingClientRect();\n    \n    const dpr = window.devicePixelRatio || 1;\n    canvas.width = rect.width * dpr;\n    canvas.height = rect.height * dpr;\n    \n    const ctx = canvas.getContext('2d');\n    ctx.scale(dpr, dpr);\n    \n    canvas.style.width = rect.width + 'px';\n    canvas.style.height = rect.height + 'px';\n}\n\nfunction updateSimulation() {\n    calculateBandwidth();\n    drawSpectrum();\n    drawSignal();\n}\n\ndeltaSlider.addEventListener('input', (e) => {\n    deltaF = parseFloat(e.target.value);\n    deltaValue.textContent = formatNumber(deltaF) + 'Hz';\n    updateSimulation();\n});\n\nfmSlider.addEventListener('input', (e) => {\n    fm = parseFloat(e.target.value);\n    fmValue.textContent = formatNumber(fm) + 'Hz';\n    updateSimulation();\n});\n\nwindow.addEventListener('resize', () => {\n    resizeCanvas(spectrumCanvas);\n    resizeCanvas(signalCanvas);\n    updateSimulation();\n});\n\n// Initialize\nresizeCanvas(spectrumCanvas);\nresizeCanvas(signalCanvas);\nupdateSimulation();"}}
{"input": {"input_text": "Closed-loop first-order with gain K and time constant tau: G(s) = K/(tau s + 1). Step response y = K*(1 - exp(-t/tau)).", "simulation_name": " First Order Step", "domain": "Control", "description": "Unit step of first-order system", "assumptions": ["Linear time-invariant"], "entities": [], "constants": [], "parameters": [{"name": "gain", "symbol": "K", "unit": "dimensionless", "range": [-10, 10]}, {"name": "time_constant", "symbol": "tau", "unit": "s", "range": [0.0001, 10000.0]}, {"name": "time", "symbol": "t", "unit": "s", "range": [0, 1000000.0]}], "equations": [{"description": "Step response", "expression": "y(t) = K*(1 - exp(-t/tau))"}], "initial_conditions": {"y": 0, "t": 0}, "outputs": ["y"], "simulation_controls": ["K", "tau", "t"], "constraints": ["tau>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S77 First Order Step</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"card\">\n            <h1>S77 First Order Step</h1>\n            <p class=\"subtitle\">Transfer Function: G(s) = K/(τs + 1) | Step Response: y(t) = K(1 - e^(-t/τ))</p>\n\n            <div class=\"controls-grid\">\n                <div class=\"control-panel\">\n                    <label>\n                        Gain (K): <span id=\"k-value\">1.00</span>\n                    </label>\n                    <input type=\"range\" id=\"k-slider\" min=\"-10\" max=\"10\" step=\"0.1\" value=\"1\">\n                    <div class=\"range-labels\">\n                        <span>-10</span>\n                        <span>10</span>\n                    </div>\n                </div>\n\n                <div class=\"control-panel\">\n                    <label>\n                        Time Constant (τ): <span id=\"tau-value\">1.00 s</span>\n                    </label>\n                    <input type=\"range\" id=\"tau-slider\" min=\"0.1\" max=\"10\" step=\"0.1\" value=\"1\">\n                    <div class=\"range-labels\">\n                        <span>0.1 s</span>\n                        <span>10 s</span>\n                    </div>\n                </div>\n\n                <div class=\"control-panel\">\n                    <label>\n                        Current Time (t): <span id=\"t-value\">0.00 s</span>\n                    </label>\n                    <input type=\"range\" id=\"t-slider\" min=\"0\" max=\"20\" step=\"0.1\" value=\"0\">\n                    <div class=\"range-labels\">\n                        <span>0 s</span>\n                        <span>20 s</span>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"result-panel\">\n                <h2>Output at t = <span id=\"current-time\">0.00</span> s</h2>\n                <div class=\"result-value\" id=\"y-value\">0.000</div>\n                <div class=\"result-details\">\n                    <div class=\"detail-item\">\n                        <span class=\"label\">Steady State (K):</span>\n                        <span class=\"value\" id=\"steady-state\">1.00</span>\n                    </div>\n                    <div class=\"detail-item\">\n                        <span class=\"label\">% of Steady State:</span>\n                        <span class=\"value\" id=\"percent-ss\">0.0%</span>\n                    </div>\n                    <div class=\"detail-item\">\n                        <span class=\"label\">Time Constants:</span>\n                        <span class=\"value\" id=\"time-constants\">0.00τ</span>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"visualization\">\n                <h3>Step Response</h3>\n                <div class=\"chart-container\">\n                    <canvas id=\"response-canvas\"></canvas>\n                </div>\n            </div>\n\n            <div class=\"characteristics\">\n                <h3>System Characteristics</h3>\n                <div class=\"char-grid\">\n                    <div class=\"char-card\">\n                        <div class=\"char-label\">Rise Time (10%-90%)</div>\n                        <div class=\"char-value\" id=\"rise-time\">2.20 s</div>\n                    </div>\n                    <div class=\"char-card\">\n                        <div class=\"char-label\">Settling Time (2%)</div>\n                        <div class=\"char-value\" id=\"settling-time\">4.00 s</div>\n                    </div>\n                    <div class=\"char-card\">\n                        <div class=\"char-label\">Time to 63.2% (1τ)</div>\n                        <div class=\"char-value\" id=\"one-tau\">1.00 s</div>\n                    </div>\n                    <div class=\"char-card\">\n                        <div class=\"char-label\">Final Value</div>\n                        <div class=\"char-value\" id=\"final-value\">1.00</div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"timeline\">\n                <h3>Time Constant Milestones</h3>\n                <div class=\"milestone-container\">\n                    <div class=\"milestone\">\n                        <div class=\"milestone-label\">1τ</div>\n                        <div class=\"milestone-value\">63.2%</div>\n                    </div>\n                    <div class=\"milestone\">\n                        <div class=\"milestone-label\">2τ</div>\n                        <div class=\"milestone-value\">86.5%</div>\n                    </div>\n                    <div class=\"milestone\">\n                        <div class=\"milestone-label\">3τ</div>\n                        <div class=\"milestone-value\">95.0%</div>\n                    </div>\n                    <div class=\"milestone\">\n                        <div class=\"milestone-label\">4τ</div>\n                        <div class=\"milestone-value\">98.2%</div>\n                    </div>\n                    <div class=\"milestone\">\n                        <div class=\"milestone-label\">5τ</div>\n                        <div class=\"milestone-value\">99.3%</div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"info-box\">\n                <h4>⚙️ First-Order System Characteristics</h4>\n                <ul>\n                    <li><strong>Time Constant (τ):</strong> Time to reach 63.2% of final value</li>\n                    <li><strong>Settling Time:</strong> ~4τ (98.2% of final value)</li>\n                    <li><strong>No Overshoot:</strong> First-order systems never overshoot</li>\n                    <li><strong>Exponential Response:</strong> Asymptotic approach to steady state</li>\n                </ul>\n            </div>\n        </div>\n    </div>\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Arial', sans-serif;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    min-height: 100vh;\n    padding: 20px;\n}\n\n.container {\n    max-width: 1200px;\n    margin: 0 auto;\n}\n\n.card {\n    background: white;\n    border-radius: 15px;\n    padding: 30px;\n    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);\n}\n\nh1 {\n    text-align: center;\n    color: #667eea;\n    margin-bottom: 10px;\n    font-size: 2em;\n}\n\n.subtitle {\n    text-align: center;\n    color: #666;\n    margin-bottom: 30px;\n    font-size: 0.95em;\n}\n\n.controls-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));\n    gap: 20px;\n    margin-bottom: 30px;\n}\n\n.control-panel {\n    background: #f8f9fa;\n    padding: 20px;\n    border-radius: 10px;\n    border: 2px solid #667eea;\n}\n\n.control-panel:nth-child(2) {\n    border-color: #764ba2;\n}\n\n.control-panel:nth-child(3) {\n    border-color: #20c997;\n}\n\n.control-panel label {\n    display: block;\n    margin-bottom: 10px;\n    font-weight: bold;\n    color: #333;\n}\n\n.control-panel label span {\n    color: #667eea;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    height: 8px;\n    border-radius: 5px;\n    outline: none;\n    -webkit-appearance: none;\n    background: #ddd;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #667eea;\n    cursor: pointer;\n}\n\ninput[type=\"range\"]::-moz-range-thumb {\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #667eea;\n    cursor: pointer;\n    border: none;\n}\n\n.range-labels {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.8em;\n    color: #666;\n    margin-top: 5px;\n}\n\n.result-panel {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    padding: 30px;\n    border-radius: 10px;\n    margin-bottom: 30px;\n    text-align: center;\n    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);\n}\n\n.result-panel h2 {\n    margin: 0 0 10px 0;\n    font-size: 1.2em;\n}\n\n.result-value {\n    font-size: 3.5em;\n    font-weight: bold;\n    margin-bottom: 20px;\n}\n\n.result-details {\n    display: flex;\n    justify-content: space-around;\n    flex-wrap: wrap;\n    gap: 15px;\n    margin-top: 20px;\n}\n\n.detail-item {\n    background: rgba(255, 255, 255, 0.2);\n    padding: 15px 20px;\n    border-radius: 8px;\n    min-width: 180px;\n}\n\n.detail-item .label {\n    display: block;\n    font-size: 0.9em;\n    opacity: 0.9;\n    margin-bottom: 5px;\n}\n\n.detail-item .value {\n    display: block;\n    font-size: 1.3em;\n    font-weight: bold;\n}\n\n.visualization {\n    background: #f8f9fa;\n    padding: 20px;\n    border-radius: 10px;\n    margin-bottom: 20px;\n}\n\n.visualization h3 {\n    margin-top: 0;\n    color: #333;\n    margin-bottom: 15px;\n}\n\n.chart-container {\n    position: relative;\n    width: 100%;\n    height: 400px;\n    background: white;\n    border-radius: 5px;\n    padding: 10px;\n}\n\n#response-canvas {\n    display: block;\n    width: 100%;\n    height: 100%;\n}\n\n.characteristics {\n    background: #f8f9fa;\n    padding: 20px;\n    border-radius: 10px;\n    margin-bottom: 20px;\n}\n\n.characteristics h3 {\n    margin-top: 0;\n    color: #333;\n    margin-bottom: 20px;\n}\n\n.char-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    gap: 15px;\n}\n\n.char-card {\n    background: white;\n    padding: 20px;\n    border-radius: 10px;\n    text-align: center;\n    border: 2px solid #e0e0e0;\n    transition: transform 0.2s;\n}\n\n.char-card:hover {\n    transform: translateY(-5px);\n    border-color: #667eea;\n}\n\n.char-label {\n    font-size: 0.9em;\n    color: #666;\n    margin-bottom: 10px;\n}\n\n.char-value {\n    font-size: 1.8em;\n    font-weight: bold;\n    color: #667eea;\n}\n\n.timeline {\n    background: #f8f9fa;\n    padding: 20px;\n    border-radius: 10px;\n    margin-bottom: 20px;\n}\n\n.timeline h3 {\n    margin-top: 0;\n    color: #333;\n    margin-bottom: 20px;\n}\n\n.milestone-container {\n    display: flex;\n    justify-content: space-around;\n    flex-wrap: wrap;\n    gap: 15px;\n}\n\n.milestone {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    padding: 15px 20px;\n    border-radius: 10px;\n    text-align: center;\n    min-width: 100px;\n    box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);\n}\n\n.milestone-label {\n    font-size: 1.2em;\n    font-weight: bold;\n    margin-bottom: 5px;\n}\n\n.milestone-value {\n    font-size: 1.5em;\n    font-weight: bold;\n}\n\n.info-box {\n    background: #e7f3ff;\n    border: 1px solid #2196F3;\n    border-radius: 10px;\n    padding: 15px;\n}\n\n.info-box h4 {\n    margin-top: 0;\n    color: #1976D2;\n}\n\n.info-box ul {\n    margin: 10px 0 0 0;\n    padding-left: 20px;\n    color: #1565C0;\n}\n\n.info-box li {\n    margin: 8px 0;\n}\n\n.info-box strong {\n    color: #0D47A1;\n}\n\n@media (max-width: 768px) {\n    .card {\n        padding: 20px;\n    }\n    \n    h1 {\n        font-size: 1.5em;\n    }\n    \n    .subtitle {\n        font-size: 0.85em;\n    }\n    \n    .result-value {\n        font-size: 2.5em;\n    }\n    \n    .result-details {\n        flex-direction: column;\n    }\n    \n    .chart-container {\n        height: 300px;\n    }\n    \n    .char-grid {\n        grid-template-columns: 1fr;\n    }\n    \n    .milestone-container {\n        flex-direction: column;\n    }\n}", "js": "let K = 1;\nlet tau = 1;\nlet t = 0;\nlet y = 0;\n\nconst kSlider = document.getElementById('k-slider');\nconst tauSlider = document.getElementById('tau-slider');\nconst tSlider = document.getElementById('t-slider');\nconst kValue = document.getElementById('k-value');\nconst tauValue = document.getElementById('tau-value');\nconst tValue = document.getElementById('t-value');\nconst currentTime = document.getElementById('current-time');\nconst yValue = document.getElementById('y-value');\nconst steadyState = document.getElementById('steady-state');\nconst percentSs = document.getElementById('percent-ss');\nconst timeConstants = document.getElementById('time-constants');\nconst riseTime = document.getElementById('rise-time');\nconst settlingTime = document.getElementById('settling-time');\nconst oneTau = document.getElementById('one-tau');\nconst finalValue = document.getElementById('final-value');\nconst canvas = document.getElementById('response-canvas');\nconst ctx = canvas.getContext('2d');\n\nfunction formatNumber(num) {\n    if (Math.abs(num) >= 1000) return num.toFixed(0);\n    if (Math.abs(num) >= 10) return num.toFixed(2);\n    return num.toFixed(3);\n}\n\nfunction calculateResponse(time) {\n    if (tau <= 0) return 0;\n    return K * (1 - Math.exp(-time / tau));\n}\n\nfunction updateResults() {\n    y = calculateResponse(t);\n    \n    yValue.textContent = formatNumber(y);\n    currentTime.textContent = t.toFixed(2);\n    steadyState.textContent = formatNumber(K);\n    \n    const percent = K !== 0 ? (y / K) * 100 : 0;\n    percentSs.textContent = percent.toFixed(1) + '%';\n    \n    const numTau = t / tau;\n    timeConstants.textContent = numTau.toFixed(2) + 'τ';\n    \n    // Calculate characteristics\n    const rt = tau * (Math.log(0.9) - Math.log(0.1)) / (-1);\n    riseTime.textContent = rt.toFixed(2) + ' s';\n    \n    const st = 4 * tau;\n    settlingTime.textContent = st.toFixed(2) + ' s';\n    \n    oneTau.textContent = tau.toFixed(2) + ' s';\n    finalValue.textContent = formatNumber(K);\n}\n\nfunction drawResponse() {\n    const width = canvas.width;\n    const height = canvas.height;\n    \n    ctx.clearRect(0, 0, width, height);\n    \n    const padding = { top: 30, right: 40, bottom: 60, left: 70 };\n    const chartWidth = width - padding.left - padding.right;\n    const chartHeight = height - padding.top - padding.bottom;\n    \n    // Background\n    ctx.fillStyle = '#fafafa';\n    ctx.fillRect(padding.left, padding.top, chartWidth, chartHeight);\n    \n    // Determine time range\n    const maxTime = Math.max(5 * tau, t + tau);\n    const minY = Math.min(0, K);\n    const maxY = Math.max(0, K);\n    const yRange = maxY - minY;\n    const yPadding = yRange * 0.1;\n    \n    // Grid\n    ctx.strokeStyle = '#e0e0e0';\n    ctx.lineWidth = 1;\n    \n    for (let i = 0; i <= 5; i++) {\n        const y = padding.top + (chartHeight * i / 5);\n        ctx.beginPath();\n        ctx.moveTo(padding.left, y);\n        ctx.lineTo(padding.left + chartWidth, y);\n        ctx.stroke();\n    }\n    \n    for (let i = 0; i <= 5; i++) {\n        const x = padding.left + (chartWidth * i / 5);\n        ctx.beginPath();\n        ctx.moveTo(x, padding.top);\n        ctx.lineTo(x, padding.top + chartHeight);\n        ctx.stroke();\n    }\n    \n    // Draw steady state line\n    ctx.strokeStyle = '#ffc107';\n    ctx.lineWidth = 2;\n    ctx.setLineDash([5, 5]);\n    const ssY = padding.top + chartHeight - ((K - minY - yPadding) / (yRange + 2 * yPadding)) * chartHeight;\n    ctx.beginPath();\n    ctx.moveTo(padding.left, ssY);\n    ctx.lineTo(padding.left + chartWidth, ssY);\n    ctx.stroke();\n    ctx.setLineDash([]);\n    \n    // Draw time constant markers\n    for (let i = 1; i <= 5; i++) {\n        const tcTime = i * tau;\n        if (tcTime <= maxTime) {\n            const x = padding.left + (tcTime / maxTime) * chartWidth;\n            ctx.strokeStyle = '#ff9800';\n            ctx.lineWidth = 1;\n            ctx.setLineDash([3, 3]);\n            ctx.beginPath();\n            ctx.moveTo(x, padding.top);\n            ctx.lineTo(x, padding.top + chartHeight);\n            ctx.stroke();\n            ctx.setLineDash([]);\n            \n            // Label\n            ctx.fillStyle = '#ff9800';\n            ctx.font = '10px Arial';\n            ctx.textAlign = 'center';\n            ctx.fillText(i + 'τ', x, padding.top - 5);\n        }\n    }\n    \n    // Draw response curve\n    ctx.strokeStyle = '#667eea';\n    ctx.lineWidth = 3;\n    ctx.beginPath();\n    \n    const points = 500;\n    for (let i = 0; i <= points; i++) {\n        const time = (i / points) * maxTime;\n        const response = calculateResponse(time);\n        const x = padding.left + (time / maxTime) * chartWidth;\n        const yPos = padding.top + chartHeight - ((response - minY - yPadding) / (yRange + 2 * yPadding)) * chartHeight;\n        \n        if (i === 0) {\n            ctx.moveTo(x, yPos);\n        } else {\n            ctx.lineTo(x, yPos);\n        }\n    }\n    ctx.stroke();\n    \n    // Draw current point\n    if (t <= maxTime) {\n        const x = padding.left + (t / maxTime) * chartWidth;\n        const yPos = padding.top + chartHeight - ((y - minY - yPadding) / (yRange + 2 * yPadding)) * chartHeight;\n        \n        // Vertical line\n        ctx.strokeStyle = '#dc3545';\n        ctx.lineWidth = 2;\n        ctx.setLineDash([3, 3]);\n        ctx.beginPath();\n        ctx.moveTo(x, padding.top + chartHeight);\n        ctx.lineTo(x, yPos);\n        ctx.stroke();\n        ctx.setLineDash([]);\n        \n        // Point\n        ctx.fillStyle = '#dc3545';\n        ctx.beginPath();\n        ctx.arc(x, yPos, 6, 0, Math.PI * 2);\n        ctx.fill();\n        \n        ctx.strokeStyle = 'white';\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.arc(x, yPos, 6, 0, Math.PI * 2);\n        ctx.stroke();\n    }\n    \n    // Axes\n    ctx.strokeStyle = '#333';\n    ctx.lineWidth = 2;\n    \n    // X-axis\n    ctx.beginPath();\n    ctx.moveTo(padding.left, padding.top + chartHeight);\n    ctx.lineTo(padding.left + chartWidth, padding.top + chartHeight);\n    ctx.stroke();\n    \n    // Y-axis\n    ctx.beginPath();\n    ctx.moveTo(padding.left, padding.top);\n    ctx.lineTo(padding.left, padding.top + chartHeight);\n    ctx.stroke();\n    \n    // Labels\n    ctx.fillStyle = '#333';\n    ctx.font = '12px Arial';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'top';\n    ctx.fillText('Time (s)', padding.left + chartWidth / 2, height - 25);\n    \n    ctx.save();\n    ctx.translate(20, padding.top + chartHeight / 2);\n    ctx.rotate(-Math.PI / 2);\n    ctx.textAlign = 'center';\n    ctx.fillText('Output y(t)', 0, 0);\n    ctx.restore();\n    \n    // Y-axis labels\n    ctx.fillStyle = '#666';\n    ctx.font = '11px Arial';\n    ctx.textAlign = 'right';\n    ctx.textBaseline = 'middle';\n    \n    for (let i = 0; i <= 5; i++) {\n        const val = minY + yPadding + (yRange / 5) * (5 - i);\n        const y = padding.top + (chartHeight * i / 5);\n        ctx.fillText(formatNumber(val), padding.left - 8, y);\n    }\n    \n    // X-axis labels\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'top';\n    \n    for (let i = 0; i <= 5; i++) {\n        const time = (maxTime / 5) * i;\n        const x = padding.left + (chartWidth * i / 5);\n        ctx.fillText(formatNumber(time), x, padding.top + chartHeight + 5);\n    }\n    \n    // Legend\n    ctx.font = '11px Arial';\n    ctx.textAlign = 'left';\n    ctx.fillStyle = '#667eea';\n    ctx.fillText('Response: y(t) = K(1 - e^(-t/τ))', padding.left + 10, padding.top + 10);\n    ctx.fillStyle = '#ffc107';\n    ctx.fillText('Steady State: K = ' + formatNumber(K), padding.left + 10, padding.top + 25);\n    ctx.fillStyle = '#dc3545';\n    ctx.fillText('Current: t = ' + t.toFixed(2) + ' s', padding.left + 10, padding.top + 40);\n}\n\nfunction resizeCanvas() {\n    const container = canvas.parentElement;\n    const rect = container.getBoundingClientRect();\n    \n    const dpr = window.devicePixelRatio || 1;\n    canvas.width = rect.width * dpr;\n    canvas.height = rect.height * dpr;\n    \n    ctx.scale(dpr, dpr);\n    \n    canvas.style.width = rect.width + 'px';\n    canvas.style.height = rect.height + 'px';\n    \n    drawResponse();\n}\n\nfunction updateSimulation() {\n    updateResults();\n    drawResponse();\n}\n\nkSlider.addEventListener('input', (e) => {\n    K = parseFloat(e.target.value);\n    kValue.textContent = K.toFixed(2);\n    updateSimulation();\n});\n\ntauSlider.addEventListener('input', (e) => {\n    tau = parseFloat(e.target.value);\n    tauValue.textContent = tau.toFixed(2) + ' s';\n    // Update t slider max to be 5*tau\n    tSlider.max = Math.max(20, 5 * tau);\n    updateSimulation();\n});\n\ntSlider.addEventListener('input', (e) => {\n    t = parseFloat(e.target.value);\n    tValue.textContent = t.toFixed(2) + ' s';\n    updateSimulation();\n});\n\nwindow.addEventListener('resize', resizeCanvas);\n\n// Initialize\nresizeCanvas();\nupdateSimulation();"}}
{"input": {"input_text": "PID closed-loop bandwidth approximation for first-order plant Gp = 1/(tau s +1). Provide tuning placeholder equations (Ziegler-Nichols not implemented) but show structure.", "simulation_name": " PID Placeholder", "domain": "Control", "description": "PID parameter placeholders", "assumptions": ["First-order plant"], "entities": [], "constants": [], "parameters": [{"name": "kp", "symbol": "Kp", "unit": "dimensionless", "range": [0, 100]}, {"name": "ki", "symbol": "Ki", "unit": "1/s", "range": [0, 100]}, {"name": "kd", "symbol": "Kd", "unit": "s", "range": [0, 10]}, {"name": "plant_tau", "symbol": "tau", "unit": "s", "range": [0.001, 100]}], "equations": [{"description": "Closed-loop form", "expression": "Gc(s) = Kp + Ki/s + Kd*s"}, {"description": "Open loop", "expression": "L(s) = Gc(s)/(tau*s + 1)"}], "initial_conditions": {}, "outputs": ["Gc", "L"], "simulation_controls": ["Kp", "Ki", "Kd", "tau"], "constraints": ["tau>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S78 PID Placeholder</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"card\">\n            <h1>S78 PID Controller</h1>\n            <p class=\"subtitle\">PID: Gc(s) = Kp + Ki/s + Kd·s | Plant: Gp(s) = 1/(τs + 1)</p>\n\n            <div class=\"controls-grid\">\n                <div class=\"control-panel\">\n                    <label>\n                        Proportional Gain (Kp): <span id=\"kp-value\">1.00</span>\n                    </label>\n                    <input type=\"range\" id=\"kp-slider\" min=\"0\" max=\"50\" step=\"0.1\" value=\"1\">\n                    <div class=\"range-labels\">\n                        <span>0</span>\n                        <span>50</span>\n                    </div>\n                </div>\n\n                <div class=\"control-panel\">\n                    <label>\n                        Integral Gain (Ki): <span id=\"ki-value\">0.50 1/s</span>\n                    </label>\n                    <input type=\"range\" id=\"ki-slider\" min=\"0\" max=\"20\" step=\"0.1\" value=\"0.5\">\n                    <div class=\"range-labels\">\n                        <span>0 1/s</span>\n                        <span>20 1/s</span>\n                    </div>\n                </div>\n\n                <div class=\"control-panel\">\n                    <label>\n                        Derivative Gain (Kd): <span id=\"kd-value\">0.10 s</span>\n                    </label>\n                    <input type=\"range\" id=\"kd-slider\" min=\"0\" max=\"5\" step=\"0.01\" value=\"0.1\">\n                    <div class=\"range-labels\">\n                        <span>0 s</span>\n                        <span>5 s</span>\n                    </div>\n                </div>\n\n                <div class=\"control-panel\">\n                    <label>\n                        Plant Time Constant (τ): <span id=\"tau-value\">1.00 s</span>\n                    </label>\n                    <input type=\"range\" id=\"tau-slider\" min=\"0.1\" max=\"10\" step=\"0.1\" value=\"1\">\n                    <div class=\"range-labels\">\n                        <span>0.1 s</span>\n                        <span>10 s</span>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"result-panel\">\n                <h2>PID Controller Parameters</h2>\n                <div class=\"pid-equation\">\n                    Gc(s) = <span id=\"kp-display\">1.00</span> + <span id=\"ki-display\">0.50</span>/s + <span id=\"kd-display\">0.10</span>·s\n                </div>\n                <div class=\"result-details\">\n                    <div class=\"detail-item\">\n                        <span class=\"label\">P Action:</span>\n                        <span class=\"value\" id=\"p-action\">Kp = 1.00</span>\n                    </div>\n                    <div class=\"detail-item\">\n                        <span class=\"label\">I Action:</span>\n                        <span class=\"value\" id=\"i-action\">Ki = 0.50</span>\n                    </div>\n                    <div class=\"detail-item\">\n                        <span class=\"label\">D Action:</span>\n                        <span class=\"value\" id=\"d-action\">Kd = 0.10</span>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"visualization\">\n                <h3>Closed-Loop Step Response</h3>\n                <div class=\"chart-container\">\n                    <canvas id=\"response-canvas\"></canvas>\n                </div>\n            </div>\n\n            <div class=\"visualization\">\n                <h3>Bode Plot (Open Loop L(s) = Gc(s)·Gp(s))</h3>\n                <div class=\"chart-container\">\n                    <canvas id=\"bode-canvas\"></canvas>\n                </div>\n            </div>\n\n            <div class=\"tuning-methods\">\n                <h3>PID Tuning Guidelines</h3>\n                <div class=\"method-grid\">\n                    <div class=\"method-card\">\n                        <div class=\"method-name\">Ziegler-Nichols (Ultimate)</div>\n                        <div class=\"method-info\">Find Ku and Tu at stability limit</div>\n                        <div class=\"method-formula\">Kp = 0.6·Ku, Ki = 2Kp/Tu, Kd = Kp·Tu/8</div>\n                    </div>\n                    <div class=\"method-card\">\n                        <div class=\"method-name\">Cohen-Coon</div>\n                        <div class=\"method-info\">Based on process reaction curve</div>\n                        <div class=\"method-formula\">Uses step response characteristics</div>\n                    </div>\n                    <div class=\"method-card highlight\">\n                        <div class=\"method-name\">Manual Tuning</div>\n                        <div class=\"method-info\">Adjust sliders above</div>\n                        <div class=\"method-formula\">Start with P, add I, then D carefully</div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"action-breakdown\">\n                <h3>PID Action Effects</h3>\n                <div class=\"action-grid\">\n                    <div class=\"action-card p-card\">\n                        <div class=\"action-title\">Proportional (Kp)</div>\n                        <div class=\"action-effect\">\n                            <div class=\"effect-item\">✓ Fast response</div>\n                            <div class=\"effect-item\">✓ Reduces steady-state error</div>\n                            <div class=\"effect-item\">✗ Cannot eliminate steady-state error</div>\n                            <div class=\"effect-item\">✗ May cause overshoot</div>\n                        </div>\n                    </div>\n                    <div class=\"action-card i-card\">\n                        <div class=\"action-title\">Integral (Ki)</div>\n                        <div class=\"action-effect\">\n                            <div class=\"effect-item\">✓ Eliminates steady-state error</div>\n                            <div class=\"effect-item\">✓ Improves accuracy</div>\n                            <div class=\"effect-item\">✗ Slows response</div>\n                            <div class=\"effect-item\">✗ Can cause overshoot/oscillation</div>\n                        </div>\n                    </div>\n                    <div class=\"action-card d-card\">\n                        <div class=\"action-title\">Derivative (Kd)</div>\n                        <div class=\"action-effect\">\n                            <div class=\"effect-item\">✓ Anticipates error</div>\n                            <div class=\"effect-item\">✓ Reduces overshoot</div>\n                            <div class=\"effect-item\">✗ Amplifies noise</div>\n                            <div class=\"effect-item\">✗ Can cause instability if too high</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"info-box\">\n                <h4>🎛️ PID Control Structure</h4>\n                <ul>\n                    <li><strong>Open Loop:</strong> L(s) = Gc(s) · Gp(s) = [Kp + Ki/s + Kd·s] / (τs + 1)</li>\n                    <li><strong>Closed Loop:</strong> T(s) = L(s) / (1 + L(s))</li>\n                    <li><strong>Tuning Goal:</strong> Balance speed, stability, and accuracy</li>\n                    <li><strong>Note:</strong> This is a placeholder - actual Ziegler-Nichols requires iterative calculations</li>\n                </ul>\n            </div>\n        </div>\n    </div>\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Arial', sans-serif;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    min-height: 100vh;\n    padding: 20px;\n}\n\n.container {\n    max-width: 1200px;\n    margin: 0 auto;\n}\n\n.card {\n    background: white;\n    border-radius: 15px;\n    padding: 30px;\n    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);\n}\n\nh1 {\n    text-align: center;\n    color: #667eea;\n    margin-bottom: 10px;\n    font-size: 2em;\n}\n\n.subtitle {\n    text-align: center;\n    color: #666;\n    margin-bottom: 30px;\n    font-size: 0.95em;\n}\n\n.controls-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n    gap: 20px;\n    margin-bottom: 30px;\n}\n\n.control-panel {\n    background: #f8f9fa;\n    padding: 20px;\n    border-radius: 10px;\n    border: 2px solid #667eea;\n}\n\n.control-panel:nth-child(2) {\n    border-color: #28a745;\n}\n\n.control-panel:nth-child(3) {\n    border-color: #dc3545;\n}\n\n.control-panel:nth-child(4) {\n    border-color: #ffc107;\n}\n\n.control-panel label {\n    display: block;\n    margin-bottom: 10px;\n    font-weight: bold;\n    color: #333;\n}\n\n.control-panel label span {\n    color: #667eea;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    height: 8px;\n    border-radius: 5px;\n    outline: none;\n    -webkit-appearance: none;\n    background: #ddd;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #667eea;\n    cursor: pointer;\n}\n\ninput[type=\"range\"]::-moz-range-thumb {\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #667eea;\n    cursor: pointer;\n    border: none;\n}\n\n.range-labels {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.8em;\n    color: #666;\n    margin-top: 5px;\n}\n\n.result-panel {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    padding: 30px;\n    border-radius: 10px;\n    margin-bottom: 30px;\n    text-align: center;\n    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);\n}\n\n.result-panel h2 {\n    margin: 0 0 15px 0;\n    font-size: 1.2em;\n}\n\n.pid-equation {\n    font-size: 2em;\n    font-weight: bold;\n    margin-bottom: 20px;\n    font-family: 'Courier New', monospace;\n}\n\n.result-details {\n    display: flex;\n    justify-content: space-around;\n    flex-wrap: wrap;\n    gap: 15px;\n    margin-top: 20px;\n}\n\n.detail-item {\n    background: rgba(255, 255, 255, 0.2);\n    padding: 15px 20px;\n    border-radius: 8px;\n    min-width: 150px;\n}\n\n.detail-item .label {\n    display: block;\n    font-size: 0.9em;\n    opacity: 0.9;\n    margin-bottom: 5px;\n}\n\n.detail-item .value {\n    display: block;\n    font-size: 1.3em;\n    font-weight: bold;\n}\n\n.visualization {\n    background: #f8f9fa;\n    padding: 20px;\n    border-radius: 10px;\n    margin-bottom: 20px;\n}\n\n.visualization h3 {\n    margin-top: 0;\n    color: #333;\n    margin-bottom: 15px;\n}\n\n.chart-container {\n    position: relative;\n    width: 100%;\n    height: 350px;\n    background: white;\n    border-radius: 5px;\n    padding: 10px;\n}\n\n#response-canvas, #bode-canvas {\n    display: block;\n    width: 100%;\n    height: 100%;\n}\n\n.tuning-methods {\n    background: #f8f9fa;\n    padding: 20px;\n    border-radius: 10px;\n    margin-bottom: 20px;\n}\n\n.tuning-methods h3 {\n    margin-top: 0;\n    color: #333;\n    margin-bottom: 20px;\n}\n\n.method-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n    gap: 15px;\n}\n\n.method-card {\n    background: white;\n    padding: 20px;\n    border-radius: 10px;\n    border: 2px solid #e0e0e0;\n}\n\n.method-card.highlight {\n    background: linear-gradient(135deg, #fff3cd 0%, #ffe8a1 100%);\n    border-color: #ffc107;\n}\n\n.method-name {\n    font-weight: bold;\n    color: #667eea;\n    margin-bottom: 10px;\n    font-size: 1.1em;\n}\n\n.method-info {\n    color: #666;\n    margin-bottom: 10px;\n    font-size: 0.9em;\n}\n\n.method-formula {\n    font-family: 'Courier New', monospace;\n    background: #f8f9fa;\n    padding: 8px;\n    border-radius: 5px;\n    font-size: 0.85em;\n    color: #333;\n}\n\n.action-breakdown {\n    background: #f8f9fa;\n    padding: 20px;\n    border-radius: 10px;\n    margin-bottom: 20px;\n}\n\n.action-breakdown h3 {\n    margin-top: 0;\n    color: #333;\n    margin-bottom: 20px;\n}\n\n.action-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n    gap: 15px;\n}\n\n.action-card {\n    background: white;\n    padding: 20px;\n    border-radius: 10px;\n    border: 3px solid;\n}\n\n.p-card {\n    border-color: #667eea;\n}\n\n.i-card {\n    border-color: #28a745;\n}\n\n.d-card {\n    border-color: #dc3545;\n}\n\n.action-title {\n    font-weight: bold;\n    font-size: 1.1em;\n    margin-bottom: 15px;\n    text-align: center;\n}\n\n.p-card .action-title {\n    color: #667eea;\n}\n\n.i-card .action-title {\n    color: #28a745;\n}\n\n.d-card .action-title {\n    color: #dc3545;\n}\n\n.action-effect {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.effect-item {\n    font-size: 0.9em;\n    color: #333;\n    padding: 5px 0;\n}\n\n.info-box {\n    background: #e7f3ff;\n    border: 1px solid #2196F3;\n    border-radius: 10px;\n    padding: 15px;\n}\n\n.info-box h4 {\n    margin-top: 0;\n    color: #1976D2;\n}\n\n.info-box ul {\n    margin: 10px 0 0 0;\n    padding-left: 20px;\n    color: #1565C0;\n}\n\n.info-box li {\n    margin: 8px 0;\n}\n\n.info-box strong {\n    color: #0D47A1;\n}\n\n@media (max-width: 768px) {\n    .card {\n        padding: 20px;\n    }\n    \n    h1 {\n        font-size: 1.5em;\n    }\n    \n    .pid-equation {\n        font-size: 1.3em;\n    }\n    \n    .result-details {\n        flex-direction: column;\n    }\n    \n    .chart-container {\n        height: 250px;\n    }\n    \n    .method-grid, .action-grid {\n        grid-template-columns: 1fr;\n    }\n}", "js": "let Kp = 1;\nlet Ki = 0.5;\nlet Kd = 0.1;\nlet tau = 1;\n\nconst kpSlider = document.getElementById('kp-slider');\nconst kiSlider = document.getElementById('ki-slider');\nconst kdSlider = document.getElementById('kd-slider');\nconst tauSlider = document.getElementById('tau-slider');\nconst kpValue = document.getElementById('kp-value');\nconst kiValue = document.getElementById('ki-value');\nconst kdValue = document.getElementById('kd-value');\nconst tauValue = document.getElementById('tau-value');\nconst kpDisplay = document.getElementById('kp-display');\nconst kiDisplay = document.getElementById('ki-display');\nconst kdDisplay = document.getElementById('kd-display');\nconst pAction = document.getElementById('p-action');\nconst iAction = document.getElementById('i-action');\nconst dAction = document.getElementById('d-action');\nconst responseCanvas = document.getElementById('response-canvas');\nconst bodeCanvas = document.getElementById('bode-canvas');\nconst respCtx = responseCanvas.getContext('2d');\nconst bodeCtx = bodeCanvas.getContext('2d');\n\nfunction formatNumber(num) {\n    if (Math.abs(num) >= 1000) return num.toFixed(0);\n    if (Math.abs(num) >= 10) return num.toFixed(2);\n    return num.toFixed(2);\n}\n\nfunction updateDisplay() {\n    kpDisplay.textContent = Kp.toFixed(2);\n    kiDisplay.textContent = Ki.toFixed(2);\n    kdDisplay.textContent = Kd.toFixed(2);\n    pAction.textContent = 'Kp = ' + Kp.toFixed(2);\n    iAction.textContent = 'Ki = ' + Ki.toFixed(2);\n    dAction.textContent = 'Kd = ' + Kd.toFixed(2);\n}\n\nfunction simulateClosedLoopStep() {\n    // Simplified closed-loop step response simulation\n    const dt = 0.01;\n    const duration = Math.max(10 * tau, 10);\n    const steps = Math.floor(duration / dt);\n    \n    let y = 0;\n    let integral = 0;\n    let prevError = 0;\n    const data = [];\n    \n    for (let i = 0; i <= steps; i++) {\n        const t = i * dt;\n        const setpoint = 1;\n        const error = setpoint - y;\n        \n        integral += error * dt;\n        const derivative = (error - prevError) / dt;\n        \n        const u = Kp * error + Ki * integral + Kd * derivative;\n        \n        // First-order plant response\n        const dydt = (u - y) / tau;\n        y += dydt * dt;\n        \n        prevError = error;\n        \n        if (i % 10 === 0) {\n            data.push({ t, y });\n        }\n    }\n    \n    return data;\n}\n\nfunction drawStepResponse() {\n    const width = responseCanvas.width;\n    const height = responseCanvas.height;\n    \n    respCtx.clearRect(0, 0, width, height);\n    \n    const padding = { top: 30, right: 40, bottom: 60, left: 70 };\n    const chartWidth = width - padding.left - padding.right;\n    const chartHeight = height - padding.top - padding.bottom;\n    \n    // Background\n    respCtx.fillStyle = '#fafafa';\n    respCtx.fillRect(padding.left, padding.top, chartWidth, chartHeight);\n    \n    // Get response data\n    const data = simulateClosedLoopStep();\n    const maxTime = data[data.length - 1].t;\n    const yValues = data.map(d => d.y);\n    const minY = Math.min(0, ...yValues);\n    const maxY = Math.max(1.5, ...yValues);\n    const yRange = maxY - minY;\n    \n    // Grid\n    respCtx.strokeStyle = '#e0e0e0';\n    respCtx.lineWidth = 1;\n    \n    for (let i = 0; i <= 5; i++) {\n        const y = padding.top + (chartHeight * i / 5);\n        respCtx.beginPath();\n        respCtx.moveTo(padding.left, y);\n        respCtx.lineTo(padding.left + chartWidth, y);\n        respCtx.stroke();\n    }\n    \n    for (let i = 0; i <= 5; i++) {\n        const x = padding.left + (chartWidth * i / 5);\n        respCtx.beginPath();\n        respCtx.moveTo(x, padding.top);\n        respCtx.lineTo(x, padding.top + chartHeight);\n        respCtx.stroke();\n    }\n    \n    // Draw setpoint line\n    respCtx.strokeStyle = '#ffc107';\n    respCtx.lineWidth = 2;\n    respCtx.setLineDash([5, 5]);\n    const setpointY = padding.top + chartHeight - ((1 - minY) / yRange) * chartHeight;\n    respCtx.beginPath();\n    respCtx.moveTo(padding.left, setpointY);\n    respCtx.lineTo(padding.left + chartWidth, setpointY);\n    respCtx.stroke();\n    respCtx.setLineDash([]);\n    \n    // Draw response\n    respCtx.strokeStyle = '#667eea';\n    respCtx.lineWidth = 3;\n    respCtx.beginPath();\n    \n    data.forEach((point, i) => {\n        const x = padding.left + (point.t / maxTime) * chartWidth;\n        const y = padding.top + chartHeight - ((point.y - minY) / yRange) * chartHeight;\n        \n        if (i === 0) {\n            respCtx.moveTo(x, y);\n        } else {\n            respCtx.lineTo(x, y);\n        }\n    });\n    respCtx.stroke();\n    \n    // Axes\n    respCtx.strokeStyle = '#333';\n    respCtx.lineWidth = 2;\n    respCtx.beginPath();\n    respCtx.moveTo(padding.left, padding.top + chartHeight);\n    respCtx.lineTo(padding.left + chartWidth, padding.top + chartHeight);\n    respCtx.stroke();\n    \n    respCtx.beginPath();\n    respCtx.moveTo(padding.left, padding.top);\n    respCtx.lineTo(padding.left, padding.top + chartHeight);\n    respCtx.stroke();\n    \n    // Labels\n    respCtx.fillStyle = '#333';\n    respCtx.font = '12px Arial';\n    respCtx.textAlign = 'center';\n    respCtx.textBaseline = 'top';\n    respCtx.fillText('Time (s)', padding.left + chartWidth / 2, height - 25);\n    \n    respCtx.save();\n    respCtx.translate(20, padding.top + chartHeight / 2);\n    respCtx.rotate(-Math.PI / 2);\n    respCtx.textAlign = 'center';\n    respCtx.fillText('Output', 0, 0);\n    respCtx.restore();\n    \n    // Y-axis labels\n    respCtx.fillStyle = '#666';\n    respCtx.font = '11px Arial';\n    respCtx.textAlign = 'right';\n    respCtx.textBaseline = 'middle';\n    \n    for (let i = 0; i <= 5; i++) {\n        const val = minY + (yRange / 5) * (5 - i);\n        const y = padding.top + (chartHeight * i / 5);\n        respCtx.fillText(formatNumber(val), padding.left - 8, y);\n    }\n    \n    // X-axis labels\n    respCtx.textAlign = 'center';\n    respCtx.textBaseline = 'top';\n    \n    for (let i = 0; i <= 5; i++) {\n        const time = (maxTime / 5) * i;\n        const x = padding.left + (chartWidth * i / 5);\n        respCtx.fillText(formatNumber(time), x, padding.top + chartHeight + 5);\n    }\n    \n    // Legend\n    respCtx.font = '11px Arial';\n    respCtx.textAlign = 'left';\n    respCtx.fillStyle = '#667eea';\n    respCtx.fillText('Closed-Loop Response', padding.left + 10, padding.top + 10);\n    respCtx.fillStyle = '#ffc107';\n    respCtx.fillText('Setpoint = 1', padding.left + 10, padding.top + 25);\n}\n\nfunction drawBodePlot() {\n    const width = bodeCanvas.width;\n    const height = bodeCanvas.height;\n    \n    bodeCtx.clearRect(0, 0, width, height);\n    \n    const padding = { top: 30, right: 40, bottom: 60, left: 70 };\n    const chartWidth = width - padding.left - padding.right;\n    const chartHeight = height - padding.top - padding.bottom;\n    \n    // Background\n    bodeCtx.fillStyle = '#fafafa';\n    bodeCtx.fillRect(padding.left, padding.top, chartWidth, chartHeight);\n    \n    // Grid\n    bodeCtx.strokeStyle = '#e0e0e0';\n    bodeCtx.lineWidth = 1;\n    \n    for (let i = 0; i <= 5; i++) {\n        const y = padding.top + (chartHeight * i / 5);\n        bodeCtx.beginPath();\n        bodeCtx.moveTo(padding.left, y);\n        bodeCtx.lineTo(padding.left + chartWidth, y);\n        bodeCtx.stroke();\n    }\n    \n    // Calculate open-loop frequency response\n    const minFreq = 0.001;\n    const maxFreq = 100;\n    const points = 200;\n    const magData = [];\n    \n    for (let i = 0; i <= points; i++) {\n        const logW = Math.log10(minFreq) + (i / points) * (Math.log10(maxFreq) - Math.log10(minFreq));\n        const w = Math.pow(10, logW);\n        \n        // Gc(jw) = Kp + Ki/jw + Kd*jw\n        const gcReal = Kp;\n        const gcImag = Kd * w - Ki / w;\n        const gcMag = Math.sqrt(gcReal * gcReal + gcImag * gcImag);\n        \n        // Gp(jw) = 1/(tau*jw + 1)\n        const gpMag = 1 / Math.sqrt(1 + (tau * w) * (tau * w));\n        \n        // L(jw) = Gc * Gp\n        const lMag = gcMag * gpMag;\n        const lDb = 20 * Math.log10(lMag);\n        \n        magData.push({ w, db: lDb });\n    }\n    \n    const minDb = -60;\n    const maxDb = 60;\n    \n    // Draw 0dB line\n    bodeCtx.strokeStyle = '#ffc107';\n    bodeCtx.lineWidth = 2;\n    bodeCtx.setLineDash([5, 5]);\n    const zeroDbY = padding.top + chartHeight - ((0 - minDb) / (maxDb - minDb)) * chartHeight;\n    bodeCtx.beginPath();\n    bodeCtx.moveTo(padding.left, zeroDbY);\n    bodeCtx.lineTo(padding.left + chartWidth, zeroDbY);\n    bodeCtx.stroke();\n    bodeCtx.setLineDash([]);\n    \n    // Draw magnitude plot\n    bodeCtx.strokeStyle = '#667eea';\n    bodeCtx.lineWidth = 3;\n    bodeCtx.beginPath();\n    \n    magData.forEach((point, i) => {\n        const logW = Math.log10(point.w);\n        const x = padding.left + ((logW - Math.log10(minFreq)) / (Math.log10(maxFreq) - Math.log10(minFreq))) * chartWidth;\n        const db = Math.max(minDb, Math.min(maxDb, point.db));\n        const y = padding.top + chartHeight - ((db - minDb) / (maxDb - minDb)) * chartHeight;\n        \n        if (i === 0) {\n            bodeCtx.moveTo(x, y);\n        } else {\n            bodeCtx.lineTo(x, y);\n        }\n    });\n    bodeCtx.stroke();\n    \n    // Axes\n    bodeCtx.strokeStyle = '#333';\n    bodeCtx.lineWidth = 2;\n    bodeCtx.beginPath();\n    bodeCtx.moveTo(padding.left, padding.top + chartHeight);\n    bodeCtx.lineTo(padding.left + chartWidth, padding.top + chartHeight);\n    bodeCtx.stroke();\n    \n    bodeCtx.beginPath();\n    bodeCtx.moveTo(padding.left, padding.top);\n    bodeCtx.lineTo(padding.left, padding.top + chartHeight);\n    bodeCtx.stroke();\n    \n    // Labels\n    bodeCtx.fillStyle = '#333';\n    bodeCtx.font = '12px Arial';\n    bodeCtx.textAlign = 'center';\n    bodeCtx.textBaseline = 'top';\n    bodeCtx.fillText('Frequency (rad/s)', padding.left + chartWidth / 2, height - 25);\n    \n    bodeCtx.save();\n    bodeCtx.translate(20, padding.top + chartHeight / 2);\n    bodeCtx.rotate(-Math.PI / 2);\n    bodeCtx.textAlign = 'center';\n    bodeCtx.fillText('Magnitude (dB)', 0, 0);\n    bodeCtx.restore();\n    \n    // Y-axis labels\n    bodeCtx.fillStyle = '#666';\n    bodeCtx.font = '11px Arial';\n    bodeCtx.textAlign = 'right';\n    bodeCtx.textBaseline = 'middle';\n    \n    for (let i = 0; i <= 5; i++) {\n        const db = minDb + ((maxDb - minDb) / 5) * (5 - i);\n        const y = padding.top + (chartHeight * i / 5);\n        bodeCtx.fillText(db.toFixed(0), padding.left - 8, y);\n    }\n    \n    // X-axis labels\n    bodeCtx.textAlign = 'center';\n    bodeCtx.textBaseline = 'top';\n    \n    const decades = [0.001, 0.01, 0.1, 1, 10, 100];\n    decades.forEach(freq => {\n        if (freq >= minFreq && freq <= maxFreq) {\n            const logW = Math.log10(freq);\n            const x = padding.left + ((logW - Math.log10(minFreq)) / (Math.log10(maxFreq) - Math.log10(minFreq))) * chartWidth;\n            bodeCtx.fillText(freq.toString(), x, padding.top + chartHeight + 5);\n        }\n    });\n    \n    // Legend\n    bodeCtx.font = '11px Arial';\n    bodeCtx.textAlign = 'left';\n    bodeCtx.fillStyle = '#667eea';\n    bodeCtx.fillText('Open Loop L(s)', padding.left + 10, padding.top + 10);\n    bodeCtx.fillStyle = '#ffc107';\n    bodeCtx.fillText('0 dB (Unity Gain)', padding.left + 10, padding.top + 25);\n}\n\nfunction resizeCanvas(canvas) {\n    const container = canvas.parentElement;\n    const rect = container.getBoundingClientRect();\n    \n    const dpr = window.devicePixelRatio || 1;\n    canvas.width = rect.width * dpr;\n    canvas.height = rect.height * dpr;\n    \n    const ctx = canvas.getContext('2d');\n    ctx.scale(dpr, dpr);\n    \n    canvas.style.width = rect.width + 'px';\n    canvas.style.height = rect.height + 'px';\n}\n\nfunction updateSimulation() {\n    updateDisplay();\n    drawStepResponse();\n    drawBodePlot();\n}\n\nkpSlider.addEventListener('input', (e) => {\n    Kp = parseFloat(e.target.value);\n    kpValue.textContent = Kp.toFixed(2);\n    updateSimulation();\n});\n\nkiSlider.addEventListener('input', (e) => {\n    Ki = parseFloat(e.target.value);\n    kiValue.textContent = Ki.toFixed(2) + ' 1/s';\n    updateSimulation();\n});\n\nkdSlider.addEventListener('input', (e) => {\n    Kd = parseFloat(e.target.value);\n    kdValue.textContent = Kd.toFixed(2) + ' s';\n    updateSimulation();\n});\n\ntauSlider.addEventListener('input', (e) => {\n    tau = parseFloat(e.target.value);\n    tauValue.textContent = tau.toFixed(2) + ' s';\n    updateSimulation();\n});\n\nwindow.addEventListener('resize', () => {\n    resizeCanvas(responseCanvas);\n    resizeCanvas(bodeCanvas);\n    updateSimulation();\n});\n\n// Initialize\nresizeCanvas(responseCanvas);\nresizeCanvas(bodeCanvas);\nupdateSimulation();"}}
{"input": {"input_text": "State-space step response magnitude for stable A matrix: xdot = A x + B u. Provide formal solution x(t) = exp(A t)x0 + integral exp(A(t-tau))B u d tau.", "simulation_name": " State Space Step", "domain": "Control", "description": "Linear state response form", "assumptions": ["Constant input"], "entities": [], "constants": [], "parameters": [{"name": "A_matrix", "symbol": "A", "unit": "matrix", "range": [-10, 10]}, {"name": "B_matrix", "symbol": "B", "unit": "matrix", "range": [-10, 10]}, {"name": "input", "symbol": "u", "unit": "vector", "range": [-10, 10]}, {"name": "initial_state", "symbol": "x0", "unit": "vector", "range": [-10, 10]}, {"name": "time", "symbol": "t", "unit": "s", "range": [0, 100]}], "equations": [{"description": "State solution", "expression": "x(t) = exp(A*t)*x0 + integral_0^t exp(A*(t-tau))*B*u dtau"}], "initial_conditions": {}, "outputs": ["x"], "simulation_controls": ["A", "B", "u", "x0", "t"], "constraints": ["Dimensions compatible"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S79 State Space Step Response</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1>State-Space Step Response Simulation</h1>\n            <p class=\"equation\">x(t) = exp(A·t)·x₀ + ∫₀ᵗ exp(A·(t-τ))·B·u dτ</p>\n        </header>\n\n        <div class=\"content\">\n            <div class=\"controls-panel\">\n                <h2>System Configuration</h2>\n                \n                <div class=\"matrix-section\">\n                    <h3>A Matrix (2×2)</h3>\n                    <div class=\"matrix-grid\">\n                        <input type=\"number\" id=\"a11\" value=\"-1\" step=\"0.1\">\n                        <input type=\"number\" id=\"a12\" value=\"0\" step=\"0.1\">\n                        <input type=\"number\" id=\"a21\" value=\"0\" step=\"0.1\">\n                        <input type=\"number\" id=\"a22\" value=\"-2\" step=\"0.1\">\n                    </div>\n                </div>\n\n                <div class=\"matrix-section\">\n                    <h3>B Matrix (2×1)</h3>\n                    <div class=\"vector-grid\">\n                        <input type=\"number\" id=\"b1\" value=\"1\" step=\"0.1\">\n                        <input type=\"number\" id=\"b2\" value=\"1\" step=\"0.1\">\n                    </div>\n                </div>\n\n                <div class=\"matrix-section\">\n                    <h3>Input u (scalar)</h3>\n                    <input type=\"number\" id=\"u\" value=\"1\" step=\"0.1\" class=\"full-width\">\n                </div>\n\n                <div class=\"matrix-section\">\n                    <h3>Initial State x₀ (2×1)</h3>\n                    <div class=\"vector-grid\">\n                        <input type=\"number\" id=\"x01\" value=\"0\" step=\"0.1\">\n                        <input type=\"number\" id=\"x02\" value=\"0\" step=\"0.1\">\n                    </div>\n                </div>\n\n                <div class=\"matrix-section\">\n                    <h3>Time Range</h3>\n                    <label>Max Time (s): <span id=\"timeValue\">10</span></label>\n                    <input type=\"range\" id=\"maxTime\" min=\"1\" max=\"50\" value=\"10\" step=\"0.5\">\n                </div>\n\n                <button id=\"simulateBtn\" class=\"simulate-btn\">Run Simulation</button>\n                <button id=\"resetBtn\" class=\"reset-btn\">Reset</button>\n\n                <div class=\"info-panel\">\n                    <h3>System Info</h3>\n                    <div id=\"eigenvalues\">Eigenvalues: Calculating...</div>\n                    <div id=\"stability\">Stability: Unknown</div>\n                </div>\n            </div>\n\n            <div class=\"visualization-panel\">\n                <div class=\"chart-container\">\n                    <h3>State Response x₁(t)</h3>\n                    <canvas id=\"chart1\"></canvas>\n                </div>\n                <div class=\"chart-container\">\n                    <h3>State Response x₂(t)</h3>\n                    <canvas id=\"chart2\"></canvas>\n                </div>\n                <div class=\"chart-container phase-plot\">\n                    <h3>Phase Portrait (x₁ vs x₂)</h3>\n                    <canvas id=\"phaseChart\"></canvas>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    min-height: 100vh;\n    padding: 20px;\n}\n\n.container {\n    max-width: 1400px;\n    margin: 0 auto;\n}\n\nheader {\n    text-align: center;\n    color: white;\n    margin-bottom: 30px;\n    animation: fadeInDown 0.6s ease-out;\n}\n\nheader h1 {\n    font-size: 2.5rem;\n    margin-bottom: 10px;\n    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);\n}\n\n.equation {\n    font-size: 1.2rem;\n    font-style: italic;\n    opacity: 0.95;\n    background: rgba(255,255,255,0.1);\n    padding: 10px 20px;\n    border-radius: 10px;\n    display: inline-block;\n}\n\n.content {\n    display: grid;\n    grid-template-columns: 350px 1fr;\n    gap: 20px;\n}\n\n.controls-panel {\n    background: white;\n    padding: 25px;\n    border-radius: 15px;\n    box-shadow: 0 10px 30px rgba(0,0,0,0.3);\n    animation: fadeInLeft 0.6s ease-out;\n    max-height: 90vh;\n    overflow-y: auto;\n}\n\n.controls-panel h2 {\n    color: #667eea;\n    margin-bottom: 20px;\n    font-size: 1.5rem;\n    border-bottom: 2px solid #667eea;\n    padding-bottom: 10px;\n}\n\n.matrix-section {\n    margin-bottom: 20px;\n}\n\n.matrix-section h3 {\n    color: #333;\n    margin-bottom: 10px;\n    font-size: 1rem;\n}\n\n.matrix-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 10px;\n}\n\n.vector-grid {\n    display: grid;\n    grid-template-columns: 1fr;\n    gap: 10px;\n}\n\ninput[type=\"number\"] {\n    padding: 10px;\n    border: 2px solid #ddd;\n    border-radius: 8px;\n    font-size: 1rem;\n    transition: all 0.3s ease;\n}\n\ninput[type=\"number\"]:focus {\n    outline: none;\n    border-color: #667eea;\n    box-shadow: 0 0 0 3px rgba(102,126,234,0.1);\n}\n\ninput[type=\"number\"].full-width {\n    width: 100%;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    margin-top: 10px;\n}\n\nlabel {\n    display: block;\n    color: #555;\n    font-weight: 500;\n    margin-bottom: 5px;\n}\n\n#timeValue {\n    color: #667eea;\n    font-weight: bold;\n}\n\n.simulate-btn, .reset-btn {\n    width: 100%;\n    padding: 15px;\n    border: none;\n    border-radius: 10px;\n    font-size: 1.1rem;\n    font-weight: bold;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    margin-bottom: 10px;\n}\n\n.simulate-btn {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n}\n\n.simulate-btn:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 5px 15px rgba(102,126,234,0.4);\n}\n\n.simulate-btn:active {\n    transform: translateY(0);\n}\n\n.reset-btn {\n    background: #e74c3c;\n    color: white;\n}\n\n.reset-btn:hover {\n    background: #c0392b;\n    transform: translateY(-2px);\n}\n\n.info-panel {\n    margin-top: 20px;\n    padding: 15px;\n    background: #f8f9fa;\n    border-radius: 10px;\n    border-left: 4px solid #667eea;\n}\n\n.info-panel h3 {\n    color: #667eea;\n    margin-bottom: 10px;\n}\n\n.info-panel div {\n    margin-bottom: 8px;\n    color: #555;\n    font-family: monospace;\n}\n\n.visualization-panel {\n    display: grid;\n    grid-template-columns: 1fr;\n    gap: 20px;\n    animation: fadeInRight 0.6s ease-out;\n}\n\n.chart-container {\n    background: white;\n    padding: 20px;\n    border-radius: 15px;\n    box-shadow: 0 10px 30px rgba(0,0,0,0.3);\n    animation: scaleIn 0.5s ease-out;\n}\n\n.chart-container h3 {\n    color: #667eea;\n    margin-bottom: 15px;\n    text-align: center;\n}\n\ncanvas {\n    width: 100% !important;\n    height: 250px !important;\n    display: block;\n}\n\n.phase-plot canvas {\n    height: 300px !important;\n}\n\n@keyframes fadeInDown {\n    from {\n        opacity: 0;\n        transform: translateY(-30px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n@keyframes fadeInLeft {\n    from {\n        opacity: 0;\n        transform: translateX(-30px);\n    }\n    to {\n        opacity: 1;\n        transform: translateX(0);\n    }\n}\n\n@keyframes fadeInRight {\n    from {\n        opacity: 0;\n        transform: translateX(30px);\n    }\n    to {\n        opacity: 1;\n        transform: translateX(0);\n    }\n}\n\n@keyframes scaleIn {\n    from {\n        opacity: 0;\n        transform: scale(0.95);\n    }\n    to {\n        opacity: 1;\n        transform: scale(1);\n    }\n}\n\n@media (max-width: 1024px) {\n    .content {\n        grid-template-columns: 1fr;\n    }\n    \n    .controls-panel {\n        max-height: none;\n    }\n}", "js": "// Matrix operations\nclass Matrix {\n    static multiply(A, B) {\n        const rowsA = A.length;\n        const colsA = A[0].length;\n        const colsB = B[0].length;\n        const result = Array(rowsA).fill(0).map(() => Array(colsB).fill(0));\n        \n        for (let i = 0; i < rowsA; i++) {\n            for (let j = 0; j < colsB; j++) {\n                for (let k = 0; k < colsA; k++) {\n                    result[i][j] += A[i][k] * B[k][j];\n                }\n            }\n        }\n        return result;\n    }\n\n    static add(A, B) {\n        return A.map((row, i) => row.map((val, j) => val + B[i][j]));\n    }\n\n    static scale(A, scalar) {\n        return A.map(row => row.map(val => val * scalar));\n    }\n\n    static identity(n) {\n        return Array(n).fill(0).map((_, i) => \n            Array(n).fill(0).map((_, j) => i === j ? 1 : 0)\n        );\n    }\n\n    static expm(A, t) {\n        // Matrix exponential using Taylor series\n        const n = A.length;\n        const maxTerms = 30;\n        let result = Matrix.identity(n);\n        let term = Matrix.identity(n);\n        \n        const At = Matrix.scale(A, t);\n        \n        for (let k = 1; k < maxTerms; k++) {\n            term = Matrix.multiply(term, At);\n            term = Matrix.scale(term, 1 / k);\n            result = Matrix.add(result, term);\n            \n            // Check convergence\n            const maxVal = Math.max(...term.flat().map(Math.abs));\n            if (maxVal < 1e-10) break;\n        }\n        \n        return result;\n    }\n\n    static eigenvalues2x2(A) {\n        // For 2x2 matrix: λ = (tr ± sqrt(tr² - 4*det)) / 2\n        const trace = A[0][0] + A[1][1];\n        const det = A[0][0] * A[1][1] - A[0][1] * A[1][0];\n        const discriminant = trace * trace - 4 * det;\n        \n        if (discriminant >= 0) {\n            const sqrtDisc = Math.sqrt(discriminant);\n            return [\n                (trace + sqrtDisc) / 2,\n                (trace - sqrtDisc) / 2\n            ];\n        } else {\n            const real = trace / 2;\n            const imag = Math.sqrt(-discriminant) / 2;\n            return [\n                { real, imag },\n                { real, imag: -imag }\n            ];\n        }\n    }\n}\n\n// Chart management\nclass ChartManager {\n    constructor(canvasId) {\n        this.canvas = document.getElementById(canvasId);\n        this.ctx = this.canvas.getContext('2d');\n        this.data = { time: [], values: [] };\n        this.animationProgress = 0;\n    }\n\n    setData(time, values) {\n        this.data = { time, values };\n        this.animationProgress = 0;\n    }\n\n    draw() {\n        const ctx = this.ctx;\n        const canvas = this.canvas;\n        const width = canvas.width;\n        const height = canvas.height;\n\n        ctx.clearRect(0, 0, width, height);\n\n        if (this.data.time.length === 0) return;\n\n        // Determine data range\n        const maxTime = Math.max(...this.data.time);\n        const maxVal = Math.max(...this.data.values, 0);\n        const minVal = Math.min(...this.data.values, 0);\n        const range = maxVal - minVal;\n        const padding = 50;\n\n        // Draw axes\n        ctx.strokeStyle = '#333';\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.moveTo(padding, padding);\n        ctx.lineTo(padding, height - padding);\n        ctx.lineTo(width - padding, height - padding);\n        ctx.stroke();\n\n        // Draw grid\n        ctx.strokeStyle = '#ddd';\n        ctx.lineWidth = 1;\n        for (let i = 0; i <= 5; i++) {\n            const y = padding + (height - 2 * padding) * i / 5;\n            ctx.beginPath();\n            ctx.moveTo(padding, y);\n            ctx.lineTo(width - padding, y);\n            ctx.stroke();\n\n            const value = maxVal - (range * i / 5);\n            ctx.fillStyle = '#666';\n            ctx.font = '12px monospace';\n            ctx.fillText(value.toFixed(2), 5, y + 4);\n        }\n\n        // Draw curve with animation\n        const visiblePoints = Math.floor(this.data.time.length * this.animationProgress);\n        \n        ctx.strokeStyle = '#667eea';\n        ctx.lineWidth = 3;\n        ctx.beginPath();\n\n        for (let i = 0; i < visiblePoints; i++) {\n            const x = padding + (width - 2 * padding) * this.data.time[i] / maxTime;\n            const y = height - padding - (height - 2 * padding) * (this.data.values[i] - minVal) / range;\n\n            if (i === 0) {\n                ctx.moveTo(x, y);\n            } else {\n                ctx.lineTo(x, y);\n            }\n        }\n        ctx.stroke();\n\n        // Draw current point\n        if (visiblePoints > 0) {\n            const i = visiblePoints - 1;\n            const x = padding + (width - 2 * padding) * this.data.time[i] / maxTime;\n            const y = height - padding - (height - 2 * padding) * (this.data.values[i] - minVal) / range;\n\n            ctx.fillStyle = '#764ba2';\n            ctx.beginPath();\n            ctx.arc(x, y, 5, 0, 2 * Math.PI);\n            ctx.fill();\n        }\n\n        // Animate\n        if (this.animationProgress < 1) {\n            this.animationProgress += 0.02;\n            requestAnimationFrame(() => this.draw());\n        }\n    }\n}\n\nclass PhaseChart {\n    constructor(canvasId) {\n        this.canvas = document.getElementById(canvasId);\n        this.ctx = this.canvas.getContext('2d');\n        this.data = { x1: [], x2: [] };\n        this.animationProgress = 0;\n    }\n\n    setData(x1, x2) {\n        this.data = { x1, x2 };\n        this.animationProgress = 0;\n    }\n\n    draw() {\n        const ctx = this.ctx;\n        const canvas = this.canvas;\n        const width = canvas.width;\n        const height = canvas.height;\n\n        ctx.clearRect(0, 0, width, height);\n\n        if (this.data.x1.length === 0) return;\n\n        const padding = 50;\n        const maxX1 = Math.max(...this.data.x1, 0);\n        const minX1 = Math.min(...this.data.x1, 0);\n        const maxX2 = Math.max(...this.data.x2, 0);\n        const minX2 = Math.min(...this.data.x2, 0);\n        const rangeX1 = maxX1 - minX1;\n        const rangeX2 = maxX2 - minX2;\n\n        // Draw axes\n        ctx.strokeStyle = '#333';\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.moveTo(padding, height - padding);\n        ctx.lineTo(width - padding, height - padding);\n        ctx.moveTo(padding, padding);\n        ctx.lineTo(padding, height - padding);\n        ctx.stroke();\n\n        // Draw grid\n        ctx.strokeStyle = '#ddd';\n        ctx.lineWidth = 1;\n        for (let i = 0; i <= 5; i++) {\n            const x = padding + (width - 2 * padding) * i / 5;\n            const y = padding + (height - 2 * padding) * i / 5;\n            \n            ctx.beginPath();\n            ctx.moveTo(x, padding);\n            ctx.lineTo(x, height - padding);\n            ctx.stroke();\n\n            ctx.beginPath();\n            ctx.moveTo(padding, y);\n            ctx.lineTo(width - padding, y);\n            ctx.stroke();\n        }\n\n        // Labels\n        ctx.fillStyle = '#666';\n        ctx.font = '14px sans-serif';\n        ctx.fillText('x₁', width - 30, height - padding + 20);\n        ctx.fillText('x₂', padding - 30, padding);\n\n        // Draw trajectory with animation\n        const visiblePoints = Math.floor(this.data.x1.length * this.animationProgress);\n        \n        ctx.strokeStyle = '#e74c3c';\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n\n        for (let i = 0; i < visiblePoints; i++) {\n            const x = padding + (width - 2 * padding) * (this.data.x1[i] - minX1) / rangeX1;\n            const y = height - padding - (height - 2 * padding) * (this.data.x2[i] - minX2) / rangeX2;\n\n            if (i === 0) {\n                ctx.moveTo(x, y);\n            } else {\n                ctx.lineTo(x, y);\n            }\n        }\n        ctx.stroke();\n\n        // Draw start and end points\n        if (visiblePoints > 0) {\n            // Start point\n            const x0 = padding + (width - 2 * padding) * (this.data.x1[0] - minX1) / rangeX1;\n            const y0 = height - padding - (height - 2 * padding) * (this.data.x2[0] - minX2) / rangeX2;\n            ctx.fillStyle = '#27ae60';\n            ctx.beginPath();\n            ctx.arc(x0, y0, 6, 0, 2 * Math.PI);\n            ctx.fill();\n\n            // Current point\n            const i = visiblePoints - 1;\n            const x = padding + (width - 2 * padding) * (this.data.x1[i] - minX1) / rangeX1;\n            const y = height - padding - (height - 2 * padding) * (this.data.x2[i] - minX2) / rangeX2;\n            ctx.fillStyle = '#764ba2';\n            ctx.beginPath();\n            ctx.arc(x, y, 6, 0, 2 * Math.PI);\n            ctx.fill();\n        }\n\n        // Animate\n        if (this.animationProgress < 1) {\n            this.animationProgress += 0.02;\n            requestAnimationFrame(() => this.draw());\n        }\n    }\n}\n\n// Initialize charts\nconst chart1 = new ChartManager('chart1');\nconst chart2 = new ChartManager('chart2');\nconst phaseChart = new PhaseChart('phaseChart');\n\n// Setup canvas sizes\nfunction setupCanvases() {\n    const canvases = document.querySelectorAll('canvas');\n    canvases.forEach(canvas => {\n        const rect = canvas.getBoundingClientRect();\n        canvas.width = rect.width;\n        canvas.height = rect.height;\n    });\n}\n\n// Simulation\nfunction simulate() {\n    // Get parameters\n    const A = [\n        [parseFloat(document.getElementById('a11').value), parseFloat(document.getElementById('a12').value)],\n        [parseFloat(document.getElementById('a21').value), parseFloat(document.getElementById('a22').value)]\n    ];\n    \n    const B = [\n        [parseFloat(document.getElementById('b1').value)],\n        [parseFloat(document.getElementById('b2').value)]\n    ];\n    \n    const u = parseFloat(document.getElementById('u').value);\n    const x0 = [\n        [parseFloat(document.getElementById('x01').value)],\n        [parseFloat(document.getElementById('x02').value)]\n    ];\n    \n    const maxTime = parseFloat(document.getElementById('maxTime').value);\n    const dt = 0.05;\n    const steps = Math.floor(maxTime / dt);\n\n    // Calculate eigenvalues and stability\n    const eigenvals = Matrix.eigenvalues2x2(A);\n    updateSystemInfo(eigenvals);\n\n    // Simulate\n    const time = [];\n    const x1_values = [];\n    const x2_values = [];\n\n    for (let i = 0; i <= steps; i++) {\n        const t = i * dt;\n        time.push(t);\n\n        // x(t) = exp(A*t)*x0 + integral exp(A*(t-tau))*B*u dtau\n        const expAt = Matrix.expm(A, t);\n        const term1 = Matrix.multiply(expAt, x0);\n\n        // Numerical integration for the second term\n        let term2 = [[0], [0]];\n        const integSteps = Math.floor(t / dt);\n        for (let j = 0; j < integSteps; j++) {\n            const tau = j * dt;\n            const expATerm = Matrix.expm(A, t - tau);\n            const integrand = Matrix.multiply(expATerm, B);\n            const contribution = Matrix.scale(integrand, u * dt);\n            term2 = Matrix.add(term2, contribution);\n        }\n\n        const x = Matrix.add(term1, term2);\n        x1_values.push(x[0][0]);\n        x2_values.push(x[1][0]);\n    }\n\n    // Update charts\n    chart1.setData(time, x1_values);\n    chart2.setData(time, x2_values);\n    phaseChart.setData(x1_values, x2_values);\n\n    chart1.draw();\n    chart2.draw();\n    phaseChart.draw();\n}\n\nfunction updateSystemInfo(eigenvals) {\n    let eigenStr = 'Eigenvalues: ';\n    let stable = true;\n\n    eigenvals.forEach((ev, i) => {\n        if (typeof ev === 'object') {\n            eigenStr += `${ev.real.toFixed(3)} ${ev.imag >= 0 ? '+' : ''}${ev.imag.toFixed(3)}i`;\n            if (ev.real >= 0) stable = false;\n        } else {\n            eigenStr += ev.toFixed(3);\n            if (ev >= 0) stable = false;\n        }\n        if (i < eigenvals.length - 1) eigenStr += ', ';\n    });\n\n    document.getElementById('eigenvalues').textContent = eigenStr;\n    document.getElementById('stability').textContent = `Stability: ${stable ? 'STABLE' : 'UNSTABLE'}`;\n    document.getElementById('stability').style.color = stable ? '#27ae60' : '#e74c3c';\n}\n\nfunction reset() {\n    document.getElementById('a11').value = '-1';\n    document.getElementById('a12').value = '0';\n    document.getElementById('a21').value = '0';\n    document.getElementById('a22').value = '-2';\n    document.getElementById('b1').value = '1';\n    document.getElementById('b2').value = '1';\n    document.getElementById('u').value = '1';\n    document.getElementById('x01').value = '0';\n    document.getElementById('x02').value = '0';\n    document.getElementById('maxTime').value = '10';\n    document.getElementById('timeValue').textContent = '10';\n}\n\n// Event listeners\ndocument.getElementById('simulateBtn').addEventListener('click', simulate);\ndocument.getElementById('resetBtn').addEventListener('click', reset);\ndocument.getElementById('maxTime').addEventListener('input', (e) => {\n    document.getElementById('timeValue').textContent = e.target.value;\n});\n\n// Initialize\nwindow.addEventListener('load', () => {\n    setupCanvases();\n    simulate();\n});\n\nwindow.addEventListener('resize', () => {\n    setupCanvases();\n    // Redraw without animation\n    chart1.animationProgress = 1;\n    chart2.animationProgress = 1;\n    phaseChart.animationProgress = 1;\n    chart1.draw();\n    chart2.draw();\n    phaseChart.draw();\n});"}}
{"input": {"input_text": "M/M/c queue with arrival rate lambda, service mu, servers c. Utilization rho = lambda/(c*mu). Lq approximation Erlang C: Lq = (Pwait*rho)/(1-rho) where Pwait from Erlang C.", "simulation_name": " MMC Queue", "domain": "Operations Research", "description": "Multi-server M/M/c metrics", "assumptions": ["Poisson arrivals", "Exponential service"], "entities": [], "constants": [], "parameters": [{"name": "arrival_rate", "symbol": "lambda", "unit": "1/time", "range": [0.01, 100]}, {"name": "service_rate", "symbol": "mu", "unit": "1/time", "range": [0.01, 100]}, {"name": "servers", "symbol": "c", "unit": "count", "range": [1, 50]}], "equations": [{"description": "Utilization", "expression": "rho = lambda/(c*mu)"}, {"description": "ErlangC numerator", "expression": "EC_num = ( ( (lambda/mu)^c )/(c!*(1 - rho)) )"}, {"description": "ErlangC denom", "expression": "EC_den = sum_{k=0}^{c-1} (lambda/mu)^k/k! + EC_num"}, {"description": "Pwait", "expression": "Pwait = EC_num/EC_den"}, {"description": "Queue length", "condition": "rho<1", "expression": "Lq = (Pwait*rho)/(1 - rho)"}], "initial_conditions": {}, "outputs": ["rho", "Pwait", "Lq"], "simulation_controls": ["lambda", "mu", "c"], "constraints": ["rho<1", "lambda>=0", "mu>0", "c>=1"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S80 M/M/c Queue Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1>M/M/c Queue Analyzer</h1>\n            <p class=\"subtitle\">Multi-Server Queueing System with Erlang C</p>\n        </header>\n\n        <div class=\"main-content\">\n            <div class=\"controls-section\">\n                <div class=\"control-card\">\n                    <h2>System Parameters</h2>\n                    \n                    <div class=\"parameter-group\">\n                        <label>\n                            <span class=\"param-label\">Arrival Rate (λ)</span>\n                            <span class=\"param-value\" id=\"lambdaValue\">5.0</span>\n                            <span class=\"param-unit\">customers/hour</span>\n                        </label>\n                        <input type=\"range\" id=\"lambda\" min=\"0.1\" max=\"50\" step=\"0.1\" value=\"5\">\n                    </div>\n\n                    <div class=\"parameter-group\">\n                        <label>\n                            <span class=\"param-label\">Service Rate (μ)</span>\n                            <span class=\"param-value\" id=\"muValue\">2.0</span>\n                            <span class=\"param-unit\">customers/hour/server</span>\n                        </label>\n                        <input type=\"range\" id=\"mu\" min=\"0.1\" max=\"50\" step=\"0.1\" value=\"2\">\n                    </div>\n\n                    <div class=\"parameter-group\">\n                        <label>\n                            <span class=\"param-label\">Number of Servers (c)</span>\n                            <span class=\"param-value\" id=\"cValue\">3</span>\n                            <span class=\"param-unit\">servers</span>\n                        </label>\n                        <input type=\"range\" id=\"c\" min=\"1\" max=\"20\" step=\"1\" value=\"3\">\n                    </div>\n\n                    <button id=\"calculateBtn\" class=\"calculate-btn\">Calculate Metrics</button>\n                    <button id=\"resetBtn\" class=\"reset-btn\">Reset</button>\n                </div>\n\n                <div class=\"metrics-card\">\n                    <h2>Performance Metrics</h2>\n                    <div class=\"metric-item\">\n                        <span class=\"metric-label\">Utilization (ρ)</span>\n                        <span class=\"metric-value\" id=\"rhoValue\">-</span>\n                    </div>\n                    <div class=\"metric-item\">\n                        <span class=\"metric-label\">P(wait) - Erlang C</span>\n                        <span class=\"metric-value\" id=\"pwaitValue\">-</span>\n                    </div>\n                    <div class=\"metric-item\">\n                        <span class=\"metric-label\">Queue Length (L<sub>q</sub>)</span>\n                        <span class=\"metric-value\" id=\"lqValue\">-</span>\n                    </div>\n                    <div class=\"metric-item\">\n                        <span class=\"metric-label\">Wait Time (W<sub>q</sub>)</span>\n                        <span class=\"metric-value\" id=\"wqValue\">-</span>\n                    </div>\n                    <div class=\"metric-item\">\n                        <span class=\"metric-label\">System Time (W)</span>\n                        <span class=\"metric-value\" id=\"wValue\">-</span>\n                    </div>\n                    <div id=\"stabilityWarning\" class=\"warning hidden\">\n                        ⚠️ System unstable: ρ ≥ 1\n                    </div>\n                </div>\n\n                <div class=\"formula-card\">\n                    <h2>Key Formulas</h2>\n                    <div class=\"formula\">ρ = λ / (c · μ)</div>\n                    <div class=\"formula\">P<sub>wait</sub> = Erlang C Formula</div>\n                    <div class=\"formula\">L<sub>q</sub> = (P<sub>wait</sub> · ρ) / (1 - ρ)</div>\n                    <div class=\"formula\">W<sub>q</sub> = L<sub>q</sub> / λ</div>\n                </div>\n            </div>\n\n            <div class=\"visualization-section\">\n                <div class=\"viz-card\">\n                    <h3>Server Utilization</h3>\n                    <canvas id=\"utilizationChart\"></canvas>\n                </div>\n\n                <div class=\"viz-card\">\n                    <h3>Queue Visualization</h3>\n                    <div id=\"queueViz\" class=\"queue-container\"></div>\n                </div>\n\n                <div class=\"viz-card\">\n                    <h3>Metrics vs Number of Servers</h3>\n                    <canvas id=\"metricsChart\"></canvas>\n                </div>\n\n                <div class=\"viz-card\">\n                    <h3>Utilization Heatmap (λ vs c)</h3>\n                    <canvas id=\"heatmapChart\"></canvas>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);\n    min-height: 100vh;\n    padding: 20px;\n    color: #333;\n}\n\n.container {\n    max-width: 1600px;\n    margin: 0 auto;\n}\n\nheader {\n    text-align: center;\n    color: white;\n    margin-bottom: 30px;\n    animation: fadeInDown 0.6s ease-out;\n}\n\nheader h1 {\n    font-size: 3rem;\n    margin-bottom: 10px;\n    text-shadow: 2px 2px 8px rgba(0,0,0,0.3);\n    font-weight: 700;\n}\n\n.subtitle {\n    font-size: 1.3rem;\n    opacity: 0.95;\n    font-weight: 300;\n}\n\n.main-content {\n    display: grid;\n    grid-template-columns: 400px 1fr;\n    gap: 25px;\n}\n\n.controls-section {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.control-card, .metrics-card, .formula-card {\n    background: white;\n    border-radius: 15px;\n    padding: 25px;\n    box-shadow: 0 10px 40px rgba(0,0,0,0.3);\n    animation: slideInLeft 0.6s ease-out;\n}\n\n.control-card h2, .metrics-card h2, .formula-card h2 {\n    color: #1e3c72;\n    margin-bottom: 20px;\n    font-size: 1.4rem;\n    border-bottom: 3px solid #7e22ce;\n    padding-bottom: 10px;\n}\n\n.parameter-group {\n    margin-bottom: 25px;\n}\n\n.parameter-group label {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 10px;\n    font-size: 0.95rem;\n}\n\n.param-label {\n    font-weight: 600;\n    color: #555;\n}\n\n.param-value {\n    font-weight: 700;\n    color: #7e22ce;\n    font-size: 1.1rem;\n}\n\n.param-unit {\n    font-size: 0.85rem;\n    color: #888;\n    font-style: italic;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    height: 8px;\n    border-radius: 5px;\n    background: linear-gradient(to right, #1e3c72, #7e22ce);\n    outline: none;\n    -webkit-appearance: none;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: white;\n    cursor: pointer;\n    box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n    transition: transform 0.2s;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb:hover {\n    transform: scale(1.2);\n}\n\ninput[type=\"range\"]::-moz-range-thumb {\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: white;\n    cursor: pointer;\n    box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n    border: none;\n}\n\n.calculate-btn, .reset-btn {\n    width: 100%;\n    padding: 15px;\n    border: none;\n    border-radius: 10px;\n    font-size: 1.1rem;\n    font-weight: 700;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    margin-bottom: 10px;\n    text-transform: uppercase;\n    letter-spacing: 1px;\n}\n\n.calculate-btn {\n    background: linear-gradient(135deg, #1e3c72, #7e22ce);\n    color: white;\n}\n\n.calculate-btn:hover {\n    transform: translateY(-3px);\n    box-shadow: 0 8px 20px rgba(126,34,206,0.4);\n}\n\n.calculate-btn:active {\n    transform: translateY(0);\n}\n\n.reset-btn {\n    background: #e74c3c;\n    color: white;\n}\n\n.reset-btn:hover {\n    background: #c0392b;\n    transform: translateY(-3px);\n}\n\n.metric-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 15px;\n    background: #f8f9fa;\n    border-radius: 8px;\n    margin-bottom: 12px;\n    border-left: 4px solid #7e22ce;\n    transition: transform 0.2s;\n}\n\n.metric-item:hover {\n    transform: translateX(5px);\n}\n\n.metric-label {\n    font-weight: 600;\n    color: #555;\n}\n\n.metric-value {\n    font-weight: 700;\n    font-size: 1.3rem;\n    color: #1e3c72;\n    font-family: monospace;\n}\n\n.warning {\n    background: #fff3cd;\n    color: #856404;\n    padding: 15px;\n    border-radius: 8px;\n    border-left: 4px solid #ffc107;\n    margin-top: 15px;\n    font-weight: 600;\n    animation: pulse 2s infinite;\n}\n\n.warning.hidden {\n    display: none;\n}\n\n.formula-card {\n    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);\n}\n\n.formula {\n    background: white;\n    padding: 12px;\n    border-radius: 6px;\n    margin-bottom: 10px;\n    font-family: 'Courier New', monospace;\n    font-size: 0.95rem;\n    color: #1e3c72;\n    border-left: 3px solid #7e22ce;\n}\n\n.visualization-section {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 20px;\n}\n\n.viz-card {\n    background: white;\n    border-radius: 15px;\n    padding: 20px;\n    box-shadow: 0 10px 40px rgba(0,0,0,0.3);\n    animation: fadeInUp 0.6s ease-out;\n}\n\n.viz-card h3 {\n    color: #1e3c72;\n    margin-bottom: 15px;\n    font-size: 1.2rem;\n    text-align: center;\n}\n\ncanvas {\n    width: 100% !important;\n    height: 250px !important;\n    display: block;\n}\n\n.queue-container {\n    min-height: 250px;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 20px;\n}\n\n.servers-row {\n    display: flex;\n    gap: 15px;\n    flex-wrap: wrap;\n    justify-content: center;\n}\n\n.server {\n    width: 60px;\n    height: 60px;\n    border-radius: 10px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-weight: 700;\n    color: white;\n    font-size: 1.2rem;\n    transition: all 0.3s ease;\n    animation: serverPulse 2s infinite;\n}\n\n.server.busy {\n    background: linear-gradient(135deg, #e74c3c, #c0392b);\n}\n\n.server.idle {\n    background: linear-gradient(135deg, #27ae60, #229954);\n}\n\n.queue-line {\n    display: flex;\n    gap: 10px;\n    flex-wrap: wrap;\n    justify-content: center;\n    max-width: 100%;\n}\n\n.customer {\n    width: 40px;\n    height: 40px;\n    border-radius: 50%;\n    background: linear-gradient(135deg, #3498db, #2980b9);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    font-weight: 600;\n    font-size: 0.9rem;\n    animation: customerBounce 1s infinite;\n}\n\n.queue-label {\n    font-weight: 600;\n    color: #555;\n    margin-bottom: 10px;\n}\n\n@keyframes fadeInDown {\n    from {\n        opacity: 0;\n        transform: translateY(-30px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n@keyframes slideInLeft {\n    from {\n        opacity: 0;\n        transform: translateX(-30px);\n    }\n    to {\n        opacity: 1;\n        transform: translateX(0);\n    }\n}\n\n@keyframes fadeInUp {\n    from {\n        opacity: 0;\n        transform: translateY(30px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n@keyframes pulse {\n    0%, 100% { opacity: 1; }\n    50% { opacity: 0.8; }\n}\n\n@keyframes serverPulse {\n    0%, 100% { transform: scale(1); }\n    50% { transform: scale(1.05); }\n}\n\n@keyframes customerBounce {\n    0%, 100% { transform: translateY(0); }\n    50% { transform: translateY(-5px); }\n}\n\n@media (max-width: 1200px) {\n    .main-content {\n        grid-template-columns: 1fr;\n    }\n    \n    .visualization-section {\n        grid-template-columns: 1fr;\n    }\n}\n\n@media (max-width: 768px) {\n    header h1 {\n        font-size: 2rem;\n    }\n    \n    .subtitle {\n        font-size: 1rem;\n    }\n}", "js": "// Utility functions\nfunction factorial(n) {\n    if (n <= 1) return 1;\n    let result = 1;\n    for (let i = 2; i <= n; i++) {\n        result *= i;\n    }\n    return result;\n}\n\nfunction power(base, exp) {\n    return Math.pow(base, exp);\n}\n\n// M/M/c Queue calculations\nclass MMCQueue {\n    constructor(lambda, mu, c) {\n        this.lambda = lambda;\n        this.mu = mu;\n        this.c = c;\n    }\n\n    calculateUtilization() {\n        return this.lambda / (this.c * this.mu);\n    }\n\n    calculateErlangC() {\n        const rho = this.calculateUtilization();\n        if (rho >= 1) return null;\n\n        const a = this.lambda / this.mu;\n        \n        // Calculate numerator: (a^c / c!) / (1 - rho)\n        let numerator = power(a, this.c) / factorial(this.c) / (1 - rho);\n        \n        // Calculate denominator: sum of (a^k / k!) for k=0 to c-1, plus numerator\n        let denominator = 0;\n        for (let k = 0; k < this.c; k++) {\n            denominator += power(a, k) / factorial(k);\n        }\n        denominator += numerator;\n        \n        const pwait = numerator / denominator;\n        return pwait;\n    }\n\n    calculateQueueLength() {\n        const rho = this.calculateUtilization();\n        if (rho >= 1) return Infinity;\n\n        const pwait = this.calculateErlangC();\n        if (pwait === null) return Infinity;\n\n        const lq = (pwait * rho) / (1 - rho);\n        return lq;\n    }\n\n    calculateWaitTime() {\n        const lq = this.calculateQueueLength();\n        if (!isFinite(lq)) return Infinity;\n        return lq / this.lambda;\n    }\n\n    calculateSystemTime() {\n        const wq = this.calculateWaitTime();\n        if (!isFinite(wq)) return Infinity;\n        return wq + 1 / this.mu;\n    }\n\n    getAllMetrics() {\n        const rho = this.calculateUtilization();\n        const pwait = this.calculateErlangC();\n        const lq = this.calculateQueueLength();\n        const wq = this.calculateWaitTime();\n        const w = this.calculateSystemTime();\n\n        return {\n            rho,\n            pwait,\n            lq,\n            wq,\n            w,\n            stable: rho < 1\n        };\n    }\n}\n\n// Chart management\nclass ChartCanvas {\n    constructor(canvasId) {\n        this.canvas = document.getElementById(canvasId);\n        this.ctx = this.canvas.getContext('2d');\n        this.setupCanvas();\n    }\n\n    setupCanvas() {\n        const rect = this.canvas.getBoundingClientRect();\n        this.canvas.width = rect.width;\n        this.canvas.height = rect.height;\n    }\n\n    clear() {\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n}\n\nclass UtilizationChart extends ChartCanvas {\n    draw(rho, c) {\n        this.clear();\n        const ctx = this.ctx;\n        const width = this.canvas.width;\n        const height = this.canvas.height;\n\n        const centerX = width / 2;\n        const centerY = height / 2;\n        const radius = Math.min(width, height) / 2 - 30;\n\n        // Draw background circle\n        ctx.beginPath();\n        ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);\n        ctx.fillStyle = '#ecf0f1';\n        ctx.fill();\n        ctx.strokeStyle = '#bdc3c7';\n        ctx.lineWidth = 3;\n        ctx.stroke();\n\n        // Draw utilization arc\n        const utilizationAngle = Math.min(rho, 1) * 2 * Math.PI;\n        ctx.beginPath();\n        ctx.arc(centerX, centerY, radius, -Math.PI / 2, -Math.PI / 2 + utilizationAngle);\n        ctx.lineTo(centerX, centerY);\n        ctx.closePath();\n        \n        const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius);\n        if (rho < 0.7) {\n            gradient.addColorStop(0, '#27ae60');\n            gradient.addColorStop(1, '#229954');\n        } else if (rho < 0.9) {\n            gradient.addColorStop(0, '#f39c12');\n            gradient.addColorStop(1, '#e67e22');\n        } else {\n            gradient.addColorStop(0, '#e74c3c');\n            gradient.addColorStop(1, '#c0392b');\n        }\n        ctx.fillStyle = gradient;\n        ctx.fill();\n\n        // Draw percentage text\n        ctx.fillStyle = '#2c3e50';\n        ctx.font = 'bold 36px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'middle';\n        ctx.fillText(`${(rho * 100).toFixed(1)}%`, centerX, centerY - 10);\n\n        ctx.font = '16px sans-serif';\n        ctx.fillText(`${c} server${c > 1 ? 's' : ''}`, centerX, centerY + 25);\n\n        // Draw threshold line at 100%\n        if (rho >= 1) {\n            ctx.strokeStyle = '#e74c3c';\n            ctx.lineWidth = 4;\n            ctx.beginPath();\n            ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);\n            ctx.stroke();\n        }\n    }\n}\n\nclass MetricsChart extends ChartCanvas {\n    draw(lambda, mu) {\n        this.clear();\n        const ctx = this.ctx;\n        const width = this.canvas.width;\n        const height = this.canvas.height;\n        const padding = 60;\n        const rightPadding = 40;\n\n        // Calculate metrics for different server counts\n        const minServers = 1;\n        const maxServers = 15;\n        const serverCounts = [];\n        const lqValues = [];\n\n        for (let c = minServers; c <= maxServers; c++) {\n            const queue = new MMCQueue(lambda, mu, c);\n            const metrics = queue.getAllMetrics();\n            serverCounts.push(c);\n            lqValues.push(metrics.stable ? metrics.lq : null);\n        }\n\n        // Find max Lq for scaling\n        const validLq = lqValues.filter(v => v !== null && isFinite(v));\n        const maxLq = validLq.length > 0 ? Math.max(...validLq, 1) : 10;\n        const niceMaxLq = Math.ceil(maxLq / 5) * 5; // Round up to nice number\n\n        // Draw grid and Y-axis labels\n        ctx.strokeStyle = '#e0e0e0';\n        ctx.lineWidth = 1;\n        ctx.fillStyle = '#666';\n        ctx.font = '12px sans-serif';\n        ctx.textAlign = 'right';\n        ctx.textBaseline = 'middle';\n\n        for (let i = 0; i <= 5; i++) {\n            const y = padding + (height - padding - 40) * (1 - i / 5);\n            const value = (niceMaxLq * i / 5).toFixed(1);\n            \n            // Grid line\n            ctx.beginPath();\n            ctx.moveTo(padding, y);\n            ctx.lineTo(width - rightPadding, y);\n            ctx.stroke();\n            \n            // Y-axis label\n            ctx.fillText(value, padding - 10, y);\n            \n            // Y-axis tick\n            ctx.strokeStyle = '#333';\n            ctx.lineWidth = 2;\n            ctx.beginPath();\n            ctx.moveTo(padding - 5, y);\n            ctx.lineTo(padding, y);\n            ctx.stroke();\n            ctx.strokeStyle = '#e0e0e0';\n            ctx.lineWidth = 1;\n        }\n\n        // Draw X-axis grid and labels\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'top';\n        \n        for (let c = minServers; c <= maxServers; c++) {\n            const x = padding + (width - padding - rightPadding) * (c - minServers) / (maxServers - minServers);\n            \n            // Grid line\n            ctx.strokeStyle = '#e0e0e0';\n            ctx.lineWidth = 1;\n            ctx.beginPath();\n            ctx.moveTo(x, padding);\n            ctx.lineTo(x, height - 40);\n            ctx.stroke();\n            \n            // X-axis label (show every server count)\n            ctx.fillStyle = '#666';\n            ctx.font = '11px sans-serif';\n            ctx.fillText(c.toString(), x, height - 35);\n            \n            // X-axis tick\n            ctx.strokeStyle = '#333';\n            ctx.lineWidth = 2;\n            ctx.beginPath();\n            ctx.moveTo(x, height - 40);\n            ctx.lineTo(x, height - 35);\n            ctx.stroke();\n        }\n\n        // Draw axes (after grid so they're on top)\n        ctx.strokeStyle = '#333';\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.moveTo(padding, padding);\n        ctx.lineTo(padding, height - 40);\n        ctx.lineTo(width - rightPadding, height - 40);\n        ctx.stroke();\n\n        // Draw Lq line and points\n        ctx.strokeStyle = '#3498db';\n        ctx.lineWidth = 3;\n        ctx.beginPath();\n        let firstPoint = true;\n        \n        for (let i = 0; i < serverCounts.length; i++) {\n            const c = serverCounts[i];\n            if (lqValues[i] !== null && isFinite(lqValues[i])) {\n                const x = padding + (width - padding - rightPadding) * (c - minServers) / (maxServers - minServers);\n                const y = height - 40 - (height - padding - 40) * Math.min(lqValues[i] / niceMaxLq, 1);\n                \n                if (firstPoint) {\n                    ctx.moveTo(x, y);\n                    firstPoint = false;\n                } else {\n                    ctx.lineTo(x, y);\n                }\n            }\n        }\n        ctx.stroke();\n\n        // Draw point markers (separate loop to ensure they're on top)\n        for (let i = 0; i < serverCounts.length; i++) {\n            const c = serverCounts[i];\n            if (lqValues[i] !== null && isFinite(lqValues[i])) {\n                const x = padding + (width - padding - rightPadding) * (c - minServers) / (maxServers - minServers);\n                const y = height - 40 - (height - padding - 40) * Math.min(lqValues[i] / niceMaxLq, 1);\n                \n                ctx.fillStyle = '#3498db';\n                ctx.beginPath();\n                ctx.arc(x, y, 5, 0, 2 * Math.PI);\n                ctx.fill();\n                \n                // White border for visibility\n                ctx.strokeStyle = 'white';\n                ctx.lineWidth = 2;\n                ctx.stroke();\n            }\n        }\n\n        // Axis labels\n        ctx.fillStyle = '#333';\n        ctx.font = 'bold 14px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'bottom';\n        ctx.fillText('Number of Servers (c)', width / 2, height - 5);\n        \n        ctx.save();\n        ctx.translate(15, height / 2);\n        ctx.rotate(-Math.PI / 2);\n        ctx.textBaseline = 'top';\n        ctx.fillText('Average Queue Length (Lq)', 0, 0);\n        ctx.restore();\n    }\n}\n\nclass HeatmapChart extends ChartCanvas {\n    draw(mu) {\n        this.clear();\n        const ctx = this.ctx;\n        const width = this.canvas.width;\n        const height = this.canvas.height;\n        const padding = 60;\n        const legendWidth = 25;\n        const legendPadding = 10;\n\n        const lambdaMin = 1;\n        const lambdaMax = 20;\n        const cMin = 1;\n        const cMax = 10;\n        const gridSize = 20;\n\n        const cellWidth = (width - 2 * padding - legendWidth - legendPadding) / gridSize;\n        const cellHeight = (height - 2 * padding) / gridSize;\n\n        // Draw heatmap\n        for (let i = 0; i < gridSize; i++) {\n            for (let j = 0; j < gridSize; j++) {\n                const lambda = lambdaMin + (lambdaMax - lambdaMin) * i / (gridSize - 1);\n                const c = Math.round(cMin + (cMax - cMin) * j / (gridSize - 1));\n                \n                const queue = new MMCQueue(lambda, mu, c);\n                const rho = queue.calculateUtilization();\n\n                let color;\n                if (rho >= 1) {\n                    color = '#2c3e50';\n                } else if (rho >= 0.9) {\n                    color = `rgb(231, 76, 60)`;\n                } else if (rho >= 0.7) {\n                    color = '#f39c12';\n                } else {\n                    const t = rho / 0.7;\n                    color = `rgb(${Math.floor(39 + (243 - 39) * t)}, ${Math.floor(174 + (174 - 174) * t)}, ${Math.floor(96 + (219 - 96) * t)})`;\n                }\n\n                ctx.fillStyle = color;\n                ctx.fillRect(\n                    padding + i * cellWidth,\n                    height - padding - (j + 1) * cellHeight,\n                    cellWidth + 1,\n                    cellHeight + 1\n                );\n            }\n        }\n\n        // Draw axes\n        ctx.strokeStyle = '#333';\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.moveTo(padding, height - padding);\n        ctx.lineTo(width - padding - legendWidth - legendPadding, height - padding);\n        ctx.moveTo(padding, height - padding);\n        ctx.lineTo(padding, padding);\n        ctx.stroke();\n\n        // X-axis labels and ticks\n        ctx.fillStyle = '#333';\n        ctx.font = '11px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'top';\n        \n        for (let i = 0; i <= 4; i++) {\n            const lambda = lambdaMin + (lambdaMax - lambdaMin) * i / 4;\n            const x = padding + (width - 2 * padding - legendWidth - legendPadding) * i / 4;\n            \n            ctx.fillText(lambda.toFixed(0), x, height - padding + 5);\n            \n            ctx.strokeStyle = '#333';\n            ctx.lineWidth = 2;\n            ctx.beginPath();\n            ctx.moveTo(x, height - padding);\n            ctx.lineTo(x, height - padding + 5);\n            ctx.stroke();\n        }\n\n        // Y-axis labels and ticks\n        ctx.textAlign = 'right';\n        ctx.textBaseline = 'middle';\n        \n        for (let i = 0; i <= 4; i++) {\n            const c = Math.round(cMin + (cMax - cMin) * i / 4);\n            const y = height - padding - (height - 2 * padding) * i / 4;\n            \n            ctx.fillText(c.toString(), padding - 8, y);\n            \n            ctx.strokeStyle = '#333';\n            ctx.lineWidth = 2;\n            ctx.beginPath();\n            ctx.moveTo(padding - 5, y);\n            ctx.lineTo(padding, y);\n            ctx.stroke();\n        }\n\n        // Axis titles\n        ctx.font = 'bold 13px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.fillText('Arrival Rate (λ)', width / 2 - legendWidth / 2, height - 20);\n        \n        ctx.save();\n        ctx.translate(20, height / 2);\n        ctx.rotate(-Math.PI / 2);\n        ctx.fillText('Servers (c)', 0, 0);\n        ctx.restore();\n\n        // Color legend\n        const legendHeight = height - 2 * padding;\n        const legendX = width - padding - legendWidth;\n        const legendY = padding;\n\n        for (let i = 0; i < 100; i++) {\n            const rho = 1 - (i / 100);\n            let color;\n            if (rho >= 0.9) {\n                color = `rgb(231, 76, 60)`;\n            } else if (rho >= 0.7) {\n                color = '#f39c12';\n            } else {\n                const t = rho / 0.7;\n                color = `rgb(${Math.floor(39 + (243 - 39) * t)}, 174, ${Math.floor(96 + (219 - 96) * t)})`;\n            }\n            ctx.fillStyle = color;\n            ctx.fillRect(legendX, legendY + i * legendHeight / 100, legendWidth, legendHeight / 100 + 1);\n        }\n\n        ctx.strokeStyle = '#333';\n        ctx.lineWidth = 2;\n        ctx.strokeRect(legendX, legendY, legendWidth, legendHeight);\n        \n        // Legend labels\n        ctx.fillStyle = '#333';\n        ctx.font = '11px sans-serif';\n        ctx.textAlign = 'left';\n        ctx.textBaseline = 'middle';\n        ctx.fillText('1.0', legendX + legendWidth + 5, legendY);\n        ctx.fillText('0.7', legendX + legendWidth + 5, legendY + legendHeight * 0.3);\n        ctx.fillText('0.0', legendX + legendWidth + 5, legendY + legendHeight);\n        \n        ctx.textAlign = 'center';\n        ctx.font = 'bold 11px sans-serif';\n        ctx.save();\n        ctx.translate(legendX + legendWidth / 2, padding - 15);\n        ctx.fillText('ρ', 0, 0);\n        ctx.restore();\n    }\n}\n\n// Queue visualization\nfunction drawQueueVisualization(lambda, mu, c) {\n    const container = document.getElementById('queueViz');\n    container.innerHTML = '';\n\n    const queue = new MMCQueue(lambda, mu, c);\n    const metrics = queue.getAllMetrics();\n\n    // Create servers row\n    const serversLabel = document.createElement('div');\n    serversLabel.className = 'queue-label';\n    serversLabel.textContent = 'Servers:';\n    container.appendChild(serversLabel);\n\n    const serversRow = document.createElement('div');\n    serversRow.className = 'servers-row';\n    \n    const busyServers = Math.min(Math.round(metrics.rho * c), c);\n    for (let i = 0; i < c; i++) {\n        const server = document.createElement('div');\n        server.className = i < busyServers ? 'server busy' : 'server idle';\n        server.textContent = i < busyServers ? 'B' : 'I';\n        serversRow.appendChild(server);\n    }\n    container.appendChild(serversRow);\n\n    // Create queue line\n    const queueLabel = document.createElement('div');\n    queueLabel.className = 'queue-label';\n    queueLabel.style.marginTop = '20px';\n    queueLabel.textContent = `Queue (L_q ≈ ${metrics.lq.toFixed(2)}):`;\n    container.appendChild(queueLabel);\n\n    const queueLine = document.createElement('div');\n    queueLine.className = 'queue-line';\n    \n    const customersInQueue = Math.round(metrics.lq);\n    const maxDisplay = 20;\n    for (let i = 0; i < Math.min(customersInQueue, maxDisplay); i++) {\n        const customer = document.createElement('div');\n        customer.className = 'customer';\n        customer.textContent = 'C';\n        queueLine.appendChild(customer);\n    }\n    \n    if (customersInQueue > maxDisplay) {\n        const more = document.createElement('div');\n        more.className = 'customer';\n        more.textContent = '...';\n        more.style.fontSize = '1.5rem';\n        queueLine.appendChild(more);\n    }\n    \n    container.appendChild(queueLine);\n}\n\n// Global state\nlet utilizationChart, metricsChart, heatmapChart;\n\nfunction updateDisplay() {\n    const lambda = parseFloat(document.getElementById('lambda').value);\n    const mu = parseFloat(document.getElementById('mu').value);\n    const c = parseInt(document.getElementById('c').value);\n\n    document.getElementById('lambdaValue').textContent = lambda.toFixed(1);\n    document.getElementById('muValue').textContent = mu.toFixed(1);\n    document.getElementById('cValue').textContent = c;\n}\n\nfunction calculate() {\n    const lambda = parseFloat(document.getElementById('lambda').value);\n    const mu = parseFloat(document.getElementById('mu').value);\n    const c = parseInt(document.getElementById('c').value);\n\n    const queue = new MMCQueue(lambda, mu, c);\n    const metrics = queue.getAllMetrics();\n\n    // Update metrics display\n    document.getElementById('rhoValue').textContent = metrics.rho.toFixed(4);\n    document.getElementById('pwaitValue').textContent = metrics.stable ? metrics.pwait.toFixed(4) : 'N/A';\n    document.getElementById('lqValue').textContent = metrics.stable ? metrics.lq.toFixed(4) : '∞';\n    document.getElementById('wqValue').textContent = metrics.stable ? metrics.wq.toFixed(4) + ' hours' : '∞';\n    document.getElementById('wValue').textContent = metrics.stable ? metrics.w.toFixed(4) + ' hours' : '∞';\n\n    // Update stability warning\n    const warning = document.getElementById('stabilityWarning');\n    if (!metrics.stable) {\n        warning.classList.remove('hidden');\n    } else {\n        warning.classList.add('hidden');\n    }\n\n    // Update charts\n    utilizationChart.draw(metrics.rho, c);\n    metricsChart.draw(lambda, mu);\n    heatmapChart.draw(mu);\n    \n    // Update queue visualization\n    drawQueueVisualization(lambda, mu, c);\n}\n\nfunction reset() {\n    document.getElementById('lambda').value = '5';\n    document.getElementById('mu').value = '2';\n    document.getElementById('c').value = '3';\n    updateDisplay();\n    calculate();\n}\n\n// Initialize\nwindow.addEventListener('load', () => {\n    utilizationChart = new UtilizationChart('utilizationChart');\n    metricsChart = new MetricsChart('metricsChart');\n    heatmapChart = new HeatmapChart('heatmapChart');\n\n    document.getElementById('lambda').addEventListener('input', updateDisplay);\n    document.getElementById('mu').addEventListener('input', updateDisplay);\n    document.getElementById('c').addEventListener('input', updateDisplay);\n    \n    document.getElementById('calculateBtn').addEventListener('click', calculate);\n    document.getElementById('resetBtn').addEventListener('click', reset);\n\n    updateDisplay();\n    calculate();\n});\n\nwindow.addEventListener('resize', () => {\n    utilizationChart.setupCanvas();\n    metricsChart.setupCanvas();\n    heatmapChart.setupCanvas();\n    calculate();\n});"}}
{"input": {"input_text": "Little's law: L = lambda*W. Given throughput and cycle time compute WIP.", "simulation_name": " Littles Law", "domain": "Operations Research", "description": "Work-in-process via Little's law", "assumptions": ["Stable system"], "entities": [], "constants": [], "parameters": [{"name": "throughput", "symbol": "lambda", "unit": "items/time", "range": [0, 1000000.0]}, {"name": "cycle_time", "symbol": "W", "unit": "time", "range": [0, 1000000.0]}], "equations": [{"description": "WIP", "expression": "L = lambda*W"}], "initial_conditions": {}, "outputs": ["L"], "simulation_controls": ["lambda", "W"], "constraints": ["lambda>=0", "W>=0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Little's Law Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n\n    <div class=\"main-container\">\n        <header>\n            <h1>Little's Law Simulator</h1>\n            <p class=\"subtitle\">Operations Research: Work-in-Process (L) = Throughput (&lambda;) &times; Cycle Time (W)</p>\n        </header>\n\n        <div class=\"simulation-window\">\n            <div class=\"label-entry\">Entry (&lambda;)</div>\n            <div class=\"system-box\" id=\"systemBox\">\n                <div class=\"system-label\">The System (Time = W)</div>\n            </div>\n            <div class=\"label-exit\">Exit</div>\n        </div>\n\n        <div class=\"dashboard\">\n            <div class=\"controls-panel\">\n                <h3>System Parameters</h3>\n                \n                <div class=\"control-group\">\n                    <label for=\"lambdaInput\">\n                        Throughput (&lambda;): <span id=\"lambdaVal\">1.0</span> items/sec\n                    </label>\n                    <input type=\"range\" id=\"lambdaInput\" min=\"0.1\" max=\"5.0\" step=\"0.1\" value=\"1.0\">\n                </div>\n\n                <div class=\"control-group\">\n                    <label for=\"wInput\">\n                        Cycle Time (W): <span id=\"wVal\">2.0</span> sec\n                    </label>\n                    <input type=\"range\" id=\"wInput\" min=\"0.5\" max=\"10.0\" step=\"0.5\" value=\"2.0\">\n                </div>\n            </div>\n\n            <div class=\"results-panel\">\n                <h3>Real-time Metrics</h3>\n                <div class=\"metric-card\">\n                    <span class=\"metric-label\">Theoretical WIP (Formula)</span>\n                    <span class=\"metric-value\" id=\"mathWip\">0.00</span>\n                    <span class=\"metric-sub\">L = &lambda; * W</span>\n                </div>\n                <div class=\"metric-card highlight\">\n                    <span class=\"metric-label\">Actual Items in System</span>\n                    <span class=\"metric-value\" id=\"countWip\">0</span>\n                    <span class=\"metric-sub\">Visual Count</span>\n                </div>\n            </div>\n        </div>\n        \n        <div class=\"explanation\">\n            <p><strong>How it works:</strong> Items enter the system at a rate of <strong>&lambda;</strong>. Each item stays in the system for exactly <strong>W</strong> seconds (represented by the travel speed across the box). Notice that the number of items visible (Actual WIP) stabilizes to match the theoretical Little's Law calculation.</p>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary-color: #2563eb;\n    --accent-color: #10b981;\n    --bg-color: #f8fafc;\n    --panel-bg: #ffffff;\n    --text-color: #1e293b;\n    --item-color: #ef4444;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n}\n\n.main-container {\n    max-width: 900px;\n    width: 100%;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 30px;\n}\n\nh1 {\n    margin: 0;\n    font-size: 2rem;\n    color: #0f172a;\n}\n\n.subtitle {\n    color: #64748b;\n    margin-top: 5px;\n}\n\n/* Simulation Window */\n.simulation-window {\n    background-color: #e2e8f0;\n    border-radius: 12px;\n    padding: 20px;\n    height: 180px;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    position: relative;\n    box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);\n    margin-bottom: 20px;\n    overflow: hidden; /* Keeps items contained */\n}\n\n.label-entry, .label-exit {\n    font-weight: bold;\n    color: #64748b;\n    width: 80px;\n    text-align: center;\n    z-index: 2;\n}\n\n.system-box {\n    flex-grow: 1;\n    height: 120px;\n    background-color: white;\n    border: 2px dashed #cbd5e1;\n    border-radius: 8px;\n    position: relative;\n    margin: 0 10px;\n    overflow: hidden; /* Items disappear when they hit the edge of this box if needed, though we handle logic in JS */\n}\n\n.system-label {\n    position: absolute;\n    bottom: 5px;\n    left: 50%;\n    transform: translateX(-50%);\n    font-size: 0.8rem;\n    color: #94a3b8;\n    text-transform: uppercase;\n    letter-spacing: 1px;\n}\n\n/* The Moving Item */\n.item {\n    width: 24px;\n    height: 24px;\n    background-color: var(--item-color);\n    border-radius: 50%;\n    position: absolute;\n    top: 50%;\n    transform: translate(-50%, -50%);\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 10px;\n    color: white;\n    font-weight: bold;\n    /* Transition is handled via JS for smooth linear movement, \n       but we add a small pop-in animation */\n    animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n}\n\n@keyframes popIn {\n    from { transform: translate(-50%, -50%) scale(0); }\n    to { transform: translate(-50%, -50%) scale(1); }\n}\n\n/* Dashboard */\n.dashboard {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 20px;\n    background-color: var(--panel-bg);\n    padding: 20px;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n}\n\n.controls-panel h3, .results-panel h3 {\n    margin-top: 0;\n    border-bottom: 2px solid #f1f5f9;\n    padding-bottom: 10px;\n    font-size: 1.1rem;\n}\n\n.control-group {\n    margin-bottom: 20px;\n}\n\nlabel {\n    display: block;\n    margin-bottom: 8px;\n    font-weight: 600;\n}\n\ninput[type=range] {\n    width: 100%;\n    cursor: pointer;\n}\n\n/* Results */\n.results-panel {\n    display: flex;\n    flex-direction: column;\n}\n\n.metric-card {\n    background: #f8fafc;\n    border: 1px solid #e2e8f0;\n    padding: 15px;\n    border-radius: 8px;\n    margin-bottom: 15px;\n    text-align: center;\n}\n\n.metric-card.highlight {\n    background: #eff6ff;\n    border-color: #bfdbfe;\n}\n\n.metric-label {\n    display: block;\n    font-size: 0.9rem;\n    color: #64748b;\n    margin-bottom: 5px;\n}\n\n.metric-value {\n    display: block;\n    font-size: 2rem;\n    font-weight: 700;\n    color: var(--primary-color);\n}\n\n.metric-sub {\n    font-size: 0.8rem;\n    color: #94a3b8;\n}\n\n.explanation {\n    margin-top: 20px;\n    font-size: 0.9rem;\n    color: #475569;\n    line-height: 1.5;\n}\n\n@media (max-width: 600px) {\n    .dashboard {\n        grid-template-columns: 1fr;\n    }\n}", "js": "document.addEventListener('DOMContentLoaded', () => {\n    // --- Configuration & State ---\n    const lambdaInput = document.getElementById('lambdaInput');\n    const wInput = document.getElementById('wInput');\n    const lambdaDisplay = document.getElementById('lambdaVal');\n    const wDisplay = document.getElementById('wVal');\n    const mathWipDisplay = document.getElementById('mathWip');\n    const countWipDisplay = document.getElementById('countWip');\n    const systemBox = document.getElementById('systemBox');\n\n    let state = {\n        lambda: parseFloat(lambdaInput.value), // Items per second\n        W: parseFloat(wInput.value),           // Seconds to traverse\n        items: [],                             // Array of active item objects\n        lastSpawnTime: 0,                      // Timestamp\n        accumulatedTime: 0                     // For precise spawning\n    };\n\n    // --- Core Update Loop ---\n    function update(timestamp) {\n        if (!state.lastSpawnTime) state.lastSpawnTime = timestamp;\n        const dt = (timestamp - state.lastSpawnTime) / 1000; // Delta time in seconds\n        state.lastSpawnTime = timestamp;\n\n        // 1. Update Parameters (in case slider moved)\n        updateDisplays();\n\n        // 2. Spawn Logic\n        // We accumulate time to handle partial frames correctly\n        state.accumulatedTime += dt;\n        const spawnInterval = 1 / state.lambda;\n\n        while (state.accumulatedTime >= spawnInterval) {\n            spawnItem();\n            state.accumulatedTime -= spawnInterval;\n        }\n\n        // 3. Move Items\n        // Progress (0 to 1) = (dt / W)\n        // If W is small, speed is high.\n        const speed = dt / state.W;\n        \n        // Filter out items that have finished (progress >= 1)\n        // We use a backwards loop or filter to remove safely\n        for (let i = state.items.length - 1; i >= 0; i--) {\n            let itemObj = state.items[i];\n            itemObj.progress += speed;\n\n            // Update DOM Position\n            // 0% is left edge, 100% is right edge\n            // We subtract half item width (handled in CSS transform) to center it\n            if (itemObj.element) {\n                itemObj.element.style.left = `${itemObj.progress * 100}%`;\n            }\n\n            // Remove if finished\n            if (itemObj.progress >= 1) {\n                if (itemObj.element) itemObj.element.remove();\n                state.items.splice(i, 1);\n            }\n        }\n\n        // 4. Update Stats\n        updateStats();\n\n        requestAnimationFrame(update);\n    }\n\n    // --- Helper Functions ---\n\n    function spawnItem() {\n        const itemEl = document.createElement('div');\n        itemEl.classList.add('item');\n        \n        // Visual Variation: stagger vertical position slightly to avoid perfect overlap\n        // using a sine wave based on time or just random\n        const verticalOffset = 50 + (Math.random() * 40 - 20); // 30% to 70% top\n        itemEl.style.top = `${verticalOffset}%`;\n        \n        // Start at left\n        itemEl.style.left = '0%';\n\n        systemBox.appendChild(itemEl);\n\n        state.items.push({\n            element: itemEl,\n            progress: 0\n        });\n    }\n\n    function updateDisplays() {\n        state.lambda = parseFloat(lambdaInput.value);\n        state.W = parseFloat(wInput.value);\n\n        lambdaDisplay.textContent = state.lambda.toFixed(1);\n        wDisplay.textContent = state.W.toFixed(1);\n    }\n\n    function updateStats() {\n        // Theoretical L\n        const theoreticalL = state.lambda * state.W;\n        mathWipDisplay.textContent = theoreticalL.toFixed(2);\n\n        // Actual Visual L\n        countWipDisplay.textContent = state.items.length;\n    }\n\n    // --- Initialization ---\n    requestAnimationFrame(update);\n});"}}
{"input": {"input_text": "Economic order quantity: EOQ = sqrt(2DS/H). Compute optimal lot size for demand D, setup cost S, holding H.", "simulation_name": " EOQ", "domain": "Operations Research", "description": "EOQ closed form", "assumptions": ["Deterministic demand"], "entities": [], "constants": [], "parameters": [{"name": "demand_rate", "symbol": "D", "unit": "units/time", "range": [1, 1000000000.0]}, {"name": "setup_cost", "symbol": "S", "unit": "currency/order", "range": [0.01, 1000000.0]}, {"name": "holding_cost", "symbol": "H", "unit": "currency/unit/time", "range": [0.0001, 100000.0]}], "equations": [{"description": "EOQ", "expression": "Qstar = sqrt(2*D*S/H)"}], "initial_conditions": {}, "outputs": ["Qstar"], "simulation_controls": ["D", "S", "H"], "constraints": ["D>0", "S>0", "H>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S82 EOQ Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"main-wrapper\">\n    <header>\n        <h1>Economic Order Quantity (EOQ) Solver</h1>\n        <p>Balancing <strong>Holding Costs</strong> against <strong>Setup Costs</strong> to find the optimal order size.</p>\n    </header>\n\n    <div class=\"dashboard\">\n        <div class=\"panel controls\">\n            <h3>1. Parameters</h3>\n            \n            <div class=\"control-group\">\n                <div class=\"label-row\">\n                    <label>Demand Rate ($D$)</label>\n                    <span id=\"val-D\" class=\"val\">1000</span>\n                </div>\n                <input type=\"range\" id=\"in-D\" min=\"200\" max=\"2000\" step=\"50\" value=\"1000\">\n                <div class=\"hint\">Higher demand depletes inventory faster (Steeper Slope).</div>\n            </div>\n\n            <div class=\"control-group\">\n                <div class=\"label-row\">\n                    <label>Setup Cost ($S$)</label>\n                    <span id=\"val-S\" class=\"val\">50</span>\n                </div>\n                <input type=\"range\" id=\"in-S\" min=\"10\" max=\"200\" step=\"5\" value=\"50\">\n                <div class=\"hint\">High setup cost favors larger, less frequent orders.</div>\n            </div>\n\n            <div class=\"control-group\">\n                <div class=\"label-row\">\n                    <label>Holding Cost ($H$)</label>\n                    <span id=\"val-H\" class=\"val\">2.5</span>\n                </div>\n                <input type=\"range\" id=\"in-H\" min=\"0.5\" max=\"10\" step=\"0.1\" value=\"2.5\">\n                <div class=\"hint\">High holding cost favors smaller, more frequent orders.</div>\n            </div>\n\n            <div class=\"results-box\">\n                <h4>Optimal Quantity ($Q^*$)</h4>\n                <div id=\"res-Q\" class=\"big-result\">200.00</div>\n                <div class=\"math-eq\">$$Q^* = \\sqrt{\\frac{2DS}{H}}$$</div>\n                <div class=\"cost-summary\">\n                    <span>Min Total Cost: <b id=\"res-TC\">--</b></span>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"visuals-col\">\n            \n            <div class=\"panel graph-panel\">\n                <h3>2. The Optimization (Cost Trade-off)</h3>\n                <div class=\"canvas-wrap\" style=\"height: 220px;\">\n                    <canvas id=\"costCanvas\"></canvas>\n                </div>\n                <div class=\"legend\">\n                    <span class=\"l-item\"><span class=\"color-box holding\"></span>Holding Cost</span>\n                    <span class=\"l-item\"><span class=\"color-box setup\"></span>Setup Cost</span>\n                    <span class=\"l-item\"><span class=\"color-box total\"></span>Total Cost</span>\n                </div>\n            </div>\n\n            <div class=\"panel graph-panel\">\n                <h3>3. Inventory Dynamics (Time Simulation)</h3>\n                <div class=\"canvas-wrap\" style=\"height: 200px;\">\n                    <canvas id=\"invCanvas\"></canvas>\n                </div>\n                <div class=\"legend\">\n                    <span class=\"l-item\">Slope = Demand Rate ($D$)</span>\n                    <span class=\"l-item\">Peak = Order Qty ($Q^*$)</span>\n                </div>\n            </div>\n\n        </div>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-app: #f1f5f9;\n    --bg-panel: #ffffff;\n    --primary: #2563eb;     /* Blue */\n    --holding: #ea580c;     /* Orange */\n    --setup: #16a34a;       /* Green */\n    --total: #0f172a;       /* Dark */\n    --text: #334155;\n    --border: #e2e8f0;\n}\n\nbody {\n    font-family: 'Segoe UI', system-ui, sans-serif;\n    background: var(--bg-app);\n    color: var(--text);\n    margin: 0;\n    padding: 20px;\n}\n\n.main-wrapper {\n    max-width: 1100px;\n    margin: 0 auto;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 30px;\n}\n\nheader h1 { margin: 0 0 10px 0; color: var(--total); }\nheader p { margin: 0; color: #64748b; }\n\n.dashboard {\n    display: grid;\n    grid-template-columns: 320px 1fr;\n    gap: 20px;\n}\n\n.panel {\n    background: var(--bg-panel);\n    border-radius: 12px;\n    padding: 20px;\n    box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);\n    border: 1px solid var(--border);\n}\n\nh3 {\n    margin-top: 0;\n    color: var(--total);\n    border-bottom: 2px solid var(--border);\n    padding-bottom: 10px;\n    font-size: 1.1em;\n}\n\n/* Controls */\n.control-group { margin-bottom: 20px; }\n\n.label-row {\n    display: flex;\n    justify-content: space-between;\n    font-weight: 600;\n    margin-bottom: 5px;\n}\n\n.val { color: var(--primary); font-family: monospace; }\n\ninput[type=range] { width: 100%; cursor: pointer; }\n\n.hint { font-size: 0.8em; color: #94a3b8; font-style: italic; margin-top: 4px; }\n\n.results-box {\n    background: #eff6ff;\n    padding: 15px;\n    border-radius: 8px;\n    text-align: center;\n    border: 1px solid #dbeafe;\n}\n\n.big-result {\n    font-size: 2em;\n    font-weight: 800;\n    color: var(--primary);\n}\n\n.cost-summary {\n    margin-top: 10px;\n    font-size: 0.9em;\n    color: #475569;\n}\n\n/* Visuals Column */\n.visuals-col {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.canvas-wrap {\n    width: 100%;\n    position: relative;\n    background: #fff;\n    border: 1px solid #cbd5e1;\n    border-radius: 6px;\n}\n\ncanvas {\n    width: 100%;\n    height: 100%;\n    display: block;\n}\n\n.legend {\n    display: flex;\n    justify-content: center;\n    gap: 15px;\n    margin-top: 10px;\n    font-size: 0.85em;\n}\n\n.l-item { display: flex; align-items: center; gap: 5px; }\n\n.color-box { width: 12px; height: 12px; border-radius: 3px; }\n.color-box.holding { background: var(--holding); }\n.color-box.setup { background: var(--setup); }\n.color-box.total { background: var(--total); }\n\n@media (max-width: 800px) {\n    .dashboard { grid-template-columns: 1fr; }\n}", "js": "document.addEventListener(\"DOMContentLoaded\", () => {\n    // --- Configuration ---\n    // We use fixed scales to ensure \"Physics\" are visible. \n    // e.g., if Demand doubles, the slope MUST look twice as steep.\n    const SCALE = {\n        max_Q_view: 2000,      // Y-axis max for Inventory Graph\n        max_Cost_view: 3000,   // Y-axis max for Cost Graph\n        pixels_per_year: 400   // X-axis speed for Inventory\n    };\n\n    // --- State ---\n    const params = { D: 1000, S: 50, H: 2.5 };\n    let Qstar = 0;\n    let minTotalCost = 0;\n\n    // Animation State\n    let timeOffset = 0;\n    let animId;\n\n    // --- DOM ---\n    const ui = {\n        D: document.getElementById('in-D'),\n        S: document.getElementById('in-S'),\n        H: document.getElementById('in-H'),\n        valD: document.getElementById('val-D'),\n        valS: document.getElementById('val-S'),\n        valH: document.getElementById('val-H'),\n        resQ: document.getElementById('res-Q'),\n        resTC: document.getElementById('res-TC')\n    };\n\n    const costCanvas = document.getElementById('costCanvas');\n    const invCanvas = document.getElementById('invCanvas');\n    const ctxCost = costCanvas.getContext('2d');\n    const ctxInv = invCanvas.getContext('2d');\n\n    // --- Initialization ---\n    function init() {\n        resizeCanvases();\n        window.addEventListener('resize', resizeCanvases);\n\n        // Bind Inputs\n        ['D', 'S', 'H'].forEach(key => {\n            ui[key].addEventListener('input', (e) => {\n                params[key] = parseFloat(e.target.value);\n                updateModel();\n            });\n        });\n\n        updateModel();\n        loop();\n    }\n\n    function resizeCanvases() {\n        // High DPI scaling\n        [costCanvas, invCanvas].forEach(cvs => {\n            const rect = cvs.parentElement.getBoundingClientRect();\n            cvs.width = rect.width * 2;  // Retina\n            cvs.height = rect.height * 2;\n            cvs.style.width = rect.width + 'px';\n            cvs.style.height = rect.height + 'px';\n        });\n    }\n\n    // --- Math & Update ---\n    function updateModel() {\n        // Update UI Text\n        ui.valD.textContent = params.D;\n        ui.valS.textContent = params.S;\n        ui.valH.textContent = params.H;\n\n        // EOQ Calculation\n        // Q* = sqrt(2DS / H)\n        Qstar = Math.sqrt((2 * params.D * params.S) / params.H);\n        \n        // Cost Calculation at Q*\n        const holding = (Qstar / 2) * params.H;\n        const setup = (params.D / Qstar) * params.S;\n        minTotalCost = holding + setup;\n\n        ui.resQ.textContent = Qstar.toFixed(2);\n        ui.resTC.textContent = minTotalCost.toFixed(2);\n    }\n\n    // --- Drawing Engine ---\n    function loop() {\n        drawCostCurve();\n        drawInventoryFlow();\n        requestAnimationFrame(loop);\n    }\n\n    // 1. Draw The Optimization Problem (Cost Curves)\n    function drawCostCurve() {\n        const ctx = ctxCost;\n        const w = costCanvas.width;\n        const h = costCanvas.height;\n        \n        ctx.clearRect(0, 0, w, h);\n        \n        // Padding\n        const pad = { l: 60, r: 20, t: 20, b: 40 };\n        const graphW = w - pad.l - pad.r;\n        const graphH = h - pad.t - pad.b;\n\n        // Dynamic Scaling for Cost View based on current values to keep curve centered\n        // We center the view roughly around Q* (x-axis) and MinCost (y-axis)\n        // But we want smooth transitions, so we dampen it or use fixed ranges if possible.\n        // Let's use a semi-fixed range based on slider maxes to show movement.\n        const maxX = 2500; // Q axis\n        const maxY = 5000; // Cost axis\n\n        // Draw Axes\n        ctx.beginPath();\n        ctx.strokeStyle = '#ccc';\n        ctx.lineWidth = 2;\n        ctx.moveTo(pad.l, pad.t);\n        ctx.lineTo(pad.l, h - pad.b); // Y\n        ctx.lineTo(w - pad.r, h - pad.b); // X\n        ctx.stroke();\n\n        // Labels\n        ctx.fillStyle = '#64748b';\n        ctx.font = '24px Arial';\n        ctx.textAlign = 'center';\n        ctx.fillText(\"Order Quantity (Q)\", w/2 + pad.l/2, h - 10);\n        ctx.save();\n        ctx.translate(20, h/2);\n        ctx.rotate(-Math.PI/2);\n        ctx.fillText(\"Cost\", 0, 0);\n        ctx.restore();\n\n        // Helper to map coordinates\n        const mapX = (q) => pad.l + (q / maxX) * graphW;\n        const mapY = (c) => (h - pad.b) - (c / maxY) * graphH;\n\n        // Plot Functions\n        ctx.lineWidth = 3;\n\n        // Holding Cost: Linear (H * Q/2)\n        ctx.beginPath();\n        ctx.strokeStyle = '#ea580c'; // Orange\n        for(let q=0; q<=maxX; q+=10) {\n            let c = (q/2) * params.H;\n            if (q===0) ctx.moveTo(mapX(q), mapY(c));\n            else ctx.lineTo(mapX(q), mapY(c));\n        }\n        ctx.stroke();\n\n        // Setup Cost: Hyperbolic (S * D/Q)\n        ctx.beginPath();\n        ctx.strokeStyle = '#16a34a'; // Green\n        for(let q=50; q<=maxX; q+=10) {\n            let c = (params.D / q) * params.S;\n            if (c > maxY) continue; // Clip\n            if (q===50) ctx.moveTo(mapX(q), mapY(c));\n            else ctx.lineTo(mapX(q), mapY(c));\n        }\n        ctx.stroke();\n\n        // Total Cost: Sum\n        ctx.beginPath();\n        ctx.strokeStyle = '#0f172a'; // Dark\n        ctx.lineWidth = 4;\n        for(let q=50; q<=maxX; q+=10) {\n            let c = ((q/2) * params.H) + ((params.D / q) * params.S);\n            if (c > maxY) continue;\n            // Draw curve\n            if(q===50) ctx.moveTo(mapX(q), mapY(c));\n            else ctx.lineTo(mapX(q), mapY(c));\n        }\n        ctx.stroke();\n\n        // Mark Q* (The Solution)\n        const optX = mapX(Qstar);\n        const optY = mapY(minTotalCost);\n\n        ctx.beginPath();\n        ctx.fillStyle = '#2563eb';\n        ctx.arc(optX, optY, 8, 0, Math.PI*2);\n        ctx.fill();\n\n        // Draw drop line\n        ctx.beginPath();\n        ctx.setLineDash([5, 5]);\n        ctx.strokeStyle = '#2563eb';\n        ctx.lineWidth = 2;\n        ctx.moveTo(optX, optY);\n        ctx.lineTo(optX, h - pad.b);\n        ctx.stroke();\n        ctx.setLineDash([]);\n    }\n\n    // 2. Draw Inventory Dynamics (Sawtooth)\n    function drawInventoryFlow() {\n        const ctx = ctxInv;\n        const w = invCanvas.width;\n        const h = invCanvas.height;\n\n        ctx.clearRect(0, 0, w, h);\n\n        const pad = { l: 60, r: 20, t: 20, b: 40 };\n        const graphH = h - pad.t - pad.b;\n\n        // FIXED SCALES (This is crucial for the \"Proper\" representation)\n        // We do NOT change these based on inputs.\n        const scaleY = graphH / SCALE.max_Q_view; // Pixels per unit\n        \n        // Time Scaling\n        // We want Slope = Demand. \n        // In pixels: Slope = (dy pixels) / (dx pixels)\n        // dy = units * scaleY\n        // dx = years * pixels_per_year\n        // We want visual slope to correspond to D.\n        // Actually, for animation, we just need cycle width to be consistent with D.\n        // Cycle Time T = Q / D.\n        // Cycle Width (px) = T * pixels_per_year = (Q/D) * pixels_per_year\n        const cycleWidthPx = (Qstar / params.D) * SCALE.pixels_per_year;\n\n        // Draw Axes\n        ctx.beginPath();\n        ctx.strokeStyle = '#ccc';\n        ctx.lineWidth = 2;\n        ctx.moveTo(pad.l, pad.t);\n        ctx.lineTo(pad.l, h - pad.b);\n        ctx.lineTo(w - pad.r, h - pad.b);\n        ctx.stroke();\n\n        // Labels\n        ctx.fillStyle = '#64748b';\n        ctx.font = '24px Arial';\n        ctx.textAlign = 'center';\n        ctx.fillText(\"Time\", w/2 + pad.l/2, h - 10);\n        ctx.save();\n        ctx.translate(20, h/2);\n        ctx.rotate(-Math.PI/2);\n        ctx.fillText(\"Inventory Level\", 0, 0);\n        ctx.restore();\n\n        // Animation Increment\n        // We move 2 pixel per frame. \n        timeOffset = (timeOffset + 2) % cycleWidthPx;\n\n        // Draw Sawtooth\n        ctx.beginPath();\n        ctx.strokeStyle = '#2563eb';\n        ctx.lineWidth = 3;\n        ctx.lineJoin = 'round';\n\n        let x = pad.l - timeOffset;\n        \n        // If offset pushes first point offscreen, backtrack one cycle\n        if (x > pad.l) x -= cycleWidthPx;\n\n        const floorY = h - pad.b;\n        const peakY = floorY - (Qstar * scaleY);\n\n        // Draw enough cycles to fill screen\n        while (x < w) {\n            // Replenish (Vertical up)\n            ctx.moveTo(x, floorY);\n            ctx.lineTo(x, peakY);\n            \n            // Deplete (Diagonal down)\n            ctx.lineTo(x + cycleWidthPx, floorY);\n            \n            x += cycleWidthPx;\n        }\n\n        // Clip to graph area\n        ctx.save();\n        ctx.beginPath();\n        ctx.rect(pad.l, 0, w, h);\n        ctx.clip();\n        ctx.stroke();\n        ctx.restore();\n\n        // Draw Q* Line (Max Inventory)\n        ctx.beginPath();\n        ctx.strokeStyle = '#94a3b8';\n        ctx.setLineDash([5, 5]);\n        ctx.moveTo(pad.l, peakY);\n        ctx.lineTo(w - pad.r, peakY);\n        ctx.stroke();\n        \n        ctx.fillStyle = '#2563eb';\n        ctx.fillText(\"Q*\", pad.l - 20, peakY + 5);\n    }\n\n    init();\n});"}}
{"input": {"input_text": "PERT expected activity time: te = (a + 4m + b)/6. Compute expected and variance ((b-a)/6)^2.", "simulation_name": " PERT Activity", "domain": "Project Management", "description": "PERT three-point estimate", "assumptions": ["Beta approximation"], "entities": [], "constants": [], "parameters": [{"name": "optimistic", "symbol": "a", "unit": "time", "range": [0, 1000000.0]}, {"name": "most_likely", "symbol": "m", "unit": "time", "range": [0, 1000000.0]}, {"name": "pessimistic", "symbol": "b", "unit": "time", "range": [0, 1000000.0]}], "equations": [{"description": "Expected time", "expression": "te = (a + 4*m + b)/6"}, {"description": "Variance", "expression": "var = ((b - a)/6)^2"}], "initial_conditions": {}, "outputs": ["te", "var"], "simulation_controls": ["a", "m", "b"], "constraints": ["b>=a", "m between a and b"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>PERT Analysis Simulator</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n\n    <div class=\"container\">\n        <header>\n            <h1>PERT Activity Estimator</h1>\n            <p>Calculate Expected Time ($t_e$) and Variance using the Beta Distribution approximation.</p>\n        </header>\n\n        <div class=\"viz-container\">\n            <canvas id=\"pertCanvas\"></canvas>\n            <div class=\"legend\">\n                <span class=\"legend-item\"><span class=\"dot opt\"></span> Optimistic (a)</span>\n                <span class=\"legend-item\"><span class=\"dot likely\"></span> Most Likely (m)</span>\n                <span class=\"legend-item\"><span class=\"dot pess\"></span> Pessimistic (b)</span>\n                <span class=\"legend-item\"><span class=\"dot expected\"></span> Expected ($t_e$)</span>\n            </div>\n        </div>\n\n        <div class=\"dashboard\">\n            <div class=\"controls\">\n                <h3>Estimates (Hours/Days)</h3>\n                \n                <div class=\"control-group\">\n                    <label>Optimistic (a): <span id=\"val-a\">2</span></label>\n                    <input type=\"range\" id=\"input-a\" min=\"0\" max=\"100\" value=\"2\">\n                </div>\n\n                <div class=\"control-group\">\n                    <label>Most Likely (m): <span id=\"val-m\">5</span></label>\n                    <input type=\"range\" id=\"input-m\" min=\"0\" max=\"100\" value=\"5\">\n                </div>\n\n                <div class=\"control-group\">\n                    <label>Pessimistic (b): <span id=\"val-b\">14</span></label>\n                    <input type=\"range\" id=\"input-b\" min=\"0\" max=\"100\" value=\"14\">\n                </div>\n                \n                <p class=\"note\" id=\"error-msg\"></p>\n            </div>\n\n            <div class=\"results\">\n                <h3>Calculated Output</h3>\n                \n                <div class=\"result-card\">\n                    <div class=\"label\">Expected Time ($t_e$)</div>\n                    <div class=\"value\" id=\"res-te\">0.00</div>\n                    <div class=\"formula\">$t_e = \\frac{a + 4m + b}{6}$</div>\n                </div>\n\n                <div class=\"result-card\">\n                    <div class=\"label\">Variance ($\\sigma^2$)</div>\n                    <div class=\"value\" id=\"res-var\">0.00</div>\n                    <div class=\"formula\">$Var = (\\frac{b - a}{6})^2$</div>\n                </div>\n                \n                <div class=\"result-card\">\n                    <div class=\"label\">Standard Deviation ($\\sigma$)</div>\n                    <div class=\"value\" id=\"res-std\">0.00</div>\n                    <div class=\"formula\">$\\sigma = \\frac{b - a}{6}$</div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-color: #f0f4f8;\n    --card-bg: #ffffff;\n    --primary: #3b82f6;\n    --text-main: #1e293b;\n    --text-light: #64748b;\n    \n    --color-a: #10b981; /* Green */\n    --color-m: #f59e0b; /* Amber */\n    --color-b: #ef4444; /* Red */\n    --color-te: #6366f1; /* Indigo */\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-main);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n}\n\n.container {\n    max-width: 900px;\n    width: 100%;\n    background-color: var(--card-bg);\n    border-radius: 16px;\n    box-shadow: 0 4px 20px rgba(0,0,0,0.08);\n    padding: 30px;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 30px;\n}\n\nh1 { margin: 0; color: var(--text-main); }\np { color: var(--text-light); margin-top: 5px; }\n\n/* Visualization Area */\n.viz-container {\n    position: relative;\n    margin-bottom: 30px;\n    background: #f8fafc;\n    border: 1px solid #e2e8f0;\n    border-radius: 12px;\n    padding: 20px;\n    overflow: hidden;\n}\n\ncanvas {\n    width: 100%;\n    height: 250px;\n    display: block;\n}\n\n.legend {\n    display: flex;\n    justify-content: center;\n    gap: 20px;\n    margin-top: 10px;\n    flex-wrap: wrap;\n}\n\n.legend-item {\n    font-size: 0.9rem;\n    color: var(--text-light);\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n.dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; }\n.dot.opt { background-color: var(--color-a); }\n.dot.likely { background-color: var(--color-m); }\n.dot.pess { background-color: var(--color-b); }\n.dot.expected { background-color: var(--color-te); }\n\n/* Dashboard Layout */\n.dashboard {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 40px;\n}\n\nh3 {\n    border-bottom: 2px solid #f1f5f9;\n    padding-bottom: 10px;\n    margin-top: 0;\n    color: var(--text-main);\n}\n\n/* Controls */\n.control-group {\n    margin-bottom: 20px;\n}\n\nlabel {\n    display: flex;\n    justify-content: space-between;\n    font-weight: 600;\n    margin-bottom: 8px;\n    font-size: 0.95rem;\n}\n\ninput[type=range] {\n    width: 100%;\n    cursor: pointer;\n    accent-color: var(--primary);\n}\n\n.note {\n    font-size: 0.85rem;\n    color: var(--color-b);\n    height: 20px;\n    font-weight: bold;\n}\n\n/* Results */\n.results {\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n}\n\n.result-card {\n    background: #f1f5f9;\n    padding: 15px;\n    border-radius: 8px;\n    border-left: 5px solid var(--primary);\n}\n\n.result-card:nth-child(2) { border-left-color: var(--color-te); }\n.result-card:nth-child(3) { border-left-color: var(--text-light); }\n\n.result-card .label { font-size: 0.85rem; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.5px; }\n.result-card .value { font-size: 1.8rem; font-weight: bold; color: var(--text-main); margin: 5px 0; }\n.result-card .formula { font-size: 0.8rem; color: #94a3b8; font-family: 'Courier New', monospace; }\n\n@media (max-width: 700px) {\n    .dashboard { grid-template-columns: 1fr; }\n}", "js": "document.addEventListener('DOMContentLoaded', () => {\n    const canvas = document.getElementById('pertCanvas');\n    const ctx = canvas.getContext('2d');\n\n    // Inputs\n    const inputA = document.getElementById('input-a');\n    const inputM = document.getElementById('input-m');\n    const inputB = document.getElementById('input-b');\n\n    // Display Values\n    const valA = document.getElementById('val-a');\n    const valM = document.getElementById('val-m');\n    const valB = document.getElementById('val-b');\n    const errorMsg = document.getElementById('error-msg');\n\n    // Results\n    const resTe = document.getElementById('res-te');\n    const resVar = document.getElementById('res-var');\n    const resStd = document.getElementById('res-std');\n\n    // State\n    let a = 20, m = 50, b = 80;\n    \n    // Canvas dimensions (set programmatically to match CSS resolution)\n    function resizeCanvas() {\n        const rect = canvas.parentElement.getBoundingClientRect();\n        canvas.width = rect.width;\n        canvas.height = 250;\n    }\n    window.addEventListener('resize', () => {\n        resizeCanvas();\n        draw();\n    });\n    resizeCanvas();\n\n    function update() {\n        // Read raw values\n        let rawA = parseInt(inputA.value);\n        let rawM = parseInt(inputM.value);\n        let rawB = parseInt(inputB.value);\n\n        // Logic Enforcement: a <= m <= b\n        // We won't force sliders to move instantly to avoid UX fighting, \n        // but we will calculate based on sorted values or clamping for safety.\n        \n        // Strategy: Soft Constraint Enforcement\n        // If M < A, push A down or M up? \n        // Let's enforce strictly:\n        if (rawM < rawA) rawM = rawA;\n        if (rawB < rawM) rawB = rawM;\n        \n        // Update variables\n        a = rawA;\n        m = rawM;\n        b = rawB;\n\n        // Update Slider Visuals (to match enforced constraints)\n        // Check if we need to visually update the sliders to reflect the enforcement\n        if(parseInt(inputM.value) < a) inputM.value = a;\n        if(parseInt(inputB.value) < m) inputB.value = m;\n        // Also check reverse\n        if(parseInt(inputM.value) > b) inputM.value = b;\n        if(parseInt(inputA.value) > m) inputA.value = m;\n\n        // Re-read final enforced values for calculation\n        a = parseInt(inputA.value);\n        m = parseInt(inputM.value);\n        b = parseInt(inputB.value);\n\n        // Update Text Labels\n        valA.textContent = a;\n        valM.textContent = m;\n        valB.textContent = b;\n\n        // Calculations\n        const te = (a + 4 * m + b) / 6;\n        const variance = Math.pow((b - a) / 6, 2);\n        const stdDev = Math.sqrt(variance);\n\n        // Update Results\n        resTe.textContent = te.toFixed(2);\n        resVar.textContent = variance.toFixed(2);\n        resStd.textContent = stdDev.toFixed(2);\n\n        draw(te);\n    }\n\n    function draw(te) {\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n        // Padding\n        const padding = 40;\n        const width = canvas.width - (padding * 2);\n        const height = canvas.height - 50;\n        const bottomY = canvas.height - 30;\n\n        // Scale: Map 0-100 inputs to canvas width\n        const scaleX = (val) => padding + (val / 100) * width;\n        \n        // Draw Axis\n        ctx.beginPath();\n        ctx.moveTo(padding, bottomY);\n        ctx.lineTo(padding + width, bottomY);\n        ctx.strokeStyle = '#ccc';\n        ctx.lineWidth = 2;\n        ctx.stroke();\n\n        // 1. Draw The Beta Distribution Curve\n        // A simple visual approximation using a Bezier curve\n        // Start (a, 0) -> Control Points -> End (b, 0)\n        // Peak should be near m.\n        \n        const xA = scaleX(a);\n        const xM = scaleX(m);\n        const xB = scaleX(b);\n        const xTe = scaleX(te);\n\n        // Curve logic:\n        // We simulate a bell curve that starts at A, peaks at M, ends at B.\n        // Height of peak depends vaguely on width (narrower = taller), but for UI we limit it.\n        const curveHeight = 150;\n        \n        ctx.beginPath();\n        ctx.moveTo(xA, bottomY);\n        \n        // To make it look like a distribution, we use two Quadratic curves or one Cubic\n        // A cubic bezier from A to B with control points pulling up towards M works well.\n        // CP1 at (m, top), CP2 at (m, top) is simple but sharp.\n        // Let's use weighted control points.\n        \n        ctx.bezierCurveTo(\n            xA + (xM - xA) / 2, bottomY - curveHeight, // CP1\n            xB - (xB - xM) / 2, bottomY - curveHeight, // CP2\n            xB, bottomY\n        );\n        \n        ctx.fillStyle = 'rgba(59, 130, 246, 0.1)'; // Light Blue Fill\n        ctx.fill();\n        ctx.strokeStyle = '#3b82f6';\n        ctx.lineWidth = 3;\n        ctx.stroke();\n\n        // 2. Draw Vertical Markers\n        drawMarker(xA, 'a', '#10b981', false);\n        drawMarker(xM, 'm', '#f59e0b', false);\n        drawMarker(xB, 'b', '#ef4444', false);\n        drawMarker(xTe, 'te', '#6366f1', true); // Expected Time (Highlighted)\n\n    }\n\n    function drawMarker(x, label, color, isMain) {\n        const bottomY = canvas.height - 30;\n        const topY = isMain ? bottomY - 180 : bottomY - 40; // Te line is taller\n\n        ctx.beginPath();\n        ctx.moveTo(x, bottomY);\n        ctx.lineTo(x, topY);\n        ctx.strokeStyle = color;\n        ctx.lineWidth = isMain ? 2 : 1;\n        ctx.setLineDash(isMain ? [] : [5, 3]); // Dashed for a, m, b\n        ctx.stroke();\n        ctx.setLineDash([]);\n\n        // Label bg\n        ctx.fillStyle = color;\n        if(isMain) {\n            // Te Bubble\n            ctx.beginPath();\n            ctx.arc(x, topY, 4, 0, Math.PI*2);\n            ctx.fill();\n            \n            ctx.font = 'bold 14px sans-serif';\n            ctx.textAlign = 'center';\n            ctx.fillText(\"te\", x, topY - 10);\n        } else {\n            // Small markers\n            ctx.font = '12px sans-serif';\n            ctx.textAlign = 'center';\n            ctx.fillText(label, x, bottomY + 15);\n        }\n    }\n\n    // Initialize\n    inputA.addEventListener('input', update);\n    inputM.addEventListener('input', update);\n    inputB.addEventListener('input', update);\n\n    // Initial Trigger\n    update();\n});"}}
{"input": {"input_text": "2D unbiased random walk with step size s and n steps: variance of displacement = n*s^2. Compute RMS distance sqrt(2*n)*s.", "simulation_name": " Random Walk 2D", "domain": "Mathematics", "description": "Planar random walk stats", "assumptions": ["Independent steps"], "entities": [], "constants": [], "parameters": [{"name": "steps", "symbol": "n", "unit": "count", "range": [1, 10000000.0]}, {"name": "step_size", "symbol": "s", "unit": "m", "range": [1e-06, 1]}], "equations": [{"description": "Variance", "expression": "var = n*s^2"}, {"description": "RMS distance", "expression": "r_rms = sqrt(2*n)*s"}], "initial_conditions": {}, "outputs": ["var", "r_rms"], "simulation_controls": ["n", "s"], "constraints": ["n>=1", "s>=0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S84 Random Walk 2D</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"main-wrapper\">\n    <header>\n        <h1>2D Unbiased Random Walk</h1>\n        <p>Simulating diffusion with independent steps on X and Y axes.</p>\n    </header>\n\n    <div class=\"dashboard\">\n        <div class=\"panel controls\">\n            <h3>Parameters</h3>\n            \n            <div class=\"control-group\">\n                <div class=\"label-row\">\n                    <label>Step Count ($n$)</label>\n                    <span id=\"val-n\" class=\"val\">1000</span>\n                </div>\n                <input type=\"range\" id=\"in-n\" min=\"100\" max=\"10000\" step=\"100\" value=\"1000\">\n            </div>\n\n            <div class=\"control-group\">\n                <div class=\"label-row\">\n                    <label>Step Size ($s$)</label>\n                    <span id=\"val-s\" class=\"val\">1.0</span>\n                </div>\n                <input type=\"range\" id=\"in-s\" min=\"0.5\" max=\"5.0\" step=\"0.5\" value=\"1.0\">\n            </div>\n\n            <div class=\"button-row\">\n                <button id=\"btn-start\" class=\"btn primary\">Start Simulation</button>\n                <button id=\"btn-reset\" class=\"btn secondary\">Reset</button>\n            </div>\n\n            <div class=\"stats-box\">\n                <h4>Statistics</h4>\n                \n                <div class=\"stat-row\">\n                    <span>Theoretical RMS ($s\\sqrt{2n}$):</span>\n                    <strong id=\"stat-theo-rms\" class=\"highlight\">--</strong>\n                </div>\n                <div class=\"stat-row\">\n                    <span>Current Distance ($R$):</span>\n                    <strong id=\"stat-curr-dist\">0.00</strong>\n                </div>\n                <div class=\"stat-row\">\n                    <span>Theoretical Variance ($ns^2$):</span>\n                    <span id=\"stat-theo-var\">--</span>\n                </div>\n                \n                <hr>\n                \n                <div class=\"formula-block\">\n                    $$R_{RMS} = s\\sqrt{2n}$$\n                </div>\n            </div>\n        </div>\n\n        <div class=\"panel visual\">\n            <div class=\"canvas-container\">\n                <canvas id=\"walkCanvas\"></canvas>\n                <div class=\"overlay-legend\">\n                    <span class=\"dot origin\"></span> Start\n                    <span class=\"dot current\"></span> Current\n                    <span class=\"circle-legend\"></span> RMS Radius\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-color: #f8fafc;\n    --panel-bg: #ffffff;\n    --primary: #3b82f6;\n    --secondary: #64748b;\n    --accent: #ef4444;\n    --text: #1e293b;\n    --border: #e2e8f0;\n}\n\nbody {\n    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text);\n    margin: 0;\n    padding: 20px;\n    height: 100vh;\n    box-sizing: border-box;\n}\n\n.main-wrapper {\n    max-width: 1200px;\n    margin: 0 auto;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n}\n\nheader {\n    margin-bottom: 20px;\n}\n\nheader h1 { margin: 0; color: var(--text); }\nheader p { margin: 5px 0 0; color: var(--secondary); }\n\n.dashboard {\n    display: grid;\n    grid-template-columns: 300px 1fr;\n    gap: 20px;\n    flex: 1;\n    min-height: 0; /* allows flex child to scroll */\n}\n\n.panel {\n    background: var(--panel-bg);\n    border: 1px solid var(--border);\n    border-radius: 8px;\n    padding: 20px;\n    box-shadow: 0 1px 3px rgba(0,0,0,0.05);\n}\n\n/* Controls Panel */\n.controls {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\nh3, h4 {\n    margin-top: 0;\n    color: var(--text);\n    border-bottom: 2px solid var(--border);\n    padding-bottom: 10px;\n}\n\n.control-group {\n    margin-bottom: 15px;\n}\n\n.label-row {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 5px;\n    font-weight: 600;\n    font-size: 0.9rem;\n}\n\n.val { color: var(--primary); font-family: monospace; }\n\ninput[type=range] { width: 100%; }\n\n.button-row {\n    display: flex;\n    gap: 10px;\n}\n\n.btn {\n    flex: 1;\n    padding: 10px;\n    border: none;\n    border-radius: 6px;\n    cursor: pointer;\n    font-weight: 600;\n    transition: background 0.2s;\n}\n\n.btn.primary { background: var(--primary); color: white; }\n.btn.primary:hover { background: #2563eb; }\n\n.btn.secondary { background: #e2e8f0; color: var(--secondary); }\n.btn.secondary:hover { background: #cbd5e1; }\n\n.stats-box {\n    background: #f1f5f9;\n    padding: 15px;\n    border-radius: 6px;\n    margin-top: auto;\n}\n\n.stat-row {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 8px;\n    font-size: 0.9rem;\n}\n\n.highlight { color: var(--primary); }\n.formula-block { text-align: center; margin-top: 10px; }\n\n/* Visual Panel */\n.visual {\n    position: relative;\n    padding: 0;\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n}\n\n.canvas-container {\n    flex: 1;\n    position: relative;\n    background: #ffffff;\n    cursor: crosshair;\n}\n\ncanvas {\n    display: block;\n    width: 100%;\n    height: 100%;\n}\n\n.overlay-legend {\n    position: absolute;\n    top: 15px;\n    right: 15px;\n    background: rgba(255, 255, 255, 0.9);\n    padding: 8px 12px;\n    border-radius: 6px;\n    border: 1px solid var(--border);\n    font-size: 0.85rem;\n    pointer-events: none;\n    display: flex;\n    gap: 15px;\n}\n\n.dot { width: 10px; height: 10px; display: inline-block; border-radius: 50%; margin-right: 5px; }\n.dot.origin { background: #000; }\n.dot.current { background: var(--accent); }\n.circle-legend { \n    width: 10px; height: 10px; \n    display: inline-block; border-radius: 50%; \n    border: 2px dashed rgba(59, 130, 246, 0.5); \n    margin-right: 5px;\n}\n\n@media (max-width: 800px) {\n    .dashboard { grid-template-columns: 1fr; grid-template-rows: auto 400px; }\n}", "js": "document.addEventListener(\"DOMContentLoaded\", () => {\n    // --- Configuration ---\n    const ui = {\n        n: document.getElementById('in-n'),\n        s: document.getElementById('in-s'),\n        valN: document.getElementById('val-n'),\n        valS: document.getElementById('val-s'),\n        btnStart: document.getElementById('btn-start'),\n        btnReset: document.getElementById('btn-reset'),\n        statTheoRMS: document.getElementById('stat-theo-rms'),\n        statCurrDist: document.getElementById('stat-curr-dist'),\n        statTheoVar: document.getElementById('stat-theo-var'),\n        canvas: document.getElementById('walkCanvas')\n    };\n\n    const ctx = ui.canvas.getContext('2d');\n    \n    // State\n    let state = {\n        n: 1000,\n        s: 1.0,\n        path: [], // Array of {x, y}\n        currentStep: 0,\n        isRunning: false,\n        animationId: null\n    };\n\n    // --- Initialization ---\n    function init() {\n        resizeCanvas();\n        window.addEventListener('resize', resizeCanvas);\n        \n        ui.n.addEventListener('input', updateParams);\n        ui.s.addEventListener('input', updateParams);\n        \n        ui.btnStart.addEventListener('click', toggleSimulation);\n        ui.btnReset.addEventListener('click', resetSimulation);\n\n        updateParams();\n        drawScene(); // Initial empty draw\n    }\n\n    function updateParams() {\n        state.n = parseInt(ui.n.value);\n        state.s = parseFloat(ui.s.value);\n        \n        ui.valN.textContent = state.n;\n        ui.valS.textContent = state.s.toFixed(1);\n\n        // Update Theoretical Stats\n        // Formula: RMS = s * sqrt(2 * n)\n        const rms = state.s * Math.sqrt(2 * state.n);\n        // Formula: Var = n * s^2 (Per axis variance assumption based on prompt consistency)\n        const variance = state.n * Math.pow(state.s, 2);\n\n        ui.statTheoRMS.textContent = rms.toFixed(2);\n        ui.statTheoVar.textContent = variance.toFixed(2);\n\n        // If we change params while not running, reset visualization to be safe\n        if (!state.isRunning && state.currentStep === 0) {\n            drawScene();\n        }\n    }\n\n    function resizeCanvas() {\n        const rect = ui.canvas.parentElement.getBoundingClientRect();\n        ui.canvas.width = rect.width;\n        ui.canvas.height = rect.height;\n        if (!state.isRunning) drawScene();\n    }\n\n    // --- Simulation Logic ---\n\n    function resetSimulation() {\n        stopAnimation();\n        state.path = [];\n        state.currentStep = 0;\n        state.isRunning = false;\n        ui.btnStart.textContent = \"Start Simulation\";\n        ui.btnStart.classList.remove('secondary');\n        ui.btnStart.classList.add('primary');\n        ui.statCurrDist.textContent = \"0.00\";\n        drawScene();\n    }\n\n    function toggleSimulation() {\n        if (state.isRunning) {\n            // Pause\n            state.isRunning = false;\n            stopAnimation();\n            ui.btnStart.textContent = \"Resume\";\n        } else {\n            // Start\n            if (state.currentStep >= state.n) {\n                // If already finished, clear first\n                resetSimulation();\n                // Need to force start after reset\n                state.isRunning = true;\n                ui.btnStart.textContent = \"Pause\";\n                ui.btnStart.classList.remove('primary');\n                ui.btnStart.classList.add('secondary');\n                loop();\n            } else {\n                state.isRunning = true;\n                ui.btnStart.textContent = \"Pause\";\n                ui.btnStart.classList.remove('primary');\n                ui.btnStart.classList.add('secondary');\n                loop();\n            }\n        }\n    }\n\n    function stopAnimation() {\n        if (state.animationId) cancelAnimationFrame(state.animationId);\n    }\n\n    // --- Core Math: The Walk ---\n    function takeSteps(count) {\n        if (state.path.length === 0) {\n            state.path.push({x: 0, y: 0});\n        }\n\n        let lastPos = state.path[state.path.length - 1];\n\n        for (let i = 0; i < count; i++) {\n            if (state.currentStep >= state.n) break;\n\n            // Mathematical Model for Prompt:\n            // \"Variance = n*s^2\" per axis implies step var = s^2.\n            // \"RMS = sqrt(2n)*s\" implies total MSD = 2ns^2.\n            // To achieve this, we take a step of +/- s in X AND +/- s in Y simultaneously.\n            // dx = s * coinflip, dy = s * coinflip.\n            \n            const dx = (Math.random() < 0.5 ? -1 : 1) * state.s;\n            const dy = (Math.random() < 0.5 ? -1 : 1) * state.s;\n\n            const newPos = {\n                x: lastPos.x + dx,\n                y: lastPos.y + dy\n            };\n\n            state.path.push(newPos);\n            lastPos = newPos;\n            state.currentStep++;\n        }\n    }\n\n    // --- Rendering ---\n    function loop() {\n        if (!state.isRunning) return;\n\n        // Speed: Calculate how many steps to take per frame to finish in ~3 seconds max\n        // or a minimum speed for very low N.\n        const speed = Math.max(1, Math.ceil(state.n / 180)); \n        \n        takeSteps(speed);\n        drawScene();\n\n        // Check completion\n        if (state.currentStep >= state.n) {\n            state.isRunning = false;\n            ui.btnStart.textContent = \"Restart\";\n            ui.btnStart.classList.add('primary');\n            ui.btnStart.classList.remove('secondary');\n        } else {\n            state.animationId = requestAnimationFrame(loop);\n        }\n    }\n\n    function drawScene() {\n        const w = ui.canvas.width;\n        const h = ui.canvas.height;\n        const cx = w / 2;\n        const cy = h / 2;\n\n        ctx.clearRect(0, 0, w, h);\n\n        // 1. Calculate Scale\n        // We want the Theoretical RMS circle to fit comfortably.\n        // RMS radius = s * sqrt(2n)\n        // Let's make the view radius roughly 2.5x the RMS radius to accommodate outliers.\n        const rmsRadius = state.s * Math.sqrt(2 * state.n);\n        const maxViewRadius = rmsRadius * 2.5; \n        \n        // Scale: pixels per unit distance\n        // min dimension of canvas / 2 / maxViewRadius\n        const scale = Math.min(w, h) / 2 / (maxViewRadius || 1); \n\n        // 2. Draw Grid/Axes\n        ctx.beginPath();\n        ctx.strokeStyle = \"#e2e8f0\";\n        ctx.lineWidth = 1;\n        // X Axis\n        ctx.moveTo(0, cy); ctx.lineTo(w, cy);\n        // Y Axis\n        ctx.moveTo(cx, 0); ctx.lineTo(cx, h);\n        ctx.stroke();\n\n        // 3. Draw Theoretical RMS Circle\n        const pxRadius = rmsRadius * scale;\n        ctx.beginPath();\n        ctx.strokeStyle = \"rgba(59, 130, 246, 0.4)\"; // Blue low opacity\n        ctx.lineWidth = 2;\n        ctx.setLineDash([5, 5]);\n        ctx.arc(cx, cy, pxRadius, 0, Math.PI * 2);\n        ctx.stroke();\n        ctx.setLineDash([]);\n        \n        // Label the circle\n        ctx.fillStyle = \"#3b82f6\";\n        ctx.font = \"12px sans-serif\";\n        ctx.fillText(\"RMS Distance\", cx + pxRadius + 5, cy);\n\n        // 4. Draw Path\n        if (state.path.length > 0) {\n            ctx.beginPath();\n            ctx.strokeStyle = \"#64748b\"; // Gray path\n            ctx.lineWidth = 1;\n            \n            // Move to start\n            ctx.moveTo(cx + state.path[0].x * scale, cy - state.path[0].y * scale);\n            \n            // Draw lines\n            // Optimization: If N is huge, skip points? \n            // For N=10,000 standard drawing is usually fine on modern canvas.\n            for (let i = 1; i < state.path.length; i++) {\n                ctx.lineTo(cx + state.path[i].x * scale, cy - state.path[i].y * scale);\n            }\n            ctx.stroke();\n\n            // 5. Draw Start Point\n            ctx.beginPath();\n            ctx.fillStyle = \"black\";\n            ctx.arc(cx, cy, 3, 0, Math.PI * 2);\n            ctx.fill();\n\n            // 6. Draw Current Head\n            const last = state.path[state.path.length - 1];\n            const headX = cx + last.x * scale;\n            const headY = cy - last.y * scale;\n\n            ctx.beginPath();\n            ctx.fillStyle = \"#ef4444\"; // Red\n            ctx.shadowBlur = 5;\n            ctx.shadowColor = \"rgba(239, 68, 68, 0.5)\";\n            ctx.arc(headX, headY, 5, 0, Math.PI * 2);\n            ctx.fill();\n            ctx.shadowBlur = 0;\n\n            // 7. Update Distance Text\n            const dist = Math.sqrt(last.x**2 + last.y**2);\n            ui.statCurrDist.textContent = dist.toFixed(2);\n        }\n    }\n\n    init();\n});"}}
{"input": {"input_text": "Brownian motion mean square displacement in 1D: MSD = 2*D*t. Compute MSD given diffusion D and time t.", "simulation_name": " Brownian MSD", "domain": "Physics", "description": "Einstein relation MSD", "assumptions": ["Free diffusion"], "entities": [], "constants": [], "parameters": [{"name": "diffusion_coeff", "symbol": "D", "unit": "m^2/s", "range": [1e-14, 1e-06]}, {"name": "time", "symbol": "t", "unit": "s", "range": [0, 100000.0]}], "equations": [{"description": "MSD", "expression": "MSD = 2*D*t"}], "initial_conditions": {}, "outputs": ["MSD"], "simulation_controls": ["D", "t"], "constraints": ["D>=0", "t>=0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Brownian Motion MSD Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n\n    <div class=\"layout-container\">\n        <header>\n            <h1>Brownian Motion: 1D Diffusion</h1>\n            <p class=\"subtitle\">Mean Square Displacement: MSD = 2 &middot; D &middot; t</p>\n        </header>\n\n        <div class=\"simulation-stage\">\n            <div class=\"canvas-wrapper\">\n                <canvas id=\"particleCanvas\"></canvas>\n                <div class=\"axis-label\">Position (x)</div>\n                <div class=\"center-marker\">x = 0</div>\n            </div>\n            \n            <div class=\"metrics-overlay\">\n                <div class=\"metric\">\n                    <span class=\"label\">Time (t)</span>\n                    <span class=\"value\" id=\"disp-time\">0.00 s</span>\n                </div>\n                <div class=\"metric\">\n                    <span class=\"label\">Theoretical MSD (2Dt)</span>\n                    <span class=\"value\" id=\"disp-theo\">0.00</span>\n                </div>\n                <div class=\"metric highlight\">\n                    <span class=\"label\">Measured MSD (&lang;x²&rang;)</span>\n                    <span class=\"value\" id=\"disp-measured\">0.00</span>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"dashboard\">\n            <div class=\"controls\">\n                <h3>Simulation Parameters</h3>\n                \n                <div class=\"control-group\">\n                    <label>\n                        Diffusion Coefficient (D)\n                        <span class=\"val-display\" id=\"val-d\"></span>\n                    </label>\n                    <input type=\"range\" id=\"input-d\" min=\"1\" max=\"50\" step=\"1\" value=\"10\">\n                    <div class=\"range-labels\">\n                        <span>Slow</span>\n                        <span>Fast</span>\n                    </div>\n                </div>\n\n                <div class=\"control-group\">\n                    <button id=\"btn-reset\" class=\"btn\">Reset Simulation</button>\n                    <button id=\"btn-pause\" class=\"btn secondary\">Pause</button>\n                </div>\n            </div>\n\n            <div class=\"calculator\">\n                <h3>Quick Calculator</h3>\n                <p>Calculate specific MSD for a given time without waiting.</p>\n                <div class=\"calc-row\">\n                    <label>Time (t):</label>\n                    <input type=\"number\" id=\"calc-t\" value=\"10\">\n                </div>\n                <div class=\"calc-result\">\n                    Resulting MSD = <span id=\"calc-res\">0</span>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-color: #0f172a;\n    --card-bg: #1e293b;\n    --text-primary: #f8fafc;\n    --text-secondary: #94a3b8;\n    --accent: #38bdf8;\n    --accent-glow: rgba(56, 189, 248, 0.3);\n    --particle-color: #fbbf24;\n}\n\nbody {\n    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-primary);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n    min-height: 100vh;\n}\n\n.layout-container {\n    max-width: 900px;\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\nheader {\n    text-align: center;\n}\n\nh1 { margin: 0; font-weight: 300; letter-spacing: 1px; }\n.subtitle { color: var(--text-secondary); margin-top: 5px; font-family: 'Courier New', monospace; }\n\n/* Simulation Stage */\n.simulation-stage {\n    background-color: var(--card-bg);\n    border-radius: 12px;\n    padding: 2px; /* Border look */\n    box-shadow: 0 10px 30px rgba(0,0,0,0.5);\n    overflow: hidden;\n    position: relative;\n}\n\n.canvas-wrapper {\n    position: relative;\n    height: 300px;\n    background: radial-gradient(circle at center, #253349 0%, #1e293b 70%);\n}\n\ncanvas {\n    display: block;\n    width: 100%;\n    height: 100%;\n}\n\n.center-marker {\n    position: absolute;\n    top: 10px;\n    left: 50%;\n    transform: translateX(-50%);\n    font-size: 0.8rem;\n    color: rgba(255,255,255,0.3);\n    border-left: 1px dashed rgba(255,255,255,0.2);\n    height: 100%;\n    padding-left: 5px;\n    pointer-events: none;\n}\n\n.axis-label {\n    position: absolute;\n    bottom: 10px;\n    width: 100%;\n    text-align: center;\n    font-size: 0.8rem;\n    color: var(--text-secondary);\n}\n\n/* Metrics Overlay */\n.metrics-overlay {\n    display: flex;\n    justify-content: space-around;\n    background-color: rgba(15, 23, 42, 0.9);\n    padding: 15px;\n    border-top: 1px solid #334155;\n}\n\n.metric {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n}\n\n.metric .label {\n    font-size: 0.75rem;\n    text-transform: uppercase;\n    color: var(--text-secondary);\n    margin-bottom: 4px;\n}\n\n.metric .value {\n    font-family: 'Courier New', monospace;\n    font-size: 1.2rem;\n    font-weight: bold;\n}\n\n.metric.highlight .value {\n    color: var(--particle-color);\n    text-shadow: 0 0 10px rgba(251, 191, 36, 0.4);\n}\n\n/* Dashboard */\n.dashboard {\n    display: grid;\n    grid-template-columns: 2fr 1fr;\n    gap: 20px;\n}\n\n.controls, .calculator {\n    background-color: var(--card-bg);\n    padding: 20px;\n    border-radius: 12px;\n}\n\nh3 {\n    margin-top: 0;\n    border-bottom: 1px solid #334155;\n    padding-bottom: 10px;\n    color: var(--accent);\n}\n\n.control-group {\n    margin-bottom: 20px;\n}\n\nlabel {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 10px;\n    font-weight: 500;\n}\n\n.val-display {\n    color: var(--accent);\n    font-family: monospace;\n}\n\ninput[type=range] {\n    width: 100%;\n    accent-color: var(--accent);\n    cursor: pointer;\n}\n\n.range-labels {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.8rem;\n    color: var(--text-secondary);\n    margin-top: 5px;\n}\n\n/* Buttons */\n.btn {\n    background-color: var(--accent);\n    color: #0f172a;\n    border: none;\n    padding: 10px 20px;\n    border-radius: 6px;\n    font-weight: bold;\n    cursor: pointer;\n    transition: background 0.2s;\n    width: 48%;\n}\n\n.btn:hover { background-color: #bae6fd; }\n\n.btn.secondary {\n    background-color: #334155;\n    color: white;\n}\n.btn.secondary:hover { background-color: #475569; }\n\n/* Calculator */\n.calc-row {\n    margin-bottom: 15px;\n}\n.calc-row input {\n    background: #0f172a;\n    border: 1px solid #334155;\n    color: white;\n    padding: 8px;\n    border-radius: 4px;\n    width: 100px;\n}\n.calc-result {\n    font-weight: bold;\n    color: var(--particle-color);\n}\n\n@media (max-width: 700px) {\n    .dashboard { grid-template-columns: 1fr; }\n}", "js": "document.addEventListener('DOMContentLoaded', () => {\n    // Canvas Setup\n    const canvas = document.getElementById('particleCanvas');\n    const ctx = canvas.getContext('2d');\n    \n    // UI Elements\n    const dispTime = document.getElementById('disp-time');\n    const dispTheo = document.getElementById('disp-theo');\n    const dispMeasured = document.getElementById('disp-measured');\n    \n    const inputD = document.getElementById('input-d');\n    const labelD = document.getElementById('val-d');\n    const btnReset = document.getElementById('btn-reset');\n    const btnPause = document.getElementById('btn-pause');\n\n    // Calculator Elements\n    const calcT = document.getElementById('calc-t');\n    const calcRes = document.getElementById('calc-res');\n\n    // Simulation State\n    let width, height;\n    let D = parseInt(inputD.value);\n    let time = 0;\n    let isPaused = false;\n    let particles = [];\n    const NUM_PARTICLES = 200;\n    const PIXELS_PER_METER = 1; // Arbitrary scale for visualization\n\n    // --- Particle Class ---\n    class Particle {\n        constructor() {\n            this.reset();\n        }\n\n        reset() {\n            this.x = 0; // Start at center\n            // Random y for visual separation (cloud effect)\n            this.y = (Math.random() - 0.5) * (height * 0.6); \n            this.color = `rgba(251, 191, 36, ${0.4 + Math.random() * 0.6})`;\n        }\n\n        update(dt) {\n            // Random Walk Step: sqrt(2 * D * dt) * NormalDistribution\n            // Standard Normal approx using Box-Muller or simple sum\n            const u1 = Math.random();\n            const u2 = Math.random();\n            const z = Math.sqrt(-2.0 * Math.log(u1)) * Math.cos(2.0 * Math.PI * u2);\n            \n            // Step size\n            const step = Math.sqrt(2 * D * dt) * z;\n            \n            this.x += step;\n        }\n\n        draw(ctx, centerX, centerY) {\n            ctx.fillStyle = this.color;\n            ctx.beginPath();\n            // Draw circle\n            ctx.arc(centerX + this.x, centerY + this.y, 3, 0, Math.PI * 2);\n            ctx.fill();\n        }\n    }\n\n    // --- Core Functions ---\n\n    function resize() {\n        const rect = canvas.parentElement.getBoundingClientRect();\n        width = rect.width;\n        height = rect.height;\n        canvas.width = width;\n        canvas.height = height;\n    }\n\n    function initParticles() {\n        particles = [];\n        for (let i = 0; i < NUM_PARTICLES; i++) {\n            particles.push(new Particle());\n        }\n    }\n\n    function resetSimulation() {\n        time = 0;\n        initParticles();\n    }\n\n    // --- Main Loop ---\n    let lastFrameTime = performance.now();\n\n    function loop(now) {\n        const dtMs = now - lastFrameTime;\n        lastFrameTime = now;\n        \n        // Limit dt to avoid huge jumps if tab inactive\n        const dt = Math.min(dtMs / 1000, 0.1); \n\n        if (!isPaused) {\n            time += dt;\n\n            // 1. Clear Canvas\n            ctx.clearRect(0, 0, width, height);\n\n            // 2. Draw Center Line\n            const centerX = width / 2;\n            const centerY = height / 2;\n\n            // 3. Update & Draw Particles\n            let sumSqDisp = 0;\n\n            particles.forEach(p => {\n                p.update(dt);\n                p.draw(ctx, centerX, centerY);\n                sumSqDisp += (p.x * p.x);\n            });\n\n            // 4. Calculate Stats\n            const measuredMSD = sumSqDisp / NUM_PARTICLES;\n            const theoreticalMSD = 2 * D * time;\n\n            // 5. Update UI\n            dispTime.textContent = time.toFixed(2) + ' s';\n            dispTheo.textContent = theoreticalMSD.toFixed(1);\n            dispMeasured.textContent = measuredMSD.toFixed(1);\n            \n            // Draw Bell Curve Approximation (Optional visual flair)\n            drawGaussian(ctx, centerX, centerY, theoreticalMSD);\n        }\n\n        requestAnimationFrame(loop);\n    }\n\n    function drawGaussian(ctx, cx, cy, variance) {\n        if (variance < 1) return;\n        \n        ctx.beginPath();\n        const sigma = Math.sqrt(variance);\n        const scaleY = 5000 / sigma; // Scale height based on spread\n        \n        ctx.strokeStyle = 'rgba(56, 189, 248, 0.5)';\n        ctx.lineWidth = 2;\n\n        for (let xPixel = -width/2; xPixel < width/2; xPixel+=5) {\n            // Gaussian formula: exp(-x^2 / (2*sigma^2))\n            const yVal = Math.exp(-(xPixel*xPixel) / (2 * variance));\n            // Invert Y because canvas Y goes down\n            ctx.lineTo(cx + xPixel, (cy + height/2) - (yVal * scaleY) - 10);\n        }\n        ctx.stroke();\n    }\n\n    // --- Input Handlers ---\n\n    // Calculator Logic\n    function updateCalculator() {\n        const t = parseFloat(calcT.value) || 0;\n        const currentD = parseFloat(inputD.value);\n        const res = 2 * currentD * t;\n        calcRes.textContent = res.toFixed(2);\n    }\n\n    inputD.addEventListener('input', (e) => {\n        D = parseInt(e.target.value);\n        labelD.textContent = D;\n        updateCalculator();\n    });\n\n    calcT.addEventListener('input', updateCalculator);\n\n    btnReset.addEventListener('click', resetSimulation);\n    \n    btnPause.addEventListener('click', () => {\n        isPaused = !isPaused;\n        btnPause.textContent = isPaused ? \"Resume\" : \"Pause\";\n        if (!isPaused) lastFrameTime = performance.now();\n    });\n\n    window.addEventListener('resize', resize);\n\n    // --- Init ---\n    resize();\n    labelD.textContent = D;\n    updateCalculator();\n    initParticles();\n    requestAnimationFrame(loop);\n});"}}
{"input": {"input_text": "Monte Carlo estimation of pi using N random points in unit square. Expected error ~ 1/sqrt(N).", "simulation_name": " Monte Carlo Pi", "domain": "Statistics", "description": "Pi via area ratio", "assumptions": ["IID uniform points"], "entities": [], "constants": [], "parameters": [{"name": "samples", "symbol": "N", "unit": "count", "range": [10, 100000000.0]}], "equations": [{"description": "Estimator", "expression": "pi_hat = 4*(points_inside_circle/N)"}, {"description": "Std error", "expression": "error ~ 1/sqrt(N)"}], "initial_conditions": {}, "outputs": ["pi_hat", "error"], "simulation_controls": ["N"], "constraints": ["N>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S86 Monte Carlo Pi Estimation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"main-wrapper\">\n    <header>\n        <h1>Monte Carlo Estimation of $\\pi$</h1>\n        <p>Approximating $\\pi$ by throwing random \"darts\" at a square.</p>\n    </header>\n\n    <div class=\"dashboard\">\n        \n        <div class=\"panel controls\">\n            <h3>Simulation Control</h3>\n            \n            <div class=\"control-group\">\n                <div class=\"label-row\">\n                    <label>Total Samples ($N$)</label>\n                    <span id=\"val-N\" class=\"val\">10000</span>\n                </div>\n                <input type=\"range\" id=\"in-N\" min=\"100\" max=\"100000\" step=\"100\" value=\"10000\">\n                <div class=\"hint\">More samples = Higher accuracy (Error $\\propto \\frac{1}{\\sqrt{N}}$)</div>\n            </div>\n\n            <div class=\"button-row\">\n                <button id=\"btn-start\" class=\"btn primary\">Run Simulation</button>\n                <button id=\"btn-reset\" class=\"btn secondary\">Reset</button>\n            </div>\n\n            <hr>\n\n            <div class=\"stats-box\">\n                <div class=\"stat-item big\">\n                    <label>Estimated $\\hat{\\pi}$</label>\n                    <div id=\"out-pi\" class=\"highlight\">0.00000</div>\n                </div>\n                \n                <div class=\"stat-grid\">\n                    <div class=\"stat-item\">\n                        <label>Points Inside</label>\n                        <span id=\"out-inside\">0</span>\n                    </div>\n                    <div class=\"stat-item\">\n                        <label>Points Total</label>\n                        <span id=\"out-total\">0</span>\n                    </div>\n                    <div class=\"stat-item\">\n                        <label>Absolute Error</label>\n                        <span id=\"out-error\">0.00000</span>\n                    </div>\n                    <div class=\"stat-item\">\n                        <label>Real $\\pi$</label>\n                        <span>3.14159...</span>\n                    </div>\n                </div>\n\n                <div class=\"formula-block\">\n                    $$\\hat{\\pi} = 4 \\times \\frac{N_{inside}}{N_{total}}$$\n                </div>\n            </div>\n        </div>\n\n        <div class=\"vis-column\">\n            \n            <div class=\"panel visual-panel\">\n                <h3>1. The Geometry</h3>\n                <div class=\"canvas-wrapper square-wrap\">\n                    <canvas id=\"boardCanvas\"></canvas>\n                </div>\n                <div class=\"legend\">\n                    <span class=\"dot in\"></span> Inside ($x^2 + y^2 \\le 1$)\n                    <span class=\"dot out\"></span> Outside\n                </div>\n            </div>\n\n            <div class=\"panel visual-panel\">\n                <h3>2. Convergence (Accuracy vs $N$)</h3>\n                <div class=\"canvas-wrapper graph-wrap\">\n                    <canvas id=\"graphCanvas\"></canvas>\n                </div>\n                <div class=\"legend\">\n                    <span class=\"line est\"></span> Estimate\n                    <span class=\"line real\"></span> Actual $\\pi$\n                </div>\n            </div>\n\n        </div>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-app: #f8fafc;\n    --bg-panel: #ffffff;\n    --text-main: #334155;\n    --text-muted: #64748b;\n    --primary: #3b82f6;\n    --color-in: #10b981;  /* Green for success/inside */\n    --color-out: #ef4444; /* Red for fail/outside */\n    --border: #e2e8f0;\n}\n\nbody {\n    font-family: 'Segoe UI', system-ui, sans-serif;\n    background: var(--bg-app);\n    color: var(--text-main);\n    margin: 0;\n    padding: 20px;\n    height: 100vh;\n    box-sizing: border-box;\n}\n\n.main-wrapper {\n    max-width: 1200px;\n    margin: 0 auto;\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n}\n\nheader {\n    margin-bottom: 20px;\n    flex-shrink: 0;\n}\n\nheader h1 { margin: 0; color: #1e293b; }\nheader p { margin: 5px 0 0; color: var(--text-muted); }\n\n.dashboard {\n    display: grid;\n    grid-template-columns: 320px 1fr;\n    gap: 20px;\n    flex: 1;\n    min-height: 0; /* Important for grid scrolling */\n}\n\n/* Panels */\n.panel {\n    background: var(--bg-panel);\n    border: 1px solid var(--border);\n    border-radius: 12px;\n    padding: 20px;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n}\n\nh3 {\n    margin-top: 0;\n    border-bottom: 1px solid var(--border);\n    padding-bottom: 10px;\n    color: #475569;\n}\n\n/* Controls */\n.controls {\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n}\n\n.label-row {\n    display: flex;\n    justify-content: space-between;\n    font-weight: 600;\n    margin-bottom: 5px;\n}\n\n.val { color: var(--primary); font-family: monospace; }\n.hint { font-size: 0.8em; color: var(--text-muted); margin-top: 4px; }\ninput[type=range] { width: 100%; cursor: pointer; }\n\n.button-row { display: flex; gap: 10px; margin-top: 10px; }\n\n.btn {\n    flex: 1;\n    padding: 10px;\n    border: none;\n    border-radius: 6px;\n    cursor: pointer;\n    font-weight: 600;\n    transition: background 0.2s;\n}\n\n.btn.primary { background: var(--primary); color: white; }\n.btn.primary:hover { background: #2563eb; }\n.btn.secondary { background: #e2e8f0; color: var(--text-muted); }\n.btn.secondary:hover { background: #cbd5e1; }\n\n/* Stats */\n.stats-box {\n    background: #f1f5f9;\n    padding: 15px;\n    border-radius: 8px;\n    margin-top: auto;\n}\n\n.stat-item { margin-bottom: 10px; }\n.stat-item label { display: block; font-size: 0.85em; color: var(--text-muted); }\n.stat-item span { font-weight: 600; font-family: monospace; }\n\n.stat-item.big { text-align: center; margin-bottom: 20px; }\n.stat-item.big .highlight {\n    font-size: 2.5em;\n    font-weight: 800;\n    color: var(--primary);\n}\n\n.stat-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 10px;\n}\n\n.formula-block { \n    text-align: center; \n    margin-top: 15px; \n    font-size: 0.9em;\n    padding-top: 10px;\n    border-top: 1px solid #cbd5e1;\n}\n\n/* Visualization Column */\n.vis-column {\n    display: grid;\n    grid-template-rows: 2fr 1fr;\n    gap: 20px;\n    min-height: 0;\n}\n\n.visual-panel {\n    display: flex;\n    flex-direction: column;\n    min-height: 0;\n}\n\n.canvas-wrapper {\n    flex: 1;\n    position: relative;\n    background: #fff;\n    border: 1px solid #e2e8f0;\n    border-radius: 6px;\n    overflow: hidden;\n}\n\n.square-wrap { background: #fafafa; }\n\ncanvas {\n    width: 100%;\n    height: 100%;\n    display: block;\n}\n\n.legend {\n    margin-top: 10px;\n    display: flex;\n    justify-content: center;\n    gap: 20px;\n    font-size: 0.9em;\n}\n\n.dot { width: 10px; height: 10px; display: inline-block; border-radius: 50%; }\n.dot.in { background: var(--color-in); }\n.dot.out { background: var(--color-out); }\n\n.line { width: 20px; height: 3px; display: inline-block; margin-bottom: 3px; }\n.line.est { background: var(--primary); }\n.line.real { background: #000; height: 2px; border-top: 1px dashed #000; background: transparent; }\n\n@media (max-width: 800px) {\n    .dashboard { grid-template-columns: 1fr; }\n    .vis-column { min-height: 600px; }\n}", "js": "document.addEventListener(\"DOMContentLoaded\", () => {\n    // --- Configuration ---\n    const ui = {\n        N: document.getElementById('in-N'),\n        valN: document.getElementById('val-N'),\n        btnStart: document.getElementById('btn-start'),\n        btnReset: document.getElementById('btn-reset'),\n        outPi: document.getElementById('out-pi'),\n        outIn: document.getElementById('out-inside'),\n        outTot: document.getElementById('out-total'),\n        outErr: document.getElementById('out-error'),\n        boardCanvas: document.getElementById('boardCanvas'),\n        graphCanvas: document.getElementById('graphCanvas')\n    };\n\n    const ctxBoard = ui.boardCanvas.getContext('2d');\n    const ctxGraph = ui.graphCanvas.getContext('2d');\n\n    // Simulation State\n    let state = {\n        targetN: 10000,\n        currentN: 0,\n        insideCount: 0,\n        isRunning: false,\n        history: [], // For graph: [{n, pi}]\n        animId: null\n    };\n\n    // --- Initialization ---\n    function init() {\n        resizeCanvases();\n        window.addEventListener('resize', resizeCanvases);\n\n        ui.N.addEventListener('input', (e) => {\n            state.targetN = parseInt(e.target.value);\n            ui.valN.textContent = state.targetN;\n        });\n\n        ui.btnStart.addEventListener('click', toggleSim);\n        ui.btnReset.addEventListener('click', resetSim);\n\n        drawBoardBackground();\n        drawGraph();\n    }\n\n    function resizeCanvases() {\n        // Handle High DPI scaling\n        [ui.boardCanvas, ui.graphCanvas].forEach(cvs => {\n            const rect = cvs.parentElement.getBoundingClientRect();\n            cvs.width = rect.width;\n            cvs.height = rect.height;\n        });\n        \n        // Redraw static elements if paused\n        if (!state.isRunning) {\n            drawBoardBackground(); // This clears dots if we resize, simpler than repainting\n            drawGraph();\n            if(state.currentN > 0) resetSim(); // Force reset on resize to keep visuals clean\n        }\n    }\n\n    // --- Logic ---\n\n    function toggleSim() {\n        if (state.isRunning) {\n            state.isRunning = false;\n            cancelAnimationFrame(state.animId);\n            ui.btnStart.textContent = \"Resume\";\n        } else {\n            if (state.currentN >= state.targetN) resetSim();\n            state.isRunning = true;\n            ui.btnStart.textContent = \"Pause\";\n            ui.btnStart.classList.replace('primary', 'secondary');\n            loop();\n        }\n    }\n\n    function resetSim() {\n        state.isRunning = false;\n        state.currentN = 0;\n        state.insideCount = 0;\n        state.history = [];\n        cancelAnimationFrame(state.animId);\n        \n        ui.btnStart.textContent = \"Run Simulation\";\n        ui.btnStart.classList.replace('secondary', 'primary');\n        \n        updateStats(0, 0);\n        drawBoardBackground(); // Clears board\n        drawGraph();\n    }\n\n    function loop() {\n        if (!state.isRunning) return;\n\n        const width = ui.boardCanvas.width;\n        const height = ui.boardCanvas.height;\n        const centerX = width / 2;\n        const centerY = height / 2;\n        const radius = Math.min(width, height) / 2 - 10; // Margin\n\n        // Determine batch size (speed)\n        // We want the whole sim to take about 2-3 seconds regardless of N\n        // But capped at min/max speeds\n        const remaining = state.targetN - state.currentN;\n        let batchSize = Math.ceil(state.targetN / 120); \n        batchSize = Math.min(batchSize, remaining);\n\n        // Process Batch\n        for (let i = 0; i < batchSize; i++) {\n            // Generate Random Point in Unit Square [-1, 1]\n            const x = (Math.random() * 2) - 1; \n            const y = (Math.random() * 2) - 1;\n            \n            // Check distance from origin\n            const distSq = x*x + y*y;\n            const isInside = distSq <= 1;\n\n            if (isInside) state.insideCount++;\n            state.currentN++;\n\n            // Draw Point immediately\n            // Map [-1, 1] to Canvas Coordinates\n            const drawX = centerX + (x * radius);\n            const drawY = centerY - (y * radius); // Flip Y for canvas\n\n            ctxBoard.fillStyle = isInside ? '#10b981' : '#ef4444';\n            ctxBoard.fillRect(drawX, drawY, 2, 2); // 2x2 pixel dot\n        }\n\n        // Calculate Pi\n        const piHat = 4 * (state.insideCount / state.currentN);\n        \n        // Record history for graph (throttle to save memory/drawing)\n        if (state.currentN % Math.ceil(state.targetN / 200) === 0 || state.currentN === state.targetN) {\n            state.history.push({ n: state.currentN, val: piHat });\n        }\n\n        updateStats(piHat, state.currentN);\n        drawGraph();\n\n        // Check End Condition\n        if (state.currentN >= state.targetN) {\n            state.isRunning = false;\n            ui.btnStart.textContent = \"Finished\";\n            ui.btnStart.classList.replace('secondary', 'primary');\n        } else {\n            state.animId = requestAnimationFrame(loop);\n        }\n    }\n\n    function updateStats(pi, n) {\n        ui.outIn.textContent = state.insideCount.toLocaleString();\n        ui.outTot.textContent = n.toLocaleString();\n        ui.outPi.textContent = pi.toFixed(5);\n        ui.outErr.textContent = Math.abs(Math.PI - pi).toFixed(5);\n    }\n\n    // --- Visualization ---\n\n    function drawBoardBackground() {\n        const w = ui.boardCanvas.width;\n        const h = ui.boardCanvas.height;\n        const cx = w / 2;\n        const cy = h / 2;\n        const r = Math.min(w, h) / 2 - 10;\n\n        ctxBoard.clearRect(0, 0, w, h);\n\n        // Draw Square Boundary\n        ctxBoard.strokeStyle = '#cbd5e1';\n        ctxBoard.lineWidth = 2;\n        ctxBoard.strokeRect(cx - r, cy - r, r*2, r*2);\n\n        // Draw Circle Boundary\n        ctxBoard.beginPath();\n        ctxBoard.arc(cx, cy, r, 0, Math.PI * 2);\n        ctxBoard.strokeStyle = '#3b82f6';\n        ctxBoard.stroke();\n    }\n\n    function drawGraph() {\n        const ctx = ctxGraph;\n        const w = ui.graphCanvas.width;\n        const h = ui.graphCanvas.height;\n        \n        ctx.clearRect(0, 0, w, h);\n        \n        // Margins\n        const pad = {l: 40, r: 10, t: 10, b: 20};\n        const gw = w - pad.l - pad.r;\n        const gh = h - pad.t - pad.b;\n\n        // Draw Real Pi Line (Reference)\n        const piY = gh - ((Math.PI - 2) / 2) * gh + pad.t; // Mapping 2.0 to 4.0 range\n        \n        // Helper: Map Y (Value 2.0 to 4.0)\n        const mapY = (val) => {\n             // Clamp range visually between 2.5 and 3.5 usually covers it, \n             // but let's do 2.0 to 4.0 to be safe\n             const minV = 2.5; \n             const maxV = 3.8;\n             const norm = (val - minV) / (maxV - minV);\n             return (h - pad.b) - (norm * gh);\n        };\n        \n        const mapX = (n) => pad.l + (n / state.targetN) * gw;\n\n        // Draw Reference Line (PI)\n        ctx.beginPath();\n        ctx.strokeStyle = '#94a3b8';\n        ctx.setLineDash([5, 5]);\n        const yRef = mapY(Math.PI);\n        ctx.moveTo(pad.l, yRef);\n        ctx.lineTo(w - pad.r, yRef);\n        ctx.stroke();\n        ctx.setLineDash([]);\n        \n        // Label PI\n        ctx.fillStyle = '#64748b';\n        ctx.font = '10px sans-serif';\n        ctx.fillText(\"π (3.14159)\", pad.l + 5, yRef - 5);\n\n        // Draw History Line\n        if (state.history.length > 1) {\n            ctx.beginPath();\n            ctx.strokeStyle = '#3b82f6';\n            ctx.lineWidth = 2;\n            \n            state.history.forEach((pt, i) => {\n                const x = mapX(pt.n);\n                // Clamp Y to stay in graph\n                let val = Math.max(2.5, Math.min(3.8, pt.val));\n                const y = mapY(val);\n                \n                if (i===0) ctx.moveTo(x, y);\n                else ctx.lineTo(x, y);\n            });\n            ctx.stroke();\n        }\n    }\n\n    init();\n});"}}
{"input": {"input_text": "Law of large numbers illustration: sample mean of IID with mean mu converges to mu as N increases. Provide variance of mean sigma2/N.", "simulation_name": " LLN Mean Variance", "domain": "Statistics", "description": "Sample mean variance scaling", "assumptions": ["IID finite variance"], "entities": [], "constants": [], "parameters": [{"name": "variance", "symbol": "sigma2", "unit": "units^2", "range": [0, 1000000.0]}, {"name": "samples", "symbol": "N", "unit": "count", "range": [1, 100000000.0]}], "equations": [{"description": "Var of mean", "expression": "Var_mean = sigma2/N"}], "initial_conditions": {}, "outputs": ["Var_mean"], "simulation_controls": ["sigma2", "N"], "constraints": ["N>0", "sigma2>=0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Law of Large Numbers Simulator</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n\n    <div class=\"layout-wrapper\">\n        <header>\n            <h1>Law of Large Numbers</h1>\n            <p class=\"subtitle\">Convergence of Sample Mean to Population Mean</p>\n        </header>\n\n        <div class=\"viz-card\">\n            <div class=\"canvas-container\">\n                <canvas id=\"llnCanvas\"></canvas>\n                <div class=\"graph-label y-axis\">Value</div>\n                <div class=\"graph-label x-axis\">Number of Samples (N)</div>\n            </div>\n            \n            <div class=\"legend\">\n                <span class=\"legend-item\"><span class=\"line theory\"></span> Theoretical Bounds (&pm;2&sigma;/&radic;N)</span>\n                <span class=\"legend-item\"><span class=\"line mean\"></span> Running Sample Mean</span>\n                <span class=\"legend-item\"><span class=\"line target\"></span> True Mean (&mu;=0)</span>\n            </div>\n        </div>\n\n        <div class=\"dashboard\">\n            \n            <div class=\"controls-panel\">\n                <h3>Population Parameters</h3>\n                \n                <div class=\"control-group\">\n                    <label>\n                        Population Variance (&sigma;<sup>2</sup>): <span id=\"val-sigma2\">1.0</span>\n                    </label>\n                    <input type=\"range\" id=\"input-sigma2\" min=\"0.1\" max=\"5.0\" step=\"0.1\" value=\"1.0\">\n                </div>\n\n                <div class=\"control-group\">\n                    <label>\n                        Simulation Speed\n                    </label>\n                    <div class=\"speed-controls\">\n                        <button class=\"btn-speed active\" data-speed=\"1\">1x</button>\n                        <button class=\"btn-speed\" data-speed=\"5\">5x</button>\n                        <button class=\"btn-speed\" data-speed=\"20\">Max</button>\n                    </div>\n                </div>\n\n                <button id=\"btn-restart\" class=\"btn-primary\">Restart Simulation</button>\n            </div>\n\n            <div class=\"stats-panel\">\n                <h3>Current Statistics (N = <span id=\"disp-n\">0</span>)</h3>\n                \n                <div class=\"stat-row\">\n                    <div class=\"stat-box\">\n                        <span class=\"stat-label\">Theoretical Variance of Mean</span>\n                        <span class=\"stat-formula\">&sigma;<sup>2</sup> / N</span>\n                        <span class=\"stat-value\" id=\"disp-theo-var\">--</span>\n                    </div>\n                    \n                    <div class=\"stat-box highlight\">\n                        <span class=\"stat-label\">Current Sample Mean</span>\n                        <span class=\"stat-formula\">&mu; &approx; 0</span>\n                        <span class=\"stat-value\" id=\"disp-mean\">--</span>\n                    </div>\n                </div>\n                \n                <div class=\"stat-note\">\n                    Note how the \"Variance of the Mean\" shrinks as N grows, pulling the sample mean tighter to the center.\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-color: #f3f4f6;\n    --card-bg: #ffffff;\n    --primary: #2563eb;\n    --accent: #f59e0b;\n    --text-dark: #1f2937;\n    --text-light: #6b7280;\n    --graph-bg: #111827;\n}\n\nbody {\n    font-family: 'Inter', system-ui, -apple-system, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-dark);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n}\n\n.layout-wrapper {\n    max-width: 1000px;\n    width: 100%;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 25px;\n}\n\nh1 { margin: 0; color: #111827; }\n.subtitle { color: var(--text-light); margin-top: 5px; }\n\n/* Visualization Card */\n.viz-card {\n    background: var(--card-bg);\n    padding: 15px;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n    margin-bottom: 20px;\n}\n\n.canvas-container {\n    position: relative;\n    height: 350px;\n    background-color: var(--graph-bg);\n    border-radius: 8px;\n    overflow: hidden;\n}\n\ncanvas {\n    display: block;\n    width: 100%;\n    height: 100%;\n}\n\n.graph-label {\n    position: absolute;\n    color: #6b7280;\n    font-size: 0.75rem;\n    text-transform: uppercase;\n}\n.y-axis { top: 10px; left: 10px; }\n.x-axis { bottom: 10px; right: 10px; }\n\n.legend {\n    display: flex;\n    justify-content: center;\n    gap: 20px;\n    margin-top: 15px;\n    flex-wrap: wrap;\n}\n\n.legend-item {\n    font-size: 0.9rem;\n    color: var(--text-dark);\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n.line { width: 20px; height: 3px; display: inline-block; border-radius: 2px; }\n.line.theory { background-color: rgba(59, 130, 246, 0.4); height: 12px; } /* Block for area */\n.line.mean { background-color: #fbbf24; }\n.line.target { background-color: #fff; border: 1px dashed #666; height: 1px; }\n\n/* Dashboard */\n.dashboard {\n    display: grid;\n    grid-template-columns: 1fr 1.2fr;\n    gap: 20px;\n}\n\n.controls-panel, .stats-panel {\n    background: var(--card-bg);\n    padding: 20px;\n    border-radius: 12px;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n}\n\nh3 {\n    margin-top: 0;\n    border-bottom: 1px solid #e5e7eb;\n    padding-bottom: 10px;\n    font-size: 1.1rem;\n    color: var(--text-dark);\n}\n\n/* Controls */\n.control-group { margin-bottom: 20px; }\n\nlabel {\n    display: flex;\n    justify-content: space-between;\n    font-weight: 600;\n    margin-bottom: 8px;\n    font-size: 0.9rem;\n}\n\ninput[type=range] {\n    width: 100%;\n    cursor: pointer;\n    accent-color: var(--primary);\n}\n\n.speed-controls {\n    display: flex;\n    gap: 5px;\n}\n\n.btn-speed {\n    flex: 1;\n    padding: 6px;\n    border: 1px solid #d1d5db;\n    background: white;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 0.85rem;\n}\n.btn-speed.active {\n    background: var(--primary);\n    color: white;\n    border-color: var(--primary);\n}\n\n.btn-primary {\n    width: 100%;\n    padding: 10px;\n    background-color: var(--primary);\n    color: white;\n    border: none;\n    border-radius: 6px;\n    font-weight: bold;\n    cursor: pointer;\n    transition: background 0.2s;\n}\n.btn-primary:hover { background-color: #1d4ed8; }\n\n/* Stats */\n.stat-row {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 15px;\n}\n\n.stat-box {\n    background: #f9fafb;\n    padding: 12px;\n    border-radius: 8px;\n    border: 1px solid #e5e7eb;\n    text-align: center;\n}\n\n.stat-box.highlight {\n    background: #eff6ff;\n    border-color: #bfdbfe;\n}\n\n.stat-label {\n    display: block;\n    font-size: 0.75rem;\n    color: var(--text-light);\n    margin-bottom: 4px;\n}\n\n.stat-formula {\n    display: block;\n    font-family: 'Times New Roman', serif;\n    font-style: italic;\n    font-size: 0.9rem;\n    color: #4b5563;\n    margin-bottom: 4px;\n}\n\n.stat-value {\n    display: block;\n    font-size: 1.25rem;\n    font-weight: 700;\n    color: var(--primary);\n    font-family: monospace;\n}\n\n.stat-note {\n    margin-top: 15px;\n    font-size: 0.85rem;\n    color: var(--text-light);\n    line-height: 1.4;\n    font-style: italic;\n}\n\n@media (max-width: 700px) {\n    .dashboard { grid-template-columns: 1fr; }\n}", "js": "document.addEventListener('DOMContentLoaded', () => {\n    // --- Canvas Setup ---\n    const canvas = document.getElementById('llnCanvas');\n    const ctx = canvas.getContext('2d');\n    let width, height;\n\n    // --- UI Elements ---\n    const inputSigma2 = document.getElementById('input-sigma2');\n    const valSigma2 = document.getElementById('val-sigma2');\n    const btnRestart = document.getElementById('btn-restart');\n    const btnsSpeed = document.querySelectorAll('.btn-speed');\n    \n    // Stats Displays\n    const dispN = document.getElementById('disp-n');\n    const dispMean = document.getElementById('disp-mean');\n    const dispTheoVar = document.getElementById('disp-theo-var');\n\n    // --- Simulation State ---\n    const MAX_N = 1000;\n    let sigma2 = parseFloat(inputSigma2.value);\n    let n = 0;\n    let runningMean = 0;\n    let sum = 0;\n    let speedMultiplier = 1;\n    let animationId;\n    let history = []; // Stores {n, mean} for drawing\n\n    // Resize handling\n    function resize() {\n        const rect = canvas.parentElement.getBoundingClientRect();\n        width = rect.width;\n        height = rect.height;\n        canvas.width = width;\n        canvas.height = height;\n        if(n > 0) draw(); // Redraw if paused/static\n    }\n    window.addEventListener('resize', resize);\n    resize();\n\n    // --- Math Helpers ---\n\n    // Box-Muller Transform for Normal Distribution\n    function randomNormal(mean, variance) {\n        let u = 0, v = 0;\n        while(u === 0) u = Math.random(); \n        while(v === 0) v = Math.random();\n        const stdDev = Math.sqrt(variance);\n        const z = Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);\n        return mean + (z * stdDev);\n    }\n\n    // --- Core Logic ---\n\n    function resetSimulation() {\n        cancelAnimationFrame(animationId);\n        n = 0;\n        sum = 0;\n        runningMean = 0;\n        history = [];\n        sigma2 = parseFloat(inputSigma2.value);\n        valSigma2.textContent = sigma2.toFixed(1);\n        \n        // Clear displays\n        dispN.textContent = '0';\n        dispMean.textContent = '--';\n        dispTheoVar.textContent = '--';\n        \n        animate();\n    }\n\n    function update() {\n        // Run loop based on speed\n        // Speed 1 = 1 step/frame, Speed 20 = 20 steps/frame\n        for(let i=0; i<speedMultiplier; i++) {\n            if (n >= MAX_N) break;\n\n            n++;\n            \n            // 1. Generate Sample\n            const sample = randomNormal(0, sigma2); // Mean = 0\n            \n            // 2. Update Stats\n            sum += sample;\n            runningMean = sum / n;\n            \n            // 3. Store History for Graphing\n            history.push(runningMean);\n        }\n    }\n\n    function draw() {\n        // 1. Clear Background\n        ctx.fillStyle = '#111827';\n        ctx.fillRect(0, 0, width, height);\n\n        // 2. Coordinate System\n        // X-axis: 0 to MAX_N\n        // Y-axis: -5 to 5 (Fixed range to show convergence)\n        const maxY = 5;\n        const scaleX = width / MAX_N;\n        const centerY = height / 2;\n        const scaleY = (height / 2) / maxY; // pixels per unit\n\n        // Helper to map Y value to pixel Y\n        const mapY = (val) => centerY - (val * scaleY);\n\n        // 3. Draw Center Line (True Mean = 0)\n        ctx.beginPath();\n        ctx.moveTo(0, centerY);\n        ctx.lineTo(width, centerY);\n        ctx.strokeStyle = '#374151'; // Dark grey\n        ctx.setLineDash([5, 5]);\n        ctx.lineWidth = 1;\n        ctx.stroke();\n        ctx.setLineDash([]);\n\n        // 4. Draw Theoretical Bounds (Funnel)\n        // Bound = +/- 2 * Standard Error\n        // SE = sigma / sqrt(n)\n        // Bound = +/- 2 * sqrt(sigma2 / n)\n        \n        ctx.beginPath();\n        ctx.moveTo(0, mapY(3)); // Start wide roughly\n        \n        // Positive Bound\n        for(let i=1; i<=MAX_N; i+=5) {\n            const se = Math.sqrt(sigma2 / i);\n            const bound = 2 * se; // 2 Sigma (95% confidence)\n            ctx.lineTo(i * scaleX, mapY(bound));\n        }\n        \n        // Negative Bound (Backwards to close shape)\n        for(let i=MAX_N; i>=1; i-=5) {\n            const se = Math.sqrt(sigma2 / i);\n            const bound = -2 * se;\n            ctx.lineTo(i * scaleX, mapY(bound));\n        }\n        \n        ctx.fillStyle = 'rgba(59, 130, 246, 0.1)'; // Very faint blue\n        ctx.fill();\n\n        // 5. Draw Running Mean (The Path)\n        if (history.length > 0) {\n            ctx.beginPath();\n            ctx.moveTo(0, centerY); // Start at 0,0\n            \n            // Optimization: Don't draw every single pixel if N is huge\n            const step = Math.max(1, Math.floor(history.length / width)); \n            \n            for(let i=0; i<history.length; i++) {\n                const x = (i+1) * scaleX;\n                const y = mapY(history[i]);\n                ctx.lineTo(x, y);\n            }\n            \n            ctx.strokeStyle = '#fbbf24'; // Amber\n            ctx.lineWidth = 2;\n            ctx.stroke();\n\n            // Draw Head Dot\n            const lastY = mapY(history[history.length-1]);\n            const lastX = history.length * scaleX;\n            ctx.beginPath();\n            ctx.arc(lastX, lastY, 4, 0, Math.PI*2);\n            ctx.fillStyle = '#fff';\n            ctx.fill();\n        }\n    }\n\n    function animate() {\n        if (n < MAX_N) {\n            update();\n            draw();\n            \n            // Update UI Text\n            dispN.textContent = n;\n            dispMean.textContent = runningMean.toFixed(4);\n            // Theoretical Variance of Mean = sigma^2 / N\n            const varMean = sigma2 / n;\n            dispTheoVar.textContent = varMean.toFixed(4);\n\n            animationId = requestAnimationFrame(animate);\n        }\n    }\n\n    // --- Event Listeners ---\n    \n    inputSigma2.addEventListener('input', () => {\n        resetSimulation();\n    });\n\n    btnRestart.addEventListener('click', resetSimulation);\n\n    btnsSpeed.forEach(btn => {\n        btn.addEventListener('click', () => {\n            // UI Toggle\n            btnsSpeed.forEach(b => b.classList.remove('active'));\n            btn.classList.add('active');\n            \n            // Logic\n            if(btn.dataset.speed === 'Max') {\n                speedMultiplier = 100;\n            } else {\n                speedMultiplier = parseInt(btn.dataset.speed);\n            }\n        });\n    });\n\n    // Start\n    resetSimulation();\n});"}}
{"input": {"input_text": "Black-Scholes d1,d2 for European call: d1 = (ln(S/K)+(r+0.5*sigma^2)T)/(sigma*sqrt(T)); d2 = d1 - sigma*sqrt(T).", "simulation_name": " Black Scholes d1d2", "domain": "Finance", "description": "Intermediate terms for option pricing", "assumptions": ["No dividends", "GBM"], "entities": [], "constants": [], "parameters": [{"name": "spot", "symbol": "S", "unit": "currency", "range": [0.01, 1000000.0]}, {"name": "strike", "symbol": "K", "unit": "currency", "range": [0.01, 1000000.0]}, {"name": "rate", "symbol": "r", "unit": "1/year", "range": [-0.1, 0.2]}, {"name": "volatility", "symbol": "sigma", "unit": "1/sqrt(year)", "range": [0.01, 2]}, {"name": "time_to_maturity", "symbol": "T", "unit": "year", "range": [0.0001, 50]}], "equations": [{"description": "d1", "expression": "d1 = (ln(S/K) + (r + 0.5*sigma^2)*T)/(sigma*sqrt(T))"}, {"description": "d2", "expression": "d2 = d1 - sigma*sqrt(T)"}], "initial_conditions": {}, "outputs": ["d1", "d2"], "simulation_controls": ["S", "K", "r", "sigma", "T"], "constraints": ["S>0", "K>0", "T>0", "sigma>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S88 Black-Scholes Visualizer</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"wrapper\">\n    <header>\n        <h1>Black-Scholes Interactive</h1>\n        <p>Visualizing Option Greeks and Probability Paths</p>\n    </header>\n\n    <div class=\"dashboard\">\n        <div class=\"panel controls\">\n            <h3>Parameters</h3>\n\n            <div class=\"control-group\">\n                <div class=\"label-row\">\n                    <label>Spot Price ($S$)</label>\n                    <span id=\"val-S\" class=\"val\">100</span>\n                </div>\n                <input type=\"range\" id=\"in-S\" min=\"50\" max=\"150\" step=\"1\" value=\"100\">\n            </div>\n\n            <div class=\"control-group\">\n                <div class=\"label-row\">\n                    <label>Strike Price ($K$)</label>\n                    <span id=\"val-K\" class=\"val\">100</span>\n                </div>\n                <input type=\"range\" id=\"in-K\" min=\"50\" max=\"150\" step=\"1\" value=\"100\">\n            </div>\n\n            <div class=\"control-group\">\n                <div class=\"label-row\">\n                    <label>Volatility ($\\sigma$)</label>\n                    <span id=\"val-sigma\" class=\"val\">20%</span>\n                </div>\n                <input type=\"range\" id=\"in-sigma\" min=\"0.01\" max=\"1.0\" step=\"0.01\" value=\"0.20\">\n                <div class=\"hint\">Higher volatility widens the cone of future prices.</div>\n            </div>\n\n            <div class=\"control-group\">\n                <div class=\"label-row\">\n                    <label>Risk-Free Rate ($r$)</label>\n                    <span id=\"val-r\" class=\"val\">5%</span>\n                </div>\n                <input type=\"range\" id=\"in-r\" min=\"0\" max=\"0.2\" step=\"0.01\" value=\"0.05\">\n            </div>\n\n            <div class=\"control-group\">\n                <div class=\"label-row\">\n                    <label>Time to Maturity ($T$)</label>\n                    <span id=\"val-T\" class=\"val\">1.0 Yr</span>\n                </div>\n                <input type=\"range\" id=\"in-T\" min=\"0.1\" max=\"5.0\" step=\"0.1\" value=\"1.0\">\n            </div>\n\n            <div class=\"results-grid\">\n                <div class=\"res-box\">\n                    <label>$d_1$</label>\n                    <span id=\"out-d1\" class=\"highlight\">--</span>\n                </div>\n                <div class=\"res-box\">\n                    <label>$d_2$</label>\n                    <span id=\"out-d2\" class=\"highlight\">--</span>\n                </div>\n                <div class=\"res-box full\">\n                    <label>Prob. ITM $N(d_2)$</label>\n                    <span id=\"out-Nd2\" class=\"highlight green\">--</span>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"visuals-col\">\n            \n            <div class=\"panel\">\n                <h3>1. Standard Normal Distribution</h3>\n                <div class=\"canvas-container\">\n                    <canvas id=\"bellCanvas\"></canvas>\n                </div>\n                <div class=\"legend\">\n                    <span class=\"leg-item\"><span class=\"box blue\"></span>$d_1$</span>\n                    <span class=\"leg-item\"><span class=\"box green\"></span>$d_2$</span>\n                    <span class=\"leg-item\"><span class=\"box area\"></span>ITM Probability</span>\n                </div>\n            </div>\n\n            <div class=\"panel\">\n                <h3>2. Monte Carlo Price Paths (Fixed Seed)</h3>\n                <div class=\"canvas-container\">\n                    <canvas id=\"pathCanvas\"></canvas>\n                </div>\n                <div class=\"legend\">\n                    <span class=\"leg-item\"><span class=\"line dashed\"></span>Strike ($K$)</span>\n                    <span class=\"leg-item\"><span class=\"dot g\"></span>Profit</span>\n                    <span class=\"leg-item\"><span class=\"dot r\"></span>Loss</span>\n                </div>\n            </div>\n\n        </div>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-app: #f8fafc;\n    --bg-panel: #ffffff;\n    --primary: #3b82f6;\n    --success: #10b981;\n    --danger: #ef4444;\n    --text: #1e293b;\n    --border: #e2e8f0;\n}\n\nbody {\n    font-family: 'Segoe UI', system-ui, sans-serif;\n    background: var(--bg-app);\n    color: var(--text);\n    margin: 0;\n    padding: 20px;\n    box-sizing: border-box;\n}\n\n.wrapper {\n    max-width: 1100px;\n    margin: 0 auto;\n}\n\nheader { margin-bottom: 20px; text-align: center; }\nheader h1 { margin: 0; color: #0f172a; }\nheader p { color: #64748b; margin-top: 5px; }\n\n.dashboard {\n    display: grid;\n    grid-template-columns: 320px 1fr;\n    gap: 20px;\n}\n\n.panel {\n    background: var(--bg-panel);\n    border: 1px solid var(--border);\n    border-radius: 12px;\n    padding: 20px;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n    display: flex;\n    flex-direction: column;\n}\n\nh3 {\n    margin-top: 0;\n    font-size: 1.1em;\n    border-bottom: 2px solid var(--border);\n    padding-bottom: 10px;\n    color: #334155;\n}\n\n/* Control Styling */\n.control-group { margin-bottom: 15px; }\n\n.label-row {\n    display: flex;\n    justify-content: space-between;\n    font-weight: 600;\n    font-size: 0.9em;\n    margin-bottom: 5px;\n}\n\n.val { color: var(--primary); font-family: monospace; }\n.hint { font-size: 0.75em; color: #94a3b8; margin-top: 3px; font-style: italic; }\n\ninput[type=range] { width: 100%; cursor: pointer; accent-color: var(--primary); }\n\n.results-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 10px;\n    background: #f1f5f9;\n    padding: 15px;\n    border-radius: 8px;\n    margin-top: 10px;\n}\n\n.res-box { text-align: center; }\n.res-box.full { grid-column: span 2; border-top: 1px solid #cbd5e1; padding-top: 10px; margin-top: 5px; }\n.res-box label { display: block; font-size: 0.8em; color: #64748b; }\n.highlight { font-weight: 800; font-size: 1.2em; color: #0f172a; }\n.highlight.green { color: var(--success); }\n\n/* Visuals Styling */\n.visuals-col {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.canvas-container {\n    position: relative;\n    width: 100%;\n    height: 250px; /* Explicit height is crucial for canvas */\n    background: #fff;\n    border: 1px solid #e2e8f0;\n    border-radius: 6px;\n    overflow: hidden;\n}\n\ncanvas {\n    display: block;\n    width: 100%;\n    height: 100%;\n}\n\n.legend {\n    display: flex;\n    justify-content: center;\n    gap: 15px;\n    margin-top: 10px;\n    font-size: 0.85em;\n    color: #475569;\n}\n\n.leg-item { display: flex; align-items: center; gap: 5px; }\n\n.box { width: 12px; height: 12px; border-radius: 2px; }\n.box.blue { background: var(--primary); }\n.box.green { background: var(--success); }\n.box.area { background: rgba(16, 185, 129, 0.2); border: 1px solid var(--success); }\n\n.line.dashed { width: 20px; height: 0; border-top: 2px dashed var(--danger); }\n.dot { width: 8px; height: 8px; border-radius: 50%; }\n.dot.g { background: var(--success); }\n.dot.r { background: var(--danger); }\n\n@media (max-width: 800px) {\n    .dashboard { grid-template-columns: 1fr; }\n}", "js": "document.addEventListener(\"DOMContentLoaded\", () => {\n    // --- Configuration ---\n    const ui = {\n        S: document.getElementById('in-S'),\n        K: document.getElementById('in-K'),\n        r: document.getElementById('in-r'),\n        sigma: document.getElementById('in-sigma'),\n        T: document.getElementById('in-T'),\n        \n        valS: document.getElementById('val-S'),\n        valK: document.getElementById('val-K'),\n        valR: document.getElementById('val-r'),\n        valSigma: document.getElementById('val-sigma'),\n        valT: document.getElementById('val-T'),\n\n        outD1: document.getElementById('out-d1'),\n        outD2: document.getElementById('out-d2'),\n        outNd2: document.getElementById('out-Nd2')\n    };\n\n    const cvsBell = document.getElementById('bellCanvas');\n    const cvsPath = document.getElementById('pathCanvas');\n    const ctxBell = cvsBell.getContext('2d');\n    const ctxPath = cvsPath.getContext('2d');\n\n    // Parameters State\n    let params = { S: 100, K: 100, r: 0.05, sigma: 0.2, T: 1.0 };\n    \n    // Path Simulation State (Fixed Seed)\n    const NUM_PATHS = 40;\n    const NUM_STEPS = 50;\n    // We pre-generate Z-scores (Normal Randoms) so paths \"morph\" instead of flicker\n    // This makes the slider effect much easier to understand.\n    const pathZScores = []; \n\n    function init() {\n        // Generate fixed random noise once\n        for(let i=0; i<NUM_PATHS; i++) {\n            let path = [];\n            for(let t=0; t<NUM_STEPS; t++) {\n                // Box-Muller transform for standard normal distribution\n                const u1 = Math.random();\n                const u2 = Math.random();\n                const z = Math.sqrt(-2.0 * Math.log(u1)) * Math.cos(2.0 * Math.PI * u2);\n                path.push(z);\n            }\n            pathZScores.push(path);\n        }\n\n        resize();\n        window.addEventListener('resize', resize);\n        \n        // Bind Inputs\n        ['S', 'K', 'r', 'sigma', 'T'].forEach(k => {\n            ui[k].addEventListener('input', (e) => {\n                params[k] = parseFloat(e.target.value);\n                update();\n            });\n        });\n\n        update();\n        animate();\n    }\n\n    function resize() {\n        // Handle High DPI (Retina) Displays\n        const dpr = window.devicePixelRatio || 1;\n        \n        [cvsBell, cvsPath].forEach(c => {\n            const rect = c.parentElement.getBoundingClientRect();\n            // Set actual pixel count\n            c.width = rect.width * dpr;\n            c.height = rect.height * dpr;\n            // Normalize scale\n            const ctx = c.getContext('2d');\n            ctx.scale(dpr, dpr);\n        });\n        \n        drawBell(); // Redraw immediately on resize\n    }\n\n    function update() {\n        // Update Text Labels\n        ui.valS.textContent = params.S;\n        ui.valK.textContent = params.K;\n        ui.valR.textContent = (params.r * 100).toFixed(0) + '%';\n        ui.valSigma.textContent = (params.sigma * 100).toFixed(0) + '%';\n        ui.valT.textContent = params.T + ' Yr';\n\n        // 1. Calculate Black-Scholes d1, d2\n        const numer = Math.log(params.S / params.K) + (params.r + 0.5 * params.sigma**2) * params.T;\n        const denom = params.sigma * Math.sqrt(params.T);\n        \n        const d1 = numer / denom;\n        const d2 = d1 - denom;\n\n        // 2. CDF N(d2)\n        const Nd2 = cumulativeNormal(d2);\n\n        // Update UI\n        ui.outD1.textContent = d1.toFixed(3);\n        ui.outD2.textContent = d2.toFixed(3);\n        ui.outNd2.textContent = (Nd2 * 100).toFixed(2) + '%';\n        \n        // Trigger Redraws\n        drawBell(d1, d2);\n    }\n\n    // --- Drawing Logic: Standard Normal ---\n    function drawBell(d1, d2) {\n        // Safe check if d1/d2 not calculated yet\n        if(d1 === undefined) return;\n\n        // Get layout dimensions (logical pixels)\n        const w = cvsBell.width / (window.devicePixelRatio || 1);\n        const h = cvsBell.height / (window.devicePixelRatio || 1);\n        \n        ctxBell.clearRect(0, 0, w, h);\n\n        // Coordinate Mapping: Z from -4 to 4\n        const pad = {l: 20, r: 20, t: 20, b: 30};\n        const gw = w - pad.l - pad.r;\n        const gh = h - pad.t - pad.b;\n\n        const mapX = (z) => pad.l + ((z + 4) / 8) * gw;\n        const mapY = (y) => (h - pad.b) - (y / 0.45) * gh; // Max height ~0.4\n\n        // Draw Axes\n        ctxBell.strokeStyle = '#cbd5e1';\n        ctxBell.lineWidth = 1;\n        ctxBell.beginPath();\n        ctxBell.moveTo(pad.l, h - pad.b);\n        ctxBell.lineTo(w - pad.r, h - pad.b); // X axis\n        ctxBell.stroke();\n\n        // Draw Bell Curve\n        ctxBell.beginPath();\n        ctxBell.strokeStyle = '#64748b';\n        ctxBell.lineWidth = 2;\n        for(let z = -4; z <= 4; z += 0.05) {\n            const pdf = (1 / Math.sqrt(2 * Math.PI)) * Math.exp(-0.5 * z * z);\n            const x = mapX(z);\n            const y = mapY(pdf);\n            if(z === -4) ctxBell.moveTo(x, y);\n            else ctxBell.lineTo(x, y);\n        }\n        ctxBell.stroke();\n\n        // Shade N(d2) Area\n        ctxBell.fillStyle = 'rgba(16, 185, 129, 0.2)';\n        ctxBell.beginPath();\n        ctxBell.moveTo(mapX(-4), h - pad.b);\n        for(let z = -4; z <= d2; z += 0.05) {\n             const pdf = (1 / Math.sqrt(2 * Math.PI)) * Math.exp(-0.5 * z * z);\n             ctxBell.lineTo(mapX(z), mapY(pdf));\n        }\n        // Close shape at d2\n        const pdfD2 = (1 / Math.sqrt(2 * Math.PI)) * Math.exp(-0.5 * d2 * d2);\n        ctxBell.lineTo(mapX(d2), mapY(pdfD2));\n        ctxBell.lineTo(mapX(d2), h - pad.b);\n        ctxBell.fill();\n\n        // Draw d1 Line (Blue)\n        const x1 = mapX(d1);\n        ctxBell.strokeStyle = '#3b82f6';\n        ctxBell.lineWidth = 2;\n        ctxBell.beginPath();\n        ctxBell.setLineDash([4, 2]);\n        ctxBell.moveTo(x1, h - pad.b);\n        ctxBell.lineTo(x1, pad.t);\n        ctxBell.stroke();\n        ctxBell.setLineDash([]);\n        ctxBell.fillStyle = '#3b82f6';\n        ctxBell.font = 'bold 12px sans-serif';\n        ctxBell.fillText('d1', x1 + 4, pad.t + 10);\n\n        // Draw d2 Line (Green)\n        const x2 = mapX(d2);\n        ctxBell.strokeStyle = '#10b981';\n        ctxBell.beginPath();\n        ctxBell.moveTo(x2, h - pad.b);\n        ctxBell.lineTo(x2, pad.t + 20);\n        ctxBell.stroke();\n        ctxBell.fillStyle = '#10b981';\n        ctxBell.fillText('d2', x2 - 20, pad.t + 30);\n    }\n\n    // --- Drawing Logic: Paths Animation ---\n    function drawPaths() {\n        const w = cvsPath.width / (window.devicePixelRatio || 1);\n        const h = cvsPath.height / (window.devicePixelRatio || 1);\n\n        ctxPath.clearRect(0, 0, w, h);\n\n        const pad = {l: 40, r: 10, t: 20, b: 30};\n        const gw = w - pad.l - pad.r;\n        const gh = h - pad.t - pad.b;\n\n        // Auto-Scale Y Axis: Center on Strike K, +/- 3 Sigma (approx)\n        // Volatility impacts range: Range ~ S * exp(sigma * sqrt(T) * 3)\n        // We use a looser bound to keep visuals stable-ish\n        const rangeMult = Math.exp(params.sigma * Math.sqrt(params.T) * 2.5);\n        const maxP = params.S * rangeMult;\n        const minP = params.S / rangeMult;\n        \n        const mapX = (step) => pad.l + (step / NUM_STEPS) * gw;\n        const mapY = (price) => (h - pad.b) - ((price - minP) / (maxP - minP)) * gh;\n\n        // Draw Strike Line\n        const yK = mapY(params.K);\n        ctxPath.beginPath();\n        ctxPath.strokeStyle = '#ef4444';\n        ctxPath.setLineDash([5, 5]);\n        ctxPath.moveTo(pad.l, yK);\n        ctxPath.lineTo(w - pad.r, yK);\n        ctxPath.stroke();\n        ctxPath.setLineDash([]);\n\n        // Draw Paths\n        const dt = params.T / NUM_STEPS;\n        const drift = (params.r - 0.5 * params.sigma**2) * dt;\n        const vol = params.sigma * Math.sqrt(dt);\n\n        pathZScores.forEach((zPath) => {\n            let S = params.S;\n            \n            ctxPath.beginPath();\n            ctxPath.moveTo(mapX(0), mapY(S));\n\n            for(let t=0; t<NUM_STEPS; t++) {\n                // S_t = S_{t-1} * exp(drift + vol * Z)\n                S = S * Math.exp(drift + vol * zPath[t]);\n                ctxPath.lineTo(mapX(t+1), mapY(S));\n            }\n\n            // Color based on expiry\n            if(S > params.K) ctxPath.strokeStyle = 'rgba(16, 185, 129, 0.4)'; // Green\n            else ctxPath.strokeStyle = 'rgba(239, 68, 68, 0.2)'; // Red\n            \n            ctxPath.lineWidth = 1;\n            ctxPath.stroke();\n        });\n    }\n\n    function animate() {\n        drawPaths();\n        requestAnimationFrame(animate);\n    }\n\n    // Helper: Standard Normal CDF\n    function cumulativeNormal(x) {\n        var t = 1 / (1 + .2316419 * Math.abs(x));\n        var d = .3989423 * Math.exp(-x * x / 2);\n        var prob = d * t * (.3193815 + t * (-.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));\n        if (x > 0) prob = 1 - prob;\n        return prob;\n    }\n\n    init();\n});"}}
{"input": {"input_text": "Loan amortization fixed-rate: monthly payment PMT = P*r_m*(1+r_m)^n/((1+r_m)^n -1).", "simulation_name": " Loan Payment", "domain": "Finance", "description": "Fixed-rate installment payment", "assumptions": ["Equal payments"], "entities": [], "constants": [], "parameters": [{"name": "principal", "symbol": "P", "unit": "currency", "range": [100, 100000000.0]}, {"name": "annual_rate", "symbol": "r", "unit": "1/year", "range": [0, 0.3]}, {"name": "years", "symbol": "t", "unit": "year", "range": [0.1, 40]}], "equations": [{"description": "Monthly rate", "expression": "r_m = r/12"}, {"description": "Periods", "expression": "n = 12*t"}, {"description": "Payment", "expression": "PMT = P*r_m*(1+r_m)^n/((1+r_m)^n - 1)"}], "initial_conditions": {}, "outputs": ["PMT"], "simulation_controls": ["P", "r", "t"], "constraints": ["r>=0", "t>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Loan Amortization Simulator</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n\n    <div class=\"main-container\">\n        <header>\n            <h1>Fixed-Rate Loan Amortization</h1>\n            <p class=\"subtitle\">Visualize Principal vs. Interest over time</p>\n        </header>\n\n        <div class=\"dashboard-grid\">\n            \n            <div class=\"controls-card\">\n                <h3>Loan Details</h3>\n                \n                <div class=\"control-group\">\n                    <label>Principal Amount ($)</label>\n                    <input type=\"number\" id=\"input-p\" value=\"250000\" min=\"1000\" step=\"1000\">\n                    <input type=\"range\" id=\"range-p\" min=\"10000\" max=\"1000000\" step=\"1000\" value=\"250000\">\n                </div>\n\n                <div class=\"control-group\">\n                    <label>Annual Interest Rate (%)</label>\n                    <input type=\"number\" id=\"input-r\" value=\"5.5\" min=\"0.1\" max=\"20\" step=\"0.1\">\n                    <input type=\"range\" id=\"range-r\" min=\"0.1\" max=\"15\" step=\"0.1\" value=\"5.5\">\n                </div>\n\n                <div class=\"control-group\">\n                    <label>Loan Term (Years)</label>\n                    <input type=\"number\" id=\"input-t\" value=\"30\" min=\"1\" max=\"40\">\n                    <input type=\"range\" id=\"range-t\" min=\"1\" max=\"40\" step=\"1\" value=\"30\">\n                </div>\n\n                <div class=\"summary-box\">\n                    <div class=\"summary-item\">\n                        <span class=\"label\">Monthly Payment</span>\n                        <span class=\"value big\" id=\"out-pmt\">$0.00</span>\n                    </div>\n                    <div class=\"summary-item\">\n                        <span class=\"label\">Total Interest</span>\n                        <span class=\"value\" id=\"out-total-int\">$0.00</span>\n                    </div>\n                    <div class=\"summary-item\">\n                        <span class=\"label\">Total Cost</span>\n                        <span class=\"value\" id=\"out-total-cost\">$0.00</span>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"viz-card\">\n                <div class=\"canvas-wrapper\">\n                    <canvas id=\"amortChart\"></canvas>\n                    <div id=\"hover-tooltip\" class=\"tooltip hidden\"></div>\n                </div>\n                \n                <div class=\"legend\">\n                    <div class=\"legend-item\"><span class=\"dot interest\"></span> Interest Payment</div>\n                    <div class=\"legend-item\"><span class=\"dot principal\"></span> Principal Payment</div>\n                    <div class=\"legend-item\"><span class=\"line balance\"></span> Remaining Balance</div>\n                </div>\n\n                <div class=\"animation-controls\">\n                    <button id=\"btn-animate\" class=\"btn-primary\">Animate Payments</button>\n                    <div class=\"progress-bar-bg\">\n                        <div id=\"progress-bar\" class=\"progress-bar-fill\"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-color: #f8f9fa;\n    --card-bg: #ffffff;\n    --primary: #2c3e50;\n    --accent-p: #10b981; /* Green for Principal */\n    --accent-i: #ef4444; /* Red for Interest */\n    --accent-b: #3b82f6; /* Blue for Balance */\n    --text-main: #1f2937;\n    --border: #e5e7eb;\n}\n\nbody {\n    font-family: 'Segoe UI', system-ui, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-main);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n}\n\n.main-container {\n    max-width: 1100px;\n    width: 100%;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 30px;\n}\nh1 { margin: 0; color: var(--primary); }\n.subtitle { color: #6b7280; margin-top: 5px; }\n\n/* Grid Layout */\n.dashboard-grid {\n    display: grid;\n    grid-template-columns: 350px 1fr;\n    gap: 20px;\n}\n\n.controls-card, .viz-card {\n    background: var(--card-bg);\n    padding: 25px;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);\n}\n\n/* Controls */\nh3 { margin-top: 0; border-bottom: 1px solid var(--border); padding-bottom: 10px; }\n\n.control-group { margin-bottom: 20px; }\n\nlabel {\n    display: block;\n    font-weight: 600;\n    margin-bottom: 8px;\n    font-size: 0.9rem;\n}\n\ninput[type=number] {\n    width: 100%;\n    padding: 8px;\n    border: 1px solid var(--border);\n    border-radius: 6px;\n    margin-bottom: 8px;\n    font-family: inherit;\n    box-sizing: border-box;\n}\n\ninput[type=range] {\n    width: 100%;\n    cursor: pointer;\n    accent-color: var(--accent-b);\n}\n\n/* Summary Box */\n.summary-box {\n    background-color: #f3f4f6;\n    border-radius: 8px;\n    padding: 15px;\n    margin-top: 20px;\n}\n\n.summary-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 10px;\n}\n.summary-item:last-child { margin-bottom: 0; padding-top: 10px; border-top: 1px dashed #d1d5db; }\n\n.summary-item .label { font-size: 0.85rem; color: #6b7280; }\n.summary-item .value { font-weight: bold; font-family: monospace; font-size: 1.1rem; }\n.summary-item .value.big { font-size: 1.4rem; color: var(--accent-b); }\n\n/* Visualization */\n.canvas-wrapper {\n    position: relative;\n    height: 400px;\n    width: 100%;\n}\n\ncanvas {\n    width: 100%;\n    height: 100%;\n    cursor: crosshair;\n}\n\n.tooltip {\n    position: absolute;\n    background: rgba(0,0,0,0.8);\n    color: white;\n    padding: 8px;\n    border-radius: 4px;\n    pointer-events: none;\n    font-size: 0.8rem;\n    white-space: pre-line;\n    z-index: 10;\n    transform: translate(-50%, -120%);\n}\n.tooltip.hidden { opacity: 0; }\n\n.legend {\n    display: flex;\n    justify-content: center;\n    gap: 20px;\n    margin-top: 15px;\n}\n\n.legend-item { font-size: 0.9rem; display: flex; align-items: center; gap: 6px; }\n.dot { width: 12px; height: 12px; display: inline-block; border-radius: 2px; }\n.dot.interest { background-color: var(--accent-i); }\n.dot.principal { background-color: var(--accent-p); }\n.line.balance { width: 20px; height: 3px; background-color: var(--accent-b); }\n\n/* Animation Controls */\n.animation-controls {\n    margin-top: 20px;\n    display: flex;\n    align-items: center;\n    gap: 15px;\n}\n\n.btn-primary {\n    background-color: var(--accent-b);\n    color: white;\n    border: none;\n    padding: 10px 20px;\n    border-radius: 6px;\n    cursor: pointer;\n    font-weight: bold;\n    white-space: nowrap;\n}\n.btn-primary:hover { background-color: #2563eb; }\n.btn-primary:disabled { background-color: #9ca3af; cursor: not-allowed; }\n\n.progress-bar-bg {\n    flex-grow: 1;\n    height: 8px;\n    background-color: #e5e7eb;\n    border-radius: 4px;\n    overflow: hidden;\n}\n\n.progress-bar-fill {\n    height: 100%;\n    width: 0%;\n    background-color: var(--accent-p);\n    transition: width 0.1s linear;\n}\n\n@media (max-width: 800px) {\n    .dashboard-grid { grid-template-columns: 1fr; }\n}", "js": "document.addEventListener('DOMContentLoaded', () => {\n    // --- Elements ---\n    const canvas = document.getElementById('amortChart');\n    const ctx = canvas.getContext('2d');\n    const tooltip = document.getElementById('hover-tooltip');\n    \n    // Inputs\n    const inputs = {\n        p: { num: document.getElementById('input-p'), range: document.getElementById('range-p') },\n        r: { num: document.getElementById('input-r'), range: document.getElementById('range-r') },\n        t: { num: document.getElementById('input-t'), range: document.getElementById('range-t') }\n    };\n    \n    // Outputs\n    const outPmt = document.getElementById('out-pmt');\n    const outTotalInt = document.getElementById('out-total-int');\n    const outTotalCost = document.getElementById('out-total-cost');\n    \n    // Animation\n    const btnAnimate = document.getElementById('btn-animate');\n    const progressBar = document.getElementById('progress-bar');\n\n    // State\n    let schedule = [];\n    let metrics = {};\n    let animationId = null;\n    let animationFrame = 0; // Current month being animated\n    let isAnimating = false;\n\n    // --- Core Logic ---\n\n    function calculateLoan() {\n        const P = parseFloat(inputs.p.num.value);\n        const annualRate = parseFloat(inputs.r.num.value) / 100;\n        const years = parseFloat(inputs.t.num.value);\n        \n        const r_m = annualRate / 12;\n        const n = Math.round(years * 12);\n        \n        // PMT Formula: P * r(1+r)^n / ((1+r)^n - 1)\n        let pmt = 0;\n        if (r_m === 0) {\n            pmt = P / n;\n        } else {\n            pmt = P * (r_m * Math.pow(1 + r_m, n)) / (Math.pow(1 + r_m, n) - 1);\n        }\n\n        // Generate Schedule\n        schedule = [];\n        let balance = P;\n        let totalInterest = 0;\n\n        for (let i = 1; i <= n; i++) {\n            const interestPayment = balance * r_m;\n            let principalPayment = pmt - interestPayment;\n            \n            // Handle last month rounding\n            if (balance - principalPayment < 0.01) {\n                principalPayment = balance;\n                balance = 0;\n            } else {\n                balance -= principalPayment;\n            }\n\n            totalInterest += interestPayment;\n\n            schedule.push({\n                month: i,\n                interest: interestPayment,\n                principal: principalPayment,\n                balance: balance,\n                totalPaid: i * pmt\n            });\n\n            if (balance <= 0) break;\n        }\n\n        metrics = {\n            pmt: pmt,\n            totalInterest: totalInterest,\n            totalCost: P + totalInterest,\n            n: n\n        };\n\n        updateDisplays();\n        drawChart();\n    }\n\n    function updateDisplays() {\n        const fmt = (num) => num.toLocaleString('en-US', { style: 'currency', currency: 'USD' });\n        \n        outPmt.textContent = fmt(metrics.pmt);\n        outTotalInt.textContent = fmt(metrics.totalInterest);\n        outTotalCost.textContent = fmt(metrics.totalCost);\n    }\n\n    // --- Visualization ---\n\n    function drawChart(animateUntilIndex = null) {\n        // Handle canvas sizing\n        const rect = canvas.parentElement.getBoundingClientRect();\n        canvas.width = rect.width;\n        canvas.height = rect.height;\n        const w = canvas.width;\n        const h = canvas.height;\n        const padding = { top: 20, right: 50, bottom: 40, left: 60 };\n\n        ctx.clearRect(0, 0, w, h);\n\n        if (schedule.length === 0) return;\n\n        const maxIndex = animateUntilIndex !== null ? animateUntilIndex : schedule.length;\n        const dataToDraw = schedule; // We draw the full axis structure, but maybe limit filled bars\n\n        // Scales\n        const maxBalance = schedule[0].balance + schedule[0].principal; // Should be Principal\n        const maxPayment = metrics.pmt * 1.2; // Add some headroom\n        const xStep = (w - padding.left - padding.right) / schedule.length;\n        \n        const mapX = (i) => padding.left + (i * xStep);\n        const mapY_Balance = (val) => h - padding.bottom - ((val / maxBalance) * (h - padding.top - padding.bottom));\n        const mapY_Payment = (val) => h - padding.bottom - ((val / maxPayment) * (h - padding.top - padding.bottom)); // Separate scale for bars if we wanted, but let's normalize bars to fit nicely at bottom\n\n        // Let's use a dual axis conceptualization visually:\n        // 1. Balance Line uses Full Height\n        // 2. Bars use bottom 40% of height for better visibility\n        const barHeightMax = (h - padding.top - padding.bottom) * 0.4;\n        const mapY_Bar = (val) => h - padding.bottom - ((val / metrics.pmt) * barHeightMax);\n\n\n        // 1. Draw Axis & Grid\n        ctx.beginPath();\n        ctx.strokeStyle = '#e5e7eb';\n        ctx.lineWidth = 1;\n        // Bottom Line\n        ctx.moveTo(padding.left, h - padding.bottom);\n        ctx.lineTo(w - padding.right, h - padding.bottom);\n        // Left Line\n        ctx.moveTo(padding.left, padding.top);\n        ctx.lineTo(padding.left, h - padding.bottom);\n        ctx.stroke();\n\n        // 2. Draw Bars (Stacked Principal + Interest)\n        const barWidth = Math.max(1, xStep + 0.5); // Ensure no gaps\n\n        for (let i = 0; i < maxIndex; i++) {\n            const d = schedule[i];\n            const x = mapX(i);\n            \n            // Interest (Bottom Layer)\n            // Actually, usually Principal is on bottom for stack, but Interest is high early.\n            // Let's put Interest on top (Red) and Principal on bottom (Green) so \"Equity\" grows from bottom?\n            // Standard is often Interest on bottom. Let's do:\n            // Top: Interest (Red), Bottom: Principal (Green)\n            \n            const yBase = h - padding.bottom;\n            const hPrincipal = (d.principal / metrics.pmt) * barHeightMax;\n            const hInterest = (d.interest / metrics.pmt) * barHeightMax;\n\n            // Draw Principal (Green)\n            ctx.fillStyle = '#10b981';\n            ctx.fillRect(x, yBase - hPrincipal, barWidth, hPrincipal);\n\n            // Draw Interest (Red) on top of Principal\n            ctx.fillStyle = '#ef4444';\n            ctx.fillRect(x, yBase - hPrincipal - hInterest, barWidth, hInterest);\n        }\n\n        // 3. Draw Balance Line (Blue)\n        ctx.beginPath();\n        ctx.strokeStyle = '#3b82f6';\n        ctx.lineWidth = 3;\n        ctx.lineJoin = 'round';\n        \n        // Start at (0, Initial Principal)\n        ctx.moveTo(padding.left, mapY_Balance(schedule[0].balance + schedule[0].principal));\n\n        for (let i = 0; i < maxIndex; i++) {\n            const x = mapX(i) + (barWidth/2);\n            const y = mapY_Balance(schedule[i].balance);\n            ctx.lineTo(x, y);\n        }\n        ctx.stroke();\n\n        // Labels\n        ctx.fillStyle = '#6b7280';\n        ctx.font = '10px sans-serif';\n        \n        // X-axis labels (Years)\n        const yearStep = Math.max(1, Math.round(schedule.length / 12 / 5)); // Show ~5 labels\n        for(let i=0; i<=schedule.length; i+= (yearStep * 12)) {\n            const x = mapX(i);\n            if(x < w - padding.right) {\n                ctx.fillText(`Y${i/12}`, x, h - padding.bottom + 15);\n            }\n        }\n    }\n\n    // --- Animation ---\n\n    function animate() {\n        if (!isAnimating) return;\n        \n        animationFrame += Math.max(1, Math.floor(schedule.length / 100)); // Speed based on length\n\n        if (animationFrame >= schedule.length) {\n            animationFrame = schedule.length;\n            isAnimating = false;\n            btnAnimate.textContent = \"Re-Animate\";\n            btnAnimate.disabled = false;\n        } else {\n            requestAnimationFrame(animate);\n        }\n\n        drawChart(animationFrame);\n        \n        // Update Progress Bar\n        const pct = (animationFrame / schedule.length) * 100;\n        progressBar.style.width = `${pct}%`;\n    }\n\n    btnAnimate.addEventListener('click', () => {\n        isAnimating = true;\n        animationFrame = 0;\n        btnAnimate.disabled = true;\n        btnAnimate.textContent = \"Simulating...\";\n        animate();\n    });\n\n    // --- Interactivity (Sync Inputs) ---\n\n    function syncInputs(source, target, type) {\n        target.value = source.value;\n        calculateLoan();\n        // Reset animation state\n        isAnimating = false;\n        btnAnimate.disabled = false;\n        btnAnimate.textContent = \"Animate Payments\";\n        progressBar.style.width = '0%';\n    }\n\n    Object.keys(inputs).forEach(key => {\n        const i = inputs[key];\n        i.num.addEventListener('input', () => syncInputs(i.num, i.range, key));\n        i.range.addEventListener('input', () => syncInputs(i.range, i.num, key));\n    });\n\n    // --- Tooltip ---\n    canvas.addEventListener('mousemove', (e) => {\n        if(isAnimating) return;\n        const rect = canvas.getBoundingClientRect();\n        const x = e.clientX - rect.left;\n        \n        // Find Index\n        const paddingLeft = 60;\n        const w = canvas.width - 110; // width minus pads\n        const xStep = w / schedule.length;\n        \n        let index = Math.floor((x - paddingLeft) / xStep);\n        if (index < 0) index = 0;\n        if (index >= schedule.length) index = schedule.length - 1;\n\n        const d = schedule[index];\n        \n        tooltip.style.left = `${e.clientX - rect.left}px`; // position relative to canvas container\n        tooltip.style.top = `${e.clientY - rect.top}px`;\n        tooltip.classList.remove('hidden');\n        \n        tooltip.innerHTML = `\n            <strong>Month ${d.month} (Year ${(d.month/12).toFixed(1)})</strong><br>\n            Principal Paid: $${d.principal.toFixed(2)}<br>\n            Interest Paid: $${d.interest.toFixed(2)}<br>\n            Remaining Balance: $${d.balance.toFixed(2)}\n        `;\n    });\n\n    canvas.addEventListener('mouseleave', () => {\n        tooltip.classList.add('hidden');\n    });\n\n    // Handle Window Resize\n    window.addEventListener('resize', () => {\n        drawChart(isAnimating ? animationFrame : null);\n    });\n\n    // Init\n    calculateLoan();\n});"}}
{"input": {"input_text": "Delta of Black-Scholes call: Delta = N(d1). Use d1 from standard formula.", "simulation_name": " Call Delta", "domain": "Finance", "description": "BSM call delta", "assumptions": ["No dividends"], "entities": [], "constants": [], "parameters": [{"name": "d1", "symbol": "d1", "unit": "dimensionless", "range": [-10, 10]}], "equations": [{"description": "Delta", "expression": "Delta = N(d1)"}], "initial_conditions": {}, "outputs": ["Delta"], "simulation_controls": ["d1"], "constraints": ["d1 finite"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S90 Call Delta Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"wrapper\">\n    <header>\n        <h1>Black-Scholes Call Delta ($\\Delta$)</h1>\n        <p>Delta is the cumulative normal distribution of $d_1$. It represents the hedge ratio.</p>\n    </header>\n\n    <div class=\"dashboard\">\n        \n        <div class=\"panel controls\">\n            <h3>Parameters</h3>\n            \n            <div class=\"control-group\">\n                <div class=\"label-row\">\n                    <label>Parameter $d_1$</label>\n                    <span id=\"val-d1\" class=\"val\">0.00</span>\n                </div>\n                <input type=\"range\" id=\"in-d1\" min=\"-4\" max=\"4\" step=\"0.01\" value=\"0.00\">\n                <div class=\"range-labels\">\n                    <span>-4 (OTM)</span>\n                    <span>0 (ATM)</span>\n                    <span>+4 (ITM)</span>\n                </div>\n            </div>\n\n            <hr>\n\n            <div class=\"result-box\">\n                <label>Call Delta ($\\Delta$)</label>\n                <div id=\"out-delta\" class=\"big-result\">0.5000</div>\n                <div class=\"sub-text\">Shares to buy per Option</div>\n            </div>\n\n            <div class=\"formula-box\">\n                $$ \\Delta = N(d_1) = \\int_{-\\infty}^{d_1} \\frac{1}{\\sqrt{2\\pi}} e^{-x^2/2} \\, dx $$\n            </div>\n        </div>\n\n        <div class=\"visuals-col\">\n            \n            <div class=\"panel\">\n                <h3>1. The Definition: Area under Curve</h3>\n                <div class=\"canvas-container\">\n                    <canvas id=\"pdfCanvas\"></canvas>\n                </div>\n                <div class=\"legend\">\n                    <span class=\"item\"><span class=\"box fill\"></span>$\\Delta$ (Shaded Area)</span>\n                    <span class=\"item\"><span class=\"line cut\"></span>$d_1$ Threshold</span>\n                </div>\n            </div>\n\n            <div class=\"panel\">\n                <h3>2. The Relationship: CDF Curve</h3>\n                <div class=\"canvas-container\">\n                    <canvas id=\"cdfCanvas\"></canvas>\n                </div>\n            </div>\n\n            <div class=\"panel\">\n                <h3>3. The Physical Hedge (Share Equivalence)</h3>\n                <div class=\"hedge-container\">\n                    <div class=\"share-tank\">\n                        <div id=\"share-liquid\" class=\"liquid\"></div>\n                        <div class=\"tank-label\">1.0 Share</div>\n                    </div>\n                    <div class=\"hedge-info\">\n                        If you sold <strong>1 Call Option</strong>,<br>\n                        you must hold <strong id=\"txt-shares\">0.50</strong> shares<br>\n                        to be Delta Neutral.\n                    </div>\n                </div>\n            </div>\n\n        </div>\n    </div>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-app: #f1f5f9;\n    --bg-panel: #ffffff;\n    --primary: #2563eb;\n    --primary-light: #dbeafe;\n    --text-main: #1e293b;\n    --text-muted: #64748b;\n    --border: #e2e8f0;\n    --accent-fill: rgba(37, 99, 235, 0.3);\n}\n\nbody {\n    font-family: 'Segoe UI', system-ui, sans-serif;\n    background: var(--bg-app);\n    color: var(--text-main);\n    margin: 0;\n    padding: 20px;\n}\n\n.wrapper {\n    max-width: 1000px;\n    margin: 0 auto;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 30px;\n}\n\nheader h1 { margin: 0; color: var(--text-main); }\nheader p { color: var(--text-muted); margin-top: 5px; }\n\n.dashboard {\n    display: grid;\n    grid-template-columns: 300px 1fr;\n    gap: 20px;\n}\n\n/* Panels */\n.panel {\n    background: var(--bg-panel);\n    border: 1px solid var(--border);\n    border-radius: 12px;\n    padding: 20px;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n    display: flex;\n    flex-direction: column;\n}\n\nh3 {\n    margin-top: 0;\n    font-size: 1em;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    color: var(--text-muted);\n    border-bottom: 2px solid var(--border);\n    padding-bottom: 10px;\n    margin-bottom: 15px;\n}\n\n/* Controls */\n.control-group { margin-bottom: 20px; }\n\n.label-row {\n    display: flex;\n    justify-content: space-between;\n    font-weight: 600;\n    margin-bottom: 8px;\n}\n\n.val { color: var(--primary); font-family: monospace; font-size: 1.1em; }\n\ninput[type=range] {\n    width: 100%;\n    cursor: pointer;\n    accent-color: var(--primary);\n}\n\n.range-labels {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.75em;\n    color: var(--text-muted);\n    margin-top: 5px;\n}\n\n.result-box {\n    background: var(--primary-light);\n    border: 1px solid #bfdbfe;\n    border-radius: 8px;\n    padding: 20px;\n    text-align: center;\n    margin: 20px 0;\n}\n\n.result-box label { display: block; font-size: 0.9em; color: var(--text-muted); margin-bottom: 5px; }\n.big-result { font-size: 2.5em; font-weight: 800; color: var(--primary); }\n.sub-text { font-size: 0.8em; color: var(--text-muted); opacity: 0.8; }\n\n.formula-box {\n    font-size: 0.85em;\n    overflow-x: auto;\n    padding: 10px;\n    border-top: 1px solid var(--border);\n}\n\n/* Visuals Column */\n.visuals-col {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.canvas-container {\n    position: relative;\n    width: 100%;\n    height: 200px;\n    background: #fff;\n    border-radius: 6px;\n}\n\ncanvas {\n    width: 100%;\n    height: 100%;\n    display: block;\n}\n\n.legend {\n    display: flex;\n    justify-content: center;\n    gap: 15px;\n    margin-top: 10px;\n    font-size: 0.85em;\n}\n\n.item { display: flex; align-items: center; gap: 6px; }\n.box { width: 12px; height: 12px; border-radius: 2px; border: 1px solid var(--primary); }\n.box.fill { background: var(--accent-fill); }\n.line.cut { width: 2px; height: 12px; background: var(--primary); }\n\n/* Animation Container (Hedge) */\n.hedge-container {\n    display: flex;\n    align-items: center;\n    gap: 30px;\n    padding: 10px;\n}\n\n.share-tank {\n    width: 60px;\n    height: 100px;\n    border: 3px solid var(--text-muted);\n    border-radius: 4px;\n    position: relative;\n    background: #e2e8f0;\n    overflow: hidden;\n}\n\n.liquid {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    width: 100%;\n    height: 50%; /* Dynamic */\n    background: var(--primary);\n    transition: height 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);\n}\n\n.tank-label {\n    position: absolute;\n    top: -20px;\n    width: 100%;\n    text-align: center;\n    font-size: 0.7em;\n    color: var(--text-muted);\n}\n\n.hedge-info {\n    font-size: 0.95em;\n    line-height: 1.5;\n    color: var(--text-main);\n}\n\n@media (max-width: 768px) {\n    .dashboard { grid-template-columns: 1fr; }\n}", "js": "document.addEventListener(\"DOMContentLoaded\", () => {\n    // --- Configuration ---\n    const ui = {\n        slider: document.getElementById('in-d1'),\n        valLabel: document.getElementById('val-d1'),\n        outDelta: document.getElementById('out-delta'),\n        txtShares: document.getElementById('txt-shares'),\n        liquid: document.getElementById('share-liquid'),\n        \n        pdfCanvas: document.getElementById('pdfCanvas'),\n        cdfCanvas: document.getElementById('cdfCanvas')\n    };\n\n    const ctxPDF = ui.pdfCanvas.getContext('2d');\n    const ctxCDF = ui.cdfCanvas.getContext('2d');\n\n    // State\n    let d1 = 0.0;\n    let delta = 0.5;\n\n    // --- Initialization ---\n    function init() {\n        resizeCanvases();\n        window.addEventListener('resize', resizeCanvases);\n\n        ui.slider.addEventListener('input', update);\n        \n        // Initial Draw\n        update();\n    }\n\n    function resizeCanvases() {\n        const dpr = window.devicePixelRatio || 1;\n        \n        [ui.pdfCanvas, ui.cdfCanvas].forEach(canvas => {\n            const rect = canvas.parentElement.getBoundingClientRect();\n            canvas.width = rect.width * dpr;\n            canvas.height = rect.height * dpr;\n            const ctx = canvas.getContext('2d');\n            ctx.scale(dpr, dpr);\n        });\n        \n        draw();\n    }\n\n    // --- Core Logic ---\n    function update() {\n        // Read Input\n        d1 = parseFloat(ui.slider.value);\n        \n        // Calculate Delta: N(d1)\n        delta = cumulativeNormal(d1);\n\n        // Update UI Text\n        ui.valLabel.textContent = d1.toFixed(2);\n        ui.outDelta.textContent = delta.toFixed(4);\n        ui.txtShares.textContent = delta.toFixed(4);\n\n        // Update Tank Animation\n        // Convert 0-1 to percentage\n        ui.liquid.style.height = `${delta * 100}%`;\n\n        draw();\n    }\n\n    // Standard Normal CDF Approximation\n    function cumulativeNormal(x) {\n        var t = 1 / (1 + .2316419 * Math.abs(x));\n        var d = .3989423 * Math.exp(-x * x / 2);\n        var prob = d * t * (.3193815 + t * (-.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));\n        if (x > 0) prob = 1 - prob;\n        return prob;\n    }\n\n    function draw() {\n        drawPDF();\n        drawCDF();\n    }\n\n    // --- Visualization 1: PDF (Bell Curve) ---\n    function drawPDF() {\n        const w = ui.pdfCanvas.width / (window.devicePixelRatio || 1);\n        const h = ui.pdfCanvas.height / (window.devicePixelRatio || 1);\n        const ctx = ctxPDF;\n\n        ctx.clearRect(0, 0, w, h);\n\n        const pad = { t: 20, b: 30, l: 10, r: 10 };\n        const graphW = w - pad.l - pad.r;\n        const graphH = h - pad.t - pad.b;\n\n        // X Range: -4 to 4\n        const mapX = (x) => pad.l + ((x + 4) / 8) * graphW;\n        // Y Range: 0 to 0.45\n        const mapY = (y) => (h - pad.b) - (y / 0.45) * graphH;\n\n        // Draw Bell Curve Path\n        ctx.beginPath();\n        for (let x = -4; x <= 4; x += 0.05) {\n            const y = (1 / Math.sqrt(2 * Math.PI)) * Math.exp(-0.5 * x * x);\n            if (x === -4) ctx.moveTo(mapX(x), mapY(y));\n            else ctx.lineTo(mapX(x), mapY(y));\n        }\n        ctx.strokeStyle = '#64748b';\n        ctx.lineWidth = 2;\n        ctx.stroke();\n\n        // Fill Area (Delta)\n        // From -4 up to d1\n        ctx.beginPath();\n        ctx.moveTo(mapX(-4), h - pad.b); // Start bottom left\n        for (let x = -4; x <= d1; x += 0.05) {\n            const y = (1 / Math.sqrt(2 * Math.PI)) * Math.exp(-0.5 * x * x);\n            ctx.lineTo(mapX(x), mapY(y));\n        }\n        // Exact d1 point\n        const yD1 = (1 / Math.sqrt(2 * Math.PI)) * Math.exp(-0.5 * d1 * d1);\n        ctx.lineTo(mapX(d1), mapY(yD1));\n        ctx.lineTo(mapX(d1), h - pad.b); // Drop down\n        \n        ctx.fillStyle = 'rgba(37, 99, 235, 0.3)';\n        ctx.fill();\n\n        // Draw d1 Line\n        ctx.beginPath();\n        ctx.moveTo(mapX(d1), h - pad.b);\n        ctx.lineTo(mapX(d1), pad.t);\n        ctx.strokeStyle = '#2563eb';\n        ctx.lineWidth = 2;\n        ctx.stroke();\n\n        // Labels\n        ctx.fillStyle = '#64748b';\n        ctx.font = '10px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.fillText(\"-4\", mapX(-4), h - 10);\n        ctx.fillText(\"0\", mapX(0), h - 10);\n        ctx.fillText(\"4\", mapX(4), h - 10);\n        \n        ctx.fillStyle = '#2563eb';\n        ctx.fillText(`d1 = ${d1.toFixed(2)}`, mapX(d1), pad.t - 5);\n    }\n\n    // --- Visualization 2: CDF (S-Curve) ---\n    function drawCDF() {\n        const w = ui.cdfCanvas.width / (window.devicePixelRatio || 1);\n        const h = ui.cdfCanvas.height / (window.devicePixelRatio || 1);\n        const ctx = ctxCDF;\n\n        ctx.clearRect(0, 0, w, h);\n\n        const pad = { t: 20, b: 30, l: 30, r: 20 };\n        const graphW = w - pad.l - pad.r;\n        const graphH = h - pad.t - pad.b;\n\n        const mapX = (x) => pad.l + ((x + 4) / 8) * graphW;\n        const mapY = (y) => (h - pad.b) - y * graphH; // Y is 0 to 1\n\n        // Draw Axes\n        ctx.strokeStyle = '#e2e8f0';\n        ctx.lineWidth = 1;\n        ctx.beginPath();\n        // Grid lines\n        [0, 0.5, 1].forEach(yVal => {\n            const y = mapY(yVal);\n            ctx.moveTo(pad.l, y);\n            ctx.lineTo(w - pad.r, y);\n        });\n        ctx.stroke();\n\n        // Draw S-Curve\n        ctx.beginPath();\n        for (let x = -4; x <= 4; x += 0.1) {\n            const y = cumulativeNormal(x);\n            if (x === -4) ctx.moveTo(mapX(x), mapY(y));\n            else ctx.lineTo(mapX(x), mapY(y));\n        }\n        ctx.strokeStyle = '#64748b';\n        ctx.lineWidth = 2;\n        ctx.stroke();\n\n        // Draw Current Point\n        const cx = mapX(d1);\n        const cy = mapY(delta);\n\n        // Drop lines\n        ctx.strokeStyle = '#2563eb';\n        ctx.setLineDash([5, 3]);\n        ctx.beginPath();\n        ctx.moveTo(pad.l, cy);\n        ctx.lineTo(cx, cy);\n        ctx.lineTo(cx, h - pad.b);\n        ctx.stroke();\n        ctx.setLineDash([]);\n\n        // Dot\n        ctx.beginPath();\n        ctx.arc(cx, cy, 6, 0, Math.PI * 2);\n        ctx.fillStyle = '#2563eb';\n        ctx.fill();\n        ctx.strokeStyle = '#fff';\n        ctx.lineWidth = 2;\n        ctx.stroke();\n\n        // Labels\n        ctx.fillStyle = '#64748b';\n        ctx.textAlign = 'right';\n        ctx.fillText(\"1.0\", pad.l - 5, mapY(1) + 3);\n        ctx.fillText(\"0.5\", pad.l - 5, mapY(0.5) + 3);\n        ctx.fillText(\"0.0\", pad.l - 5, mapY(0) + 3);\n        \n        ctx.save();\n        ctx.translate(10, h/2);\n        ctx.rotate(-Math.PI/2);\n        ctx.textAlign = 'center';\n        ctx.fillText(\"Delta\", 0, 0);\n        ctx.restore();\n    }\n\n    init();\n});"}}
{"input": {"input_text": "Simple linear regression slope for paired data: beta1 = Cov(x,y)/Var(x).", "simulation_name": " Linear Regression Slope", "domain": "Statistics", "description": "OLS slope closed form", "assumptions": ["Centered sums available"], "entities": [], "constants": [], "parameters": [{"name": "covariance", "symbol": "Covxy", "unit": "units^2", "range": [-1000000000000.0, 1000000000000.0]}, {"name": "variance_x", "symbol": "Varx", "unit": "units^2", "range": [1e-12, 1000000000000.0]}], "equations": [{"description": "Slope", "expression": "beta1 = Covxy/Varx"}], "initial_conditions": {}, "outputs": ["beta1"], "simulation_controls": ["Covxy", "Varx"], "constraints": ["Varx>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Simple Linear Regression Slope Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1>Linear Regression Slope</h1>\n            <div class=\"formula\">\n                $$ \\beta_1 = \\frac{Cov(x,y)}{Var(x)} $$\n            </div>\n        </header>\n\n        <main>\n            <section class=\"controls\">\n                <div class=\"control-group\">\n                    <label for=\"varX\">Variance of X ($Var(x)$):</label>\n                    <input type=\"range\" id=\"varX\" min=\"1\" max=\"200\" value=\"50\" step=\"1\">\n                    <span id=\"varXValue\" class=\"value-display\">50</span>\n                </div>\n                <div class=\"control-group\">\n                    <label for=\"covXY\">Covariance of X,Y ($Cov(x,y)$):</label>\n                    <input type=\"range\" id=\"covXY\" min=\"-150\" max=\"150\" value=\"50\" step=\"1\">\n                    <span id=\"covXYValue\" class=\"value-display\">50</span>\n                </div>\n            </section>\n\n            <section class=\"output\">\n                <p>Calculated Slope ($\\beta_1$): <span id=\"beta1Value\">1.00</span></p>\n            </section>\n\n            <section class=\"visualization\">\n                <canvas id=\"simCanvas\" width=\"640\" height=\"400\"></canvas>\n            </section>\n\n            <section class=\"description\">\n                <p>\n                    This simulation visualizes how the regression slope $\\beta_1$ is determined by the covariance between variables X and Y, and the variance of X.\n                </p>\n                <ul>\n                    <li>The <strong>Red Line</strong> is the fitted regression line with slope $\\beta_1$.</li>\n                    <li>The <strong>Blue Dots</strong> are data points generated to match the chosen variance and covariance.</li>\n                    <li>Adjust <strong>$Var(x)$</strong> to see the spread of points change along the horizontal axis.</li>\n                    <li>Adjust <strong>$Cov(x,y)$</strong> to change the tilt and direction of the cloud and the line.</li>\n                </ul>\n            </section>\n        </main>\n    </div>\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary-color: #3498db;\n    --secondary-color: #2c3e50;\n    --accent-color: #e74c3c;\n    --bg-color: #ecf0f1;\n    --panel-bg: #ffffff;\n    --text-color: #333;\n}\n\nbody {\n    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    display: flex;\n    justify-content: center;\n    padding: 20px;\n    margin: 0;\n    min-height: 100vh;\n    box-sizing: border-box;\n}\n\n.container {\n    background-color: var(--panel-bg);\n    padding: 30px;\n    border-radius: 15px;\n    box-shadow: 0 10px 25px rgba(0,0,0,0.1);\n    max-width: 800px;\n    width: 100%;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 30px;\n}\n\nh1 {\n    color: var(--secondary-color);\n    margin: 0 0 10px 0;\n}\n\n.formula {\n    font-size: 1.5em;\n    color: var(--secondary-color);\n}\n\n.controls {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 25px;\n    padding: 20px;\n    background-color: #f8f9fa;\n    border-radius: 10px;\n}\n\n.control-group {\n    display: flex;\n    flex-direction: column;\n    width: 48%;\n}\n\nlabel {\n    font-weight: 600;\n    margin-bottom: 8px;\n    color: var(--secondary-color);\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    cursor: pointer;\n    accent-color: var(--primary-color);\n}\n\n.value-display {\n    font-weight: bold;\n    color: var(--primary-color);\n    align-self: flex-end;\n    margin-top: 5px;\n}\n\n.output {\n    text-align: center;\n    margin-bottom: 25px;\n}\n\n.output p {\n    font-size: 1.3em;\n    margin: 0;\n    padding: 15px;\n    background-color: #e8f6f3;\n    border-radius: 8px;\n    border: 2px solid #a2d9ce;\n    display: inline-block;\n}\n\n#beta1Value {\n    font-weight: bold;\n    color: #16a085;\n    font-size: 1.2em;\n}\n\n.visualization {\n    display: flex;\n    justify-content: center;\n    margin-bottom: 20px;\n}\n\ncanvas {\n    border: 2px solid #bdc3c7;\n    border-radius: 8px;\n    background: radial-gradient(circle, #ffffff, #f0f2f5);\n    box-shadow: inset 0 0 10px rgba(0,0,0,0.05);\n}\n\n.description {\n    font-size: 0.95em;\n    color: #555;\n    line-height: 1.6;\n    background-color: #f8f9fa;\n    padding: 15px 25px;\n    border-radius: 10px;\n}\n\n.description ul {\n    margin: 10px 0 0 0;\n    padding-left: 20px;\n}\n\n.description li {\n    margin-bottom: 5px;\n}", "js": "const canvas = document.getElementById('simCanvas');\nconst ctx = canvas.getContext('2d');\n\nconst varXSlider = document.getElementById('varX');\nconst covXYSlider = document.getElementById('covXY');\nconst varXValueDisplay = document.getElementById('varXValue');\nconst covXYValueDisplay = document.getElementById('covXYValue');\nconst beta1ValueDisplay = document.getElementById('beta1Value');\n\n// Initial State\nlet varX = parseInt(varXSlider.value);\nlet covXY = parseInt(covXYSlider.value);\nlet beta1 = covXY / varX;\n\n// Visualization Parameters\nconst numPoints = 200;\nconst points = [];\nconst scale = 2.5; // Pixels per data unit\nconst animationSpeed = 0.1; // Lower is smoother/slower\n\n// Helper function for standard normal distribution (Box-Muller transform)\nfunction randn_bm() {\n    let u = 0, v = 0;\n    while(u === 0) u = Math.random(); //Converting [0,1) to (0,1)\n    while(v === 0) v = Math.random();\n    return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);\n}\n\n// Initialize points with fixed base standard normal random values.\n// This ensures the cloud shape transforms smoothly instead of regenerating randomly.\nfor (let i = 0; i < numPoints; i++) {\n    points.push({\n        baseX: randn_bm(),\n        baseE: randn_bm(), // Base error term\n        currentX: 0,\n        currentY: 0,\n        targetX: 0,\n        targetY: 0\n    });\n}\n\n// Function to recalculate targets based on slider inputs\nfunction updateSimulationTargets() {\n    // 1. Calculate Beta1\n    beta1 = covXY / varX;\n    \n    // 2. Update Numerical Displays\n    varXValueDisplay.textContent = varX;\n    covXYValueDisplay.textContent = covXY;\n    beta1ValueDisplay.textContent = beta1.toFixed(3);\n\n    // 3. Calculate new target positions for data points\n    const stdX = Math.sqrt(varX);\n    // We add noise proportional to the spread to maintain a cloud-like appearance.\n    const noiseScale = stdX * 0.4; \n\n    for (let i = 0; i < numPoints; i++) {\n        const p = points[i];\n        // Scale X dimension based on sqrt(Variance)\n        p.targetX = p.baseX * stdX;\n        // Generate Y based on the linear model: y = beta1 * x + noise\n        p.targetY = beta1 * p.targetX + p.baseE * noiseScale;\n    }\n}\n\n// Main Animation Loop\nfunction draw() {\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    const centerX = canvas.width / 2;\n    const centerY = canvas.height / 2;\n\n    // --- Draw Axes ---\n    ctx.strokeStyle = '#bdc3c7';\n    ctx.lineWidth = 1;\n    ctx.beginPath();\n    ctx.moveTo(0, centerY); ctx.lineTo(canvas.width, centerY); // X-axis\n    ctx.moveTo(centerX, 0); ctx.lineTo(centerX, canvas.height); // Y-axis\n    ctx.stroke();\n\n    // --- Draw Regression Line ---\n    ctx.strokeStyle = '#e74c3c'; // Accent color for the line\n    ctx.lineWidth = 4;\n    ctx.beginPath();\n    // Calculate endpoints that extend beyond the canvas visible area\n    const xStart = -centerX / scale * 1.5;\n    const yStart = beta1 * xStart;\n    const xEnd = centerX / scale * 1.5;\n    const yEnd = beta1 * xEnd;\n    // Transform to canvas coordinates (note Y inversion)\n    ctx.moveTo(centerX + xStart * scale, centerY - yStart * scale);\n    ctx.lineTo(centerX + xEnd * scale, centerY - yEnd * scale);\n    ctx.stroke();\n\n    // --- Update and Draw Points ---\n    ctx.fillStyle = 'rgba(52, 152, 219, 0.5)'; // Semi-transparent blue\n    for (let i = 0; i < numPoints; i++) {\n        const p = points[i];\n        // Smoothly interpolate current position towards target position\n        p.currentX += (p.targetX - p.currentX) * animationSpeed;\n        p.currentY += (p.targetY - p.currentY) * animationSpeed;\n\n        const canvasX = centerX + p.currentX * scale;\n        const canvasY = centerY - p.currentY * scale; // Invert Y for canvas\n\n        ctx.beginPath();\n        ctx.arc(canvasX, canvasY, 4, 0, Math.PI * 2);\n        ctx.fill();\n    }\n\n    requestAnimationFrame(draw);\n}\n\n// Event Listeners for Sliders\nvarXSlider.addEventListener('input', (e) => {\n    varX = parseInt(e.target.value);\n    updateSimulationTargets();\n});\n\ncovXYSlider.addEventListener('input', (e) => {\n    covXY = parseInt(e.target.value);\n    updateSimulationTargets();\n});\n\n// Initialize and Start\nupdateSimulationTargets();\ndraw();"}}
{"input": {"input_text": "Pearson correlation: r = Cov(x,y)/(sigma_x*sigma_y). Compute r given cov and std devs.", "simulation_name": " Correlation", "domain": "Statistics", "description": "Pearson correlation coefficient", "assumptions": ["Finite moments"], "entities": [], "constants": [], "parameters": [{"name": "covariance", "symbol": "Covxy", "unit": "units^2", "range": [-1000000000000.0, 1000000000000.0]}, {"name": "std_x", "symbol": "sx", "unit": "units", "range": [1e-12, 1000000000000.0]}, {"name": "std_y", "symbol": "sy", "unit": "units", "range": [1e-12, 1000000000000.0]}], "equations": [{"description": "Correlation", "expression": "r = Covxy/(sx*sy)"}], "initial_conditions": {}, "outputs": ["r"], "simulation_controls": ["Covxy", "sx", "sy"], "constraints": ["sx>0", "sy>0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Pearson Correlation Animator</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n    <div class=\"container\">\n        <header>\n            <h1>Pearson Correlation Animator</h1>\n            <div class=\"formula-box\">\n                $$ r = \\frac{\\text{Cov}(x,y)}{\\sigma_x \\cdot \\sigma_y} $$\n            </div>\n        </header>\n\n        <div class=\"simulation-layout\">\n            \n            <div class=\"controls-panel\">\n                <div class=\"header-row\">\n                    <h3>Controls</h3>\n                    <button id=\"demoBtn\" class=\"demo-btn\">▶ Start Animation Loop</button>\n                </div>\n                \n                <div class=\"control-group\">\n                    <div class=\"label-row\">\n                        <label>Covariance (\\(\\text{Cov}_{xy}\\))</label>\n                        <span id=\"covVal\" class=\"val-display\">0.0</span>\n                    </div>\n                    <input type=\"range\" id=\"covInput\" min=\"-100\" max=\"100\" step=\"1\" value=\"0\">\n                </div>\n\n                <div class=\"control-group\">\n                    <div class=\"label-row\">\n                        <label>Std Dev X (\\(\\sigma_x\\))</label>\n                        <span id=\"sxVal\" class=\"val-display\">10.0</span>\n                    </div>\n                    <input type=\"range\" id=\"sxInput\" min=\"1\" max=\"20\" step=\"0.5\" value=\"10\">\n                </div>\n\n                <div class=\"control-group\">\n                    <div class=\"label-row\">\n                        <label>Std Dev Y (\\(\\sigma_y\\))</label>\n                        <span id=\"syVal\" class=\"val-display\">10.0</span>\n                    </div>\n                    <input type=\"range\" id=\"syInput\" min=\"1\" max=\"20\" step=\"0.5\" value=\"10\">\n                </div>\n\n                <hr>\n\n                <div class=\"output-section\">\n                    <h3>Correlation (\\(r\\))</h3>\n                    <div id=\"rOutput\" class=\"r-display\">0.000</div>\n                    <div class=\"meter-container\">\n                        <div class=\"meter-bar\"><div id=\"meterFill\" class=\"meter-fill\"></div></div>\n                        <div class=\"meter-labels\"><span>-1</span><span>0</span><span>+1</span></div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"canvas-wrapper\">\n                <canvas id=\"scatterCanvas\"></canvas>\n                \n                <div id=\"animOverlay\" class=\"anim-overlay hidden\">\n                    <div class=\"anim-card\">\n                        <h4 id=\"animTitle\">Title</h4>\n                        <p id=\"animText\">Description goes here...</p>\n                    </div>\n                </div>\n                \n                <div class=\"overlay-info\">Simulated Points: 300</div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary-color: #4a90e2;\n    --accent-color: #6c5ce7;\n    --bg-color: #f0f2f5;\n    --panel-bg: #ffffff;\n    --text-color: #333;\n    --canvas-bg: #1e1e1e;\n}\n\nbody {\n    font-family: 'Segoe UI', sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n    min-height: 100vh;\n}\n\n.container {\n    max-width: 1100px;\n    width: 100%;\n    background: var(--panel-bg);\n    border-radius: 15px;\n    box-shadow: 0 10px 30px rgba(0,0,0,0.1);\n    padding: 25px;\n    display: flex;\n    flex-direction: column;\n}\n\nheader { text-align: center; margin-bottom: 20px; }\nh1 { margin: 0; color: #2c3e50; }\n.formula-box { font-size: 1.1rem; margin-top: 10px; }\n\n.simulation-layout { display: flex; gap: 30px; flex-wrap: wrap; }\n\n/* Controls */\n.controls-panel {\n    flex: 1; min-width: 300px;\n    background: #fafafa; padding: 20px;\n    border-radius: 10px; border: 1px solid #eee;\n}\n\n.header-row {\n    display: flex; justify-content: space-between; align-items: center;\n    margin-bottom: 15px;\n}\n\n.demo-btn {\n    background: var(--accent-color); color: white;\n    border: none; padding: 8px 16px; border-radius: 20px;\n    cursor: pointer; font-weight: bold; transition: transform 0.2s;\n}\n.demo-btn:hover { transform: scale(1.05); }\n.demo-btn.active { background: #e74c3c; }\n\n.control-group { margin-bottom: 15px; }\n.label-row { display: flex; justify-content: space-between; margin-bottom: 5px; font-weight: 600; color: #555; }\n.val-display { font-family: monospace; color: var(--primary-color); }\ninput[type=\"range\"] { width: 100%; cursor: pointer; }\n\nhr { border: 0; border-top: 1px solid #ddd; margin: 15px 0; }\n\n/* Output */\n.r-display {\n    font-size: 2.2rem; font-weight: bold; text-align: center;\n    margin: 10px 0; color: #2c3e50; font-family: monospace;\n}\n\n.meter-container { position: relative; padding: 0 10px; margin-top: 10px; }\n.meter-bar {\n    height: 10px; background: #ddd; border-radius: 5px;\n    overflow: hidden; position: relative;\n}\n.meter-fill {\n    height: 100%; width: 5px; background-color: var(--primary-color);\n    position: absolute; left: 50%; transform: translateX(-50%);\n    transition: left 0.1s, background-color 0.2s;\n}\n.meter-labels { display: flex; justify-content: space-between; font-size: 0.7rem; color: #888; margin-top: 5px; }\n\n/* Canvas & Animation Overlay */\n.canvas-wrapper {\n    flex: 2; min-width: 350px; height: 450px;\n    background: var(--canvas-bg); border-radius: 10px;\n    position: relative; overflow: hidden;\n}\n\ncanvas { width: 100%; height: 100%; display: block; }\n\n.anim-overlay {\n    position: absolute; top: 0; left: 0; width: 100%; height: 100%;\n    pointer-events: none; /* Let clicks pass through */\n    display: flex; justify-content: center; align-items: center;\n    transition: opacity 0.5s;\n}\n.anim-overlay.hidden { opacity: 0; }\n\n.anim-card {\n    background: rgba(255, 255, 255, 0.9);\n    padding: 20px; border-radius: 12px;\n    max-width: 300px; text-align: center;\n    box-shadow: 0 10px 25px rgba(0,0,0,0.3);\n    transform: translateY(20px); animation: floatUp 0.5s forwards;\n}\n\n@keyframes floatUp { to { transform: translateY(0); } }\n\n.anim-card h4 { margin: 0 0 10px 0; color: var(--accent-color); font-size: 1.2rem; }\n.anim-card p { margin: 0; color: #444; font-size: 0.95rem; line-height: 1.4; }\n\n.overlay-info {\n    position: absolute; bottom: 10px; right: 10px;\n    color: rgba(255,255,255,0.3); font-size: 0.8rem;\n}\n\n@media (max-width: 768px) {\n    .simulation-layout { flex-direction: column; }\n    .canvas-wrapper { height: 350px; }\n}", "js": "// DOM Elements\nconst canvas = document.getElementById('scatterCanvas');\nconst ctx = canvas.getContext('2d');\nconst covInput = document.getElementById('covInput');\nconst sxInput = document.getElementById('sxInput');\nconst syInput = document.getElementById('syInput');\nconst covVal = document.getElementById('covVal');\nconst sxVal = document.getElementById('sxVal');\nconst syVal = document.getElementById('syVal');\nconst rOutput = document.getElementById('rOutput');\nconst meterFill = document.getElementById('meterFill');\nconst demoBtn = document.getElementById('demoBtn');\nconst animOverlay = document.getElementById('animOverlay');\nconst animTitle = document.getElementById('animTitle');\nconst animText = document.getElementById('animText');\n\n// Constants\nconst NUM_POINTS = 300;\nconst Z1 = new Float32Array(NUM_POINTS);\nconst Z2 = new Float32Array(NUM_POINTS);\nconst SCALE = 15;\n\n// State\nlet width, height, centerX, centerY;\nlet isAnimating = false;\nlet animationFrameId;\n\n// Initialize Noise (Standard Normal)\nfunction initNoise() {\n    for (let i = 0; i < NUM_POINTS; i++) {\n        let u = 0, v = 0;\n        while(u === 0) u = Math.random();\n        while(v === 0) v = Math.random();\n        Z1[i] = Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);\n        Z2[i] = Math.sqrt(-2.0 * Math.log(u)) * Math.sin(2.0 * Math.PI * v);\n    }\n}\n\n// Resize Canvas\nfunction resize() {\n    width = canvas.parentElement.clientWidth;\n    height = canvas.parentElement.clientHeight;\n    canvas.width = width;\n    canvas.height = height;\n    centerX = width / 2;\n    centerY = height / 2;\n    if (!isAnimating) draw();\n}\nwindow.addEventListener('resize', resize);\n\n// --- Core Physics/Math Logic ---\nfunction getValues() {\n    return {\n        cov: parseFloat(covInput.value),\n        sx: parseFloat(sxInput.value),\n        sy: parseFloat(syInput.value)\n    };\n}\n\nfunction calculateR(cov, sx, sy) {\n    if (sx * sy === 0) return 0;\n    let r = cov / (sx * sy);\n    return Math.max(-1, Math.min(1, r)); // Clamp\n}\n\nfunction draw() {\n    // 1. Calc Math\n    const vals = getValues();\n    const r = calculateR(vals.cov, vals.sx, vals.sy);\n\n    // 2. Update Text UI\n    covVal.textContent = vals.cov.toFixed(1);\n    sxVal.textContent = vals.sx.toFixed(1);\n    syVal.textContent = vals.sy.toFixed(1);\n    rOutput.textContent = r.toFixed(3);\n    \n    // 3. Update Meter\n    const pct = ((r + 1) / 2) * 100;\n    meterFill.style.left = `${pct}%`;\n    meterFill.style.backgroundColor = Math.abs(r) > 0.8 ? '#2ecc71' : '#4a90e2';\n\n    // 4. Draw Canvas\n    ctx.fillStyle = '#1e1e1e';\n    ctx.fillRect(0, 0, width, height);\n\n    // Grid Lines\n    ctx.strokeStyle = '#333';\n    ctx.lineWidth = 1;\n    ctx.beginPath();\n    ctx.moveTo(0, centerY); ctx.lineTo(width, centerY);\n    ctx.moveTo(centerX, 0); ctx.lineTo(centerX, height);\n    ctx.stroke();\n\n    // Points\n    const rCompl = Math.sqrt(Math.max(0, 1 - r*r));\n    ctx.fillStyle = `rgba(${r>0?46:231}, ${r>0?204:76}, ${r>0?113:60}, 0.8)`; // Green if pos, Red if neg\n\n    for (let i = 0; i < NUM_POINTS; i++) {\n        const x_stat = vals.sx * Z1[i];\n        const y_stat = vals.sy * (r * Z1[i] + rCompl * Z2[i]);\n\n        const px = centerX + (x_stat * SCALE);\n        const py = centerY - (y_stat * SCALE);\n        \n        ctx.beginPath();\n        ctx.arc(px, py, 3, 0, Math.PI*2);\n        ctx.fill();\n    }\n}\n\n// --- Animation / Demo Logic ---\n\nconst demoSequence = [\n    { \n        cov: 0, sx: 10, sy: 10, time: 2000, \n        title: \"No Correlation (r = 0)\", \n        text: \"When Covariance is 0, X and Y are independent. The shape is a round cloud.\"\n    },\n    { \n        cov: 80, sx: 10, sy: 10, time: 3000, \n        title: \"Positive Correlation\", \n        text: \"As Covariance increases, Y tends to increase with X. The cloud stretches into a line sloping up.\" \n    },\n    { \n        cov: 100, sx: 10, sy: 10, time: 3000, \n        title: \"Perfect Positive (r = 1)\", \n        text: \"Maximum Covariance for these standard deviations! All points fall exactly on a line.\" \n    },\n    { \n        cov: 0, sx: 5, sy: 15, time: 2000, \n        title: \"Changing Spread\", \n        text: \"Even with r=0, changing Standard Deviations (sx, sy) squashes or stretches the cloud without tilting it.\" \n    },\n    { \n        cov: -60, sx: 10, sy: 10, time: 3000, \n        title: \"Negative Correlation\", \n        text: \"Negative Covariance means Y decreases as X increases. The slope flips downward.\" \n    }\n];\n\nlet demoIndex = 0;\nlet lastTime = 0;\nlet transitionProgress = 0;\n\nfunction lerp(start, end, t) {\n    return start * (1 - t) + end * t;\n}\n\nfunction animateLoop(timestamp) {\n    if (!isAnimating) return;\n    if (!lastTime) lastTime = timestamp;\n    const dt = timestamp - lastTime;\n    lastTime = timestamp;\n\n    const currentStep = demoSequence[demoIndex];\n    const nextIndex = (demoIndex + 1) % demoSequence.length;\n    const nextStep = demoSequence[nextIndex];\n\n    // Show Overlay Text\n    animOverlay.classList.remove('hidden');\n    animTitle.innerText = currentStep.title;\n    animText.innerText = currentStep.text;\n\n    // Interpolate values\n    // We move from 'currentStep' targets to 'nextStep' targets\n    // But to make it pause for reading, we can handle logic differently.\n    // Simplified: Just lerp sliders towards current target.\n    \n    // Smoothly move sliders to target\n    const speed = 0.05; // Smoothing factor\n    \n    let currCov = parseFloat(covInput.value);\n    let currSx = parseFloat(sxInput.value);\n    let currSy = parseFloat(syInput.value);\n\n    // Determine target\n    const targetCov = currentStep.cov;\n    const targetSx = currentStep.sx;\n    const targetSy = currentStep.sy;\n\n    // Apply Lerp\n    covInput.value = lerp(currCov, targetCov, speed);\n    sxInput.value = lerp(currSx, targetSx, speed);\n    syInput.value = lerp(currSy, targetSy, speed);\n\n    draw();\n\n    // Check if we are \"close enough\" to target to consider this step done\n    // Or just use a timer. Let's use a timer for simplicity.\n    transitionProgress += dt;\n    if (transitionProgress > currentStep.time) {\n        transitionProgress = 0;\n        demoIndex = nextIndex;\n    }\n\n    animationFrameId = requestAnimationFrame(animateLoop);\n}\n\nfunction toggleDemo() {\n    isAnimating = !isAnimating;\n    if (isAnimating) {\n        demoBtn.textContent = \"⏹ Stop Animation\";\n        demoBtn.classList.add('active');\n        lastTime = 0;\n        transitionProgress = 0;\n        // Disable inputs during demo\n        covInput.disabled = true;\n        sxInput.disabled = true;\n        syInput.disabled = true;\n        \n        requestAnimationFrame(animateLoop);\n    } else {\n        demoBtn.textContent = \"▶ Start Animation Loop\";\n        demoBtn.classList.remove('active');\n        animOverlay.classList.add('hidden');\n        cancelAnimationFrame(animationFrameId);\n        \n        // Re-enable inputs\n        covInput.disabled = false;\n        sxInput.disabled = false;\n        syInput.disabled = false;\n    }\n}\n\n// Event Listeners\ncovInput.addEventListener('input', draw);\nsxInput.addEventListener('input', draw);\nsyInput.addEventListener('input', draw);\ndemoBtn.addEventListener('click', toggleDemo);\n\n// Init\ninitNoise();\nresize();\ndraw();"}}
{"input": {"input_text": "Logistic regression decision boundary for weight vector w and bias b: boundary satisfies w·x + b = 0. Provide equation form.", "simulation_name": " Logistic Decision Boundary", "domain": "Machine Learning", "description": "Hyperplane for binary logistic model", "assumptions": ["Linear separator"], "entities": [], "constants": [], "parameters": [{"name": "weights", "symbol": "w", "unit": "vector", "range": [-1000.0, 1000.0]}, {"name": "bias", "symbol": "b", "unit": "scalar", "range": [-1000.0, 1000.0]}], "equations": [{"description": "Boundary", "expression": "w·x + b = 0"}], "initial_conditions": {}, "outputs": ["boundary_equation"], "simulation_controls": ["w", "b"], "constraints": ["w dims match x"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Logistic Regression Training Simulation</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n<div class=\"container\">\n    <header>\n        <h1>Logistic Regression: Training Visualizer</h1>\n        <p class=\"subtitle\">Watch Gradient Descent find the optimal Boundary</p>\n    </header>\n\n    <main class=\"sim-layout\">\n        <section class=\"controls\">\n            \n            <div class=\"training-panel\">\n                <h3>Training Control</h3>\n                <div class=\"stats-grid\">\n                    <div class=\"stat-item\">\n                        <span class=\"stat-label\">Epoch</span>\n                        <span id=\"epoch-display\" class=\"stat-value\">0</span>\n                    </div>\n                    <div class=\"stat-item\">\n                        <span class=\"stat-label\">Log Loss</span>\n                        <span id=\"loss-display\" class=\"stat-value\">0.000</span>\n                    </div>\n                </div>\n                \n                <div class=\"button-group\">\n                    <button id=\"btn-train\" class=\"btn primary\">Start Training</button>\n                    <button id=\"btn-reset\" class=\"btn secondary\">Reset / New Data</button>\n                </div>\n                <p class=\"instruction-text\">Click \"Start Training\" to animate the learning steps.</p>\n            </div>\n\n            <hr>\n\n            <h3>Manual Parameters</h3>\n            <div class=\"control-group\">\n                <label for=\"w1\">Weight $w_1$ (x-coeff): <span id=\"val-w1\">1.0</span></label>\n                <input type=\"range\" id=\"w1\" min=\"-5\" max=\"5\" step=\"0.1\" value=\"0.1\">\n            </div>\n\n            <div class=\"control-group\">\n                <label for=\"w2\">Weight $w_2$ (y-coeff): <span id=\"val-w2\">1.0</span></label>\n                <input type=\"range\" id=\"w2\" min=\"-5\" max=\"5\" step=\"0.1\" value=\"0.5\">\n            </div>\n\n            <div class=\"control-group\">\n                <label for=\"b\">Bias $b$ (Intercept): <span id=\"val-b\">0.0</span></label>\n                <input type=\"range\" id=\"b\" min=\"-10\" max=\"10\" step=\"0.1\" value=\"0.0\">\n            </div>\n\n            <div class=\"equation-box\">\n                <div id=\"boundary-eq\" class=\"math-display\">\n                    $$ 0.1x_1 + 0.5x_2 + 0.0 = 0 $$\n                </div>\n            </div>\n        </section>\n\n        <section class=\"visualization\">\n            <canvas id=\"simCanvas\"></canvas>\n            <div class=\"legend\">\n                <span class=\"dot class1\"></span> Class 1 (True)\n                <span class=\"dot class0\"></span> Class 0 (True)\n                <span class=\"legend-text\">Background: Model Probability</span>\n            </div>\n        </section>\n    </main>\n</div>\n\n<script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --bg-color: #f0f2f5;\n    --panel-bg: #ffffff;\n    --text-color: #333;\n    --primary: #2563eb;\n    --primary-hover: #1d4ed8;\n    --secondary: #64748b;\n    --accent-red: #ef4444;   \n    --accent-blue: #3b82f6;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n    min-height: 100vh;\n}\n\n.container {\n    max-width: 1200px;\n    width: 100%;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 30px;\n}\n\n.sim-layout {\n    display: grid;\n    grid-template-columns: 350px 1fr;\n    gap: 30px;\n    background: var(--panel-bg);\n    padding: 30px;\n    border-radius: 16px;\n    box-shadow: 0 10px 30px rgba(0,0,0,0.05);\n}\n\n@media (max-width: 900px) {\n    .sim-layout { grid-template-columns: 1fr; }\n}\n\n/* Controls Panel */\n.controls {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n/* Training Panel Styling */\n.training-panel {\n    background: #f8fafc;\n    padding: 20px;\n    border-radius: 12px;\n    border: 1px solid #e2e8f0;\n}\n\n.stats-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 15px;\n    margin-bottom: 20px;\n}\n\n.stat-item {\n    background: #fff;\n    padding: 10px;\n    border-radius: 8px;\n    text-align: center;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.03);\n    border: 1px solid #e2e8f0;\n}\n\n.stat-label {\n    display: block;\n    font-size: 0.85em;\n    color: #64748b;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.stat-value {\n    display: block;\n    font-size: 1.4em;\n    font-weight: 700;\n    color: var(--primary);\n}\n\n.button-group {\n    display: flex;\n    gap: 10px;\n}\n\n.btn {\n    flex: 1;\n    padding: 12px;\n    border: none;\n    border-radius: 8px;\n    cursor: pointer;\n    font-weight: 600;\n    transition: all 0.2s;\n}\n\n.btn.primary {\n    background-color: var(--primary);\n    color: white;\n}\n.btn.primary:hover { background-color: var(--primary-hover); }\n.btn.primary:active { transform: translateY(1px); }\n\n.btn.secondary {\n    background-color: white;\n    border: 1px solid #cbd5e1;\n    color: var(--secondary);\n}\n.btn.secondary:hover { background-color: #f1f5f9; }\n\n.instruction-text {\n    font-size: 0.85em;\n    color: #94a3b8;\n    text-align: center;\n    margin-top: 10px;\n    margin-bottom: 0;\n}\n\nhr {\n    border: 0;\n    height: 1px;\n    background: #e2e8f0;\n    width: 100%;\n}\n\n/* Manual Controls */\n.control-group { margin-bottom: 15px; }\n\nlabel {\n    display: block;\n    margin-bottom: 8px;\n    font-weight: 600;\n    font-size: 0.95em;\n}\n\ninput[type=range] {\n    width: 100%;\n    accent-color: var(--primary);\n    cursor: pointer;\n}\n\n.equation-box {\n    background: #eff6ff;\n    padding: 15px;\n    border-radius: 8px;\n    text-align: center;\n    border: 1px solid #dbeafe;\n}\n\n.math-display {\n    color: #1e3a8a;\n    font-weight: 600;\n    overflow-x: auto;\n}\n\n/* Visualization */\n.visualization {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n}\n\ncanvas {\n    width: 100%;\n    height: 500px;\n    border-radius: 12px;\n    border: 1px solid #e2e8f0;\n    background: #fff;\n    cursor: crosshair;\n}\n\n.legend {\n    margin-top: 15px;\n    display: flex;\n    gap: 20px;\n    align-items: center;\n    font-size: 0.9em;\n    color: #475569;\n}\n\n.dot {\n    width: 10px;\n    height: 10px;\n    border-radius: 50%;\n    display: inline-block;\n    margin-right: 5px;\n}\n\n.dot.class1 { background-color: var(--accent-blue); }\n.dot.class0 { background-color: var(--accent-red); }", "js": "// --- DOM Elements ---\nconst canvas = document.getElementById('simCanvas');\nconst ctx = canvas.getContext('2d');\n\nconst inputW1 = document.getElementById('w1');\nconst inputW2 = document.getElementById('w2');\nconst inputB = document.getElementById('b');\nconst labels = {\n    w1: document.getElementById('val-w1'),\n    w2: document.getElementById('val-w2'),\n    b: document.getElementById('val-b'),\n    epoch: document.getElementById('epoch-display'),\n    loss: document.getElementById('loss-display'),\n    eq: document.getElementById('boundary-eq')\n};\n\nconst btnTrain = document.getElementById('btn-train');\nconst btnReset = document.getElementById('btn-reset');\n\n// --- State Variables ---\nlet w1 = 0.1;\nlet w2 = 0.5;\nlet b = 0.0;\n\nlet points = [];\nconst numPointsPerClass = 30;\nconst range = 8; // Coordinate range (-8 to 8)\n\nlet isTraining = false;\nlet epoch = 0;\nconst learningRate = 0.05;\n\n// --- Initialization ---\n\nfunction generateData() {\n    points = [];\n    \n    // Helper for random normal distribution (approx)\n    const randn = () => {\n        let u = 0, v = 0;\n        while(u === 0) u = Math.random();\n        while(v === 0) v = Math.random();\n        return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);\n    };\n\n    // Generate Class 0 (Red) - Centered at (-3, -3)\n    for(let i=0; i<numPointsPerClass; i++) {\n        points.push({\n            x: -3 + randn() * 1.5,\n            y: -3 + randn() * 1.5,\n            label: 0\n        });\n    }\n\n    // Generate Class 1 (Blue) - Centered at (3, 3)\n    for(let i=0; i<numPointsPerClass; i++) {\n        points.push({\n            x: 3 + randn() * 1.5,\n            y: 3 + randn() * 1.5,\n            label: 1\n        });\n    }\n\n    // Reset Model parameters to random-ish small values\n    w1 = (Math.random() - 0.5);\n    w2 = (Math.random() - 0.5);\n    b = 0;\n    epoch = 0;\n    \n    updateSliders();\n    draw();\n}\n\nfunction resizeCanvas() {\n    canvas.width = canvas.parentElement.clientWidth;\n    canvas.height = 500;\n    draw();\n}\nwindow.addEventListener('resize', resizeCanvas);\n\n// --- Math & Training Logic ---\n\nfunction sigmoid(z) {\n    return 1 / (1 + Math.exp(-z));\n}\n\nfunction predict(x, y) {\n    return sigmoid(w1 * x + w2 * y + b);\n}\n\n// Calculate Binary Cross Entropy Loss\nfunction calculateLoss() {\n    let sumLoss = 0;\n    const m = points.length;\n    \n    points.forEach(p => {\n        let h = predict(p.x, p.y);\n        // Clip to avoid log(0)\n        h = Math.max(0.00001, Math.min(0.99999, h));\n        \n        // Loss = -y*log(h) - (1-y)*log(1-h)\n        if (p.label === 1) {\n            sumLoss += -Math.log(h);\n        } else {\n            sumLoss += -Math.log(1 - h);\n        }\n    });\n    \n    return sumLoss / m;\n}\n\nfunction trainStep() {\n    const m = points.length;\n    let dw1 = 0;\n    let dw2 = 0;\n    let db = 0;\n\n    // Gradient Descent Step\n    points.forEach(p => {\n        const h = predict(p.x, p.y);\n        const error = h - p.label; // (prediction - truth)\n\n        dw1 += error * p.x;\n        dw2 += error * p.y;\n        db += error;\n    });\n\n    // Average gradients\n    dw1 /= m;\n    dw2 /= m;\n    db /= m;\n\n    // Update weights\n    w1 -= learningRate * dw1;\n    w2 -= learningRate * dw2;\n    b -= learningRate * db;\n\n    epoch++;\n    updateSliders();\n}\n\n// --- Visualization ---\n\n// Map simulation coordinates to canvas pixels\nfunction toCanvasX(x) { return canvas.width/2 + (x * (canvas.width/(range*2.5))); }\nfunction toCanvasY(y) { return canvas.height/2 - (y * (canvas.height/(range*2.5 * (canvas.height/canvas.width)))); }\n// Map pixels to simulation coordinates\nfunction fromCanvasX(px) { return (px - canvas.width/2) / (canvas.width/(range*2.5)); }\nfunction fromCanvasY(py) { return -(py - canvas.height/2) / (canvas.height/(range*2.5 * (canvas.height/canvas.width))); }\n\nfunction draw() {\n    const w = canvas.width;\n    const h = canvas.height;\n    \n    // 1. Train if active\n    if (isTraining) {\n        // Run a few steps per frame for speed\n        for(let k=0; k<5; k++) trainStep();\n    }\n\n    ctx.clearRect(0, 0, w, h);\n\n    // 2. Draw Probability Heatmap (Background)\n    const res = 10; // Resolution\n    for (let py = 0; py < h; py += res) {\n        for (let px = 0; px < w; px += res) {\n            const xx = fromCanvasX(px);\n            const yy = fromCanvasY(py);\n            const prob = predict(xx, yy);\n\n            // Color blending: Red (0) -> White (0.5) -> Blue (1)\n            let r, g, b_col, a;\n            \n            // Using a softer palette\n            if (prob < 0.5) {\n                // Class 0 zone (Reddish)\n                const strength = (0.5 - prob) * 2; \n                ctx.fillStyle = `rgba(239, 68, 68, ${strength * 0.2})`;\n            } else {\n                // Class 1 zone (Blueish)\n                const strength = (prob - 0.5) * 2; \n                ctx.fillStyle = `rgba(59, 130, 246, ${strength * 0.2})`;\n            }\n            ctx.fillRect(px, py, res, res);\n        }\n    }\n\n    // 3. Draw Axes\n    ctx.strokeStyle = '#cbd5e1';\n    ctx.lineWidth = 1;\n    ctx.beginPath();\n    ctx.moveTo(0, toCanvasY(0)); ctx.lineTo(w, toCanvasY(0));\n    ctx.moveTo(toCanvasX(0), 0); ctx.lineTo(toCanvasX(0), h);\n    ctx.stroke();\n\n    // 4. Draw Decision Boundary (Line where w1*x + w2*y + b = 0)\n    ctx.strokeStyle = '#1e293b';\n    ctx.lineWidth = 3;\n    ctx.beginPath();\n    \n    // Find two points to draw the line\n    // y = -(w1*x + b)/w2\n    const xStart = -range * 1.5;\n    const xEnd = range * 1.5;\n    \n    if (Math.abs(w2) > 0.001) {\n        const yStart = -(w1 * xStart + b) / w2;\n        const yEnd = -(w1 * xEnd + b) / w2;\n        ctx.moveTo(toCanvasX(xStart), toCanvasY(yStart));\n        ctx.lineTo(toCanvasX(xEnd), toCanvasY(yEnd));\n    } else {\n        // Vertical line case\n        const xVert = -b / w1;\n        ctx.moveTo(toCanvasX(xVert), 0);\n        ctx.lineTo(toCanvasX(xVert), h);\n    }\n    ctx.stroke();\n\n    // 5. Draw Data Points\n    points.forEach(p => {\n        const cx = toCanvasX(p.x);\n        const cy = toCanvasY(p.y);\n        \n        ctx.beginPath();\n        ctx.arc(cx, cy, 6, 0, Math.PI*2);\n        \n        // Solid color based on TRUE label\n        ctx.fillStyle = p.label === 1 ? '#3b82f6' : '#ef4444';\n        ctx.fill();\n        \n        // Border indicates prediction correctness\n        // If prediction matches label, white border. If wrong, dark border.\n        const pred = predict(p.x, p.y) >= 0.5 ? 1 : 0;\n        ctx.strokeStyle = (pred === p.label) ? 'white' : 'black';\n        ctx.lineWidth = 2;\n        ctx.stroke();\n    });\n\n    // 6. Loop\n    if (isTraining) {\n        requestAnimationFrame(draw);\n    }\n}\n\n// --- UI Helper Functions ---\n\nfunction updateSliders() {\n    // Update Slider UI positions\n    inputW1.value = w1;\n    inputW2.value = w2;\n    inputB.value = b;\n    \n    // Update Text Labels\n    labels.w1.textContent = w1.toFixed(2);\n    labels.w2.textContent = w2.toFixed(2);\n    labels.b.textContent = b.toFixed(2);\n    \n    // Update Stats\n    labels.epoch.textContent = epoch;\n    labels.loss.textContent = calculateLoss().toFixed(3);\n    \n    // Update Equation using MathJax\n    const tex = `$$ ${w1.toFixed(2)}x_1 + ${w2.toFixed(2)}x_2 + ${b.toFixed(2)} = 0 $$`;\n    labels.eq.innerHTML = tex;\n    if(window.MathJax) MathJax.typesetPromise([labels.eq]);\n}\n\n// --- Event Listeners ---\n\n// Manual Slider Inputs\nconst handleManualInput = () => {\n    // Stop auto-training if user touches slider\n    if (isTraining) toggleTraining(); \n    \n    w1 = parseFloat(inputW1.value);\n    w2 = parseFloat(inputW2.value);\n    b = parseFloat(inputB.value);\n    updateSliders();\n    draw();\n};\n\ninputW1.addEventListener('input', handleManualInput);\ninputW2.addEventListener('input', handleManualInput);\ninputB.addEventListener('input', handleManualInput);\n\n// Buttons\nfunction toggleTraining() {\n    isTraining = !isTraining;\n    if (isTraining) {\n        btnTrain.textContent = \"Pause Training\";\n        btnTrain.classList.remove('primary');\n        btnTrain.classList.add('secondary');\n        draw(); // triggers loop\n    } else {\n        btnTrain.textContent = \"Resume Training\";\n        btnTrain.classList.add('primary');\n        btnTrain.classList.remove('secondary');\n    }\n}\n\nbtnTrain.addEventListener('click', toggleTraining);\n\nbtnReset.addEventListener('click', () => {\n    isTraining = false;\n    btnTrain.textContent = \"Start Training\";\n    btnTrain.classList.add('primary');\n    generateData();\n});\n\n// Start\ngenerateData();\nresizeCanvas();"}}
{"input": {"input_text": "Softmax probability for class i: p_i = exp(z_i)/sum_j exp(z_j). Provide formula given logits vector z.", "simulation_name": " Softmax", "domain": "Machine Learning", "description": "Softmax normalization", "assumptions": ["Finite logits"], "entities": [], "constants": [], "parameters": [{"name": "logits", "symbol": "z", "unit": "vector", "range": [-100, 100]}], "equations": [{"description": "Softmax", "expression": "p_i = exp(z_i)/sum_j exp(z_j)"}], "initial_conditions": {}, "outputs": ["p"], "simulation_controls": ["z"], "constraints": ["z finite"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Softmax Function Visualization</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n</head>\n<body>\n\n    <div class=\"container\">\n        <header>\n            <h1>Softmax Function</h1>\n            <div class=\"formula-box\">\n                $$ p_i = \\frac{e^{z_i}}{\\sum_{j} e^{z_j}} $$\n            </div>\n            <p class=\"subtitle\">Converts raw logits (\\(z\\)) into a probability distribution (\\(p\\)).</p>\n        </header>\n\n        <div class=\"simulation-layout\">\n            \n            <div class=\"controls-panel\">\n                <div class=\"panel-header\">\n                    <h3>Input Logits (\\(z\\))</h3>\n                    <button id=\"randomizeBtn\" class=\"action-btn\">🎲 Randomize</button>\n                    <button id=\"resetBtn\" class=\"action-btn\">↺ Reset</button>\n                </div>\n                <div class=\"sliders-container\" id=\"slidersContainer\">\n                    </div>\n                \n                <div class=\"temp-control\">\n                    <label for=\"tempInput\">Temperature (\\(T\\)): <span id=\"tempVal\">1.0</span></label>\n                    <input type=\"range\" id=\"tempInput\" min=\"0.1\" max=\"5.0\" step=\"0.1\" value=\"1.0\">\n                    <p class=\"note\">Adjusting \\( z_i / T \\) sharpens or smooths the distribution.</p>\n                </div>\n            </div>\n\n            <div class=\"viz-panel\">\n                <div class=\"charts-wrapper\">\n                    <div class=\"chart-column\">\n                        <h3>Raw Logits</h3>\n                        <div class=\"bar-chart\" id=\"logitChart\">\n                            </div>\n                    </div>\n\n                    <div class=\"math-operator\">\n                        <div class=\"arrow\">➜</div>\n                        <div class=\"op-label\">Softmax</div>\n                    </div>\n\n                    <div class=\"chart-column\">\n                        <h3>Probabilities (\\(\\sum p = 1\\))</h3>\n                        <div class=\"bar-chart\" id=\"probChart\">\n                            </div>\n                    </div>\n                </div>\n\n                <div class=\"calc-details\">\n                    <div class=\"detail-row\">\n                        <span>Sum of Exponentials (\\(\\sum e^{z_j}\\)):</span>\n                        <span id=\"sumExpVal\" class=\"highlight-val\">0.00</span>\n                    </div>\n                    <div class=\"detail-row\">\n                        <span>Highest Probability:</span>\n                        <span id=\"maxProbVal\" class=\"highlight-val\">0.0%</span>\n                    </div>\n                </div>\n            </div>\n\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": ":root {\n    --primary-color: #3498db;\n    --secondary-color: #9b59b6;\n    --accent-color: #e74c3c;\n    --bg-color: #f4f7f6;\n    --panel-bg: #ffffff;\n    --text-color: #2c3e50;\n    --chart-bg: #ecf0f1;\n}\n\nbody {\n    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    margin: 0;\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n    min-height: 100vh;\n}\n\n.container {\n    max-width: 1100px;\n    width: 100%;\n    background: var(--panel-bg);\n    border-radius: 12px;\n    box-shadow: 0 10px 25px rgba(0,0,0,0.1);\n    padding: 25px;\n    display: flex;\n    flex-direction: column;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 25px;\n    border-bottom: 2px solid #eee;\n    padding-bottom: 10px;\n}\n\nh1 { margin: 0; }\n.formula-box { font-size: 1.2rem; margin: 10px 0; }\n.subtitle { color: #7f8c8d; font-size: 0.9rem; }\n\n.simulation-layout {\n    display: flex;\n    gap: 30px;\n    flex-wrap: wrap;\n}\n\n/* Controls Panel */\n.controls-panel {\n    flex: 1;\n    min-width: 300px;\n    background: #fafafa;\n    padding: 20px;\n    border-radius: 8px;\n    border: 1px solid #eee;\n}\n\n.panel-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 15px;\n}\n\n.panel-header h3 { margin: 0; font-size: 1.1rem; }\n\n.action-btn {\n    background: white;\n    border: 1px solid #ccc;\n    padding: 5px 10px;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 0.8rem;\n    transition: background 0.2s;\n}\n.action-btn:hover { background: #eee; }\n\n.sliders-container {\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n}\n\n.input-group {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\n.class-label {\n    font-weight: bold;\n    width: 30px;\n    color: var(--text-color);\n}\n\n.input-slider {\n    flex-grow: 1;\n    cursor: pointer;\n}\n\n.logit-val {\n    font-family: monospace;\n    width: 40px;\n    text-align: right;\n    color: var(--primary-color);\n}\n\n.temp-control {\n    margin-top: 25px;\n    padding-top: 15px;\n    border-top: 1px solid #ddd;\n}\n.note { font-size: 0.75rem; color: #888; margin-top: 5px; font-style: italic; }\n\n/* Visualization Panel */\n.viz-panel {\n    flex: 2;\n    min-width: 400px;\n    display: flex;\n    flex-direction: column;\n}\n\n.charts-wrapper {\n    display: flex;\n    align-items: center; /* Center arrow vertically */\n    justify-content: space-between;\n    height: 300px;\n    margin-bottom: 20px;\n}\n\n.chart-column {\n    flex: 1;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n}\n\n.chart-column h3 {\n    text-align: center;\n    font-size: 1rem;\n    color: #555;\n    margin-bottom: 10px;\n}\n\n.bar-chart {\n    flex-grow: 1;\n    background: var(--chart-bg);\n    border-radius: 8px;\n    display: flex;\n    align-items: flex-end; /* Bars grow from bottom */\n    justify-content: space-around;\n    padding: 10px;\n    position: relative;\n    border-bottom: 2px solid #ccc;\n}\n\n.bar-wrapper {\n    width: 15%;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: flex-end;\n    height: 100%;\n    position: relative;\n}\n\n.bar {\n    width: 100%;\n    background-color: var(--primary-color);\n    border-radius: 4px 4px 0 0;\n    transition: height 0.3s cubic-bezier(0.25, 0.8, 0.25, 1), background-color 0.3s;\n    min-height: 2px; /* Ensure visibility */\n    position: relative;\n}\n\n/* Tooltip for value */\n.bar-value {\n    position: absolute;\n    top: -20px;\n    font-size: 0.75rem;\n    font-weight: bold;\n    color: #333;\n    width: 100%;\n    text-align: center;\n}\n\n/* Colors for specific classes to distinguish them */\n.bar-0 { background-color: #e74c3c; }\n.bar-1 { background-color: #3498db; }\n.bar-2 { background-color: #f1c40f; }\n.bar-3 { background-color: #2ecc71; }\n.bar-4 { background-color: #9b59b6; }\n\n/* Operator Arrow */\n.math-operator {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 0 15px;\n    color: #7f8c8d;\n}\n\n.arrow { font-size: 2rem; }\n.op-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; }\n\n/* Calculation Details */\n.calc-details {\n    background: #fdfdfd;\n    border: 1px solid #eee;\n    padding: 15px;\n    border-radius: 6px;\n    display: flex;\n    justify-content: space-around;\n}\n\n.detail-row {\n    font-size: 0.9rem;\n    color: #555;\n}\n\n.highlight-val {\n    font-weight: bold;\n    color: var(--text-color);\n    font-family: monospace;\n    margin-left: 5px;\n}\n\n@media (max-width: 768px) {\n    .simulation-layout { flex-direction: column; }\n    .charts-wrapper { flex-direction: column; height: auto; gap: 20px; }\n    .bar-chart { height: 200px; width: 100%; }\n    .arrow { transform: rotate(90deg); }\n}", "js": "// Configuration\nconst NUM_CLASSES = 5;\nconst INITIAL_LOGITS = [2.0, 1.0, 0.1, 1.5, -1.0];\nlet temperature = 1.0;\n\n// DOM Elements\nconst slidersContainer = document.getElementById('slidersContainer');\nconst logitChart = document.getElementById('logitChart');\nconst probChart = document.getElementById('probChart');\nconst sumExpVal = document.getElementById('sumExpVal');\nconst maxProbVal = document.getElementById('maxProbVal');\nconst tempInput = document.getElementById('tempInput');\nconst tempVal = document.getElementById('tempVal');\nconst randomizeBtn = document.getElementById('randomizeBtn');\nconst resetBtn = document.getElementById('resetBtn');\n\n// State\nlet logits = [...INITIAL_LOGITS];\n\n// Initialization\nfunction init() {\n    createInputs();\n    createBars(logitChart, 'logit');\n    createBars(probChart, 'prob');\n    updateSimulation();\n}\n\n// Create Slider Inputs\nfunction createInputs() {\n    slidersContainer.innerHTML = '';\n    logits.forEach((val, i) => {\n        const div = document.createElement('div');\n        div.className = 'input-group';\n        div.innerHTML = `\n            <span class=\"class-label\">z<sub>${i}</sub></span>\n            <input type=\"range\" min=\"-5\" max=\"5\" step=\"0.1\" value=\"${val}\" data-index=\"${i}\" class=\"input-slider\">\n            <span class=\"logit-val\" id=\"logit-val-${i}\">${val.toFixed(1)}</span>\n        `;\n        slidersContainer.appendChild(div);\n    });\n\n    // Add event listeners to new sliders\n    document.querySelectorAll('.input-slider').forEach(slider => {\n        slider.addEventListener('input', (e) => {\n            const idx = parseInt(e.target.dataset.index);\n            const val = parseFloat(e.target.value);\n            logits[idx] = val;\n            \n            // Update text display\n            document.getElementById(`logit-val-${idx}`).textContent = val.toFixed(1);\n            \n            updateSimulation();\n        });\n    });\n}\n\n// Create Visual Bars (Empty structure)\nfunction createBars(container, type) {\n    container.innerHTML = '';\n    for (let i = 0; i < NUM_CLASSES; i++) {\n        const wrapper = document.createElement('div');\n        wrapper.className = 'bar-wrapper';\n        \n        const valueDisplay = document.createElement('span');\n        valueDisplay.className = 'bar-value';\n        valueDisplay.id = `${type}-text-${i}`;\n        \n        const bar = document.createElement('div');\n        bar.className = `bar bar-${i}`;\n        bar.id = `${type}-bar-${i}`;\n        \n        wrapper.appendChild(valueDisplay);\n        wrapper.appendChild(bar);\n        container.appendChild(wrapper);\n    }\n}\n\n// Core Logic & Animation Update\nfunction updateSimulation() {\n    // 1. Calculate Exponentials\n    // Apply Temperature: z_i / T\n    const expValues = logits.map(z => Math.exp(z / temperature));\n    \n    // 2. Calculate Sum\n    const sumExp = expValues.reduce((a, b) => a + b, 0);\n    \n    // 3. Calculate Probabilities\n    const probs = expValues.map(v => v / sumExp);\n\n    // 4. Update UI - Logit Chart (Relative visualization)\n    // To visualize negative and positive logits nicely, we map them to percentage height\n    // Range [-5, 5] -> [0%, 100%] roughly for visual check\n    const minLogit = -5;\n    const maxLogit = 5;\n    \n    logits.forEach((z, i) => {\n        const bar = document.getElementById(`logit-bar-${i}`);\n        const text = document.getElementById(`logit-text-${i}`);\n        \n        // Normalize for visual height (simple linear map)\n        let percent = ((z - minLogit) / (maxLogit - minLogit)) * 100;\n        percent = Math.max(5, Math.min(100, percent)); // Clamp\n        \n        bar.style.height = `${percent}%`;\n        text.textContent = z.toFixed(1);\n        \n        // Visual cue: fade out bars if their logit is very low relative to others? \n        // No, keep opacity 1. Just height indicates value.\n    });\n\n    // 5. Update UI - Probability Chart\n    probs.forEach((p, i) => {\n        const bar = document.getElementById(`prob-bar-${i}`);\n        const text = document.getElementById(`prob-text-${i}`);\n        \n        // Prob is 0 to 1, map to 0% to 100% height\n        const heightPercent = Math.max(1, p * 100); // Min 1% visibility\n        \n        bar.style.height = `${heightPercent}%`;\n        text.textContent = (p * 100).toFixed(1) + '%';\n        \n        // Highlight the \"Winner\"\n        if (p === Math.max(...probs)) {\n            bar.style.filter = 'brightness(1.1)';\n            bar.style.boxShadow = '0 0 10px rgba(0,0,0,0.2)';\n        } else {\n            bar.style.filter = 'none';\n            bar.style.boxShadow = 'none';\n        }\n    });\n\n    // 6. Update Stats\n    sumExpVal.textContent = sumExp.toFixed(2);\n    const maxP = Math.max(...probs) * 100;\n    maxProbVal.textContent = maxP.toFixed(1) + '%';\n}\n\n// Event Listeners for Controls\ntempInput.addEventListener('input', (e) => {\n    temperature = parseFloat(e.target.value);\n    tempVal.textContent = temperature.toFixed(1);\n    updateSimulation();\n});\n\nrandomizeBtn.addEventListener('click', () => {\n    logits = logits.map(() => (Math.random() * 8 - 4)); // Random between -4 and 4\n    \n    // Update sliders and text\n    logits.forEach((val, i) => {\n        const slider = document.querySelector(`input[data-index=\"${i}\"]`);\n        slider.value = val;\n        document.getElementById(`logit-val-${i}`).textContent = val.toFixed(1);\n    });\n    \n    updateSimulation();\n});\n\nresetBtn.addEventListener('click', () => {\n    logits = [...INITIAL_LOGITS];\n    temperature = 1.0;\n    tempInput.value = 1.0;\n    tempVal.textContent = \"1.0\";\n    \n    // Reset sliders\n    logits.forEach((val, i) => {\n        const slider = document.querySelector(`input[data-index=\"${i}\"]`);\n        slider.value = val;\n        document.getElementById(`logit-val-${i}`).textContent = val.toFixed(1);\n    });\n    \n    updateSimulation();\n});\n\n// Start\ninit();"}}
{"input": {"input_text": "Gradient descent update for parameter w with learning rate alpha and gradient g: w_new = w - alpha*g.", "simulation_name": " Gradient Descent", "domain": "Machine Learning", "description": "Single-step gradient descent", "assumptions": ["Scalar parameter"], "entities": [], "constants": [], "parameters": [{"name": "weight", "symbol": "w", "unit": "dimensionless", "range": [-1000000.0, 1000000.0]}, {"name": "learning_rate", "symbol": "alpha", "unit": "dimensionless", "range": [1e-09, 1]}, {"name": "gradient", "symbol": "g", "unit": "dimensionless", "range": [-1000000.0, 1000000.0]}], "equations": [{"description": "Update", "expression": "w_new = w - alpha*g"}], "initial_conditions": {}, "outputs": ["w_new"], "simulation_controls": ["w", "alpha", "g"], "constraints": ["alpha>=0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S96 Gradient Descent</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1>Gradient Descent Optimizer</h1>\n            <p class=\"equation\">w<sub>new</sub> = w - α · g</p>\n        </header>\n\n        <div class=\"main-grid\">\n            <div class=\"left-panel\">\n                <div class=\"card control-card\">\n                    <h2>Parameters</h2>\n                    \n                    <div class=\"param-group\">\n                        <label>\n                            <span class=\"label-text\">Current Weight (w)</span>\n                            <input type=\"number\" id=\"weight\" value=\"5\" step=\"0.1\">\n                        </label>\n                    </div>\n\n                    <div class=\"param-group\">\n                        <label>\n                            <span class=\"label-text\">Learning Rate (α)</span>\n                            <input type=\"number\" id=\"alpha\" value=\"0.1\" step=\"0.01\" min=\"0\">\n                        </label>\n                        <input type=\"range\" id=\"alphaSlider\" min=\"0.001\" max=\"1\" step=\"0.001\" value=\"0.1\">\n                        <div class=\"slider-labels\">\n                            <span>0.001</span>\n                            <span>1.0</span>\n                        </div>\n                    </div>\n\n                    <div class=\"param-group\">\n                        <label>\n                            <span class=\"label-text\">Gradient (g)</span>\n                            <input type=\"number\" id=\"gradient\" value=\"2\" step=\"0.1\">\n                        </label>\n                    </div>\n\n                    <button id=\"stepBtn\" class=\"btn btn-primary\">Single Step</button>\n                    <button id=\"resetBtn\" class=\"btn btn-secondary\">Reset</button>\n                </div>\n\n                <div class=\"card result-card\">\n                    <h2>Update Result</h2>\n                    <div class=\"result-item\">\n                        <span class=\"result-label\">w<sub>old</sub>:</span>\n                        <span class=\"result-value\" id=\"wOld\">5.000</span>\n                    </div>\n                    <div class=\"result-item\">\n                        <span class=\"result-label\">α · g:</span>\n                        <span class=\"result-value\" id=\"stepSize\">0.200</span>\n                    </div>\n                    <div class=\"result-item highlight\">\n                        <span class=\"result-label\">w<sub>new</sub>:</span>\n                        <span class=\"result-value\" id=\"wNew\">4.800</span>\n                    </div>\n                    <div class=\"result-item\">\n                        <span class=\"result-label\">Change:</span>\n                        <span class=\"result-value\" id=\"change\">-0.200</span>\n                    </div>\n                </div>\n\n                <div class=\"card info-card\">\n                    <h2>Loss Function Demo</h2>\n                    <div class=\"loss-selector\">\n                        <label>\n                            <input type=\"radio\" name=\"lossFunc\" value=\"quadratic\" checked>\n                            Quadratic: L = (w - 2)²\n                        </label>\n                        <label>\n                            <input type=\"radio\" name=\"lossFunc\" value=\"sine\">\n                            Sine: L = sin(w) + 2\n                        </label>\n                        <label>\n                            <input type=\"radio\" name=\"lossFunc\" value=\"abs\">\n                            Absolute: L = |w - 3|\n                        </label>\n                    </div>\n                    <button id=\"autoOptimize\" class=\"btn btn-auto\">Auto Optimize (20 steps)</button>\n                    <button id=\"clearHistory\" class=\"btn btn-clear\">Clear History</button>\n                </div>\n            </div>\n\n            <div class=\"right-panel\">\n                <div class=\"card viz-card\">\n                    <h3>Loss Landscape & Trajectory</h3>\n                    <canvas id=\"lossCanvas\"></canvas>\n                </div>\n\n                <div class=\"card viz-card\">\n                    <h3>Weight Evolution</h3>\n                    <canvas id=\"weightCanvas\"></canvas>\n                </div>\n\n                <div class=\"card viz-card\">\n                    <h3>Step Size History</h3>\n                    <canvas id=\"stepCanvas\"></canvas>\n                </div>\n\n                <div class=\"card stats-card\">\n                    <h3>Optimization Statistics</h3>\n                    <div class=\"stats-grid\">\n                        <div class=\"stat-item\">\n                            <div class=\"stat-label\">Steps Taken</div>\n                            <div class=\"stat-value\" id=\"stepCount\">0</div>\n                        </div>\n                        <div class=\"stat-item\">\n                            <div class=\"stat-label\">Current Loss</div>\n                            <div class=\"stat-value\" id=\"currentLoss\">-</div>\n                        </div>\n                        <div class=\"stat-item\">\n                            <div class=\"stat-label\">Min Loss</div>\n                            <div class=\"stat-value\" id=\"minLoss\">-</div>\n                        </div>\n                        <div class=\"stat-item\">\n                            <div class=\"stat-label\">Convergence</div>\n                            <div class=\"stat-value\" id=\"convergence\">-</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);\n    min-height: 100vh;\n    padding: 20px;\n    color: #333;\n}\n\n.container {\n    max-width: 1600px;\n    margin: 0 auto;\n}\n\nheader {\n    text-align: center;\n    color: white;\n    margin-bottom: 30px;\n    animation: fadeIn 0.8s ease-out;\n}\n\nheader h1 {\n    font-size: 3.5rem;\n    margin-bottom: 15px;\n    text-shadow: 3px 3px 10px rgba(0,0,0,0.5);\n    font-weight: 700;\n    background: linear-gradient(45deg, #00d2ff, #3a7bd5);\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n    background-clip: text;\n}\n\n.equation {\n    font-size: 1.8rem;\n    font-family: 'Courier New', monospace;\n    background: rgba(255,255,255,0.1);\n    padding: 15px 30px;\n    border-radius: 15px;\n    display: inline-block;\n    backdrop-filter: blur(10px);\n    border: 2px solid rgba(255,255,255,0.2);\n}\n\n.main-grid {\n    display: grid;\n    grid-template-columns: 400px 1fr;\n    gap: 25px;\n}\n\n.left-panel {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.right-panel {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 20px;\n}\n\n.card {\n    background: white;\n    border-radius: 20px;\n    padding: 25px;\n    box-shadow: 0 15px 50px rgba(0,0,0,0.4);\n    animation: slideUp 0.6s ease-out;\n}\n\n.card h2 {\n    color: #2c5364;\n    margin-bottom: 20px;\n    font-size: 1.6rem;\n    border-bottom: 3px solid #3a7bd5;\n    padding-bottom: 10px;\n}\n\n.card h3 {\n    color: #2c5364;\n    margin-bottom: 15px;\n    font-size: 1.3rem;\n    text-align: center;\n}\n\n.param-group {\n    margin-bottom: 25px;\n}\n\n.label-text {\n    display: block;\n    font-weight: 600;\n    color: #555;\n    margin-bottom: 8px;\n    font-size: 1.05rem;\n}\n\ninput[type=\"number\"] {\n    width: 100%;\n    padding: 12px;\n    border: 2px solid #ddd;\n    border-radius: 10px;\n    font-size: 1.1rem;\n    transition: all 0.3s ease;\n    font-weight: 600;\n}\n\ninput[type=\"number\"]:focus {\n    outline: none;\n    border-color: #3a7bd5;\n    box-shadow: 0 0 0 4px rgba(58,123,213,0.1);\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    height: 8px;\n    border-radius: 5px;\n    background: linear-gradient(to right, #00d2ff, #3a7bd5);\n    outline: none;\n    -webkit-appearance: none;\n    margin: 10px 0 5px 0;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 24px;\n    height: 24px;\n    border-radius: 50%;\n    background: white;\n    cursor: pointer;\n    box-shadow: 0 3px 10px rgba(0,0,0,0.3);\n    border: 3px solid #3a7bd5;\n    transition: transform 0.2s;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb:hover {\n    transform: scale(1.2);\n}\n\ninput[type=\"range\"]::-moz-range-thumb {\n    width: 24px;\n    height: 24px;\n    border-radius: 50%;\n    background: white;\n    cursor: pointer;\n    box-shadow: 0 3px 10px rgba(0,0,0,0.3);\n    border: 3px solid #3a7bd5;\n}\n\n.slider-labels {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.85rem;\n    color: #888;\n}\n\n.btn {\n    width: 100%;\n    padding: 15px;\n    border: none;\n    border-radius: 12px;\n    font-size: 1.15rem;\n    font-weight: 700;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    margin-bottom: 10px;\n    text-transform: uppercase;\n    letter-spacing: 1px;\n}\n\n.btn-primary {\n    background: linear-gradient(135deg, #00d2ff, #3a7bd5);\n    color: white;\n}\n\n.btn-primary:hover {\n    transform: translateY(-3px);\n    box-shadow: 0 10px 25px rgba(58,123,213,0.4);\n}\n\n.btn-primary:active {\n    transform: translateY(0);\n}\n\n.btn-secondary {\n    background: #e74c3c;\n    color: white;\n}\n\n.btn-secondary:hover {\n    background: #c0392b;\n    transform: translateY(-3px);\n}\n\n.btn-auto {\n    background: linear-gradient(135deg, #f093fb, #f5576c);\n    color: white;\n}\n\n.btn-auto:hover {\n    transform: translateY(-3px);\n    box-shadow: 0 10px 25px rgba(245,87,108,0.4);\n}\n\n.btn-clear {\n    background: #95a5a6;\n    color: white;\n}\n\n.btn-clear:hover {\n    background: #7f8c8d;\n    transform: translateY(-3px);\n}\n\n.result-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 15px;\n    background: #f8f9fa;\n    border-radius: 10px;\n    margin-bottom: 12px;\n    border-left: 4px solid #3a7bd5;\n    transition: transform 0.2s;\n}\n\n.result-item:hover {\n    transform: translateX(5px);\n}\n\n.result-item.highlight {\n    background: linear-gradient(135deg, #e8f4f8, #d4e9f7);\n    border-left-color: #00d2ff;\n    font-size: 1.1rem;\n}\n\n.result-label {\n    font-weight: 600;\n    color: #555;\n}\n\n.result-value {\n    font-weight: 700;\n    font-size: 1.3rem;\n    color: #2c5364;\n    font-family: 'Courier New', monospace;\n}\n\n.loss-selector {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n    margin-bottom: 20px;\n}\n\n.loss-selector label {\n    display: flex;\n    align-items: center;\n    padding: 12px;\n    background: #f8f9fa;\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    font-size: 0.95rem;\n}\n\n.loss-selector label:hover {\n    background: #e9ecef;\n    transform: translateX(5px);\n}\n\n.loss-selector input[type=\"radio\"] {\n    margin-right: 10px;\n    cursor: pointer;\n}\n\n.viz-card {\n    background: white;\n}\n\n.viz-card:nth-child(1) {\n    grid-column: 1 / -1;\n}\n\ncanvas {\n    width: 100% !important;\n    height: 100% !important;\n    display: block;\n    border-radius: 10px;\n}\n\n.viz-card canvas {\n    height: 300px !important;\n}\n\n.viz-card:nth-child(1) canvas {\n    height: 350px !important;\n}\n\n.stats-card {\n    grid-column: 1 / -1;\n}\n\n.stats-grid {\n    display: grid;\n    grid-template-columns: repeat(4, 1fr);\n    gap: 15px;\n}\n\n.stat-item {\n    text-align: center;\n    padding: 20px;\n    background: linear-gradient(135deg, #f5f7fa, #c3cfe2);\n    border-radius: 12px;\n    transition: transform 0.3s ease;\n}\n\n.stat-item:hover {\n    transform: translateY(-5px);\n}\n\n.stat-label {\n    font-size: 0.9rem;\n    color: #555;\n    margin-bottom: 10px;\n    font-weight: 600;\n}\n\n.stat-value {\n    font-size: 1.8rem;\n    font-weight: 700;\n    color: #2c5364;\n    font-family: 'Courier New', monospace;\n}\n\n@keyframes fadeIn {\n    from {\n        opacity: 0;\n        transform: translateY(-20px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n@keyframes slideUp {\n    from {\n        opacity: 0;\n        transform: translateY(30px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n@keyframes pulse {\n    0%, 100% {\n        transform: scale(1);\n    }\n    50% {\n        transform: scale(1.05);\n    }\n}\n\n.btn:active {\n    animation: pulse 0.3s ease;\n}\n\n@media (max-width: 1400px) {\n    .main-grid {\n        grid-template-columns: 1fr;\n    }\n    \n    .right-panel {\n        grid-template-columns: 1fr;\n    }\n    \n    .stats-grid {\n        grid-template-columns: repeat(2, 1fr);\n    }\n}\n\n@media (max-width: 768px) {\n    header h1 {\n        font-size: 2rem;\n    }\n    \n    .equation {\n        font-size: 1.2rem;\n    }\n    \n    .stats-grid {\n        grid-template-columns: 1fr;\n    }\n}", "js": "// Loss functions and their gradients\nconst lossFunctions = {\n    quadratic: {\n        loss: (w) => Math.pow(w - 2, 2),\n        gradient: (w) => 2 * (w - 2),\n        name: 'Quadratic',\n        range: [-2, 6]\n    },\n    sine: {\n        loss: (w) => Math.sin(w) + 2,\n        gradient: (w) => Math.cos(w),\n        name: 'Sine',\n        range: [-8, 8]\n    },\n    abs: {\n        loss: (w) => Math.abs(w - 3),\n        gradient: (w) => w > 3 ? 1 : (w < 3 ? -1 : 0),\n        name: 'Absolute',\n        range: [-2, 8]\n    }\n};\n\n// Global state\nlet currentLossFunction = 'quadratic';\nlet history = {\n    weights: [],\n    losses: [],\n    stepSizes: [],\n    steps: 0\n};\n\n// Canvas managers\nclass CanvasChart {\n    constructor(canvasId) {\n        this.canvas = document.getElementById(canvasId);\n        this.ctx = this.canvas.getContext('2d');\n        this.setupCanvas();\n    }\n\n    setupCanvas() {\n        const rect = this.canvas.getBoundingClientRect();\n        this.canvas.width = rect.width;\n        this.canvas.height = rect.height;\n    }\n\n    clear() {\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n\n    drawAxes(padding, maxX, maxY, minY = 0) {\n        const ctx = this.ctx;\n        const w = this.canvas.width;\n        const h = this.canvas.height;\n\n        ctx.strokeStyle = '#333';\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.moveTo(padding, padding);\n        ctx.lineTo(padding, h - padding);\n        ctx.lineTo(w - padding, h - padding);\n        ctx.stroke();\n\n        // Grid\n        ctx.strokeStyle = '#e0e0e0';\n        ctx.lineWidth = 1;\n        for (let i = 0; i <= 5; i++) {\n            const y = padding + (h - 2 * padding) * i / 5;\n            ctx.beginPath();\n            ctx.moveTo(padding, y);\n            ctx.lineTo(w - padding, y);\n            ctx.stroke();\n        }\n    }\n}\n\nclass LossLandscape extends CanvasChart {\n    draw(currentW) {\n        this.clear();\n        const ctx = this.ctx;\n        const w = this.canvas.width;\n        const h = this.canvas.height;\n        const padding = 60;\n\n        const lossFunc = lossFunctions[currentLossFunction];\n        const [minW, maxW] = lossFunc.range;\n        \n        // Calculate loss values\n        const points = 200;\n        const wValues = [];\n        const lossValues = [];\n        let maxLoss = -Infinity;\n        let minLoss = Infinity;\n\n        for (let i = 0; i <= points; i++) {\n            const weight = minW + (maxW - minW) * i / points;\n            const loss = lossFunc.loss(weight);\n            wValues.push(weight);\n            lossValues.push(loss);\n            maxLoss = Math.max(maxLoss, loss);\n            minLoss = Math.min(minLoss, loss);\n        }\n\n        // Draw axes\n        ctx.strokeStyle = '#333';\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.moveTo(padding, padding);\n        ctx.lineTo(padding, h - padding);\n        ctx.lineTo(w - padding, h - padding);\n        ctx.stroke();\n\n        // Grid\n        ctx.strokeStyle = '#e0e0e0';\n        ctx.lineWidth = 1;\n        for (let i = 0; i <= 5; i++) {\n            const y = padding + (h - 2 * padding) * i / 5;\n            ctx.beginPath();\n            ctx.moveTo(padding, y);\n            ctx.lineTo(w - padding, y);\n            ctx.stroke();\n        }\n\n        // Draw loss curve\n        const gradient = ctx.createLinearGradient(0, padding, 0, h - padding);\n        gradient.addColorStop(0, '#3a7bd5');\n        gradient.addColorStop(1, '#00d2ff');\n        \n        ctx.strokeStyle = gradient;\n        ctx.lineWidth = 3;\n        ctx.beginPath();\n\n        for (let i = 0; i <= points; i++) {\n            const x = padding + (w - 2 * padding) * (wValues[i] - minW) / (maxW - minW);\n            const y = h - padding - (h - 2 * padding) * (lossValues[i] - minLoss) / (maxLoss - minLoss);\n            \n            if (i === 0) ctx.moveTo(x, y);\n            else ctx.lineTo(x, y);\n        }\n        ctx.stroke();\n\n        // Draw trajectory\n        if (history.weights.length > 1) {\n            ctx.strokeStyle = 'rgba(231, 76, 60, 0.8)';\n            ctx.lineWidth = 2;\n            ctx.setLineDash([5, 5]);\n            ctx.beginPath();\n\n            for (let i = 0; i < history.weights.length; i++) {\n                const weight = history.weights[i];\n                if (weight >= minW && weight <= maxW) {\n                    const loss = history.losses[i];\n                    const x = padding + (w - 2 * padding) * (weight - minW) / (maxW - minW);\n                    const y = h - padding - (h - 2 * padding) * (loss - minLoss) / (maxLoss - minLoss);\n                    \n                    if (i === 0) ctx.moveTo(x, y);\n                    else ctx.lineTo(x, y);\n                }\n            }\n            ctx.stroke();\n            ctx.setLineDash([]);\n\n            // Draw points\n            history.weights.forEach((weight, i) => {\n                if (weight >= minW && weight <= maxW) {\n                    const loss = history.losses[i];\n                    const x = padding + (w - 2 * padding) * (weight - minW) / (maxW - minW);\n                    const y = h - padding - (h - 2 * padding) * (loss - minLoss) / (maxLoss - minLoss);\n                    \n                    ctx.fillStyle = i === history.weights.length - 1 ? '#e74c3c' : 'rgba(231, 76, 60, 0.5)';\n                    ctx.beginPath();\n                    ctx.arc(x, y, i === history.weights.length - 1 ? 8 : 5, 0, 2 * Math.PI);\n                    ctx.fill();\n                }\n            });\n        }\n\n        // Draw current position\n        if (currentW >= minW && currentW <= maxW) {\n            const currentLoss = lossFunc.loss(currentW);\n            const x = padding + (w - 2 * padding) * (currentW - minW) / (maxW - minW);\n            const y = h - padding - (h - 2 * padding) * (currentLoss - minLoss) / (maxLoss - minLoss);\n\n            ctx.fillStyle = '#f5576c';\n            ctx.strokeStyle = 'white';\n            ctx.lineWidth = 3;\n            ctx.beginPath();\n            ctx.arc(x, y, 10, 0, 2 * Math.PI);\n            ctx.fill();\n            ctx.stroke();\n        }\n\n        // Labels\n        ctx.fillStyle = '#333';\n        ctx.font = 'bold 14px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.fillText('Weight (w)', w / 2, h - 10);\n        \n        ctx.save();\n        ctx.translate(15, h / 2);\n        ctx.rotate(-Math.PI / 2);\n        ctx.fillText('Loss', 0, 0);\n        ctx.restore();\n\n        // Axis values\n        ctx.font = '12px sans-serif';\n        ctx.fillText(minW.toFixed(1), padding, h - padding + 20);\n        ctx.fillText(maxW.toFixed(1), w - padding, h - padding + 20);\n        ctx.textAlign = 'right';\n        ctx.fillText(maxLoss.toFixed(2), padding - 5, padding + 5);\n        ctx.fillText(minLoss.toFixed(2), padding - 5, h - padding + 5);\n    }\n}\n\nclass WeightEvolution extends CanvasChart {\n    draw() {\n        this.clear();\n        const ctx = this.ctx;\n        const w = this.canvas.width;\n        const h = this.canvas.height;\n        const padding = 50;\n\n        if (history.weights.length === 0) {\n            ctx.fillStyle = '#999';\n            ctx.font = '16px sans-serif';\n            ctx.textAlign = 'center';\n            ctx.fillText('No data yet', w / 2, h / 2);\n            return;\n        }\n\n        this.drawAxes(padding, history.steps, Math.max(...history.weights), Math.min(...history.weights));\n\n        const maxW = Math.max(...history.weights);\n        const minW = Math.min(...history.weights);\n        const range = maxW - minW || 1;\n\n        // Draw line\n        const gradient = ctx.createLinearGradient(0, 0, w, 0);\n        gradient.addColorStop(0, '#00d2ff');\n        gradient.addColorStop(1, '#3a7bd5');\n        \n        ctx.strokeStyle = gradient;\n        ctx.lineWidth = 3;\n        ctx.beginPath();\n\n        history.weights.forEach((weight, i) => {\n            const x = padding + (w - 2 * padding) * i / Math.max(history.steps, 1);\n            const y = h - padding - (h - 2 * padding) * (weight - minW) / range;\n            \n            if (i === 0) ctx.moveTo(x, y);\n            else ctx.lineTo(x, y);\n        });\n        ctx.stroke();\n\n        // Draw points\n        history.weights.forEach((weight, i) => {\n            const x = padding + (w - 2 * padding) * i / Math.max(history.steps, 1);\n            const y = h - padding - (h - 2 * padding) * (weight - minW) / range;\n            \n            ctx.fillStyle = i === history.weights.length - 1 ? '#f5576c' : '#3a7bd5';\n            ctx.beginPath();\n            ctx.arc(x, y, i === history.weights.length - 1 ? 6 : 4, 0, 2 * Math.PI);\n            ctx.fill();\n        });\n\n        // Labels\n        ctx.fillStyle = '#333';\n        ctx.font = 'bold 14px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.fillText('Step', w / 2, h - 10);\n        \n        ctx.save();\n        ctx.translate(15, h / 2);\n        ctx.rotate(-Math.PI / 2);\n        ctx.fillText('Weight', 0, 0);\n        ctx.restore();\n    }\n}\n\nclass StepSizeHistory extends CanvasChart {\n    draw() {\n        this.clear();\n        const ctx = this.ctx;\n        const w = this.canvas.width;\n        const h = this.canvas.height;\n        const padding = 50;\n\n        if (history.stepSizes.length === 0) {\n            ctx.fillStyle = '#999';\n            ctx.font = '16px sans-serif';\n            ctx.textAlign = 'center';\n            ctx.fillText('No data yet', w / 2, h / 2);\n            return;\n        }\n\n        const maxStep = Math.max(...history.stepSizes.map(Math.abs));\n        \n        this.drawAxes(padding, history.steps, maxStep, -maxStep);\n\n        // Draw bars\n        history.stepSizes.forEach((step, i) => {\n            const x = padding + (w - 2 * padding) * i / Math.max(history.steps, 1);\n            const barWidth = (w - 2 * padding) / Math.max(history.steps, 1) * 0.8;\n            const centerY = h - padding - (h - 2 * padding) / 2;\n            const barHeight = (h - 2 * padding) / 2 * Math.abs(step) / maxStep;\n            \n            ctx.fillStyle = step < 0 ? 'rgba(58, 123, 213, 0.7)' : 'rgba(231, 76, 60, 0.7)';\n            \n            if (step < 0) {\n                ctx.fillRect(x, centerY - barHeight, barWidth, barHeight);\n            } else {\n                ctx.fillRect(x, centerY, barWidth, barHeight);\n            }\n        });\n\n        // Zero line\n        const centerY = h - padding - (h - 2 * padding) / 2;\n        ctx.strokeStyle = '#333';\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.moveTo(padding, centerY);\n        ctx.lineTo(w - padding, centerY);\n        ctx.stroke();\n\n        // Labels\n        ctx.fillStyle = '#333';\n        ctx.font = 'bold 14px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.fillText('Step', w / 2, h - 10);\n        \n        ctx.save();\n        ctx.translate(15, h / 2);\n        ctx.rotate(-Math.PI / 2);\n        ctx.fillText('Step Size (α·g)', 0, 0);\n        ctx.restore();\n    }\n}\n\n// Initialize charts\nlet lossChart, weightChart, stepChart;\n\nfunction updateCalculation() {\n    const w = parseFloat(document.getElementById('weight').value);\n    const alpha = parseFloat(document.getElementById('alpha').value);\n    const g = parseFloat(document.getElementById('gradient').value);\n\n    const stepSize = alpha * g;\n    const wNew = w - stepSize;\n    const change = wNew - w;\n\n    document.getElementById('wOld').textContent = w.toFixed(3);\n    document.getElementById('stepSize').textContent = stepSize.toFixed(3);\n    document.getElementById('wNew').textContent = wNew.toFixed(3);\n    document.getElementById('change').textContent = change.toFixed(3);\n\n    return { w, alpha, g, wNew, stepSize };\n}\n\nfunction performStep() {\n    const { w, wNew, stepSize } = updateCalculation();\n    const lossFunc = lossFunctions[currentLossFunction];\n    const loss = lossFunc.loss(w);\n\n    // Add to history\n    history.weights.push(w);\n    history.losses.push(loss);\n    history.stepSizes.push(-stepSize);\n    history.steps++;\n\n    // Update weight\n    document.getElementById('weight').value = wNew.toFixed(6);\n\n    // Update displays\n    updateCharts();\n    updateStats();\n}\n\nfunction autoOptimize() {\n    const steps = 20;\n    const alpha = parseFloat(document.getElementById('alpha').value);\n    \n    for (let i = 0; i < steps; i++) {\n        const w = parseFloat(document.getElementById('weight').value);\n        const lossFunc = lossFunctions[currentLossFunction];\n        const g = lossFunc.gradient(w);\n        \n        document.getElementById('gradient').value = g.toFixed(6);\n        performStep();\n    }\n}\n\nfunction updateCharts() {\n    const w = parseFloat(document.getElementById('weight').value);\n    lossChart.draw(w);\n    weightChart.draw();\n    stepChart.draw();\n}\n\nfunction updateStats() {\n    const lossFunc = lossFunctions[currentLossFunction];\n    const currentW = parseFloat(document.getElementById('weight').value);\n    const currentLoss = lossFunc.loss(currentW);\n    const minLoss = history.losses.length > 0 ? Math.min(...history.losses) : currentLoss;\n    \n    document.getElementById('stepCount').textContent = history.steps;\n    document.getElementById('currentLoss').textContent = currentLoss.toFixed(4);\n    document.getElementById('minLoss').textContent = minLoss.toFixed(4);\n    \n    if (history.losses.length >= 2) {\n        const recentChange = Math.abs(history.losses[history.losses.length - 1] - \n                                      history.losses[history.losses.length - 2]);\n        const converged = recentChange < 0.001;\n        document.getElementById('convergence').textContent = converged ? 'Yes' : 'No';\n        document.getElementById('convergence').style.color = converged ? '#27ae60' : '#e74c3c';\n    } else {\n        document.getElementById('convergence').textContent = '-';\n    }\n}\n\nfunction reset() {\n    document.getElementById('weight').value = '5';\n    document.getElementById('alpha').value = '0.1';\n    document.getElementById('alphaSlider').value = '0.1';\n    document.getElementById('gradient').value = '2';\n    \n    history = {\n        weights: [],\n        losses: [],\n        stepSizes: [],\n        steps: 0\n    };\n    \n    updateCalculation();\n    updateCharts();\n    updateStats();\n}\n\nfunction clearHistory() {\n    history = {\n        weights: [],\n        losses: [],\n        stepSizes: [],\n        steps: 0\n    };\n    updateCharts();\n    updateStats();\n}\n\n// Event listeners\nwindow.addEventListener('load', () => {\n    lossChart = new LossLandscape('lossCanvas');\n    weightChart = new WeightEvolution('weightCanvas');\n    stepChart = new StepSizeHistory('stepCanvas');\n\n    document.getElementById('weight').addEventListener('input', () => {\n        updateCalculation();\n        updateCharts();\n        updateStats();\n    });\n    \n    document.getElementById('alpha').addEventListener('input', (e) => {\n        document.getElementById('alphaSlider').value = e.target.value;\n        updateCalculation();\n    });\n    \n    document.getElementById('alphaSlider').addEventListener('input', (e) => {\n        document.getElementById('alpha').value = e.target.value;\n        updateCalculation();\n    });\n    \n    document.getElementById('gradient').addEventListener('input', updateCalculation);\n    \n    document.getElementById('stepBtn').addEventListener('click', performStep);\n    document.getElementById('resetBtn').addEventListener('click', reset);\n    document.getElementById('autoOptimize').addEventListener('click', autoOptimize);\n    document.getElementById('clearHistory').addEventListener('click', clearHistory);\n\n    document.querySelectorAll('input[name=\"lossFunc\"]').forEach(radio => {\n        radio.addEventListener('change', (e) => {\n            currentLossFunction = e.target.value;\n            clearHistory();\n            updateCharts();\n        });\n    });\n\n    updateCalculation();\n    updateCharts();\n    updateStats();\n});\n\nwindow.addEventListener('resize', () => {\n    lossChart.setupCanvas();\n    weightChart.setupCanvas();\n    stepChart.setupCanvas();\n    updateCharts();\n});"}}
{"input": {"input_text": "Exponential moving average: m_t = beta*m_{t-1} + (1-beta)*x_t. Provide update equation.", "simulation_name": " Exponential Moving Average", "domain": "Statistics", "description": "EMA recursion", "assumptions": ["0<=beta<1"], "entities": [], "constants": [], "parameters": [{"name": "beta", "symbol": "beta", "unit": "dimensionless", "range": [0, 0.999]}, {"name": "prev_avg", "symbol": "m_prev", "unit": "same as x", "range": [-1000000000.0, 1000000000.0]}, {"name": "current_value", "symbol": "x", "unit": "same as x", "range": [-1000000000.0, 1000000000.0]}], "equations": [{"description": "Update", "expression": "m = beta*m_prev + (1 - beta)*x"}], "initial_conditions": {}, "outputs": ["m"], "simulation_controls": ["beta", "m_prev", "x"], "constraints": ["0<=beta<1"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S97 Exponential Moving Average</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1>Exponential Moving Average</h1>\n            <p class=\"formula\">m<sub>t</sub> = β · m<sub>t-1</sub> + (1 - β) · x<sub>t</sub></p>\n        </header>\n\n        <div class=\"main-layout\">\n            <div class=\"left-column\">\n                <div class=\"card control-card\">\n                    <h2>EMA Parameters</h2>\n                    \n                    <div class=\"param-section\">\n                        <label class=\"param-label\">\n                            <span class=\"label-name\">Decay Factor (β)</span>\n                            <span class=\"label-value\" id=\"betaDisplay\">0.9</span>\n                        </label>\n                        <input type=\"range\" id=\"betaSlider\" min=\"0\" max=\"0.999\" step=\"0.001\" value=\"0.9\">\n                        <div class=\"range-labels\">\n                            <span>0 (no memory)</span>\n                            <span>1 (full memory)</span>\n                        </div>\n                        <div class=\"beta-info\">\n                            <small>Half-life ≈ <span id=\"halfLife\">6.6</span> steps</small>\n                        </div>\n                    </div>\n\n                    <div class=\"param-section\">\n                        <label class=\"param-label\">\n                            <span class=\"label-name\">Previous Average (m<sub>t-1</sub>)</span>\n                        </label>\n                        <input type=\"number\" id=\"prevAvg\" value=\"50\" step=\"0.1\">\n                    </div>\n\n                    <div class=\"param-section\">\n                        <label class=\"param-label\">\n                            <span class=\"label-name\">Current Value (x<sub>t</sub>)</span>\n                        </label>\n                        <input type=\"number\" id=\"currentValue\" value=\"80\" step=\"0.1\">\n                    </div>\n\n                    <button id=\"updateBtn\" class=\"btn btn-primary\">Update EMA</button>\n                    <button id=\"resetBtn\" class=\"btn btn-secondary\">Reset</button>\n                </div>\n\n                <div class=\"card result-card\">\n                    <h2>Calculation Breakdown</h2>\n                    <div class=\"calc-step\">\n                        <span class=\"calc-label\">β · m<sub>t-1</sub></span>\n                        <span class=\"calc-value\" id=\"term1\">45.00</span>\n                    </div>\n                    <div class=\"calc-step\">\n                        <span class=\"calc-label\">(1 - β) · x<sub>t</sub></span>\n                        <span class=\"calc-value\" id=\"term2\">8.00</span>\n                    </div>\n                    <div class=\"calc-divider\"></div>\n                    <div class=\"calc-step result-highlight\">\n                        <span class=\"calc-label\">m<sub>t</sub> (New Average)</span>\n                        <span class=\"calc-value\" id=\"newAvg\">53.00</span>\n                    </div>\n                    <div class=\"calc-step\">\n                        <span class=\"calc-label\">Change</span>\n                        <span class=\"calc-value\" id=\"change\">+3.00</span>\n                    </div>\n                </div>\n\n                <div class=\"card weights-card\">\n                    <h2>Weight Distribution</h2>\n                    <div class=\"weight-bar-container\">\n                        <div class=\"weight-bar\">\n                            <div class=\"weight-fill old-weight\" id=\"oldWeight\" style=\"width: 90%\">\n                                <span class=\"weight-label\">β = 90%</span>\n                            </div>\n                        </div>\n                        <div class=\"weight-bar\">\n                            <div class=\"weight-fill new-weight\" id=\"newWeight\" style=\"width: 10%\">\n                                <span class=\"weight-label\">(1-β) = 10%</span>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"weight-legend\">\n                        <div class=\"legend-item\">\n                            <div class=\"legend-color old-weight\"></div>\n                            <span>Weight on previous average</span>\n                        </div>\n                        <div class=\"legend-item\">\n                            <div class=\"legend-color new-weight\"></div>\n                            <span>Weight on current value</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"right-column\">\n                <div class=\"card viz-card\">\n                    <h3>Time Series with EMA</h3>\n                    <canvas id=\"timeSeriesCanvas\"></canvas>\n                    <div class=\"chart-controls\">\n                        <button id=\"addRandom\" class=\"btn-small\">Add Random Point</button>\n                        <button id=\"addStep\" class=\"btn-small\">Add Step Change</button>\n                        <button id=\"clearSeries\" class=\"btn-small\">Clear Series</button>\n                    </div>\n                </div>\n\n                <div class=\"card viz-card\">\n                    <h3>EMA Response to Input</h3>\n                    <canvas id=\"responseCanvas\"></canvas>\n                </div>\n\n                <div class=\"card viz-card\">\n                    <h3>Weight Decay Over Time</h3>\n                    <canvas id=\"decayCanvas\"></canvas>\n                </div>\n\n                <div class=\"card info-card\">\n                    <h3>EMA Properties</h3>\n                    <div class=\"info-grid\">\n                        <div class=\"info-item\">\n                            <div class=\"info-label\">Effective Window</div>\n                            <div class=\"info-value\" id=\"effectiveWindow\">10</div>\n                        </div>\n                        <div class=\"info-item\">\n                            <div class=\"info-label\">Current EMA</div>\n                            <div class=\"info-value\" id=\"currentEMA\">50.00</div>\n                        </div>\n                        <div class=\"info-item\">\n                            <div class=\"info-label\">Lag Factor</div>\n                            <div class=\"info-value\" id=\"lagFactor\">0.90</div>\n                        </div>\n                        <div class=\"info-item\">\n                            <div class=\"info-label\">Smoothness</div>\n                            <div class=\"info-value\" id=\"smoothness\">High</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    min-height: 100vh;\n    padding: 20px;\n    color: #333;\n}\n\n.container {\n    max-width: 1600px;\n    margin: 0 auto;\n}\n\nheader {\n    text-align: center;\n    color: white;\n    margin-bottom: 30px;\n    animation: slideDown 0.6s ease-out;\n}\n\nheader h1 {\n    font-size: 3.5rem;\n    margin-bottom: 15px;\n    text-shadow: 3px 3px 15px rgba(0,0,0,0.4);\n    font-weight: 700;\n}\n\n.formula {\n    font-size: 2rem;\n    font-family: 'Courier New', monospace;\n    background: rgba(255,255,255,0.15);\n    padding: 20px 40px;\n    border-radius: 15px;\n    display: inline-block;\n    backdrop-filter: blur(10px);\n    border: 2px solid rgba(255,255,255,0.3);\n    box-shadow: 0 8px 32px rgba(0,0,0,0.2);\n}\n\n.main-layout {\n    display: grid;\n    grid-template-columns: 420px 1fr;\n    gap: 25px;\n}\n\n.left-column {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.right-column {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 20px;\n}\n\n.card {\n    background: white;\n    border-radius: 20px;\n    padding: 30px;\n    box-shadow: 0 15px 50px rgba(0,0,0,0.3);\n    animation: fadeInUp 0.6s ease-out;\n}\n\n.card h2 {\n    color: #667eea;\n    margin-bottom: 25px;\n    font-size: 1.6rem;\n    border-bottom: 3px solid #764ba2;\n    padding-bottom: 12px;\n}\n\n.card h3 {\n    color: #667eea;\n    margin-bottom: 20px;\n    font-size: 1.3rem;\n    text-align: center;\n}\n\n.param-section {\n    margin-bottom: 30px;\n}\n\n.param-label {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 10px;\n}\n\n.label-name {\n    font-weight: 600;\n    color: #555;\n    font-size: 1.05rem;\n}\n\n.label-value {\n    font-weight: 700;\n    font-size: 1.4rem;\n    color: #764ba2;\n    font-family: 'Courier New', monospace;\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    height: 10px;\n    border-radius: 5px;\n    background: linear-gradient(to right, #667eea, #764ba2);\n    outline: none;\n    -webkit-appearance: none;\n    margin: 10px 0;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 26px;\n    height: 26px;\n    border-radius: 50%;\n    background: white;\n    cursor: pointer;\n    box-shadow: 0 3px 12px rgba(0,0,0,0.3);\n    border: 4px solid #764ba2;\n    transition: transform 0.2s;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb:hover {\n    transform: scale(1.15);\n}\n\ninput[type=\"range\"]::-moz-range-thumb {\n    width: 26px;\n    height: 26px;\n    border-radius: 50%;\n    background: white;\n    cursor: pointer;\n    box-shadow: 0 3px 12px rgba(0,0,0,0.3);\n    border: 4px solid #764ba2;\n}\n\n.range-labels {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.85rem;\n    color: #888;\n    margin-top: 5px;\n}\n\n.beta-info {\n    margin-top: 10px;\n    padding: 10px;\n    background: linear-gradient(135deg, #f5f7fa, #c3cfe2);\n    border-radius: 8px;\n    text-align: center;\n}\n\n.beta-info small {\n    color: #555;\n    font-weight: 600;\n}\n\n.beta-info span {\n    color: #764ba2;\n    font-weight: 700;\n}\n\ninput[type=\"number\"] {\n    width: 100%;\n    padding: 14px;\n    border: 2px solid #e0e0e0;\n    border-radius: 12px;\n    font-size: 1.2rem;\n    font-weight: 600;\n    transition: all 0.3s ease;\n}\n\ninput[type=\"number\"]:focus {\n    outline: none;\n    border-color: #764ba2;\n    box-shadow: 0 0 0 4px rgba(118,75,162,0.1);\n}\n\n.btn {\n    width: 100%;\n    padding: 16px;\n    border: none;\n    border-radius: 12px;\n    font-size: 1.15rem;\n    font-weight: 700;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    margin-bottom: 10px;\n    text-transform: uppercase;\n    letter-spacing: 1.5px;\n}\n\n.btn-primary {\n    background: linear-gradient(135deg, #667eea, #764ba2);\n    color: white;\n    box-shadow: 0 5px 20px rgba(118,75,162,0.3);\n}\n\n.btn-primary:hover {\n    transform: translateY(-3px);\n    box-shadow: 0 8px 30px rgba(118,75,162,0.5);\n}\n\n.btn-primary:active {\n    transform: translateY(0);\n}\n\n.btn-secondary {\n    background: #e74c3c;\n    color: white;\n}\n\n.btn-secondary:hover {\n    background: #c0392b;\n    transform: translateY(-3px);\n}\n\n.calc-step {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 16px;\n    background: #f8f9fa;\n    border-radius: 10px;\n    margin-bottom: 12px;\n    transition: transform 0.2s;\n}\n\n.calc-step:hover {\n    transform: translateX(5px);\n}\n\n.calc-label {\n    font-weight: 600;\n    color: #555;\n    font-size: 1.05rem;\n}\n\n.calc-value {\n    font-weight: 700;\n    font-size: 1.4rem;\n    color: #667eea;\n    font-family: 'Courier New', monospace;\n}\n\n.calc-divider {\n    height: 2px;\n    background: linear-gradient(to right, transparent, #764ba2, transparent);\n    margin: 15px 0;\n}\n\n.result-highlight {\n    background: linear-gradient(135deg, #e8f4f8, #dbe9f7);\n    border: 2px solid #667eea;\n    font-size: 1.1rem;\n}\n\n.result-highlight .calc-value {\n    font-size: 1.6rem;\n    color: #764ba2;\n}\n\n.weight-bar-container {\n    margin-bottom: 20px;\n}\n\n.weight-bar {\n    height: 50px;\n    background: #f0f0f0;\n    border-radius: 10px;\n    margin-bottom: 15px;\n    overflow: hidden;\n    position: relative;\n}\n\n.weight-fill {\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: width 0.5s ease;\n    position: relative;\n}\n\n.weight-fill.old-weight {\n    background: linear-gradient(135deg, #667eea, #764ba2);\n}\n\n.weight-fill.new-weight {\n    background: linear-gradient(135deg, #f093fb, #f5576c);\n}\n\n.weight-label {\n    color: white;\n    font-weight: 700;\n    font-size: 0.95rem;\n    text-shadow: 1px 1px 3px rgba(0,0,0,0.3);\n}\n\n.weight-legend {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.legend-item {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    font-size: 0.95rem;\n    color: #555;\n}\n\n.legend-color {\n    width: 30px;\n    height: 20px;\n    border-radius: 5px;\n}\n\n.viz-card {\n    background: white;\n}\n\n.viz-card:first-child {\n    grid-column: 1 / -1;\n}\n\ncanvas {\n    width: 100% !important;\n    height: 280px !important;\n    display: block;\n    border-radius: 10px;\n}\n\n.chart-controls {\n    display: flex;\n    gap: 10px;\n    margin-top: 15px;\n    justify-content: center;\n}\n\n.btn-small {\n    padding: 10px 20px;\n    border: none;\n    border-radius: 8px;\n    background: linear-gradient(135deg, #667eea, #764ba2);\n    color: white;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    font-size: 0.9rem;\n}\n\n.btn-small:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 5px 15px rgba(118,75,162,0.4);\n}\n\n.info-card {\n    grid-column: 1 / -1;\n}\n\n.info-grid {\n    display: grid;\n    grid-template-columns: repeat(4, 1fr);\n    gap: 15px;\n}\n\n.info-item {\n    text-align: center;\n    padding: 20px;\n    background: linear-gradient(135deg, #f5f7fa, #c3cfe2);\n    border-radius: 12px;\n    transition: transform 0.3s ease;\n}\n\n.info-item:hover {\n    transform: translateY(-5px);\n}\n\n.info-label {\n    font-size: 0.9rem;\n    color: #666;\n    margin-bottom: 10px;\n    font-weight: 600;\n}\n\n.info-value {\n    font-size: 1.6rem;\n    font-weight: 700;\n    color: #667eea;\n    font-family: 'Courier New', monospace;\n}\n\n@keyframes slideDown {\n    from {\n        opacity: 0;\n        transform: translateY(-30px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n@keyframes fadeInUp {\n    from {\n        opacity: 0;\n        transform: translateY(20px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n@media (max-width: 1400px) {\n    .main-layout {\n        grid-template-columns: 1fr;\n    }\n    \n    .right-column {\n        grid-template-columns: 1fr;\n    }\n    \n    .info-grid {\n        grid-template-columns: repeat(2, 1fr);\n    }\n}\n\n@media (max-width: 768px) {\n    header h1 {\n        font-size: 2rem;\n    }\n    \n    .formula {\n        font-size: 1.2rem;\n        padding: 15px 25px;\n    }\n    \n    .info-grid {\n        grid-template-columns: 1fr;\n    }\n}", "js": "// EMA Calculation\nfunction calculateEMA(beta, mPrev, x) {\n    const term1 = beta * mPrev;\n    const term2 = (1 - beta) * x;\n    const mNew = term1 + term2;\n    const change = mNew - mPrev;\n    \n    return {\n        term1,\n        term2,\n        mNew,\n        change\n    };\n}\n\n// Time series data\nlet timeSeries = {\n    values: [],\n    ema: [],\n    beta: 0.9\n};\n\n// Canvas Chart Base Class\nclass ChartCanvas {\n    constructor(canvasId) {\n        this.canvas = document.getElementById(canvasId);\n        this.ctx = this.canvas.getContext('2d');\n        this.setupCanvas();\n    }\n\n    setupCanvas() {\n        const rect = this.canvas.getBoundingClientRect();\n        this.canvas.width = rect.width;\n        this.canvas.height = rect.height;\n    }\n\n    clear() {\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n\n    drawAxes(padding, minY, maxY) {\n        const ctx = this.ctx;\n        const w = this.canvas.width;\n        const h = this.canvas.height;\n\n        ctx.strokeStyle = '#333';\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.moveTo(padding, padding);\n        ctx.lineTo(padding, h - padding);\n        ctx.lineTo(w - padding, h - padding);\n        ctx.stroke();\n\n        // Grid\n        ctx.strokeStyle = '#e0e0e0';\n        ctx.lineWidth = 1;\n        for (let i = 0; i <= 5; i++) {\n            const y = padding + (h - 2 * padding) * i / 5;\n            ctx.beginPath();\n            ctx.moveTo(padding, y);\n            ctx.lineTo(w - padding, y);\n            ctx.stroke();\n        }\n\n        // Y-axis labels\n        ctx.fillStyle = '#666';\n        ctx.font = '12px sans-serif';\n        ctx.textAlign = 'right';\n        for (let i = 0; i <= 5; i++) {\n            const val = maxY - (maxY - minY) * i / 5;\n            const y = padding + (h - 2 * padding) * i / 5;\n            ctx.fillText(val.toFixed(1), padding - 10, y + 4);\n        }\n    }\n}\n\n// Time Series Chart\nclass TimeSeriesChart extends ChartCanvas {\n    draw() {\n        this.clear();\n        const ctx = this.ctx;\n        const w = this.canvas.width;\n        const h = this.canvas.height;\n        const padding = 60;\n\n        if (timeSeries.values.length === 0) {\n            ctx.fillStyle = '#999';\n            ctx.font = '16px sans-serif';\n            ctx.textAlign = 'center';\n            ctx.fillText('No data - add points to begin', w / 2, h / 2);\n            return;\n        }\n\n        const allValues = [...timeSeries.values, ...timeSeries.ema];\n        const maxY = Math.max(...allValues);\n        const minY = Math.min(...allValues);\n        const range = maxY - minY || 1;\n\n        this.drawAxes(padding, minY, maxY);\n\n        const n = timeSeries.values.length;\n\n        // Draw raw values\n        ctx.strokeStyle = '#e74c3c';\n        ctx.lineWidth = 2;\n        ctx.setLineDash([5, 5]);\n        ctx.beginPath();\n        for (let i = 0; i < n; i++) {\n            const x = padding + (w - 2 * padding) * i / Math.max(n - 1, 1);\n            const y = h - padding - (h - 2 * padding) * (timeSeries.values[i] - minY) / range;\n            if (i === 0) ctx.moveTo(x, y);\n            else ctx.lineTo(x, y);\n        }\n        ctx.stroke();\n        ctx.setLineDash([]);\n\n        // Draw raw value points\n        timeSeries.values.forEach((val, i) => {\n            const x = padding + (w - 2 * padding) * i / Math.max(n - 1, 1);\n            const y = h - padding - (h - 2 * padding) * (val - minY) / range;\n            ctx.fillStyle = '#e74c3c';\n            ctx.beginPath();\n            ctx.arc(x, y, 5, 0, 2 * Math.PI);\n            ctx.fill();\n        });\n\n        // Draw EMA\n        ctx.strokeStyle = '#667eea';\n        ctx.lineWidth = 3;\n        ctx.beginPath();\n        for (let i = 0; i < timeSeries.ema.length; i++) {\n            const x = padding + (w - 2 * padding) * i / Math.max(n - 1, 1);\n            const y = h - padding - (h - 2 * padding) * (timeSeries.ema[i] - minY) / range;\n            if (i === 0) ctx.moveTo(x, y);\n            else ctx.lineTo(x, y);\n        }\n        ctx.stroke();\n\n        // Draw EMA points\n        timeSeries.ema.forEach((val, i) => {\n            const x = padding + (w - 2 * padding) * i / Math.max(n - 1, 1);\n            const y = h - padding - (h - 2 * padding) * (val - minY) / range;\n            ctx.fillStyle = '#667eea';\n            ctx.beginPath();\n            ctx.arc(x, y, 4, 0, 2 * Math.PI);\n            ctx.fill();\n        });\n\n        // Labels\n        ctx.fillStyle = '#333';\n        ctx.font = 'bold 14px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.fillText('Time Step', w / 2, h - 10);\n\n        ctx.save();\n        ctx.translate(15, h / 2);\n        ctx.rotate(-Math.PI / 2);\n        ctx.fillText('Value', 0, 0);\n        ctx.restore();\n\n        // Legend\n        ctx.textAlign = 'left';\n        ctx.fillStyle = '#e74c3c';\n        ctx.fillRect(w - 200, padding, 15, 10);\n        ctx.fillStyle = '#333';\n        ctx.font = '13px sans-serif';\n        ctx.fillText('Raw Values', w - 180, padding + 9);\n\n        ctx.fillStyle = '#667eea';\n        ctx.fillRect(w - 200, padding + 20, 15, 10);\n        ctx.fillStyle = '#333';\n        ctx.fillText('EMA', w - 180, padding + 29);\n    }\n}\n\n// Response Chart\nclass ResponseChart extends ChartCanvas {\n    draw(beta) {\n        this.clear();\n        const ctx = this.ctx;\n        const w = this.canvas.width;\n        const h = this.canvas.height;\n        const padding = 60;\n\n        const steps = 50;\n        const responses = [];\n        \n        // Step response: initial value 0, step to 100\n        let ema = 0;\n        for (let i = 0; i <= steps; i++) {\n            if (i > 0) {\n                ema = beta * ema + (1 - beta) * 100;\n            }\n            responses.push(ema);\n        }\n\n        const maxY = 100;\n        const minY = 0;\n\n        this.drawAxes(padding, minY, maxY);\n\n        // Draw target line\n        ctx.strokeStyle = '#e74c3c';\n        ctx.lineWidth = 2;\n        ctx.setLineDash([5, 5]);\n        ctx.beginPath();\n        ctx.moveTo(padding, h - padding - (h - 2 * padding));\n        ctx.lineTo(w - padding, h - padding - (h - 2 * padding));\n        ctx.stroke();\n        ctx.setLineDash([]);\n\n        // Draw response\n        ctx.strokeStyle = '#667eea';\n        ctx.lineWidth = 3;\n        ctx.beginPath();\n        for (let i = 0; i <= steps; i++) {\n            const x = padding + (w - 2 * padding) * i / steps;\n            const y = h - padding - (h - 2 * padding) * responses[i] / 100;\n            if (i === 0) ctx.moveTo(x, y);\n            else ctx.lineTo(x, y);\n        }\n        ctx.stroke();\n\n        // Labels\n        ctx.fillStyle = '#333';\n        ctx.font = 'bold 14px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.fillText('Time Steps', w / 2, h - 10);\n\n        ctx.save();\n        ctx.translate(15, h / 2);\n        ctx.rotate(-Math.PI / 2);\n        ctx.fillText('EMA Value', 0, 0);\n        ctx.restore();\n\n        // Legend\n        ctx.textAlign = 'left';\n        ctx.font = '13px sans-serif';\n        ctx.fillStyle = '#333';\n        ctx.fillText('Step Input: 0 → 100', w - 200, padding + 9);\n    }\n}\n\n// Decay Chart\nclass DecayChart extends ChartCanvas {\n    draw(beta) {\n        this.clear();\n        const ctx = this.ctx;\n        const w = this.canvas.width;\n        const h = this.canvas.height;\n        const padding = 60;\n\n        const steps = 30;\n        const weights = [];\n        \n        // Calculate contribution weights\n        for (let t = 0; t <= steps; t++) {\n            weights.push(Math.pow(beta, t) * (1 - beta));\n        }\n\n        const maxWeight = Math.max(...weights);\n\n        this.drawAxes(padding, 0, maxWeight);\n\n        // Draw bars\n        for (let i = 0; i <= steps; i++) {\n            const x = padding + (w - 2 * padding) * i / steps;\n            const barWidth = (w - 2 * padding) / steps * 0.7;\n            const barHeight = (h - 2 * padding) * weights[i] / maxWeight;\n\n            const gradient = ctx.createLinearGradient(0, h - padding - barHeight, 0, h - padding);\n            gradient.addColorStop(0, '#667eea');\n            gradient.addColorStop(1, '#764ba2');\n            \n            ctx.fillStyle = gradient;\n            ctx.fillRect(x, h - padding - barHeight, barWidth, barHeight);\n        }\n\n        // Labels\n        ctx.fillStyle = '#333';\n        ctx.font = 'bold 14px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.fillText('Steps Back in Time', w / 2, h - 10);\n\n        ctx.save();\n        ctx.translate(15, h / 2);\n        ctx.rotate(-Math.PI / 2);\n        ctx.fillText('Weight', 0, 0);\n        ctx.restore();\n    }\n}\n\n// Initialize charts\nlet timeSeriesChart, responseChart, decayChart;\n\nfunction updateDisplay() {\n    const beta = parseFloat(document.getElementById('betaSlider').value);\n    const mPrev = parseFloat(document.getElementById('prevAvg').value);\n    const x = parseFloat(document.getElementById('currentValue').value);\n\n    document.getElementById('betaDisplay').textContent = beta.toFixed(3);\n\n    // Calculate half-life\n    const halfLife = Math.log(0.5) / Math.log(beta);\n    document.getElementById('halfLife').textContent = Math.abs(halfLife).toFixed(1);\n\n    // Calculate EMA\n    const result = calculateEMA(beta, mPrev, x);\n\n    document.getElementById('term1').textContent = result.term1.toFixed(3);\n    document.getElementById('term2').textContent = result.term2.toFixed(3);\n    document.getElementById('newAvg').textContent = result.mNew.toFixed(3);\n    document.getElementById('change').textContent = \n        (result.change >= 0 ? '+' : '') + result.change.toFixed(3);\n\n    // Update weight bars\n    const oldWeightPct = beta * 100;\n    const newWeightPct = (1 - beta) * 100;\n    \n    document.getElementById('oldWeight').style.width = oldWeightPct + '%';\n    document.getElementById('newWeight').style.width = newWeightPct + '%';\n    \n    document.getElementById('oldWeight').querySelector('.weight-label').textContent = \n        `β = ${oldWeightPct.toFixed(1)}%`;\n    document.getElementById('newWeight').querySelector('.weight-label').textContent = \n        `(1-β) = ${newWeightPct.toFixed(1)}%`;\n\n    // Update info card\n    const effectiveWindow = Math.ceil(1 / (1 - beta));\n    document.getElementById('effectiveWindow').textContent = effectiveWindow;\n    \n    // Update current EMA in info card based on time series if available\n    if (timeSeries.ema.length > 0) {\n        document.getElementById('currentEMA').textContent = \n            timeSeries.ema[timeSeries.ema.length - 1].toFixed(2);\n    } else {\n        document.getElementById('currentEMA').textContent = mPrev.toFixed(2);\n    }\n    \n    document.getElementById('lagFactor').textContent = beta.toFixed(2);\n    \n    let smoothness = 'Low';\n    if (beta > 0.9) smoothness = 'Very High';\n    else if (beta > 0.7) smoothness = 'High';\n    else if (beta > 0.5) smoothness = 'Medium';\n    document.getElementById('smoothness').textContent = smoothness;\n\n    // Update charts\n    responseChart.draw(beta);\n    decayChart.draw(beta);\n}\n\nfunction performUpdate() {\n    const beta = parseFloat(document.getElementById('betaSlider').value);\n    const mPrev = parseFloat(document.getElementById('prevAvg').value);\n    const x = parseFloat(document.getElementById('currentValue').value);\n\n    const result = calculateEMA(beta, mPrev, x);\n\n    // Add current value to time series\n    timeSeries.values.push(x);\n    \n    if (timeSeries.ema.length === 0) {\n        timeSeries.ema.push(x);\n    } else {\n        timeSeries.ema.push(result.mNew);\n    }\n    \n    timeSeries.beta = beta;\n    \n    // Update the graph\n    timeSeriesChart.draw();\n\n    // Update previous average to new value for next calculation\n    document.getElementById('prevAvg').value = result.mNew.toFixed(6);\n    \n    updateDisplay();\n}\n\nfunction reset() {\n    document.getElementById('betaSlider').value = '0.9';\n    document.getElementById('prevAvg').value = '50';\n    document.getElementById('currentValue').value = '80';\n    \n    // Clear time series as well\n    timeSeries = {\n        values: [],\n        ema: [],\n        beta: 0.9\n    };\n    timeSeriesChart.draw();\n    \n    updateDisplay();\n}\n\nfunction addRandomPoint() {\n    const beta = parseFloat(document.getElementById('betaSlider').value);\n    const value = Math.random() * 100;\n    \n    timeSeries.values.push(value);\n    \n    if (timeSeries.ema.length === 0) {\n        timeSeries.ema.push(value);\n    } else {\n        const lastEMA = timeSeries.ema[timeSeries.ema.length - 1];\n        const newEMA = beta * lastEMA + (1 - beta) * value;\n        timeSeries.ema.push(newEMA);\n    }\n    \n    timeSeries.beta = beta;\n    timeSeriesChart.draw();\n    \n    // Update current EMA display\n    document.getElementById('currentEMA').textContent = \n        timeSeries.ema[timeSeries.ema.length - 1].toFixed(2);\n}\n\nfunction addStepChange() {\n    const beta = parseFloat(document.getElementById('betaSlider').value);\n    \n    // Add 10 points at one level, then 10 at another\n    const lowValue = 30;\n    const highValue = 70;\n    \n    for (let i = 0; i < 10; i++) {\n        const value = lowValue + (Math.random() - 0.5) * 5;\n        timeSeries.values.push(value);\n        \n        if (timeSeries.ema.length === 0) {\n            timeSeries.ema.push(value);\n        } else {\n            const lastEMA = timeSeries.ema[timeSeries.ema.length - 1];\n            const newEMA = beta * lastEMA + (1 - beta) * value;\n            timeSeries.ema.push(newEMA);\n        }\n    }\n    \n    for (let i = 0; i < 10; i++) {\n        const value = highValue + (Math.random() - 0.5) * 5;\n        timeSeries.values.push(value);\n        \n        const lastEMA = timeSeries.ema[timeSeries.ema.length - 1];\n        const newEMA = beta * lastEMA + (1 - beta) * value;\n        timeSeries.ema.push(newEMA);\n    }\n    \n    timeSeries.beta = beta;\n    timeSeriesChart.draw();\n    \n    document.getElementById('currentEMA').textContent = \n        timeSeries.ema[timeSeries.ema.length - 1].toFixed(2);\n}\n\nfunction clearSeries() {\n    timeSeries = {\n        values: [],\n        ema: [],\n        beta: parseFloat(document.getElementById('betaSlider').value)\n    };\n    timeSeriesChart.draw();\n    \n    // Update display to show calculator's prevAvg instead\n    updateDisplay();\n}\n\n// Event listeners\nwindow.addEventListener('load', () => {\n    timeSeriesChart = new TimeSeriesChart('timeSeriesCanvas');\n    responseChart = new ResponseChart('responseCanvas');\n    decayChart = new DecayChart('decayCanvas');\n\n    document.getElementById('betaSlider').addEventListener('input', updateDisplay);\n    document.getElementById('prevAvg').addEventListener('input', updateDisplay);\n    document.getElementById('currentValue').addEventListener('input', updateDisplay);\n\n    document.getElementById('updateBtn').addEventListener('click', performUpdate);\n    document.getElementById('resetBtn').addEventListener('click', reset);\n    document.getElementById('addRandom').addEventListener('click', addRandomPoint);\n    document.getElementById('addStep').addEventListener('click', addStepChange);\n    document.getElementById('clearSeries').addEventListener('click', clearSeries);\n\n    updateDisplay();\n});\n\nwindow.addEventListener('resize', () => {\n    timeSeriesChart.setupCanvas();\n    responseChart.setupCanvas();\n    decayChart.setupCanvas();\n    \n    timeSeriesChart.draw();\n    responseChart.draw(parseFloat(document.getElementById('betaSlider').value));\n    decayChart.draw(parseFloat(document.getElementById('betaSlider').value));\n});"}}
{"input": {"input_text": "Exponential growth/decay discrete: x_n = x0*(1 + r)^n. Compute future value.", "simulation_name": " Discrete Exponential", "domain": "Mathematics", "description": "Geometric progression", "assumptions": ["Constant rate"], "entities": [], "constants": [], "parameters": [{"name": "initial_value", "symbol": "x0", "unit": "dimensionless", "range": [-1000000000.0, 1000000000.0]}, {"name": "rate", "symbol": "r", "unit": "dimensionless", "range": [-1, 10]}, {"name": "steps", "symbol": "n", "unit": "count", "range": [0, 1000000.0]}], "equations": [{"description": "Value", "expression": "x = x0*(1 + r)^n"}], "initial_conditions": {}, "outputs": ["x"], "simulation_controls": ["x0", "r", "n"], "constraints": ["n>=0"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S98 Discrete Exponential Growth/Decay</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1>Discrete Exponential Growth/Decay</h1>\n            <p class=\"formula\">x<sub>n</sub> = x<sub>0</sub> · (1 + r)<sup>n</sup></p>\n            <p class=\"subtitle\">Geometric Progression Calculator</p>\n        </header>\n\n        <div class=\"main-grid\">\n            <div class=\"left-panel\">\n                <div class=\"card params-card\">\n                    <h2>Parameters</h2>\n                    \n                    <div class=\"param-group\">\n                        <label class=\"param-label\">\n                            <span class=\"label-text\">Initial Value (x<sub>0</sub>)</span>\n                        </label>\n                        <input type=\"number\" id=\"x0\" value=\"100\" step=\"1\">\n                    </div>\n\n                    <div class=\"param-group\">\n                        <label class=\"param-label\">\n                            <span class=\"label-text\">Growth Rate (r)</span>\n                            <span class=\"rate-value\" id=\"rateDisplay\">0.05</span>\n                        </label>\n                        <input type=\"range\" id=\"rate\" min=\"-0.99\" max=\"2\" step=\"0.01\" value=\"0.05\">\n                        <div class=\"range-labels\">\n                            <span>-0.99 (decay)</span>\n                            <span>2.0 (growth)</span>\n                        </div>\n                        <div class=\"rate-info\">\n                            <div class=\"info-pill\" id=\"rateType\">Growth</div>\n                            <div class=\"info-pill\" id=\"ratePercent\">+5.0%</div>\n                        </div>\n                    </div>\n\n                    <div class=\"param-group\">\n                        <label class=\"param-label\">\n                            <span class=\"label-text\">Number of Steps (n)</span>\n                            <span class=\"rate-value\" id=\"stepsDisplay\">10</span>\n                        </label>\n                        <input type=\"range\" id=\"steps\" min=\"0\" max=\"100\" step=\"1\" value=\"10\">\n                        <div class=\"range-labels\">\n                            <span>0</span>\n                            <span>100</span>\n                        </div>\n                    </div>\n\n                    <button id=\"calculateBtn\" class=\"btn btn-primary\">Calculate</button>\n                    <button id=\"animateBtn\" class=\"btn btn-animate\">Animate Growth</button>\n                    <button id=\"resetBtn\" class=\"btn btn-secondary\">Reset</button>\n                </div>\n\n                <div class=\"card result-card\">\n                    <h2>Result</h2>\n                    <div class=\"result-main\">\n                        <div class=\"result-label\">x<sub>n</sub></div>\n                        <div class=\"result-value\" id=\"finalValue\">100.00</div>\n                    </div>\n                    <div class=\"result-details\">\n                        <div class=\"detail-row\">\n                            <span>Base (1 + r):</span>\n                            <span id=\"base\">1.050</span>\n                        </div>\n                        <div class=\"detail-row\">\n                            <span>Multiplier (1 + r)<sup>n</sup>:</span>\n                            <span id=\"multiplier\">1.629</span>\n                        </div>\n                        <div class=\"detail-row\">\n                            <span>Total Change:</span>\n                            <span id=\"totalChange\">+62.89</span>\n                        </div>\n                        <div class=\"detail-row\">\n                            <span>Change %:</span>\n                            <span id=\"changePercent\">+62.89%</span>\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"card scenarios-card\">\n                    <h2>Quick Scenarios</h2>\n                    <button class=\"scenario-btn\" data-scenario=\"population\">\n                        Population Growth<br><small>x₀=1000, r=0.02</small>\n                    </button>\n                    <button class=\"scenario-btn\" data-scenario=\"investment\">\n                        Investment<br><small>x₀=1000, r=0.07</small>\n                    </button>\n                    <button class=\"scenario-btn\" data-scenario=\"decay\">\n                        Radioactive Decay<br><small>x₀=1000, r=-0.1</small>\n                    </button>\n                    <button class=\"scenario-btn\" data-scenario=\"compound\">\n                        Compound Interest<br><small>x₀=10000, r=0.05</small>\n                    </button>\n                </div>\n\n                <div class=\"card info-card\">\n                    <h2>Characteristics</h2>\n                    <div class=\"char-item\">\n                        <span class=\"char-label\">Doubling Time:</span>\n                        <span class=\"char-value\" id=\"doublingTime\">-</span>\n                    </div>\n                    <div class=\"char-item\">\n                        <span class=\"char-label\">Half-Life:</span>\n                        <span class=\"char-value\" id=\"halfLife\">-</span>\n                    </div>\n                    <div class=\"char-item\">\n                        <span class=\"char-label\">Type:</span>\n                        <span class=\"char-value\" id=\"sequenceType\">Geometric</span>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"right-panel\">\n                <div class=\"card chart-card full-width\">\n                    <h3>Growth/Decay Trajectory</h3>\n                    <canvas id=\"trajectoryCanvas\"></canvas>\n                </div>\n\n                <div class=\"card chart-card\">\n                    <h3>Step-by-Step Values</h3>\n                    <canvas id=\"stepsCanvas\"></canvas>\n                </div>\n\n                <div class=\"card chart-card\">\n                    <h3>Growth Factor per Step</h3>\n                    <canvas id=\"factorCanvas\"></canvas>\n                </div>\n\n                <div class=\"card table-card\">\n                    <h3>Value Table</h3>\n                    <div class=\"table-container\" id=\"valueTable\"></div>\n                </div>\n\n                <div class=\"card comparison-card\">\n                    <h3>Rate Comparison</h3>\n                    <canvas id=\"comparisonCanvas\"></canvas>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);\n    min-height: 100vh;\n    padding: 20px;\n    color: #333;\n}\n\n.container {\n    max-width: 1600px;\n    margin: 0 auto;\n}\n\nheader {\n    text-align: center;\n    color: white;\n    margin-bottom: 30px;\n    animation: fadeIn 0.8s ease-out;\n}\n\nheader h1 {\n    font-size: 3.2rem;\n    margin-bottom: 15px;\n    text-shadow: 3px 3px 15px rgba(0,0,0,0.5);\n    font-weight: 700;\n    background: linear-gradient(45deg, #00d2ff, #3a7bd5);\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n    background-clip: text;\n}\n\n.formula {\n    font-size: 2.2rem;\n    font-family: 'Courier New', monospace;\n    background: rgba(255,255,255,0.1);\n    padding: 20px 40px;\n    border-radius: 15px;\n    display: inline-block;\n    backdrop-filter: blur(10px);\n    border: 2px solid rgba(255,255,255,0.2);\n    margin-bottom: 10px;\n}\n\n.subtitle {\n    font-size: 1.3rem;\n    opacity: 0.9;\n    font-weight: 300;\n}\n\n.main-grid {\n    display: grid;\n    grid-template-columns: 380px 1fr;\n    gap: 25px;\n}\n\n.left-panel {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.right-panel {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 20px;\n}\n\n.card {\n    background: white;\n    border-radius: 20px;\n    padding: 25px;\n    box-shadow: 0 15px 50px rgba(0,0,0,0.4);\n    animation: slideIn 0.6s ease-out;\n}\n\n.card h2 {\n    color: #2c5364;\n    margin-bottom: 20px;\n    font-size: 1.5rem;\n    border-bottom: 3px solid #3a7bd5;\n    padding-bottom: 10px;\n}\n\n.card h3 {\n    color: #2c5364;\n    margin-bottom: 15px;\n    font-size: 1.2rem;\n    text-align: center;\n}\n\n.param-group {\n    margin-bottom: 25px;\n}\n\n.param-label {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 10px;\n}\n\n.label-text {\n    font-weight: 600;\n    color: #555;\n    font-size: 1.05rem;\n}\n\n.rate-value {\n    font-weight: 700;\n    font-size: 1.4rem;\n    color: #00d2ff;\n    font-family: 'Courier New', monospace;\n}\n\ninput[type=\"number\"] {\n    width: 100%;\n    padding: 14px;\n    border: 2px solid #e0e0e0;\n    border-radius: 12px;\n    font-size: 1.2rem;\n    font-weight: 600;\n    transition: all 0.3s ease;\n}\n\ninput[type=\"number\"]:focus {\n    outline: none;\n    border-color: #3a7bd5;\n    box-shadow: 0 0 0 4px rgba(58,123,213,0.1);\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    height: 10px;\n    border-radius: 5px;\n    background: linear-gradient(to right, #e74c3c, #f39c12, #00d2ff, #3a7bd5);\n    outline: none;\n    -webkit-appearance: none;\n    margin: 10px 0;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 26px;\n    height: 26px;\n    border-radius: 50%;\n    background: white;\n    cursor: pointer;\n    box-shadow: 0 3px 12px rgba(0,0,0,0.4);\n    border: 4px solid #3a7bd5;\n    transition: transform 0.2s;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb:hover {\n    transform: scale(1.15);\n}\n\ninput[type=\"range\"]::-moz-range-thumb {\n    width: 26px;\n    height: 26px;\n    border-radius: 50%;\n    background: white;\n    cursor: pointer;\n    box-shadow: 0 3px 12px rgba(0,0,0,0.4);\n    border: 4px solid #3a7bd5;\n}\n\n.range-labels {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.85rem;\n    color: #888;\n    margin-top: 5px;\n}\n\n.rate-info {\n    display: flex;\n    gap: 10px;\n    margin-top: 12px;\n}\n\n.info-pill {\n    flex: 1;\n    padding: 10px;\n    border-radius: 8px;\n    text-align: center;\n    font-weight: 700;\n    font-size: 0.95rem;\n}\n\n#rateType {\n    background: linear-gradient(135deg, #00d2ff, #3a7bd5);\n    color: white;\n}\n\n#ratePercent {\n    background: linear-gradient(135deg, #f5f7fa, #c3cfe2);\n    color: #2c5364;\n}\n\n.btn {\n    width: 100%;\n    padding: 16px;\n    border: none;\n    border-radius: 12px;\n    font-size: 1.1rem;\n    font-weight: 700;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    margin-bottom: 10px;\n    text-transform: uppercase;\n    letter-spacing: 1.5px;\n}\n\n.btn-primary {\n    background: linear-gradient(135deg, #00d2ff, #3a7bd5);\n    color: white;\n}\n\n.btn-primary:hover {\n    transform: translateY(-3px);\n    box-shadow: 0 10px 30px rgba(58,123,213,0.5);\n}\n\n.btn-animate {\n    background: linear-gradient(135deg, #f093fb, #f5576c);\n    color: white;\n}\n\n.btn-animate:hover {\n    transform: translateY(-3px);\n    box-shadow: 0 10px 30px rgba(245,87,108,0.5);\n}\n\n.btn-secondary {\n    background: #e74c3c;\n    color: white;\n}\n\n.btn-secondary:hover {\n    background: #c0392b;\n    transform: translateY(-3px);\n}\n\n.btn:active {\n    transform: translateY(0);\n}\n\n.result-main {\n    text-align: center;\n    padding: 30px;\n    background: linear-gradient(135deg, #e8f4f8, #d4e9f7);\n    border-radius: 15px;\n    margin-bottom: 20px;\n}\n\n.result-label {\n    font-size: 1.3rem;\n    color: #555;\n    margin-bottom: 10px;\n    font-weight: 600;\n}\n\n.result-value {\n    font-size: 3rem;\n    font-weight: 700;\n    color: #2c5364;\n    font-family: 'Courier New', monospace;\n    word-break: break-all;\n}\n\n.result-details {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n\n.detail-row {\n    display: flex;\n    justify-content: space-between;\n    padding: 12px;\n    background: #f8f9fa;\n    border-radius: 8px;\n    font-size: 0.95rem;\n}\n\n.detail-row span:first-child {\n    color: #555;\n    font-weight: 600;\n}\n\n.detail-row span:last-child {\n    color: #2c5364;\n    font-weight: 700;\n    font-family: 'Courier New', monospace;\n}\n\n.scenario-btn {\n    width: 100%;\n    padding: 15px;\n    margin-bottom: 10px;\n    border: 2px solid #e0e0e0;\n    border-radius: 10px;\n    background: white;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    font-weight: 600;\n    color: #555;\n    text-align: left;\n}\n\n.scenario-btn:hover {\n    border-color: #3a7bd5;\n    background: linear-gradient(135deg, #f5f7fa, #c3cfe2);\n    transform: translateX(5px);\n}\n\n.scenario-btn small {\n    display: block;\n    margin-top: 5px;\n    color: #888;\n    font-weight: 400;\n}\n\n.char-item {\n    display: flex;\n    justify-content: space-between;\n    padding: 12px;\n    background: #f8f9fa;\n    border-radius: 8px;\n    margin-bottom: 10px;\n}\n\n.char-label {\n    font-weight: 600;\n    color: #555;\n}\n\n.char-value {\n    font-weight: 700;\n    color: #2c5364;\n    font-family: 'Courier New', monospace;\n}\n\n.chart-card.full-width {\n    grid-column: 1 / -1;\n}\n\ncanvas {\n    width: 100% !important;\n    height: 250px !important;\n    display: block;\n    border-radius: 10px;\n}\n\n.chart-card.full-width canvas {\n    height: 350px !important;\n}\n\n.table-container {\n    max-height: 250px;\n    overflow-y: auto;\n    border: 1px solid #e0e0e0;\n    border-radius: 8px;\n}\n\n.value-table {\n    width: 100%;\n    border-collapse: collapse;\n}\n\n.value-table th {\n    position: sticky;\n    top: 0;\n    background: linear-gradient(135deg, #00d2ff, #3a7bd5);\n    color: white;\n    padding: 12px;\n    font-weight: 700;\n    text-align: center;\n}\n\n.value-table td {\n    padding: 10px;\n    text-align: center;\n    border-bottom: 1px solid #e0e0e0;\n}\n\n.value-table tr:hover {\n    background: #f8f9fa;\n}\n\n.value-table tr:nth-child(even) {\n    background: #fafafa;\n}\n\n@keyframes fadeIn {\n    from {\n        opacity: 0;\n        transform: translateY(-20px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n@keyframes slideIn {\n    from {\n        opacity: 0;\n        transform: translateY(30px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n@keyframes pulse {\n    0%, 100% {\n        transform: scale(1);\n    }\n    50% {\n        transform: scale(1.05);\n    }\n}\n\n.result-value.animating {\n    animation: pulse 0.5s ease-out;\n}\n\n@media (max-width: 1400px) {\n    .main-grid {\n        grid-template-columns: 1fr;\n    }\n    \n    .right-panel {\n        grid-template-columns: 1fr;\n    }\n}\n\n@media (max-width: 768px) {\n    header h1 {\n        font-size: 2rem;\n    }\n    \n    .formula {\n        font-size: 1.4rem;\n        padding: 15px 25px;\n    }\n    \n    .result-value {\n        font-size: 2rem;\n    }\n}", "js": "// Calculate discrete exponential\nfunction calculateDiscreteExp(x0, r, n) {\n    const base = 1 + r;\n    const multiplier = Math.pow(base, n);\n    const xn = x0 * multiplier;\n    const change = xn - x0;\n    const changePercent = x0 !== 0 ? (change / x0) * 100 : 0;\n    \n    return {\n        base,\n        multiplier,\n        xn,\n        change,\n        changePercent\n    };\n}\n\n// Generate sequence\nfunction generateSequence(x0, r, maxN) {\n    const sequence = [];\n    for (let n = 0; n <= maxN; n++) {\n        const value = x0 * Math.pow(1 + r, n);\n        sequence.push({ n, value });\n    }\n    return sequence;\n}\n\n// Canvas Chart Base Class\nclass ChartCanvas {\n    constructor(canvasId) {\n        this.canvas = document.getElementById(canvasId);\n        this.ctx = this.canvas.getContext('2d');\n        this.setupCanvas();\n    }\n\n    setupCanvas() {\n        const rect = this.canvas.getBoundingClientRect();\n        this.canvas.width = rect.width;\n        this.canvas.height = rect.height;\n    }\n\n    clear() {\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n\n    drawAxes(padding, maxY, minY = 0, xLabel = 'n', yLabel = 'Value') {\n        const ctx = this.ctx;\n        const w = this.canvas.width;\n        const h = this.canvas.height;\n\n        ctx.strokeStyle = '#333';\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.moveTo(padding, padding);\n        ctx.lineTo(padding, h - padding);\n        ctx.lineTo(w - padding, h - padding);\n        ctx.stroke();\n\n        // Grid\n        ctx.strokeStyle = '#e0e0e0';\n        ctx.lineWidth = 1;\n        for (let i = 0; i <= 5; i++) {\n            const y = padding + (h - 2 * padding) * i / 5;\n            ctx.beginPath();\n            ctx.moveTo(padding, y);\n            ctx.lineTo(w - padding, y);\n            ctx.stroke();\n        }\n\n        // Labels\n        ctx.fillStyle = '#333';\n        ctx.font = 'bold 14px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.fillText(xLabel, w / 2, h - 10);\n\n        ctx.save();\n        ctx.translate(15, h / 2);\n        ctx.rotate(-Math.PI / 2);\n        ctx.fillText(yLabel, 0, 0);\n        ctx.restore();\n\n        // Y-axis values\n        ctx.font = '12px sans-serif';\n        ctx.textAlign = 'right';\n        for (let i = 0; i <= 5; i++) {\n            const val = maxY - (maxY - minY) * i / 5;\n            const y = padding + (h - 2 * padding) * i / 5;\n            ctx.fillText(formatNumber(val), padding - 10, y + 4);\n        }\n    }\n}\n\n// Trajectory Chart\nclass TrajectoryChart extends ChartCanvas {\n    draw(x0, r, n, animationStep = null) {\n        this.clear();\n        const ctx = this.ctx;\n        const w = this.canvas.width;\n        const h = this.canvas.height;\n        const padding = 70;\n\n        const sequence = generateSequence(x0, r, n);\n        const values = sequence.map(s => s.value);\n        const maxY = Math.max(...values, x0);\n        const minY = Math.min(...values, 0);\n        const range = maxY - minY || 1;\n\n        this.drawAxes(padding, maxY, minY, 'Step (n)', 'Value (xₙ)');\n\n        // Draw line\n        const gradient = ctx.createLinearGradient(0, 0, 0, h);\n        gradient.addColorStop(0, '#00d2ff');\n        gradient.addColorStop(1, '#3a7bd5');\n\n        ctx.strokeStyle = gradient;\n        ctx.lineWidth = 3;\n        ctx.beginPath();\n\n        const displayN = animationStep !== null ? Math.min(animationStep, n) : n;\n\n        for (let i = 0; i <= displayN; i++) {\n            const x = padding + (w - 2 * padding) * i / n;\n            const y = h - padding - (h - 2 * padding) * (sequence[i].value - minY) / range;\n            \n            if (i === 0) ctx.moveTo(x, y);\n            else ctx.lineTo(x, y);\n        }\n        ctx.stroke();\n\n        // Draw points\n        for (let i = 0; i <= displayN; i++) {\n            const x = padding + (w - 2 * padding) * i / n;\n            const y = h - padding - (h - 2 * padding) * (sequence[i].value - minY) / range;\n            \n            ctx.fillStyle = i === displayN ? '#f5576c' : '#3a7bd5';\n            ctx.beginPath();\n            ctx.arc(x, y, i === displayN ? 8 : 4, 0, 2 * Math.PI);\n            ctx.fill();\n        }\n\n        // Highlight final value\n        if (animationStep === null || animationStep >= n) {\n            const x = padding + (w - 2 * padding);\n            const y = h - padding - (h - 2 * padding) * (sequence[n].value - minY) / range;\n            \n            ctx.strokeStyle = '#f5576c';\n            ctx.lineWidth = 2;\n            ctx.setLineDash([5, 5]);\n            ctx.beginPath();\n            ctx.moveTo(padding, y);\n            ctx.lineTo(w - padding, y);\n            ctx.stroke();\n            ctx.setLineDash([]);\n        }\n    }\n}\n\n// Steps Bar Chart\nclass StepsChart extends ChartCanvas {\n    draw(x0, r, n) {\n        this.clear();\n        const ctx = this.ctx;\n        const w = this.canvas.width;\n        const h = this.canvas.height;\n        const padding = 60;\n\n        const maxDisplay = Math.min(n, 20);\n        const sequence = generateSequence(x0, r, maxDisplay);\n        const values = sequence.map(s => s.value);\n        const maxY = Math.max(...values, 0);\n        const minY = Math.min(...values, 0);\n        const range = maxY - minY || 1;\n\n        this.drawAxes(padding, maxY, minY, 'Step', 'Value');\n\n        // Draw bars\n        for (let i = 0; i <= maxDisplay; i++) {\n            const barWidth = (w - 2 * padding) / (maxDisplay + 1) * 0.7;\n            const x = padding + (w - 2 * padding) * i / maxDisplay - barWidth / 2;\n            const zeroY = h - padding - (h - 2 * padding) * (0 - minY) / range;\n            const barY = h - padding - (h - 2 * padding) * (sequence[i].value - minY) / range;\n            const barHeight = Math.abs(zeroY - barY);\n\n            const gradient = ctx.createLinearGradient(0, barY, 0, zeroY);\n            gradient.addColorStop(0, '#00d2ff');\n            gradient.addColorStop(1, '#3a7bd5');\n            \n            ctx.fillStyle = gradient;\n            ctx.fillRect(x, Math.min(barY, zeroY), barWidth, barHeight);\n            \n            // Border\n            ctx.strokeStyle = '#2c5364';\n            ctx.lineWidth = 1;\n            ctx.strokeRect(x, Math.min(barY, zeroY), barWidth, barHeight);\n        }\n\n        if (n > maxDisplay) {\n            ctx.fillStyle = '#666';\n            ctx.font = '14px sans-serif';\n            ctx.textAlign = 'center';\n            ctx.fillText(`Showing first ${maxDisplay + 1} steps`, w / 2, h - padding + 30);\n        }\n    }\n}\n\n// Growth Factor Chart\nclass FactorChart extends ChartCanvas {\n    draw(x0, r, n) {\n        this.clear();\n        const ctx = this.ctx;\n        const w = this.canvas.width;\n        const h = this.canvas.height;\n        const padding = 60;\n\n        const base = 1 + r;\n        \n        this.drawAxes(padding, Math.max(base, 1), Math.min(base, 0), 'All Steps', 'Growth Factor');\n\n        // Draw constant factor line\n        const factorY = h - padding - (h - 2 * padding) * (base - Math.min(base, 0)) / \n                        Math.max(Math.abs(base), 0.1);\n\n        const gradient = ctx.createLinearGradient(0, 0, w, 0);\n        gradient.addColorStop(0, base > 1 ? '#00d2ff' : '#e74c3c');\n        gradient.addColorStop(1, base > 1 ? '#3a7bd5' : '#c0392b');\n        \n        ctx.strokeStyle = gradient;\n        ctx.lineWidth = 4;\n        ctx.beginPath();\n        ctx.moveTo(padding, factorY);\n        ctx.lineTo(w - padding, factorY);\n        ctx.stroke();\n\n        // Draw 1.0 reference line\n        const oneY = h - padding - (h - 2 * padding) * (1 - Math.min(base, 0)) / \n                     Math.max(Math.abs(base), 0.1);\n        ctx.strokeStyle = '#333';\n        ctx.lineWidth = 2;\n        ctx.setLineDash([5, 5]);\n        ctx.beginPath();\n        ctx.moveTo(padding, oneY);\n        ctx.lineTo(w - padding, oneY);\n        ctx.stroke();\n        ctx.setLineDash([]);\n\n        // Label\n        ctx.fillStyle = '#333';\n        ctx.font = 'bold 16px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.fillText(`Factor: ${base.toFixed(3)}`, w / 2, factorY - 15);\n    }\n}\n\n// Comparison Chart\nclass ComparisonChart extends ChartCanvas {\n    draw(x0, n) {\n        this.clear();\n        const ctx = this.ctx;\n        const w = this.canvas.width;\n        const h = this.canvas.height;\n        const padding = 60;\n\n        const rates = [-0.5, 0, 0.05, 0.1, 0.2];\n        const colors = ['#e74c3c', '#95a5a6', '#3498db', '#00d2ff', '#27ae60'];\n        const sequences = rates.map(r => generateSequence(x0, r, n));\n        \n        const allValues = sequences.flat().map(s => s.value);\n        const maxY = Math.max(...allValues);\n        const minY = Math.min(...allValues, 0);\n        const range = maxY - minY || 1;\n\n        this.drawAxes(padding, maxY, minY, 'Step', 'Value');\n\n        // Draw lines\n        sequences.forEach((seq, idx) => {\n            ctx.strokeStyle = colors[idx];\n            ctx.lineWidth = 2;\n            ctx.beginPath();\n\n            seq.forEach((point, i) => {\n                const x = padding + (w - 2 * padding) * i / n;\n                const y = h - padding - (h - 2 * padding) * (point.value - minY) / range;\n                \n                if (i === 0) ctx.moveTo(x, y);\n                else ctx.lineTo(x, y);\n            });\n            ctx.stroke();\n        });\n\n        // Legend\n        rates.forEach((r, idx) => {\n            const legendY = padding + idx * 20;\n            ctx.fillStyle = colors[idx];\n            ctx.fillRect(w - 150, legendY, 15, 10);\n            ctx.fillStyle = '#333';\n            ctx.font = '12px sans-serif';\n            ctx.textAlign = 'left';\n            ctx.fillText(`r = ${r.toFixed(2)}`, w - 130, legendY + 9);\n        });\n    }\n}\n\n// Utility function\nfunction formatNumber(num) {\n    if (Math.abs(num) >= 1e6) {\n        return num.toExponential(2);\n    } else if (Math.abs(num) >= 1000) {\n        return num.toFixed(0);\n    } else {\n        return num.toFixed(2);\n    }\n}\n\n// Initialize charts\nlet trajectoryChart, stepsChart, factorChart, comparisonChart;\n\nfunction updateDisplay() {\n    const x0 = parseFloat(document.getElementById('x0').value);\n    const r = parseFloat(document.getElementById('rate').value);\n    const n = parseInt(document.getElementById('steps').value);\n\n    document.getElementById('rateDisplay').textContent = r.toFixed(3);\n    document.getElementById('stepsDisplay').textContent = n;\n\n    // Update rate info\n    const rateType = r > 0 ? 'Growth' : r < 0 ? 'Decay' : 'Constant';\n    const ratePercent = (r * 100).toFixed(1) + '%';\n    \n    document.getElementById('rateType').textContent = rateType;\n    document.getElementById('rateType').style.background = \n        r > 0 ? 'linear-gradient(135deg, #00d2ff, #3a7bd5)' : \n        r < 0 ? 'linear-gradient(135deg, #e74c3c, #c0392b)' :\n        'linear-gradient(135deg, #95a5a6, #7f8c8d)';\n    \n    document.getElementById('ratePercent').textContent = \n        (r >= 0 ? '+' : '') + ratePercent;\n\n    // Calculate characteristics\n    if (r > 0) {\n        const doublingTime = Math.log(2) / Math.log(1 + r);\n        document.getElementById('doublingTime').textContent = doublingTime.toFixed(2) + ' steps';\n        document.getElementById('halfLife').textContent = 'N/A';\n    } else if (r < 0 && r > -1) {\n        const halfLife = Math.log(0.5) / Math.log(1 + r);\n        document.getElementById('halfLife').textContent = halfLife.toFixed(2) + ' steps';\n        document.getElementById('doublingTime').textContent = 'N/A';\n    } else {\n        document.getElementById('doublingTime').textContent = 'N/A';\n        document.getElementById('halfLife').textContent = 'N/A';\n    }\n\n    document.getElementById('sequenceType').textContent = \n        r === 0 ? 'Constant' : 'Geometric';\n}\n\nfunction calculate() {\n    const x0 = parseFloat(document.getElementById('x0').value);\n    const r = parseFloat(document.getElementById('rate').value);\n    const n = parseInt(document.getElementById('steps').value);\n\n    const result = calculateDiscreteExp(x0, r, n);\n\n    // Update result display\n    const resultValue = document.getElementById('finalValue');\n    resultValue.textContent = formatNumber(result.xn);\n    resultValue.classList.add('animating');\n    setTimeout(() => resultValue.classList.remove('animating'), 500);\n\n    document.getElementById('base').textContent = result.base.toFixed(4);\n    document.getElementById('multiplier').textContent = formatNumber(result.multiplier);\n    document.getElementById('totalChange').textContent = \n        (result.change >= 0 ? '+' : '') + formatNumber(result.change);\n    document.getElementById('changePercent').textContent = \n        (result.changePercent >= 0 ? '+' : '') + result.changePercent.toFixed(2) + '%';\n\n    // Update charts\n    trajectoryChart.draw(x0, r, n);\n    stepsChart.draw(x0, r, n);\n    factorChart.draw(x0, r, n);\n    comparisonChart.draw(x0, n);\n    \n    // Update table\n    updateTable(x0, r, n);\n}\n\nfunction updateTable(x0, r, n) {\n    const container = document.getElementById('valueTable');\n    const maxRows = 20;\n    const sequence = generateSequence(x0, r, Math.min(n, maxRows));\n\n    let html = '<table class=\"value-table\">';\n    html += '<thead><tr><th>Step (n)</th><th>Value (xₙ)</th><th>Growth Factor</th></tr></thead>';\n    html += '<tbody>';\n\n    sequence.forEach(point => {\n        html += `<tr>\n            <td>${point.n}</td>\n            <td>${formatNumber(point.value)}</td>\n            <td>${(1 + r).toFixed(3)}</td>\n        </tr>`;\n    });\n\n    if (n > maxRows) {\n        html += `<tr><td colspan=\"3\" style=\"text-align:center; color:#888;\">\n            ... (${n - maxRows} more rows)</td></tr>`;\n    }\n\n    html += '</tbody></table>';\n    container.innerHTML = html;\n}\n\nfunction animate() {\n    const x0 = parseFloat(document.getElementById('x0').value);\n    const r = parseFloat(document.getElementById('rate').value);\n    const n = parseInt(document.getElementById('steps').value);\n\n    let currentStep = 0;\n    const interval = setInterval(() => {\n        trajectoryChart.draw(x0, r, n, currentStep);\n        \n        const result = calculateDiscreteExp(x0, r, currentStep);\n        document.getElementById('finalValue').textContent = formatNumber(result.xn);\n        \n        currentStep++;\n        \n        if (currentStep > n) {\n            clearInterval(interval);\n            calculate();\n        }\n    }, 100);\n}\n\nfunction reset() {\n    document.getElementById('x0').value = '100';\n    document.getElementById('rate').value = '0.05';\n    document.getElementById('steps').value = '10';\n    updateDisplay();\n    calculate();\n}\n\nfunction loadScenario(scenario) {\n    const scenarios = {\n        population: { x0: 1000, r: 0.02, n: 50 },\n        investment: { x0: 1000, r: 0.07, n: 30 },\n        decay: { x0: 1000, r: -0.1, n: 50 },\n        compound: { x0: 10000, r: 0.05, n: 20 }\n    };\n\n    const params = scenarios[scenario];\n    document.getElementById('x0').value = params.x0;\n    document.getElementById('rate').value = params.r;\n    document.getElementById('steps').value = params.n;\n    \n    updateDisplay();\n    calculate();\n}\n\n// Event listeners\nwindow.addEventListener('load', () => {\n    trajectoryChart = new TrajectoryChart('trajectoryCanvas');\n    stepsChart = new StepsChart('stepsCanvas');\n    factorChart = new FactorChart('factorCanvas');\n    comparisonChart = new ComparisonChart('comparisonCanvas');\n\n    document.getElementById('x0').addEventListener('input', updateDisplay);\n    document.getElementById('rate').addEventListener('input', updateDisplay);\n    document.getElementById('steps').addEventListener('input', updateDisplay);\n\n    document.getElementById('calculateBtn').addEventListener('click', calculate);\n    document.getElementById('animateBtn').addEventListener('click', animate);\n    document.getElementById('resetBtn').addEventListener('click', reset);\n\n    document.querySelectorAll('.scenario-btn').forEach(btn => {\n        btn.addEventListener('click', (e) => {\n            const scenario = e.currentTarget.dataset.scenario;\n            loadScenario(scenario);\n        });\n    });\n\n    updateDisplay();\n    calculate();\n});\n\nwindow.addEventListener('resize', () => {\n    trajectoryChart.setupCanvas();\n    stepsChart.setupCanvas();\n    factorChart.setupCanvas();\n    comparisonChart.setupCanvas();\n    calculate();\n});"}}
{"input": {"input_text": "Geometric series finite sum: S = a*(1 - r^n)/(1 - r) for r!=1.", "simulation_name": " Geometric Sum", "domain": "Mathematics", "description": "Closed form geometric sum", "assumptions": ["r != 1"], "entities": [], "constants": [], "parameters": [{"name": "first_term", "symbol": "a", "unit": "dimensionless", "range": [-1000000.0, 1000000.0]}, {"name": "ratio", "symbol": "r", "unit": "dimensionless", "range": [-10, 10]}, {"name": "terms", "symbol": "n", "unit": "count", "range": [1, 1000000.0]}], "equations": [{"description": "Sum", "expression": "S = a*(1 - r^n)/(1 - r)"}], "initial_conditions": {}, "outputs": ["S"], "simulation_controls": ["a", "r", "n"], "constraints": ["r!=1", "n>=1"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S99 Geometric Series Sum</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1>Geometric Series Calculator</h1>\n            <p class=\"formula\">S = a · (1 - r<sup>n</sup>) / (1 - r)</p>\n            <p class=\"subtitle\">Finite Geometric Series Sum</p>\n        </header>\n\n        <div class=\"main-layout\">\n            <div class=\"sidebar\">\n                <div class=\"card params-card\">\n                    <h2>Series Parameters</h2>\n                    \n                    <div class=\"param-block\">\n                        <label class=\"param-label\">\n                            <span class=\"label-text\">First Term (a)</span>\n                        </label>\n                        <input type=\"number\" id=\"firstTerm\" value=\"1\" step=\"0.1\">\n                    </div>\n\n                    <div class=\"param-block\">\n                        <label class=\"param-label\">\n                            <span class=\"label-text\">Common Ratio (r)</span>\n                            <span class=\"value-display\" id=\"ratioDisplay\">0.5</span>\n                        </label>\n                        <input type=\"range\" id=\"ratio\" min=\"-2\" max=\"2\" step=\"0.01\" value=\"0.5\">\n                        <div class=\"range-labels\">\n                            <span>-2</span>\n                            <span>2</span>\n                        </div>\n                        <div class=\"ratio-warning\" id=\"ratioWarning\">\n                            ⚠️ r = 1 is undefined\n                        </div>\n                    </div>\n\n                    <div class=\"param-block\">\n                        <label class=\"param-label\">\n                            <span class=\"label-text\">Number of Terms (n)</span>\n                            <span class=\"value-display\" id=\"termsDisplay\">10</span>\n                        </label>\n                        <input type=\"range\" id=\"terms\" min=\"1\" max=\"50\" step=\"1\" value=\"10\">\n                        <div class=\"range-labels\">\n                            <span>1</span>\n                            <span>50</span>\n                        </div>\n                    </div>\n\n                    <button id=\"calculateBtn\" class=\"btn btn-primary\">Calculate Sum</button>\n                    <button id=\"resetBtn\" class=\"btn btn-secondary\">Reset</button>\n                </div>\n\n                <div class=\"card result-card\">\n                    <h2>Sum Result</h2>\n                    <div class=\"sum-display\">\n                        <div class=\"sum-label\">S =</div>\n                        <div class=\"sum-value\" id=\"sumValue\">1.998</div>\n                    </div>\n                    <div class=\"breakdown\">\n                        <div class=\"breakdown-item\">\n                            <span>Numerator: a(1 - r<sup>n</sup>)</span>\n                            <span id=\"numerator\">0.999</span>\n                        </div>\n                        <div class=\"breakdown-item\">\n                            <span>Denominator: (1 - r)</span>\n                            <span id=\"denominator\">0.500</span>\n                        </div>\n                        <div class=\"breakdown-item\">\n                            <span>r<sup>n</sup></span>\n                            <span id=\"rPowerN\">0.001</span>\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"card properties-card\">\n                    <h2>Series Properties</h2>\n                    <div class=\"property-item\">\n                        <span class=\"prop-label\">Type:</span>\n                        <span class=\"prop-value\" id=\"seriesType\">Convergent</span>\n                    </div>\n                    <div class=\"property-item\">\n                        <span class=\"prop-label\">Behavior:</span>\n                        <span class=\"prop-value\" id=\"behavior\">Decreasing</span>\n                    </div>\n                    <div class=\"property-item\">\n                        <span class=\"prop-label\">Last Term:</span>\n                        <span class=\"prop-value\" id=\"lastTerm\">0.002</span>\n                    </div>\n                    <div class=\"property-item\">\n                        <span class=\"prop-label\">Infinite Sum:</span>\n                        <span class=\"prop-value\" id=\"infiniteSum\">2.000</span>\n                    </div>\n                </div>\n\n                <div class=\"card examples-card\">\n                    <h2>Quick Examples</h2>\n                    <button class=\"example-btn\" data-example=\"halving\">\n                        Halving Series<br><small>a=1, r=0.5, n=10</small>\n                    </button>\n                    <button class=\"example-btn\" data-example=\"doubling\">\n                        Doubling Series<br><small>a=1, r=2, n=8</small>\n                    </button>\n                    <button class=\"example-btn\" data-example=\"alternating\">\n                        Alternating<br><small>a=1, r=-0.5, n=10</small>\n                    </button>\n                    <button class=\"example-btn\" data-example=\"fraction\">\n                        Fraction<br><small>a=100, r=0.1, n=5</small>\n                    </button>\n                </div>\n            </div>\n\n            <div class=\"main-content\">\n                <div class=\"card viz-card full-width\">\n                    <h3>Series Terms Visualization</h3>\n                    <canvas id=\"termsCanvas\"></canvas>\n                </div>\n\n                <div class=\"card viz-card\">\n                    <h3>Partial Sums</h3>\n                    <canvas id=\"partialSumsCanvas\"></canvas>\n                </div>\n\n                <div class=\"card viz-card\">\n                    <h3>Cumulative Sum Progress</h3>\n                    <canvas id=\"cumulativeCanvas\"></canvas>\n                </div>\n\n                <div class=\"card table-card\">\n                    <h3>Term-by-Term Breakdown</h3>\n                    <div class=\"table-scroll\" id=\"termsTable\"></div>\n                </div>\n\n                <div class=\"card viz-card\">\n                    <h3>Ratio Effect on Sum</h3>\n                    <canvas id=\"ratioEffectCanvas\"></canvas>\n                </div>\n\n                <div class=\"card formula-card\">\n                    <h3>Formula Derivation</h3>\n                    <div class=\"derivation\">\n                        <div class=\"step\">S = a + ar + ar² + ... + ar<sup>n-1</sup></div>\n                        <div class=\"step\">rS = ar + ar² + ar³ + ... + ar<sup>n</sup></div>\n                        <div class=\"step\">S - rS = a - ar<sup>n</sup></div>\n                        <div class=\"step\">S(1 - r) = a(1 - r<sup>n</sup>)</div>\n                        <div class=\"step highlight\">S = a(1 - r<sup>n</sup>) / (1 - r)</div>\n                    </div>\n                    <div class=\"note\">\n                        Note: Formula undefined when r = 1 (arithmetic series)\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    min-height: 100vh;\n    padding: 20px;\n    color: #333;\n}\n\n.container {\n    max-width: 1600px;\n    margin: 0 auto;\n}\n\nheader {\n    text-align: center;\n    color: white;\n    margin-bottom: 30px;\n    animation: slideDown 0.8s ease-out;\n}\n\nheader h1 {\n    font-size: 3.5rem;\n    margin-bottom: 15px;\n    text-shadow: 3px 3px 15px rgba(0,0,0,0.4);\n    font-weight: 700;\n}\n\n.formula {\n    font-size: 2.2rem;\n    font-family: 'Courier New', monospace;\n    background: rgba(255,255,255,0.15);\n    padding: 20px 45px;\n    border-radius: 15px;\n    display: inline-block;\n    backdrop-filter: blur(10px);\n    border: 2px solid rgba(255,255,255,0.3);\n    margin-bottom: 10px;\n    box-shadow: 0 8px 32px rgba(0,0,0,0.2);\n}\n\n.subtitle {\n    font-size: 1.3rem;\n    opacity: 0.95;\n    font-weight: 300;\n}\n\n.main-layout {\n    display: grid;\n    grid-template-columns: 400px 1fr;\n    gap: 25px;\n}\n\n.sidebar {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.main-content {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 20px;\n}\n\n.card {\n    background: white;\n    border-radius: 20px;\n    padding: 28px;\n    box-shadow: 0 15px 50px rgba(0,0,0,0.3);\n    animation: fadeInUp 0.6s ease-out;\n}\n\n.card h2 {\n    color: #667eea;\n    margin-bottom: 22px;\n    font-size: 1.5rem;\n    border-bottom: 3px solid #764ba2;\n    padding-bottom: 10px;\n}\n\n.card h3 {\n    color: #667eea;\n    margin-bottom: 18px;\n    font-size: 1.2rem;\n    text-align: center;\n}\n\n.param-block {\n    margin-bottom: 28px;\n}\n\n.param-label {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 10px;\n}\n\n.label-text {\n    font-weight: 600;\n    color: #555;\n    font-size: 1.05rem;\n}\n\n.value-display {\n    font-weight: 700;\n    font-size: 1.5rem;\n    color: #764ba2;\n    font-family: 'Courier New', monospace;\n}\n\ninput[type=\"number\"] {\n    width: 100%;\n    padding: 14px;\n    border: 2px solid #e0e0e0;\n    border-radius: 12px;\n    font-size: 1.2rem;\n    font-weight: 600;\n    transition: all 0.3s ease;\n}\n\ninput[type=\"number\"]:focus {\n    outline: none;\n    border-color: #764ba2;\n    box-shadow: 0 0 0 4px rgba(118,75,162,0.1);\n}\n\ninput[type=\"range\"] {\n    width: 100%;\n    height: 10px;\n    border-radius: 5px;\n    background: linear-gradient(to right, #667eea, #764ba2);\n    outline: none;\n    -webkit-appearance: none;\n    margin: 10px 0;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 26px;\n    height: 26px;\n    border-radius: 50%;\n    background: white;\n    cursor: pointer;\n    box-shadow: 0 3px 12px rgba(0,0,0,0.3);\n    border: 4px solid #764ba2;\n    transition: transform 0.2s;\n}\n\ninput[type=\"range\"]::-webkit-slider-thumb:hover {\n    transform: scale(1.15);\n}\n\ninput[type=\"range\"]::-moz-range-thumb {\n    width: 26px;\n    height: 26px;\n    border-radius: 50%;\n    background: white;\n    cursor: pointer;\n    box-shadow: 0 3px 12px rgba(0,0,0,0.3);\n    border: 4px solid #764ba2;\n}\n\n.range-labels {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.85rem;\n    color: #888;\n    margin-top: 5px;\n}\n\n.ratio-warning {\n    margin-top: 10px;\n    padding: 10px;\n    background: #fff3cd;\n    color: #856404;\n    border-radius: 8px;\n    font-size: 0.9rem;\n    font-weight: 600;\n    display: none;\n    border-left: 4px solid #ffc107;\n}\n\n.ratio-warning.show {\n    display: block;\n    animation: shake 0.5s;\n}\n\n.btn {\n    width: 100%;\n    padding: 16px;\n    border: none;\n    border-radius: 12px;\n    font-size: 1.1rem;\n    font-weight: 700;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    margin-bottom: 10px;\n    text-transform: uppercase;\n    letter-spacing: 1.5px;\n}\n\n.btn-primary {\n    background: linear-gradient(135deg, #667eea, #764ba2);\n    color: white;\n    box-shadow: 0 5px 20px rgba(118,75,162,0.3);\n}\n\n.btn-primary:hover {\n    transform: translateY(-3px);\n    box-shadow: 0 8px 30px rgba(118,75,162,0.5);\n}\n\n.btn-primary:active {\n    transform: translateY(0);\n}\n\n.btn-secondary {\n    background: #e74c3c;\n    color: white;\n}\n\n.btn-secondary:hover {\n    background: #c0392b;\n    transform: translateY(-3px);\n}\n\n.sum-display {\n    text-align: center;\n    padding: 35px;\n    background: linear-gradient(135deg, #e8f4f8, #d4e9f7);\n    border-radius: 15px;\n    margin-bottom: 20px;\n    border: 3px solid #667eea;\n}\n\n.sum-label {\n    font-size: 1.5rem;\n    color: #555;\n    margin-bottom: 12px;\n    font-weight: 600;\n}\n\n.sum-value {\n    font-size: 3.5rem;\n    font-weight: 700;\n    color: #667eea;\n    font-family: 'Courier New', monospace;\n    word-break: break-all;\n}\n\n.breakdown {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.breakdown-item {\n    display: flex;\n    justify-content: space-between;\n    padding: 12px;\n    background: #f8f9fa;\n    border-radius: 8px;\n    font-size: 0.95rem;\n}\n\n.breakdown-item span:first-child {\n    color: #555;\n    font-weight: 600;\n}\n\n.breakdown-item span:last-child {\n    color: #667eea;\n    font-weight: 700;\n    font-family: 'Courier New', monospace;\n}\n\n.property-item {\n    display: flex;\n    justify-content: space-between;\n    padding: 12px;\n    background: #f8f9fa;\n    border-radius: 8px;\n    margin-bottom: 10px;\n}\n\n.prop-label {\n    font-weight: 600;\n    color: #555;\n}\n\n.prop-value {\n    font-weight: 700;\n    color: #667eea;\n    font-family: 'Courier New', monospace;\n}\n\n.example-btn {\n    width: 100%;\n    padding: 15px;\n    margin-bottom: 10px;\n    border: 2px solid #e0e0e0;\n    border-radius: 10px;\n    background: white;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    font-weight: 600;\n    color: #555;\n    text-align: left;\n}\n\n.example-btn:hover {\n    border-color: #764ba2;\n    background: linear-gradient(135deg, #f5f7fa, #c3cfe2);\n    transform: translateX(5px);\n}\n\n.example-btn small {\n    display: block;\n    margin-top: 5px;\n    color: #888;\n    font-weight: 400;\n}\n\n.viz-card.full-width {\n    grid-column: 1 / -1;\n}\n\ncanvas {\n    width: 100% !important;\n    height: 250px !important;\n    display: block;\n    border-radius: 10px;\n}\n\n.viz-card.full-width canvas {\n    height: 350px !important;\n}\n\n.table-scroll {\n    max-height: 250px;\n    overflow-y: auto;\n    border: 1px solid #e0e0e0;\n    border-radius: 8px;\n}\n\n.terms-table {\n    width: 100%;\n    border-collapse: collapse;\n}\n\n.terms-table th {\n    position: sticky;\n    top: 0;\n    background: linear-gradient(135deg, #667eea, #764ba2);\n    color: white;\n    padding: 12px;\n    font-weight: 700;\n    text-align: center;\n    z-index: 10;\n}\n\n.terms-table td {\n    padding: 10px;\n    text-align: center;\n    border-bottom: 1px solid #e0e0e0;\n    font-family: 'Courier New', monospace;\n}\n\n.terms-table tr:hover {\n    background: #f8f9fa;\n}\n\n.terms-table tr:nth-child(even) {\n    background: #fafafa;\n}\n\n.formula-card {\n    grid-column: 1 / -1;\n}\n\n.derivation {\n    background: linear-gradient(135deg, #f5f7fa, #c3cfe2);\n    padding: 20px;\n    border-radius: 10px;\n    margin-bottom: 15px;\n}\n\n.step {\n    padding: 12px;\n    margin-bottom: 8px;\n    background: white;\n    border-radius: 8px;\n    font-family: 'Courier New', monospace;\n    font-size: 1.1rem;\n    color: #555;\n}\n\n.step.highlight {\n    background: linear-gradient(135deg, #667eea, #764ba2);\n    color: white;\n    font-weight: 700;\n    font-size: 1.2rem;\n}\n\n.note {\n    padding: 12px;\n    background: #fff3cd;\n    border-left: 4px solid #ffc107;\n    border-radius: 8px;\n    color: #856404;\n    font-style: italic;\n}\n\n@keyframes slideDown {\n    from {\n        opacity: 0;\n        transform: translateY(-30px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n@keyframes fadeInUp {\n    from {\n        opacity: 0;\n        transform: translateY(20px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n@keyframes shake {\n    0%, 100% { transform: translateX(0); }\n    25% { transform: translateX(-5px); }\n    75% { transform: translateX(5px); }\n}\n\n@keyframes pulse {\n    0%, 100% { transform: scale(1); }\n    50% { transform: scale(1.05); }\n}\n\n.sum-value.updating {\n    animation: pulse 0.5s ease-out;\n}\n\n@media (max-width: 1400px) {\n    .main-layout {\n        grid-template-columns: 1fr;\n    }\n    \n    .main-content {\n        grid-template-columns: 1fr;\n    }\n}\n\n@media (max-width: 768px) {\n    header h1 {\n        font-size: 2rem;\n    }\n    \n    .formula {\n        font-size: 1.4rem;\n        padding: 15px 25px;\n    }\n    \n    .sum-value {\n        font-size: 2.5rem;\n    }\n}", "js": "// Calculate geometric sum\nfunction calculateGeometricSum(a, r, n) {\n    if (Math.abs(r - 1) < 0.001) {\n        // When r ≈ 1, use arithmetic sum\n        return {\n            sum: a * n,\n            numerator: null,\n            denominator: null,\n            rPowerN: null,\n            undefined: true\n        };\n    }\n    \n    const rPowerN = Math.pow(r, n);\n    const numerator = a * (1 - rPowerN);\n    const denominator = 1 - r;\n    const sum = numerator / denominator;\n    \n    return {\n        sum,\n        numerator,\n        denominator,\n        rPowerN,\n        undefined: false\n    };\n}\n\n// Generate series terms\nfunction generateTerms(a, r, n) {\n    const terms = [];\n    let partialSum = 0;\n    \n    for (let i = 0; i < n; i++) {\n        const term = a * Math.pow(r, i);\n        partialSum += term;\n        terms.push({\n            index: i + 1,\n            term,\n            partialSum\n        });\n    }\n    \n    return terms;\n}\n\n// Canvas Chart Base Class\nclass ChartCanvas {\n    constructor(canvasId) {\n        this.canvas = document.getElementById(canvasId);\n        this.ctx = this.canvas.getContext('2d');\n        this.setupCanvas();\n    }\n\n    setupCanvas() {\n        const rect = this.canvas.getBoundingClientRect();\n        this.canvas.width = rect.width;\n        this.canvas.height = rect.height;\n    }\n\n    clear() {\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n\n    drawAxes(padding, maxY, minY = 0) {\n        const ctx = this.ctx;\n        const w = this.canvas.width;\n        const h = this.canvas.height;\n\n        ctx.strokeStyle = '#333';\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.moveTo(padding, padding);\n        ctx.lineTo(padding, h - padding);\n        ctx.lineTo(w - padding, h - padding);\n        ctx.stroke();\n\n        // Grid\n        ctx.strokeStyle = '#e0e0e0';\n        ctx.lineWidth = 1;\n        for (let i = 0; i <= 5; i++) {\n            const y = padding + (h - 2 * padding) * i / 5;\n            ctx.beginPath();\n            ctx.moveTo(padding, y);\n            ctx.lineTo(w - padding, y);\n            ctx.stroke();\n        }\n    }\n}\n\n// Terms Visualization\nclass TermsChart extends ChartCanvas {\n    draw(a, r, n) {\n        this.clear();\n        const ctx = this.ctx;\n        const w = this.canvas.width;\n        const h = this.canvas.height;\n        const padding = 70;\n\n        const maxDisplay = Math.min(n, 30);\n        const terms = generateTerms(a, r, maxDisplay);\n        const values = terms.map(t => t.term);\n        const maxY = Math.max(...values, 0);\n        const minY = Math.min(...values, 0);\n        const range = maxY - minY || 1;\n\n        this.drawAxes(padding, maxY, minY);\n\n        // Draw bars\n        for (let i = 0; i < maxDisplay; i++) {\n            const barWidth = (w - 2 * padding) / maxDisplay * 0.7;\n            const x = padding + (w - 2 * padding) * i / maxDisplay;\n            const zeroY = h - padding - (h - 2 * padding) * (0 - minY) / range;\n            const barY = h - padding - (h - 2 * padding) * (values[i] - minY) / range;\n            const barHeight = Math.abs(zeroY - barY);\n\n            const gradient = ctx.createLinearGradient(0, barY, 0, zeroY);\n            gradient.addColorStop(0, '#667eea');\n            gradient.addColorStop(1, '#764ba2');\n            \n            ctx.fillStyle = gradient;\n            ctx.fillRect(x, Math.min(barY, zeroY), barWidth, barHeight);\n            \n            ctx.strokeStyle = '#555';\n            ctx.lineWidth = 1;\n            ctx.strokeRect(x, Math.min(barY, zeroY), barWidth, barHeight);\n        }\n\n        // Labels\n        ctx.fillStyle = '#333';\n        ctx.font = 'bold 14px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.fillText('Term Index', w / 2, h - 10);\n\n        ctx.save();\n        ctx.translate(15, h / 2);\n        ctx.rotate(-Math.PI / 2);\n        ctx.fillText('Term Value', 0, 0);\n        ctx.restore();\n\n        if (n > maxDisplay) {\n            ctx.fillStyle = '#666';\n            ctx.font = '13px sans-serif';\n            ctx.fillText(`Showing first ${maxDisplay} terms`, w / 2, h - padding + 30);\n        }\n    }\n}\n\n// Partial Sums Chart\nclass PartialSumsChart extends ChartCanvas {\n    draw(a, r, n) {\n        this.clear();\n        const ctx = this.ctx;\n        const w = this.canvas.width;\n        const h = this.canvas.height;\n        const padding = 60;\n\n        const terms = generateTerms(a, r, n);\n        const partialSums = terms.map(t => t.partialSum);\n        const maxY = Math.max(...partialSums, 0);\n        const minY = Math.min(...partialSums, 0);\n        const range = maxY - minY || 1;\n\n        this.drawAxes(padding, maxY, minY);\n\n        // Draw line\n        const gradient = ctx.createLinearGradient(0, 0, w, 0);\n        gradient.addColorStop(0, '#667eea');\n        gradient.addColorStop(1, '#764ba2');\n\n        ctx.strokeStyle = gradient;\n        ctx.lineWidth = 3;\n        ctx.beginPath();\n\n        for (let i = 0; i < terms.length; i++) {\n            const x = padding + (w - 2 * padding) * i / (n - 1);\n            const y = h - padding - (h - 2 * padding) * (partialSums[i] - minY) / range;\n            \n            if (i === 0) ctx.moveTo(x, y);\n            else ctx.lineTo(x, y);\n        }\n        ctx.stroke();\n\n        // Draw points\n        terms.forEach((term, i) => {\n            const x = padding + (w - 2 * padding) * i / (n - 1);\n            const y = h - padding - (h - 2 * padding) * (term.partialSum - minY) / range;\n            \n            ctx.fillStyle = i === terms.length - 1 ? '#f5576c' : '#764ba2';\n            ctx.beginPath();\n            ctx.arc(x, y, i === terms.length - 1 ? 8 : 4, 0, 2 * Math.PI);\n            ctx.fill();\n        });\n\n        // Labels\n        ctx.fillStyle = '#333';\n        ctx.font = 'bold 14px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.fillText('Number of Terms', w / 2, h - 10);\n\n        ctx.save();\n        ctx.translate(15, h / 2);\n        ctx.rotate(-Math.PI / 2);\n        ctx.fillText('Partial Sum', 0, 0);\n        ctx.restore();\n    }\n}\n\n// Cumulative Progress Chart\nclass CumulativeChart extends ChartCanvas {\n    draw(a, r, n) {\n        this.clear();\n        const ctx = this.ctx;\n        const w = this.canvas.width;\n        const h = this.canvas.height;\n        const padding = 60;\n\n        const terms = generateTerms(a, r, n);\n        const finalSum = terms[terms.length - 1].partialSum;\n\n        this.drawAxes(padding, 100, 0);\n\n        // Draw area\n        const gradient = ctx.createLinearGradient(0, h - padding, 0, padding);\n        gradient.addColorStop(0, 'rgba(102, 126, 234, 0.3)');\n        gradient.addColorStop(1, 'rgba(118, 75, 162, 0.3)');\n\n        ctx.fillStyle = gradient;\n        ctx.beginPath();\n        ctx.moveTo(padding, h - padding);\n\n        for (let i = 0; i < terms.length; i++) {\n            const x = padding + (w - 2 * padding) * i / (n - 1);\n            const percentage = (terms[i].partialSum / finalSum) * 100;\n            const y = h - padding - (h - 2 * padding) * percentage / 100;\n            ctx.lineTo(x, y);\n        }\n\n        ctx.lineTo(w - padding, h - padding);\n        ctx.closePath();\n        ctx.fill();\n\n        // Draw line\n        ctx.strokeStyle = '#764ba2';\n        ctx.lineWidth = 3;\n        ctx.beginPath();\n\n        for (let i = 0; i < terms.length; i++) {\n            const x = padding + (w - 2 * padding) * i / (n - 1);\n            const percentage = (terms[i].partialSum / finalSum) * 100;\n            const y = h - padding - (h - 2 * padding) * percentage / 100;\n            \n            if (i === 0) ctx.moveTo(x, y);\n            else ctx.lineTo(x, y);\n        }\n        ctx.stroke();\n\n        // Labels\n        ctx.fillStyle = '#333';\n        ctx.font = 'bold 14px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.fillText('Number of Terms', w / 2, h - 10);\n\n        ctx.save();\n        ctx.translate(15, h / 2);\n        ctx.rotate(-Math.PI / 2);\n        ctx.fillText('% of Total Sum', 0, 0);\n        ctx.restore();\n    }\n}\n\n// Ratio Effect Chart\nclass RatioEffectChart extends ChartCanvas {\n    draw(a, n) {\n        this.clear();\n        const ctx = this.ctx;\n        const w = this.canvas.width;\n        const h = this.canvas.height;\n        const padding = 60;\n\n        const ratios = [];\n        const sums = [];\n        \n        for (let r = -0.9; r <= 1.9; r += 0.05) {\n            if (Math.abs(r - 1) > 0.05) {\n                ratios.push(r);\n                const result = calculateGeometricSum(a, r, n);\n                sums.push(result.sum);\n            }\n        }\n\n        const maxY = Math.max(...sums, 0);\n        const minY = Math.min(...sums, 0);\n        const range = maxY - minY || 1;\n\n        this.drawAxes(padding, maxY, minY);\n\n        // Draw line\n        ctx.strokeStyle = '#667eea';\n        ctx.lineWidth = 3;\n        ctx.beginPath();\n\n        ratios.forEach((r, i) => {\n            const x = padding + (w - 2 * padding) * (r + 0.9) / 2.8;\n            const y = h - padding - (h - 2 * padding) * (sums[i] - minY) / range;\n            \n            if (i === 0) ctx.moveTo(x, y);\n            else ctx.lineTo(x, y);\n        });\n        ctx.stroke();\n\n        // Draw r=1 exclusion zone\n        const r1X = padding + (w - 2 * padding) * (1 + 0.9) / 2.8;\n        ctx.fillStyle = 'rgba(231, 76, 60, 0.1)';\n        ctx.fillRect(r1X - 10, padding, 20, h - 2 * padding);\n        \n        ctx.strokeStyle = '#e74c3c';\n        ctx.lineWidth = 2;\n        ctx.setLineDash([5, 5]);\n        ctx.beginPath();\n        ctx.moveTo(r1X, padding);\n        ctx.lineTo(r1X, h - padding);\n        ctx.stroke();\n        ctx.setLineDash([]);\n\n        // Labels\n        ctx.fillStyle = '#333';\n        ctx.font = 'bold 14px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.fillText('Common Ratio (r)', w / 2, h - 10);\n\n        ctx.save();\n        ctx.translate(15, h / 2);\n        ctx.rotate(-Math.PI / 2);\n        ctx.fillText('Sum', 0, 0);\n        ctx.restore();\n\n        // r = 1 label\n        ctx.fillStyle = '#e74c3c';\n        ctx.font = '12px sans-serif';\n        ctx.fillText('r=1', r1X, padding - 5);\n    }\n}\n\n// Utility functions\nfunction formatNumber(num) {\n    if (Math.abs(num) >= 1e6 || (Math.abs(num) < 0.001 && num !== 0)) {\n        return num.toExponential(4);\n    } else {\n        return num.toFixed(4);\n    }\n}\n\n// Initialize charts\nlet termsChart, partialSumsChart, cumulativeChart, ratioEffectChart;\n\nfunction updateDisplay() {\n    const a = parseFloat(document.getElementById('firstTerm').value);\n    const r = parseFloat(document.getElementById('ratio').value);\n    const n = parseInt(document.getElementById('terms').value);\n\n    document.getElementById('ratioDisplay').textContent = r.toFixed(3);\n    document.getElementById('termsDisplay').textContent = n;\n\n    // Check for r = 1\n    const warning = document.getElementById('ratioWarning');\n    if (Math.abs(r - 1) < 0.02) {\n        warning.classList.add('show');\n    } else {\n        warning.classList.remove('show');\n    }\n}\n\nfunction calculate() {\n    const a = parseFloat(document.getElementById('firstTerm').value);\n    const r = parseFloat(document.getElementById('ratio').value);\n    const n = parseInt(document.getElementById('terms').value);\n\n    const result = calculateGeometricSum(a, r, n);\n\n    // Update sum display\n    const sumValue = document.getElementById('sumValue');\n    if (result.undefined) {\n        sumValue.textContent = 'Undefined';\n        sumValue.style.color = '#e74c3c';\n    } else {\n        sumValue.textContent = formatNumber(result.sum);\n        sumValue.style.color = '#667eea';\n    }\n    sumValue.classList.add('updating');\n    setTimeout(() => sumValue.classList.remove('updating'), 500);\n\n    // Update breakdown\n    document.getElementById('numerator').textContent = \n        result.numerator !== null ? formatNumber(result.numerator) : 'N/A';\n    document.getElementById('denominator').textContent = \n        result.denominator !== null ? formatNumber(result.denominator) : 'N/A';\n    document.getElementById('rPowerN').textContent = \n        result.rPowerN !== null ? formatNumber(result.rPowerN) : 'N/A';\n\n    // Update properties\n    const lastTerm = a * Math.pow(r, n - 1);\n    document.getElementById('lastTerm').textContent = formatNumber(lastTerm);\n\n    const seriesType = Math.abs(r) < 1 ? 'Convergent' : Math.abs(r) > 1 ? 'Divergent' : 'Special';\n    document.getElementById('seriesType').textContent = seriesType;\n\n    const behavior = r > 0 ? (r < 1 ? 'Decreasing' : 'Increasing') : 'Alternating';\n    document.getElementById('behavior').textContent = behavior;\n\n    if (Math.abs(r) < 1) {\n        const infiniteSum = a / (1 - r);\n        document.getElementById('infiniteSum').textContent = formatNumber(infiniteSum);\n    } else {\n        document.getElementById('infiniteSum').textContent = 'Diverges';\n    }\n\n    // Update charts\n    termsChart.draw(a, r, n);\n    partialSumsChart.draw(a, r, n);\n    cumulativeChart.draw(a, r, n);\n    ratioEffectChart.draw(a, n);\n\n    // Update table\n    updateTable(a, r, n);\n}\n\nfunction updateTable(a, r, n) {\n    const container = document.getElementById('termsTable');\n    const maxRows = 20;\n    const terms = generateTerms(a, r, Math.min(n, maxRows));\n\n    let html = '<table class=\"terms-table\">';\n    html += '<thead><tr><th>k</th><th>Term (ar<sup>k-1</sup>)</th><th>Partial Sum</th></tr></thead>';\n    html += '<tbody>';\n\n    terms.forEach(term => {\n        html += `<tr>\n            <td>${term.index}</td>\n            <td>${formatNumber(term.term)}</td>\n            <td>${formatNumber(term.partialSum)}</td>\n        </tr>`;\n    });\n\n    if (n > maxRows) {\n        html += `<tr><td colspan=\"3\" style=\"text-align:center; color:#888;\">\n            ... (${n - maxRows} more terms)</td></tr>`;\n    }\n\n    html += '</tbody></table>';\n    container.innerHTML = html;\n}\n\nfunction reset() {\n    document.getElementById('firstTerm').value = '1';\n    document.getElementById('ratio').value = '0.5';\n    document.getElementById('terms').value = '10';\n    updateDisplay();\n    calculate();\n}\n\nfunction loadExample(example) {\n    const examples = {\n        halving: { a: 1, r: 0.5, n: 10 },\n        doubling: { a: 1, r: 2, n: 8 },\n        alternating: { a: 1, r: -0.5, n: 10 },\n        fraction: { a: 100, r: 0.1, n: 5 }\n    };\n\n    const params = examples[example];\n    document.getElementById('firstTerm').value = params.a;\n    document.getElementById('ratio').value = params.r;\n    document.getElementById('terms').value = params.n;\n\n    updateDisplay();\n    calculate();\n}\n\n// Event listeners\nwindow.addEventListener('load', () => {\n    termsChart = new TermsChart('termsCanvas');\n    partialSumsChart = new PartialSumsChart('partialSumsCanvas');\n    cumulativeChart = new CumulativeChart('cumulativeCanvas');\n    ratioEffectChart = new RatioEffectChart('ratioEffectCanvas');\n\n    document.getElementById('firstTerm').addEventListener('input', updateDisplay);\n    document.getElementById('ratio').addEventListener('input', updateDisplay);\n    document.getElementById('terms').addEventListener('input', updateDisplay);\n\n    document.getElementById('calculateBtn').addEventListener('click', calculate);\n    document.getElementById('resetBtn').addEventListener('click', reset);\n\n    document.querySelectorAll('.example-btn').forEach(btn => {\n        btn.addEventListener('click', (e) => {\n            const example = e.currentTarget.dataset.example;\n            loadExample(example);\n        });\n    });\n\n    updateDisplay();\n    calculate();\n});\n\nwindow.addEventListener('resize', () => {\n    termsChart.setupCanvas();\n    partialSumsChart.setupCanvas();\n    cumulativeChart.setupCanvas();\n    ratioEffectChart.setupCanvas();\n    calculate();\n});"}}
{"input": {"input_text": "Binomial probability: P(X=k) = C(n,k) p^k (1-p)^{n-k}. Compute probability for given k.", "simulation_name": " Binomial PMF", "domain": "Statistics", "description": "Binomial probability mass", "assumptions": ["Independent Bernoulli trials"], "entities": [], "constants": [], "parameters": [{"name": "trials", "symbol": "n", "unit": "count", "range": [0, 1000000.0]}, {"name": "success_prob", "symbol": "p", "unit": "dimensionless", "range": [0, 1]}, {"name": "successes", "symbol": "k", "unit": "count", "range": [0, 1000000.0]}], "equations": [{"description": "PMF", "expression": "P = C(n,k)*p^k*(1 - p)^{n - k}"}], "initial_conditions": {}, "outputs": ["P"], "simulation_controls": ["n", "p", "k"], "constraints": ["0<=p<=1", "0<=k<=n"]}, "output": {"html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>S100 Binomial PMF Simulator</title>\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <!-- Header -->\n        <header class=\"header\">\n            <h1>Binomial PMF Simulator</h1>\n            <p class=\"subtitle\">Interactive visualization of the Binomial Probability Mass Function</p>\n            <div class=\"formula-box\">\n                <p class=\"formula\">P(X = k) = C(n, k) × p<sup>k</sup> × (1 - p)<sup>n - k</sup></p>\n            </div>\n        </header>\n\n        <!-- Controls Section -->\n        <section class=\"controls-section\">\n            <h2>Parameters</h2>\n            <div class=\"controls-grid\">\n                <!-- n control -->\n                <div class=\"control-group\">\n                    <label for=\"n-slider\">Number of Trials (n)</label>\n                    <input type=\"range\" id=\"n-slider\" min=\"1\" max=\"100\" value=\"10\" class=\"slider slider-n\">\n                    <input type=\"number\" id=\"n-input\" min=\"1\" max=\"100\" value=\"10\" class=\"number-input\">\n                </div>\n\n                <!-- p control -->\n                <div class=\"control-group\">\n                    <label for=\"p-slider\">Success Probability (p)</label>\n                    <input type=\"range\" id=\"p-slider\" min=\"0\" max=\"1\" step=\"0.01\" value=\"0.5\" class=\"slider slider-p\">\n                    <input type=\"number\" id=\"p-input\" min=\"0\" max=\"1\" step=\"0.01\" value=\"0.5\" class=\"number-input\">\n                </div>\n\n                <!-- k control -->\n                <div class=\"control-group\">\n                    <label for=\"k-slider\">Number of Successes (k)</label>\n                    <input type=\"range\" id=\"k-slider\" min=\"0\" max=\"10\" value=\"5\" class=\"slider slider-k\">\n                    <input type=\"number\" id=\"k-input\" min=\"0\" max=\"10\" value=\"5\" class=\"number-input\">\n                </div>\n            </div>\n        </section>\n\n        <!-- Result Display -->\n        <section class=\"result-section\">\n            <h2>Result</h2>\n            <div class=\"result-box\" id=\"result-box\">\n                <p class=\"result-label\">P(X = <span id=\"result-k\">5</span>) = </p>\n                <p class=\"result-value\" id=\"result-value\">0.24609375</p>\n                <p class=\"result-percent\" id=\"result-percent\">≈ 24.6094%</p>\n            </div>\n        </section>\n\n        <!-- Distribution Chart -->\n        <section class=\"chart-section\">\n            <h2>Probability Distribution</h2>\n            <div class=\"chart-container\">\n                <canvas id=\"distributionChart\"></canvas>\n            </div>\n            <div class=\"chart-legend\">\n                <div class=\"legend-item\">\n                    <span class=\"legend-color\" style=\"background-color: #8b5cf6;\"></span>\n                    <span>Probability</span>\n                </div>\n                <div class=\"legend-item\">\n                    <span class=\"legend-color\" style=\"background-color: #6366f1;\"></span>\n                    <span>Selected k</span>\n                </div>\n            </div>\n        </section>\n\n        <!-- Info Section -->\n        <section class=\"info-section\">\n            <h2>About</h2>\n            <div class=\"info-content\">\n                <p><strong>Domain:</strong> Statistics</p>\n                <p><strong>Description:</strong> Binomial probability mass function simulation</p>\n                <p><strong>Assumptions:</strong> Independent Bernoulli trials</p>\n                <p class=\"info-text\">\n                    The binomial distribution models the number of successes in n independent trials, \n                    each with probability p of success. The PMF gives the probability of exactly k successes.\n                </p>\n            </div>\n        </section>\n    </div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>", "css": "* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;\n    background: linear-gradient(135deg, #eff6ff 0%, #e0e7ff 100%);\n    min-height: 100vh;\n    padding: 2rem;\n}\n\n.container {\n    max-width: 1200px;\n    margin: 0 auto;\n}\n\n/* Header Styles */\n.header {\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    padding: 2rem;\n    margin-bottom: 1.5rem;\n    animation: slideDown 0.5s ease-out;\n}\n\n@keyframes slideDown {\n    from {\n        opacity: 0;\n        transform: translateY(-20px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n.header h1 {\n    color: #312e81;\n    font-size: 2rem;\n    margin-bottom: 0.5rem;\n}\n\n.subtitle {\n    color: #6b7280;\n    font-size: 1rem;\n    margin-bottom: 1rem;\n}\n\n.formula-box {\n    background: #eef2ff;\n    padding: 1rem;\n    border-radius: 8px;\n    margin-top: 1rem;\n}\n\n.formula {\n    font-family: 'Courier New', monospace;\n    color: #312e81;\n    font-size: 0.95rem;\n    text-align: center;\n}\n\n/* Controls Section */\n.controls-section {\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    padding: 2rem;\n    margin-bottom: 1.5rem;\n    animation: fadeIn 0.6s ease-out;\n}\n\n@keyframes fadeIn {\n    from {\n        opacity: 0;\n    }\n    to {\n        opacity: 1;\n    }\n}\n\n.controls-section h2 {\n    color: #1f2937;\n    font-size: 1.5rem;\n    margin-bottom: 1.5rem;\n}\n\n.controls-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n    gap: 2rem;\n}\n\n.control-group {\n    display: flex;\n    flex-direction: column;\n}\n\n.control-group label {\n    font-size: 0.9rem;\n    font-weight: 500;\n    color: #374151;\n    margin-bottom: 0.5rem;\n}\n\n.slider {\n    width: 100%;\n    height: 8px;\n    border-radius: 5px;\n    outline: none;\n    -webkit-appearance: none;\n    cursor: pointer;\n    transition: opacity 0.2s;\n}\n\n.slider:hover {\n    opacity: 0.8;\n}\n\n.slider-n {\n    background: #c7d2fe;\n}\n\n.slider-p {\n    background: #bbf7d0;\n}\n\n.slider-k {\n    background: #ddd6fe;\n}\n\n.slider::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #4f46e5;\n    cursor: pointer;\n    transition: transform 0.2s;\n}\n\n.slider::-webkit-slider-thumb:hover {\n    transform: scale(1.2);\n}\n\n.slider::-moz-range-thumb {\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #4f46e5;\n    cursor: pointer;\n    border: none;\n}\n\n.number-input {\n    margin-top: 0.5rem;\n    padding: 0.6rem;\n    border: 1px solid #d1d5db;\n    border-radius: 6px;\n    font-size: 0.95rem;\n    transition: border-color 0.2s;\n}\n\n.number-input:focus {\n    outline: none;\n    border-color: #4f46e5;\n}\n\n/* Result Section */\n.result-section {\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    padding: 2rem;\n    margin-bottom: 1.5rem;\n    animation: fadeIn 0.7s ease-out;\n}\n\n.result-section h2 {\n    color: #1f2937;\n    font-size: 1.5rem;\n    margin-bottom: 1.5rem;\n}\n\n.result-box {\n    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);\n    border-radius: 12px;\n    padding: 2rem;\n    color: white;\n    text-align: center;\n    transition: transform 0.3s ease;\n}\n\n.result-box.animating {\n    transform: scale(1.05);\n}\n\n.result-label {\n    font-size: 1.2rem;\n    margin-bottom: 0.5rem;\n    opacity: 0.95;\n}\n\n.result-value {\n    font-size: 2.5rem;\n    font-weight: bold;\n    margin: 0.5rem 0;\n}\n\n.result-percent {\n    font-size: 0.9rem;\n    opacity: 0.9;\n    margin-top: 0.5rem;\n}\n\n/* Chart Section */\n.chart-section {\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    padding: 2rem;\n    margin-bottom: 1.5rem;\n    animation: fadeIn 0.8s ease-out;\n}\n\n.chart-section h2 {\n    color: #1f2937;\n    font-size: 1.5rem;\n    margin-bottom: 1.5rem;\n}\n\n.chart-container {\n    position: relative;\n    height: 400px;\n    margin-bottom: 1rem;\n}\n\n#distributionChart {\n    width: 100%;\n    height: 100%;\n}\n\n.chart-legend {\n    display: flex;\n    justify-content: center;\n    gap: 2rem;\n    margin-top: 1rem;\n}\n\n.legend-item {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    font-size: 0.9rem;\n    color: #4b5563;\n}\n\n.legend-color {\n    width: 20px;\n    height: 20px;\n    border-radius: 4px;\n}\n\n/* Info Section */\n.info-section {\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    padding: 2rem;\n    animation: fadeIn 0.9s ease-out;\n}\n\n.info-section h2 {\n    color: #1f2937;\n    font-size: 1.5rem;\n    margin-bottom: 1rem;\n}\n\n.info-content {\n    color: #6b7280;\n    line-height: 1.8;\n}\n\n.info-content p {\n    margin-bottom: 0.5rem;\n}\n\n.info-text {\n    margin-top: 1rem;\n    font-size: 0.9rem;\n}\n\n/* Responsive Design */\n@media (max-width: 768px) {\n    body {\n        padding: 1rem;\n    }\n\n    .header h1 {\n        font-size: 1.5rem;\n    }\n\n    .controls-grid {\n        grid-template-columns: 1fr;\n        gap: 1.5rem;\n    }\n\n    .result-value {\n        font-size: 2rem;\n    }\n\n    .chart-container {\n        height: 300px;\n    }\n}", "js": "// Global variables\nlet n = 10;\nlet p = 0.5;\nlet k = 5;\nlet chart = null;\n\n// DOM elements\nconst nSlider = document.getElementById('n-slider');\nconst nInput = document.getElementById('n-input');\nconst pSlider = document.getElementById('p-slider');\nconst pInput = document.getElementById('p-input');\nconst kSlider = document.getElementById('k-slider');\nconst kInput = document.getElementById('k-input');\nconst resultBox = document.getElementById('result-box');\nconst resultK = document.getElementById('result-k');\nconst resultValue = document.getElementById('result-value');\nconst resultPercent = document.getElementById('result-percent');\nconst canvas = document.getElementById('distributionChart');\nconst ctx = canvas.getContext('2d');\n\n// Compute binomial coefficient C(n,k)\nfunction binomialCoeff(n, k) {\n    if (k > n || k < 0) return 0;\n    if (k === 0 || k === n) return 1;\n    \n    let result = 1;\n    for (let i = 1; i <= Math.min(k, n - k); i++) {\n        result *= (n - i + 1) / i;\n    }\n    return result;\n}\n\n// Compute binomial PMF\nfunction binomialPMF(n, k, p) {\n    if (k > n || k < 0 || p < 0 || p > 1) return 0;\n    const coeff = binomialCoeff(n, k);\n    return coeff * Math.pow(p, k) * Math.pow(1 - p, n - k);\n}\n\n// Update k slider max based on n\nfunction updateKSliderMax() {\n    kSlider.max = n;\n    kInput.max = n;\n    if (k > n) {\n        k = n;\n        kSlider.value = k;\n        kInput.value = k;\n    }\n}\n\n// Animate result box\nfunction animateResult() {\n    resultBox.classList.add('animating');\n    setTimeout(() => {\n        resultBox.classList.remove('animating');\n    }, 300);\n}\n\n// Update probability display\nfunction updateProbability() {\n    const prob = binomialPMF(n, k, p);\n    resultK.textContent = k;\n    resultValue.textContent = prob.toFixed(8);\n    resultPercent.textContent = `≈ ${(prob * 100).toFixed(4)}%`;\n    animateResult();\n}\n\n// Draw distribution chart\nfunction drawChart() {\n    const width = canvas.width;\n    const height = canvas.height;\n    \n    // Clear canvas\n    ctx.clearRect(0, 0, width, height);\n    \n    // Generate distribution data\n    const maxDisplay = Math.min(n, 50);\n    const step = n > 50 ? Math.ceil(n / 50) : 1;\n    const data = [];\n    let maxProb = 0;\n    \n    for (let i = 0; i <= n; i += step) {\n        const prob = binomialPMF(n, i, p);\n        data.push({ k: i, prob: prob });\n        maxProb = Math.max(maxProb, prob);\n    }\n    \n    // Chart dimensions\n    const padding = 60;\n    const chartWidth = width - 2 * padding;\n    const chartHeight = height - 2 * padding;\n    \n    // Draw axes\n    ctx.strokeStyle = '#d1d5db';\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.moveTo(padding, padding);\n    ctx.lineTo(padding, height - padding);\n    ctx.lineTo(width - padding, height - padding);\n    ctx.stroke();\n    \n    // Draw grid lines\n    ctx.strokeStyle = '#e5e7eb';\n    ctx.lineWidth = 1;\n    for (let i = 0; i <= 5; i++) {\n        const y = padding + (chartHeight * i / 5);\n        ctx.beginPath();\n        ctx.moveTo(padding, y);\n        ctx.lineTo(width - padding, y);\n        ctx.stroke();\n    }\n    \n    // Draw Y-axis labels\n    ctx.fillStyle = '#6b7280';\n    ctx.font = '12px sans-serif';\n    ctx.textAlign = 'right';\n    for (let i = 0; i <= 5; i++) {\n        const y = height - padding - (chartHeight * i / 5);\n        const value = (maxProb * i / 5).toFixed(3);\n        ctx.fillText(value, padding - 10, y + 4);\n    }\n    \n    // Draw X-axis label\n    ctx.textAlign = 'center';\n    ctx.fillText('Number of Successes (k)', width / 2, height - 20);\n    \n    // Draw Y-axis label\n    ctx.save();\n    ctx.translate(20, height / 2);\n    ctx.rotate(-Math.PI / 2);\n    ctx.fillText('Probability', 0, 0);\n    ctx.restore();\n    \n    // Draw bars\n    const barWidth = chartWidth / data.length;\n    const barGap = barWidth * 0.1;\n    \n    data.forEach((point, index) => {\n        const barHeight = (point.prob / maxProb) * chartHeight;\n        const x = padding + (index * barWidth) + barGap;\n        const y = height - padding - barHeight;\n        const width = barWidth - 2 * barGap;\n        \n        // Determine bar color\n        const isSelected = point.k === k;\n        ctx.fillStyle = isSelected ? '#6366f1' : '#8b5cf6';\n        ctx.globalAlpha = isSelected ? 1.0 : 0.6;\n        \n        // Draw bar with rounded top\n        ctx.beginPath();\n        ctx.moveTo(x, height - padding);\n        ctx.lineTo(x, y + 8);\n        ctx.arcTo(x, y, x + 8, y, 8);\n        ctx.lineTo(x + width - 8, y);\n        ctx.arcTo(x + width, y, x + width, y + 8, 8);\n        ctx.lineTo(x + width, height - padding);\n        ctx.closePath();\n        ctx.fill();\n        \n        // Draw X-axis labels for selected points\n        if (data.length <= 20 || index % 5 === 0 || isSelected) {\n            ctx.globalAlpha = 1.0;\n            ctx.fillStyle = '#6b7280';\n            ctx.font = isSelected ? 'bold 12px sans-serif' : '11px sans-serif';\n            ctx.fillText(point.k, x + width / 2, height - padding + 20);\n        }\n    });\n    \n    ctx.globalAlpha = 1.0;\n    \n    // Draw reference line for selected k\n    const selectedIndex = data.findIndex(d => d.k === k);\n    if (selectedIndex !== -1) {\n        const x = padding + (selectedIndex * barWidth) + barWidth / 2;\n        ctx.strokeStyle = '#ef4444';\n        ctx.lineWidth = 2;\n        ctx.setLineDash([5, 5]);\n        ctx.beginPath();\n        ctx.moveTo(x, padding);\n        ctx.lineTo(x, height - padding);\n        ctx.stroke();\n        ctx.setLineDash([]);\n    }\n}\n\n// Resize canvas to match container\nfunction resizeCanvas() {\n    const container = canvas.parentElement;\n    canvas.width = container.offsetWidth;\n    canvas.height = container.offsetHeight;\n    drawChart();\n}\n\n// Event listeners for n\nnSlider.addEventListener('input', (e) => {\n    n = parseInt(e.target.value);\n    nInput.value = n;\n    updateKSliderMax();\n    updateProbability();\n    drawChart();\n});\n\nnInput.addEventListener('input', (e) => {\n    const value = parseInt(e.target.value);\n    if (value >= 1 && value <= 100) {\n        n = value;\n        nSlider.value = n;\n        updateKSliderMax();\n        updateProbability();\n        drawChart();\n    }\n});\n\n// Event listeners for p\npSlider.addEventListener('input', (e) => {\n    p = parseFloat(e.target.value);\n    pInput.value = p;\n    updateProbability();\n    drawChart();\n});\n\npInput.addEventListener('input', (e) => {\n    const value = parseFloat(e.target.value);\n    if (value >= 0 && value <= 1) {\n        p = value;\n        pSlider.value = p;\n        updateProbability();\n        drawChart();\n    }\n});\n\n// Event listeners for k\nkSlider.addEventListener('input', (e) => {\n    k = parseInt(e.target.value);\n    kInput.value = k;\n    updateProbability();\n    drawChart();\n});\n\nkInput.addEventListener('input', (e) => {\n    const value = parseInt(e.target.value);\n    if (value >= 0 && value <= n) {\n        k = value;\n        kSlider.value = k;\n        updateProbability();\n        drawChart();\n    }\n});\n\n// Window resize handler\nwindow.addEventListener('resize', resizeCanvas);\n\n// Initialize\nwindow.addEventListener('load', () => {\n    resizeCanvas();\n    updateProbability();\n});"}}
